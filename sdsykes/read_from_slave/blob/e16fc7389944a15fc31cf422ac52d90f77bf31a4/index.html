<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>sdsykes's read_from_slave - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/sdsykes/commits/read_from_slave/master" rel="alternate" title="Recent Commits to read_from_slave:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("sdsykes", "read_from_slave", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='sdsykes/read_from_slave/blob/e16fc7389944a15fc31cf422ac52d90f77bf31a4' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='sdsykes/read_from_slave/blob/e16fc7389944a15fc31cf422ac52d90f77bf31a4' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("sdsykes", "read_from_slave", "e16fc7389944a15fc31cf422ac52d90f77bf31a4", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/sdsykes/read_from_slave/tree/">Source</a></li>
            <li class=""><a href="http://github.com/sdsykes/read_from_slave/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/sdsykes/read_from_slave/network">Network</a></li>            
            <li class=""><a href="http://github.com/sdsykes/read_from_slave/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/sdsykes/read_from_slave">Wiki</a></li>
            <li class=""><a href="http://github.com/sdsykes/read_from_slave/graphs">Graphs</a></li>                    
            <li class="active"><a href="/sdsykes/read_from_slave">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/sdsykes">sdsykes</a> / <b><a href="http://github.com/sdsykes/read_from_slave/tree">read_from_slave</a></b>        
                <a id="namespaces_button" rel="sdsykes/read_from_slave/blob/e16fc7389944a15fc31cf422ac52d90f77bf31a4" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="sdsykes/read_from_slave/blob/e16fc7389944a15fc31cf422ac52d90f77bf31a4" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
Read_from_slave
</p>
<p>
Read_from_slave for Rails enables database reads from a slave database,
while writes continue to go to the master
</p>
<p>
Read_from_slave will work with Rails 2.2 and above.
</p>
<p>
Installation
</p>
<p>
sudo gem install sdsykes-read_from_slave
</p>
<p>
Configuration
</p>
<p>
In config/environments/production.rb (for instance)
</p>
<pre class="code">
  <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>&quot;sdsykes-read_from_slave&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:lib=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;read_from_slave&quot;</span>
</pre>
<p>
In config/database.yml
</p>
<pre class="code">
  <span class='production identifier id'>production</span><span class='colon op'>:</span>
    <span class='adapter identifier id'>adapter</span><span class='colon op'>:</span> <span class='mysql identifier id'>mysql</span>
    <span class='database identifier id'>database</span><span class='colon op'>:</span> <span class='mydatabase identifier id'>mydatabase</span>
    <span class='username identifier id'>username</span><span class='colon op'>:</span> <span class='myuser identifier id'>myuser</span>
    <span class='password identifier id'>password</span><span class='colon op'>:</span> <span class='mypassword identifier id'>mypassword</span>
    <span class='host identifier id'>host</span><span class='colon op'>:</span> <span class='my identifier id'>my</span><span class='dot token'>.</span><span class='main identifier id'>main</span><span class='dot token'>.</span><span class='database identifier id'>database</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='dot token'>.</span><span class='com identifier id'>com</span>
    <span class='port identifier id'>port</span><span class='colon op'>:</span> <span class='integer val'>3306</span>

  <span class='slave_for_mydatabase identifier id'>slave_for_mydatabase</span><span class='colon op'>:</span>
    <span class='adapter identifier id'>adapter</span><span class='colon op'>:</span> <span class='mysql identifier id'>mysql</span>
    <span class='database identifier id'>database</span><span class='colon op'>:</span> <span class='mydatabase identifier id'>mydatabase</span>
    <span class='username identifier id'>username</span><span class='colon op'>:</span> <span class='myuser identifier id'>myuser</span>
    <span class='password identifier id'>password</span><span class='colon op'>:</span> <span class='mypassword identifier id'>mypassword</span>
    <span class='socket identifier id'>socket</span><span class='colon op'>:</span> <span class='regexp val'>/var/</span><span class='lib identifier id'>lib</span><span class='div op'>/</span><span class='mysql identifier id'>mysql</span><span class='div op'>/</span><span class='mysql identifier id'>mysql</span><span class='dot token'>.</span><span class='sock identifier id'>sock</span>
</pre>
<p>
Just use the regular YAML format to specify your slave database, it could
equally well be on another server as the local example given above.
</p>
<p>
Phusion Passenger
</p>
<p>
Note if you are using Passenger, you need to make sure that the slave
database is reconnected if there is any chance that it was accessed before
the spawner forks. In my case it is because I access the database during
the construction of routes.
</p>
<p>
The safest thing to do is to have something like this in your production.rb
or environment.rb:
</p>
<pre class="code">
  <span class='PhusionPassenger constant id'>PhusionPassenger</span><span class='dot token'>.</span><span class='on_event identifier id'>on_event</span><span class='lparen token'>(</span><span class='symbol val'>:starting_worker_process</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='forked identifier id'>forked</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='forked identifier id'>forked</span>
      <span class='comment val'># We're in smart spawning mode.</span>
      <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='establish_slave_connections identifier id'>establish_slave_connections</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># We're in conservative spawning mode. We don't need to do anything.</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Documentation
</p>
<p>
http://rdoc.info/projects/sdsykes/read_from_slave
</p>
<p>
Todo
</p>
<ul>
<li>Support a pool of multiple slaves

</li>
</ul>
<p>
References
</p>
<p>
&quot;Masochism&quot;:http://github.com/technoweenie/masochism/tree/master
not thread safe won&#8217;t work with apps that talk to multiple (master)
databases
</p>
<p>
&quot;Acts as
readonlyable&quot;:http://rubyforge.org/projects/acts-as-with-ro/ old, not
suitable for Rails 2.x
</p>
<p>
&quot;master_slave_adapter&quot;:http://github.com/mauricio/master_slave_adapter/tree/master
similar to read_from_slave, but adapter based approach
</p>
<p>
&#169; 2009 Stephen Sykes
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>