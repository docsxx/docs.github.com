<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jgoizueta's nio - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jgoizueta/commits/nio/master" rel="alternate" title="Recent Commits to nio:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jgoizueta", "nio", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jgoizueta/nio/blob/998806ae391961a34556f876604954e9d93e4f3b' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jgoizueta/nio/blob/998806ae391961a34556f876604954e9d93e4f3b' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jgoizueta", "nio", "998806ae391961a34556f876604954e9d93e4f3b", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jgoizueta/nio/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jgoizueta/nio/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/nio/network">Network</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/nio/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jgoizueta/nio">Wiki</a></li>
            <li class=""><a href="http://github.com/jgoizueta/nio/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jgoizueta/nio">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jgoizueta">jgoizueta</a> / <b><a href="http://github.com/jgoizueta/nio/tree">nio</a></b>        
                <a id="namespaces_button" rel="jgoizueta/nio/blob/998806ae391961a34556f876604954e9d93e4f3b" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jgoizueta/nio/blob/998806ae391961a34556f876604954e9d93e4f3b" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Description</h1>
<p>
Nio (Numeric input/output) is a Ruby package for text-formatted
input/output and conversion of scalar numeric types.
</p>
<p>
This library formats numbers as text numerals and reads them back into
numeric objects. The numeric types Integer Rational, BigDecimal and Float
are supported. The numeral format is controlled with Nio::Fmt objects.
Conversion between the numerical types is also provided.
</p>
<p>
Nio offers low level services; formats supported are only positional
notation and types are only scalar. This means that composite types such as
Complex are not supported an that fraction notation (X/Y) is not supported
for rationals; those are higher level services that could be implemented
using Nio but are not the subject of this package.
</p>
<p>
The implementation of Nio is pure Ruby, and not specially fast; but it is
complete and accurate.
</p>
<p>
Nio has some interesting features, though:
</p>
<ul>
<li>Correctly rounded conversions of all supported types to and from positional
numerals in any base.

</li>
<li>Handling of digit repetitions (repeating decimals or, in general,
<em>repeating numerals</em>). With this method rational numbers can be
represented exactly as numerals.

</li>
<li>Discrimitation of significant digits of the representation of Float in any
base. (insignificant digits are those that can take any value without
altering the Float value they specify.)

</li>
</ul>
<p>
All definitions are inside the module Nio that acts as a namespace, and
methods added to classes outside of Nio have names that begin with the
prefix <tt>nio_</tt>.
</p>
<p>
Limitations:
</p>
<ul>
<li>The current version does not support UTF-8 or other multi-byte encodings
(digits and separators must be one-byte characters).

</li>
<li>This code is not very fast, since it is implemented in pure Ruby (no C
extensions are used).

</li>
<li>Error handling needs to improve also in future versions, specially on input
and format parameters checking.

</li>
</ul>
<h1>Installation</h1>
<p>
The easiest way to install Nio is using gems:
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='remote identifier id'>remote</span> <span class='nio identifier id'>nio</span>
</pre>
<h2>Downloads</h2>
<p>
The latest version of Nio and its source code can be downloaded form
</p>
<ul>
<li>http://rubyforge.org/project/showfiles.php?group_id=4445

</li>
</ul>
<p>
The source code uses nuweb (a {<em>literate programming
system</em>}[http://en.wikipedia.org/wiki/Literate_programming]) to
generate the Ruby code for Nio. For more details you can download the nuweb
source code package, <tt>nio-source</tt> and the documented source package,
<tt>nio-source-pdf</tt>, which contains PDF files.
</p>
<h1>Documentation</h1>
<p>
For a general introduction and some details, read on below.
</p>
<ul>
<li>See the the API to the Nio::Fmt object for all the <b>formatting
options</b>.

</li>
<li>For <b>type conversions</b> see Fmt.convert().

</li>
<li>For some notational <b>shortcuts</b> see
nio/sugar.rb[link:files/lib/nio/sugar_rb.html].

</li>
<li>To <b>extend</b> the formatting to other types see the documentation for
the module Nio::Formattable.

</li>
</ul>
<h1>Basic use</h1>
<p>
First we must require the library; we request also the optional
nio/sugar.rb for convenient notational shortcuts, and include the module
Nio to avoid writing too many Nio::s.
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'nio'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'nio/sugar'</span>
  <span class='include identifier id'>include</span> <span class='Nio constant id'>Nio</span>
</pre>
<p>
Let&#8217;s define a nice number to do some tests:
</p>
<pre class="code">
  <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='sqrt identifier id'>sqrt</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span><span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='integer val'>100</span>
</pre>
<h3>Writing</h3>
<p>
Now let&#8217;s try the formatted output:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span>                                          <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>101.41421356237309</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                        <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>101.4142</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:sig</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                        <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>101.4</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:sci</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                        <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>1.014E2</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                        <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>101.4</span>
  <span class='puts identifier id'>puts</span> <span class='lparen token'>(</span><span class='float val'>1e7</span><span class='mult op'>*</span><span class='x identifier id'>x</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                  <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>1.014E9</span>
  <span class='puts identifier id'>puts</span> <span class='lparen token'>(</span><span class='float val'>1e7</span><span class='mult op'>*</span><span class='x identifier id'>x</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='show_plus identifier id'>show_plus</span><span class='rparen token'>)</span>        <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;1.014E9
  puts x.nio_write(Fmt.mode(:gen,:exact))                   -&gt; 101.41421356237309
</span></pre>
<p>
We&#8217;ve seen some formatting modes:
</p>
<ul>
<li><tt>:fix</tt> (similar to F in C printf or in Fortran) which shows a number
of <em>fixed</em> decimals (4 in the example).

</li>
<li><tt>:sig</tt> is just like :fix, but the number of decimals specified means
significant digits.

</li>
<li><tt>:sci</tt> (similar to E in C printf or in Fortran) is for scientific or
exponential notation.

</li>
<li><tt>:gen</tt> (similar to G in C printf or in Fortran) is the general
notational (which also the default), the number of decimals is for
significant digits, and :sig is used if possible; if it would be too long
it uses :sci instead.

</li>
</ul>
<p>
In one example above we used <tt>show_plus</tt> to force the display of the
sign. And in the last line we used <tt>:exact</tt> for the number of
digits, (which is also the default), and this adjust automatically the
number of digits to show the value <em>exactly</em>, meaning that if we
convert the numeral back to a numeric object of the original type, the same
exact value will be produced.
</p>
<p>
Now let&#8217;s see some other formatting aspects. The separators can be
defined:
</p>
<pre class="code">
  <span class='x identifier id'>x</span> <span class='opasgn op'>*=</span> <span class='integer val'>1111</span>
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                            <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>112671</span><span class='comma token'>,</span><span class='integer val'>1913</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='comma token'>,</span><span class='string val'>'.'</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                    <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>112.671</span><span class='comma token'>,</span><span class='integer val'>1913</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='comma token'>,</span><span class='string val'>' '</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                  <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span> <span class='integer val'>126</span> <span class='integer val'>71</span><span class='comma token'>,</span><span class='integer val'>1913</span>
</pre>
<p>
The number can be adjusted in a field of specific width:
</p>
<p>
fmt = Fmt.mode(:fix,2)
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='float val'>11.2</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                         <span class='minus op'>-</span><span class='gt op'>&gt;</span>    <span class='float val'>11.20</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>11.2</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='comma token'>,</span><span class='symbol val'>:right</span><span class='comma token'>,</span><span class='string val'>'*'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>              <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='pow op'>**</span><span class='mult op'>*</span><span class='float val'>11.20</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>11.2</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='comma token'>,</span><span class='symbol val'>:right</span><span class='comma token'>,</span><span class='string val'>'*'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='show_plus identifier id'>show_plus</span><span class='rparen token'>)</span>    <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='pow op'>**</span><span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='float val'>11.20</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>11.2</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='comma token'>,</span><span class='symbol val'>:internal</span><span class='comma token'>,</span><span class='string val'>'*'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='show_plus identifier id'>show_plus</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;**11.20
  puts 11.2.nio_write(fmt.width(8,:left,'*'))               -&gt; 11.20***
  puts 11.2.nio_write(fmt.width(8,:center,'*'))             -&gt; *11.20**
  puts 11.2.nio_write(fmt.pad0s(8))                         -&gt; 00011.20
  puts Rational(112,10).nio_write(fmt.pad0s(8))             -&gt; 00011.20
  puts 112.nio_write(fmt.pad0s(8))                          -&gt; 00112.00
</span></pre>
<p>
The numerical base does not need to be 10:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='float val'>34222223344</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='base identifier id'>base</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                  <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>7</span><span class='f7cdaff0 identifier id'>f7cdaff0</span><span class='integer val'>.00</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='base identifier id'>base</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                            <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='b81f identifier id'>b81f</span><span class='integer val'>.30</span><span class='F6ED22C constant id'>F6ED22C</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='base identifier id'>base</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>11011100000011111.0011</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>1.234333E-23</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='base identifier id'>base</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>20</span><span class='rparen token'>)</span><span class='rparen token'>)</span>         <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>1.1101110110000010011E-77</span>
</pre>
<p>
The sugar module give us some alternatives for the writing notation:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span> <span class='lshft op'>&lt;&lt;</span> <span class='x identifier id'>x</span>                                             <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>112671.1912677965</span>
  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='x identifier id'>x</span>                                <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>112671.1913</span>

  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='rparen token'>)</span>                                         <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>112671.1912677965</span>
  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>                            <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>4.0000</span>
</pre>
<h3>Reading</h3>
<p>
To read a numeral we must specify the numeric class we want to convert it
to:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'0.1'</span><span class='rparen token'>)</span>                                <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>
  <span class='puts identifier id'>puts</span> <span class='BigDecimal constant id'>BigDecimal</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'0.1'</span><span class='rparen token'>)</span>                           <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='float val'>.1E0</span>
  <span class='puts identifier id'>puts</span> <span class='Rational constant id'>Rational</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'0.1'</span><span class='rparen token'>)</span>                             <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='div op'>/</span><span class='integer val'>10</span>
  <span class='puts identifier id'>puts</span> <span class='Integer constant id'>Integer</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'0.1'</span><span class='rparen token'>)</span>                              <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span>
</pre>
<p>
A format can also be specified, although some aspects (such as the
precision) will be ignored.
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'0,1'</span><span class='comma token'>,</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                   <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>
  <span class='puts identifier id'>puts</span> <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'122.344,1'</span><span class='comma token'>,</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='rparen token'>)</span>             <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>122344.1</span>
  <span class='puts identifier id'>puts</span> <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'122,344.1'</span><span class='comma token'>,</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>'.'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>             <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>122344.1</span>
</pre>
<p>
There are also some sweet alternatives for reading:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='comma token'>,</span><span class='string val'>'0.1'</span><span class='rparen token'>)</span>                                <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>
  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='comma token'>,</span><span class='string val'>'0,1'</span><span class='rparen token'>)</span>                       <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>

  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span> <span class='rshft op'>&gt;&gt;</span> <span class='lbrack token'>[</span><span class='Float constant id'>Float</span><span class='comma token'>,</span> <span class='string val'>'0.1'</span><span class='rbrack token'>]</span>                                <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>
  <span class='puts identifier id'>puts</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span> <span class='rshft op'>&gt;&gt;</span> <span class='lbrack token'>[</span><span class='Float constant id'>Float</span><span class='comma token'>,</span> <span class='string val'>'0,1'</span><span class='rbrack token'>]</span>                       <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>
</pre>
<h3>Floating point</h3>
<p>
Now let&#8217;s see something trickier; we will use the floating point
result of dividing 2 by 3 and will use a format with 20 fixed digits:
</p>
<pre class="code">
  <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='float val'>2.0</span><span class='div op'>/</span><span class='integer val'>3</span>
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>20</span><span class='rparen token'>)</span>

  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='rparen token'>)</span>                                     <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.66666666666666663</span>
</pre>
<p>
If you count the digits you will find only 17. Where are the other 3?
</p>
<p>
Here we&#8217;re dealing with an approximate numerical type, Float, that
has a limited internal precision and we asked for a higher precision on the
output, which we didn&#8217;t get. Nio refuses to show non-significant
digits.
</p>
<p>
We can use a placeholder for the digits so that Nio shows us something
rather than just ignoring the digits:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='insignificant_digits identifier id'>insignificant_digits</span><span class='lparen token'>(</span><span class='string val'>'#'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>           <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.66666666666666663</span><span class='comment val'>###</span>
</pre>
<p>
Nio is hiding those digits because it assumes that the Float value is an
approximation, but we can force it to actually compute the mathematical
<em>exact</em> value of the Float:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='approx_mode identifier id'>approx_mode</span><span class='lparen token'>(</span><span class='symbol val'>:exact</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                 <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.66666666666666662966</span>
</pre>
<h3>Default format</h3>
<p>
The default format Fmt.default is used when no format is specified; it can
be changed by assigning to it:
</p>
<pre class="code">
  <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='default identifier id'>default</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='default identifier id'>default</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>1.23456</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span>              <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>23456</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>1.23456</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>23</span>
</pre>
<p>
But note that Fmt.new doesn&#8217;t use the current default (it&#8217;s the
hard-wired value at which Fmt.default starts):
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='float val'>1.23456</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>1.23</span>
</pre>
<p>
There are also other named prefined formats:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='float val'>123456.78</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:dot</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>123456.78</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>123456.78</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:dot_th</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>123</span><span class='comma token'>,</span><span class='float val'>456.78</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>123456.78</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:comma</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>123456</span><span class='comma token'>,</span><span class='integer val'>78</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>123456.78</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:code</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>123456</span><span class='comma token'>,</span><span class='integer val'>78</span>
</pre>
<p>
The <tt>_th</tt> indicates that thousands separators are used; the :code
format is intended for programming languages such as Ruby, C, SQL, etc.
These formats can be changed by assigning to them, and also other named
formats can be defined:
</p>
<pre class="code">
  <span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:code</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>123456.78</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:code</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>123456.8</span>
  <span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:locale_money</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='comma token'>,</span><span class='string val'>'.'</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>123456.78</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='lbrack token'>[</span><span class='symbol val'>:locale_money</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='float val'>123.456</span><span class='comma token'>,</span><span class='integer val'>78</span>
</pre>
<h3>Conversions</h3>
<p>
Nio can also convert values between numerical types, e.g. from Float to
Rational:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='float val'>2.0</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='Rational constant id'>Rational</span><span class='rparen token'>)</span>                     <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span><span class='div op'>/</span><span class='integer val'>3</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='float val'>2.0</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='Rational constant id'>Rational</span><span class='comma token'>,</span> <span class='symbol val'>:exact</span><span class='rparen token'>)</span>             <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>6004799503160661</span><span class='div op'>/</span><span class='integer val'>9007199254740992</span>
</pre>
<p>
The default (approximate) conversions assumes that the value is inexact and
tries to find a nice simple value near it. When we request <tt>:exact</tt>
conversion the actual internal value of the floating point number is
preserved.
</p>
<p>
Let&#8217;s see some more examples:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='float val'>2.0</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='BigDecimal constant id'>BigDecimal</span><span class='rparen token'>)</span>                   <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='float val'>.666666666666666666666667E0</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='float val'>2.0</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='BigDecimal constant id'>BigDecimal</span><span class='comma token'>,</span> <span class='symbol val'>:exact</span><span class='rparen token'>)</span>           <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='float val'>.66666666666666662965923251249478198587894439697265625E0</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='Float constant id'>Float</span><span class='rparen token'>)</span>                <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.666666666666667</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='BigDecimal constant id'>BigDecimal</span><span class='rparen token'>)</span>           <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='float val'>.666666666666666666666667E0</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'2'</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='Rational constant id'>Rational</span><span class='rparen token'>)</span>         <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span><span class='div op'>/</span><span class='integer val'>3</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'2'</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='Rational constant id'>Rational</span><span class='comma token'>,</span> <span class='symbol val'>:exact</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>666666666666666666666667</span><span class='div op'>/</span><span class='integer val'>1000000000000000000000000</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='float val'>2.0</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='BigDecimal constant id'>BigDecimal</span><span class='rparen token'>)</span>                   <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='float val'>.666666666666666666666667E0</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='float val'>2.0</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='BigDecimal constant id'>BigDecimal</span><span class='comma token'>,</span> <span class='symbol val'>:exact</span><span class='rparen token'>)</span>           <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='float val'>.66666666666666662965923251249478198587894439697265625E0</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'2'</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='Float constant id'>Float</span><span class='rparen token'>)</span>            <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.666666666666667</span>
  <span class='puts identifier id'>puts</span> <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'2'</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='Float constant id'>Float</span><span class='comma token'>,</span> <span class='symbol val'>:exact</span><span class='rparen token'>)</span>    <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.666666666666667</span>
</pre>
<h1>Details</h1>
<h3>Defining formats</h3>
<p>
Say you want a numeric format based on the current default but with some
aspects changed, e.g. using comma as the decimal separator and with only 3
digits of precision, we could do:
</p>
<pre class="code">
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='default identifier id'>default</span>
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span>
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
</pre>
<p>
That wasn&#8217;t very nice. Fmt is a mutable class and have methods to
modify its state that end with a bang. We can use them to make this look
better, but note that we must create a copy of the default format before we
modify it:
</p>
<pre class="code">
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='default identifier id'>default</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='sep! fid id'>sep!</span> <span class='string val'>','</span>
  <span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='prec! fid id'>prec!</span> <span class='integer val'>3</span>
</pre>
<p>
Note that we had to make a duplicate of the default format in order to
modify it or we would have got an error (if you want to modify the default
format you have to assign to it).
</p>
<p>
Now we can simplify this a little by passing a block to Fmt.default:
</p>
<pre class="code">
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='default identifier id'>default</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='sep! fid id'>sep!</span> <span class='string val'>','</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='prec! fid id'>prec!</span> <span class='integer val'>3</span>
  <span class='rbrace token'>}</span>
</pre>
<p>
But there&#8217;s a more concise way to define the format by avoiding the
bang-methods and chaining all modifications:
</p>
<pre class="code">
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='default identifier id'>default</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
</pre>
<p>
Or even (using shortcut methods such as Fmt.sep or Fmt.prec):
</p>
<pre class="code">
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
</pre>
<p>
If we don&#8217;t want to base the new format on the current default, but
use the initial default instead, we would substitute new for default above,
except in the last case which always uses the default. For example:
</p>
<pre class="code">
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='sep! fid id'>sep!</span> <span class='string val'>','</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='prec! fid id'>prec!</span> <span class='integer val'>3</span>
  <span class='rbrace token'>}</span>

  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> <span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='sep identifier id'>sep</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
</pre>
<p>
If a particular case needs a format similar to fmt but with some
modification we would use, for example:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='integer val'>0</span><span class='float val'>.1234567</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='integer val'>5</span><span class='rparen token'>)</span><span class='rparen token'>)</span>  <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.12346</span>
  <span class='puts identifier id'>puts</span> <span class='integer val'>0</span><span class='float val'>.1234567</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt identifier id'>fmt</span><span class='rparen token'>)</span>              <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.123</span>
</pre>
<h3>Exact and aproximate values</h3>
<p>
Float and BigDecimal are approximate in the sense that a given value within
the range of these types, (defined either by an expression or as result of
a computation) may no be exactly represented and has to be substituted by
the closest possible value. With Float, which generally is a binary
floating point, there&#8217;s an additional mismatch with the notation
(decimal) used for input and output.
</p>
<p>
For the following examples we assume that Float is an IEEE754 double
precision binary type (i.e. <tt>Float::RADIX==2 &amp;&amp;
Float::MANT_DIG==53</tt>) which is the common case (in all Ruby platforms I
know of, at least).
</p>
<pre class="code">
  <span class='integer val'>0</span><span class='float val'>.1</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='symbol val'>:exact</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>
</pre>
<p>
Well, that seems pretty clear&#8230; but let&#8217;s complicate things a
little:
</p>
<pre class="code">
  <span class='integer val'>0</span><span class='float val'>.1</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='symbol val'>:exact</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='show_all_digits identifier id'>show_all_digits</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.10000000000000001</span>
</pre>
<p>
Mmmm where does that last one came from? Now we&#8217;re seen a little more
exactly what the actual value stored in the Float (the closest Float to
0.1) looks like.
</p>
<p>
But why didn&#8217;t we see the second one-digit in the first try? We
requested &quot;exact&quot; precision!
</p>
<p>
Well, we didn&#8217;t get it because it is not needed to specify exactly
the inner value of Float(1.0); when we convert 0.1 and round it to the
nearest Float we get the same value as when we use 0.10000000000000001.
Since we didn&#8217;t request to see &quot;all digits&quot;, we got only as
few as possible.
</p>
<pre class="code">
  <span class='integer val'>0</span><span class='float val'>.1</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='prec identifier id'>prec</span><span class='lparen token'>(</span><span class='symbol val'>:exact</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='approx_mode identifier id'>approx_mode</span><span class='lparen token'>(</span><span class='symbol val'>:exact</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1000000000000000055511151231257827021181583404541015625</span>
</pre>
<p>
Hey! Where did all that stuff came from? Now we&#8217;re really seeing the
&quot;exact&quot; value of Float. (We asked the conversion method to
consider the Float an exactly defined value, rather than an approximation
to some other value). But, why didn&#8217;t we get all those digits when we
asked for &quot;all digits&quot;?.
</p>
<p>
Because most are not significant; the default &quot;approx_mode&quot; is to
consider Float an approximate value and show only significant digits. We
define insignificant digits as those that can be replaced by any other
digit without altering the Float value when the number is rounded to the
nearest float. By looking at our example we see that the 17 first digits
(just before the 555111&#8230;) must be significant: they cannot take an
arbitrary value without altering the Float. In fact all have well specified
values except the last one that can be either 0 or 1 (but no other value).
The next digits (first insignificant, a 5) can be replaced by any other
digit * (from 0 to 9) and the expression 0.10000000000000000* would still
be rounded to Float(0.1)
</p>
<h3>Insignificance</h3>
<p>
So, let&#8217;s summarize the situation about inexact numbers: When the
approximate mode of a format is <tt>:only_sig</tt>, the digits of inexact
(i.e. floating point) numbers are classified as significant or
insignificant. The latter are only shown if the property
<tt>:all_digits</tt> is true (which it is by default for <tt>:fix</tt>) but
since they are not meaningful they use a special character that by default
is empty. You can define that character to see where they are:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='integer val'>0</span><span class='float val'>.1</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>20</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='insignificant_digits identifier id'>insignificant_digits</span><span class='lparen token'>(</span><span class='string val'>'#'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>   <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.10000000000000001</span><span class='comment val'>###</span>
</pre>
<p>
If we hadn&#8217;t use the special character we would&#8217;nt even seen
those digits:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='integer val'>0</span><span class='float val'>.1</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>20</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                             <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.10000000000000001</span>
</pre>
<p>
When the aproximate mode is defined as :exact, there&#8217;s no distinction
between significant or insignificant digits, the number is taken as exactly
defined and all digits are shown with their value.
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='integer val'>0</span><span class='float val'>.1</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:fix</span><span class='comma token'>,</span><span class='integer val'>20</span><span class='comma token'>,</span><span class='symbol val'>:approx_mode=</span><span class='gt op'>&gt;</span><span class='symbol val'>:exact</span><span class='rparen token'>)</span>         <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.10000000000000000555</span>
</pre>
<h3>Repeating Numerals</h3>
<p>
The common term is <b>repeating decimal</b> or <b>recurring decimal</b>,
but since Nio support them for any base, we&#8217;ll call them
<em>repeating numerals</em>.
</p>
<pre class="code">
  <span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='float val'>.333</span><span class='dot3 op'>...</span>
</pre>
<p>
We usually find that notation for the decimal expansion of 1/3 in texts,
but that doesn&#8217;t seem very accurate for a conversion library, or is
it?
</p>
<pre class="code">
  <span class='Rational constant id'>Rational</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'0.333...'</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rparen token'>)</span>
</pre>
<p>
It works the other way! In fact the seemingly loose 0.333&#8230; was an
exact representation for Nio.
</p>
<p>
All Rational numbers can be expressed as a repeating numeral in any base.
Repeating numerals may have an infinite number of digits, but from some
point on they&#8217;re just repetitions of the same (finite) sequence of
digits.
</p>
<p>
By default Nio expresses that kind of repetition by appending two
repetitions of the repeating sequence after it and adding the ellipsis (so
the repeated sequence appears three times, and, by the way Nio uses three
points rather than a real ellipsis characters). This allow Nio to recognize
the repeating sequence on input. We can use a more economical notation by
just marking the repeating sequence, rather than repeating it:
</p>
<pre class="code">
  <span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='rep identifier id'>rep</span><span class='lparen token'>(</span><span class='symbol val'>:nreps=</span><span class='gt op'>&gt;</span><span class='integer val'>0</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='dot token'>.</span><span class='lt op'>&lt;</span><span class='integer val'>3</span><span class='gt op'>&gt;</span>
</pre>
<p>
We just requested for 0 as the number of repetitions (the default is 2) and
got the sequence delimited by &lt;&gt; (we can change those characters; we
can even use just a left separator). This is shorter and would allow to
show the number better with special typography (e.g. a bar over the
repeated digits, a different color, etc.)
</p>
<h3>Rounding</h3>
<p>
Rounding is performed on both input and output. When a value is formatted
for output the number is rounded to the number of digits that has been
specified.
</p>
<p>
But also when a value must be read from text rounding it is necessary to
choose the nearest numeric representation (e.g. Float value).
</p>
<p>
Nio supports three rounding modes which determine how to round
<em>ties</em>:
</p>
<dl>
<dt><tt>:inf</tt></dt><dd>round to infinity

<pre class="code">
     <span class='float val'>1.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span>  <span class='integer val'>2</span>
    <span class='float val'>-1.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>-2</span>
</pre>
</dd>
<dt><tt>:even</tt></dt><dd>round to even (to the nearest even digit)

</dd>
</dl>
<pre class="code">
         <span class='float val'>1.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span>  <span class='integer val'>2</span>
         <span class='float val'>2.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span>  <span class='integer val'>2</span>
        <span class='float val'>-1.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>-2</span>
        <span class='float val'>-2.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>-2</span>
</pre>
<dl>
<dt><tt>:zero</tt></dt><dd>round to zero

</dd>
</dl>
<pre class="code">
         <span class='float val'>1.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span>  <span class='integer val'>1</span>
        <span class='float val'>-1.5</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>-1</span>
</pre>
<p>
Rounding can be set with Nio::Fmt#mode and Nio::Fmt#prec for specific
formats, and the default rounding mode can be changed with
Fmt.default_rounding_mode().
</p>
<p>
For round-trip conversions, a number should use the same rounding mode on
input and output.
</p>
<p>
For Floats there&#8217;s an additional issue here, because when we use
floating point literals on the Ruby code (such as 0.1 or 1E23) they are
parsed and converted to Floating point values by the Ruby interpreter which
must apply some kind of rounding when the expression to be parsed is
equidistant from two Float values. All the Ruby implementations I have
tried have IEEE754 Double Float (<tt>Float::RADIX==2 &amp;&amp;
Float::MANT_DIG==53</tt>) and floating point literals seem to be rounded
according to the round-to-even rule, so that is the initial default
rounding mode.
</p>
<h4>Examples</h4>
<p>
We assume the common implementation of float (<tt>Float::RADIX==2
&amp;&amp; Float::MANT_DIG==53</tt>) here. In that case, we can use the
value 1E23, which is equidistant from two Floats to check which kind of
roundig does the interpreter use. If it&#8217;s round-to-even (the common
case) we&#8217;ll have:
</p>
<pre class="code">
  <span class='float val'>1E23</span> <span class='eq op'>==</span> <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'1E23'</span><span class='comma token'>,</span><span class='Nio constant id'>Nio</span><span class='colon2 op'>::</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='symbol val'>:exact</span><span class='comma token'>,</span><span class='symbol val'>:round=</span><span class='gt op'>&gt;</span><span class='symbol val'>:even</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='float val'>1E23</span> <span class='eq op'>==</span> <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'1E23'</span><span class='comma token'>,</span><span class='Nio constant id'>Nio</span><span class='colon2 op'>::</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='symbol val'>:exact</span><span class='comma token'>,</span><span class='symbol val'>:round=</span><span class='gt op'>&gt;</span><span class='symbol val'>:zero</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
</pre>
<p>
But if rounding is to infinity the previous check will be false and this
will hold:
</p>
<pre class="code">
  <span class='float val'>1E23</span> <span class='eq op'>==</span> <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'1E23'</span><span class='comma token'>,</span><span class='Nio constant id'>Nio</span><span class='colon2 op'>::</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='symbol val'>:exact</span><span class='comma token'>,</span><span class='symbol val'>:round=</span><span class='gt op'>&gt;</span><span class='symbol val'>:inf</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
</pre>
<p>
(Well, with this example we can&#8217;t really distinguish :even from
:zero, but :zero is most probably not used)
</p>
<p>
Now, if we&#8217;re using the same default rounding for Nio we will have:
</p>
<pre class="code">
  <span class='float val'>1E23</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span> <span class='eq op'>==</span> <span class='string val'>&quot;1E23&quot;</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
</pre>
<p>
Which will make you feel warm and fuzzy. But if the system rounding is
different we will get one of these ugly values:
</p>
<pre class="code">
   <span class='fmt_inf identifier id'>fmt_inf</span> <span class='assign token'>=</span> <span class='Nio constant id'>Nio</span><span class='colon2 op'>::</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='symbol val'>:exact</span><span class='comma token'>,</span><span class='symbol val'>:round=</span><span class='gt op'>&gt;</span><span class='symbol val'>:inf</span><span class='rparen token'>)</span>
   <span class='fmt_even identifier id'>fmt_even</span> <span class='assign token'>=</span> <span class='Nio constant id'>Nio</span><span class='colon2 op'>::</span><span class='Fmt constant id'>Fmt</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='lparen token'>(</span><span class='symbol val'>:gen</span><span class='comma token'>,</span><span class='symbol val'>:exact</span><span class='comma token'>,</span><span class='symbol val'>:round=</span><span class='gt op'>&gt;</span><span class='symbol val'>:even</span><span class='rparen token'>)</span>
   <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'1E23'</span><span class='comma token'>,</span><span class='fmt_inf identifier id'>fmt_inf</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt_even identifier id'>fmt_even</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;1.0000000000000001E23&quot;</span>
   <span class='Float constant id'>Float</span><span class='dot token'>.</span><span class='nio_read identifier id'>nio_read</span><span class='lparen token'>(</span><span class='string val'>'1E23'</span><span class='comma token'>,</span><span class='fmt_even identifier id'>fmt_even</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nio_write identifier id'>nio_write</span><span class='lparen token'>(</span><span class='fmt_inf identifier id'>fmt_inf</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;9.999999999999999E22&quot;</span>
</pre>
<p>
If the Ruby interpreter doesn&#8217;t support any of the roundings of Nio,
or if it doesn&#8217;t correctly round, the best solution would be to avoid
using Float literals and use Float#nio_read instead.
</p>
<h3>Conversions</h3>
<p>
Accurate conversion between numerical types can be performed with
Nio.convert. It takes three arguments: the value to convert, the class to
convert it to (Float, BigDecimal, Flt::Num, Integer or Rational) and the
conversion mode, either :exact, which is&#8230;, well, quite exact, and
:approx which tries to find a simpler value (e.g. 0.1 rather than
0.10000000000000001&#8230;) within the accuray of the original value. The
:approx mode may be pretty slow in some cases.
</p>
<pre class="code">
   <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.1</span><span class='comma token'>,</span><span class='BigDecimal constant id'>BigDecimal</span><span class='comma token'>,</span><span class='symbol val'>:exact</span><span class='rparen token'>)</span>    <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1000000000</span> <span class='integer val'>0000000555</span> <span class='integer val'>1115123125</span> <span class='dot3 op'>...</span>
   <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.1</span><span class='comma token'>,</span><span class='BigDecimal constant id'>BigDecimal</span><span class='comma token'>,</span><span class='symbol val'>:approx</span><span class='rparen token'>)</span>   <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.1</span>
</pre>
<p>
We can check out the accuracy of the conversions:
</p>
<pre class="code">
    <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'1.234567890123456'</span><span class='rparen token'>)</span><span class='comma token'>,</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span><span class='eq op'>==</span><span class='float val'>1.234567890123456</span>   <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='Nio constant id'>Nio</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'355'</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='integer val'>226</span><span class='comma token'>,</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span><span class='eq op'>==</span><span class='lparen token'>(</span><span class='float val'>355.0</span><span class='div op'>/</span><span class='integer val'>226</span><span class='rparen token'>)</span>                   <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
</pre>
<p>
Thay may not look very impressive, but is much more accurate than
BigDecimal#to_f (at least in Ruby versions up to 1.8.6, mswin32 (specially)
and linux) for which:
</p>
<pre class="code">
     <span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'1.234567890123456'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='eq op'>==</span> <span class='float val'>1.234567890123456</span>  <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
     <span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='lparen token'>(</span><span class='string val'>'355'</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='integer val'>226</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='eq op'>==</span> <span class='lparen token'>(</span><span class='float val'>355.0</span><span class='div op'>/</span><span class='float val'>226.0</span><span class='rparen token'>)</span>              <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
</pre>
<h1>License</h1>
<p>
This code is free to use under the terms of the GNU GENERAL PUBLIC LICENSE.
</p>
<h1>Contact</h1>
<p>
Nio has been developed by Javier Goizueta (mailto:javier@goizueta.info).
</p>
<p>
You can contact me through
Rubyforge:http://rubyforge.org/sendmessage.php?touser=25432
</p>
<h1>More Information</h1>
<ul>
<li><b>What Every Computer Scientist Should Know About Floating-Point
Arithmetic</b> David Goldberg

<ul>
<li>http://docs.sun.com/source/806-3568/ncg_goldberg.html

</li>
</ul>
</li>
<li><b>How to Read Floating Point Numbers Accurately</b> William D. Clinger

<ul>
<li>http://citeseer.ist.psu.edu/224562.html

</li>
</ul>
</li>
<li><b>Printing Floating-Point Numbers Quickly and Accurately</b> Robert G.
Burger &amp; R. Kent Dybvig

<ul>
<li>http://www.cs.indiana.edu/~burger/FP-Printing-PLDI96.pdf

</li>
</ul>
</li>
<li><b>Repeating Decimal</b>

<ul>
<li>http://mathworld.wolfram.com/RepeatingDecimal.html

</li>
<li>http://en.wikipedia.org/wiki/Recurring_decimal

</li>
</ul>
</li>
<li>For <b>floating point rationalization algorithms</b>, see my commented
source code for the <tt>rntlzr</tt> module from Nio, which you can download
in PDF here:

<ul>
<li>http://perso.wanadoo.es/jgoizueta/dev/goi/rtnlzr.pdf

</li>
</ul>
</li>
</ul>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>