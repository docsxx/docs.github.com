<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jgoizueta's flt - Module: Flt::DecNum::AuxiliarFunctions - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jgoizueta/commits/flt/master" rel="alternate" title="Recent Commits to flt:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jgoizueta", "flt", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jgoizueta", "flt", "74e2b0218d3b82b2bb954d8787e3d2beaf422338", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jgoizueta/flt/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/network">Network</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jgoizueta/flt">Wiki</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jgoizueta/flt">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jgoizueta">jgoizueta</a> / <b><a href="http://github.com/jgoizueta/flt/tree">flt</a></b>        
                <a id="namespaces_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Flt_DecNum_AuxiliarFunctions">
  <h1>Module: Flt::DecNum::AuxiliarFunctions</h1>
  <div class="section attributes">
  
    <div class="">
      <h2>Class Attributes</h2>
      <table>
      
        <tr>
          <th class="name">log10_digits</td>
          <td class="readwrite">
            [<span id='log10_digits-class_method'>R</span><span id='log10_digits=-class_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>log10_digits</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="LOG10_LB_CORRECTION-constant">LOG10_LB_CORRECTION</dt>
      <dd>{ # (1..9).map_hash{|i| 100 - (100*Math.log10(i)).floor}
'1'=&gt; 100, '2'=&gt; 70, '3'=&gt; 53, '4'=&gt; 40, '5'=&gt; 31,
'6'=&gt; 23, '7'=&gt; 16, '8'=&gt; 10, '9'=&gt; 5}</dd>
    
      <dt id="NUMBER_OF_DIGITS_MAX_VALID_LOG-constant">NUMBER_OF_DIGITS_MAX_VALID_LOG</dt>
      <dd>10**(Float::DIG-1)</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_dexp-instance_method">#_dexp</span><span class='args'>(c, e, p)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compute an approximation to exp(c*10**e), with p decimal places of
precision.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_div_nearest-instance_method">#_div_nearest</span><span class='args'>(a, b)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Closest integer to a/b, a and b positive integers; rounds to even in the
case of a tie.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_dlog-instance_method">#_dlog</span><span class='args'>(c, e, p)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given integers c, e and p with c &gt; 0, compute an integer approximation
to 10**p * log(c*10**e), with an absolute error of at most 1.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_dlog10-instance_method">#_dlog10</span><span class='args'>(c, e, p)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given integers c, e and p with c &gt; 0, p &gt;= 0, compute an integer
approximation to 10**p * log10(c*10**e), with an absolute error of at most
1.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_dpower-instance_method">#_dpower</span><span class='args'>(xc, xe, yc, ye, p)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given integers xc, xe, yc and ye representing Decimals x = xc*10**xe and y
= yc*10**ye, compute x**y.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_iexp-instance_method">#_iexp</span><span class='args'>(x, m, l = 8)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given integers x and M, M &gt; 0, such that x/M is small in absolute value,
compute an integer approximation to M*exp(x/M).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_ilog-instance_method">#_ilog</span><span class='args'>(x, m, l = 8)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Integer approximation to M*log(x/M), with absolute error boundable in terms
only of x/M.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_log10_digits-instance_method">#_log10_digits</span><span class='args'>(p)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given an integer p &gt;= 0, return floor(10**p)*log(10).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_log10_lb-instance_method">#_log10_lb</span><span class='args'>(c)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compute a lower bound for 100*log10&#169; for a positive integer c.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_number_of_digits-instance_method">#_number_of_digits</span><span class='args'>(i)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
number of bits in a nonnegative integer.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_rshift_nearest-instance_method">#_rshift_nearest</span><span class='args'>(x, shift)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given an integer x and a nonnegative integer shift, return closest integer
to x / 2**shift; use round-to-even in case of a tie.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_sqrt_nearest-instance_method">#_sqrt_nearest</span><span class='args'>(n, a)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Closest integer to the square root of the positive integer n.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#dexp-instance_method">#dexp</span><span class='args'>(c, e, p)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compute an approximation to exp(c*10**e), with p decimal places of
precision.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>_dexp</h3>
</div><div id="_dexp-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_dexp</span><span class='args'>(c, e, p)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compute an approximation to exp(c*10**e), with p decimal places of
precision. Returns integers d, f such that:
</p>
<pre class="code">
  <span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='leq op'>&lt;=</span> <span class='d identifier id'>d</span> <span class='leq op'>&lt;=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span><span class='comma token'>,</span> <span class='and and kw'>and</span>
  <span class='lparen token'>(</span><span class='d identifier id'>d</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='f identifier id'>f</span> <span class='lt op'>&lt;</span> <span class='exp identifier id'>exp</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='e identifier id'>e</span><span class='rparen token'>)</span> <span class='lt op'>&lt;</span> <span class='lparen token'>(</span><span class='d identifier id'>d</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='f identifier id'>f</span>
</pre>
<p>
In other words, d*10**f is an approximation to exp(c*10**e) with p digits
of precision, and with an error in d of at most 1. This is almost, but not
quite, the same as the error being &lt; 1ulp: when d
</p>
<h1>10**(p-1) the error could be up to 10 ulp.</h1>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 895</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L895">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_dexp identifier id'>_dexp</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='rparen token'>)</span>
    <span class='comment val'># we'll call iexp with M = 10**(p+2), giving p+3 digits of precision</span>
    <span class='p identifier id'>p</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span>

    <span class='comment val'># compute log(10) with extra precision = adjusted exponent of c*10**e</span>
    <span class='comment val'># TODO: without the .abs tests fail because c is negative: c should not be negative!!</span>
    <span class='extra identifier id'>extra</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='e identifier id'>e</span> <span class='plus op'>+</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='max identifier id'>max</span>
    <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='p identifier id'>p</span> <span class='plus op'>+</span> <span class='extra identifier id'>extra</span>

    <span class='comment val'># compute quotient c*10**e/(log(10)) = c*10**(e+q)/(log(10)*10**q),</span>
    <span class='comment val'># rounding down</span>
    <span class='shift identifier id'>shift</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='plus op'>+</span><span class='q identifier id'>q</span>
    <span class='if if kw'>if</span> <span class='shift identifier id'>shift</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
        <span class='cshift identifier id'>cshift</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='shift identifier id'>shift</span>
    <span class='else else kw'>else</span>
        <span class='cshift identifier id'>cshift</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span><span class='div op'>/</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='shift identifier id'>shift</span>
    <span class='end end kw'>end</span>
    <span class='quot identifier id'>quot</span><span class='comma token'>,</span> <span class='rem identifier id'>rem</span> <span class='assign token'>=</span> <span class='cshift identifier id'>cshift</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='_log10_digits identifier id'>_log10_digits</span><span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

    <span class='comment val'># reduce remainder back to original precision</span>
    <span class='rem identifier id'>rem</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='rem identifier id'>rem</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='extra identifier id'>extra</span><span class='rparen token'>)</span>

    <span class='comment val'># error in result of _iexp &lt; 120;  error after division &lt; 0.62</span>
    <span class='return return kw'>return</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='_iexp identifier id'>_iexp</span><span class='lparen token'>(</span><span class='rem identifier id'>rem</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='integer val'>1000</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='quot identifier id'>quot</span> <span class='minus op'>-</span> <span class='p identifier id'>p</span> <span class='plus op'>+</span> <span class='integer val'>3</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_div_nearest</h3>
</div><div id="_div_nearest-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_div_nearest</span><span class='args'>(a, b)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Closest integer to a/b, a and b positive integers; rounds to even in the
case of a tie.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 923</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L923">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">923
924
925
926</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='rparen token'>)</span>
  <span class='q identifier id'>q</span><span class='comma token'>,</span> <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='b identifier id'>b</span><span class='rparen token'>)</span>
  <span class='q identifier id'>q</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='mult op'>*</span><span class='r identifier id'>r</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='bitand op'>&amp;</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='gt op'>&gt;</span> <span class='b identifier id'>b</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_dlog</h3>
</div><div id="_dlog-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_dlog</span><span class='args'>(c, e, p)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given integers c, e and p with c &gt; 0, compute an integer approximation
to 10**p * log(c*10**e), with an absolute error of at most 1. Assumes that
c*10**e is not exactly 1.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 1054</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L1054">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_dlog identifier id'>_dlog</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='rparen token'>)</span>

    <span class='comment val'># Increase precision by 2. The precision increase is compensated</span>
    <span class='comment val'># for at the end with a division by 100.</span>
    <span class='p identifier id'>p</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span>

    <span class='comment val'># rewrite c*10**e as d*10**f with either f &gt;= 0 and 1 &lt;= d &lt;= 10,</span>
    <span class='comment val'># or f &lt;= 0 and 0.1 &lt;= d &lt;= 1.  Then we can compute 10**p * log(c*10**e)</span>
    <span class='comment val'># as 10**p * log(d) + 10**p*f * log(10).</span>
    <span class='l identifier id'>l</span> <span class='assign token'>=</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span>
    <span class='f identifier id'>f</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='plus op'>+</span><span class='l identifier id'>l</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='plus op'>+</span><span class='l identifier id'>l</span> <span class='geq op'>&gt;=</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>

    <span class='comment val'># compute approximation to 10**p*log(d), with error &lt; 27</span>
    <span class='if if kw'>if</span> <span class='p identifier id'>p</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='plus op'>+</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='f identifier id'>f</span>
        <span class='if if kw'>if</span> <span class='k identifier id'>k</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
            <span class='c identifier id'>c</span> <span class='opasgn op'>*=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='k identifier id'>k</span>
        <span class='else else kw'>else</span>
            <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='k identifier id'>k</span><span class='rparen token'>)</span>  <span class='comment val'># error of &lt;= 0.5 in c</span>
        <span class='end end kw'>end</span>

        <span class='comment val'># _ilog magnifies existing error in c by a factor of at most 10</span>
        <span class='log_d identifier id'>log_d</span> <span class='assign token'>=</span> <span class='_ilog identifier id'>_ilog</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span><span class='rparen token'>)</span> <span class='comment val'># error &lt; 5 + 22 = 27</span>
    <span class='else else kw'>else</span>
        <span class='comment val'># p &lt;= 0: just approximate the whole thing by 0; error &lt; 2.31</span>
        <span class='log_d identifier id'>log_d</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># compute approximation to f*10**p*log(10), with error &lt; 11.</span>
    <span class='if if kw'>if</span> <span class='f identifier id'>f</span>
        <span class='extra identifier id'>extra</span> <span class='assign token'>=</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
        <span class='if if kw'>if</span> <span class='p identifier id'>p</span> <span class='plus op'>+</span> <span class='extra identifier id'>extra</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
            <span class='comment val'># error in f * _log10_digits(p+extra) &lt; |f| * 1 = |f|</span>
            <span class='comment val'># after division, error &lt; |f|/10**extra + 0.5 &lt; 10 + 0.5 &lt; 11</span>
            <span class='f_log_ten identifier id'>f_log_ten</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='mult op'>*</span><span class='_log10_digits identifier id'>_log10_digits</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='plus op'>+</span><span class='extra identifier id'>extra</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='extra identifier id'>extra</span><span class='rparen token'>)</span>
        <span class='else else kw'>else</span>
            <span class='f_log_ten identifier id'>f_log_ten</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
        <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
        <span class='f_log_ten identifier id'>f_log_ten</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># error in sum &lt; 11+27 = 38; error after division &lt; 0.38 + 0.5 &lt; 1</span>
    <span class='return return kw'>return</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='f_log_ten identifier id'>f_log_ten</span> <span class='plus op'>+</span> <span class='log_d identifier id'>log_d</span><span class='comma token'>,</span> <span class='integer val'>100</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_dlog10</h3>
</div><div id="_dlog10-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_dlog10</span><span class='args'>(c, e, p)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given integers c, e and p with c &gt; 0, p &gt;= 0, compute an integer
approximation to 10**p * log10(c*10**e), with an absolute error of at most
1. Assumes that c*10**e is not exactly 1.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 1009</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L1009">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_dlog10 identifier id'>_dlog10</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='rparen token'>)</span>
   <span class='comment val'># increase precision by 2; compensate for this by dividing</span>
  <span class='comment val'># final result by 100</span>
  <span class='p identifier id'>p</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span>

  <span class='comment val'># write c*10**e as d*10**f with either:</span>
  <span class='comment val'>#   f &gt;= 0 and 1 &lt;= d &lt;= 10, or</span>
  <span class='comment val'>#   f &lt;= 0 and 0.1 &lt;= d &lt;= 1.</span>
  <span class='comment val'># Thus for c*10**e close to 1, f = 0</span>
  <span class='l identifier id'>l</span> <span class='assign token'>=</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span>
  <span class='f identifier id'>f</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='plus op'>+</span><span class='l identifier id'>l</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='plus op'>+</span><span class='l identifier id'>l</span> <span class='geq op'>&gt;=</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='p identifier id'>p</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='m identifier id'>m</span> <span class='assign token'>=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span>
    <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='plus op'>+</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='f identifier id'>f</span>
    <span class='if if kw'>if</span> <span class='k identifier id'>k</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
      <span class='c identifier id'>c</span> <span class='opasgn op'>*=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='k identifier id'>k</span>
    <span class='else else kw'>else</span>
      <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='k identifier id'>k</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='log_d identifier id'>log_d</span> <span class='assign token'>=</span> <span class='_ilog identifier id'>_ilog</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='rparen token'>)</span> <span class='comment val'># error &lt; 5 + 22 = 27</span>
    <span class='log_10 identifier id'>log_10</span> <span class='assign token'>=</span> <span class='_log10_digits identifier id'>_log10_digits</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='rparen token'>)</span> <span class='comment val'># error &lt; 1</span>
    <span class='log_d identifier id'>log_d</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='log_d identifier id'>log_d</span><span class='mult op'>*</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='log_10 identifier id'>log_10</span><span class='rparen token'>)</span>
    <span class='log_tenpower identifier id'>log_tenpower</span> <span class='assign token'>=</span> <span class='f identifier id'>f</span><span class='mult op'>*</span><span class='m identifier id'>m</span> <span class='comment val'># exact</span>
  <span class='else else kw'>else</span>
    <span class='log_d identifier id'>log_d</span> <span class='assign token'>=</span> <span class='integer val'>0</span>  <span class='comment val'># error &lt; 2.31</span>
    <span class='log_tenpower identifier id'>log_tenpower</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='p identifier id'>p</span><span class='rparen token'>)</span> <span class='comment val'># error &lt; 0.5</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='log_tenpower identifier id'>log_tenpower</span><span class='plus op'>+</span><span class='log_d identifier id'>log_d</span><span class='comma token'>,</span> <span class='integer val'>100</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_dpower</h3>
</div><div id="_dpower-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_dpower</span><span class='args'>(xc, xe, yc, ye, p)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given integers xc, xe, yc and ye representing Decimals x = xc*10**xe and y
= yc*10**ye, compute x**y. Returns a pair of integers (c, e) such that:
</p>
<pre class="code">
  <span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='leq op'>&lt;=</span> <span class='c identifier id'>c</span> <span class='leq op'>&lt;=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span><span class='comma token'>,</span> <span class='and and kw'>and</span>
  <span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='e identifier id'>e</span> <span class='lt op'>&lt;</span> <span class='x identifier id'>x</span><span class='pow op'>**</span><span class='y identifier id'>y</span> <span class='lt op'>&lt;</span> <span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='e identifier id'>e</span>
</pre>
<p>
in other words, c*10**e is an approximation to x**y with p digits of
precision, and with an error in c of at most 1. (This is almost, but not
quite, the same as the error being &lt; 1ulp: when c
</p>
<h2>10**(p-1) we can only guarantee error &lt; 10ulp.)</h2>
<p>
We assume that: x is positive and not equal to 1, and y is nonzero.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 853</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L853">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_dpower identifier id'>_dpower</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='comma token'>,</span> <span class='xe identifier id'>xe</span><span class='comma token'>,</span> <span class='yc identifier id'>yc</span><span class='comma token'>,</span> <span class='ye identifier id'>ye</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='rparen token'>)</span>
  <span class='comment val'># Find b such that 10**(b-1) &lt;= |y| &lt;= 10**b</span>
  <span class='b identifier id'>b</span> <span class='assign token'>=</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='yc identifier id'>yc</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='ye identifier id'>ye</span>

  <span class='comment val'># log(x) = lxc*10**(-p-b-1), to p+b+1 places after the decimal point</span>
  <span class='lxc identifier id'>lxc</span> <span class='assign token'>=</span> <span class='_dlog identifier id'>_dlog</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='comma token'>,</span> <span class='xe identifier id'>xe</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='plus op'>+</span><span class='b identifier id'>b</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span>

  <span class='comment val'># compute product y*log(x) = yc*lxc*10**(-p-b-1+ye) = pc*10**(-p-1)</span>
  <span class='shift identifier id'>shift</span> <span class='assign token'>=</span> <span class='ye identifier id'>ye</span><span class='minus op'>-</span><span class='b identifier id'>b</span>
  <span class='if if kw'>if</span> <span class='shift identifier id'>shift</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
      <span class='pc identifier id'>pc</span> <span class='assign token'>=</span> <span class='lxc identifier id'>lxc</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='shift identifier id'>shift</span>
  <span class='else else kw'>else</span>
      <span class='pc identifier id'>pc</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='lxc identifier id'>lxc</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='shift identifier id'>shift</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='pc identifier id'>pc</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
      <span class='comment val'># we prefer a result that isn't exactly 1; this makes it</span>
      <span class='comment val'># easier to compute a correctly rounded result in __pow__</span>
      <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='xe identifier id'>xe</span> <span class='geq op'>&gt;=</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='lparen token'>(</span><span class='yc identifier id'>yc</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='comment val'># if x**y &gt; 1:</span>
          <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='minus op'>-</span><span class='p identifier id'>p</span>
      <span class='else else kw'>else</span>
          <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='p identifier id'>p</span>
      <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
      <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='_dexp identifier id'>_dexp</span><span class='lparen token'>(</span><span class='pc identifier id'>pc</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span>
      <span class='coeff identifier id'>coeff</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='rparen token'>)</span>
      <span class='exp identifier id'>exp</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_iexp</h3>
</div><div id="_iexp-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_iexp</span><span class='args'>(x, m, l = 8)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given integers x and M, M &gt; 0, such that x/M is small in absolute value,
compute an integer approximation to M*exp(x/M). For 0 &lt;= x/M &lt;= 2.4,
the absolute error in the result is bounded by 60 (and is usually much
smaller).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 1104</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L1104">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_iexp identifier id'>_iexp</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='l identifier id'>l</span><span class='assign token'>=</span><span class='integer val'>8</span><span class='rparen token'>)</span>

    <span class='comment val'># Algorithm: to compute exp(z) for a real number z, first divide z</span>
    <span class='comment val'># by a suitable power R of 2 so that |z/2**R| &lt; 2**-L.  Then</span>
    <span class='comment val'># compute expm1(z/2**R) = exp(z/2**R) - 1 using the usual Taylor</span>
    <span class='comment val'># series</span>
    <span class='comment val'>#</span>
    <span class='comment val'>#     expm1(x) = x + x**2/2! + x**3/3! + ...</span>
    <span class='comment val'>#</span>
    <span class='comment val'># Now use the identity</span>
    <span class='comment val'>#</span>
    <span class='comment val'>#     expm1(2x) = expm1(x)*(expm1(x)+2)</span>
    <span class='comment val'>#</span>
    <span class='comment val'># R times to compute the sequence expm1(z/2**R),</span>
    <span class='comment val'># expm1(z/2**(R-1)), ... , exp(z/2), exp(z).</span>

    <span class='comment val'># Find R such that x/2**R/M &lt;= 2**-L</span>
    <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='_nbits identifier id'>_nbits</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='lshft op'>&lt;&lt;</span><span class='l identifier id'>l</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='m identifier id'>m</span><span class='rparen token'>)</span>

    <span class='comment val'># Taylor series.  (2**L)**T &gt; M</span>
    <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='integer val'>-10</span><span class='mult op'>*</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='mult op'>*</span><span class='l identifier id'>l</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='t identifier id'>t</span><span class='rparen token'>)</span>
    <span class='mshift identifier id'>mshift</span> <span class='assign token'>=</span> <span class='m identifier id'>m</span><span class='lshft op'>&lt;&lt;</span><span class='r identifier id'>r</span>
    <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot3 op'>...</span><span class='t identifier id'>t</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
        <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='mshift identifier id'>mshift</span> <span class='plus op'>+</span> <span class='y identifier id'>y</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='mshift identifier id'>mshift</span> <span class='mult op'>*</span> <span class='i identifier id'>i</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Expansion</span>
    <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='r identifier id'>r</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='bitor op'>|</span>
        <span class='mshift identifier id'>mshift</span> <span class='assign token'>=</span> <span class='m identifier id'>m</span><span class='lshft op'>&lt;&lt;</span><span class='lparen token'>(</span><span class='k identifier id'>k</span><span class='plus op'>+</span><span class='integer val'>2</span><span class='rparen token'>)</span>
        <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='plus op'>+</span><span class='mshift identifier id'>mshift</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='mshift identifier id'>mshift</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='m identifier id'>m</span><span class='plus op'>+</span><span class='y identifier id'>y</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_ilog</h3>
</div><div id="_ilog-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_ilog</span><span class='args'>(x, m, l = 8)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Integer approximation to M*log(x/M), with absolute error boundable in terms
only of x/M.
</p>
<p>
Given positive integers x and M, return an integer approximation to M *
log(x/M). For L = 8 and 0.1 &lt;= x/M &lt;= 10 the difference between the
approximation and the exact result is at most 22. For L = 8 and 1.0 &lt;=
x/M &lt;= 10.0 the difference is at most 15. In both cases these are upper
bounds on the error; it will usually be much smaller.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 962</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L962">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_ilog identifier id'>_ilog</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='l identifier id'>l</span> <span class='assign token'>=</span> <span class='integer val'>8</span><span class='rparen token'>)</span>
  <span class='comment val'># The basic algorithm is the following: let log1p be the function</span>
  <span class='comment val'># log1p(x) = log(1+x).  Then log(x/M) = log1p((x-M)/M).  We use</span>
  <span class='comment val'># the reduction</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#    log1p(y) = 2*log1p(y/(1+sqrt(1+y)))</span>
  <span class='comment val'>#</span>
  <span class='comment val'># repeatedly until the argument to log1p is small (&lt; 2**-L in</span>
  <span class='comment val'># absolute value).  For small y we can use the Taylor series</span>
  <span class='comment val'># expansion</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#    log1p(y) ~ y - y**2/2 + y**3/3 - ... - (-y)**T/T</span>
  <span class='comment val'>#</span>
  <span class='comment val'># truncating at T such that y**T is small enough.  The whole</span>
  <span class='comment val'># computation is carried out in a form of fixed-point arithmetic,</span>
  <span class='comment val'># with a real number z being represented by an integer</span>
  <span class='comment val'># approximation to z*M.  To avoid loss of precision, the y below</span>
  <span class='comment val'># is actually an integer approximation to 2**R*y*M, where R is the</span>
  <span class='comment val'># number of reductions performed so far.</span>

  <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='x identifier id'>x</span><span class='minus op'>-</span><span class='m identifier id'>m</span>
  <span class='comment val'># argument reduction; R = number of reductions performed</span>
  <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='comment val'># while (r &lt;= l &amp;&amp; y.abs &lt;&lt; l-r &gt;= m ||</span>
  <span class='comment val'>#        r &gt; l and y.abs&gt;&gt; r-l &gt;= m)</span>
  <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='r identifier id'>r</span> <span class='leq op'>&lt;=</span> <span class='l identifier id'>l</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span> <span class='lshft op'>&lt;&lt;</span> <span class='lparen token'>(</span><span class='l identifier id'>l</span><span class='minus op'>-</span><span class='r identifier id'>r</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='geq op'>&gt;=</span> <span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='orop op'>||</span>
         <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='r identifier id'>r</span> <span class='gt op'>&gt;</span> <span class='l identifier id'>l</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rshft op'>&gt;&gt;</span><span class='lparen token'>(</span><span class='r identifier id'>r</span><span class='minus op'>-</span><span class='l identifier id'>l</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='geq op'>&gt;=</span> <span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='mult op'>*</span><span class='y identifier id'>y</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='integer val'>1</span><span class='comma token'>,</span>
                       <span class='m identifier id'>m</span> <span class='plus op'>+</span> <span class='_sqrt_nearest identifier id'>_sqrt_nearest</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='plus op'>+</span><span class='_rshift_nearest identifier id'>_rshift_nearest</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='r identifier id'>r</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='r identifier id'>r</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Taylor series with T terms</span>
  <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='integer val'>-10</span><span class='mult op'>*</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='mult op'>*</span><span class='l identifier id'>l</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='yshift identifier id'>yshift</span> <span class='assign token'>=</span> <span class='_rshift_nearest identifier id'>_rshift_nearest</span><span class='lparen token'>(</span><span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='r identifier id'>r</span><span class='rparen token'>)</span>
  <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='t identifier id'>t</span><span class='rparen token'>)</span>
  <span class='comment val'># (1...t).reverse_each do |k| # Ruby 1.9</span>
  <span class='lparen token'>(</span><span class='float val'>1</span><span class='dot3 op'>...</span><span class='t identifier id'>t</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='bitor op'>|</span>
     <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='k identifier id'>k</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='yshift identifier id'>yshift</span><span class='mult op'>*</span><span class='w identifier id'>w</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='w identifier id'>w</span><span class='mult op'>*</span><span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_log10_digits</h3>
</div><div id="_log10_digits-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_log10_digits</span><span class='args'>(p)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given an integer p &gt;= 0, return floor(10**p)*log(10).
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 1147</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L1147">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_log10_digits identifier id'>_log10_digits</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='rparen token'>)</span>
  <span class='comment val'># digits are stored as a string, for quick conversion to</span>
  <span class='comment val'># integer in the case that we've already computed enough</span>
  <span class='comment val'># digits; the stored digits should always be correct</span>
  <span class='comment val'># (truncated, not rounded to nearest).</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;p should be nonnegative&quot;</span> <span class='if if_mod kw'>if</span> <span class='p identifier id'>p</span><span class='lt op'>&lt;</span><span class='integer val'>0</span>
  <span class='if if kw'>if</span> <span class='p identifier id'>p</span> <span class='geq op'>&gt;=</span> <span class='AuxiliarFunctions constant id'>AuxiliarFunctions</span><span class='dot token'>.</span><span class='log10_digits identifier id'>log10_digits</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
      <span class='digits identifier id'>digits</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='comment val'># compute p+3, p+6, p+9, ... digits; continue until at</span>
      <span class='comment val'># least one of the extra digits is nonzero</span>
      <span class='extra identifier id'>extra</span> <span class='assign token'>=</span> <span class='integer val'>3</span>
      <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
        <span class='comment val'># compute p+extra digits, correct to within 1ulp</span>
        <span class='m identifier id'>m</span> <span class='assign token'>=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='plus op'>+</span><span class='extra identifier id'>extra</span><span class='plus op'>+</span><span class='integer val'>2</span><span class='rparen token'>)</span>
        <span class='digits identifier id'>digits</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='_ilog identifier id'>_ilog</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='mult op'>*</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='integer val'>100</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
        <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='digits identifier id'>digits</span><span class='lbrack token'>[</span><span class='minus op'>-</span><span class='extra identifier id'>extra</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='string val'>'0'</span><span class='mult op'>*</span><span class='extra identifier id'>extra</span>
        <span class='extra identifier id'>extra</span> <span class='opasgn op'>+=</span> <span class='integer val'>3</span>
      <span class='end end kw'>end</span>
      <span class='comment val'># keep all reliable digits so far; remove trailing zeros</span>
      <span class='comment val'># and next nonzero digit</span>
      <span class='AuxiliarFunctions constant id'>AuxiliarFunctions</span><span class='dot token'>.</span><span class='log10_digits identifier id'>log10_digits</span> <span class='assign token'>=</span> <span class='digits identifier id'>digits</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/0*$/</span><span class='comma token'>,</span><span class='string val'>''</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='lparen token'>(</span><span class='AuxiliarFunctions constant id'>AuxiliarFunctions</span><span class='dot token'>.</span><span class='log10_digits identifier id'>log10_digits</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='p identifier id'>p</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_log10_lb</h3>
</div><div id="_log10_lb-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_log10_lb</span><span class='args'>(c)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compute a lower bound for 100*log10&#169; for a positive integer c.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 1042</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L1042">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1042
1043
1044
1045
1046</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_log10_lb identifier id'>_log10_lb</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;The argument to _log10_lb should be nonnegative.&quot;</span> <span class='if if_mod kw'>if</span> <span class='c identifier id'>c</span> <span class='leq op'>&lt;=</span> <span class='integer val'>0</span>
    <span class='str_c identifier id'>str_c</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='return return kw'>return</span> <span class='integer val'>100</span><span class='mult op'>*</span><span class='str_c identifier id'>str_c</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='LOG10_LB_CORRECTION constant id'>LOG10_LB_CORRECTION</span><span class='lbrack token'>[</span><span class='str_c identifier id'>str_c</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_number_of_digits</h3>
</div><div id="_number_of_digits-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_number_of_digits</span><span class='args'>(i)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
number of bits in a nonnegative integer
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>TypeError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 1210</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L1210">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1210
1211
1212
1213
1214
1215
1216
1217
1218
1219</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='i identifier id'>i</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span>  <span class='TypeError constant id'>TypeError</span><span class='comma token'>,</span> <span class='string val'>&quot;The argument to _number_of_digits should be nonnegative.&quot;</span> <span class='if if_mod kw'>if</span> <span class='i identifier id'>i</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
  <span class='if if kw'>if</span> <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Fixnum constant id'>Fixnum</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='i identifier id'>i</span> <span class='gt op'>&gt;</span> <span class='NUMBER_OF_DIGITS_MAX_VALID_LOG constant id'>NUMBER_OF_DIGITS_MAX_VALID_LOG</span><span class='rparen token'>)</span>
    <span class='comment val'># for short integers this is faster</span>
    <span class='comment val'># note that here we return 1 for 0</span>
    <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='else else kw'>else</span>
    <span class='lparen token'>(</span><span class='colon3 op'>::</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='log10 identifier id'>log10</span><span class='lparen token'>(</span><span class='i identifier id'>i</span><span class='rparen token'>)</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_rshift_nearest</h3>
</div><div id="_rshift_nearest-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_rshift_nearest</span><span class='args'>(x, shift)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given an integer x and a nonnegative integer shift, return closest integer
to x / 2**shift; use round-to-even in case of a tie.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 947</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L947">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">947
948
949
950
951</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_rshift_nearest identifier id'>_rshift_nearest</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='shift identifier id'>shift</span><span class='rparen token'>)</span>
    <span class='b identifier id'>b</span><span class='comma token'>,</span> <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='integer val'>1</span> <span class='lshft op'>&lt;&lt;</span> <span class='shift identifier id'>shift</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='x identifier id'>x</span> <span class='rshft op'>&gt;&gt;</span> <span class='shift identifier id'>shift</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='q identifier id'>q</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='x identifier id'>x</span> <span class='bitand op'>&amp;</span> <span class='lparen token'>(</span><span class='b identifier id'>b</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='bitand op'>&amp;</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='gt op'>&gt;</span> <span class='b identifier id'>b</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='comment val'>#return q + (2*(x &amp; (b-1)) + (((q&amp;1) &gt; b) ? 1 : 0))</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_sqrt_nearest</h3>
</div><div id="_sqrt_nearest-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_sqrt_nearest</span><span class='args'>(n, a)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Closest integer to the square root of the positive integer n. a is an
initial approximation to the square root. Any positive integer will do for
a, but the closer a is to the square root of n the faster convergence will
be.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 932</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L932">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">932
933
934
935
936
937
938
939
940
941
942
943</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_sqrt_nearest identifier id'>_sqrt_nearest</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='comma token'>,</span> <span class='a identifier id'>a</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='n identifier id'>n</span> <span class='leq op'>&lt;=</span> <span class='integer val'>0</span> <span class='or or kw'>or</span> <span class='a identifier id'>a</span> <span class='leq op'>&lt;=</span> <span class='integer val'>0</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Both arguments to _sqrt_nearest should be positive.&quot;</span>
    <span class='end end kw'>end</span>

    <span class='b identifier id'>b</span><span class='assign token'>=</span><span class='integer val'>0</span>
    <span class='while while kw'>while</span> <span class='a identifier id'>a</span> <span class='neq op'>!=</span> <span class='b identifier id'>b</span>
        <span class='b identifier id'>b</span><span class='comma token'>,</span> <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='a identifier id'>a</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='n identifier id'>n</span><span class='div op'>/</span><span class='a identifier id'>a</span><span class='rshft op'>&gt;&gt;</span><span class='integer val'>1</span> <span class='comment val'># ??</span>
    <span class='end end kw'>end</span>
    <span class='return return kw'>return</span> <span class='a identifier id'>a</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>dexp</h3>
</div><div id="dexp-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>dexp</span><span class='args'>(c, e, p)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compute an approximation to exp(c*10**e), with p decimal places of
precision.
</p>
<p>
Returns integers d, f such that:
</p>
<pre class="code">
  <span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='leq op'>&lt;=</span> <span class='d identifier id'>d</span> <span class='leq op'>&lt;=</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span><span class='comma token'>,</span> <span class='and and kw'>and</span>
  <span class='lparen token'>(</span><span class='d identifier id'>d</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='f identifier id'>f</span> <span class='lt op'>&lt;</span> <span class='exp identifier id'>exp</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='e identifier id'>e</span><span class='rparen token'>)</span> <span class='lt op'>&lt;</span> <span class='lparen token'>(</span><span class='d identifier id'>d</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='f identifier id'>f</span>
</pre>
<p>
In other words, d*10**f is an approximation to exp(c*10**e) with p digits
of precision, and with an error in d of at most 1. This is almost, but not
quite, the same as the error being &lt; 1ulp: when d
</p>
<h1>10**(p-1) the error could be up to 10 ulp.</h1>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 1184</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L1184">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='dexp identifier id'>dexp</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='rparen token'>)</span>
  <span class='comment val'># we'll call iexp with M = 10**(p+2), giving p+3 digits of precision</span>
  <span class='p identifier id'>p</span> <span class='opasgn op'>+=</span> <span class='integer val'>2</span>

  <span class='comment val'># compute log(10) with extra precision = adjusted exponent of c*10**e</span>
  <span class='extra identifier id'>extra</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='e identifier id'>e</span> <span class='plus op'>+</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='max identifier id'>max</span>
  <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='p identifier id'>p</span> <span class='plus op'>+</span> <span class='extra identifier id'>extra</span>

  <span class='comment val'># compute quotient c*10**e/(log(10)) = c*10**(e+q)/(log(10)*10**q),</span>
  <span class='comment val'># rounding down</span>
  <span class='shift identifier id'>shift</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='plus op'>+</span><span class='q identifier id'>q</span>
  <span class='if if kw'>if</span> <span class='shift identifier id'>shift</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
      <span class='cshift identifier id'>cshift</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='shift identifier id'>shift</span>
  <span class='else else kw'>else</span>
      <span class='cshift identifier id'>cshift</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span><span class='div op'>/</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='shift identifier id'>shift</span>
  <span class='end end kw'>end</span>
  <span class='quot identifier id'>quot</span><span class='comma token'>,</span> <span class='rem identifier id'>rem</span> <span class='assign token'>=</span> <span class='cshift identifier id'>cshift</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='_log10_digits identifier id'>_log10_digits</span><span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='comment val'># reduce remainder back to original precision</span>
  <span class='rem identifier id'>rem</span> <span class='assign token'>=</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='rem identifier id'>rem</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='extra identifier id'>extra</span><span class='rparen token'>)</span>

  <span class='comment val'># error in result of _iexp &lt; 1s20;  error after division &lt; 0.62</span>
  <span class='return return kw'>return</span> <span class='_div_nearest identifier id'>_div_nearest</span><span class='lparen token'>(</span><span class='_iexp identifier id'>_iexp</span><span class='lparen token'>(</span><span class='rem identifier id'>rem</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='integer val'>1000</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='quot identifier id'>quot</span> <span class='minus op'>-</span> <span class='p identifier id'>p</span> <span class='plus op'>+</span> <span class='integer val'>3</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>