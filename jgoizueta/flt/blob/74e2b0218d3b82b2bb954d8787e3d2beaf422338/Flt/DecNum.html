<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jgoizueta's flt - Class: Flt::DecNum - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jgoizueta/commits/flt/master" rel="alternate" title="Recent Commits to flt:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jgoizueta", "flt", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jgoizueta", "flt", "74e2b0218d3b82b2bb954d8787e3d2beaf422338", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jgoizueta/flt/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/network">Network</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jgoizueta/flt">Wiki</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jgoizueta/flt">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jgoizueta">jgoizueta</a> / <b><a href="http://github.com/jgoizueta/flt/tree">flt</a></b>        
                <a id="namespaces_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Flt_DecNum">
  <h1>Class: Flt::DecNum</h1>
  <div class="section inheritance">
  <ul>
  <li><a href="../Numeric.html" title="Numeric">Numeric</a></li><ul><li><a href="Num.html" title="Flt::Num">Flt::Num</a></li><ul><li>Flt::DecNum</li>
  </ul></ul></ul>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="DecNum/AuxiliarFunctions.html" title="Flt::DecNum::AuxiliarFunctions">Flt::DecNum::AuxiliarFunctions</a></p>
</div><div class="section docstring">
  <p>
This implementation of DecNum is based on the Decimal module of Python,
written by Eric Price, Facundo Batista, Raymond Hettinger, Aahz and Tim
Peters.
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="BasicContext-constant">BasicContext</dt>
      <dd>DecNum::Context.new(DefaultContext,
:precision=&gt;9, :rounding=&gt;:half_up,
:traps=&gt;[DivisionByZero, Overflow, InvalidOperation, Clamped, Underflow],
:flags=&gt;[])</dd>
    
      <dt id="DefaultContext-constant">DefaultContext</dt>
      <dd>DecNum::Context.new(
:exact=&gt;false, :precision=&gt;28, :rounding=&gt;:half_even,
:emin=&gt; -999999999, :emax=&gt;+999999999,
:flags=&gt;[],
:traps=&gt;[DivisionByZero, Overflow, InvalidOperation],
:ignored_flags=&gt;[],
:capitals=&gt;true,
:clamp=&gt;true)</dd>
    
      <dt id="ExtendedContext-constant">ExtendedContext</dt>
      <dd>DecNum::Context.new(DefaultContext,
:precision=&gt;9, :rounding=&gt;:half_even,
:traps=&gt;[], :flags=&gt;[], :clamp=&gt;false)</dd>
    
  </dl>
</div>
<div class="inherited">
  
  <div>
    <h2>Constants Inherited from <a href="Num.html" title="Flt::Num">Flt::Num</a></h2>
    <p><span class='name'><a href="Num.html#EXCEPTIONS-constant" title="EXCEPTIONS">EXCEPTIONS</a></span>, <span class='name'><a href="Num.html#ROUND_05UP-constant" title="ROUND_05UP">ROUND_05UP</a></span>, <span class='name'><a href="Num.html#ROUND_CEILING-constant" title="ROUND_CEILING">ROUND_CEILING</a></span>, <span class='name'><a href="Num.html#ROUND_DOWN-constant" title="ROUND_DOWN">ROUND_DOWN</a></span>, <span class='name'><a href="Num.html#ROUND_FLOOR-constant" title="ROUND_FLOOR">ROUND_FLOOR</a></span>, <span class='name'><a href="Num.html#ROUND_HALF_DOWN-constant" title="ROUND_HALF_DOWN">ROUND_HALF_DOWN</a></span>, <span class='name'><a href="Num.html#ROUND_HALF_EVEN-constant" title="ROUND_HALF_EVEN">ROUND_HALF_EVEN</a></span>, <span class='name'><a href="Num.html#ROUND_HALF_UP-constant" title="ROUND_HALF_UP">ROUND_HALF_UP</a></span>, <span class='name'><a href="Num.html#ROUND_UP-constant" title="ROUND_UP">ROUND_UP</a></span></p>
  </div>
  
</div>
<div class="clear"></div><div class="included">
  
  <div>
    <h2>Constants Included from <a href="DecNum/AuxiliarFunctions.html" title="Flt::DecNum::AuxiliarFunctions">Flt::DecNum::AuxiliarFunctions</a></h2>
    <p><span class='name'><a href="DecNum/AuxiliarFunctions.html#LOG10_LB_CORRECTION-constant" title="LOG10_LB_CORRECTION">LOG10_LB_CORRECTION</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#NUMBER_OF_DIGITS_MAX_VALID_LOG-constant" title="NUMBER_OF_DIGITS_MAX_VALID_LOG">NUMBER_OF_DIGITS_MAX_VALID_LOG</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
A DecNum value can be defined by:
</p>
<ul>
<li>A String containing a text representation of the number

</li>
<li>An Integer

</li>
<li>A Rational

</li>
<li>A Value of a type for which conversion is defined in the context.

</li>
<li>Another DecNum.

</li>
<li>A sign, coefficient and exponent (either as separate arguments, as an array
or as a Hash with symbolic keys), or a signed coefficient and an exponent.
This is the internal representation of Num, as returned by Num#split. The
sign is +1 for plus and -1 for minus; the coefficient and exponent are
integers, except for special values which are defined by :inf, :nan or
:snan for the exponent.

</li>
</ul>
<p>
An optional Context can be passed after the value-definint argument to
override the current context and options can be passed in a last hash
argument; alternatively context options can be overriden by options of the
hash argument.
</p>
<p>
When the number is defined by a numeric literal (a String), it can be
followed by a symbol that specifies the mode used to convert the literal to
a floating-point value:
</p>
<ul>
<li>:free is currently the default for all cases. The precision of the input
literal (including trailing zeros) is preserved and the precision of the
context is ignored. When the literal is in base 10, (which is the case by
default), the literal is preserved exactly. Otherwise, all significative
digits that can be derived from the literal are generanted, significative
meaning here that if the digit is changed and the value converted back to a
literal of the same base and precision, the original literal will not be
obtained.

</li>
<li>:short is a variation of :free in which only the minimun number of digits
that are necessary to produce the original literal when the value is
converted back with the same original precision.

</li>
<li>:fixed will round and normalize the value to the precision specified by the
context (normalize meaning that exaclty the number of digits specified by
the precision will be generated, even if the original literal has fewer
digits.) This may fail returning NaN (and raising Inexact) if the context
precision is :exact, but not if the floating-point radix is a multiple of
the input base.

</li>
</ul>
<p>
Options that can be passed for construction from literal:
</p>
<ul>
<li>:base is the numeric base of the input, 10 by default.

</li>
</ul>
<p>
The Flt.DecNum() constructor admits the same parameters and can be used as
a shortcut for DecNum creation. Examples:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1000'</span><span class='rparen token'>)</span>                                  <span class='comment val'># -&gt; 0.1000</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.12345'</span><span class='rparen token'>)</span>                                 <span class='comment val'># -&gt; 0.12345</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.2345E-1'</span><span class='rparen token'>)</span>                               <span class='comment val'># -&gt; 0.12345</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1000'</span><span class='comma token'>,</span> <span class='symbol val'>:short</span><span class='rparen token'>)</span>                          <span class='comment val'># -&gt; 0.1000</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1000'</span><span class='comma token'>,</span><span class='symbol val'>:fixed</span><span class='comma token'>,</span> <span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>20</span><span class='rparen token'>)</span>           <span class='comment val'># -&gt; 0.10000000000000000000</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.12345'</span><span class='comma token'>,</span><span class='symbol val'>:fixed</span><span class='comma token'>,</span> <span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>20</span><span class='rparen token'>)</span>          <span class='comment val'># -&gt; 0.12345000000000000000</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.100110E3'</span><span class='comma token'>,</span> <span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>                    <span class='comment val'># -&gt; 4.8</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1E-5'</span><span class='comma token'>,</span> <span class='symbol val'>:free</span><span class='comma token'>,</span> <span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>                 <span class='comment val'># -&gt; 0.016</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1E-5'</span><span class='comma token'>,</span> <span class='symbol val'>:short</span><span class='comma token'>,</span> <span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>                <span class='comment val'># -&gt; 0.02</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1E-5'</span><span class='comma token'>,</span> <span class='symbol val'>:fixed</span><span class='comma token'>,</span> <span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='comma token'>,</span> <span class='symbol val'>:exact=</span><span class='gt op'>&gt;</span><span class='true true kw'>true</span><span class='rparen token'>)</span>  <span class='comment val'># -&gt; 0.015625</span>
  <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1E-5'</span><span class='comma token'>,</span> <span class='symbol val'>:fixed</span><span class='comma token'>,</span> <span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>                <span class='comment val'># -&gt; 0.01562500000000000000000000000</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 136</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L136">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">136
137
138</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#int_div_radix_power-class_method">int_div_radix_power</span><span class='args'>(x, n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Divide by an integral power of the base: x/(radix**n) for x,n integer;
returns an integer.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#int_mult_radix_power-class_method">int_mult_radix_power</span><span class='args'>(x, n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Multiply by an integral power of the base: x*(radix**n) for x,n integer;
returns an integer.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#int_radix_power-class_method">int_radix_power</span><span class='args'>(n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Integral power of the base: radix**n for integer n; returns an integer.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#radix-class_method">radix</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Numerical base of DecNum.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h2>Public Class Methods Inherited from <a href="Num.html" title="Flt::Num">Flt::Num</a></h2>
    <p><span class='name'><a href="Num.html#%5B%5D-class_method" title="[]">[]</a></span>, <span class='name'><a href="Num.html#base_coercible_types-class_method" title="base_coercible_types">base_coercible_types</a></span>, <span class='name'><a href="Num.html#base_conversions-class_method" title="base_conversions">base_conversions</a></span>, <span class='name'><a href="Num.html#Context-class_method" title="Context">Context</a></span>, <span class='name'><a href="Num.html#context-class_method" title="context">context</a></span>, <span class='name'><a href="Num.html#context%3D-class_method" title="context=">context=</a></span>, <span class='name'><a href="Num.html#define_context-class_method" title="define_context">define_context</a></span>, <span class='name'><a href="Num.html#Flags-class_method" title="Flags">Flags</a></span>, <span class='name'><a href="Num.html#infinity-class_method" title="infinity">infinity</a></span>, <span class='name'><a href="Num.html#local_context-class_method" title="local_context">local_context</a></span>, <span class='name'><a href="Num.html#nan-class_method" title="nan">nan</a></span>, <span class='name'><a href="Num.html#Num-class_method" title="Num">Num</a></span>, <span class='name'><a href="Num.html#num_class-class_method" title="num_class">num_class</a></span>, <span class='name'><a href="Num.html#zero-class_method" title="zero">zero</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_ln_exp_bound-instance_method">#_ln_exp_bound</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compute a lower bound for the adjusted exponent of self.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_log10_exp_bound-instance_method">#_log10_exp_bound</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compute a lower bound for the adjusted exponent of self.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_power_exact-instance_method">#_power_exact</span><span class='args'>(other, p)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Attempt to compute self**other exactly Given Decimals self and other and an
integer p, attempt to compute an exact result for the power self**other,
with p digits of precision.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_power_modulo-instance_method">#_power_modulo</span><span class='args'>(other, modulo, context = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Auxiliar Methods Power-modulo: self.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#exp-instance_method">#exp</span><span class='args'>(context = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Exponential function.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ln-instance_method">#ln</span><span class='args'>(context = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the natural (base e) logarithm.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#log10-instance_method">#log10</span><span class='args'>(context = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the base 10 logarithm.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#number_of_digits-instance_method">#number_of_digits</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#power-instance_method">#power</span><span class='args'>(other, modulo = nil, context = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Raises to the power of x, to modulo if given.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h2>Public Instance Methods Inherited from <a href="Num.html" title="Flt::Num">Flt::Num</a></h2>
    <p><span class='name'><a href="Num.html#%25-instance_method" title="%">%</a></span>, <span class='name'><a href="Num.html#%2A-instance_method" title="*">*</a></span>, <span class='name'><a href="Num.html#%2A%2A-instance_method" title="**">**</a></span>, <span class='name'><a href="Num.html#%2B-instance_method" title="+">+</a></span>, <span class='name'><a href="Num.html#%2B%40-instance_method" title="+@">+@</a></span>, <span class='name'><a href="Num.html#--instance_method" title="-">-</a></span>, <span class='name'><a href="Num.html#-%40-instance_method" title="-@">-@</a></span>, <span class='name'><a href="Num.html#%2F-instance_method" title="/">/</a></span>, <span class='name'><a href="Num.html#%3C%3D-instance_method" title="&lt;=">&lt;=</a></span>, <span class='name'><a href="Num.html#%3D%3D-instance_method" title="==">==</a></span>, <span class='name'><a href="Num.html#_abs-instance_method" title="_abs">_abs</a></span>, <span class='name'><a href="Num.html#_check_nans-instance_method" title="_check_nans">_check_nans</a></span>, <span class='name'><a href="Num.html#_fix-instance_method" title="_fix">_fix</a></span>, <span class='name'><a href="Num.html#_fix_nan-instance_method" title="_fix_nan">_fix_nan</a></span>, <span class='name'><a href="Num.html#_neg-instance_method" title="_neg">_neg</a></span>, <span class='name'><a href="Num.html#_pos-instance_method" title="_pos">_pos</a></span>, <span class='name'><a href="Num.html#_rescale-instance_method" title="_rescale">_rescale</a></span>, <span class='name'><a href="Num.html#_watched_rescale-instance_method" title="_watched_rescale">_watched_rescale</a></span>, <span class='name'><a href="Num.html#abs-instance_method" title="abs">abs</a></span>, <span class='name'><a href="Num.html#add-instance_method" title="add">add</a></span>, <span class='name'><a href="Num.html#adjusted_exponent-instance_method" title="adjusted_exponent">adjusted_exponent</a></span>, <span class='name'><a href="Num.html#ceil-instance_method" title="ceil">ceil</a></span>, <span class='name'><a href="Num.html#coefficient-instance_method" title="coefficient">coefficient</a></span>, <span class='name'><a href="Num.html#coerce-instance_method" title="coerce">coerce</a></span>, <span class='name'><a href="Num.html#compare-instance_method" title="compare">compare</a></span>, <span class='name'><a href="Num.html#convert_to-instance_method" title="convert_to">convert_to</a></span>, <span class='name'><a href="Num.html#copy_abs-instance_method" title="copy_abs">copy_abs</a></span>, <span class='name'><a href="Num.html#copy_negate-instance_method" title="copy_negate">copy_negate</a></span>, <span class='name'><a href="Num.html#copy_sign-instance_method" title="copy_sign">copy_sign</a></span>, <span class='name'><a href="Num.html#digits-instance_method" title="digits">digits</a></span>, <span class='name'><a href="Num.html#div-instance_method" title="div">div</a></span>, <span class='name'><a href="Num.html#divide-instance_method" title="divide">divide</a></span>, <span class='name'><a href="Num.html#divide_int-instance_method" title="divide_int">divide_int</a></span>, <span class='name'><a href="Num.html#divmod-instance_method" title="divmod">divmod</a></span>, <span class='name'><a href="Num.html#divrem-instance_method" title="divrem">divrem</a></span>, <span class='name'><a href="Num.html#eql%3F-instance_method" title="eql?">eql?</a></span>, <span class='name'><a href="Num.html#even%3F-instance_method" title="even?">even?</a></span>, <span class='name'><a href="Num.html#exponent-instance_method" title="exponent">exponent</a></span>, <span class='name'><a href="Num.html#finite%3F-instance_method" title="finite?">finite?</a></span>, <span class='name'><a href="Num.html#floor-instance_method" title="floor">floor</a></span>, <span class='name'><a href="Num.html#fma-instance_method" title="fma">fma</a></span>, <span class='name'><a href="Num.html#fractional_exponent-instance_method" title="fractional_exponent">fractional_exponent</a></span>, <span class='name'><a href="Num.html#hash-instance_method" title="hash">hash</a></span>, <span class='name'><a href="Num.html#infinite%3F-instance_method" title="infinite?">infinite?</a></span>, <span class='name'><a href="Num.html#inspect-instance_method" title="inspect">inspect</a></span>, <span class='name'><a href="Num.html#integral%3F-instance_method" title="integral?">integral?</a></span>, <span class='name'><a href="Num.html#integral_exponent-instance_method" title="integral_exponent">integral_exponent</a></span>, <span class='name'><a href="Num.html#integral_significand-instance_method" title="integral_significand">integral_significand</a></span>, <span class='name'><a href="Num.html#logb-instance_method" title="logb">logb</a></span>, <span class='name'><a href="Num.html#minus-instance_method" title="minus">minus</a></span>, <span class='name'><a href="Num.html#modulo-instance_method" title="modulo">modulo</a></span>, <span class='name'><a href="Num.html#multiply-instance_method" title="multiply">multiply</a></span>, <span class='name'><a href="Num.html#nan%3F-instance_method" title="nan?">nan?</a></span>, <span class='name'><a href="Num.html#next_minus-instance_method" title="next_minus">next_minus</a></span>, <span class='name'><a href="Num.html#next_plus-instance_method" title="next_plus">next_plus</a></span>, <span class='name'><a href="Num.html#next_toward-instance_method" title="next_toward">next_toward</a></span>, <span class='name'><a href="Num.html#nonzero%3F-instance_method" title="nonzero?">nonzero?</a></span>, <span class='name'><a href="Num.html#normal%3F-instance_method" title="normal?">normal?</a></span>, <span class='name'><a href="Num.html#normalize-instance_method" title="normalize">normalize</a></span>, <span class='name'><a href="Num.html#num_class-instance_method" title="num_class">num_class</a></span>, <span class='name'><a href="Num.html#number_class-instance_method" title="number_class">number_class</a></span>, <span class='name'><a href="Num.html#odd%3F-instance_method" title="odd?">odd?</a></span>, <span class='name'><a href="Num.html#plus-instance_method" title="plus">plus</a></span>, <span class='name'><a href="Num.html#qnan%3F-instance_method" title="qnan?">qnan?</a></span>, <span class='name'><a href="Num.html#quantize-instance_method" title="quantize">quantize</a></span>, <span class='name'><a href="Num.html#reduce-instance_method" title="reduce">reduce</a></span>, <span class='name'><a href="Num.html#remainder-instance_method" title="remainder">remainder</a></span>, <span class='name'><a href="Num.html#remainder_near-instance_method" title="remainder_near">remainder_near</a></span>, <span class='name'><a href="Num.html#rescale-instance_method" title="rescale">rescale</a></span>, <span class='name'><a href="Num.html#round-instance_method" title="round">round</a></span>, <span class='name'><a href="Num.html#same_quantum%3F-instance_method" title="same_quantum?">same_quantum?</a></span>, <span class='name'><a href="Num.html#scaleb-instance_method" title="scaleb">scaleb</a></span>, <span class='name'><a href="Num.html#scientific_exponent-instance_method" title="scientific_exponent">scientific_exponent</a></span>, <span class='name'><a href="Num.html#sign-instance_method" title="sign">sign</a></span>, <span class='name'><a href="Num.html#snan%3F-instance_method" title="snan?">snan?</a></span>, <span class='name'><a href="Num.html#special%3F-instance_method" title="special?">special?</a></span>, <span class='name'><a href="Num.html#split-instance_method" title="split">split</a></span>, <span class='name'><a href="Num.html#sqrt-instance_method" title="sqrt">sqrt</a></span>, <span class='name'><a href="Num.html#subnormal%3F-instance_method" title="subnormal?">subnormal?</a></span>, <span class='name'><a href="Num.html#subtract-instance_method" title="subtract">subtract</a></span>, <span class='name'><a href="Num.html#to_f-instance_method" title="to_f">to_f</a></span>, <span class='name'><a href="Num.html#to_i-instance_method" title="to_i">to_i</a></span>, <span class='name'><a href="Num.html#to_int_scale-instance_method" title="to_int_scale">to_int_scale</a></span>, <span class='name'><a href="Num.html#to_integral_exact-instance_method" title="to_integral_exact">to_integral_exact</a></span>, <span class='name'><a href="Num.html#to_integral_value-instance_method" title="to_integral_value">to_integral_value</a></span>, <span class='name'><a href="Num.html#to_r-instance_method" title="to_r">to_r</a></span>, <span class='name'><a href="Num.html#to_s-instance_method" title="to_s">to_s</a></span>, <span class='name'><a href="Num.html#truncate-instance_method" title="truncate">truncate</a></span>, <span class='name'><a href="Num.html#ulp-instance_method" title="ulp">ulp</a></span>, <span class='name'><a href="Num.html#zero%3F-instance_method" title="zero?">zero?</a></span></p>
  </div>
  
</div>
<div class="clear"></div><div class="included">
  
  <div>
    <h2>Public Instance Methods Included from <a href="DecNum/AuxiliarFunctions.html" title="Flt::DecNum::AuxiliarFunctions">Flt::DecNum::AuxiliarFunctions</a></h2>
    <p><span class='name'><a href="DecNum/AuxiliarFunctions.html#_dexp-instance_method" title="_dexp">_dexp</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_div_nearest-instance_method" title="_div_nearest">_div_nearest</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_dlog-instance_method" title="_dlog">_dlog</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_dlog10-instance_method" title="_dlog10">_dlog10</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_dpower-instance_method" title="_dpower">_dpower</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_iexp-instance_method" title="_iexp">_iexp</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_ilog-instance_method" title="_ilog">_ilog</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_log10_digits-instance_method" title="_log10_digits">_log10_digits</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_log10_lb-instance_method" title="_log10_lb">_log10_lb</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_number_of_digits-instance_method" title="_number_of_digits">_number_of_digits</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_rshift_nearest-instance_method" title="_rshift_nearest">_rshift_nearest</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#_sqrt_nearest-instance_method" title="_sqrt_nearest">_sqrt_nearest</a></span>, <span class='name'><a href="DecNum/AuxiliarFunctions.html#dexp-instance_method" title="dexp">dexp</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>int_div_radix_power</h3>
</div><div id="int_div_radix_power-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>int_div_radix_power</span><span class='args'>(x, n)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Divide by an integral power of the base: x/(radix**n) for x,n integer;
returns an integer.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 30</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L30">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">30
31
32</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='int_div_radix_power identifier id'>int_div_radix_power</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
  <span class='x identifier id'>x</span> <span class='div op'>/</span> <span class='lparen token'>(</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>int_mult_radix_power</h3>
</div><div id="int_mult_radix_power-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>int_mult_radix_power</span><span class='args'>(x, n)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Multiply by an integral power of the base: x*(radix**n) for x,n integer;
returns an integer.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 24</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L24">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">24
25
26</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='int_mult_radix_power identifier id'>int_mult_radix_power</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
  <span class='x identifier id'>x</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>int_radix_power</h3>
</div><div id="int_radix_power-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>int_radix_power</span><span class='args'>(n)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Integral power of the base: radix**n for integer n; returns an integer.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 18</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L18">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">18
19
20</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
  <span class='integer val'>10</span><span class='pow op'>**</span><span class='n identifier id'>n</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>radix</h3>
</div><div id="radix-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>radix</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Numerical base of DecNum.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 13</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L13">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">13
14
15</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='radix identifier id'>radix</span>
  <span class='integer val'>10</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>_ln_exp_bound</h3>
</div><div id="_ln_exp_bound-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_ln_exp_bound</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compute a lower bound for the adjusted exponent of self.ln(). In other
words, compute r such that self.ln() &gt;= 10**r. Assumes that self is
finite and positive and that self != 1.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 810</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L810">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_ln_exp_bound identifier id'>_ln_exp_bound</span>
  <span class='comment val'># for 0.1 &lt;= x &lt;= 10 we use the inequalities 1-1/x &lt;= ln(x) &lt;= x-1</span>
  <span class='comment val'>#</span>
  <span class='comment val'># The original Python cod used lexical order (having converted to strings) for (num &lt; den))</span>
  <span class='comment val'># so the results would be different e.g. for num = 9m den=200; Can this happen? What is the correct way?</span>

  <span class='adj identifier id'>adj</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span> <span class='plus op'>+</span> <span class='number_of_digits identifier id'>number_of_digits</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
  <span class='if if kw'>if</span> <span class='adj identifier id'>adj</span> <span class='geq op'>&gt;=</span> <span class='integer val'>1</span>
    <span class='comment val'># argument &gt;= 10; we use 23/10 = 2.3 as a lower bound for ln(10)</span>
    <span class='return return kw'>return</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='adj identifier id'>adj</span><span class='mult op'>*</span><span class='integer val'>23</span><span class='div op'>/</span><span class='integer val'>10</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='adj identifier id'>adj</span> <span class='leq op'>&lt;=</span> <span class='integer val'>-2</span>
    <span class='comment val'># argument &lt;= 0.1</span>
    <span class='return return kw'>return</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='minus op'>-</span><span class='adj identifier id'>adj</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>23</span><span class='div op'>/</span><span class='integer val'>10</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>
  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
  <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
  <span class='if if kw'>if</span> <span class='adj identifier id'>adj</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='comment val'># 1 &lt; self &lt; 10</span>
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span><span class='minus op'>-</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='e identifier id'>e</span><span class='rparen token'>)</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
    <span class='return return kw'>return</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='num identifier id'>num</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='den identifier id'>den</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='num identifier id'>num</span> <span class='lt op'>&lt;</span> <span class='den identifier id'>den</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='comment val'># adj == -1, 0.1 &lt;= self &lt; 1</span>
  <span class='return return kw'>return</span> <span class='e identifier id'>e</span> <span class='plus op'>+</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='minus op'>-</span><span class='e identifier id'>e</span> <span class='minus op'>-</span> <span class='c identifier id'>c</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_log10_exp_bound</h3>
</div><div id="_log10_exp_bound-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_log10_exp_bound</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compute a lower bound for the adjusted exponent of self.log10() In other
words, find r such that self.log10() &gt;= 10**r. Assumes that self is
finite and positive and that self != 1.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 780</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L780">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_log10_exp_bound identifier id'>_log10_exp_bound</span>
  <span class='comment val'># For x &gt;= 10 or x &lt; 0.1 we only need a bound on the integer</span>
  <span class='comment val'># part of log10(self), and this comes directly from the</span>
  <span class='comment val'># exponent of x.  For 0.1 &lt;= x &lt;= 10 we use the inequalities</span>
  <span class='comment val'># 1-1/x &lt;= log(x) &lt;= x-1. If x &gt; 1 we have |log10(x)| &gt;</span>
  <span class='comment val'># (1-1/x)/2.31 &gt; 0.  If x &lt; 1 then |log10(x)| &gt; (1-x)/2.31 &gt; 0</span>
  <span class='comment val'>#</span>
  <span class='comment val'># The original Python cod used lexical order (having converted to strings) for (num &lt; den) and (num &lt; 231)</span>
  <span class='comment val'># so the results would be different e.g. for num = 9; Can this happen? What is the correct way?</span>

  <span class='adj identifier id'>adj</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span> <span class='plus op'>+</span> <span class='number_of_digits identifier id'>number_of_digits</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
  <span class='return return kw'>return</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='adj identifier id'>adj</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='adj identifier id'>adj</span> <span class='geq op'>&gt;=</span> <span class='integer val'>1</span> <span class='comment val'># self &gt;= 10</span>
  <span class='return return kw'>return</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='minus op'>-</span><span class='adj identifier id'>adj</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='integer val'>1</span> <span class='if if_mod kw'>if</span> <span class='adj identifier id'>adj</span> <span class='leq op'>&lt;=</span> <span class='integer val'>-2</span> <span class='comment val'># self &lt; 0.1</span>

  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
  <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
  <span class='if if kw'>if</span> <span class='adj identifier id'>adj</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='comment val'># 1 &lt; self &lt; 10</span>
    <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='c identifier id'>c</span> <span class='minus op'>-</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='den identifier id'>den</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='integer val'>231</span><span class='mult op'>*</span><span class='c identifier id'>c</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='num identifier id'>num</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='den identifier id'>den</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='num identifier id'>num</span> <span class='lt op'>&lt;</span> <span class='den identifier id'>den</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='integer val'>2</span>
  <span class='end end kw'>end</span>
  <span class='comment val'># adj == -1, 0.1 &lt;= self &lt; 1</span>
  <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='c identifier id'>c</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='num identifier id'>num</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='e identifier id'>e</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='num identifier id'>num</span> <span class='lt op'>&lt;</span> <span class='integer val'>231</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_power_exact</h3>
</div><div id="_power_exact-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_power_exact</span><span class='args'>(other, p)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Attempt to compute self**other exactly Given Decimals self and other and an
integer p, attempt to compute an exact result for the power self**other,
with p digits of precision. Return nil if self**other is not exactly
representable in p digits.
</p>
<p>
Assumes that elimination of special cases has already been performed: self
and other must both be nonspecial; self must be positive and not
numerically equal to 1; other must be nonzero. For efficiency,
other.exponent should not be too large, so that 10**other.exponent.abs is a
feasible calculation.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 579</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L579">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_power_exact identifier id'>_power_exact</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='rparen token'>)</span>

  <span class='comment val'># In the comments below, we write x for the value of self and</span>
  <span class='comment val'># y for the value of other.  Write x = xc*10**xe and y =</span>
  <span class='comment val'># yc*10**ye.</span>

  <span class='comment val'># The main purpose of this method is to identify the *failure*</span>
  <span class='comment val'># of x**y to be exactly representable with as little effort as</span>
  <span class='comment val'># possible.  So we look for cheap and easy tests that</span>
  <span class='comment val'># eliminate the possibility of x**y being exact.  Only if all</span>
  <span class='comment val'># these tests are passed do we go on to actually compute x**y.</span>

  <span class='comment val'># Here's the main idea.  First normalize both x and y.  We</span>
  <span class='comment val'># express y as a rational m/n, with m and n relatively prime</span>
  <span class='comment val'># and n&gt;0.  Then for x**y to be exactly representable (at</span>
  <span class='comment val'># *any* precision), xc must be the nth power of a positive</span>
  <span class='comment val'># integer and xe must be divisible by n.  If m is negative</span>
  <span class='comment val'># then additionally xc must be a power of either 2 or 5, hence</span>
  <span class='comment val'># a power of 2**n or 5**n.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># There's a limit to how small |y| can be: if y=m/n as above</span>
  <span class='comment val'># then:</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#  (1) if xc != 1 then for the result to be representable we</span>
  <span class='comment val'>#      need xc**(1/n) &gt;= 2, and hence also xc**|y| &gt;= 2.  So</span>
  <span class='comment val'>#      if |y| &lt;= 1/nbits(xc) then xc &lt; 2**nbits(xc) &lt;=</span>
  <span class='comment val'>#      2**(1/|y|), hence xc**|y| &lt; 2 and the result is not</span>
  <span class='comment val'>#      representable.</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#  (2) if xe != 0, |xe|*(1/n) &gt;= 1, so |xe|*|y| &gt;= 1.  Hence if</span>
  <span class='comment val'>#      |y| &lt; 1/|xe| then the result is not representable.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Note that since x is not equal to 1, at least one of (1) and</span>
  <span class='comment val'># (2) must apply.  Now |y| &lt; 1/nbits(xc) iff |yc|*nbits(xc) &lt;</span>
  <span class='comment val'># 10**-ye iff len(str(|yc|*nbits(xc)) &lt;= -ye.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># There's also a limit to how large y can be, at least if it's</span>
  <span class='comment val'># positive: the normalized result will have coefficient xc**y,</span>
  <span class='comment val'># so if it's representable then xc**y &lt; 10**p, and y &lt;</span>
  <span class='comment val'># p/log10(xc).  Hence if y*log10(xc) &gt;= p then the result is</span>
  <span class='comment val'># not exactly representable.</span>

  <span class='comment val'># if len(str(abs(yc*xe)) &lt;= -ye then abs(yc*xe) &lt; 10**-ye,</span>
  <span class='comment val'># so |y| &lt; 1/xe and the result is not representable.</span>
  <span class='comment val'># Similarly, len(str(abs(yc)*xc_bits)) &lt;= -ye implies |y|</span>
  <span class='comment val'># &lt; 1/nbits(xc).</span>

  <span class='xc identifier id'>xc</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
  <span class='xe identifier id'>xe</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
  <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='xc identifier id'>xc</span> <span class='mod op'>%</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='xc identifier id'>xc</span> <span class='opasgn op'>/=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span>
    <span class='xe identifier id'>xe</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>

  <span class='yc identifier id'>yc</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
  <span class='ye identifier id'>ye</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
  <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='yc identifier id'>yc</span> <span class='mod op'>%</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='yc identifier id'>yc</span> <span class='opasgn op'>/=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span>
    <span class='ye identifier id'>ye</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># case where xc == 1: result is 10**(xe*y), with xe*y</span>
  <span class='comment val'># required to be an integer</span>
  <span class='if if kw'>if</span> <span class='xc identifier id'>xc</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
    <span class='if if kw'>if</span> <span class='ye identifier id'>ye</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
      <span class='exponent identifier id'>exponent</span> <span class='assign token'>=</span> <span class='xe identifier id'>xe</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='mult op'>*</span><span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='exponent identifier id'>exponent</span><span class='comma token'>,</span> <span class='remainder identifier id'>remainder</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='xe identifier id'>xe</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='remainder! fid id'>remainder!</span><span class='assign token'>=</span><span class='integer val'>0</span>
    <span class='end end kw'>end</span>
    <span class='exponent identifier id'>exponent</span> <span class='assign token'>=</span> <span class='minus op'>-</span><span class='exponent identifier id'>exponent</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>
    <span class='comment val'># if other is a nonnegative integer, use ideal exponent</span>
    <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span><span class='rparen token'>)</span>
      <span class='ideal_exponent identifier id'>ideal_exponent</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span><span class='mult op'>*</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='zeros identifier id'>zeros</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='exponent identifier id'>exponent</span><span class='minus op'>-</span><span class='ideal_exponent identifier id'>ideal_exponent</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='min identifier id'>min</span>
    <span class='else else kw'>else</span>
      <span class='zeros identifier id'>zeros</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='end end kw'>end</span>
    <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='zeros identifier id'>zeros</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='exponent identifier id'>exponent</span><span class='minus op'>-</span><span class='zeros identifier id'>zeros</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># case where y is negative: xc must be either a power</span>
  <span class='comment val'># of 2 or a power of 5.</span>
  <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>
    <span class='last_digit identifier id'>last_digit</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='xc identifier id'>xc</span> <span class='mod op'>%</span> <span class='integer val'>10</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='lbrack token'>[</span><span class='integer val'>2</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='comma token'>,</span><span class='integer val'>6</span><span class='comma token'>,</span><span class='integer val'>8</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='last_digit identifier id'>last_digit</span><span class='rparen token'>)</span>
      <span class='comment val'># quick test for power of 2</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='xc identifier id'>xc</span> <span class='bitand op'>&amp;</span> <span class='minus op'>-</span><span class='xc identifier id'>xc</span> <span class='neq op'>!=</span> <span class='xc identifier id'>xc</span>
      <span class='comment val'># now xc is a power of 2; e is its exponent</span>
      <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='_nbits identifier id'>_nbits</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='integer val'>1</span>
      <span class='comment val'># find e*y and xe*y; both must be integers</span>
      <span class='if if kw'>if</span> <span class='ye identifier id'>ye</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
        <span class='y_as_int identifier id'>y_as_int</span> <span class='assign token'>=</span> <span class='yc identifier id'>yc</span><span class='mult op'>*</span><span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
        <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='mult op'>*</span><span class='y_as_int identifier id'>y_as_int</span>
        <span class='xe identifier id'>xe</span> <span class='assign token'>=</span> <span class='xe identifier id'>xe</span><span class='mult op'>*</span><span class='y_as_int identifier id'>y_as_int</span>
      <span class='else else kw'>else</span>
        <span class='ten_pow identifier id'>ten_pow</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
        <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='remainder identifier id'>remainder</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='ten_pow identifier id'>ten_pow</span><span class='rparen token'>)</span>
        <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='remainder! fid id'>remainder!</span><span class='assign token'>=</span><span class='integer val'>0</span>
        <span class='xe identifier id'>xe</span><span class='comma token'>,</span> <span class='remainder identifier id'>remainder</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='xe identifier id'>xe</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='ten_pow identifier id'>ten_pow</span><span class='rparen token'>)</span>
        <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='remainder! fid id'>remainder!</span><span class='assign token'>=</span><span class='integer val'>0</span>
      <span class='end end kw'>end</span>

      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='e identifier id'>e</span><span class='mult op'>*</span><span class='integer val'>65</span> <span class='geq op'>&gt;=</span> <span class='p identifier id'>p</span><span class='mult op'>*</span><span class='integer val'>93</span> <span class='comment val'># 93/65 &gt; log(10)/log(5)</span>
      <span class='xc identifier id'>xc</span> <span class='assign token'>=</span> <span class='integer val'>5</span><span class='pow op'>**</span><span class='e identifier id'>e</span>
    <span class='elsif elsif kw'>elsif</span> <span class='last_digit identifier id'>last_digit</span> <span class='eq op'>==</span> <span class='integer val'>5</span>
      <span class='comment val'># e &gt;= log_5(xc) if xc is a power of 5; we have</span>
      <span class='comment val'># equality all the way up to xc=5**2658</span>
      <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='_nbits identifier id'>_nbits</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>28</span><span class='div op'>/</span><span class='integer val'>65</span>
      <span class='xc identifier id'>xc</span><span class='comma token'>,</span> <span class='remainder identifier id'>remainder</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='integer val'>5</span><span class='pow op'>**</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='remainder! fid id'>remainder!</span><span class='assign token'>=</span><span class='integer val'>0</span>
      <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='xc identifier id'>xc</span> <span class='mod op'>%</span> <span class='integer val'>5</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
        <span class='xc identifier id'>xc</span> <span class='opasgn op'>/=</span> <span class='integer val'>5</span>
        <span class='e identifier id'>e</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
      <span class='end end kw'>end</span>
      <span class='if if kw'>if</span> <span class='ye identifier id'>ye</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
        <span class='y_as_integer identifier id'>y_as_integer</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_mult_radix_power identifier id'>int_mult_radix_power</span><span class='lparen token'>(</span><span class='yc identifier id'>yc</span><span class='comma token'>,</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
        <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span><span class='mult op'>*</span><span class='y_as_integer identifier id'>y_as_integer</span>
        <span class='xe identifier id'>xe</span> <span class='assign token'>=</span> <span class='xe identifier id'>xe</span><span class='mult op'>*</span><span class='y_as_integer identifier id'>y_as_integer</span>
      <span class='else else kw'>else</span>
        <span class='ten_pow identifier id'>ten_pow</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
        <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='remainder identifier id'>remainder</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='ten_pow identifier id'>ten_pow</span><span class='rparen token'>)</span>
        <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='remainder identifier id'>remainder</span>
        <span class='xe identifier id'>xe</span><span class='comma token'>,</span> <span class='remainder identifier id'>remainder</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='xe identifier id'>xe</span><span class='mult op'>*</span><span class='yc identifier id'>yc</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='ten_pow identifier id'>ten_pow</span><span class='rparen token'>)</span>
        <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='remainder identifier id'>remainder</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='e identifier id'>e</span><span class='mult op'>*</span><span class='integer val'>3</span> <span class='geq op'>&gt;=</span> <span class='p identifier id'>p</span><span class='mult op'>*</span><span class='integer val'>10</span> <span class='comment val'># 10/3 &gt; log(10)/log(2)</span>
      <span class='xc identifier id'>xc</span> <span class='assign token'>=</span> <span class='integer val'>2</span><span class='pow op'>**</span><span class='e identifier id'>e</span>
    <span class='else else kw'>else</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='xc identifier id'>xc</span> <span class='geq op'>&gt;=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='rparen token'>)</span>
    <span class='xe identifier id'>xe</span> <span class='assign token'>=</span> <span class='minus op'>-</span><span class='e identifier id'>e</span><span class='minus op'>-</span><span class='xe identifier id'>xe</span>
    <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='xc identifier id'>xc</span><span class='comma token'>,</span> <span class='xe identifier id'>xe</span><span class='rparen token'>)</span>

  <span class='end end kw'>end</span>

  <span class='comment val'># now y is positive; find m and n such that y = m/n</span>
  <span class='if if kw'>if</span> <span class='ye identifier id'>ye</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
    <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='yc identifier id'>yc</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='ye identifier id'>ye</span><span class='comma token'>,</span> <span class='integer val'>1</span>
  <span class='else else kw'>else</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='xe identifier id'>xe</span> <span class='neq op'>!=</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='yc identifier id'>yc</span><span class='mult op'>*</span><span class='xe identifier id'>xe</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span> <span class='leq op'>&lt;=</span> <span class='minus op'>-</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
    <span class='xc_bits identifier id'>xc_bits</span> <span class='assign token'>=</span> <span class='_nbits identifier id'>_nbits</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='xc identifier id'>xc</span> <span class='neq op'>!=</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='yc identifier id'>yc</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='mult op'>*</span><span class='xc_bits identifier id'>xc_bits</span><span class='rparen token'>)</span> <span class='leq op'>&lt;=</span> <span class='minus op'>-</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
    <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='yc identifier id'>yc</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='ye identifier id'>ye</span><span class='rparen token'>)</span>
    <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='mod op'>%</span> <span class='integer val'>2</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='n identifier id'>n</span> <span class='mod op'>%</span> <span class='integer val'>2</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='m identifier id'>m</span> <span class='opasgn op'>/=</span> <span class='integer val'>2</span>
      <span class='n identifier id'>n</span> <span class='opasgn op'>/=</span> <span class='integer val'>2</span>
    <span class='end end kw'>end</span>
    <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='mod op'>%</span> <span class='integer val'>5</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='n identifier id'>n</span> <span class='mod op'>%</span> <span class='integer val'>5</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='m identifier id'>m</span> <span class='opasgn op'>/=</span> <span class='integer val'>5</span>
      <span class='n identifier id'>n</span> <span class='opasgn op'>/=</span> <span class='integer val'>5</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># compute nth root of xc*10**xe</span>
  <span class='if if kw'>if</span> <span class='n identifier id'>n</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
    <span class='comment val'># if 1 &lt; xc &lt; 2**n then xc isn't an nth power</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='xc identifier id'>xc</span> <span class='neq op'>!=</span> <span class='integer val'>1</span> <span class='and and kw'>and</span> <span class='xc_bits identifier id'>xc_bits</span> <span class='leq op'>&lt;=</span> <span class='n identifier id'>n</span>

    <span class='xe identifier id'>xe</span><span class='comma token'>,</span> <span class='rem identifier id'>rem</span> <span class='assign token'>=</span> <span class='xe identifier id'>xe</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='rem identifier id'>rem</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>

    <span class='comment val'># compute nth root of xc using Newton's method</span>
    <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='integer val'>1</span> <span class='lshft op'>&lt;&lt;</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='_nbits identifier id'>_nbits</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='n identifier id'>n</span><span class='rparen token'>)</span> <span class='comment val'># initial estimate</span>
    <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
      <span class='q identifier id'>q</span><span class='comma token'>,</span> <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='xc identifier id'>xc</span><span class='dot token'>.</span><span class='divmod identifier id'>divmod</span><span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='a identifier id'>a</span> <span class='leq op'>&lt;=</span> <span class='q identifier id'>q</span>
      <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='q identifier id'>q</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='n identifier id'>n</span>
    <span class='end end kw'>end</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='a identifier id'>a</span> <span class='eq op'>==</span> <span class='q identifier id'>q</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='r identifier id'>r</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='xc identifier id'>xc</span> <span class='assign token'>=</span> <span class='a identifier id'>a</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># now xc*10**xe is the nth root of the original xc*10**xe</span>
  <span class='comment val'># compute mth power of xc*10**xe</span>

  <span class='comment val'># if m &gt; p*100/_log10_lb(xc) then m &gt; p/log10(xc), hence xc**m &gt;</span>
  <span class='comment val'># 10**p and the result is not representable.</span>
  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='xc identifier id'>xc</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='gt op'>&gt;</span> <span class='p identifier id'>p</span><span class='mult op'>*</span><span class='integer val'>100</span><span class='div op'>/</span><span class='_log10_lb identifier id'>_log10_lb</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='xc identifier id'>xc</span> <span class='assign token'>=</span> <span class='xc identifier id'>xc</span><span class='pow op'>**</span><span class='m identifier id'>m</span>
  <span class='xe identifier id'>xe</span> <span class='opasgn op'>*=</span> <span class='m identifier id'>m</span>
  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='xc identifier id'>xc</span> <span class='gt op'>&gt;</span> <span class='integer val'>10</span><span class='pow op'>**</span><span class='p identifier id'>p</span>

  <span class='comment val'># by this point the result *is* exactly representable</span>
  <span class='comment val'># adjust the exponent to get as close as possible to the ideal</span>
  <span class='comment val'># exponent, if necessary</span>
  <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span> <span class='andop op'>&amp;&amp;</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span>
    <span class='ideal_exponent identifier id'>ideal_exponent</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span><span class='mult op'>*</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='zeros identifier id'>zeros</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='xe identifier id'>xe</span><span class='minus op'>-</span><span class='ideal_exponent identifier id'>ideal_exponent</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='minus op'>-</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='min identifier id'>min</span>
  <span class='else else kw'>else</span>
    <span class='zeros identifier id'>zeros</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_mult_radix_power identifier id'>int_mult_radix_power</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='comma token'>,</span> <span class='zeros identifier id'>zeros</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='xe identifier id'>xe</span><span class='minus op'>-</span><span class='zeros identifier id'>zeros</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_power_modulo</h3>
</div><div id="_power_modulo-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_power_modulo</span><span class='args'>(other, modulo, context = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Auxiliar Methods Power-modulo: self._power_modulo(other, modulo) ==
(self**other) % modulo This is equivalent to Python&#8217;s 3-argument
version of pow()
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 520</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L520">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_power_modulo identifier id'>_power_modulo</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='modulo identifier id'>modulo</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>

  <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='define_context identifier id'>define_context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>
  <span class='other identifier id'>other</span> <span class='assign token'>=</span> <span class='_convert identifier id'>_convert</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>
  <span class='modulo identifier id'>modulo</span> <span class='assign token'>=</span> <span class='_convert identifier id'>_convert</span><span class='lparen token'>(</span><span class='third identifier id'>third</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='nan? fid id'>nan?</span> <span class='orop op'>||</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='nan? fid id'>nan?</span> <span class='orop op'>||</span> <span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='nan? fid id'>nan?</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'sNaN'</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='snan? fid id'>snan?</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'sNaN'</span><span class='comma token'>,</span> <span class='other identifier id'>other</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='snan? fid id'>snan?</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'sNaN'</span><span class='comma token'>,</span> <span class='modulo identifier id'>modulo</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='modulo? fid id'>modulo?</span>
    <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='_fix_nan identifier id'>_fix_nan</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='nan? fid id'>nan?</span>
    <span class='return return kw'>return</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='_fix_nan identifier id'>_fix_nan</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='nan? fid id'>nan?</span>
    <span class='return return kw'>return</span> <span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='_fix_nan identifier id'>_fix_nan</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='comment val'># if modulo.nan?</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span> <span class='andop op'>&amp;&amp;</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span> <span class='andop op'>&amp;&amp;</span> <span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'3-argument power not allowed unless all arguments are integers.'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='other identifier id'>other</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'3-argument power cannot have a negative 2nd argument.'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'3-argument power cannot have a 0 3rd argument.'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='adjusted_exponent identifier id'>adjusted_exponent</span> <span class='geq op'>&gt;=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'insufficient precision: power 3rd argument must not have more than precision digits'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>&quot;0**0 not defined&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='sign identifier id'>sign</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='even? fid id'>even?</span> <span class='integer val'>? </span><span class='plus op'>+</span><span class='integer val'>1</span> <span class='colon op'>:</span> <span class='integer val'>-1</span>
  <span class='modulo identifier id'>modulo</span> <span class='assign token'>=</span> <span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span>

  <span class='base identifier id'>base</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span> <span class='mod op'>%</span> <span class='modulo identifier id'>modulo</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span><span class='rparen token'>)</span> <span class='mod op'>%</span> <span class='modulo identifier id'>modulo</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='mod op'>%</span> <span class='modulo identifier id'>modulo</span>

  <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span>
    <span class='base identifier id'>base</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='pow op'>**</span><span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span><span class='rparen token'>)</span> <span class='mod op'>%</span> <span class='modulo identifier id'>modulo</span>
  <span class='end end kw'>end</span>
  <span class='base identifier id'>base</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='pow op'>**</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span><span class='rparen token'>)</span> <span class='mod op'>%</span> <span class='modulo identifier id'>modulo</span>

  <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>exp</h3>
</div><div id="exp-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>exp</span><span class='args'>(context = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Exponential function
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 398</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L398">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='exp identifier id'>exp</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='define_context identifier id'>define_context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>

  <span class='comment val'># exp(NaN) = NaN</span>
  <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='_check_nans identifier id'>_check_nans</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span> <span class='if if_mod kw'>if</span> <span class='ans identifier id'>ans</span>

  <span class='comment val'># exp(-Infinity) = 0</span>
  <span class='return return kw'>return</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='zero identifier id'>zero</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='infinite? fid id'>infinite?</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span><span class='rparen token'>)</span>

  <span class='comment val'># exp(0) = 1</span>
  <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>

  <span class='comment val'># exp(Infinity) = Infinity</span>
  <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='infinite? fid id'>infinite?</span>

  <span class='comment val'># the result is now guaranteed to be inexact (the true</span>
  <span class='comment val'># mathematical result is transcendental). There's no need to</span>
  <span class='comment val'># raise Rounded and Inexact here---they'll always be raised as</span>
  <span class='comment val'># a result of the call to _fix.</span>
  <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='Inexact constant id'>Inexact</span><span class='comma token'>,</span> <span class='string val'>'Inexact exp'</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
  <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
  <span class='adj identifier id'>adj</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='adjusted_exponent identifier id'>adjusted_exponent</span>

  <span class='comment val'># we only need to do any computation for quite a small range</span>
  <span class='comment val'># of adjusted exponents---for example, -29 &lt;= adj &lt;= 10 for</span>
  <span class='comment val'># the default context.  For smaller exponent the result is</span>
  <span class='comment val'># indistinguishable from 1 at the given precision, while for</span>
  <span class='comment val'># larger exponent the result either overflows or underflows.</span>
  <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span> <span class='and and kw'>and</span> <span class='adj identifier id'>adj</span> <span class='gt op'>&gt;</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='emax identifier id'>emax</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>3</span><span class='rparen token'>)</span>
    <span class='comment val'># overflow</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='emax identifier id'>emax</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span> <span class='and and kw'>and</span> <span class='adj identifier id'>adj</span> <span class='gt op'>&gt;</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='etiny identifier id'>etiny</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='integer val'>3</span><span class='rparen token'>)</span>
    <span class='comment val'># underflow to 0</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='etiny identifier id'>etiny</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span> <span class='and and kw'>and</span> <span class='adj identifier id'>adj</span> <span class='lt op'>&lt;</span> <span class='minus op'>-</span><span class='p identifier id'>p</span>
    <span class='comment val'># p+1 digits; final round will raise correct flags</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='rparen token'>)</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='p identifier id'>p</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span> <span class='and and kw'>and</span> <span class='adj identifier id'>adj</span> <span class='lt op'>&lt;</span> <span class='minus op'>-</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span>
    <span class='comment val'># p+1 digits; final round will raise correct flags</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># general case</span>
    <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
    <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
    <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='minus op'>-</span><span class='c identifier id'>c</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>

    <span class='comment val'># compute correctly rounded result: increase precision by</span>
    <span class='comment val'># 3 digits at a time until we get an unambiguously</span>
    <span class='comment val'># roundable result</span>
    <span class='extra identifier id'>extra</span> <span class='assign token'>=</span> <span class='integer val'>3</span>
    <span class='coeff identifier id'>coeff</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
      <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='_dexp identifier id'>_dexp</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='plus op'>+</span><span class='extra identifier id'>extra</span><span class='rparen token'>)</span>
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span> <span class='mod op'>%</span> <span class='lparen token'>(</span><span class='integer val'>5</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='neq op'>!=</span><span class='integer val'>0</span>
      <span class='extra identifier id'>extra</span> <span class='opasgn op'>+=</span> <span class='integer val'>3</span>
    <span class='end end kw'>end</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span> <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># at this stage, ans should round correctly with *any*</span>
  <span class='comment val'># rounding mode, not just with ROUND_HALF_EVEN</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='symbol val'>:half_even</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='local_context identifier id'>local_context</span><span class='bitor op'>|</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='_fix identifier id'>_fix</span><span class='lparen token'>(</span><span class='local_context identifier id'>local_context</span><span class='rparen token'>)</span>
    <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span> <span class='assign token'>=</span> <span class='local_context identifier id'>local_context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ln</h3>
</div><div id="ln-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ln</span><span class='args'>(context = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the natural (base e) logarithm
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 469</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L469">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ln identifier id'>ln</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='define_context identifier id'>define_context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>

  <span class='comment val'># ln(NaN) = NaN</span>
  <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='_check_nans identifier id'>_check_nans</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span> <span class='if if_mod kw'>if</span> <span class='ans identifier id'>ans</span>

  <span class='comment val'># ln(0.0) == -Infinity</span>
  <span class='return return kw'>return</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='infinity identifier id'>infinity</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>

  <span class='comment val'># ln(Infinity) = Infinity</span>
  <span class='return return kw'>return</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='infinity identifier id'>infinity</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='infinite? fid id'>infinite?</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span>

  <span class='comment val'># ln(1.0) == 0.0</span>
  <span class='return return kw'>return</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='zero identifier id'>zero</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span> <span class='eq op'>==</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>

  <span class='comment val'># ln(negative) raises InvalidOperation</span>
  <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'ln of a negative value'</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span><span class='eq op'>==</span><span class='integer val'>-1</span>

  <span class='comment val'># result is irrational, so necessarily inexact</span>
  <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='Inexact constant id'>Inexact</span><span class='comma token'>,</span> <span class='string val'>'Inexact exp'</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>

  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
  <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
  <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>

  <span class='comment val'># correctly rounded result: repeatedly increase precision by 3</span>
  <span class='comment val'># until we get an unambiguously roundable result</span>
  <span class='places identifier id'>places</span> <span class='assign token'>=</span> <span class='p identifier id'>p</span> <span class='minus op'>-</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='_ln_exp_bound identifier id'>_ln_exp_bound</span> <span class='plus op'>+</span> <span class='integer val'>2</span> <span class='comment val'># at least p+3 places</span>
  <span class='coeff identifier id'>coeff</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
    <span class='coeff identifier id'>coeff</span> <span class='assign token'>=</span> <span class='_dlog identifier id'>_dlog</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='places identifier id'>places</span><span class='rparen token'>)</span>
    <span class='comment val'># assert coeff.to_s.length-p &gt;= 1</span>
    <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span> <span class='mod op'>%</span> <span class='lparen token'>(</span><span class='integer val'>5</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
    <span class='places identifier id'>places</span> <span class='opasgn op'>+=</span> <span class='integer val'>3</span>
  <span class='end end kw'>end</span>
  <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span><span class='lt op'>&lt;</span><span class='integer val'>0</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='integer val'>-1</span> <span class='colon op'>:</span> <span class='integer val'>+1</span><span class='comma token'>,</span> <span class='coeff identifier id'>coeff</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='places identifier id'>places</span><span class='rparen token'>)</span>

  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='symbol val'>:half_even</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='local_context identifier id'>local_context</span><span class='bitor op'>|</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='_fix identifier id'>_fix</span><span class='lparen token'>(</span><span class='local_context identifier id'>local_context</span><span class='rparen token'>)</span>
    <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span> <span class='assign token'>=</span> <span class='local_context identifier id'>local_context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>log10</h3>
</div><div id="log10-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>log10</span><span class='args'>(context = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the base 10 logarithm
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 348</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L348">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='log10 identifier id'>log10</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='define_context identifier id'>define_context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>

  <span class='comment val'># log10(NaN) = NaN</span>
  <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='_check_nans identifier id'>_check_nans</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span> <span class='if if_mod kw'>if</span> <span class='ans identifier id'>ans</span>

  <span class='comment val'># log10(0.0) == -Infinity</span>
  <span class='return return kw'>return</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='infinity identifier id'>infinity</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>

  <span class='comment val'># log10(Infinity) = Infinity</span>
  <span class='return return kw'>return</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='infinity identifier id'>infinity</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='infinite? fid id'>infinite?</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span>

  <span class='comment val'># log10(negative or -Infinity) raises InvalidOperation</span>
  <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'log10 of a negative value'</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>

  <span class='digits identifier id'>digits</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='digits identifier id'>digits</span>
  <span class='comment val'># log10(10**n) = n</span>
  <span class='if if kw'>if</span> <span class='digits identifier id'>digits</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='andop op'>&amp;&amp;</span> <span class='digits identifier id'>digits</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='all? fid id'>all?</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='d identifier id'>d</span><span class='bitor op'>|</span> <span class='d identifier id'>d</span><span class='eq op'>==</span><span class='integer val'>0</span><span class='rbrace token'>}</span>
    <span class='comment val'># answer may need rounding</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span> <span class='plus op'>+</span> <span class='digits identifier id'>digits</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># result is irrational, so necessarily inexact</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='Inexact constant id'>Inexact</span><span class='comma token'>,</span> <span class='string val'>&quot;Inexact power&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
    <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
    <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
    <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>

    <span class='comment val'># correctly rounded result: repeatedly increase precision</span>
    <span class='comment val'># until result is unambiguously roundable</span>
    <span class='places identifier id'>places</span> <span class='assign token'>=</span> <span class='p identifier id'>p</span><span class='minus op'>-</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='_log10_exp_bound identifier id'>_log10_exp_bound</span><span class='plus op'>+</span><span class='integer val'>2</span>
    <span class='coeff identifier id'>coeff</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
      <span class='coeff identifier id'>coeff</span> <span class='assign token'>=</span> <span class='_dlog10 identifier id'>_dlog10</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='places identifier id'>places</span><span class='rparen token'>)</span>
      <span class='comment val'># assert coeff.abs.to_s.length-p &gt;= 1</span>
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span> <span class='mod op'>%</span> <span class='lparen token'>(</span><span class='integer val'>5</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='neq op'>!=</span><span class='integer val'>0</span>
      <span class='places identifier id'>places</span> <span class='opasgn op'>+=</span> <span class='integer val'>3</span>
    <span class='end end kw'>end</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span><span class='lt op'>&lt;</span><span class='integer val'>0</span> <span class='question op'>?</span> <span class='integer val'>-1</span> <span class='colon op'>:</span> <span class='integer val'>+1</span><span class='comma token'>,</span> <span class='coeff identifier id'>coeff</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='comma token'>,</span> <span class='minus op'>-</span><span class='places identifier id'>places</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='symbol val'>:half_even</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='local_context identifier id'>local_context</span><span class='bitor op'>|</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='_fix identifier id'>_fix</span><span class='lparen token'>(</span><span class='local_context identifier id'>local_context</span><span class='rparen token'>)</span>
    <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span> <span class='assign token'>=</span> <span class='local_context identifier id'>local_context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>number_of_digits</h3>
</div><div id="number_of_digits-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>number_of_digits</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 140</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L140">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">140
141
142</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='number_of_digits identifier id'>number_of_digits</span>
  <span class='@coeff ivar id'>@coeff</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Integer constant id'>Integer</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='@coeff ivar id'>@coeff</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='integer val'>0</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>power</h3>
</div><div id="power-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>power</span><span class='args'>(other, modulo = nil, context = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Raises to the power of x, to modulo if given.
</p>
<p>
With two arguments, compute self**other. If self is negative then other
must be integral. The result will be inexact unless other is integral and
the result is finite and can be expressed exactly in
&#8216;precision&#8217; digits.
</p>
<p>
With three arguments, compute (self**other) % modulo. For the three
argument form, the following restrictions on the arguments hold:
</p>
<pre class="code">
 <span class='minus op'>-</span> <span class='all identifier id'>all</span> <span class='three identifier id'>three</span> <span class='arguments identifier id'>arguments</span> <span class='must identifier id'>must</span> <span class='be identifier id'>be</span> <span class='integral identifier id'>integral</span>
 <span class='minus op'>-</span> <span class='other identifier id'>other</span> <span class='must identifier id'>must</span> <span class='be identifier id'>be</span> <span class='nonnegative identifier id'>nonnegative</span>
 <span class='minus op'>-</span> <span class='at identifier id'>at</span> <span class='least identifier id'>least</span> <span class='one identifier id'>one</span> <span class='of identifier id'>of</span> <span class='self self kw'>self</span> <span class='or or kw'>or</span> <span class='other identifier id'>other</span> <span class='must identifier id'>must</span> <span class='be identifier id'>be</span> <span class='nonzero identifier id'>nonzero</span>
 <span class='minus op'>-</span> <span class='modulo identifier id'>modulo</span> <span class='must identifier id'>must</span> <span class='be identifier id'>be</span> <span class='nonzero identifier id'>nonzero</span> <span class='and and kw'>and</span> <span class='have identifier id'>have</span> <span class='at identifier id'>at</span> <span class='most identifier id'>most</span> <span class='string val'>'precision'</span> <span class='digits identifier id'>digits</span>
</pre>
<p>
The result of a.power(b, modulo) is identical to the result that would be
obtained by computing (a**b) % modulo with unbounded precision, but is
computed more efficiently. It is always exact.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/dec_num.rb', line 164</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/dec_num.rb#L164">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='power identifier id'>power</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='modulo identifier id'>modulo</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Context constant id'>Context</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='modulo identifier id'>modulo</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='modulo identifier id'>modulo</span>
    <span class='modulo identifier id'>modulo</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='power_modulo identifier id'>power_modulo</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='modulo identifier id'>modulo</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='modulo identifier id'>modulo</span>

  <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='define_context identifier id'>define_context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>
  <span class='other identifier id'>other</span> <span class='assign token'>=</span> <span class='_convert identifier id'>_convert</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='rparen token'>)</span>

  <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='_check_nans identifier id'>_check_nans</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='other identifier id'>other</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span> <span class='if if_mod kw'>if</span> <span class='ans identifier id'>ans</span>

  <span class='comment val'># 0**0 = NaN (!), x**0 = 1 for nonzero x (including +/-Infinity)</span>
  <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
    <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
      <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'0 ** 0'</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># result has sign -1 iff self.sign is -1 and other is an odd integer</span>
  <span class='result_sign identifier id'>result_sign</span> <span class='assign token'>=</span> <span class='integer val'>+1</span>
  <span class='_self identifier id'>_self</span> <span class='assign token'>=</span> <span class='self self kw'>self</span>
  <span class='if if kw'>if</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>
    <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span>
      <span class='result_sign identifier id'>result_sign</span> <span class='assign token'>=</span> <span class='integer val'>-1</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='even? fid id'>even?</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># -ve**noninteger = NaN</span>
      <span class='comment val'># (-0)**noninteger = 0**noninteger</span>
      <span class='unless unless kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
        <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='InvalidOperation constant id'>InvalidOperation</span><span class='comma token'>,</span> <span class='string val'>'x ** y with x negative and y not an integer'</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='comment val'># negate self, without doing any unwanted rounding</span>
    <span class='_self identifier id'>_self</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='copy_negate identifier id'>copy_negate</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># 0**(+ve or Inf)= 0; 0**(-ve or -Inf) = Infinity</span>
  <span class='if if kw'>if</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
    <span class='return return kw'>return</span> <span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='num_class identifier id'>num_class</span><span class='dot token'>.</span><span class='infinity identifier id'>infinity</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Inf**(+ve or Inf) = Inf; Inf**(-ve or -Inf) = 0</span>
  <span class='if if kw'>if</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='infinite? fid id'>infinite?</span>
    <span class='return return kw'>return</span> <span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='num_class identifier id'>num_class</span><span class='dot token'>.</span><span class='infinity identifier id'>infinity</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># 1**other = 1, but the choice of exponent and the flags</span>
  <span class='comment val'># depend on the exponent of self, and on whether other is a</span>
  <span class='comment val'># positive integer, a negative integer, or neither</span>
  <span class='if if kw'>if</span> <span class='_self identifier id'>_self</span> <span class='eq op'>==</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='_self identifier id'>_self</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
    <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span>
      <span class='comment val'># exp = max(self._exp*max(int(other), 0),</span>
      <span class='comment val'># 1-context.prec) but evaluating int(other) directly</span>
      <span class='comment val'># is dangerous until we know other is small (other</span>
      <span class='comment val'># could be 1e999999999)</span>
      <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>
        <span class='multiplier identifier id'>multiplier</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
      <span class='elsif elsif kw'>elsif</span> <span class='other identifier id'>other</span> <span class='gt op'>&gt;</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
        <span class='multiplier identifier id'>multiplier</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
      <span class='else else kw'>else</span>
        <span class='multiplier identifier id'>multiplier</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='end end kw'>end</span>

      <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span> <span class='mult op'>*</span> <span class='multiplier identifier id'>multiplier</span>
      <span class='if if kw'>if</span> <span class='exp identifier id'>exp</span> <span class='lt op'>&lt;</span> <span class='integer val'>1</span><span class='minus op'>-</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
        <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='integer val'>1</span><span class='minus op'>-</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
        <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span> <span class='Rounded constant id'>Rounded</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span> <span class='Rounded constant id'>Rounded</span>
      <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span> <span class='Inexact constant id'>Inexact</span>
      <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='integer val'>1</span><span class='minus op'>-</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># compute adjusted exponent of self</span>
  <span class='self_adj identifier id'>self_adj</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='adjusted_exponent identifier id'>adjusted_exponent</span>

  <span class='comment val'># self ** infinity is infinity if self &gt; 1, 0 if self &lt; 1</span>
  <span class='comment val'># self ** -infinity is infinity if self &lt; 1, 0 if self &gt; 1</span>
  <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='infinite? fid id'>infinite?</span>
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='lparen token'>(</span><span class='self_adj identifier id'>self_adj</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='return return kw'>return</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='infinity identifier id'>infinity</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># from here on, the result always goes through the call</span>
  <span class='comment val'># to _fix at the end of this function.</span>
  <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='comment val'># crude test to catch cases of extreme overflow/underflow.  If</span>
  <span class='comment val'># log10(self)*other &gt;= 10**bound and bound &gt;= len(str(Emax))</span>
  <span class='comment val'># then 10**bound &gt;= 10**len(str(Emax)) &gt;= Emax+1 and hence</span>
  <span class='comment val'># self**other &gt;= 10**(Emax+1), so overflow occurs.  The test</span>
  <span class='comment val'># for underflow is similar.</span>
  <span class='bound identifier id'>bound</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='_log10_exp_bound identifier id'>_log10_exp_bound</span> <span class='plus op'>+</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='adjusted_exponent identifier id'>adjusted_exponent</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='self_adj identifier id'>self_adj</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>+1</span><span class='rparen token'>)</span>
    <span class='comment val'># self &gt; 1 and other +ve, or self &lt; 1 and other -ve</span>
    <span class='comment val'># possibility of overflow</span>
    <span class='if if kw'>if</span> <span class='bound identifier id'>bound</span> <span class='geq op'>&gt;=</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='emax identifier id'>emax</span><span class='rparen token'>)</span>
      <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='emax identifier id'>emax</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># self &gt; 1 and other -ve, or self &lt; 1 and other +ve</span>
    <span class='comment val'># possibility of underflow to 0</span>
    <span class='etiny identifier id'>etiny</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='etiny identifier id'>etiny</span>
    <span class='if if kw'>if</span> <span class='bound identifier id'>bound</span> <span class='geq op'>&gt;=</span> <span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='etiny identifier id'>etiny</span><span class='rparen token'>)</span>
      <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='etiny identifier id'>etiny</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># try for an exact result with precision +1</span>
  <span class='if if kw'>if</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='if if kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
      <span class='if if kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='adjusted_exponent identifier id'>adjusted_exponent</span> <span class='lt op'>&lt;</span> <span class='integer val'>100</span>
        <span class='test_precision identifier id'>test_precision</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span><span class='mult op'>*</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='plus op'>+</span><span class='integer val'>1</span>
      <span class='else else kw'>else</span>
        <span class='test_precision identifier id'>test_precision</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span><span class='plus op'>+</span><span class='integer val'>1</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='test_precision identifier id'>test_precision</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
    <span class='end end kw'>end</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='_power_exact identifier id'>_power_exact</span><span class='lparen token'>(</span><span class='other identifier id'>other</span><span class='comma token'>,</span> <span class='test_precision identifier id'>test_precision</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span><span class='rparen token'>)</span>
      <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='comma token'>,</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span><span class='comma token'>,</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># usual case: inexact result, x**y computed directly as exp(y*log(x))</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='return return kw'>return</span> <span class='ans identifier id'>ans</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
  <span class='else else kw'>else</span>
    <span class='return return kw'>return</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='Inexact constant id'>Inexact</span><span class='comma token'>,</span> <span class='string val'>&quot;Inexact power&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>

    <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
    <span class='xc identifier id'>xc</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
    <span class='xe identifier id'>xe</span> <span class='assign token'>=</span> <span class='_self identifier id'>_self</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
    <span class='yc identifier id'>yc</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span>
    <span class='ye identifier id'>ye</span> <span class='assign token'>=</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span>
    <span class='yc identifier id'>yc</span> <span class='assign token'>=</span> <span class='minus op'>-</span><span class='yc identifier id'>yc</span> <span class='if if_mod kw'>if</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>

    <span class='comment val'># compute correctly rounded result:  start with precision +3,</span>
    <span class='comment val'># then increase precision until result is unambiguously roundable</span>
    <span class='extra identifier id'>extra</span> <span class='assign token'>=</span> <span class='integer val'>3</span>
    <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span>
    <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
      <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='_dpower identifier id'>_dpower</span><span class='lparen token'>(</span><span class='xc identifier id'>xc</span><span class='comma token'>,</span> <span class='xe identifier id'>xe</span><span class='comma token'>,</span> <span class='yc identifier id'>yc</span><span class='comma token'>,</span> <span class='ye identifier id'>ye</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='plus op'>+</span><span class='extra identifier id'>extra</span><span class='rparen token'>)</span>
      <span class='comment val'>#break if (coeff % DecNum.int_mult_radix_power(5,coeff.to_s.length-p-1)) != 0</span>
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span> <span class='mod op'>%</span> <span class='lparen token'>(</span><span class='integer val'>5</span><span class='mult op'>*</span><span class='integer val'>10</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='_number_of_digits identifier id'>_number_of_digits</span><span class='lparen token'>(</span><span class='coeff identifier id'>coeff</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='p identifier id'>p</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
      <span class='extra identifier id'>extra</span> <span class='opasgn op'>+=</span> <span class='integer val'>3</span>
    <span class='end end kw'>end</span>
    <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='result_sign identifier id'>result_sign</span><span class='comma token'>,</span> <span class='coeff identifier id'>coeff</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># the specification says that for non-integer other we need to</span>
  <span class='comment val'># raise Inexact, even when the result is actually exact.  In</span>
  <span class='comment val'># the same way, we need to raise Underflow here if the result</span>
  <span class='comment val'># is subnormal.  (The call to _fix will take care of raising</span>
  <span class='comment val'># Rounded and Subnormal, as usual.)</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='integral? fid id'>integral?</span>
    <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span> <span class='Inexact constant id'>Inexact</span>
    <span class='comment val'># pad with zeros up to length context.precision+1 if necessary</span>
    <span class='if if kw'>if</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span> <span class='leq op'>&lt;=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
      <span class='expdiff identifier id'>expdiff</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span><span class='plus op'>+</span><span class='integer val'>1</span> <span class='minus op'>-</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span>
      <span class='ans identifier id'>ans</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='int_mult_radix_power identifier id'>int_mult_radix_power</span><span class='lparen token'>(</span><span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span><span class='comma token'>,</span> <span class='expdiff identifier id'>expdiff</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='exponent identifier id'>exponent</span><span class='minus op'>-</span><span class='expdiff identifier id'>expdiff</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span> <span class='Underflow constant id'>Underflow</span> <span class='if if_mod kw'>if</span> <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='adjusted_exponent identifier id'>adjusted_exponent</span> <span class='lt op'>&lt;</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='emin identifier id'>emin</span>
  <span class='end end kw'>end</span>
  <span class='comment val'># unlike exp, ln and log10, the power function respects the</span>
  <span class='comment val'># rounding mode; no need to use ROUND_HALF_EVEN here</span>
  <span class='ans identifier id'>ans</span><span class='dot token'>.</span><span class='_fix identifier id'>_fix</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>