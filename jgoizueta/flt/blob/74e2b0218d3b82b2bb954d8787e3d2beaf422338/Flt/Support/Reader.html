<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jgoizueta's flt - Class: Flt::Support::Reader - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jgoizueta/commits/flt/master" rel="alternate" title="Recent Commits to flt:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jgoizueta", "flt", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jgoizueta", "flt", "74e2b0218d3b82b2bb954d8787e3d2beaf422338", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jgoizueta/flt/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/network">Network</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jgoizueta/flt">Wiki</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jgoizueta/flt">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jgoizueta">jgoizueta</a> / <b><a href="http://github.com/jgoizueta/flt/tree">flt</a></b>        
                <a id="namespaces_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Flt_Support_Reader">
  <h1>Class: Flt::Support::Reader</h1>
  <div class="section docstring">
  <p>
Floating-point reading and printing (from/to text literals).
</p>
<p>
Here are methods for floating-point reading using algorithms by William D.
Clinger and printing using algorithms by Robert G. Burger and R. Kent
Dybvig.
</p>
<p>
Reading and printing can also viewed as floating-point conversion betwen a
fixed-precision floating-point format (the floating-point numbers) and and
a free floating-point format (text) which may use different numerical
bases.
</p>
<p>
The Reader class implements, in the default :free mode, converts a
free-form numeric value (as a text literal, i.e. a free floating-point
format, usually in base 10) which is taken as an exact value, to a
correctly-rounded floating-point of specified precision and with a
specified rounding mode. It also has a :fixed mode that uses the Formatter
class indirectly.
</p>
<p>
The Formatter class implements the Burger-Dybvig printing algorithm which
converts a fixed-precision floating point value and produces a text literal
in same base, usually 10, (equivalently, it produces a floating-point
free-format value) so that it rounds back to the original value (with some
specified rounding-mode or any round-to-nearest mode) and with the same
original precision (e.g. using the Clinger algorithm) Clinger algorithms to
read floating point numbers from text literals with correct rounding. from
his paper: &quot;How to Read Floating Point Numbers Accurately&quot;
(William D. Clinger)
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
There are two different reading approaches, selected by the :mode
parameter:
</p>
<ul>
<li>:fixed (the destination context defines the resulting precision) input is
rounded as specified by the context; if the context precision is
&#8216;exact&#8217;, the exact input value will be represented in the
destination base, which can lead to a Inexact exception (or a NaN result
and an Inexact flag)

</li>
<li>:free The input precision is preserved, and the destination context
precision is ignored; in this case the result can be converted back to the
original number (with the same precision) a rounding mode for the back
conversion may be passed; otherwise any round-to-nearest is assumed. (to
increase the precision of the result the input precision must be increased
--adding trailing zeros)

</li>
<li>:short is like :free, but the minumum number of digits that preserve the
original value are generated (with :free, all significant digits are
generated)

</li>
</ul>
<p>
For the fixed mode there are three conversion algorithms available that can
be selected with the :algorithm parameter:
</p>
<ul>
<li>:A Arithmetic algorithm, using correctly rounded Flt::Num arithmetic.

</li>
<li>:M The Clinger Algorithm M is the slowest method, but it was the first
implemented and testes and is kept as a reference for testing.

</li>
<li>:R The Clinger Algorithm R, which requires an initial approximation is
currently only implemented for Float and is the fastest by far.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 400</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L400">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">400
401
402
403
404</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='@exact ivar id'>@exact</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='@algorithm ivar id'>@algorithm</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:algorithm</span><span class='rbrack token'>]</span>
  <span class='@mode ivar id'>@mode</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:mode</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='symbol val'>:fixed</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#float_min_max_adj_exp-class_method">float_min_max_adj_exp</span><span class='args'>(base, normalized = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Minimum &amp; maximum adjusted exponent for numbers in base to be in the
range of Floats.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ratio_float-class_method">ratio_float</span><span class='args'>(context, u, v, k, round_mode)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given exact positive integers u and v with beta**(n-1) &lt;= u/v &lt;
beta**n and exact integer k, returns the floating point number closest to
u/v * beta**n (beta is the floating-point radix).
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_alg_m-instance_method">#_alg_m</span><span class='args'>(context, round_mode, sign, f, e, eb, n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Algorithm M to read floating point numbers from text literals with correct
rounding from his paper: &quot;How to Read Floating Point Numbers
Accurately&quot; (William D.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_alg_r-instance_method">#_alg_r</span><span class='args'>(z0, context, round_mode, sign, f, e, eb, n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#_alg_r_approx-instance_method">#_alg_r_approx</span><span class='args'>(context, round_mode, sign, f, e, eb, n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#compare-instance_method">#compare</span><span class='args'>(m, x, y, context)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#exact-3F-instance_method">#exact?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#read-instance_method">#read</span><span class='args'>(context, round_mode, sign, f, e, eb = 10)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given exact integers f and e, with f nonnegative, returns the
floating-point number closest to f * eb**e (eb is the input radix).
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>float_min_max_adj_exp</h3>
</div><div id="float_min_max_adj_exp-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>float_min_max_adj_exp</span><span class='args'>(base, normalized = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Minimum &amp; maximum adjusted exponent for numbers in base to be in the
range of Floats
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 587</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L587">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">587
588
589
590
591
592
593
594
595
596
597</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='float_min_max_adj_exp identifier id'>float_min_max_adj_exp</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='comma token'>,</span> <span class='normalized identifier id'>normalized</span><span class='assign token'>=</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='normalized identifier id'>normalized</span> <span class='integer val'>? </span><span class='base identifier id'>base</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='base identifier id'>base</span>
  <span class='unless unless kw'>unless</span> <span class='min_max identifier id'>min_max</span> <span class='assign token'>=</span> <span class='@float_min_max_exp_values ivar id'>@float_min_max_exp_values</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span>
    <span class='max_exp identifier id'>max_exp</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='MAX constant id'>MAX</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span>
    <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='MIN_EXP constant id'>MIN_EXP</span>
    <span class='e identifier id'>e</span> <span class='opasgn op'>-=</span> <span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='MANT_DIG constant id'>MANT_DIG</span> <span class='unless unless_mod kw'>unless</span> <span class='normalized identifier id'>normalized</span>
    <span class='min_exp identifier id'>min_exp</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='mult op'>*</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='RADIX constant id'>RADIX</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span>
    <span class='@float_min_max_exp_values ivar id'>@float_min_max_exp_values</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='min_max identifier id'>min_max</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='min_exp identifier id'>min_exp</span><span class='comma token'>,</span> <span class='max_exp identifier id'>max_exp</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='min_max identifier id'>min_max</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='exp identifier id'>exp</span><span class='bitor op'>|</span> <span class='exp identifier id'>exp</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rbrace token'>}</span> <span class='comment val'># adjust</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ratio_float</h3>
</div><div id="ratio_float-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ratio_float</span><span class='args'>(context, u, v, k, round_mode)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given exact positive integers u and v with beta**(n-1) &lt;= u/v &lt;
beta**n and exact integer k, returns the floating point number closest to
u/v * beta**n (beta is the floating-point radix)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 750</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L750">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='ratio_float identifier id'>ratio_float</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='u identifier id'>u</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='comma token'>,</span> <span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='rparen token'>)</span>
  <span class='comment val'># since this handles only positive numbers and ceiling and floor</span>
  <span class='comment val'># are not symmetrical, they should have been swapped before calling this.</span>
  <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='div identifier id'>div</span> <span class='v identifier id'>v</span>
  <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='u identifier id'>u</span><span class='minus op'>-</span><span class='q identifier id'>q</span><span class='mult op'>*</span><span class='v identifier id'>v</span>
  <span class='v_r identifier id'>v_r</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span><span class='minus op'>-</span><span class='r identifier id'>r</span>
  <span class='z identifier id'>z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='integer val'>+1</span><span class='comma token'>,</span><span class='q identifier id'>q</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='rparen token'>)</span>
  <span class='exact identifier id'>exact</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='r identifier id'>r</span><span class='eq op'>==</span><span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='round_mode identifier id'>round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:down</span>
    <span class='comment val'># z = z</span>
  <span class='elsif elsif kw'>elsif</span> <span class='lparen token'>(</span><span class='round_mode identifier id'>round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:up</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='r identifier id'>r</span><span class='gt op'>&gt;</span><span class='integer val'>0</span>
    <span class='z identifier id'>z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='lparen token'>(</span><span class='z identifier id'>z</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='r identifier id'>r</span><span class='lt op'>&lt;</span><span class='v_r identifier id'>v_r</span>
    <span class='comment val'># z = z</span>
  <span class='elsif elsif kw'>elsif</span> <span class='r identifier id'>r</span><span class='gt op'>&gt;</span><span class='v_r identifier id'>v_r</span>
    <span class='z identifier id'>z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='lparen token'>(</span><span class='z identifier id'>z</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># tie</span>
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='round_mode identifier id'>round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:half_down</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='round_mode identifier id'>round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:half_even</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='q identifier id'>q</span><span class='mod op'>%</span><span class='integer val'>2</span><span class='rparen token'>)</span><span class='eq op'>==</span><span class='integer val'>0</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='round_mode identifier id'>round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:down</span><span class='rparen token'>)</span>
       <span class='comment val'># z = z</span>
    <span class='else else kw'>else</span>
      <span class='z identifier id'>z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='lparen token'>(</span><span class='z identifier id'>z</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='z identifier id'>z</span><span class='comma token'>,</span> <span class='exact identifier id'>exact</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>_alg_m</h3>
</div><div id="_alg_m-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_alg_m</span><span class='args'>(context, round_mode, sign, f, e, eb, n)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Algorithm M to read floating point numbers from text literals with correct
rounding from his paper: &quot;How to Read Floating Point Numbers
Accurately&quot; (William D. Clinger)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 709</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L709">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_alg_m identifier id'>_alg_m</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='n identifier id'>n</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='e identifier id'>e</span><span class='lt op'>&lt;</span><span class='integer val'>0</span>
   <span class='u identifier id'>u</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='comma token'>,</span><span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='f identifier id'>f</span><span class='comma token'>,</span><span class='eb identifier id'>eb</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span><span class='integer val'>0</span>
  <span class='else else kw'>else</span>
    <span class='u identifier id'>u</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='comma token'>,</span><span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='f identifier id'>f</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='eb identifier id'>eb</span><span class='pow op'>**</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>0</span>
  <span class='end end kw'>end</span>
  <span class='min_e identifier id'>min_e</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='etiny identifier id'>etiny</span>
  <span class='max_e identifier id'>max_e</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='etop identifier id'>etop</span>
  <span class='rp_n identifier id'>rp_n</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span>
  <span class='rp_n_1 identifier id'>rp_n_1</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span>
  <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
     <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='div identifier id'>div</span><span class='lparen token'>(</span><span class='v identifier id'>v</span><span class='rparen token'>)</span> <span class='comment val'># bottleneck</span>
     <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='geq op'>&gt;=</span><span class='rp_n_1 identifier id'>rp_n_1</span> <span class='andop op'>&amp;&amp;</span> <span class='x identifier id'>x</span><span class='lt op'>&lt;</span><span class='rp_n identifier id'>rp_n</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='k identifier id'>k</span><span class='eq op'>==</span><span class='min_e identifier id'>min_e</span> <span class='orop op'>||</span> <span class='k identifier id'>k</span><span class='eq op'>==</span><span class='max_e identifier id'>max_e</span>
        <span class='z identifier id'>z</span><span class='comma token'>,</span> <span class='exact identifier id'>exact</span> <span class='assign token'>=</span> <span class='Reader constant id'>Reader</span><span class='dot token'>.</span><span class='ratio_float identifier id'>ratio_float</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span><span class='u identifier id'>u</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='round_mode identifier id'>round_mode</span><span class='rparen token'>)</span>
        <span class='@exact ivar id'>@exact</span> <span class='assign token'>=</span> <span class='exact identifier id'>exact</span>
        <span class='if if kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:exception</span><span class='rparen token'>)</span>
          <span class='if if kw'>if</span> <span class='k identifier id'>k</span><span class='eq op'>==</span><span class='min_e identifier id'>min_e</span>
            <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='Num constant id'>Num</span><span class='colon2 op'>::</span><span class='Subnormal constant id'>Subnormal</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='z identifier id'>z</span><span class='dot token'>.</span><span class='subnormal? fid id'>subnormal?</span>
            <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='Num constant id'>Num</span><span class='colon2 op'>::</span><span class='Underflow constant id'>Underflow</span><span class='comma token'>,</span><span class='string val'>&quot;Input literal out of range&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='z identifier id'>z</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span> <span class='andop op'>&amp;&amp;</span> <span class='f! fid id'>f!</span><span class='assign token'>=</span><span class='integer val'>0</span>
          <span class='elsif elsif kw'>elsif</span> <span class='k identifier id'>k</span><span class='eq op'>==</span><span class='max_e identifier id'>max_e</span>
            <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span> <span class='andop op'>&amp;&amp;</span> <span class='z identifier id'>z</span><span class='dot token'>.</span><span class='coefficient identifier id'>coefficient</span> <span class='gt op'>&gt;</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='maximum_coefficient identifier id'>maximum_coefficient</span>
              <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span><span class='lparen token'>(</span><span class='Num constant id'>Num</span><span class='colon2 op'>::</span><span class='Overflow constant id'>Overflow</span><span class='comma token'>,</span><span class='string val'>&quot;Input literal out of range&quot;</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
          <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exception identifier id'>exception</span> <span class='Num constant id'>Num</span><span class='colon2 op'>::</span><span class='Inexact constant id'>Inexact</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='exact identifier id'>exact</span>
        <span class='end end kw'>end</span>
        <span class='return return kw'>return</span> <span class='z identifier id'>z</span><span class='dot token'>.</span><span class='copy_sign identifier id'>copy_sign</span><span class='lparen token'>(</span><span class='sign identifier id'>sign</span><span class='rparen token'>)</span>
     <span class='elsif elsif kw'>elsif</span> <span class='x identifier id'>x</span><span class='lt op'>&lt;</span><span class='rp_n_1 identifier id'>rp_n_1</span>
       <span class='u identifier id'>u</span> <span class='opasgn op'>*=</span> <span class='r identifier id'>r</span>
       <span class='k identifier id'>k</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>
     <span class='elsif elsif kw'>elsif</span> <span class='x identifier id'>x</span><span class='geq op'>&gt;=</span><span class='rp_n identifier id'>rp_n</span>
       <span class='v identifier id'>v</span> <span class='opasgn op'>*=</span> <span class='r identifier id'>r</span>
       <span class='k identifier id'>k</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
     <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_alg_r</h3>
</div><div id="_alg_r-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_alg_r</span><span class='args'>(z0, context, round_mode, sign, f, e, eb, n)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 552</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L552">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_alg_r identifier id'>_alg_r</span><span class='lparen token'>(</span><span class='z0 identifier id'>z0</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='n identifier id'>n</span><span class='rparen token'>)</span> <span class='comment val'># Fast for Float</span>
  <span class='comment val'>#raise InvalidArgument, &quot;Reader Algorithm R only supports base 2&quot; if context.radix != 2</span>

  <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='z0 identifier id'>z0</span>
  <span class='@r ivar id'>@r</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span>
  <span class='@rp_n_1 ivar id'>@rp_n_1</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='int_radix_power identifier id'>int_radix_power</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='@round_mode ivar id'>@round_mode</span> <span class='assign token'>=</span> <span class='round_mode identifier id'>round_mode</span>

  <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
    <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='k identifier id'>k</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='to_int_scale identifier id'>to_int_scale</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
    <span class='comment val'># TODO: replace call to compare by setting the parameters in local variables,</span>
    <span class='comment val'>#       then insert the body of compare here;</span>
    <span class='comment val'>#       then eliminate innecesary instance variables</span>
    <span class='if if kw'>if</span> <span class='e identifier id'>e</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span> <span class='k identifier id'>k</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
      <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='compare identifier id'>compare</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='mult op'>*</span><span class='eb identifier id'>eb</span><span class='pow op'>**</span><span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='mult op'>*</span><span class='@r ivar id'>@r</span><span class='pow op'>**</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='context identifier id'>context</span>
    <span class='elsif elsif kw'>elsif</span> <span class='e identifier id'>e</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span> <span class='k identifier id'>k</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
      <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='compare identifier id'>compare</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='mult op'>*</span><span class='eb identifier id'>eb</span><span class='pow op'>**</span><span class='e identifier id'>e</span><span class='mult op'>*</span><span class='@r ivar id'>@r</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='k identifier id'>k</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='context identifier id'>context</span>
    <span class='elsif elsif kw'>elsif</span> <span class='e identifier id'>e</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span> <span class='k identifier id'>k</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
      <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='compare identifier id'>compare</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='mult op'>*</span><span class='@r ivar id'>@r</span><span class='pow op'>**</span><span class='k identifier id'>k</span><span class='mult op'>*</span><span class='eb identifier id'>eb</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='context identifier id'>context</span>
    <span class='else else kw'>else</span> <span class='comment val'># e &lt; 0 &amp;&amp; k &lt; 0</span>
      <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='compare identifier id'>compare</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='mult op'>*</span><span class='@r ivar id'>@r</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='k identifier id'>k</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='mult op'>*</span><span class='eb identifier id'>eb</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='context identifier id'>context</span>
    <span class='end end kw'>end</span>
    <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='ret identifier id'>ret</span>
  <span class='end end kw'>end</span>
  <span class='ret identifier id'>ret</span> <span class='andop op'>&amp;&amp;</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='copy_sign identifier id'>copy_sign</span><span class='lparen token'>(</span><span class='ret identifier id'>ret</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='rparen token'>)</span> <span class='comment val'># TODO: normalize?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_alg_r_approx</h3>
</div><div id="_alg_r_approx-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_alg_r_approx</span><span class='args'>(context, round_mode, sign, f, e, eb, n)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 501</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L501">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='_alg_r_approx identifier id'>_alg_r_approx</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='n identifier id'>n</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span> <span class='neq op'>!=</span> <span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='RADIX constant id'>RADIX</span> <span class='orop op'>||</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span> <span class='orop op'>||</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='gt op'>&gt;</span> <span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='MANT_DIG constant id'>MANT_DIG</span>

  <span class='comment val'># Compute initial approximation; if Float uses IEEE-754 binary arithmetic, the approximation</span>
  <span class='comment val'># is good enough to be adjusted in just one step.</span>
  <span class='@good_approx ivar id'>@good_approx</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>

  <span class='ndigits identifier id'>ndigits</span> <span class='assign token'>=</span> <span class='Support constant id'>Support</span><span class='colon2 op'>::</span><span class='AuxiliarFunctions constant id'>AuxiliarFunctions</span><span class='dot token'>.</span><span class='_ndigits identifier id'>_ndigits</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='rparen token'>)</span>
  <span class='adj_exp identifier id'>adj_exp</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span> <span class='plus op'>+</span> <span class='ndigits identifier id'>ndigits</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
  <span class='min_exp identifier id'>min_exp</span><span class='comma token'>,</span> <span class='max_exp identifier id'>max_exp</span> <span class='assign token'>=</span> <span class='Reader constant id'>Reader</span><span class='dot token'>.</span><span class='float_min_max_adj_exp identifier id'>float_min_max_adj_exp</span><span class='lparen token'>(</span><span class='eb identifier id'>eb</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='adj_exp identifier id'>adj_exp</span> <span class='geq op'>&gt;=</span> <span class='min_exp identifier id'>min_exp</span> <span class='andop op'>&amp;&amp;</span> <span class='adj_exp identifier id'>adj_exp</span> <span class='leq op'>&lt;=</span> <span class='max_exp identifier id'>max_exp</span>
    <span class='if if kw'>if</span> <span class='eb identifier id'>eb</span><span class='eq op'>==</span><span class='integer val'>2</span>
      <span class='z0 identifier id'>z0</span> <span class='assign token'>=</span> <span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='ldexp identifier id'>ldexp</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='comma token'>,</span><span class='e identifier id'>e</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='eb identifier id'>eb</span><span class='eq op'>==</span><span class='integer val'>10</span>
      <span class='unless unless kw'>unless</span> <span class='Flt constant id'>Flt</span><span class='dot token'>.</span><span class='float_correctly_rounded? fid id'>float_correctly_rounded?</span>
        <span class='min_exp_norm identifier id'>min_exp_norm</span><span class='comma token'>,</span> <span class='max_exp_norm identifier id'>max_exp_norm</span> <span class='assign token'>=</span> <span class='Reader constant id'>Reader</span><span class='dot token'>.</span><span class='float_min_max_adj_exp identifier id'>float_min_max_adj_exp</span><span class='lparen token'>(</span><span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
        <span class='@good_approx ivar id'>@good_approx</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
        <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='e identifier id'>e</span> <span class='leq op'>&lt;=</span> <span class='min_exp_norm identifier id'>min_exp_norm</span>
      <span class='end end kw'>end</span>
      <span class='z0 identifier id'>z0</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{f}E#{e}&quot;</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='ff identifier id'>ff</span> <span class='assign token'>=</span> <span class='f identifier id'>f</span>
      <span class='ee identifier id'>ee</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span>
      <span class='min_exp_norm identifier id'>min_exp_norm</span><span class='comma token'>,</span> <span class='max_exp_norm identifier id'>max_exp_norm</span> <span class='assign token'>=</span> <span class='Reader constant id'>Reader</span><span class='dot token'>.</span><span class='float_min_max_adj_exp identifier id'>float_min_max_adj_exp</span><span class='lparen token'>(</span><span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='e identifier id'>e</span> <span class='leq op'>&lt;=</span> <span class='min_exp_norm identifier id'>min_exp_norm</span>
        <span class='comment val'># avoid loss of precision due to gradual underflow</span>
        <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='e identifier id'>e</span> <span class='leq op'>&lt;=</span> <span class='min_exp identifier id'>min_exp</span>
        <span class='@good_approx ivar id'>@good_approx</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
        <span class='ff identifier id'>ff</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='eb identifier id'>eb</span><span class='rparen token'>)</span><span class='pow op'>**</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='minus op'>-</span><span class='min_exp_norm identifier id'>min_exp_norm</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span>
        <span class='ee identifier id'>ee</span> <span class='assign token'>=</span> <span class='min_exp_norm identifier id'>min_exp_norm</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
      <span class='end end kw'>end</span>
      <span class='comment val'># if ee &lt; 0</span>
      <span class='comment val'>#   z0 = Float(ff)/Float(eb**(-ee))</span>
      <span class='comment val'># else</span>
      <span class='comment val'>#   z0 = Float(ff)*Float(eb**ee)</span>
      <span class='comment val'># end</span>
      <span class='z0 identifier id'>z0</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='ff identifier id'>ff</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='eb identifier id'>eb</span><span class='rparen token'>)</span><span class='pow op'>**</span><span class='ee identifier id'>ee</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='z0 identifier id'>z0</span> <span class='andop op'>&amp;&amp;</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='num_class identifier id'>num_class</span> <span class='neq op'>!=</span> <span class='Float constant id'>Float</span>
      <span class='@good_approx ivar id'>@good_approx</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
      <span class='z0 identifier id'>z0</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='z0 identifier id'>z0</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='plus identifier id'>plus</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='comment val'># context.plus(z0) ?</span>
    <span class='else else kw'>else</span>
      <span class='z0 identifier id'>z0</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='z0 identifier id'>z0</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>compare</h3>
</div><div id="compare-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>compare</span><span class='args'>(m, x, y, context)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 600</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L600">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='compare identifier id'>compare</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='rparen token'>)</span>
  <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='d identifier id'>d</span> <span class='assign token'>=</span> <span class='x identifier id'>x</span><span class='minus op'>-</span><span class='y identifier id'>y</span>
  <span class='d2 identifier id'>d2</span> <span class='assign token'>=</span> <span class='integer val'>2</span><span class='mult op'>*</span><span class='m identifier id'>m</span><span class='mult op'>*</span><span class='d identifier id'>d</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span>

  <span class='comment val'># v = f*eb**e is the number to be approximated</span>
  <span class='comment val'># z = m*@r**k is the current aproximation</span>
  <span class='comment val'># the error of @z is eps = abs(v-z) = 1/2 * d2 / y</span>
  <span class='comment val'># we have x, y integers such that x/y = v/z</span>
  <span class='comment val'># so eps &lt; 1/2 &lt;=&gt; d2 &lt; y</span>
  <span class='comment val'>#    d &lt; 0 &lt;=&gt; x &lt; y &lt;=&gt; v &lt; z</span>

  <span class='directed_rounding identifier id'>directed_rounding</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='symbol val'>:up</span><span class='comma token'>,</span> <span class='symbol val'>:down</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='@round_mode ivar id'>@round_mode</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='directed_rounding identifier id'>directed_rounding</span>
    <span class='if if kw'>if</span> <span class='@round_mode ivar id'>@round_mode</span><span class='eq op'>==</span><span class='symbol val'>:up</span> <span class='question op'>?</span> <span class='lparen token'>(</span><span class='d identifier id'>d</span> <span class='leq op'>&lt;=</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='lparen token'>(</span><span class='d identifier id'>d</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='comment val'># v &lt;(=) z</span>
      <span class='chk identifier id'>chk</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='eq op'>==</span> <span class='@rp_n_1 ivar id'>@rp_n_1</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='d2 identifier id'>d2</span><span class='mult op'>*</span><span class='@r ivar id'>@r</span> <span class='colon op'>:</span> <span class='d2 identifier id'>d2</span>
      <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='@round_mode ivar id'>@round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:up</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='chk identifier id'>chk</span> <span class='lt op'>&lt;</span> <span class='integer val'>2</span><span class='mult op'>*</span><span class='y identifier id'>y</span><span class='rparen token'>)</span>
        <span class='comment val'># eps &lt; 1</span>
        <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='@z ivar id'>@z</span>
      <span class='else else kw'>else</span>
        <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span> <span class='comment val'># @round_mode==:up ? (d &gt; 0) : (d &gt;= 0)</span>
      <span class='comment val'># v &gt;(=) z</span>
      <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='@round_mode ivar id'>@round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:down</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='d2 identifier id'>d2</span> <span class='lt op'>&lt;</span> <span class='integer val'>2</span><span class='mult op'>*</span><span class='y identifier id'>y</span><span class='rparen token'>)</span>
        <span class='comment val'># eps &lt; 1</span>
        <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='@z ivar id'>@z</span>
      <span class='else else kw'>else</span>
        <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='if if kw'>if</span> <span class='d2 identifier id'>d2</span> <span class='lt op'>&lt;</span> <span class='y identifier id'>y</span> <span class='comment val'># eps &lt; 1/2</span>
      <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='eq op'>==</span> <span class='@rp_n_1 ivar id'>@rp_n_1</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='d identifier id'>d</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='y identifier id'>y</span> <span class='lt op'>&lt;</span> <span class='@r ivar id'>@r</span><span class='mult op'>*</span><span class='d2 identifier id'>d2</span><span class='rparen token'>)</span>
        <span class='comment val'># z has the minimum normalized significand, i.e. is a power of @r</span>
        <span class='comment val'># and v &lt; z</span>
        <span class='comment val'># and @r*eps &gt; 1/2</span>
        <span class='comment val'># On the left of z the ulp is 1/@r than the ulp on the right; if v &lt; z we</span>
        <span class='comment val'># must require an error @r times smaller.</span>
        <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='comment val'># unambiguous nearest</span>
        <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='@z ivar id'>@z</span>
      <span class='end end kw'>end</span>
    <span class='elsif elsif kw'>elsif</span> <span class='d2 identifier id'>d2</span> <span class='eq op'>==</span> <span class='y identifier id'>y</span> <span class='comment val'># eps == 1/2</span>
      <span class='comment val'># round-to-nearest tie</span>
      <span class='if if kw'>if</span> <span class='@round_mode ivar id'>@round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:half_even</span>
        <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='mod op'>%</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
          <span class='comment val'># m is even</span>
          <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='eq op'>==</span> <span class='@rp_n_1 ivar id'>@rp_n_1</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='d identifier id'>d</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
            <span class='comment val'># z is power of @r and v &lt; z; this wasn't really a tie because</span>
            <span class='comment val'># there are closer values on the left</span>
            <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='comment val'># m is even =&gt; round tie to z</span>
            <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='@z ivar id'>@z</span>
          <span class='end end kw'>end</span>
        <span class='elsif elsif kw'>elsif</span> <span class='d identifier id'>d</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
          <span class='comment val'># m is odd, v &lt; z =&gt; round tie to prev</span>
          <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
        <span class='elsif elsif kw'>elsif</span> <span class='d identifier id'>d</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
          <span class='comment val'># m is odd, v &gt; z =&gt; round tie to next</span>
          <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='elsif elsif kw'>elsif</span> <span class='@round_mode ivar id'>@round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:half_up</span>
        <span class='if if kw'>if</span> <span class='d identifier id'>d</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
          <span class='comment val'># v &lt; z</span>
          <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='eq op'>==</span> <span class='@rp_n_1 ivar id'>@rp_n_1</span><span class='rparen token'>)</span>
            <span class='comment val'># this was not really a tie</span>
            <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='@z ivar id'>@z</span>
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span> <span class='comment val'># d &gt; 0</span>
          <span class='comment val'># v &gt;= z</span>
          <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span> <span class='comment val'># @round_mode == :half_down</span>
        <span class='if if kw'>if</span> <span class='d identifier id'>d</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span>
          <span class='comment val'># v &lt; z</span>
          <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='eq op'>==</span> <span class='@rp_n_1 ivar id'>@rp_n_1</span><span class='rparen token'>)</span>
            <span class='comment val'># this was not really a tie</span>
            <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
          <span class='else else kw'>else</span>
            <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span> <span class='comment val'># d &lt; 0</span>
          <span class='comment val'># v &gt; z</span>
          <span class='ret identifier id'>ret</span> <span class='assign token'>=</span> <span class='@z ivar id'>@z</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='elsif elsif kw'>elsif</span> <span class='d identifier id'>d</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='comment val'># eps &gt; 1/2 and v &lt; z</span>
      <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
    <span class='elsif elsif kw'>elsif</span> <span class='d identifier id'>d</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='comment val'># eps &gt; 1/2 and v &gt; z</span>
      <span class='@z ivar id'>@z</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='lparen token'>(</span><span class='@z ivar id'>@z</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Assume the initial approx is good enough (uses IEEE-754 arithmetic with round-to-nearest),</span>
  <span class='comment val'># so we can avoid further iteration, except for directed rounding</span>
  <span class='ret identifier id'>ret</span> <span class='opasgn op'>||=</span> <span class='@z ivar id'>@z</span> <span class='unless unless_mod kw'>unless</span> <span class='directed_rounding identifier id'>directed_rounding</span> <span class='orop op'>||</span> <span class='notop op'>!</span><span class='@good_approx ivar id'>@good_approx</span>

  <span class='return return kw'>return</span> <span class='ret identifier id'>ret</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>exact?</h3>
</div><div id="exact-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>exact?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 406</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L406">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">406
407
408</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='exact? fid id'>exact?</span>
  <span class='@exact ivar id'>@exact</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>read</h3>
</div><div id="read-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>read</span><span class='args'>(context, round_mode, sign, f, e, eb = 10)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given exact integers f and e, with f nonnegative, returns the
floating-point number closest to f * eb**e (eb is the input radix)
</p>
<p>
If the context precision is exact an Inexact exception may occur (an NaN be
returned) if an exact conversion is not possible.
</p>
<p>
round_mode: in :fixed mode it specifies how to round the result (to the
context precision); it is passed separate from context for flexibility. in
:free mode it specifies what rounding would be used to convert back the
output to the input base eb (using the same precision that f has).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/flt/support.rb', line 421</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338/lib/flt/support.rb#L421">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='assign token'>=</span><span class='integer val'>10</span><span class='rparen token'>)</span>
  <span class='@exact ivar id'>@exact</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>

  <span class='case case kw'>case</span> <span class='@mode ivar id'>@mode</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:free</span><span class='comma token'>,</span> <span class='symbol val'>:short</span>
    <span class='all_digits identifier id'>all_digits</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='@mode ivar id'>@mode</span> <span class='eq op'>==</span> <span class='symbol val'>:free</span><span class='rparen token'>)</span>
    <span class='comment val'># for free mode, (any) :nearest rounding is used by default</span>
    <span class='Num constant id'>Num</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='Num constant id'>Num</span><span class='lbrack token'>[</span><span class='eb identifier id'>eb</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='num_class identifier id'>num_class</span><span class='comma token'>,</span> <span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='round_mode identifier id'>round_mode</span><span class='orop op'>||</span><span class='symbol val'>:nearest</span><span class='comma token'>,</span> <span class='symbol val'>:all_digits=</span><span class='gt op'>&gt;</span><span class='all_digits identifier id'>all_digits</span><span class='rparen token'>)</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:fixed</span>
    <span class='if if kw'>if</span> <span class='exact_mode identifier id'>exact_mode</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
      <span class='a identifier id'>a</span><span class='comma token'>,</span><span class='b identifier id'>b</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span>
      <span class='m identifier id'>m</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='b identifier id'>b</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span>
      <span class='if if kw'>if</span> <span class='b identifier id'>b</span> <span class='eq op'>==</span> <span class='a identifier id'>a</span><span class='pow op'>**</span><span class='m identifier id'>m</span>
        <span class='comment val'># conmensurable bases</span>
        <span class='if if kw'>if</span> <span class='eb identifier id'>eb</span> <span class='gt op'>&gt;</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span>
          <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='AuxiliarFunctions constant id'>AuxiliarFunctions</span><span class='dot token'>.</span><span class='_ndigits identifier id'>_ndigits</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='m identifier id'>m</span>
        <span class='else else kw'>else</span>
          <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='AuxiliarFunctions constant id'>AuxiliarFunctions</span><span class='dot token'>.</span><span class='_ndigits identifier id'>_ndigits</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='rparen token'>)</span><span class='plus op'>+</span><span class='m identifier id'>m</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='m identifier id'>m</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='comment val'># inconmesurable bases; exact result may not be possible</span>
        <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='lbrack token'>[</span><span class='eb identifier id'>eb</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span>
        <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='dot token'>.</span><span class='convert_exact identifier id'>convert_exact</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='num_class identifier id'>num_class</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='rparen token'>)</span>
        <span class='@exact ivar id'>@exact</span> <span class='assign token'>=</span> <span class='notop op'>!</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='nan? fid id'>nan?</span>
        <span class='return return kw'>return</span> <span class='x identifier id'>x</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='n identifier id'>n</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='round_mode identifier id'>round_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:nearest</span>
      <span class='comment val'># :nearest is not meaningful here in :fixed mode; replace it</span>
      <span class='if if kw'>if</span> <span class='lbrack token'>[</span><span class='symbol val'>:half_even</span><span class='comma token'>,</span> <span class='symbol val'>:half_up</span><span class='comma token'>,</span> <span class='symbol val'>:half_down</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span><span class='rparen token'>)</span>
        <span class='round_mode identifier id'>round_mode</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span>
      <span class='else else kw'>else</span>
        <span class='round_mode identifier id'>round_mode</span> <span class='assign token'>=</span> <span class='symbol val'>:half_even</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='comment val'># for fixed mode, use the context rounding by default</span>
    <span class='round_mode identifier id'>round_mode</span> <span class='opasgn op'>||=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span>
    <span class='alg identifier id'>alg</span> <span class='assign token'>=</span> <span class='@algorithm ivar id'>@algorithm</span>
    <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='radix identifier id'>radix</span> <span class='eq op'>==</span> <span class='integer val'>2</span> <span class='andop op'>&amp;&amp;</span> <span class='alg identifier id'>alg</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='alg identifier id'>alg</span><span class='eq op'>==</span><span class='symbol val'>:R</span>
      <span class='z0 identifier id'>z0</span> <span class='assign token'>=</span>  <span class='_alg_r_approx identifier id'>_alg_r_approx</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='n identifier id'>n</span><span class='rparen token'>)</span>
      <span class='alg identifier id'>alg</span> <span class='assign token'>=</span> <span class='z0 identifier id'>z0</span> <span class='andop op'>&amp;&amp;</span> <span class='symbol val'>:R</span>
    <span class='end end kw'>end</span>
    <span class='alg identifier id'>alg</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:A</span>
    <span class='case case kw'>case</span> <span class='alg identifier id'>alg</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:M</span><span class='comma token'>,</span> <span class='symbol val'>:R</span>
      <span class='round_mode identifier id'>round_mode</span> <span class='assign token'>=</span> <span class='Support constant id'>Support</span><span class='dot token'>.</span><span class='simplified_round_mode identifier id'>simplified_round_mode</span><span class='lparen token'>(</span><span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span> <span class='eq op'>==</span> <span class='integer val'>-1</span><span class='rparen token'>)</span>
      <span class='case case kw'>case</span> <span class='alg identifier id'>alg</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:M</span>
        <span class='_alg_m identifier id'>_alg_m</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='n identifier id'>n</span><span class='rparen token'>)</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:R</span>
        <span class='_alg_r identifier id'>_alg_r</span><span class='lparen token'>(</span><span class='z0 identifier id'>z0</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='round_mode identifier id'>round_mode</span><span class='comma token'>,</span> <span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='comma token'>,</span> <span class='n identifier id'>n</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span> <span class='comment val'># :A</span>
      <span class='comment val'># direct arithmetic conversion</span>
      <span class='if if kw'>if</span> <span class='round_mode identifier id'>round_mode</span> <span class='eq op'>==</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span>
        <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='Num constant id'>Num</span><span class='dot token'>.</span><span class='convert_exact identifier id'>convert_exact</span><span class='lparen token'>(</span><span class='Num constant id'>Num</span><span class='lbrack token'>[</span><span class='eb identifier id'>eb</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='num_class identifier id'>num_class</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='rparen token'>)</span>
        <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='normalize identifier id'>normalize</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='notop op'>!</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:normalize</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
        <span class='x identifier id'>x</span>
      <span class='else else kw'>else</span>
        <span class='if if kw'>if</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='num_class identifier id'>num_class</span> <span class='eq op'>==</span> <span class='Float constant id'>Float</span>
          <span class='float identifier id'>float</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
          <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='BinNum constant id'>BinNum</span><span class='colon2 op'>::</span><span class='FloatContext constant id'>FloatContext</span>
        <span class='end end kw'>end</span>
        <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='num_class identifier id'>num_class</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='loca_context identifier id'>loca_context</span><span class='bitor op'>|</span>
          <span class='local_context identifier id'>local_context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span> <span class='assign token'>=</span> <span class='round_mode identifier id'>round_mode</span>
          <span class='Num constant id'>Num</span><span class='dot token'>.</span><span class='convert_exact identifier id'>convert_exact</span><span class='lparen token'>(</span><span class='Num constant id'>Num</span><span class='lbrack token'>[</span><span class='eb identifier id'>eb</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='Num constant id'>Num</span><span class='lparen token'>(</span><span class='sign identifier id'>sign</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='local_context identifier id'>local_context</span><span class='dot token'>.</span><span class='num_class identifier id'>num_class</span><span class='comma token'>,</span> <span class='local_context identifier id'>local_context</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
        <span class='if if kw'>if</span> <span class='float identifier id'>float</span>
          <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
        <span class='else else kw'>else</span>
          <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='normalize identifier id'>normalize</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact? fid id'>exact?</span>
        <span class='end end kw'>end</span>
        <span class='x identifier id'>x</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>