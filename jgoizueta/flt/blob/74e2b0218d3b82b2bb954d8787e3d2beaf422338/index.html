<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jgoizueta's flt - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jgoizueta/commits/flt/master" rel="alternate" title="Recent Commits to flt:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jgoizueta", "flt", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jgoizueta", "flt", "74e2b0218d3b82b2bb954d8787e3d2beaf422338", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jgoizueta/flt/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/network">Network</a></li>            
            <li class=""><a href="http://github.com/jgoizueta/flt/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jgoizueta/flt">Wiki</a></li>
            <li class=""><a href="http://github.com/jgoizueta/flt/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jgoizueta/flt">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jgoizueta">jgoizueta</a> / <b><a href="http://github.com/jgoizueta/flt/tree">flt</a></b>        
                <a id="namespaces_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jgoizueta/flt/blob/74e2b0218d3b82b2bb954d8787e3d2beaf422338" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Introduction</h1>
<p>
This library provides arbitrary precision floating-point types for Ruby.
All types and functions are within a namespace called Flt. Decimal and
Binary floating point numbers are implemented in classes Flt::DecNum and
Flt::BinNum. These types are completely written in Ruby using the multiple
precision native integers. The performance could be improved in the future
by using a C extension based on the decNumber libray.
</p>
<p>
The Flt::Tolerance classes and the Flt.Tolerance() constructor handle
floating point tolerances defined in flexible ways.
</p>
<p>
Context classes are define in the files
flt/float.rb[link:files/lib/flt/float_rb.html] and
flt/bigdecimal.rb[link:files/lib/flt/bigdecimal_rb.html] for Float and
BigDecimal numbers that aid to the interchangeability of floating point
types. This represent the only definition of identifiers outside the Flt
namespace: the methods Float.context() and BigDecimal.context() and some
contants in Float.
</p>
<p>
This library is the successor of the ruby-decimal gem, that defined the
Decimal class for decimal floating point; that class has been renamed to
Flt::DecNum and support has been added for binary floating point and
tolerances.
</p>
<p>
The documentation for this package is available at
http://flt.rubyforge.org/
</p>
<p>
The code is at http://github.com/jgoizueta/flt/
</p>
<h1>DecNum</h1>
<p>
Flt::DecNum is a standards-compliant arbitrary precision decimal
floating-point type for Ruby. It is based on the Python Decimal class.
</p>
<h2>Standars compliance.</h2>
<p>
DecNum pretends to be conformant to the General Decimal Arithmetic
Specification and the revised IEEE 754 standard (IEEE 754-2008).
</p>
<h1>Examples of use</h1>
<p>
To install the library use gem from the command line: (you may not need
<tt>sudo</tt>) FIXME: The flt gem is not publicly available yet.
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='flt identifier id'>flt</span>
</pre>
<p>
Then require the library in your code (if it fails you may need to
<tt>require &#8216;rubygems&#8217;</tt> first)
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'flt'</span>
  <span class='include identifier id'>include</span> <span class='Flt constant id'>Flt</span>
</pre>
<p>
Now we can use the DecNum class simply like this:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>                         <span class='comment val'># -&gt; 0.3333333333333333333333333333</span>
</pre>
<p>
DecNum() is a constructor that can be used instead of DecNum.new()
</p>
<h2>Contexts</h2>
<p>
Contexts are environments for arithmetic operations. They govern precision,
set rules for rounding, determine which signals are treated as exceptions,
and limit the range for exponents.
</p>
<p>
Each thread has an active context that can be accessed like this:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                    <span class='comment val'># -&gt; 28</span>
</pre>
<p>
The active context can be globally for the current thread:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>2</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                    <span class='comment val'># -&gt; 2</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>                         <span class='comment val'># -&gt; 0.33</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='opasgn op'>+=</span> <span class='integer val'>7</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                    <span class='comment val'># -&gt; 9</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>                         <span class='comment val'># -&gt; 0.333333333</span>
</pre>
<p>
Or it can be altered locally inside a block:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span> <span class='do do kw'>do</span>
    <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>5</span>
    <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                  <span class='comment val'># -&gt; 5</span>
  <span class='end end kw'>end</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                    <span class='comment val'># -&gt; 9</span>
</pre>
<p>
The block for a local context can be passed the current context as an
argument:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='local_context identifier id'>local_context</span><span class='bitor op'>|</span>
    <span class='local_context identifier id'>local_context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>5</span>
    <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                  <span class='comment val'># -&gt; 5</span>
  <span class='end end kw'>end</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                    <span class='comment val'># -&gt; 9</span>
</pre>
<p>
A context object can be used to define the local context:
</p>
<pre class="code">
  <span class='my_context identifier id'>my_context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='Context constant id'>Context</span><span class='lparen token'>(</span><span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>20</span><span class='rparen token'>)</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='my_context identifier id'>my_context</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='context identifier id'>context</span><span class='bitor op'>|</span>
    <span class='puts identifier id'>puts</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
  <span class='end end kw'>end</span>                                              <span class='comment val'># -&gt; 20</span>
</pre>
<p>
And individual parameters can be assigned like this:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                    <span class='comment val'># -&gt; 9</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span>                     <span class='comment val'># -&gt; half_even</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='symbol val'>:down</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='context identifier id'>context</span><span class='bitor op'>|</span>
    <span class='puts identifier id'>puts</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                         <span class='comment val'># -&gt; 9</span>
    <span class='puts identifier id'>puts</span> <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span>                          <span class='comment val'># -&gt; down</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Contexts created with the DecNum::Context() constructor inherit from
DecNum::DefaultContext. Default context attributes can be established by
modifying that object:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='DefaultContext constant id'>DefaultContext</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>10</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='Context constant id'>Context</span><span class='lparen token'>(</span><span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='symbol val'>:half_up</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                    <span class='comment val'># -&gt; 10</span>
</pre>
<p>
Note that a context object assigned to DecNum.context is copied, so it is
not altered through DecNum.context:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='my_context identifier id'>my_context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                        <span class='comment val'># -&gt; 20</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='my_context identifier id'>my_context</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>2</span>
  <span class='puts identifier id'>puts</span> <span class='my_context identifier id'>my_context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>                        <span class='comment val'># -&gt; 20</span>
</pre>
<p>
So, DefaultContext is not altered when modifying DecNum.context.
</p>
<p>
Methods that use a context have an optional parameter to override the
active context (DecNum.context) :
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>3</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divide identifier id'>divide</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>                         <span class='comment val'># -&gt; 0.333</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divide identifier id'>divide</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='my_context identifier id'>my_context</span><span class='rparen token'>)</span>             <span class='comment val'># -&gt; 0.33333333333333333333</span>
</pre>
<p>
Individual context parameters can also be overriden:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divide identifier id'>divide</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>6</span><span class='rparen token'>)</span>          <span class='comment val'># -&gt; 0.333333</span>
</pre>
<p>
There are two additional predefined contexts DecNum::ExtendedContext and
DecNum::BasicContext that are not meant to be modified; they can be used to
achieve reproducible results. We will use DecNum::ExtendedContext in the
following examples:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='ExtendedContext constant id'>ExtendedContext</span>
</pre>
<p>
Most decimal operations can be executed by using either Context or DecNum
methods:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exp identifier id'>exp</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>                       <span class='comment val'># -&gt; 2.71828183</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='exp identifier id'>exp</span>                               <span class='comment val'># -&gt; 2.71828183</span>
</pre>
<p>
If using Context methods, values are automatically converted as if the
DecNum() constructor was used.
</p>
<h2>Rounding</h2>
<p>
Results are normally rounded using the precision (number of significant
digits) and rounding mode defined in the context.
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>4</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>                         <span class='comment val'># -&gt; 0.3333</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1E20'</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1E-20'</span><span class='rparen token'>)</span>              <span class='comment val'># -&gt; 1.000E&lt;tt&gt;20</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span> <span class='assign token'>=</span> <span class='symbol val'>:half_up</span>
  <span class='puts identifier id'>puts</span> <span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;DecNum('100.05')                           # -&gt; 100.1
  DecNum.context.rounding = :half_even
  puts &lt;tt&gt;DecNum('100.05')                           # -&gt; 100.0
</span></pre>
<p>
Note that input values are not rounded, only results; we use the plus
operator to force rounding here:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>4</span>
  <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'123.45678'</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span>                                           <span class='comment val'># -&gt; 123.45678</span>
  <span class='puts identifier id'>puts</span> <span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;x                                          # -&gt; 123.5
</span></pre>
<p>
Precision can be also set to exact to avoid rounding, by using the exact
property or using a 0 precision. In exact mode results are never rounded
and results that have an infinite number of digits trigger the
DecNum::Inexact exception.
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='exact identifier id'>exact</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1E20'</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1E-20'</span><span class='rparen token'>)</span>              <span class='comment val'># -&gt; 99999999999999999999.99999999999999999999</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='sqrt identifier id'>sqrt</span>                             <span class='comment val'># -&gt; 4</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>                        <span class='comment val'># -&gt; 4</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>                         <span class='comment val'># -&gt; Exception : Flt::Num::Inexact</span>

  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>5</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1E20'</span><span class='rparen token'>)</span><span class='minus op'>-</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1E-20'</span><span class='rparen token'>)</span>              <span class='comment val'># -&gt; 1.0000E&lt;tt&gt;20</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='sqrt identifier id'>sqrt</span>                             <span class='comment val'># -&gt; 4</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>                        <span class='comment val'># -&gt; 4</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>                         <span class='comment val'># -&gt; 0.33333</span>
</pre>
<p>
There are also some methods for explicit rounding that provide an interface
compatible with the Ruby interface of Float:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.5'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span>                       <span class='comment val'># -&gt; 102</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.5'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>                    <span class='comment val'># -&gt; 102</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.12345'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span>                <span class='comment val'># -&gt; 101.12</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.12345'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='rparen token'>)</span>               <span class='comment val'># -&gt; 1.0E&lt;/tt&gt;2</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.12345'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='symbol val'>:places=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>       <span class='comment val'># -&gt; 101.12</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.12345'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>    <span class='comment val'># -&gt; 1.0E&lt;tt&gt;2</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.5'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='symbol val'>:half_up</span><span class='rparen token'>)</span>  <span class='comment val'># -&gt; 102</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.5'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span>                        <span class='comment val'># -&gt; 102</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.5'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span>                       <span class='comment val'># -&gt; 101</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'101.5'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='truncate identifier id'>truncate</span>                    <span class='comment val'># -&gt; 101</span>
</pre>
<h2>Special values</h2>
<p>
In addition to finite numbers, a DecNum object can represent some special
values:
</p>
<ul>
<li>Infinity (</tt>Infinity, -Infinity). The method DecNum#infinite? returns true
for these to values. DecNum.infinity DecNum.infinity(-1) can be used to get
these values.

</li>
<li>NaN (not a number) represents indefined results. The method DecNum#nan?
returns true for it and DecNum.nan can be used to obtain it. There is a
variant, sNaN (signaling NaN) that casues an invalid operation condition if
used; it can be detected with DecNum.snan?. A NaN can also include
diagnostic information in its sign and coefficient.

</li>
</ul>
<p>
Any of the special values can be detected with DecNum#special? Finite
numbers can be clasified with these methods:
</p>
<ul>
<li>DecNum#zero? detects a zero value (note that there are two zero values: +0
and -0)

</li>
<li>DecNum#normal? detects normal values: those whose adjusted exponents are
not less than the the emin.

</li>
<li>DecNum#subnormal? detects subnormal values: those whose adjusted exponents
are less than the the emin.

</li>
</ul>
<h2>Exceptions</h2>
<p>
Exceptional conditions that may arise during operations have corresponding
classes that represent them:
</p>
<ul>
<li>DecNum::InvalidOperation

</li>
<li>DecNum::DivisionByZero

</li>
<li>DecNum::DivisionImpossible

</li>
<li>DecNum::DivisionUndefined

</li>
<li>DecNum::Inexact

</li>
<li>DecNum::Overflow

</li>
<li>DecNum::Underflow

</li>
<li>DecNum::Clamped

</li>
<li>DecNum::InvalidContext

</li>
<li>DecNum::Rounded

</li>
<li>DecNum::Subnormal

</li>
<li>DecNum::ConversionSyntax

</li>
</ul>
<p>
For each condition, a flag and a trap (boolean values) exist in the
context. When a condition occurs, the corresponding flag in the context
takes the value true (and remains set until cleared) and a exception is
raised if the corresponding trap has the value true.
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='traps identifier id'>traps</span><span class='lbrack token'>[</span><span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='DivisionByZero constant id'>DivisionByZero</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span><span class='lbrack token'>[</span><span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='DivisionByZero constant id'>DivisionByZero</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>                              <span class='comment val'># -&gt; Infinity</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='flags identifier id'>flags</span><span class='lbrack token'>[</span><span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='DivisionByZero constant id'>DivisionByZero</span><span class='rbrack token'>]</span>     <span class='comment val'># -&gt; true</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='traps identifier id'>traps</span><span class='lbrack token'>[</span><span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='DivisionByZero constant id'>DivisionByZero</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>                              <span class='comment val'># -&gt; Exception : Flt::Num::DivisionByZero</span>
</pre>
<h2>Numerical conversion</h2>
<p>
By default, DecNum is interoperable with Integer and Rational. Conversion
happens automatically to operands:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1'</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='integer val'>1</span>                           <span class='comment val'># -&gt; 1.1</span>
  <span class='puts identifier id'>puts</span> <span class='integer val'>7</span> <span class='plus op'>+</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.2'</span><span class='rparen token'>)</span>                           <span class='comment val'># -&gt; 7.2</span>
  <span class='puts identifier id'>puts</span> <span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>5</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'3'</span><span class='rparen token'>)</span>                 <span class='comment val'># -&gt; 5.5</span>
</pre>
<p>
Conversion can also be done explicitely with the DecNum constructor:
</p>
<pre class="code">
   <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>7</span><span class='rparen token'>)</span>                                  <span class='comment val'># -&gt; 7</span>
   <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='Rational constant id'>Rational</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>10</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                     <span class='comment val'># -&gt; 0.1</span>
</pre>
<p>
Converting a DecNum to other numerical types can be done with specific
Ruby-style methods.
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>                          <span class='comment val'># -&gt; 1</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_r identifier id'>to_r</span>                          <span class='comment val'># -&gt; 11/10</span>
</pre>
<p>
(note the truncated result of to_i) Or with a generic method:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='convert_to identifier id'>convert_to</span><span class='lparen token'>(</span><span class='Integer constant id'>Integer</span><span class='rparen token'>)</span>           <span class='comment val'># -&gt; 1</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='convert_to identifier id'>convert_to</span><span class='lparen token'>(</span><span class='Rational constant id'>Rational</span><span class='rparen token'>)</span>          <span class='comment val'># -&gt; 11/10</span>
</pre>
<p>
Thera are also GDAS style conversion operations:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_integral_value identifier id'>to_integral_value</span>             <span class='comment val'># -&gt; 1</span>
</pre>
<p>
And conversion is also possible to Float:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>                          <span class='comment val'># -&gt; 1.1</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='convert_to identifier id'>convert_to</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span>             <span class='comment val'># -&gt; 1.1</span>
  <span class='puts identifier id'>puts</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>                        <span class='comment val'># -&gt; 1.1</span>
</pre>
<p>
Types with predefined bidirectional conversion (Integer and Rational) can
be operated with DecNum on either side of an operator, and the result will
be a DecNum. For Float there is no predefined bidirectional conversion (see
below how to define it) and the result of an operation between DecNum and
Float will be of type Float.
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='float val'>2.0</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='class identifier id'>class</span>                  <span class='comment val'># -&gt; Float</span>
  <span class='puts identifier id'>puts</span> <span class='lparen token'>(</span><span class='float val'>2.0</span> <span class='plus op'>+</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='class identifier id'>class</span>                  <span class='comment val'># -&gt; Float</span>
</pre>
<p>
The conversion system is extensible. For example, we can include BigDecimal
into it by defining suitable conversion procedures:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='define_conversion_from identifier id'>define_conversion_from</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='bitor op'>|</span>
    <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='define_conversion_to identifier id'>define_conversion_to</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span>
    <span class='BigDecimal constant id'>BigDecimal</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Now we can mix BigDecimals and Decimals in expressions and convert from
DecNum to BigDecimal:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='BigDecimal constant id'>BigDecimal</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'2.2'</span><span class='rparen token'>)</span>       <span class='comment val'># -&gt; 3.3</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'1.1'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='convert_to identifier id'>convert_to</span><span class='lparen token'>(</span><span class='BigDecimal constant id'>BigDecimal</span><span class='rparen token'>)</span>        <span class='comment val'># -&gt; 0.11E1</span>
</pre>
<p>
Note that the conversions are defined in a Context object and will be
available only when that context applies. That way we can define
conversions for specific purposes without affecting a program globally.
</p>
<p>
As another example consider conversion from Float to DecNum, which is not
defined by default because it can be defined in different ways depending on
the purpose.
</p>
<p>
A Float constant such as 0.1 defines a Float object which has a numerical
value close to, but not exactly 1/10. When converting that Float to DecNum
we could decide to preserve the exact numerical value of the number or try
to find a simple decimal expression within a given tolerance. If we take
the first approach we can define this conversion:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='define_conversion_from identifier id'>define_conversion_from</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='bitor op'>|</span>
    <span class='s identifier id'>s</span><span class='comma token'>,</span><span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='frexp identifier id'>frexp</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='rparen token'>)</span>
    <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='Math constant id'>Math</span><span class='dot token'>.</span><span class='ldexp identifier id'>ldexp</span><span class='lparen token'>(</span><span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='MANT_DIG constant id'>MANT_DIG</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='e identifier id'>e</span> <span class='opasgn op'>-=</span> <span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='MANT_DIG constant id'>MANT_DIG</span>
    <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='s identifier id'>s</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='colon2 op'>::</span><span class='RADIX constant id'>RADIX</span><span class='pow op'>**</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Note that the conversion we&#8217;ve defined depends on the context
precision:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='local_context identifier id'>local_context</span><span class='lparen token'>(</span><span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>20</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.1</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span> <span class='comment val'># -&gt; 0.10000000000000000555</span>

  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='local_context identifier id'>local_context</span><span class='lparen token'>(</span><span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>12</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.1</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span> <span class='comment val'># -&gt; 0.100000000000</span>

  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='local_context identifier id'>local_context</span><span class='lparen token'>(</span><span class='symbol val'>:exact=</span><span class='gt op'>&gt;</span><span class='true true kw'>true</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.1</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span> <span class='comment val'># -&gt; 0.1000000000000000055511151231257827021181583404541015625</span>
</pre>
<p>
A different approach for Float to DecNum conversion is to find the shortest
(fewer digits) DecNum that rounds to the Float with the binary precision
that the Float has. We will assume that the DecNum to Float conversion done
with the rounding mode of the DecNum context. The BinNum class has a method
to perform this kind of conversion, so we will use it.
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='define_conversion_from identifier id'>define_conversion_from</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='dec_context identifier id'>dec_context</span><span class='bitor op'>|</span>
    <span class='BinNum constant id'>BinNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='symbol val'>:rounding=</span><span class='gt op'>&gt;</span><span class='dec_context identifier id'>dec_context</span><span class='dot token'>.</span><span class='rounding identifier id'>rounding</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='bin_context identifier id'>bin_context</span><span class='bitor op'>|</span>
      <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_decimal identifier id'>to_decimal</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The result is independent of the context precision.
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.1</span><span class='rparen token'>)</span>                                 <span class='comment val'># -&gt; 0.1</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='float val'>1.0</span><span class='div op'>/</span><span class='integer val'>3</span><span class='rparen token'>)</span>                               <span class='comment val'># -&gt; 0.3333333333333333</span>
</pre>
<p>
This conversion gives the results expected most of the time, but it must be
noticed that there must be some compromise, because different decimal
literals convert to the same Float value:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='integer val'>.10000000000000001</span><span class='rparen token'>)</span>                 <span class='comment val'># -&gt; 0.1</span>
</pre>
<p>
There&#8217;s also some uncertainty because the way the Ruby interpreter
parses Float literals may not be well specified; in the usual case (IEEE
Double Floats and round-to-even) the results will be as expected (correctly
rounded Floats), but some platforms may behave differently.
</p>
<p>
The BinNum also a instance method <tt>to_decimal_exact</tt> to perform the
previous &#8216;exact&#8217; conversion, that could have be written:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='define_conversion_from identifier id'>define_conversion_from</span><span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='context identifier id'>context</span><span class='bitor op'>|</span>
    <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_decimal_exact identifier id'>to_decimal_exact</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Abbreviation</h2>
<p>
The use of DecNum can be made less verbose by requiring:
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'flt/d'</span>
</pre>
<p>
This file defines <tt>D</tt> as a synonym for <tt>DecNum</tt>:
</p>
<pre class="code">
  <span class='D constant id'>D</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>3</span>
  <span class='puts identifier id'>puts</span> <span class='plus op'>+</span><span class='D constant id'>D</span><span class='lparen token'>(</span><span class='string val'>'1.234'</span><span class='rparen token'>)</span>                                 <span class='comment val'># -&gt; 1.23</span>
</pre>
<p>
Some convenient methods are added to numeric classes by requiring the
optional flt/sugar.rb[link:files/lib/flt/sugar_rb.html]. This must be
explicitely required because it could cause conflicts with other extensions
of these classes.
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'flt/sugar'</span>

  <span class='puts identifier id'>puts</span> <span class='float val'>34</span><span class='dot token'>.</span><span class='odd? fid id'>odd?</span>                                     <span class='comment val'># -&gt; false</span>
  <span class='puts identifier id'>puts</span> <span class='float val'>34</span><span class='dot token'>.</span><span class='even? fid id'>even?</span>                                    <span class='comment val'># -&gt; true</span>
  <span class='puts identifier id'>puts</span> <span class='integer val'>0</span><span class='float val'>.1</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span>                           <span class='comment val'># -&gt; [1, 7205759403792794, -56]</span>
  <span class='puts identifier id'>puts</span> <span class='lparen token'>(</span><span class='integer val'>-0</span><span class='integer val'>.1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='sign identifier id'>sign</span>                                 <span class='comment val'># -&gt; -1</span>
</pre>
<h2>Error analysis</h2>
<p>
The DecNum#ulp() method returns the value of a &quot;unit in the last
place&quot; for a given number under the current context.
</p>
<pre class="code">
  <span class='D constant id'>D</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>4</span>
  <span class='puts identifier id'>puts</span> <span class='D constant id'>D</span><span class='lparen token'>(</span><span class='string val'>'1.5'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ulp identifier id'>ulp</span>                                <span class='comment val'># -&gt; 0.001</span>
  <span class='puts identifier id'>puts</span> <span class='D constant id'>D</span><span class='lparen token'>(</span><span class='string val'>'1.5E10'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ulp identifier id'>ulp</span>                             <span class='comment val'># -&gt; 1E&lt;tt&gt;7</span>
</pre>
<p>
Whe can compute the error in ulps of an approximation <tt>aprx</tt> to
correclty rounded value <tt>exct</tt> with:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='ulps identifier id'>ulps</span><span class='lparen token'>(</span><span class='exct identifier id'>exct</span><span class='comma token'>,</span> <span class='aprx identifier id'>aprx</span><span class='rparen token'>)</span>
    <span class='lparen token'>(</span><span class='aprx identifier id'>aprx</span><span class='minus op'>-</span><span class='exct identifier id'>exct</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span><span class='div op'>/</span><span class='exct identifier id'>exct</span><span class='dot token'>.</span><span class='ulp identifier id'>ulp</span>
  <span class='end end kw'>end</span>

  <span class='puts identifier id'>puts</span> <span class='ulps identifier id'>ulps</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.5000'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.5003'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>    <span class='comment val'># -&gt; 3</span>
  <span class='puts identifier id'>puts</span> <span class='ulps identifier id'>ulps</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.5000'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.4997'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>    <span class='comment val'># -&gt; 3</span>

  <span class='puts identifier id'>puts</span> <span class='ulps identifier id'>ulps</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1000'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1003'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>    <span class='comment val'># -&gt; 3E&lt;/tt&gt;1</span>
  <span class='puts identifier id'>puts</span> <span class='ulps identifier id'>ulps</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.1000'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='string val'>'0.0997'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>    <span class='comment val'># -&gt; 3E&lt;tt&gt;1</span>

  <span class='puts identifier id'>puts</span> <span class='ulps identifier id'>ulps</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='next_minus identifier id'>next_minus</span><span class='rparen token'>)</span>      <span class='comment val'># -&gt; 8.999E&lt;/tt&gt;4</span>
  <span class='puts identifier id'>puts</span> <span class='ulps identifier id'>ulps</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='next_plus identifier id'>next_plus</span><span class='rparen token'>)</span>       <span class='comment val'># -&gt; 9.01E+4</span>
</pre>
<p>
Note that in the definition of ulps we use exct.ulp. If we had use aprx.ulp
DecNum(10).next_plus would seem to be a better approximation to DecNum(1)
than DecNum(10).next_minus. (Admittedly, such bad approximations should not
be common.)
</p>
<h2>BinNum Input/Output</h2>
<p>
BinNum can be defined with a decimal string literal and converted to one
with to_s, as DecNum, but since this involves a change of base these are
inexact operations subject to some specific precision limits.
</p>
<p>
If we define the number with a binary literal, no base conversion is
involved and the result is exactly defined; here we define a number with
just one bit of precision:
</p>
<pre class="code">
  <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='string val'>'0.001'</span><span class='comma token'>,</span> <span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span>                          <span class='comment val'># -&gt; 1</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>                            <span class='comment val'># -&gt; 0.001</span>
</pre>
<p>
Note that we could have defined it with more precision, e.g.
</p>
<pre class="code">
  <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='string val'>'0.001000'</span><span class='comma token'>,</span> <span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span>                          <span class='comment val'># -&gt; 4</span>
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>                            <span class='comment val'># -&gt; 0.001000</span>
</pre>
<p>
But let&#8217;s get back to our one bit quantity, x, and convert it to a
decimal string. Since the internal precision is only one bit it contains
very little information:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span>                                           <span class='comment val'># -&gt; 0.1</span>
</pre>
<p>
We can obtain more digits with the :all_digits option which show all the
decimal digits that are significative for the given precision of 1 bit:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='symbol val'>:all_digits=</span><span class='gt op'>&gt;</span><span class='true true kw'>true</span><span class='rparen token'>)</span>                     <span class='comment val'># -&gt; 0.12</span>
</pre>
<p>
We can also obtain the exact value of x by using the Num.convert_exact
method to convert it to decimal (base 10):
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='Num constant id'>Num</span><span class='dot token'>.</span><span class='convert_exact identifier id'>convert_exact</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span><span class='integer val'>10</span><span class='rparen token'>)</span>                     <span class='comment val'># -&gt; 0.125</span>
</pre>
<p>
Let&#8217;s convert the default decimal output back to another BinNum which
will preserve its precision:
</p>
<pre class="code">
  <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
</pre>
<p>
The result may seem ok:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span>                                            <span class='comment val'># -&gt; 0.1</span>
</pre>
<p>
But is not exactly what we originally had:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span><span class='eq op'>==</span><span class='x identifier id'>x</span>                                        <span class='comment val'># -&gt; false</span>
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span>                                           <span class='comment val'># -&gt; 0.1</span>
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span>                          <span class='comment val'># -&gt; 5</span>
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>                            <span class='comment val'># -&gt; 0.00011010</span>
</pre>
<p>
The new value y has gained some digits because of the intermediate
conversion to decimal: one decimal digit contains more information than one
bit, and the result shows that.
</p>
<p>
If we wanted to preserve exactly the number we should have done this:
</p>
<pre class="code">
  <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:fixed</span><span class='comma token'>,</span> <span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='y identifier id'>y</span><span class='eq op'>==</span><span class='x identifier id'>x</span>                                         <span class='comment val'># -&gt; true</span>
</pre>
<p>
To preserve the value we had to explicitly determine how many bits should y
have.
</p>
<p>
With the :fixed options the number produced by BinNum is rounded to the
context precision (which can be overriden as in the example by other
options):
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:fixed</span><span class='comma token'>,</span> <span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>32</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='comment val'># -&gt; 0.00011001100110011001100110011001101</span>
  <span class='puts identifier id'>puts</span> <span class='BinNum constant id'>BinNum</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:fixed</span><span class='comma token'>,</span> <span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lparen token'>(</span><span class='symbol val'>:base=</span><span class='gt op'>&gt;</span><span class='integer val'>2</span><span class='rparen token'>)</span>  <span class='comment val'># -&gt; 0.001</span>
</pre>
<p>
Note also that if we normalize a value we will change it&#8217;s precision
to that of the context:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span>                          <span class='comment val'># -&gt; 1</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='normalize identifier id'>normalize</span><span class='dot token'>.</span><span class='number_of_digits identifier id'>number_of_digits</span>                <span class='comment val'># -&gt; 53</span>
  <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='normalize identifier id'>normalize</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>                            <span class='comment val'># -&gt; 0.125</span>
</pre>
<h2>More Information</h2>
<ul>
<li>Decimal Floating point type: see the base Flt::Num class and the
Flt::DecNum class

</li>
<li>Binary Floating point type: see the base Flt::Num class and the Flt::BinNum
class

</li>
<li>Floating Point Contexts: see documentation for classes
Flt::Num::ContextBase, Flt::DecNum::Context and Flt::BinNum::Context

</li>
<li>Floating Point Tolerance: see the
flt/tolerance.rb[link:files/lib/flt/tolerance_rb.html] file and the
Flt::Tolerance class

</li>
<li>Constructors: see Flt.DecNum(), Flt.BinNum() and Flt.Tolerance().

</li>
</ul>
<h1>DecNum vs BigDecimal</h1>
<p>
&#8212; EXPAND- ++
</p>
<p>
DecNum solves some of the difficulties of using BigDecimal.
</p>
<p>
One of the major problems with BigDecimal is that it&#8217;s not easy to
control the number of significant digits of the results. While addition,
subtraction and multiplication are exact (unless a limit is used),
divisions will need to be passed precision explicitly or else an
indeterminate number of significant digits will be lost. Part of the
problem is that numbers don&#8217;t keep track of its precision (0.1000 is
not distinguishable from 0.1.)
</p>
<p>
With DecNum, Context objects are used to specify the exact number of digits
to be used for all operations making the code cleaner and the results more
easily predictable.
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>10</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
</pre>
<p>
Contexts are thread-safe and can be used for individual operations:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='divide identifier id'>divide</span><span class='lparen token'>(</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='DecNum constant id'>DecNum</span><span class='colon2 op'>::</span><span class='Context constant id'>Context</span><span class='lparen token'>(</span><span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
</pre>
<p>
Which can be abbreviated: puts DecNum(1).divide(DecNum(e),
:precision=&gt;4) Or use locally in a block without affecting other code:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span> <span class='lbrace token'>{</span>
    <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='assign token'>=</span> <span class='integer val'>3</span>
    <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
  <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span>
</pre>
<p>
Which can also be abbreviated:
</p>
<pre class="code">
  <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='symbol val'>:precision=</span><span class='gt op'>&gt;</span><span class='integer val'>3</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='puts identifier id'>puts</span> <span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='div op'>/</span><span class='DecNum constant id'>DecNum</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
</pre>
<p>
This allows in general to write simpler code; e.g. this is an exponential
function, adapted from the &#8216;recipes&#8217; in Python&#8217;s Decimal:
</p>
<pre class="code">
    <span class='def def kw'>def</span> <span class='exp identifier id'>exp</span><span class='lparen token'>(</span><span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='c identifier id'>c</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
      <span class='i identifier id'>i</span><span class='comma token'>,</span> <span class='lasts identifier id'>lasts</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='fact identifier id'>fact</span><span class='comma token'>,</span> <span class='num identifier id'>num</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>1</span>
      <span class='DecNum constant id'>DecNum</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='context identifier id'>context</span><span class='bitor op'>|</span>
        <span class='context identifier id'>context</span><span class='dot token'>.</span><span class='precision identifier id'>precision</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='geq op'>&gt;=</span> <span class='integer val'>2</span>
        <span class='while while kw'>while</span> <span class='s identifier id'>s</span> <span class='neq op'>!=</span> <span class='lasts identifier id'>lasts</span>
          <span class='lasts identifier id'>lasts</span> <span class='assign token'>=</span> <span class='s identifier id'>s</span>
          <span class='i identifier id'>i</span> <span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;= 1
          fact *= i
          num *= x
          s &lt;tt&gt;= num /</span> <span class='fact identifier id'>fact</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span> <span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;s
    end
</span></pre>
<p>
The final unary + applied to the result forces it to be rounded to the
current precision (because we have computed it with two extra digits) The
result of this method does not have trailing non-significant digits, as is
common with BigDecimal (e.g. in the exp implementation available in the
standard Ruby library, in bigdecimal/math)
</p>
<p>
&#8212; EXPAND+ ++
</p>
<h1>Roadmap</h1>
<ul>
<li>Version 1.0.0: First released version of the new flt gem.

</li>
<li>Version 1.1.0: Implement the missing GDA functions: rotate, shift, trim,
and, or, xor, invert, max, min, maxmag, minmag, comparetotal, comparetotmag

</li>
</ul>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>