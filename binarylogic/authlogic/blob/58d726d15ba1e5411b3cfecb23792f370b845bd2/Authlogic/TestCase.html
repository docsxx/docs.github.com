<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>binarylogic's authlogic - Module: Authlogic::TestCase - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/binarylogic/commits/authlogic/master" rel="alternate" title="Recent Commits to authlogic:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("binarylogic", "authlogic", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='binarylogic/authlogic/blob/58d726d15ba1e5411b3cfecb23792f370b845bd2' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='binarylogic/authlogic/blob/58d726d15ba1e5411b3cfecb23792f370b845bd2' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("binarylogic", "authlogic", "58d726d15ba1e5411b3cfecb23792f370b845bd2", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/binarylogic/authlogic/tree/">Source</a></li>
            <li class=""><a href="http://github.com/binarylogic/authlogic/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/binarylogic/authlogic/network">Network</a></li>            
            <li class=""><a href="http://github.com/binarylogic/authlogic/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/binarylogic/authlogic">Wiki</a></li>
            <li class=""><a href="http://github.com/binarylogic/authlogic/graphs">Graphs</a></li>                    
            <li class="active"><a href="/binarylogic/authlogic">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/binarylogic">binarylogic</a> / <b><a href="http://github.com/binarylogic/authlogic/tree">authlogic</a></b>        
                <a id="namespaces_button" rel="binarylogic/authlogic/blob/58d726d15ba1e5411b3cfecb23792f370b845bd2" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="binarylogic/authlogic/blob/58d726d15ba1e5411b3cfecb23792f370b845bd2" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Authlogic_TestCase">
  <h1>Module: Authlogic::TestCase</h1>
  <div class="section docstring">
  <p>
This module is a collection of methods and classes that help you easily
test Authlogic. In fact, I use these same tools to test the internals of
Authlogic.
</p>
<h3>The quick and dirty</h3>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>&quot;authlogic/test_case&quot;</span> <span class='comment val'># include at the top of test_helper.rb</span>
  <span class='setup identifier id'>setup</span> <span class='symbol val'>:activate_authlogic</span> <span class='comment val'># run before tests are executed</span>
  <span class='UserSession constant id'>UserSession</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='users identifier id'>users</span><span class='lparen token'>(</span><span class='symbol val'>:whomever</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='comment val'># logs a user in</span>
</pre>
<p>
For a more detailed explanation, see below.
</p>
<h3>Setting up</h3>
<p>
Authlogic comes with some simple testing tools. To get these, you need to
first require Authlogic&#8217;s TestCase. If you are doing this in a rails
app, you would require this file at the top of your test_helper.rb file:
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>&quot;authlogic/test_case&quot;</span>
</pre>
<p>
If you are using Test::Unit::TestCase, the standard testing library that
comes with ruby, then you can skip this next part. If you are not, you need
to include the Authlogic::TestCase into your testing suite as follows:
</p>
<pre class="code">
  <span class='include identifier id'>include</span> <span class='Authlogic constant id'>Authlogic</span><span class='colon2 op'>::</span><span class='TestCase constant id'>TestCase</span>
</pre>
<p>
Now that everything is ready to go, let&#8217;s move onto actually testing.
Here is the basic idea behind testing:
</p>
<p>
Authlogic requires a &quot;connection&quot; to your controller to activate
it. In the same manner that ActiveRecord requires a connection to your
database. It can&#8217;t do anything until it gets connnected. That being
said, Authlogic will raise an
Authlogic::Session::Activation::NotActivatedError any time you try to
instantiate an object without a &quot;connection&quot;. So before you do
anything with Authlogic, you need to activate / connect Authlogic.
Let&#8217;s walk through how to do this in tests:
</p>
<h3>Fixtures / Factories</h3>
<p>
Creating users via fixtures / factories is easy. Here&#8217;s an example of
a fixture:
</p>
<pre class="code">
  <span class='ben identifier id'>ben</span><span class='colon op'>:</span>
    <span class='email identifier id'>email</span><span class='colon op'>:</span> <span class='whatever identifier id'>whatever</span><span class='@whatever ivar id'>@whatever</span><span class='dot token'>.</span><span class='com identifier id'>com</span>
    <span class='password_salt identifier id'>password_salt</span><span class='colon op'>:</span> <span class='lt op'>&lt;</span><span class='string val'>%= salt =</span> <span class='Authlogic constant id'>Authlogic</span><span class='colon2 op'>::</span><span class='Random constant id'>Random</span><span class='dot token'>.</span><span class='hex_token identifier id'>hex_token</span> <span class='string val'>%&gt;
    crypted_password: &lt;%= Authlogic::CryptoProviders::Sha512.encrypt(&quot;benrocks&quot; + salt) %&gt;</span>
    <span class='persistence_token identifier id'>persistence_token</span><span class='colon op'>:</span> <span class='lt op'>&lt;</span><span class='string val'>%= Authlogic::Random.hex_token %&gt;
    single_access_token: &lt;%=</span> <span class='Authlogic constant id'>Authlogic</span><span class='colon2 op'>::</span><span class='Random constant id'>Random</span><span class='dot token'>.</span><span class='friendly_token identifier id'>friendly_token</span> <span class='string val'>%&gt;
    perishable_token: &lt;%= Authlogic::Random.friendly_token %&gt;</span>
</pre>
<p>
Notice the crypted_password value. Just supplement that with whatever
crypto provider you are using, if you are not using the default.
</p>
<h3>Functional tests</h3>
<p>
Activating Authlogic isn&#8217;t a problem here, because making a request
will activate Authlogic for you. The problem is logging users in so they
can access restricted areas. Solving this is simple, just do this:
</p>
<pre class="code">
  <span class='setup identifier id'>setup</span> <span class='symbol val'>:activate_authlogic</span>
</pre>
<p>
For those of you unfamiliar with TestUnit, the setup method bascially just
executes a method before any test is ran. It is essentially &quot;setting
up&quot; your tests.
</p>
<p>
Once you have done this, just log users in like usual:
</p>
<pre class="code">
  <span class='UserSession constant id'>UserSession</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='users identifier id'>users</span><span class='lparen token'>(</span><span class='symbol val'>:whomever</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='comment val'># access my restricted area here</span>
</pre>
<p>
Do this before you make your request and it will act as if that user is
logged in.
</p>
<h3>Integration tests</h3>
<p>
Again, just like functional tests, you don&#8217;t have to do anything. As
soon as you make a request, Authlogic will be conntected. If you want to
activate Authlogic before making a request follow the same steps described
in the &quot;functional tests&quot; section above. It works in the same
manner.
</p>
<h3>Unit tests</h3>
<p>
The only time you need to do any trickiness here is if you want to test
Authlogic models. Maybe you added some custom code or methods in your
Authlogic models. Maybe you are writing a plugin or a library that extends
Authlogic.
</p>
<p>
That being said, in this environment there is no controller. So you need to
use a &quot;mock&quot; controller. Something that looks like a controller,
acts like a controller, but isn&#8217;t a &quot;real&quot; controller. You
are essentially connecting Authlogic to your &quot;mock&quot; controller,
then you can test off of the mock controller to make sure everything is
functioning properly.
</p>
<p>
I use a mock controller to test Authlogic myself. It&#8217;s part of the
Authlogic library that you can easily use. It&#8217;s as simple as
functional and integration tests. Just do the following:
</p>
<pre class="code">
  <span class='setup identifier id'>setup</span> <span class='symbol val'>:activate_authlogic</span>
</pre>
<p>
You also get a controller method that you can test off of. For example:
</p>
<pre class="code">
  <span class='ben identifier id'>ben</span> <span class='assign token'>=</span> <span class='users identifier id'>users</span><span class='lparen token'>(</span><span class='symbol val'>:ben</span><span class='rparen token'>)</span>
  <span class='assert_nil identifier id'>assert_nil</span> <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='string val'>&quot;user_credentials&quot;</span><span class='rbrack token'>]</span>
  <span class='assert identifier id'>assert</span> <span class='UserSession constant id'>UserSession</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='ben identifier id'>ben</span><span class='rparen token'>)</span>
  <span class='assert_equal identifier id'>assert_equal</span> <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='string val'>&quot;user_credentials&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='ben identifier id'>ben</span><span class='dot token'>.</span><span class='persistence_token identifier id'>persistence_token</span>
</pre>
<p>
See how I am checking that Authlogic is interacting with the controller
properly? That&#8217;s the idea here.
</p>

</div><div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#activate_authlogic-instance_method">#activate_authlogic</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Activates authlogic so that you can use it in your tests.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#controller-instance_method">#controller</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The Authlogic::TestCase::MockController object passed to Authlogic to
activate it.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>activate_authlogic</h3>
</div><div id="activate_authlogic-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>activate_authlogic</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Activates authlogic so that you can use it in your tests. You should call
this method in your test&#8217;s setup. Ex:
</p>
<pre class="code">
  <span class='setup identifier id'>setup</span> <span class='symbol val'>:activate_authlogic</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/authlogic/test_case.rb', line 102</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/binarylogic/authlogic/blob/58d726d15ba1e5411b3cfecb23792f370b845bd2/lib/authlogic/test_case.rb#L102">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">102
103
104</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='activate_authlogic identifier id'>activate_authlogic</span>
  <span class='Authlogic constant id'>Authlogic</span><span class='colon2 op'>::</span><span class='Session constant id'>Session</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='controller identifier id'>controller</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='@request ivar id'>@request</span> <span class='andop op'>&amp;&amp;</span> <span class='Authlogic constant id'>Authlogic</span><span class='colon2 op'>::</span><span class='TestCase constant id'>TestCase</span><span class='colon2 op'>::</span><span class='RailsRequestAdapter constant id'>RailsRequestAdapter</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@request ivar id'>@request</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='controller identifier id'>controller</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>controller</h3>
</div><div id="controller-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>controller</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The Authlogic::TestCase::MockController object passed to Authlogic to
activate it. You can access this in your test. See the module description
for an example.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/authlogic/test_case.rb', line 108</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/binarylogic/authlogic/blob/58d726d15ba1e5411b3cfecb23792f370b845bd2/lib/authlogic/test_case.rb#L108">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">108
109
110</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='controller identifier id'>controller</span>
  <span class='@controller ivar id'>@controller</span> <span class='opasgn op'>||=</span> <span class='Authlogic constant id'>Authlogic</span><span class='colon2 op'>::</span><span class='TestCase constant id'>TestCase</span><span class='colon2 op'>::</span><span class='MockController constant id'>MockController</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>