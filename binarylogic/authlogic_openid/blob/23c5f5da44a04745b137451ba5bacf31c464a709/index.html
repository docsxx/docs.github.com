<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>binarylogic's authlogic_openid - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/binarylogic/commits/authlogic_openid/master" rel="alternate" title="Recent Commits to authlogic_openid:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("binarylogic", "authlogic_openid", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='binarylogic/authlogic_openid/blob/23c5f5da44a04745b137451ba5bacf31c464a709' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='binarylogic/authlogic_openid/blob/23c5f5da44a04745b137451ba5bacf31c464a709' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("binarylogic", "authlogic_openid", "23c5f5da44a04745b137451ba5bacf31c464a709", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/binarylogic/authlogic_openid/tree/">Source</a></li>
            <li class=""><a href="http://github.com/binarylogic/authlogic_openid/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/binarylogic/authlogic_openid/network">Network</a></li>            
            <li class=""><a href="http://github.com/binarylogic/authlogic_openid/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/binarylogic/authlogic_openid">Wiki</a></li>
            <li class=""><a href="http://github.com/binarylogic/authlogic_openid/graphs">Graphs</a></li>                    
            <li class="active"><a href="/binarylogic/authlogic_openid">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/binarylogic">binarylogic</a> / <b><a href="http://github.com/binarylogic/authlogic_openid/tree">authlogic_openid</a></b>        
                <a id="namespaces_button" rel="binarylogic/authlogic_openid/blob/23c5f5da44a04745b137451ba5bacf31c464a709" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="binarylogic/authlogic_openid/blob/23c5f5da44a04745b137451ba5bacf31c464a709" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Authlogic OpenID</h1>
<p>
Authlogic OpenID is an extension of the Authlogic library to add OpenID
support. Authlogic v2.0 introduced an enhanced API that makes
&quot;plugging in&quot; alternate authentication methods as easy as
installing a gem.
</p>
<h2>Helpful links</h2>
<ul>
<li><b>Documentation:</b> http://authlogic-oid.rubyforge.org

</li>
<li><b>Authlogic:</b> http://github.com/binarylogic/authlogic

</li>
<li><b>Live example:</b> http://authlogicexample.binarylogic.com

</li>
</ul>
<h2>Install and use</h2>
<h3>1. Make some simple changes to your database:</h3>
<pre class="code">
  <span class='class class kw'>class</span> <span class='AddUsersOpenidField constant id'>AddUsersOpenidField</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Migration constant id'>Migration</span>
    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='up identifier id'>up</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:openid_identifier</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='add_index identifier id'>add_index</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:openid_identifier</span>

      <span class='change_column identifier id'>change_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:login</span><span class='comma token'>,</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:default</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:null</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
      <span class='change_column identifier id'>change_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:crypted_password</span><span class='comma token'>,</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:default</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:null</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
      <span class='change_column identifier id'>change_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:password_salt</span><span class='comma token'>,</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:default</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:null</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='down identifier id'>down</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:openid_identifier</span>

      <span class='lbrack token'>[</span><span class='symbol val'>:login</span><span class='comma token'>,</span> <span class='symbol val'>:crypted_password</span><span class='comma token'>,</span> <span class='symbol val'>:password_salt</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='bitor op'>|</span>
        <span class='User constant id'>User</span><span class='dot token'>.</span><span class='all identifier id'>all</span><span class='lparen token'>(</span><span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{field} is NULL&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='user identifier id'>user</span><span class='bitor op'>|</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='update_attribute identifier id'>update_attribute</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='rbrace token'>}</span>
        <span class='change_column identifier id'>change_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:default</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:null</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<h3>2. Install the openid_authentication plugin</h3>
<pre class="code">
  $ <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='rails identifier id'>rails</span><span class='div op'>/</span><span class='open_id_authentication identifier id'>open_id_authentication</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
  $ <span class='rake identifier id'>rake</span> <span class='open_id_authentication identifier id'>open_id_authentication</span><span class='symbol val'>:db</span><span class='symbol val'>:create</span>
</pre>
<p>
For more information on how to configure the plugin, checkout it&#8217;s
README: http://github.com/rails/open_id_authentication/tree/master
</p>
<h3>3. Install the Authlogic Openid gem</h3>
<pre class="code">
  $ <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='authlogic identifier id'>authlogic</span><span class='minus op'>-</span><span class='oid identifier id'>oid</span>
</pre>
<p>
Now add the gem dependency in your config:
</p>
<pre class="code">
  <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>&quot;authlogic-oid&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:lib</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;authlogic_openid&quot;</span>
</pre>
<p>
Or for older version of rails, install it as a plugin:
</p>
<pre class="code">
  $ <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='binarylogic identifier id'>binarylogic</span><span class='div op'>/</span><span class='authlogic_openid identifier id'>authlogic_openid</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<h3>4. Make sure you save your objects properly</h3>
<p>
You only need to save your objects this way if you want the user to
authenticate with their OpenID provider.
</p>
<p>
That being said, you probably want to do this in your controllers. You
should do this for BOTH your User objects and UserSession objects (assuming
you are authenticating users). It should look something like this:
</p>
<pre class="code">
  <span class='@user_session ivar id'>@user_session</span><span class='dot token'>.</span><span class='save identifier id'>save</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='result identifier id'>result</span>
      <span class='flash identifier id'>flash</span><span class='lbrack token'>[</span><span class='symbol val'>:notice</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;Login successful!&quot;</span>
      <span class='redirect_back_or_default identifier id'>redirect_back_or_default</span> <span class='account_url identifier id'>account_url</span>
    <span class='else else kw'>else</span>
      <span class='render identifier id'>render</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:new</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
You should save your @user objects this way as well, because you also want
the user to verify that they own the OpenID identifier that they supplied.
</p>
<p>
Notice we are saving with a block. Why? Because we need to redirect the
user to their OpenID provider so that they can authenticate. When we do
this, we don&#8217;t want to execute that block of code, because if we do,
we will get a DoubleRender error. This lets us skip that entire block and
send the user along their way without any problems.
</p>
<p>
That&#8217;s it! The rest is taken care of for you.
</p>
<h2>Redirecting from the models?</h2>
<p>
If you are interested, I explain myself below. Regardless, if you
don&#8217;t feel comfortable with the organization of the logic,you can
easily do this using the traditional method. As you saw in the setup
instructions, this library leverages the open_id_authentication rails
plugin. After the user has been authenticated just do this:
</p>
<pre class="code">
  <span class='UserSession constant id'>UserSession</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='@user ivar id'>@user</span><span class='rparen token'>)</span>
</pre>
<p>
It&#8217;s that simple. For more information there is a great OpenID
tutorial at: http://railscasts.com/episodes/68-openid-authentication
</p>
<p>
Now, here are my thoughts on the subject:
</p>
<p>
You are probably thinking: &quot;Ben, you can&#8217;t handle controller
responsibilities in models&quot;. I agree with you on that comment, but my
personal opinion is that these are not controller responsibilities. The
fact that OpenID authentication requires a redirect should not effect the
location of the logic / code. It&#8217;s all part of the authentication
process, which is the entire purpose of this library. This library is not
one big module of code, its a collection of modules that all deal with
OpenID authentication. These modules get included wherever it makes sense.
That&#8217;s the whole idea behind modules. To group common logic.
</p>
<p>
Let&#8217;s take a step back and look at the traditional method of OpenID
authentication in rails. What if you wanted to authenticate with OpenID in
multiple controllers in your application (Ex: registration and loggin in)?
You would probably pull out the common code into a module and include it in
the respective controllers. Even better, you might create a class that
elegantly handles this process and then place it in your lib directory.
Then, if you really wanted to be slick, you might take it another step
further and have your models trigger this class during certain actions.
Then what do we have? This exact library, that&#8217;s exactly what this
is.
</p>
<p>
The last thing I will leave you with, to get you thinking, is&#8230; where
do sweepers lie in the MVC pattern? Without this, things like caching would
be extremely difficult. There is a big difference between misplacing code /
logic, and organizing logic into a separate module and hooking it in using
the API provided by your models. Especially when the logic needs to be
triggered by actions invoked on models.
</p>
<p>
Regardless, if I still haven&#8217;t convinced you, I hope this library is
of some benefit to you. At the very least an example of how to extend
Authlogic.
</p>
<p>
Copyright &#169; 2009 Ben Johnson of [Binary
Logic](http://www.binarylogic.com), released under the MIT license
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>