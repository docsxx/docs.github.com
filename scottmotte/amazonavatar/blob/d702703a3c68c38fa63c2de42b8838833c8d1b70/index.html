<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>scottmotte's amazonavatar - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/scottmotte/commits/amazonavatar/master" rel="alternate" title="Recent Commits to amazonavatar:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("scottmotte", "amazonavatar", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='scottmotte/amazonavatar/blob/d702703a3c68c38fa63c2de42b8838833c8d1b70' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='scottmotte/amazonavatar/blob/d702703a3c68c38fa63c2de42b8838833c8d1b70' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("scottmotte", "amazonavatar", "d702703a3c68c38fa63c2de42b8838833c8d1b70", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/scottmotte/amazonavatar/tree/">Source</a></li>
            <li class=""><a href="http://github.com/scottmotte/amazonavatar/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/scottmotte/amazonavatar/network">Network</a></li>            
            <li class=""><a href="http://github.com/scottmotte/amazonavatar/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/scottmotte/amazonavatar">Wiki</a></li>
            <li class=""><a href="http://github.com/scottmotte/amazonavatar/graphs">Graphs</a></li>                    
            <li class="active"><a href="/scottmotte/amazonavatar">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/scottmotte">scottmotte</a> / <b><a href="http://github.com/scottmotte/amazonavatar/tree">amazonavatar</a></b>        
                <a id="namespaces_button" rel="scottmotte/amazonavatar/blob/d702703a3c68c38fa63c2de42b8838833c8d1b70" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="scottmotte/amazonavatar/blob/d702703a3c68c38fa63c2de42b8838833c8d1b70" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>AmazonAvatar</h1>
<p>
Upload avatars to amazonS3 on a User (or other) model. Simple and
opinionated.
</p>
<h2>Notes</h2>
<ul>
<li>rdoc is at: http://rdoc.info/projects/scottmotte/amazonavatar

</li>
<li>I&#8217;m using it with merb and mongomapper.

</li>
<li>Does resizing using minimagick

</li>
<li>Uploads the images to your s3 account at / avatars / user_id /
[original.png,thumb.png,mini.png]

</li>
<li>Resizes a thumb to 48x48, and mini to 24x24. I told you it was opinionated.

</li>
</ul>
<h2>Dependencies</h2>
<ul>
<li>right_aws

</li>
<li>mini_magick

</li>
</ul>
<h2>Requirements</h2>
<p>
You must have ImageMagick installed.
</p>
<p>
On leopard
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='port identifier id'>port</span> <span class='install identifier id'>install</span> <span class='tiff identifier id'>tiff</span> <span class='minus op'>-</span><span class='macosx identifier id'>macosx</span>  <span class='comment val'>#disables the linkage with Apple's open gl</span>
  <span class='sudo identifier id'>sudo</span> <span class='port identifier id'>port</span> <span class='install identifier id'>install</span> <span class='ImageMagick constant id'>ImageMagick</span>
</pre>
<p>
On ubuntu
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='apt identifier id'>apt</span><span class='minus op'>-</span><span class='get identifier id'>get</span> <span class='install identifier id'>install</span> <span class='build identifier id'>build</span><span class='minus op'>-</span><span class='essential identifier id'>essential</span> <span class='libmagickcore identifier id'>libmagickcore</span><span class='minus op'>-</span><span class='dev identifier id'>dev</span> <span class='imagemagick identifier id'>imagemagick</span> <span class='libpcre3 identifier id'>libpcre3</span> <span class='libfcgi identifier id'>libfcgi</span><span class='minus op'>-</span><span class='dev identifier id'>dev</span> <span class='libfcgi0ldbl identifier id'>libfcgi0ldbl</span> <span class='libxml2 identifier id'>libxml2</span><span class='minus op'>-</span><span class='dev identifier id'>dev</span> <span class='libxslt1 identifier id'>libxslt1</span><span class='minus op'>-</span><span class='dev identifier id'>dev</span> <span class='minus op'>-</span><span class='y identifier id'>y</span>
</pre>
<h2>Installation</h2>
<p>
On your computer
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='sources identifier id'>sources</span> <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
  sudo gem install scottmotte-amazonavatar
</span></pre>
<p>
Or for bundling
</p>
<pre class="code">
  <span class='dependency identifier id'>dependency</span> <span class='string val'>'scottmotte-amazonavatar'</span><span class='comma token'>,</span> <span class='symbol val'>:require_as</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'amazonavatar'</span>
</pre>
<h2>Configuration</h2>
<p>
Tell AmazonAvatar your S3 information.
</p>
<pre class="code">
  <span class='AmazonAvatar constant id'>AmazonAvatar</span><span class='dot token'>.</span><span class='access_key_id identifier id'>access_key_id</span> <span class='assign token'>=</span> <span class='string val'>&quot;your_access_key_id&quot;</span>
  <span class='AmazonAvatar constant id'>AmazonAvatar</span><span class='dot token'>.</span><span class='secret_access_key identifier id'>secret_access_key</span> <span class='assign token'>=</span> <span class='string val'>&quot;your_secret_access_key&quot;</span>
  <span class='AmazonAvatar constant id'>AmazonAvatar</span><span class='dot token'>.</span><span class='bucket_name identifier id'>bucket_name</span> <span class='assign token'>=</span> <span class='string val'>&quot;yourdatabase_development&quot;</span>
  <span class='comment val'># I put these in init.rb in the after_app_loads block for Merb. Probably put them in your environment.rb file for Rails.</span>
</pre>
<p>
In user.rb model
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='User constant id'>User</span>
    <span class='include identifier id'>include</span> <span class='AmazonAvatar constant id'>AmazonAvatar</span><span class='colon2 op'>::</span><span class='Uploader constant id'>Uploader</span>
    <span class='dot3 op'>...</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In your users.rb controller put use the put_avatar instance method.
@user.put_avatar.
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='update_avatar identifier id'>update_avatar</span><span class='lparen token'>(</span><span class='avatar identifier id'>avatar</span><span class='rparen token'>)</span>
    <span class='@user ivar id'>@user</span> <span class='assign token'>=</span> <span class='@current_user ivar id'>@current_user</span>
    <span class='raise identifier id'>raise</span> <span class='NotFound constant id'>NotFound</span> <span class='unless unless_mod kw'>unless</span> <span class='@user ivar id'>@user</span>
    <span class='if if kw'>if</span> <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='put_avatar identifier id'>put_avatar</span><span class='lparen token'>(</span><span class='avatar identifier id'>avatar</span><span class='rparen token'>)</span>
      <span class='redirect identifier id'>redirect</span> <span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='@user ivar id'>@user</span><span class='comma token'>,</span> <span class='symbol val'>:edit</span><span class='rparen token'>)</span><span class='comma token'>,</span>  <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:notice</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Avatar was updated&quot;</span><span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='redirect identifier id'>redirect</span> <span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='@user ivar id'>@user</span><span class='comma token'>,</span> <span class='symbol val'>:edit</span><span class='rparen token'>)</span><span class='comma token'>,</span>  <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Avatar failed to be uploaded&quot;</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In global_helpers.rb
</p>
<pre class="code">
  <span class='module module kw'>module</span> <span class='Merb constant id'>Merb</span>
    <span class='module module kw'>module</span> <span class='GlobalHelpers constant id'>GlobalHelpers</span>
      <span class='include identifier id'>include</span> <span class='AmazonAvatar constant id'>AmazonAvatar</span><span class='colon2 op'>::</span><span class='Helpers constant id'>Helpers</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
This will give you the avatar_path helper which you can use with
rails&#8217;, sinatra&#8217;s, merb&#8217;s, etc&#8217;s image_tag helper.
Just pass in the id of the user to render his avatar.
</p>
<p>
Also, you should add a default avatar to each user when they signup. The
Paperclip gem does this by pointing to the missing.png avatar by storing
the path to the avatar in the user table. This simple gem does not store
the path in the database. What&#8217;s the point. Instead you have to
generate the default thumb for each user. There&#8217;s an instance method
for this.
</p>
<pre class="code">
  <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='generate_default_avatar identifier id'>generate_default_avatar</span>
</pre>
<p>
You can use it like so:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='user identifier id'>user</span><span class='rparen token'>)</span>
    <span class='comment val'># session.abandon!</span>
    <span class='@user ivar id'>@user</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='user identifier id'>user</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
        <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='generate_default_avatar identifier id'>generate_default_avatar</span>
        <span class='send_mail identifier id'>send_mail</span><span class='lparen token'>(</span><span class='UserMailer constant id'>UserMailer</span><span class='comma token'>,</span> <span class='symbol val'>:signup</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='symbol val'>:from</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='AppConfig constant id'>AppConfig</span><span class='dot token'>.</span><span class='site identifier id'>site</span><span class='dot token'>.</span><span class='email identifier id'>email</span><span class='comma token'>,</span> <span class='symbol val'>:to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='email identifier id'>email</span><span class='comma token'>,</span> <span class='symbol val'>:subject</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Twinstang welcome&quot;</span> <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='symbol val'>:user</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@user ivar id'>@user</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
      <span class='redirect identifier id'>redirect</span> <span class='string val'>'/login'</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:notice</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Signup successful. Log in.&quot;</span><span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='message identifier id'>message</span><span class='lbrack token'>[</span><span class='symbol val'>:error</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;Signup failed&quot;</span>
      <span class='render identifier id'>render</span> <span class='symbol val'>:new</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Better yet wrap it in a run_later method in merb or put it in a background
job in rails.
</p>
<pre class="code">
  <span class='dot3 op'>...</span>
  <span class='if if kw'>if</span> <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='run_later identifier id'>run_later</span> <span class='do do kw'>do</span>
      <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='generate_default_avatar identifier id'>generate_default_avatar</span>
      <span class='send_mail identifier id'>send_mail</span><span class='lparen token'>(</span><span class='UserMailer constant id'>UserMailer</span><span class='comma token'>,</span> <span class='symbol val'>:signup</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='symbol val'>:from</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='AppConfig constant id'>AppConfig</span><span class='dot token'>.</span><span class='site identifier id'>site</span><span class='dot token'>.</span><span class='email identifier id'>email</span><span class='comma token'>,</span> <span class='symbol val'>:to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='email identifier id'>email</span><span class='comma token'>,</span> <span class='symbol val'>:subject</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Twinstang welcome&quot;</span> <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='symbol val'>:user</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@user ivar id'>@user</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='dot3 op'>...</span>
</pre>
<h2>Usage</h2>
<p>
AmazonAvatar.access_key_id = AppConfig.s3.access_key_id # set your key
AmazonAvatar.secret_access_key = AppConfig.s3.secret_access_key # set your
secret AmazonAvatar.bucket_name = AppConfig.s3.bucket # set the bucket
@user.put_avatar(avatar) # where avatar is the file_field value
@user.generate_default_avatar # for generating the default avatar from
amazonavatar/default.png
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>