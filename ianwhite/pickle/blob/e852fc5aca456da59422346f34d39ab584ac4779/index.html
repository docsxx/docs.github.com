<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>ianwhite's pickle - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/ianwhite/commits/pickle/master" rel="alternate" title="Recent Commits to pickle:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("ianwhite", "pickle", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='ianwhite/pickle/blob/e852fc5aca456da59422346f34d39ab584ac4779' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='ianwhite/pickle/blob/e852fc5aca456da59422346f34d39ab584ac4779' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("ianwhite", "pickle", "e852fc5aca456da59422346f34d39ab584ac4779", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/ianwhite/pickle/tree/">Source</a></li>
            <li class=""><a href="http://github.com/ianwhite/pickle/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/ianwhite/pickle/network">Network</a></li>            
            <li class=""><a href="http://github.com/ianwhite/pickle/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/ianwhite/pickle">Wiki</a></li>
            <li class=""><a href="http://github.com/ianwhite/pickle/graphs">Graphs</a></li>                    
            <li class="active"><a href="/ianwhite/pickle">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/ianwhite">ianwhite</a> / <b><a href="http://github.com/ianwhite/pickle/tree">pickle</a></b>        
                <a id="namespaces_button" rel="ianwhite/pickle/blob/e852fc5aca456da59422346f34d39ab584ac4779" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="ianwhite/pickle/blob/e852fc5aca456da59422346f34d39ab584ac4779" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>pickle</h1>
<p>
Pickle gives you cucumber steps that create your models easily from
factory-girl or machinist factories/blueprints. You can also just use
ActiveRecord but it&#8217;s not as cool.
</p>
<p>
References to the models are stored, not necessarily for the purpose of
checking the db (although you could use it for that), but for enabling easy
reference to urls, and for building complex givens which require a bunch of
models collaborating
</p>
<h2>CI</h2>
<p>
It&#8217;s tested against all stable branches of 2.x rails, and edge, with
the latest versions of rspec, cucumber, factory_girl, machinist.
</p>
<h2>Install</h2>
<p>
Install pickle either as a rails plugin, or a gem
</p>
<pre class="code">
  <span class='comment val'># plugin</span>
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/i</span><span class='anwhite identifier id'>anwhite</span><span class='div op'>/</span><span class='pickle identifier id'>pickle</span><span class='dot token'>.</span><span class='git identifier id'>git</span>

  <span class='comment val'># or, plugin as submodule</span>
  <span class='git identifier id'>git</span> <span class='submodule identifier id'>submodule</span> <span class='add identifier id'>add</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/i</span><span class='anwhite identifier id'>anwhite</span><span class='div op'>/</span><span class='pickle identifier id'>pickle</span><span class='dot token'>.</span><span class='git identifier id'>git</span> <span class='vendor identifier id'>vendor</span><span class='div op'>/</span><span class='plugins identifier id'>plugins</span><span class='div op'>/</span><span class='pickle identifier id'>pickle</span>

  <span class='comment val'># or, gem</span>
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='ianwhite identifier id'>ianwhite</span><span class='minus op'>-</span><span class='pickle identifier id'>pickle</span>
</pre>
<h2>Get Started</h2>
<p>
(you&#8217;d better install cucumber)
</p>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='pickle identifier id'>pickle</span> <span class='lbrack token'>[</span><span class='paths identifier id'>paths</span><span class='rbrack token'>]</span> <span class='lbrack token'>[</span><span class='email identifier id'>email</span><span class='rbrack token'>]</span>
</pre>
<p>
Now have a look at <tt>features/step_definitions/pickle_steps.rb</tt>
</p>
<p>
If you want path steps and email steps then just add &#8216;paths&#8217;
and/or &#8216;email&#8217;. The code/steps will be written to
<tt>features/env/paths.rb</tt> and
<tt>features/step_definitions/email_steps.rb</tt> respectively.
</p>
<h3>Using with plain ole Active Record</h3>
<p>
If you have an AR called &#8216;Post&#8217;, with required fields
&#8216;title&#8217;, and &#8216;body&#8217;, then you can now write steps
like this
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='post identifier id'>post</span> <span class='exists identifier id'>exists</span> <span class='with identifier id'>with</span> <span class='title identifier id'>title</span><span class='colon op'>:</span> <span class='string val'>&quot;My Post&quot;</span><span class='comma token'>,</span> <span class='body identifier id'>body</span><span class='colon op'>:</span> <span class='string val'>&quot;My body&quot;</span>
</pre>
<h3>Using with factory-girl or machinist</h3>
<p>
But you&#8217;re using Machinist or FactoryGirl right?! To leverage all of
the factories/blueprints you&#8217;ve written, you can just do stuff like
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span>
  <span class='And constant id'>And</span> <span class='another identifier id'>another</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span> <span class='with identifier id'>with</span> <span class='role identifier id'>role</span><span class='colon op'>:</span> <span class='string val'>&quot;admin&quot;</span>

  <span class='comment val'># later</span>
  <span class='Then constant id'>Then</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span> <span class='with identifier id'>with</span> <span class='name identifier id'>name</span><span class='colon op'>:</span> <span class='string val'>&quot;Fred&quot;</span>
  <span class='And constant id'>And</span> <span class='that identifier id'>that</span> <span class='user identifier id'>user</span> <span class='should identifier id'>should</span> <span class='be identifier id'>be</span> <span class='activated identifier id'>activated</span> <span class='comment val'># this uses rspec predicate matchers</span>
</pre>
<h4>Machinst: require your blueprints and reset Shams</h4>
<p>
(The latest version of pickle supports <tt>blueprints</tt>[http://github.com/notahat/machinist/commit/d6492e6927a8aa1819926e48b22377171fd20496],
for earlier versions of machinist use pickle &lt;= 0.1.10)
</p>
<p>
In your <tt>features/support/env.rb</tt> add the following lines at the
bottom
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='dstring node'>&quot;#{Rails.root}/spec/blueprints&quot;</span> <span class='comment val'># or wherever they live</span>
  <span class='Before constant id'>Before</span> <span class='lbrace token'>{</span> <span class='Sham constant id'>Sham</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span> <span class='rbrace token'>}</span> <span class='comment val'># reset Shams in between scenarios</span>
</pre>
<h3>Configuring Pickle</h3>
<p>
You can tell pickle to use another factory adapter (see Pickle::Adapter),
or create mappings from english expressions to pickle model names. You can
also override many of the options on the Pickle::Config object if you so
choose
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'pickle/world'</span>

  <span class='Pickle constant id'>Pickle</span><span class='dot token'>.</span><span class='configure identifier id'>configure</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='config identifier id'>config</span><span class='bitor op'>|</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='adapters identifier id'>adapters</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='symbol val'>:machinist</span><span class='comma token'>,</span> <span class='YourOwnAdapterClass constant id'>YourOwnAdapterClass</span><span class='rbrack token'>]</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='string val'>'me'</span><span class='comma token'>,</span> <span class='string val'>'myself'</span><span class='comma token'>,</span> <span class='string val'>'my'</span><span class='comma token'>,</span> <span class='string val'>'I'</span><span class='comma token'>,</span> <span class='symbol val'>:to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'user: &quot;me&quot;'</span>
  <span class='end end kw'>end</span>
</pre>
<h2>API</h2>
<h3>Steps</h3>
<p>
When you run <tt>script/generate pickle</tt> you get the following steps
</p>
<h4>Given steps</h4>
<p>
&quot;Given <b>a model</b> exists&quot;, e.g.
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span>
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span><span class='colon op'>:</span> <span class='string val'>&quot;fred&quot;</span> <span class='exists identifier id'>exists</span>
  <span class='Given constant id'>Given</span> <span class='the identifier id'>the</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span>
</pre>
<p>
&quot;Given <b>a model</b> exists with <b>fields</b>&quot;, e.g.
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span> <span class='with identifier id'>with</span> <span class='name identifier id'>name</span><span class='colon op'>:</span> <span class='string val'>&quot;Fred&quot;</span>
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span> <span class='with identifier id'>with</span> <span class='name identifier id'>name</span><span class='colon op'>:</span> <span class='string val'>&quot;Fred&quot;</span><span class='comma token'>,</span> <span class='activated identifier id'>activated</span><span class='colon op'>:</span> <span class='false false kw'>false</span>
</pre>
<p>
You can refer to other models in the fields
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span>
  <span class='And constant id'>And</span> <span class='a identifier id'>a</span> <span class='post identifier id'>post</span> <span class='exists identifier id'>exists</span> <span class='with identifier id'>with</span> <span class='author identifier id'>author</span><span class='colon op'>:</span> <span class='the identifier id'>the</span> <span class='user identifier id'>user</span>

  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='person identifier id'>person</span><span class='colon op'>:</span> <span class='string val'>&quot;fred&quot;</span> <span class='exists identifier id'>exists</span>
  <span class='And constant id'>And</span> <span class='a identifier id'>a</span> <span class='person identifier id'>person</span><span class='colon op'>:</span> <span class='string val'>&quot;ethel&quot;</span> <span class='exists identifier id'>exists</span>
  <span class='And constant id'>And</span> <span class='a identifier id'>a</span> <span class='fatherhood identifier id'>fatherhood</span> <span class='exists identifier id'>exists</span> <span class='with identifier id'>with</span> <span class='parent identifier id'>parent</span><span class='colon op'>:</span> <span class='user identifier id'>user</span> <span class='string val'>&quot;fred&quot;</span><span class='comma token'>,</span> <span class='child identifier id'>child</span><span class='colon op'>:</span> <span class='user identifier id'>user</span> <span class='string val'>&quot;ethel&quot;</span>
</pre>
<p>
&quot;Given <b>n</b> models exist&quot;, e.g.
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='integer val'>10</span> <span class='users identifier id'>users</span> <span class='exist identifier id'>exist</span>
</pre>
<p>
&quot;Given <b>n</b> <b>models</b> exist with <b>fields</b>&quot;,
examples:
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='integer val'>10</span> <span class='users identifier id'>users</span> <span class='exist identifier id'>exist</span> <span class='with identifier id'>with</span> <span class='activated identifier id'>activated</span><span class='colon op'>:</span> <span class='false false kw'>false</span>
</pre>
<h4>Then steps</h4>
<h5>Asserting existence of models</h5>
<p>
&quot;Then <b>a model</b> should exist&quot;, e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span>
</pre>
<p>
&quot;Then <b>a model</b> should exist with <b>fields</b>&quot;, e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span><span class='colon op'>:</span> <span class='string val'>&quot;fred&quot;</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span> <span class='with identifier id'>with</span> <span class='name identifier id'>name</span><span class='colon op'>:</span> <span class='string val'>&quot;Fred&quot;</span> <span class='comment val'># we can label the found user for later use</span>
</pre>
<p>
You can use other models, booleans, numerics, and strings as fields
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='a identifier id'>a</span> <span class='person identifier id'>person</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span> <span class='with identifier id'>with</span> <span class='child identifier id'>child</span><span class='colon op'>:</span> <span class='person identifier id'>person</span> <span class='string val'>&quot;ethel&quot;</span>
  <span class='Then constant id'>Then</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span> <span class='with identifier id'>with</span> <span class='activated identifier id'>activated</span><span class='colon op'>:</span> <span class='false false kw'>false</span>
  <span class='Then constant id'>Then</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span> <span class='with identifier id'>with</span> <span class='activated identifier id'>activated</span><span class='colon op'>:</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='email identifier id'>email</span><span class='colon op'>:</span> <span class='string val'>&quot;fred@gmail.com&quot;</span>
</pre>
<p>
&quot;Then <b>n</b> <b>models</b> should exist&quot;, e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='integer val'>10</span> <span class='events identifier id'>events</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span>
</pre>
<p>
&quot;Then <b>n</b> <b>models</b> should exist with <b>fields</b>&quot;,
e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='integer val'>2</span> <span class='people identifier id'>people</span> <span class='should identifier id'>should</span> <span class='exist identifier id'>exist</span> <span class='with identifier id'>with</span> <span class='father identifier id'>father</span><span class='colon op'>:</span> <span class='person identifier id'>person</span> <span class='string val'>&quot;fred&quot;</span>
</pre>
<h5>Asserting associations</h5>
<p>
One-to-one assocs: &quot;Then <b>a model</b> should be <b>other
model</b>&#8217;s <b>association</b>&quot;, e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='the identifier id'>the</span> <span class='person identifier id'>person</span><span class='colon op'>:</span> <span class='string val'>&quot;fred&quot;</span> <span class='should identifier id'>should</span> <span class='be identifier id'>be</span> <span class='person identifier id'>person</span><span class='colon op'>:</span> <span class='string val'>&quot;ethel&quot;</span><span class='string val'>'s father
</span></pre>
<p>
Many-to-one assocs: &quot;Then <b>a model</b> should be [in|one of]
<b>other model</b>&#8217;s <b>association</b>&quot;, e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='the identifier id'>the</span> <span class='person identifier id'>person</span><span class='colon op'>:</span> <span class='string val'>&quot;ethel&quot;</span> <span class='should identifier id'>should</span> <span class='be identifier id'>be</span> <span class='one identifier id'>one</span> <span class='of identifier id'>of</span> <span class='person identifier id'>person</span><span class='colon op'>:</span> <span class='string val'>&quot;fred&quot;</span><span class='string val'>'s children
  Then the comment should be in the post'</span><span class='s identifier id'>s</span> <span class='comments identifier id'>comments</span>
</pre>
<h5>Asserting predicate methods</h5>
<p>
&quot;Then <b>a model</b> should [be|have] [a|an] <b>predicate</b>&quot;,
e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='the identifier id'>the</span> <span class='user identifier id'>user</span> <span class='should identifier id'>should</span> <span class='have identifier id'>have</span> <span class='a identifier id'>a</span> <span class='status identifier id'>status</span> <span class='comment val'># =&gt; user.status?.should == true</span>
  <span class='Then constant id'>Then</span> <span class='the identifier id'>the</span> <span class='car identifier id'>car</span><span class='colon op'>:</span> <span class='string val'>&quot;batmobile&quot;</span> <span class='should identifier id'>should</span> <span class='be identifier id'>be</span> <span class='fast identifier id'>fast</span> <span class='comment val'># =&gt; car.fast?.should == true</span>
</pre>
<p>
&quot;Then <b>a model</b> should [be|have] [a|an] <b>predicate</b>&quot;,
e.g.
</p>
<pre class="code">
  <span class='Then constant id'>Then</span> <span class='person identifier id'>person</span><span class='colon op'>:</span> <span class='string val'>&quot;fred&quot;</span> <span class='should identifier id'>should</span> <span class='not not kw'>not</span> <span class='be identifier id'>be</span> <span class='childless identifier id'>childless</span> <span class='comment val'># =&gt; fred.childless?.should == false</span>
</pre>
<h3>Regexps for use in your own steps</h3>
<p>
By default you get some regexps available in the main namespace for use in
creating your own steps: `capture_model`, `capture_fields`, and others (see
lib/pickle.rb)
</p>
<p>
(You can use any of the regexps that Pickle uses by using the Pickle.parser
namespace, see Pickle::Parser::Matchers for the methods available)
</p>
<p>
<b>capture_model</b>
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='dregexp node'>/^#{capture_model} exists$/</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='model_name identifier id'>model_name</span><span class='bitor op'>|</span>
    <span class='model identifier id'>model</span><span class='lparen token'>(</span><span class='model_name identifier id'>model_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='should_not identifier id'>should_not</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>

  <span class='Then constant id'>Then</span> <span class='regexp val'>/^I should be at the (.*?) page$/</span> <span class='bitor op'>|</span><span class='page identifier id'>page</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='page identifier id'>page</span> <span class='match op'>=~</span> <span class='dregexp node'>/#{capture_model}'s/</span>
      <span class='url_for identifier id'>url_for</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='lparen token'>(</span><span class='$1 nth_ref id'>$1</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># ...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='Then constant id'>Then</span> <span class='dregexp node'>/^#{capture_model} should be one of #{capture_model}'s posts$/</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='post identifier id'>post</span><span class='comma token'>,</span> <span class='forum identifier id'>forum</span><span class='bitor op'>|</span>
    <span class='model identifier id'>model</span><span class='lparen token'>(</span><span class='forum identifier id'>forum</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='posts identifier id'>posts</span><span class='dot token'>.</span><span class='should identifier id'>should</span> <span class='include identifier id'>include</span><span class='lparen token'>(</span><span class='post identifier id'>post</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<p>
<b>capture_fields</b>
</p>
<p>
This is useful for setting attributes, and knows about pickle model names
so that you can build up composite objects with ease
</p>
<pre class="code">
  <span class='Given constant id'>Given</span> <span class='dregexp node'>/^#{capture_model} exists with #{capture_fields}$/</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='model_name identifier id'>model_name</span><span class='comma token'>,</span> <span class='fields identifier id'>fields</span><span class='bitor op'>|</span>
    <span class='create_model identifier id'>create_model</span><span class='lparen token'>(</span><span class='model_name identifier id'>model_name</span><span class='comma token'>,</span> <span class='fields identifier id'>fields</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># example of use</span>
  <span class='Given constant id'>Given</span> <span class='a identifier id'>a</span> <span class='user identifier id'>user</span> <span class='exists identifier id'>exists</span>
  <span class='And constant id'>And</span> <span class='a identifier id'>a</span> <span class='post identifier id'>post</span> <span class='exists identifier id'>exists</span> <span class='with identifier id'>with</span> <span class='author identifier id'>author</span><span class='colon op'>:</span> <span class='the identifier id'>the</span> <span class='user identifier id'>user</span> <span class='comment val'># this step will assign the above user as :author on the post</span>
</pre>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>