<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>pluginaweek's state_machine - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/pluginaweek/commits/state_machine/master" rel="alternate" title="Recent Commits to state_machine:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("pluginaweek", "state_machine", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='pluginaweek/state_machine/blob/58db34faaf49675fa4cf5c1b6107b4626f67db5c' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='pluginaweek/state_machine/blob/58db34faaf49675fa4cf5c1b6107b4626f67db5c' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("pluginaweek", "state_machine", "58db34faaf49675fa4cf5c1b6107b4626f67db5c", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/pluginaweek/state_machine/tree/">Source</a></li>
            <li class=""><a href="http://github.com/pluginaweek/state_machine/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/pluginaweek/state_machine/network">Network</a></li>            
            <li class=""><a href="http://github.com/pluginaweek/state_machine/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/pluginaweek/state_machine">Wiki</a></li>
            <li class=""><a href="http://github.com/pluginaweek/state_machine/graphs">Graphs</a></li>                    
            <li class="active"><a href="/pluginaweek/state_machine">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/pluginaweek">pluginaweek</a> / <b><a href="http://github.com/pluginaweek/state_machine/tree">state_machine</a></b>        
                <a id="namespaces_button" rel="pluginaweek/state_machine/blob/58db34faaf49675fa4cf5c1b6107b4626f67db5c" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="pluginaweek/state_machine/blob/58db34faaf49675fa4cf5c1b6107b4626f67db5c" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h2>state_machine</h2>
<p>
<tt>state_machine</tt> adds support for creating state machines for
attributes on any Ruby class.
</p>
<h2>Resources</h2>
<p>
API
</p>
<ul>
<li>http://api.pluginaweek.org/state_machine

</li>
</ul>
<p>
Bugs
</p>
<ul>
<li>http://pluginaweek.lighthouseapp.com/projects/13288-state_machine

</li>
</ul>
<p>
Development
</p>
<ul>
<li>http://github.com/pluginaweek/state_machine

</li>
</ul>
<p>
Source
</p>
<ul>
<li>git://github.com/pluginaweek/state_machine.git

</li>
</ul>
<h2>Description</h2>
<p>
State machines make it dead-simple to manage the behavior of a class. Too
often, the state of an object is kept by creating multiple boolean
attributes and deciding how to behave based on the values. This can become
cumbersome and difficult to maintain when the complexity of your class
starts to increase.
</p>
<p>
<tt>state_machine</tt> simplifies this design by introducing the various
parts of a real state machine, including states, events, transitions, and
callbacks. However, the api is designed to be so simple you don&#8217;t
even need to know what a state machine is :)
</p>
<p>
Some brief, high-level features include:
</p>
<ul>
<li>Defining state machines on any Ruby class

</li>
<li>Multiple state machines on a single class

</li>
<li>Namespaced state machines

</li>
<li>before/after transition hooks with explicit transition requirements

</li>
<li>ActiveRecord integration

</li>
<li>DataMapper integration

</li>
<li>Sequel integration

</li>
<li>State predicates

</li>
<li>State-driven instance / class behavior

</li>
<li>State values of any data type

</li>
<li>Dynamically-generated state values

</li>
<li>Event parallelization

</li>
<li>Attribute-based event transitions

</li>
<li>Inheritance

</li>
<li>Internationalization

</li>
<li>GraphViz visualization creator

</li>
</ul>
<p>
Examples of the usage patterns for some of the above features are shown
below. You can find much more detailed documentation in the actual API.
</p>
<h2>Usage</h2>
<h3>Example</h3>
<p>
Below is an example of many of the features offered by this plugin,
including:
</p>
<ul>
<li>Initial states

</li>
<li>Namespaced states

</li>
<li>Transition callbacks

</li>
<li>Conditional transitions

</li>
<li>State-driven instance behavior

</li>
<li>Customized state values

</li>
<li>Parallel events

</li>
</ul>
<p>
Class definition:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:seatbelt_on</span>

    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='before_transition identifier id'>before_transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='any identifier id'>any</span> <span class='minus op'>-</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:do</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:put_on_seatbelt</span>

      <span class='after_transition identifier id'>after_transition</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:crash</span><span class='comma token'>,</span> <span class='symbol val'>:do</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:tow</span>
      <span class='after_transition identifier id'>after_transition</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:repair</span><span class='comma token'>,</span> <span class='symbol val'>:do</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:fix</span>
      <span class='after_transition identifier id'>after_transition</span> <span class='any identifier id'>any</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='vehicle identifier id'>vehicle</span><span class='comma token'>,</span> <span class='transition identifier id'>transition</span><span class='bitor op'>|</span>
        <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='seatbelt_on identifier id'>seatbelt_on</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:park</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='lbrack token'>[</span><span class='symbol val'>:idling</span><span class='comma token'>,</span> <span class='symbol val'>:first_gear</span><span class='rbrack token'>]</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:stalled</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='same identifier id'>same</span><span class='comma token'>,</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:idle</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:first_gear</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:shift_up</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:idling</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:first_gear</span><span class='comma token'>,</span> <span class='symbol val'>:first_gear</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:second_gear</span><span class='comma token'>,</span> <span class='symbol val'>:second_gear</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:third_gear</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:shift_down</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:third_gear</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:second_gear</span><span class='comma token'>,</span> <span class='symbol val'>:second_gear</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:first_gear</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:crash</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='minus op'>-</span> <span class='lbrack token'>[</span><span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:stalled</span><span class='rbrack token'>]</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:stalled</span><span class='comma token'>,</span> <span class='symbol val'>:unless</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:auto_shop_busy?</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:repair</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:stalled</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:if</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:auto_shop_busy?</span>
      <span class='end end kw'>end</span>

      <span class='state identifier id'>state</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
        <span class='def def kw'>def</span> <span class='speed identifier id'>speed</span>
          <span class='integer val'>0</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='state identifier id'>state</span> <span class='symbol val'>:idling</span><span class='comma token'>,</span> <span class='symbol val'>:first_gear</span> <span class='do do kw'>do</span>
        <span class='def def kw'>def</span> <span class='speed identifier id'>speed</span>
          <span class='integer val'>10</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='state identifier id'>state</span> <span class='symbol val'>:second_gear</span> <span class='do do kw'>do</span>
        <span class='def def kw'>def</span> <span class='speed identifier id'>speed</span>
          <span class='integer val'>20</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:alarm_state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:active</span><span class='comma token'>,</span> <span class='symbol val'>:namespace</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'alarm'</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:enable</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:active</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:disable</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:off</span>
      <span class='end end kw'>end</span>

      <span class='state identifier id'>state</span> <span class='symbol val'>:active</span><span class='comma token'>,</span> <span class='symbol val'>:value</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span>
      <span class='state identifier id'>state</span> <span class='symbol val'>:off</span><span class='comma token'>,</span> <span class='symbol val'>:value</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
      <span class='@seatbelt_on ivar id'>@seatbelt_on</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
      <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='comment val'># NOTE: This *must* be called, otherwise states won't get initialized</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='put_on_seatbelt identifier id'>put_on_seatbelt</span>
      <span class='@seatbelt_on ivar id'>@seatbelt_on</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='auto_shop_busy? fid id'>auto_shop_busy?</span>
      <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='tow identifier id'>tow</span>
      <span class='comment val'># tow the vehicle</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='fix identifier id'>fix</span>
      <span class='comment val'># get the vehicle fixed by a mechanic</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
<b>Note</b> the comment made on the <tt>initialize</tt> method in the
class. In order for state machine attributes to be properly initialized,
<tt>super()</tt> must be called. See StateMachine::MacroMethods for more
information about this.
</p>
<p>
Using the above class as an example, you can interact with the state
machine like so:
</p>
<pre class="code">
  <span class='vehicle identifier id'>vehicle</span> <span class='assign token'>=</span> <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='new identifier id'>new</span>           <span class='comment val'># =&gt; #&lt;Vehicle:0xb7cf4eac @state=&quot;parked&quot;, @seatbelt_on=false&gt;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>                   <span class='comment val'># =&gt; &quot;parked&quot;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_name identifier id'>state_name</span>              <span class='comment val'># =&gt; :parked</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='parked? fid id'>parked?</span>                 <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='can_ignite? fid id'>can_ignite?</span>             <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='ignite_transition identifier id'>ignite_transition</span>       <span class='comment val'># =&gt; #&lt;StateMachine::Transition attribute=:state event=:ignite from=&quot;parked&quot; from_name=:parked to=&quot;idling&quot; to_name=:idling&gt;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_events identifier id'>state_events</span>            <span class='comment val'># =&gt; [:ignite]</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_transitions identifier id'>state_transitions</span>       <span class='comment val'># =&gt; [#&lt;StateMachine::Transition attribute=:state event=:ignite from=&quot;parked&quot; from_name=:parked to=&quot;idling&quot; to_name=:idling&gt;]</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='speed identifier id'>speed</span>                   <span class='comment val'># =&gt; 0</span>

  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='ignite identifier id'>ignite</span>                  <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='parked? fid id'>parked?</span>                 <span class='comment val'># =&gt; false</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='idling? fid id'>idling?</span>                 <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='speed identifier id'>speed</span>                   <span class='comment val'># =&gt; 10</span>
  <span class='vehicle identifier id'>vehicle</span>                         <span class='comment val'># =&gt; #&lt;Vehicle:0xb7cf4eac @state=&quot;idling&quot;, @seatbelt_on=true&gt;</span>

  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='shift_up identifier id'>shift_up</span>                <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='speed identifier id'>speed</span>                   <span class='comment val'># =&gt; 10</span>
  <span class='vehicle identifier id'>vehicle</span>                         <span class='comment val'># =&gt; #&lt;Vehicle:0xb7cf4eac @state=&quot;first_gear&quot;, @seatbelt_on=true&gt;</span>

  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='shift_up identifier id'>shift_up</span>                <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='speed identifier id'>speed</span>                   <span class='comment val'># =&gt; 20</span>
  <span class='vehicle identifier id'>vehicle</span>                         <span class='comment val'># =&gt; #&lt;Vehicle:0xb7cf4eac @state=&quot;second_gear&quot;, @seatbelt_on=true&gt;</span>

  <span class='comment val'># The bang (!) operator can raise exceptions if the event fails</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='park! fid id'>park!</span>                   <span class='comment val'># =&gt; StateMachine::InvalidTransition: Cannot transition state via :park from :second_gear</span>

  <span class='comment val'># Generic state predicates can raise exceptions if the value does not exist</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state? fid id'>state?</span><span class='lparen token'>(</span><span class='symbol val'>:parked</span><span class='rparen token'>)</span>         <span class='comment val'># =&gt; false</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state? fid id'>state?</span><span class='lparen token'>(</span><span class='symbol val'>:invalid</span><span class='rparen token'>)</span>        <span class='comment val'># =&gt; IndexError: :invalid is an invalid name</span>

  <span class='comment val'># Namespaced machines have uniquely-generated methods</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state identifier id'>alarm_state</span>             <span class='comment val'># =&gt; 1</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state_name identifier id'>alarm_state_name</span>        <span class='comment val'># =&gt; :active</span>

  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='can_disable_alarm? fid id'>can_disable_alarm?</span>      <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='disable_alarm identifier id'>disable_alarm</span>           <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state identifier id'>alarm_state</span>             <span class='comment val'># =&gt; 0</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state_name identifier id'>alarm_state_name</span>        <span class='comment val'># =&gt; :off</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='can_enable_alarm? fid id'>can_enable_alarm?</span>       <span class='comment val'># =&gt; true</span>

  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_off? fid id'>alarm_off?</span>              <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_active? fid id'>alarm_active?</span>           <span class='comment val'># =&gt; false</span>

  <span class='comment val'># Events can be fired in parallel</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='fire_events identifier id'>fire_events</span><span class='lparen token'>(</span><span class='symbol val'>:shift_down</span><span class='comma token'>,</span> <span class='symbol val'>:enable_alarm</span><span class='rparen token'>)</span> <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_name identifier id'>state_name</span>                              <span class='comment val'># =&gt; :first_gear</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state_name identifier id'>alarm_state_name</span>                        <span class='comment val'># =&gt; :active</span>

  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='fire_events! fid id'>fire_events!</span><span class='lparen token'>(</span><span class='symbol val'>:ignite</span><span class='comma token'>,</span> <span class='symbol val'>:enable_alarm</span><span class='rparen token'>)</span>    <span class='comment val'># =&gt; StateMachine::InvalidTransition: Cannot run events in parallel: ignite, enable_alarm</span>
</pre>
<h2>Integrations</h2>
<p>
In addition to being able to define state machines on all Ruby classes, a
set of out-of-the-box integrations are available for some of the more
popular Ruby libraries. These integrations add library-specific behavior,
allowing for state machines to work more tightly with the conventions
defined by those libraries.
</p>
<p>
The integrations currently available include:
</p>
<ul>
<li>ActiveRecord models

</li>
<li>DataMapper resources

</li>
<li>Sequel models

</li>
</ul>
<p>
A brief overview of these integrations is described below.
</p>
<h3>ActiveRecord</h3>
<p>
The ActiveRecord integration adds support for database transactions,
automatically saving the record, named scopes, validation errors, and
observers. For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='before_transition identifier id'>before_transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='any identifier id'>any</span> <span class='minus op'>-</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:do</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:put_on_seatbelt</span>
      <span class='after_transition identifier id'>after_transition</span> <span class='any identifier id'>any</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='vehicle identifier id'>vehicle</span><span class='comma token'>,</span> <span class='transition identifier id'>transition</span><span class='bitor op'>|</span>
        <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='seatbelt identifier id'>seatbelt</span> <span class='assign token'>=</span> <span class='string val'>'off'</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>

      <span class='state identifier id'>state</span> <span class='symbol val'>:first_gear</span><span class='comma token'>,</span> <span class='symbol val'>:second_gear</span> <span class='do do kw'>do</span>
        <span class='validates_presence_of identifier id'>validates_presence_of</span> <span class='symbol val'>:seatbelt_on</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='put_on_seatbelt identifier id'>put_on_seatbelt</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='class class kw'>class</span> <span class='VehicleObserver constant id'>VehicleObserver</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Observer constant id'>Observer</span>
    <span class='comment val'># Callback for :ignite event *before* the transition is performed</span>
    <span class='def def kw'>def</span> <span class='before_ignite identifier id'>before_ignite</span><span class='lparen token'>(</span><span class='vehicle identifier id'>vehicle</span><span class='comma token'>,</span> <span class='transition identifier id'>transition</span><span class='rparen token'>)</span>
      <span class='comment val'># log message</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Generic transition callback *after* the transition is performed</span>
    <span class='def def kw'>def</span> <span class='after_transition identifier id'>after_transition</span><span class='lparen token'>(</span><span class='vehicle identifier id'>vehicle</span><span class='comma token'>,</span> <span class='transition identifier id'>transition</span><span class='rparen token'>)</span>
      <span class='Audit constant id'>Audit</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='vehicle identifier id'>vehicle</span><span class='comma token'>,</span> <span class='transition identifier id'>transition</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
For more information about the various behaviors added for ActiveRecord
state machines, see StateMachine::Integrations::ActiveRecord.
</p>
<h3>DataMapper</h3>
<p>
Like the ActiveRecord integration, the DataMapper integration adds support
for database transactions, automatically saving the record, named scopes,
Extlib-like callbacks, validation errors, and observers. For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='include identifier id'>include</span> <span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Resource constant id'>Resource</span>

    <span class='property identifier id'>property</span> <span class='symbol val'>:id</span><span class='comma token'>,</span> <span class='Serial constant id'>Serial</span>
    <span class='property identifier id'>property</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='String constant id'>String</span>

    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='before_transition identifier id'>before_transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='any identifier id'>any</span> <span class='minus op'>-</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:do</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:put_on_seatbelt</span>
      <span class='after_transition identifier id'>after_transition</span> <span class='any identifier id'>any</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='transition identifier id'>transition</span><span class='bitor op'>|</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='seatbelt identifier id'>seatbelt</span> <span class='assign token'>=</span> <span class='string val'>'off'</span> <span class='comment val'># self is the record</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>

      <span class='state identifier id'>state</span> <span class='symbol val'>:first_gear</span><span class='comma token'>,</span> <span class='symbol val'>:second_gear</span> <span class='do do kw'>do</span>
        <span class='validates_present identifier id'>validates_present</span> <span class='symbol val'>:seatbelt_on</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='put_on_seatbelt identifier id'>put_on_seatbelt</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='class class kw'>class</span> <span class='VehicleObserver constant id'>VehicleObserver</span>
    <span class='include identifier id'>include</span> <span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Observer constant id'>Observer</span>

    <span class='observe identifier id'>observe</span> <span class='Vehicle constant id'>Vehicle</span>

    <span class='comment val'># Callback for :ignite event *before* the transition is performed</span>
    <span class='before_transition identifier id'>before_transition</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='transition identifier id'>transition</span><span class='bitor op'>|</span>
      <span class='comment val'># log message (self is the record)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Generic transition callback *after* the transition is performed</span>
    <span class='after_transition identifier id'>after_transition</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='transition identifier id'>transition</span><span class='bitor op'>|</span>
      <span class='Audit constant id'>Audit</span><span class='dot token'>.</span><span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='transition identifier id'>transition</span><span class='rparen token'>)</span> <span class='comment val'># self is the record</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
<b>Note</b> that the DataMapper::Observer integration is optional and only
available when the dm-observer library is installed.
</p>
<p>
For more information about the various behaviors added for DataMapper state
machines, see StateMachine::Integrations::DataMapper.
</p>
<h3>Sequel</h3>
<p>
Like the ActiveRecord integration, the Sequel integration adds support for
database transactions, automatically saving the record, named scopes,
validation errors and callbacks. For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span> <span class='lt op'>&lt;</span> <span class='Sequel constant id'>Sequel</span><span class='colon2 op'>::</span><span class='Model constant id'>Model</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='before_transition identifier id'>before_transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='any identifier id'>any</span> <span class='minus op'>-</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:do</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:put_on_seatbelt</span>
      <span class='after_transition identifier id'>after_transition</span> <span class='any identifier id'>any</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='transition identifier id'>transition</span><span class='bitor op'>|</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='seatbelt identifier id'>seatbelt</span> <span class='assign token'>=</span> <span class='string val'>'off'</span> <span class='comment val'># self is the record</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>

      <span class='state identifier id'>state</span> <span class='symbol val'>:first_gear</span><span class='comma token'>,</span> <span class='symbol val'>:second_gear</span> <span class='do do kw'>do</span>
        <span class='validates_presence_of identifier id'>validates_presence_of</span> <span class='symbol val'>:seatbelt_on</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='put_on_seatbelt identifier id'>put_on_seatbelt</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
For more information about the various behaviors added for Sequel state
machines, see StateMachine::Integrations::Sequel.
</p>
<h2>Compatibility</h2>
<p>
Although state_machine introduces a simplified syntax, it still remains
backwards compatible with previous versions and other state-related
libraries. For example, transitions and callbacks can continue to be
defined like so:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='before_transition identifier id'>before_transition</span> <span class='symbol val'>:from</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:except_to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:do</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:put_on_seatbelt</span>
      <span class='after_transition identifier id'>after_transition</span> <span class='symbol val'>:to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='transition identifier id'>transition</span><span class='bitor op'>|</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='seatbelt identifier id'>seatbelt</span> <span class='assign token'>=</span> <span class='string val'>'off'</span> <span class='comment val'># self is the record</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:from</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Although this verbose syntax will most likely always be supported, it is
recommended that any state machines eventually migrate to the syntax
introduced in version 0.6.0.
</p>
<h2>Tools</h2>
<h3>Generating graphs</h3>
<p>
This library comes with built-in support for generating di-graphs based on
the events, states, and transitions defined for a state machine using
GraphViz[http://www.graphviz.org]. This requires that both the
<tt>ruby-graphviz</tt> gem and graphviz library be installed on the system.
</p>
<h4>Examples</h4>
<p>
To generate a graph for a specific file / class:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='state_machine identifier id'>state_machine</span><span class='symbol val'>:draw</span> <span class='FILE constant id'>FILE</span><span class='assign token'>=</span><span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span> <span class='CLASS constant id'>CLASS</span><span class='assign token'>=</span><span class='Vehicle constant id'>Vehicle</span>
</pre>
<p>
To save files to a specific path:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='state_machine identifier id'>state_machine</span><span class='symbol val'>:draw</span> <span class='FILE constant id'>FILE</span><span class='assign token'>=</span><span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span> <span class='CLASS constant id'>CLASS</span><span class='assign token'>=</span><span class='Vehicle constant id'>Vehicle</span> <span class='TARGET constant id'>TARGET</span><span class='assign token'>=</span><span class='files identifier id'>files</span>
</pre>
<p>
To customize the image format / orientation:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='state_machine identifier id'>state_machine</span><span class='symbol val'>:draw</span> <span class='FILE constant id'>FILE</span><span class='assign token'>=</span><span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span> <span class='CLASS constant id'>CLASS</span><span class='assign token'>=</span><span class='Vehicle constant id'>Vehicle</span> <span class='FORMAT constant id'>FORMAT</span><span class='assign token'>=</span><span class='jpg identifier id'>jpg</span> <span class='ORIENTATION constant id'>ORIENTATION</span><span class='assign token'>=</span><span class='landscape identifier id'>landscape</span>
</pre>
<p>
To generate multiple state machine graphs:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='state_machine identifier id'>state_machine</span><span class='symbol val'>:draw</span> <span class='FILE constant id'>FILE</span><span class='assign token'>=</span><span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span><span class='comma token'>,</span><span class='car identifier id'>car</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span> <span class='CLASS constant id'>CLASS</span><span class='assign token'>=</span><span class='Vehicle constant id'>Vehicle</span><span class='comma token'>,</span><span class='Car constant id'>Car</span>
</pre>
<p>
<b>Note</b> that this will generate a different file for every state
machine defined in the class. The generated files will use an output
filename of the format #{class_name}_#{attribute}.#{format}.
</p>
<p>
For examples of actual images generated using this task, see those under
the examples folder.
</p>
<h4>Ruby on Rails Integration</h4>
<p>
There is a special integration Rake task for generating state machines for
classes used in a Ruby on Rails application. This task will load the
application environment, meaning that it&#8217;s unnecessary to specify the
actual file to load.
</p>
<p>
For example,
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='state_machine identifier id'>state_machine</span><span class='symbol val'>:draw</span><span class='symbol val'>:rails</span> <span class='CLASS constant id'>CLASS</span><span class='assign token'>=</span><span class='Vehicle constant id'>Vehicle</span>
</pre>
<h4>Merb Integration</h4>
<p>
Like Ruby on Rails, there is a special integration Rake task for generating
state machines for classes used in a Merb application. This task will load
the application environment, meaning that it&#8217;s unnecessary to specify
the actual files to load.
</p>
<p>
For example,
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='state_machine identifier id'>state_machine</span><span class='symbol val'>:draw</span><span class='symbol val'>:merb</span> <span class='CLASS constant id'>CLASS</span><span class='assign token'>=</span><span class='Vehicle constant id'>Vehicle</span>
</pre>
<h3>Interactive graphs</h3>
<p>
Jean Bovet - {Visual Automata
Simulator}[http://www.cs.usfca.edu/~jbovet/vas.html]. This is a great tool
for &quot;simulating, visualizing and transforming finite state automata
and Turing Machines&quot;. This tool can help in the creation of states and
events for your models. It is cross-platform, written in Java.
</p>
<h2>Testing</h2>
<p>
To run the entire test suite (will test ActiveRecord, DataMapper, and
Sequel integrations if the proper dependencies are available):
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='test identifier id'>test</span>
</pre>
<p>
Target specific versions of integrations like so:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='test identifier id'>test</span> <span class='AR_VERSION constant id'>AR_VERSION</span><span class='assign token'>=</span><span class='float val'>2.1</span><span class='integer val'>.0</span> <span class='DM_VERSION constant id'>DM_VERSION</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='float val'>.9.4</span> <span class='SEQUEL_VERSION constant id'>SEQUEL_VERSION</span><span class='assign token'>=</span><span class='float val'>2.8</span><span class='integer val'>.0</span>
</pre>
<h2>Dependencies</h2>
<p>
By default, there are no dependencies. If using specific integrations,
those dependencies are listed below.
</p>
<ul>
<li>ActiveRecord[http://rubyonrails.org] integration: 2.1.0 or later

</li>
<li>DataMapper[http://datamapper.org] integration: 0.9.4 or later

</li>
<li>Sequel[http://sequel.rubyforge.org] integration: 2.8.0 or later

</li>
</ul>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>