<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>pluginaweek's state_machine - Module: StateMachine::MacroMethods - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/pluginaweek/commits/state_machine/master" rel="alternate" title="Recent Commits to state_machine:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("pluginaweek", "state_machine", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='pluginaweek/state_machine/blob/1bade3277a0f19d37e6b651ad16592afa220fce2' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='pluginaweek/state_machine/blob/1bade3277a0f19d37e6b651ad16592afa220fce2' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("pluginaweek", "state_machine", "1bade3277a0f19d37e6b651ad16592afa220fce2", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/pluginaweek/state_machine/tree/">Source</a></li>
            <li class=""><a href="http://github.com/pluginaweek/state_machine/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/pluginaweek/state_machine/network">Network</a></li>            
            <li class=""><a href="http://github.com/pluginaweek/state_machine/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/pluginaweek/state_machine">Wiki</a></li>
            <li class=""><a href="http://github.com/pluginaweek/state_machine/graphs">Graphs</a></li>                    
            <li class="active"><a href="/pluginaweek/state_machine">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/pluginaweek">pluginaweek</a> / <b><a href="http://github.com/pluginaweek/state_machine/tree">state_machine</a></b>        
                <a id="namespaces_button" rel="pluginaweek/state_machine/blob/1bade3277a0f19d37e6b651ad16592afa220fce2" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="pluginaweek/state_machine/blob/1bade3277a0f19d37e6b651ad16592afa220fce2" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module StateMachine_MacroMethods">
  <h1>Module: StateMachine::MacroMethods</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#state_machine-instance_method">#state_machine</span><span class='args'>(*args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates a new state machine for the given attribute.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>state_machine</h3>
</div><div id="state_machine-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>state_machine</span><span class='args'>(*args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates a new state machine for the given attribute. The default attribute,
if not specified, is <tt>:state</tt>.
</p>
<p>
Configuration options:
</p>
<ul>
<li><tt>:initial</tt> - The initial state of the attribute. This can be a
static state or a lambda block which will be evaluated at runtime (e.g.
lambda <tt>vehicle.speed == 0 ? :parked : :idling</tt>). Default is nil.

</li>
<li><tt>:action</tt> - The instance method to invoke when an object
transitions. Default is nil unless otherwise specified by the configured
integration.

</li>
<li><tt>:namespace</tt> - The name to use for namespacing all generated
instance methods (e.g. &quot;heater&quot; would generate :turn_on_heater
and :turn_off_heater for the :turn_on/:turn_off events). Default is nil.

</li>
<li><tt>:integration</tt> - The name of the integration to use for adding
library-specific behavior to the machine. Built-in integrations include
:data_mapper, :active_record, and :sequel. By default, this is determined
automatically.

</li>
</ul>
<p>
Configuration options relevant to ORM integrations:
</p>
<ul>
<li><tt>:plural</tt> - The pluralized name of the attribute. By default, this
will attempt to call <tt>pluralize</tt> on the attribute. If this method is
not available, an &quot;s&quot; is appended. This is used for generating
scopes.

</li>
<li><tt>:messages</tt> - The error messages to use when invalidating objects
due to failed transitions. Messages include:

<ul>
<li><tt>:invalid</tt>

</li>
<li><tt>:invalid_event</tt>

</li>
<li><tt>:invalid_transition</tt>

</li>
</ul>
</li>
<li><tt>:use_transactions</tt> - Whether transactions should be used when
firing events. Default is true unless otherwise specified by the configured
integration.

</li>
</ul>
<p>
This also expects a block which will be used to actually configure the
states, events and transitions for the state machine. <b>Note</b> that this
block will be executed within the context of the state machine. As a
result, you will not be able to access any class methods unless you refer
to them directly (i.e. specifying the class name).
</p>
<p>
For examples on the types of configured state machines and blocks, see the
section below.
</p>
<h2>Examples</h2>
<p>
With the default attribute and no configuration:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:park</span> <span class='do do kw'>do</span>
        <span class='dot3 op'>...</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The above example will define a state machine for the <tt>state</tt>
attribute on the class. Every vehicle will start without an initial state.
</p>
<p>
With a custom attribute:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:status</span> <span class='do do kw'>do</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
With a static initial state:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:status</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
With a dynamic initial state:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:status</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lambda identifier id'>lambda</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='speed identifier id'>speed</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='symbol val'>:parked</span> <span class='colon op'>:</span> <span class='symbol val'>:idling</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; do
      ...
    end
  end
</span></pre>
<h2>Instance Methods</h2>
<p>
The following instance methods will be automatically generated by the state
machine. Any existing methods will not be overwritten.
</p>
<ul>
<li><tt>state</tt> - Gets the current value for the attribute

</li>
<li><tt>state=(value)</tt> - Sets the current value for the attribute

</li>
<li><tt>state?(name)</tt> - Checks the given state name against the current
state. If the name is not a known state, then an ArgumentError is raised.

</li>
<li><tt>state_name</tt> - Gets the name of the state for the current value

</li>
<li><tt>state_events</tt> - Gets the list of events that can be fired on the
current object&#8217;s state (uses the <b>unqualified</b> event names)

</li>
<li><tt>state_transitions</tt> - Gets the list of possible transitions that can
be made on the current object&#8217;s state

</li>
</ul>
<p>
For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:park</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:idling</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='vehicle identifier id'>vehicle</span> <span class='assign token'>=</span> <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>                     <span class='comment val'># =&gt; &quot;parked&quot;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_name identifier id'>state_name</span>                <span class='comment val'># =&gt; :parked</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state? fid id'>state?</span><span class='lparen token'>(</span><span class='symbol val'>:parked</span><span class='rparen token'>)</span>           <span class='comment val'># =&gt; true</span>

  <span class='comment val'># Changing state</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span> <span class='assign token'>=</span> <span class='string val'>'idling'</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>                     <span class='comment val'># =&gt; &quot;idling&quot;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_name identifier id'>state_name</span>                <span class='comment val'># =&gt; :idling</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state? fid id'>state?</span><span class='lparen token'>(</span><span class='symbol val'>:parked</span><span class='rparen token'>)</span>           <span class='comment val'># =&gt; false</span>

  <span class='comment val'># Getting current event / transition availability</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_events identifier id'>state_events</span>              <span class='comment val'># =&gt; [:park]</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='park identifier id'>park</span>                      <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_events identifier id'>state_events</span>              <span class='comment val'># =&gt; [:ignite]</span>

  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_transitions identifier id'>state_transitions</span>         <span class='comment val'># =&gt; [#&lt;StateMachine::Transition attribute=:state event=:ignite from=&quot;parked&quot; from_name=:parked to=&quot;idling&quot; to_name=:idling&gt;]</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='ignite identifier id'>ignite</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state_transitions identifier id'>state_transitions</span>         <span class='comment val'># =&gt; [#&lt;StateMachine::Transition attribute=:state event=:park from=&quot;idling&quot; from_name=:idling to=&quot;parked&quot; to_name=:parked&gt;]</span>
</pre>
<h2>Attribute initialization</h2>
<p>
For most classes, the initial values for state machine attributes are
automatically assigned when a new object is created. However, this behavior
will <b>not</b> work if the class defines an <tt>initialize</tt> method
without properly calling <tt>super</tt>.
</p>
<p>
For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='vehicle identifier id'>vehicle</span> <span class='assign token'>=</span> <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='new identifier id'>new</span>   <span class='comment val'># =&gt; #&lt;Vehicle:0xb7c8dbf8 @state=&quot;parked&quot;&gt;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>           <span class='comment val'># =&gt; &quot;parked&quot;</span>
</pre>
<p>
In the above example, no <tt>initialize</tt> method is defined. As a
result, the default behavior of initializing the state machine attributes
is used.
</p>
<p>
In the following example, a custom <tt>initialize</tt> method is defined:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='vehicle identifier id'>vehicle</span> <span class='assign token'>=</span> <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='new identifier id'>new</span>   <span class='comment val'># =&gt; #&lt;Vehicle:0xb7c77678&gt;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>           <span class='comment val'># =&gt; nil</span>
</pre>
<p>
Since the <tt>initialize</tt> method is defined, the state machine
attributes never get initialized. In order to ensure that all
initialization hooks are called, the custom method <b>must</b> call
<tt>super</tt> without any arguments like so:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
      <span class='dot3 op'>...</span>
      <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='vehicle identifier id'>vehicle</span> <span class='assign token'>=</span> <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='new identifier id'>new</span>   <span class='comment val'># =&gt; #&lt;Vehicle:0xb7c8dbf8 @state=&quot;parked&quot;&gt;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>           <span class='comment val'># =&gt; &quot;parked&quot;</span>
</pre>
<p>
Because of the way the inclusion of modules works in Ruby, calling
<tt>super()</tt> will not only call the superclass&#8217;s
<tt>initialize</tt>, but also <tt>initialize</tt> on all included modules.
This allows the original state machine hook to get called properly.
</p>
<p>
If you want to avoid calling the superclass&#8217;s constructor, but still
want to initialize the state machine attributes:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
      <span class='dot3 op'>...</span>
      <span class='initialize_state_machines identifier id'>initialize_state_machines</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='vehicle identifier id'>vehicle</span> <span class='assign token'>=</span> <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='new identifier id'>new</span>   <span class='comment val'># =&gt; #&lt;Vehicle:0xb7c8dbf8 @state=&quot;parked&quot;&gt;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>           <span class='comment val'># =&gt; &quot;parked&quot;</span>
</pre>
<h2>States</h2>
<p>
All of the valid states for the machine are automatically tracked based on
the events, transitions, and callbacks defined for the machine. If there
are additional states that are never referenced, these should be explicitly
added using the StateMachine::Machine#state or
StateMachine::Machine#other_states helpers.
</p>
<p>
When a new state is defined, a predicate method for that state is generated
on the class. For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
&#8230;will generate the following instance methods (assuming they&#8217;re
not already defined in the class):
</p>
<ul>
<li><tt>parked?</tt>

</li>
<li><tt>idling?</tt>

</li>
</ul>
<p>
Each predicate method will return true if it matches the object&#8217;s
current state. Otherwise, it will return false.
</p>
<h2>Events and Transitions</h2>
<p>
Events defined on the machine are the interface to transitioning states for
an object. Events can be fired either directly (through the method
generated for the event) or indirectly (through attributes defined on the
machine).
</p>
<p>
For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='include identifier id'>include</span> <span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Resource constant id'>Resource</span>
    <span class='property identifier id'>property</span> <span class='symbol val'>:id</span><span class='comma token'>,</span> <span class='Integer constant id'>Integer</span><span class='comma token'>,</span> <span class='symbol val'>:serial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>

    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:parked</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:ignite</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='symbol val'>:parked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:idling</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:alarm_state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:active</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:disable</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:off</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Fire &lt;tt&gt;ignite&lt;/tt&gt; event directly</span>
  <span class='vehicle identifier id'>vehicle</span> <span class='assign token'>=</span> <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='create identifier id'>create</span>    <span class='comment val'># =&gt; #&lt;Vehicle id=1 state=&quot;parked&quot; alarm_state=&quot;active&quot;&gt;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='ignite identifier id'>ignite</span>              <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='state identifier id'>state</span>               <span class='comment val'># =&gt; &quot;idling&quot;</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state identifier id'>alarm_state</span>         <span class='comment val'># =&gt; &quot;active&quot;</span>

  <span class='comment val'># Fire &lt;tt&gt;disable&lt;/tt&gt; event automatically</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state_event identifier id'>alarm_state_event</span> <span class='assign token'>=</span> <span class='string val'>'disable'</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='save identifier id'>save</span>                <span class='comment val'># =&gt; true</span>
  <span class='vehicle identifier id'>vehicle</span><span class='dot token'>.</span><span class='alarm_state identifier id'>alarm_state</span>         <span class='comment val'># =&gt; &quot;off&quot;</span>
</pre>
<p>
In the above example, the <tt>state</tt> attribute is transitioned using
the <tt>ignite</tt> action that&#8217;s generated from the state machine.
On the other hand, the <tt>alarm_state</tt> attribute is transitioned using
the <tt>alarm_state_event</tt> attribute that automatically gets fired when
the machine&#8217;s action (<tt>save</tt>) is invoked.
</p>
<p>
For more information about how to configure an event and its associated
transitions, see StateMachine::Machine#event.
</p>
<h2>Defining callbacks</h2>
<p>
Within the <tt>state_machine</tt> block, you can also define callbacks for
transitions. For more information about defining these callbacks, see
StateMachine::Machine#before_transition and
StateMachine::Machine#after_transition.
</p>
<h2>Namespaces</h2>
<p>
When a namespace is configured for a state machine, the name provided will
be used in generating the instance methods for interacting with
events/states in the machine. This is particularly useful when a class has
multiple state machines and it would be difficult to differentiate between
the various states / events.
</p>
<p>
For example,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Vehicle constant id'>Vehicle</span>
    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:heater_state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:off</span> <span class='symbol val'>:namespace</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'heater'</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:turn_on</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:on</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:turn_off</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:off</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='state_machine identifier id'>state_machine</span> <span class='symbol val'>:alarm_state</span><span class='comma token'>,</span> <span class='symbol val'>:initial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:active</span><span class='comma token'>,</span> <span class='symbol val'>:namespace</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'alarm'</span> <span class='do do kw'>do</span>
      <span class='event identifier id'>event</span> <span class='symbol val'>:turn_on</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:active</span>
      <span class='end end kw'>end</span>

      <span class='event identifier id'>event</span> <span class='symbol val'>:turn_off</span> <span class='do do kw'>do</span>
        <span class='transition identifier id'>transition</span> <span class='all identifier id'>all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:off</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The above class defines two state machines: <tt>heater_state</tt> and
<tt>alarm_state</tt>. For the <tt>heater_state</tt> machine, the following
methods are generated since it&#8217;s namespaced by &quot;heater&quot;:
</p>
<ul>
<li><tt>can_turn_on_heater?</tt>

</li>
<li><tt>turn_on_heater</tt>

</li>
<li>&#8230;

</li>
<li><tt>can_turn_off_heater?</tt>

</li>
<li><tt>turn_off_heater</tt>

</li>
<li>..

</li>
<li><tt>heater_off?</tt>

</li>
<li><tt>heater_on?</tt>

</li>
</ul>
<p>
As shown, each method is unique to the state machine so that the states and
events don&#8217;t conflict. The same goes for the <tt>alarm_state</tt>
machine:
</p>
<ul>
<li><tt>can_turn_on_alarm?</tt>

</li>
<li><tt>turn_on_alarm</tt>

</li>
<li>&#8230;

</li>
<li><tt>can_turn_off_alarm?</tt>

</li>
<li><tt>turn_off_alarm</tt>

</li>
<li>..

</li>
<li><tt>alarm_active?</tt>

</li>
<li><tt>alarm_off?</tt>

</li>
</ul>
<h2>Scopes</h2>
<p>
For integrations that support it, a group of default scope filters will be
automatically created for assisting in finding objects that have the
attribute set to the value for a given set of states.
</p>
<p>
For example,
</p>
<pre class="code">
  <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='with_state identifier id'>with_state</span><span class='lparen token'>(</span><span class='symbol val'>:parked</span><span class='rparen token'>)</span>               <span class='comment val'># =&gt; All vehicles where the state is parked</span>
  <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='with_states identifier id'>with_states</span><span class='lparen token'>(</span><span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:idling</span><span class='rparen token'>)</span>     <span class='comment val'># =&gt; All vehicles where the state is either parked or idling</span>

  <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='without_state identifier id'>without_state</span><span class='lparen token'>(</span><span class='symbol val'>:parked</span><span class='rparen token'>)</span>            <span class='comment val'># =&gt; All vehicles where the state is *not* parked</span>
  <span class='Vehicle constant id'>Vehicle</span><span class='dot token'>.</span><span class='without_states identifier id'>without_states</span><span class='lparen token'>(</span><span class='symbol val'>:parked</span><span class='comma token'>,</span> <span class='symbol val'>:idling</span><span class='rparen token'>)</span>  <span class='comment val'># =&gt; All vehicles where the state is *not* parked or idling</span>
</pre>
<p>
<b>Note</b> that if class methods already exist with those names (i.e.
:with_state, :with_states, :without_state, or :without_states), then a
scope will not be defined for that name.
</p>
<p>
See StateMachine::Machine for more information about using integrations and
the individual integration docs for information about the actual scopes
that are generated.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/state_machine.rb', line 369</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/pluginaweek/state_machine/blob/1bade3277a0f19d37e6b651ad16592afa220fce2/lib/state_machine.rb#L369">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">369
370
371</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='state_machine identifier id'>state_machine</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='StateMachine constant id'>StateMachine</span><span class='colon2 op'>::</span><span class='Machine constant id'>Machine</span><span class='dot token'>.</span><span class='find_or_create identifier id'>find_or_create</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>