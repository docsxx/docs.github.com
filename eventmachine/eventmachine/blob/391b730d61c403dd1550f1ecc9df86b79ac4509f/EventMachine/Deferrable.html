<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>eventmachine's eventmachine - Module: EventMachine::Deferrable - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/eventmachine/commits/eventmachine/master" rel="alternate" title="Recent Commits to eventmachine:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    GitHubRepo.init("eventmachine", "eventmachine", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='eventmachine/eventmachine/blob/391b730d61c403dd1550f1ecc9df86b79ac4509f' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='eventmachine/eventmachine/blob/391b730d61c403dd1550f1ecc9df86b79ac4509f' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("eventmachine", "eventmachine", "391b730d61c403dd1550f1ecc9df86b79ac4509f", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/eventmachine/eventmachine/tree/">Source</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/network">Network</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/eventmachine/eventmachine">Wiki</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/graphs">Graphs</a></li>                    
            <li class="active"><a href="/eventmachine/eventmachine">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/eventmachine">eventmachine</a> / <b><a href="http://github.com/eventmachine/eventmachine/tree">eventmachine</a></b>        
                <a id="namespaces_button" rel="eventmachine/eventmachine/blob/391b730d61c403dd1550f1ecc9df86b79ac4509f" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="eventmachine/eventmachine/blob/391b730d61c403dd1550f1ecc9df86b79ac4509f" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module EventMachine_Deferrable">
  <h1>Module: EventMachine::Deferrable</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#future-class_method">future</span><span class='args'>(arg, cb = nil, eb = nil, &amp;blk)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
A future is a sugaring of a typical deferrable usage.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#callback-instance_method">#callback</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Specify a block to be executed if and when the Deferrable object receives a
status of :succeeded.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cancel_timeout-instance_method">#cancel_timeout</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Cancels an outstanding timeout if any.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#errback-instance_method">#errback</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Specify a block to be executed if and when the Deferrable object receives a
status of :failed.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fail-instance_method">#fail</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
          <span class='alias'>#set_deferred_failure</span>
        
      </th>
      <td class="docstring">
        <p>
Sugar for set_deferred_status(:failed, .
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_deferred_status-instance_method">#set_deferred_status</span><span class='args'>(status, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets the &quot;disposition&quot; (status) of the Deferrable object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#succeed-instance_method">#succeed</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
          <span class='alias'>#set_deferred_success</span>
        
      </th>
      <td class="docstring">
        <p>
Sugar for set_deferred_status(:succeeded, .
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#timeout-instance_method">#timeout</span><span class='args'>(seconds)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Setting a timeout on a Deferrable causes it to go into the failed state
after the Timeout expires (passing no arguments to the object&#8217;s
errbacks).
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>future</h3>
</div><div id="future-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>future</span><span class='args'>(arg, cb = nil, eb = nil, &amp;blk)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
A future is a sugaring of a typical deferrable usage. &#8212; Evaluate arg
(which may be an expression or a block). What&#8217;s the class of arg? If
arg is an ordinary expression, then return it. If arg is deferrable
(responds to :set_deferred_status), then look at the arguments. If either
callback or errback are defined, then use them. If neither are defined,
then use the supplied block (if any) as the callback. Then return arg.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/future.rb', line 44</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/future.rb#L44">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='future identifier id'>future</span> <span class='arg identifier id'>arg</span><span class='comma token'>,</span> <span class='cb identifier id'>cb</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='eb identifier id'>eb</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span>
  <span class='arg identifier id'>arg</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='if if_mod kw'>if</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:call</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='set_deferred_status identifier id'>set_deferred_status</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='cb identifier id'>cb</span> <span class='orop op'>||</span> <span class='eb identifier id'>eb</span>
      <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='cb identifier id'>cb</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='cb identifier id'>cb</span>
      <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='errback identifier id'>errback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='eb identifier id'>eb</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='eb identifier id'>eb</span>
    <span class='else else kw'>else</span>
      <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='blk identifier id'>blk</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='arg identifier id'>arg</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>callback</h3>
</div><div id="callback-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>callback</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Specify a block to be executed if and when the Deferrable object receives a
status of :succeeded. See #set_deferred_status for more information.
</p>
<p>
Calling this method on a Deferrable object whose status is not yet known
will cause the callback block to be stored on an internal list. If you call
this method on a Deferrable whose status is :succeeded, the block will be
executed immediately, receiving the parameters given to the prior
#set_deferred_status call.
</p>
<p>
&#8212; If there is no status, add a callback to an internal list. If
status is succeeded, execute the callback immediately. If status is failed,
do nothing.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/deferrable.rb', line 43</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/deferrable.rb#L43">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">43
44
45
46
47
48
49
50
51</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='callback identifier id'>callback</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='block identifier id'>block</span>
  <span class='if if kw'>if</span> <span class='@deferred_status ivar id'>@deferred_status</span> <span class='eq op'>==</span> <span class='colon op'>:</span><span class='succeeded identifier id'>succeeded</span>
    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='@deferred_args ivar id'>@deferred_args</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@deferred_status ivar id'>@deferred_status</span> <span class='neq op'>!=</span> <span class='symbol val'>:failed</span>
    <span class='@callbacks ivar id'>@callbacks</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='@callbacks ivar id'>@callbacks</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='block identifier id'>block</span> <span class='comment val'># &lt;&lt; block</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cancel_timeout</h3>
</div><div id="cancel_timeout-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cancel_timeout</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Cancels an outstanding timeout if any. Undoes the action of #timeout.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/deferrable.rb', line 157</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/deferrable.rb#L157">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">157
158
159
160
161
162</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cancel_timeout identifier id'>cancel_timeout</span>
  <span class='if if kw'>if</span> <span class='@deferred_timeout ivar id'>@deferred_timeout</span>
    <span class='@deferred_timeout ivar id'>@deferred_timeout</span><span class='dot token'>.</span><span class='cancel identifier id'>cancel</span>
    <span class='@deferred_timeout ivar id'>@deferred_timeout</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>errback</h3>
</div><div id="errback-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>errback</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Specify a block to be executed if and when the Deferrable object receives a
status of :failed. See #set_deferred_status for more information. &#8212;
If there is no status, add an errback to an internal list. If status is
failed, execute the errback immediately. If status is succeeded, do
nothing.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/deferrable.rb', line 60</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/deferrable.rb#L60">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">60
61
62
63
64
65
66
67
68</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='errback identifier id'>errback</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='block identifier id'>block</span>
  <span class='if if kw'>if</span> <span class='@deferred_status ivar id'>@deferred_status</span> <span class='eq op'>==</span> <span class='colon op'>:</span><span class='failed identifier id'>failed</span>
    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='@deferred_args ivar id'>@deferred_args</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@deferred_status ivar id'>@deferred_status</span> <span class='neq op'>!=</span> <span class='symbol val'>:succeeded</span>
    <span class='@errbacks ivar id'>@errbacks</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='@errbacks ivar id'>@errbacks</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='block identifier id'>block</span> <span class='comment val'># &lt;&lt; block</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fail</h3>
</div><div id="fail-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fail</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="set_deferred_failure-instance_method">set_deferred_failure</tt>
  
</p>
</div><div class="section docstring">
  <p>
Sugar for set_deferred_status(:failed, &#8230;)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/deferrable.rb', line 174</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/deferrable.rb#L174">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">174
175
176</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fail identifier id'>fail</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='set_deferred_status identifier id'>set_deferred_status</span> <span class='symbol val'>:failed</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_deferred_status</h3>
</div><div id="set_deferred_status-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_deferred_status</span><span class='args'>(status, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets the &quot;disposition&quot; (status) of the Deferrable object. See
also the large set of sugarings for this method. Note that if you call this
method without arguments, no arguments will be passed to the
callback/errback. If the user has coded these with arguments, then the user
code will throw an argument exception. Implementors of deferrable classes
<b>must</b> document the arguments they will supply to user callbacks.
</p>
<p>
OBSERVE SOMETHING VERY SPECIAL here: you may call this method even on the
INSIDE of a callback. This is very useful when a previously-registered
callback wants to change the parameters that will be passed to
subsequently-registered ones.
</p>
<p>
You may give either :succeeded or :failed as the status argument.
</p>
<p>
If you pass :succeeded, then all of the blocks passed to the object using
the #callback method (if any) will be executed BEFORE the
#set_deferred_status method returns. All of the blocks passed to the object
using #errback will be discarded.
</p>
<p>
If you pass :failed, then all of the blocks passed to the object using the
#errback method (if any) will be executed BEFORE the #set_deferred_status
method returns. All of the blocks passed to the object using # callback
will be discarded.
</p>
<p>
If you pass any arguments to #set_deferred_status in addition to the status
argument, they will be passed as arguments to any callbacks or errbacks
that are executed. It&#8217;s your responsibility to ensure that the
argument lists specified in your callbacks and errbacks match the arguments
given in calls to #set_deferred_status, otherwise Ruby will raise an
ArgumentError.
</p>
<p>
&#8212; We&#8217;re shifting callbacks off and discarding them as we
execute them. This is valid because by definition callbacks are executed no
more than once. It also has the magic effect of permitting recursive calls,
which means that a callback can call #set_deferred_status and change the
parameters that will be sent to subsequent callbacks down the chain.
</p>
<p>
Changed @callbacks and @errbacks from push/shift to unshift/pop, per
suggestion by Kirk Haines, to work around the memory leak bug that still
exists in many Ruby versions.
</p>
<p>
Changed 15Sep07: after processing callbacks or errbacks, CLEAR the other
set of handlers. This gets us a little closer to the behavior of
Twisted&#8217;s &quot;deferred,&quot; which only allows status to be set
once. Prior to making this change, it was possible to &quot;succeed&quot; a
Deferrable (triggering its callbacks), and then immediately
&quot;fail&quot; it, triggering its errbacks! That is clearly undesirable,
but it&#8217;s just as undesirable to raise an exception is status is set
more than once on a Deferrable. The latter behavior would invalidate the
idiom of resetting arguments by setting status from within a callback or
errback, but more seriously it would cause spurious errors if a Deferrable
was timed out and then an attempt was made to succeed it. See the comments
under the new method #timeout.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/deferrable.rb', line 122</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/deferrable.rb#L122">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set_deferred_status identifier id'>set_deferred_status</span> <span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='cancel_timeout identifier id'>cancel_timeout</span>
  <span class='@deferred_status ivar id'>@deferred_status</span> <span class='assign token'>=</span> <span class='status identifier id'>status</span>
  <span class='@deferred_args ivar id'>@deferred_args</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
  <span class='case case kw'>case</span> <span class='@deferred_status ivar id'>@deferred_status</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:succeeded</span>
    <span class='if if kw'>if</span> <span class='@callbacks ivar id'>@callbacks</span>
      <span class='while while kw'>while</span> <span class='cb identifier id'>cb</span> <span class='assign token'>=</span> <span class='@callbacks ivar id'>@callbacks</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>
        <span class='cb identifier id'>cb</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='@deferred_args ivar id'>@deferred_args</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='@errbacks ivar id'>@errbacks</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span> <span class='if if_mod kw'>if</span> <span class='@errbacks ivar id'>@errbacks</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:failed</span>
    <span class='if if kw'>if</span> <span class='@errbacks ivar id'>@errbacks</span>
      <span class='while while kw'>while</span> <span class='eb identifier id'>eb</span> <span class='assign token'>=</span> <span class='@errbacks ivar id'>@errbacks</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>
        <span class='eb identifier id'>eb</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='@deferred_args ivar id'>@deferred_args</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='@callbacks ivar id'>@callbacks</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span> <span class='if if_mod kw'>if</span> <span class='@callbacks ivar id'>@callbacks</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>succeed</h3>
</div><div id="succeed-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>succeed</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="set_deferred_success-instance_method">set_deferred_success</tt>
  
</p>
</div><div class="section docstring">
  <p>
Sugar for set_deferred_status(:succeeded, &#8230;)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/deferrable.rb', line 167</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/deferrable.rb#L167">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">167
168
169</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='succeed identifier id'>succeed</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='set_deferred_status identifier id'>set_deferred_status</span> <span class='symbol val'>:succeeded</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>timeout</h3>
</div><div id="timeout-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>timeout</span><span class='args'>(seconds)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Setting a timeout on a Deferrable causes it to go into the failed state
after the Timeout expires (passing no arguments to the object&#8217;s
errbacks). Setting the status at any time prior to a call to the expiration
of the timeout will cause the timer to be cancelled.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/deferrable.rb', line 149</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/deferrable.rb#L149">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">149
150
151
152
153</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='timeout identifier id'>timeout</span> <span class='seconds identifier id'>seconds</span>
  <span class='cancel_timeout identifier id'>cancel_timeout</span>
  <span class='me identifier id'>me</span> <span class='assign token'>=</span> <span class='self self kw'>self</span>
  <span class='@deferred_timeout ivar id'>@deferred_timeout</span> <span class='assign token'>=</span> <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='Timer constant id'>Timer</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='seconds identifier id'>seconds</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='me identifier id'>me</span><span class='dot token'>.</span><span class='fail identifier id'>fail</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>