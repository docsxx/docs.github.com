<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>eventmachine's eventmachine - Module: EventMachine - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/eventmachine/commits/eventmachine/master" rel="alternate" title="Recent Commits to eventmachine:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<style type="text/css">
  #repo_menu { border-bottom: 5px solid #ccc; margin-bottom: 1.5em; }
  #repo_sub_menu { display: none; }
</style>
    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main">
      <div id="header" class="">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/eventmachine/eventmachine/tree/">Source</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/network">Network</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/eventmachine/eventmachine">Wiki</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/graphs">Graphs</a></li>                    
            <li class="active"><a href="http://docs.github.com/eventmachine/eventmachine">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/eventmachine">eventmachine</a> / <b><a href="http://github.com/eventmachine/eventmachine/tree">eventmachine</a></b>        
                <a id="namespaces_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/>
                </a>
                <a id="methods_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/>
                </a>

                <script type="text/javascript">          
                $('#namespaces_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/namespaces/";
                  $.gitbox(url);
                  return false;
                });

                $('#methods_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/methods/";
                  $.gitbox(url);
                  return false;
                });
                </script>
                
              </div>
            </div>

            <div class="meta">
              <table>
                <tbody>
                  <tr>
                    <td class="label">Description:</td>
                    <td><span id="repository_description" rel="http://github.com/eventmachine/eventmachine/edit/update" class="">No description available</span></td>
                  </tr>              
                </tbody>
              </table>
            </div>
          </div>
                                        
          <div id="content">
            <div class="wikistyle">
  <div class="section module EventMachine">
  <h1>Module: EventMachine</h1>
  <div class="section docstring">
  <hr size="10"></hr>
</div><div class="section attributes">
  
    <div class="">
      <h2>Class Attributes</h2>
      <table>
      
        <tr>
          <th class="name">threadpool_size</td>
          <td class="readwrite">
            [<span id='threadpool_size-class_method'>R</span><span id='threadpool_size%3D-class_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Size of the EventMachine.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">threadpool</td>
          <td class="readwrite">
            [<span id='threadpool-class_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>threadpool</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="ConnectionAccepted-constant">ConnectionAccepted</dt>
      <dd>103</dd>
    
      <dt id="ConnectionCompleted-constant">ConnectionCompleted</dt>
      <dd>104</dd>
    
      <dt id="ConnectionData-constant">ConnectionData</dt>
      <dd>101</dd>
    
      <dt id="ConnectionUnbound-constant">ConnectionUnbound</dt>
      <dd>102</dd>
    
      <dt id="LoopbreakSignalled-constant">LoopbreakSignalled</dt>
      <dd>105</dd>
    
      <dt id="TimerFired-constant">TimerFired</dt>
      <dd>100</dd>
    
      <dt id="VERSION-constant">VERSION</dt>
      <dd>&quot;0.12.7&quot;</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add_oneshot_timer-class_method">add_oneshot_timer</span><span class='args'>(interval)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#add_oneshot_timer &#8212; Changed 04Oct06: intervals from the caller are
now in milliseconds, but our native-ruby processor still wants them in
seconds.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add_periodic_timer-class_method">add_periodic_timer</span><span class='args'>(*args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine#add_periodic_timer adds a periodic timer to the event loop.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add_timer-class_method">add_timer</span><span class='args'>(*args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine#add_timer adds a one-shot timer to the event loop.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#attach-class_method">attach</span><span class='args'>(io, handler = nil, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine::attach registers a given file descriptor or IO object with
the eventloop.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#bind_connect-class_method">bind_connect</span><span class='args'>(bind_addr, bind_port, server, port = nil, handler = nil, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine#connect initiates a TCP connection to a remote server and sets
up event-handling for the connection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#bind_connect_server-class_method">bind_connect_server</span><span class='args'>(bind_addr, bind_port, host, port)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#Callback-class_method">Callback</span><span class='args'>(object = nil, method = nil, &amp;blk)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Utility method for coercing arguments to an object that responds to #call
Accepts an object and a method name to send to, or a block, or an object
that responds to call.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cancel_timer-class_method">cancel_timer</span><span class='args'>(signature)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Cancel a timer using its signature.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#close_connection-class_method">close_connection</span><span class='args'>(target, after_writing)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#close_connection The extension version does NOT raise any kind of an error
if an attempt is made to close a non-existent connection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connect-class_method">connect</span><span class='args'>(server, port = nil, handler = nil, *args, &amp;blk)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connect_server-class_method">connect_server</span><span class='args'>(host, port)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#connect_server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connect_unix_domain-class_method">connect_unix_domain</span><span class='args'>(socketname, *args, &amp;blk)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Make a connection to a Unix-domain socket.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connect_unix_server-class_method">connect_unix_server</span><span class='args'>(chain)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#connect_unix_server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connection_count-class_method">connection_count</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the total number of connections (file descriptors) currently held
by the reactor.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#defer-class_method">defer</span><span class='args'>(op = nil, callback = nil, &amp;blk)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#defer is for integrating blocking operations into EventMachine&#8217;s
control flow.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#epoll-class_method">epoll</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#epoll is a harmless no-op in the pure-Ruby implementation.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#error_handler-class_method">error_handler</span><span class='args'>(cb = nil, &amp;blk)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Catch-all for errors raised during event loop callbacks.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#event_callback-class_method">event_callback</span><span class='args'>(target, opcode, data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fork_reactor-class_method">fork_reactor</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
fork_reactor forks a new process and calls EM#run inside of it, passing
your block.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_max_timers-class_method">get_max_timers</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Gets the current maximum number of allowed timers.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_outbound_data_size-class_method">get_outbound_data_size</span><span class='args'>(sig)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#get_outbound_data_size.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_peername-class_method">get_peername</span><span class='args'>(sig)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#get_peername.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#initialize_event_machine-class_method">initialize_event_machine</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#initialize_event_machine.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_popen-class_method">invoke_popen</span><span class='args'>(cmd)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#library_type-class_method">library_type</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This is mostly useful for automated tests.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#next_tick-class_method">next_tick</span><span class='args'>(pr = nil, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Schedules a proc for execution immediately after the next &quot;turn&quot;
through the reactor core.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#open_datagram_socket-class_method">open_datagram_socket</span><span class='args'>(address, port, handler = nil, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine#open_datagram_socket is for support of UDP-based protocols.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#open_keyboard-class_method">open_keyboard</span><span class='args'>(handler = nil, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
(Experimental).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#open_udp_socket-class_method">open_udp_socket</span><span class='args'>(host, port)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#open_udp_socket.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#popen-class_method">popen</span><span class='args'>(cmd, handler = nil, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Run an external process.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reactor_running-3F-class_method">reactor_running?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Tells you whether the EventMachine reactor loop is currently running.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reactor_thread-3F-class_method">reactor_thread?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if the calling thread is the same thread as the reactor.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#read_keyboard-class_method">read_keyboard</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#read_keyboard.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reconnect-class_method">reconnect</span><span class='args'>(server, port, handler)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Connect to a given host/port and re-use the provided
EventMachine::Connection instance &#8212; EXPERIMENTAL.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#release_machine-class_method">release_machine</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
release_machine.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run-class_method">run</span><span class='args'>(blk = nil, tail = nil, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine::run initializes and runs an event loop.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run_block-class_method">run_block</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sugars a common use case.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run_deferred_callbacks-class_method">run_deferred_callbacks</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; The is the responder for the loopback-signalled event.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run_machine-class_method">run_machine</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
run_machine.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#schedule-class_method">schedule</span><span class='args'>(*a, &amp;b)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Runs the given callback on the reactor thread, or immediately if called
from the reactor thread.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_data-class_method">send_data</span><span class='args'>(target, data, datalength)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#send_data.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_datagram-class_method">send_datagram</span><span class='args'>(target, data, datalength, host, port)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#send_datagram.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_file_data-class_method">send_file_data</span><span class='args'>(sig, filename)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#send_file_data.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_comm_inactivity_timeout-class_method">set_comm_inactivity_timeout</span><span class='args'>(sig, tm)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#set_comm_inactivity_timeout.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_descriptor_table_size-class_method">set_descriptor_table_size</span><span class='args'>(n_descriptors = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets the maximum number of file or socket descriptors that your process may
open.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_effective_user-class_method">set_effective_user</span><span class='args'>(username)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
A wrapper over the setuid system call.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_max_timer_count-class_method">set_max_timer_count</span><span class='args'>(n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#set_max_timer_count is a harmless no-op in pure Ruby, which doesn&#8217;t
have a built-in limit on the number of available timers.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_max_timers-class_method">set_max_timers</span><span class='args'>(ct)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets the maximum number of timers and periodic timers that may be
outstanding at any given time.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_quantum-class_method">set_quantum</span><span class='args'>(mills)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
For advanced users.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_rlimit_nofile-class_method">set_rlimit_nofile</span><span class='args'>(n)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#set_rlimit_nofile is a no-op in the pure-Ruby implementation.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_timer_quantum-class_method">set_timer_quantum</span><span class='args'>(interval)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#set_timer_quantum in milliseconds.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#signal_loopbreak-class_method">signal_loopbreak</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#signal_loopbreak.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#spawn-class_method">spawn</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Spawn an erlang-style process.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#spawn_threadpool-class_method">spawn_threadpool</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ssl-3F-class_method">ssl?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#ssl? is not implemented for pure-Ruby implementation.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#start_server-class_method">start_server</span><span class='args'>(server, port = nil, handler = nil, *args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine::start_server initiates a TCP server (socket acceptor) on the
specified IP address and port.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#start_tcp_server-class_method">start_tcp_server</span><span class='args'>(host, port)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#start_tcp_server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#start_tls-class_method">start_tls</span><span class='args'>(sig)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#start_unix_domain_server-class_method">start_unix_domain_server</span><span class='args'>(filename, *args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Start a Unix-domain server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#start_unix_server-class_method">start_unix_server</span><span class='args'>(chain)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#start_unix_server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stop-class_method">stop</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#stop.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stop_event_loop-class_method">stop_event_loop</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
stop_event_loop may called from within a callback method while
EventMachine&#8217;s processing loop is running.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stop_server-class_method">stop_server</span><span class='args'>(signature)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Stop a TCP server socket that was started with EventMachine#start_server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stop_tcp_server-class_method">stop_tcp_server</span><span class='args'>(sig)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
#stop_tcp_server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#system-class_method">system</span><span class='args'>(cmd, *args, &amp;cb)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EM::system is a simple wrapper for EM::popen.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#watch_file-class_method">watch_file</span><span class='args'>(filename, handler = nil, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine&#8217;s file monitoring API.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#watch_process-class_method">watch_process</span><span class='args'>(pid, handler = nil, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
EventMachine&#8217;s process monitoring API.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#yield-class_method">yield</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#yield_and_notify-class_method">yield_and_notify</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>add_oneshot_timer</h3>
</div><div id="add_oneshot_timer-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_oneshot_timer</span><span class='args'>(interval)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#add_oneshot_timer &#8212; Changed 04Oct06: intervals from the caller are
now in milliseconds, but our native-ruby processor still wants them in
seconds.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 58</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L58">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">58
59
60</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='add_oneshot_timer identifier id'>add_oneshot_timer</span> <span class='interval identifier id'>interval</span>
  <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='install_oneshot_timer identifier id'>install_oneshot_timer</span><span class='lparen token'>(</span><span class='interval identifier id'>interval</span> <span class='div op'>/</span> <span class='integer val'>1000</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_periodic_timer</h3>
</div><div id="add_periodic_timer-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_periodic_timer</span><span class='args'>(*args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine#add_periodic_timer adds a periodic timer to the event loop. It
takes the same parameters as the one-shot timer method,
EventMachine#add_timer. This method schedules execution of the given block
repeatedly, at intervals of time <em>at least</em> as great as the number
of seconds given in the first parameter to the call.
</p>
<h3>Usage example</h3>
<p>
The following sample program will write a dollar-sign to stderr every five
seconds. (Of course if the program defined network clients and/or servers,
they would be doing their work while the periodic timer is counting off.)
</p>
<pre class="code">
 <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='add_periodic_timer identifier id'>add_periodic_timer</span><span class='lparen token'>(</span> <span class='integer val'>5</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='$stderr gvar id'>$stderr</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='string val'>&quot;$&quot;</span> <span class='rbrace token'>}</span>
 <span class='rbrace token'>}</span>
</pre>
<p>
Also see EventMachine::PeriodicTimer
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 381</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L381">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">381
382
383
384
385
386
387
388
389
390
391</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='add_periodic_timer identifier id'>add_periodic_timer</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='interval identifier id'>interval</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
  <span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span> <span class='orop op'>||</span> <span class='block identifier id'>block</span>
  <span class='if if kw'>if</span> <span class='code identifier id'>code</span>
    <span class='block_1 identifier id'>block_1</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
      <span class='code identifier id'>code</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
      <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='add_periodic_timer identifier id'>add_periodic_timer</span> <span class='interval identifier id'>interval</span><span class='comma token'>,</span> <span class='code identifier id'>code</span>
    <span class='rbrace token'>}</span>
    <span class='add_timer identifier id'>add_timer</span> <span class='interval identifier id'>interval</span><span class='comma token'>,</span> <span class='block_1 identifier id'>block_1</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_timer</h3>
</div><div id="add_timer-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_timer</span><span class='args'>(*args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine#add_timer adds a one-shot timer to the event loop. Call it
with one or two parameters. The first parameters is a delay-time expressed
in <em>seconds</em> (not milliseconds). The second parameter, if present,
must be a proc object. If a proc object is not given, then you can also
simply pass a block to the method call.
</p>
<p>
EventMachine#add_timer may be called from the block passed to
EventMachine#run or from any callback method. It schedules execution of the
proc or block passed to add_timer, after the passage of an interval of time
equal to <em>at least</em> the number of seconds specified in the first
parameter to the call.
</p>
<p>
EventMachine#add_timer is a <em>non-blocking</em> call. Callbacks can and
will be called during the interval of time that the timer is in effect.
There is no built-in limit to the number of timers that can be outstanding
at any given time.
</p>
<h3>Usage example</h3>
<p>
This example shows how easy timers are to use. Observe that two timers are
initiated simultaneously. Also, notice that the event loop will continue to
run even after the second timer event is processed, since there was no call
to EventMachine#stop_event_loop. There will be no activity, of course,
since no network clients or servers are defined. Stop the program with
Ctrl-C.
</p>
<pre class="code">
 <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Starting the run now: #{Time.now}&quot;</span>
   <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='add_timer identifier id'>add_timer</span> <span class='integer val'>5</span><span class='comma token'>,</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span> <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Executing timer event: #{Time.now}&quot;</span> <span class='rbrace token'>}</span>
   <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='add_timer identifier id'>add_timer</span><span class='lparen token'>(</span> <span class='integer val'>10</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Executing timer event: #{Time.now}&quot;</span> <span class='rbrace token'>}</span>
 <span class='rbrace token'>}</span>
</pre>
<p>
Also see EventMachine::Timer &#8212; Changed 04Oct06: We now pass the
interval as an integer number of milliseconds.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 351</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L351">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">351
352
353
354
355
356
357
358
359
360</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='add_timer identifier id'>add_timer</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='interval identifier id'>interval</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
  <span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span> <span class='orop op'>||</span> <span class='block identifier id'>block</span>
  <span class='if if kw'>if</span> <span class='code identifier id'>code</span>
    <span class='comment val'># check too many timers!</span>
    <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='add_oneshot_timer identifier id'>add_oneshot_timer</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='interval identifier id'>interval</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='mult op'>*</span> <span class='integer val'>1000</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span>
    <span class='@timers ivar id'>@timers</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='code identifier id'>code</span>
    <span class='s identifier id'>s</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>attach</h3>
</div><div id="attach-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>attach</span><span class='args'>(io, handler = nil, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine::attach registers a given file descriptor or IO object with
the eventloop
</p>
<p>
If the handler provided has the functions notify_readable or
notify_writable defined, EventMachine will not read or write from the
socket, and instead fire the corresponding callback on the handler.
</p>
<p>
To detach the file descriptor, use EventMachine::Connection#detach
</p>
<h3>Usage Example</h3>
<pre class="code">
 <span class='module module kw'>module</span> <span class='SimpleHttpClient constant id'>SimpleHttpClient</span>
   <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='sock identifier id'>sock</span>
     <span class='@sock ivar id'>@sock</span> <span class='assign token'>=</span> <span class='sock identifier id'>sock</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='notify_readable identifier id'>notify_readable</span>
     <span class='header identifier id'>header</span> <span class='assign token'>=</span> <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='readline identifier id'>readline</span>

     <span class='if if kw'>if</span> <span class='header identifier id'>header</span> <span class='eq op'>==</span> <span class='string val'>&quot;\r\n&quot;</span>
       <span class='comment val'># detach returns the file descriptor number (fd == @sock.fileno)</span>
       <span class='fd identifier id'>fd</span> <span class='assign token'>=</span> <span class='detach identifier id'>detach</span>
     <span class='end end kw'>end</span>
   <span class='rescue rescue kw'>rescue</span> <span class='EOFError constant id'>EOFError</span>
     <span class='detach identifier id'>detach</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='unbind identifier id'>unbind</span>
     <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='next_tick identifier id'>next_tick</span> <span class='do do kw'>do</span>
       <span class='comment val'># socket is detached from the eventloop, but still open</span>
       <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
     <span class='end end kw'>end</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lbrace token'>{</span>
   <span class='$sock gvar id'>$sock</span> <span class='assign token'>=</span> <span class='TCPSocket constant id'>TCPSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'site.com'</span><span class='comma token'>,</span> <span class='integer val'>80</span><span class='rparen token'>)</span>
   <span class='$sock gvar id'>$sock</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='string val'>&quot;GET / HTTP/1.0\r\n\r\n&quot;</span><span class='rparen token'>)</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='attach identifier id'>attach</span> <span class='$sock gvar id'>$sock</span><span class='comma token'>,</span> <span class='SimpleHttpClient constant id'>SimpleHttpClient</span><span class='comma token'>,</span> <span class='$sock gvar id'>$sock</span>
 <span class='rbrace token'>}</span>
</pre>
<p>
&#8212; Thanks to Riham Aldakkak (eSpace Technologies) for the initial
patch
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 768</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L768">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span>  <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='attach identifier id'>attach</span> <span class='io identifier id'>io</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::Connection'</span> <span class='unless unless_mod kw'>unless</span> <span class='Connection constant id'>Connection</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='Connection constant id'>Connection</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='arity identifier id'>arity</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_method identifier id'>instance_method</span><span class='lparen token'>(</span><span class='symbol val'>:initialize</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
  <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='arity identifier id'>arity</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span>
  <span class='end end kw'>end</span>

  <span class='readmode identifier id'>readmode</span>  <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='public_instance_methods identifier id'>public_instance_methods</span><span class='dot token'>.</span><span class='any? fid id'>any?</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='eq op'>==</span> <span class='symbol val'>:notify_readable</span> <span class='rbrace token'>}</span>
  <span class='writemode identifier id'>writemode</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='public_instance_methods identifier id'>public_instance_methods</span><span class='dot token'>.</span><span class='any? fid id'>any?</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='eq op'>==</span> <span class='symbol val'>:notify_writable</span> <span class='rbrace token'>}</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='attach_fd identifier id'>attach_fd</span> <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:fileno</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='fileno identifier id'>fileno</span> <span class='colon op'>:</span> <span class='io identifier id'>io</span><span class='comma token'>,</span> <span class='readmode identifier id'>readmode</span><span class='comma token'>,</span> <span class='writemode identifier id'>writemode</span>

  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
  <span class='block_given? fid id'>block_given?</span> <span class='and and kw'>and</span> <span class='yield yield kw'>yield</span> <span class='c identifier id'>c</span>
  <span class='c identifier id'>c</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>bind_connect</h3>
</div><div id="bind_connect-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>bind_connect</span><span class='args'>(bind_addr, bind_port, server, port = nil, handler = nil, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine#connect initiates a TCP connection to a remote server and sets
up event-handling for the connection. You can call EventMachine#connect in
the block supplied to EventMachine#run or in any callback method.
</p>
<p>
EventMachine#connect takes the IP address (or hostname) and port of the
remote server you want to connect to. It also takes an optional handler
Module which you must define, that contains the callbacks that will be
invoked by the event loop on behalf of the connection.
</p>
<p>
See the description of EventMachine#start_server for a discussion of the
handler Module. All of the details given in that description apply for
connections created with EventMachine#connect.
</p>
<h3>Usage Example</h3>
<p>
Here&#8217;s a program which connects to a web server, sends a naive
request, parses the HTTP header of the response, and then (antisocially)
ends the event loop, which automatically drops the connection (and
incidentally calls the connection&#8217;s unbind method).
</p>
<pre class="code">
 <span class='module module kw'>module</span> <span class='DumbHttpClient constant id'>DumbHttpClient</span>
   <span class='def def kw'>def</span> <span class='post_init identifier id'>post_init</span>
     <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;GET / HTTP/1.1\r\nHost: _\r\n\r\n&quot;</span>
     <span class='@data ivar id'>@data</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='receive_data identifier id'>receive_data</span> <span class='data identifier id'>data</span>
     <span class='@data ivar id'>@data</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span>
     <span class='if if kw'>if</span>  <span class='@data ivar id'>@data</span> <span class='match op'>=~</span> <span class='regexp val'>/[\n][\r]*[\n]/</span><span class='m identifier id'>m</span>
       <span class='puts identifier id'>puts</span> <span class='string val'>&quot;RECEIVED HTTP HEADER:&quot;</span>
       <span class='$` back_ref id'>$`</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='puts identifier id'>puts</span> <span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='comment val'>#{line&lt;/tt&gt;&quot; }</span>

       <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Now we'll terminate the loop, which will also close the connection&quot;</span>
       <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='stop_event_loop identifier id'>stop_event_loop</span>
     <span class='end end kw'>end</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='unbind identifier id'>unbind</span>
     <span class='puts identifier id'>puts</span> <span class='string val'>&quot;A connection has terminated&quot;</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='connect identifier id'>connect</span> <span class='string val'>&quot;www.bayshorenetworks.com&quot;</span><span class='comma token'>,</span> <span class='integer val'>80</span><span class='comma token'>,</span> <span class='DumbHttpClient constant id'>DumbHttpClient</span>
 <span class='rbrace token'>}</span>
 <span class='puts identifier id'>puts</span> <span class='string val'>&quot;The event loop has ended&quot;</span>
</pre>
<p>
There are times when it&#8217;s more convenient to define a protocol
handler as a Class rather than a Module. Here&#8217;s how to do this:
</p>
<pre class="code">
 <span class='class class kw'>class</span> <span class='MyProtocolHandler constant id'>MyProtocolHandler</span> <span class='lt op'>&lt;</span> <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='Connection constant id'>Connection</span>
   <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
     <span class='super super kw'>super</span>
     <span class='comment val'># whatever else you want to do here</span>
   <span class='end end kw'>end</span>

   <span class='comment val'>#.......your other class code</span>
 <span class='end end kw'>end</span>
</pre>
<p>
If you do this, then an instance of your class will be instantiated to
handle every network connection created by your code or accepted by servers
that you create. If you redefine #post_init in your protocol-handler class,
your #post_init method will be called <em>inside</em> the call to #super
that you will make in your #initialize method (if you provide one).
</p>
<p>
&#8212; EventMachine::connect initiates a TCP connection to a remote server
and sets up event-handling for the connection. It internally creates an
object that should not be handled by the caller. HOWEVER, it&#8217;s often
convenient to get the object to set up interfacing to other objects in the
system. We return the newly-created anonymous-class object to the caller.
It&#8217;s expected that a considerable amount of code will depend on this
behavior, so don&#8217;t change it.
</p>
<p>
Ok, added support for a user-defined block, 13Apr06. This leads us to an
interesting choice because of the presence of the post_init call, which
happens in the initialize method of the new object. We call the
user&#8217;s block and pass the new object to it. This is a great way to do
protocol-specific initiation. It happens AFTER post_init has been called on
the object, which I certainly hope is the right choice. Don&#8217;t change
this lightly, because accepted connections are different from connected
ones and we don&#8217;t want to have them behave differently with respect
to post_init if at all possible.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 682</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L682">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='bind_connect identifier id'>bind_connect</span> <span class='bind_addr identifier id'>bind_addr</span><span class='comma token'>,</span> <span class='bind_port identifier id'>bind_port</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='begin begin kw'>begin</span>
    <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='port identifier id'>port</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='TypeError constant id'>TypeError</span>
    <span class='comment val'># there was no port, so server must be a unix domain socket</span>
    <span class='comment val'># the port argument is actually the handler, and the handler is one of the args</span>
    <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='handler identifier id'>handler</span> <span class='if if_mod kw'>if</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span> <span class='assign token'>=</span> <span class='port identifier id'>port</span>
    <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span> <span class='if if_mod kw'>if</span> <span class='port identifier id'>port</span>

  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::Connection'</span> <span class='unless unless_mod kw'>unless</span> <span class='Connection constant id'>Connection</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='Connection constant id'>Connection</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='arity identifier id'>arity</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_method identifier id'>instance_method</span><span class='lparen token'>(</span><span class='symbol val'>:initialize</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
  <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='arity identifier id'>arity</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span>
  <span class='end end kw'>end</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='port identifier id'>port</span>
        <span class='if if kw'>if</span> <span class='bind_addr identifier id'>bind_addr</span>
          <span class='bind_connect_server identifier id'>bind_connect_server</span> <span class='bind_addr identifier id'>bind_addr</span><span class='comma token'>,</span> <span class='bind_port identifier id'>bind_port</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
        <span class='else else kw'>else</span>
          <span class='connect_server identifier id'>connect_server</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='connect_unix_server identifier id'>connect_unix_server</span> <span class='server identifier id'>server</span>
      <span class='end end kw'>end</span>

  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
  <span class='block_given? fid id'>block_given?</span> <span class='and and kw'>and</span> <span class='yield yield kw'>yield</span> <span class='c identifier id'>c</span>
  <span class='c identifier id'>c</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>bind_connect_server</h3>
</div><div id="bind_connect_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>bind_connect_server</span><span class='args'>(bind_addr, bind_port, host, port)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/jeventmachine.rb', line 90</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/jeventmachine.rb#L90">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">90
91
92</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='bind_connect_server identifier id'>bind_connect_server</span> <span class='bind_addr identifier id'>bind_addr</span><span class='comma token'>,</span> <span class='bind_port identifier id'>bind_port</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
  <span class='EvmaTCPClient constant id'>EvmaTCPClient</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span><span class='lparen token'>(</span><span class='bind_addr identifier id'>bind_addr</span><span class='comma token'>,</span> <span class='bind_port identifier id'>bind_port</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='uuid identifier id'>uuid</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>Callback</h3>
</div><div id="Callback-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>Callback</span><span class='args'>(object = nil, method = nil, &amp;blk)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Utility method for coercing arguments to an object that responds to #call
Accepts an object and a method name to send to, or a block, or an object
that responds to call.
</p>
<pre class="code">
 <span class='cb identifier id'>cb</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='Callback constant id'>Callback</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='msg identifier id'>msg</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span><span class='lparen token'>(</span><span class='msg identifier id'>msg</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
 <span class='cb identifier id'>cb</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='string val'>'hello world'</span><span class='rparen token'>)</span>

 <span class='cb identifier id'>cb</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='Callback constant id'>Callback</span><span class='lparen token'>(</span><span class='Object constant id'>Object</span><span class='comma token'>,</span> <span class='symbol val'>:puts</span><span class='rparen token'>)</span>
 <span class='cb identifier id'>cb</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='string val'>'hello world'</span><span class='rparen token'>)</span>

 <span class='cb identifier id'>cb</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='Callback constant id'>Callback</span><span class='lparen token'>(</span><span class='proc identifier id'>proc</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='msg identifier id'>msg</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span><span class='lparen token'>(</span><span class='msg identifier id'>msg</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
 <span class='cb identifier id'>cb</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='string val'>'hello world'</span><span class='rparen token'>)</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/callback.rb', line 15</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/callback.rb#L15">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">15
16
17
18
19
20
21
22
23
24
25</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='Callback constant id'>Callback</span><span class='lparen token'>(</span><span class='object identifier id'>object</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='method identifier id'>method</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='object identifier id'>object</span> <span class='andop op'>&amp;&amp;</span> <span class='method identifier id'>method</span>
    <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='bitor op'>|</span> <span class='object identifier id'>object</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='if if kw'>if</span> <span class='object identifier id'>object</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span> <span class='colon op'>:</span><span class='call identifier id'>call</span>
      <span class='object identifier id'>object</span>
    <span class='else else kw'>else</span> 
      <span class='blk identifier id'>blk</span> <span class='orop op'>||</span> <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='ArgumentError constant id'>ArgumentError</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cancel_timer</h3>
</div><div id="cancel_timer-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cancel_timer</span><span class='args'>(signature)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Cancel a timer using its signature. You can also use
EventMachine::Timer#cancel
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 395</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L395">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">395
396
397</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='cancel_timer identifier id'>cancel_timer</span> <span class='signature identifier id'>signature</span>
  <span class='@timers ivar id'>@timers</span><span class='lbrack token'>[</span><span class='signature identifier id'>signature</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='@timers ivar id'>@timers</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='signature identifier id'>signature</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>close_connection</h3>
</div><div id="close_connection-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>close_connection</span><span class='args'>(target, after_writing)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#close_connection The extension version does NOT raise any kind of an error
if an attempt is made to close a non-existent connection. Not sure whether
we should. For now, we&#8217;ll raise an error here in that case.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 96</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L96">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">96
97
98
99</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='close_connection identifier id'>close_connection</span> <span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='after_writing identifier id'>after_writing</span>
  <span class='selectable identifier id'>selectable</span> <span class='assign token'>=</span> <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='get_selectable identifier id'>get_selectable</span><span class='lparen token'>(</span> <span class='target identifier id'>target</span> <span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unknown close_connection target&quot;</span>
  <span class='selectable identifier id'>selectable</span><span class='dot token'>.</span><span class='schedule_close identifier id'>schedule_close</span> <span class='after_writing identifier id'>after_writing</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>connect</h3>
</div><div id="connect-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connect</span><span class='args'>(server, port = nil, handler = nil, *args, &amp;blk)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 722</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L722">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">722
723
724</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span>
  <span class='bind_connect identifier id'>bind_connect</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>connect_server</h3>
</div><div id="connect_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connect_server</span><span class='args'>(host, port)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#connect_server. Return a connection descriptor to the caller. TODO, what
do we return here if we can&#8217;t connect?
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 78</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L78">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">78
79
80</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='connect_server identifier id'>connect_server</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
  <span class='bind_connect_server identifier id'>bind_connect_server</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>connect_unix_domain</h3>
</div><div id="connect_unix_domain-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connect_unix_domain</span><span class='args'>(socketname, *args, &amp;blk)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Make a connection to a Unix-domain socket. This is not implemented on
Windows platforms. The parameter socketname is a String which identifies
the Unix-domain socket you want to connect to. socketname is the name of a
file on your local system, and in most cases is a fully-qualified path
name. Make sure that your process has enough local permissions to open the
Unix-domain socket. See also the documentation for #connect. This method
behaves like #connect in all respects except for the fact that it connects
to a local Unix-domain socket rather than a TCP socket.
</p>
<p>
Note that this method is simply an alias for #connect, which can connect to
both TCP and Unix-domain sockets &#8212; For making connections to
Unix-domain sockets. Eventually this has to get properly documented and
unified with the TCP-connect methods. Note how nearly identical this is to
EventMachine#connect
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 834</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L834">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">834
835
836</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='connect_unix_domain identifier id'>connect_unix_domain</span> <span class='socketname identifier id'>socketname</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span>
  <span class='connect identifier id'>connect</span> <span class='socketname identifier id'>socketname</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>connect_unix_server</h3>
</div><div id="connect_unix_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connect_unix_server</span><span class='args'>(chain)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#connect_unix_server
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 120</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L120">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">120
121
122</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='connect_unix_server identifier id'>connect_unix_server</span> <span class='chain identifier id'>chain</span>
  <span class='EvmaUNIXClient constant id'>EvmaUNIXClient</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span><span class='lparen token'>(</span><span class='chain identifier id'>chain</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='uuid identifier id'>uuid</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>connection_count</h3>
</div><div id="connection_count-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connection_count</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the total number of connections (file descriptors) currently held
by the reactor. Note that a tick must pass after the
&#8216;initiation&#8217; of a connection for this number to increment.
It&#8217;s usually accurate, but don&#8217;t rely on the exact precision of
this number unless you really know EM internals.
</p>
<p>
For example, $count will be 0 in this case:
</p>
<pre class="code">
 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span><span class='lparen token'>(</span><span class='string val'>&quot;rubyeventmachine.com&quot;</span><span class='comma token'>,</span> <span class='integer val'>80</span><span class='rparen token'>)</span>
   <span class='$count gvar id'>$count</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='connection_count identifier id'>connection_count</span>
 <span class='rbrace token'>}</span>
</pre>
<p>
In this example, $count will be 1 since the connection has been established
in the next loop of the reactor.
</p>
<pre class="code">
 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span><span class='lparen token'>(</span><span class='string val'>&quot;rubyeventmachine.com&quot;</span><span class='comma token'>,</span> <span class='integer val'>80</span><span class='rparen token'>)</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='next_tick identifier id'>next_tick</span> <span class='lbrace token'>{</span>
     <span class='$count gvar id'>$count</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='connection_count identifier id'>connection_count</span>
   <span class='rbrace token'>}</span>
 <span class='rbrace token'>}</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 975</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L975">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">975
976
977</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='connection_count identifier id'>connection_count</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='get_connection_count identifier id'>get_connection_count</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>defer</h3>
</div><div id="defer-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>defer</span><span class='args'>(op = nil, callback = nil, &amp;blk)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#defer is for integrating blocking operations into EventMachine&#8217;s
control flow. Call #defer with one or two blocks, as shown below (the
second block is <em>optional</em>):
</p>
<pre class="code">
 <span class='operation identifier id'>operation</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
   <span class='comment val'># perform a long-running operation here, such as a database query.</span>
   <span class='string val'>&quot;result&quot;</span> <span class='comment val'># as usual, the last expression evaluated in the block will be the return value.</span>
 <span class='rbrace token'>}</span>
 <span class='callback identifier id'>callback</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='bitor op'>|</span>
   <span class='comment val'># do something with result here, such as send it back to a network client.</span>
 <span class='rbrace token'>}</span>

 <span class='EventMachine constant id'>EventMachine</span><span class='dot token'>.</span><span class='defer identifier id'>defer</span><span class='lparen token'>(</span> <span class='operation identifier id'>operation</span><span class='comma token'>,</span> <span class='callback identifier id'>callback</span> <span class='rparen token'>)</span>
</pre>
<p>
The action of #defer is to take the block specified in the first parameter
(the &quot;operation&quot;) and schedule it for asynchronous execution on
an internal thread pool maintained by EventMachine. When the operation
completes, it will pass the result computed by the block (if any) back to
the EventMachine reactor. Then, EventMachine calls the block specified in
the second parameter to #defer (the &quot;callback&quot;), as part of its
normal, synchronous event handling loop. The result computed by the
operation block is passed as a parameter to the callback. You may omit the
callback parameter if you don&#8217;t need to execute any code after the
operation completes.
</p>
<h2>Caveats</h2>
<p>
Note carefully that the code in your deferred operation will be executed on
a separate thread from the main EventMachine processing and all other Ruby
threads that may exist in your program. Also, multiple deferred operations
may be running at once! Therefore, you are responsible for ensuring that
your operation code is threadsafe. [Need more explanation and examples.]
Don&#8217;t write a deferred operation that will block forever. If so, the
current implementation will not detect the problem, and the thread will
never be returned to the pool. EventMachine limits the number of threads in
its pool, so if you do this enough times, your subsequent deferred
operations won&#8217;t get a chance to run. [We might put in a timer to
detect this problem.]
</p>
<p>
&#8212; OBSERVE that #next_tick hacks into this mechanism, so don&#8217;t
make any changes here without syncing there.
</p>
<p>
Running with $VERBOSE set to true gives a warning unless all ivars are
defined when they appear in rvalues. But we DON&#8217;T ever want to
initialize @threadqueue unless we need it, because the Ruby threads are so
heavyweight. We end up with this bizarre way of initializing @threadqueue
because EventMachine is a Module, not a Class, and has no constructor.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1059</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1059">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='defer identifier id'>defer</span> <span class='op identifier id'>op</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='callback identifier id'>callback</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span>
  <span class='unless unless kw'>unless</span> <span class='@threadpool ivar id'>@threadpool</span>
    <span class='require identifier id'>require</span> <span class='string val'>'thread'</span>
    <span class='@threadpool ivar id'>@threadpool</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='@threadqueue ivar id'>@threadqueue</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Queue constant id'>Queue</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='@resultqueue ivar id'>@resultqueue</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Queue constant id'>Queue</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='spawn_threadpool identifier id'>spawn_threadpool</span>
  <span class='end end kw'>end</span>

  <span class='@threadqueue ivar id'>@threadqueue</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='op identifier id'>op</span><span class='orop op'>||</span><span class='blk identifier id'>blk</span><span class='comma token'>,</span><span class='callback identifier id'>callback</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>epoll</h3>
</div><div id="epoll-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>epoll</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#epoll is a harmless no-op in the pure-Ruby implementation. This is
intended to ensure that user code behaves properly across different EM
implementations.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 156</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L156">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">156
157</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='epoll identifier id'>epoll</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>error_handler</h3>
</div><div id="error_handler-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>error_handler</span><span class='args'>(cb = nil, &amp;blk)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Catch-all for errors raised during event loop callbacks.
</p>
<pre class="code">
 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='error_handler identifier id'>error_handler</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='e identifier id'>e</span><span class='bitor op'>|</span>
   <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Error raised during event loop: #{e.message}&quot;</span>
 <span class='rbrace token'>}</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1372</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1372">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1372
1373
1374
1375
1376
1377
1378</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='error_handler identifier id'>error_handler</span> <span class='cb identifier id'>cb</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='blk identifier id'>blk</span>
  <span class='if if kw'>if</span> <span class='cb identifier id'>cb</span> <span class='or or kw'>or</span> <span class='blk identifier id'>blk</span>
    <span class='@error_handler ivar id'>@error_handler</span> <span class='assign token'>=</span> <span class='cb identifier id'>cb</span> <span class='orop op'>||</span> <span class='blk identifier id'>blk</span>
  <span class='elsif elsif kw'>elsif</span> <span class='instance_variable_defined? fid id'>instance_variable_defined?</span> <span class='symbol val'>:@error_handler</span>
    <span class='remove_instance_variable identifier id'>remove_instance_variable</span> <span class='symbol val'>:@error_handler</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>event_callback</h3>
</div><div id="event_callback-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>event_callback</span><span class='args'>(target, opcode, data)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1382</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1382">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1382
1383
1384</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='event_callback identifier id'>event_callback</span> <span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='opcode identifier id'>opcode</span><span class='comma token'>,</span> <span class='data identifier id'>data</span>
  <span class='Evma constant id'>Evma</span><span class='colon2 op'>::</span><span class='Container constant id'>Container</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span> <span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='opcode identifier id'>opcode</span><span class='comma token'>,</span> <span class='data identifier id'>data</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fork_reactor</h3>
</div><div id="fork_reactor-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fork_reactor</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
fork_reactor forks a new process and calls EM#run inside of it, passing
your block. &#8212; This implementation is subject to change, especially if
we clean up the relationship of EM#run to @reactor_running. Original patch
by Aman Gupta.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 303</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L303">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">303
304
305
306
307
308
309
310
311
312</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fork_reactor identifier id'>fork_reactor</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='Kernel constant id'>Kernel</span><span class='dot token'>.</span><span class='fork identifier id'>fork</span> <span class='do do kw'>do</span>
    <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reactor_running? fid id'>reactor_running?</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='stop_event_loop identifier id'>stop_event_loop</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='release_machine identifier id'>release_machine</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span> <span class='string val'>'@reactor_running'</span><span class='comma token'>,</span> <span class='false false kw'>false</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='block identifier id'>block</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_max_timers</h3>
</div><div id="get_max_timers-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_max_timers</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Gets the current maximum number of allowed timers
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 951</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L951">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">951
952
953</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='get_max_timers identifier id'>get_max_timers</span>
  <span class='get_max_timer_count identifier id'>get_max_timer_count</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_outbound_data_size</h3>
</div><div id="get_outbound_data_size-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_outbound_data_size</span><span class='args'>(sig)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#get_outbound_data_size
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 190</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L190">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">190
191
192
193</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_outbound_data_size identifier id'>get_outbound_data_size</span> <span class='sig identifier id'>sig</span>
  <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='get_selectable identifier id'>get_selectable</span><span class='lparen token'>(</span> <span class='sig identifier id'>sig</span> <span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unknown get_outbound_data_size target&quot;</span>
  <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='get_outbound_data_size identifier id'>get_outbound_data_size</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_peername</h3>
</div><div id="get_peername-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_peername</span><span class='args'>(sig)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#get_peername
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 130</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L130">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">130
131
132
133</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_peername identifier id'>get_peername</span> <span class='sig identifier id'>sig</span>
  <span class='selectable identifier id'>selectable</span> <span class='assign token'>=</span> <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='get_selectable identifier id'>get_selectable</span><span class='lparen token'>(</span> <span class='sig identifier id'>sig</span> <span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unknown get_peername target&quot;</span>
  <span class='selectable identifier id'>selectable</span><span class='dot token'>.</span><span class='get_peername identifier id'>get_peername</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>initialize_event_machine</h3>
</div><div id="initialize_event_machine-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize_event_machine</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#initialize_event_machine
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 50</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L50">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">50
51
52</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize_event_machine identifier id'>initialize_event_machine</span>
  <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='initialize_for_run identifier id'>initialize_for_run</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_popen</h3>
</div><div id="invoke_popen-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_popen</span><span class='args'>(cmd)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/jeventmachine.rb', line 121</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/jeventmachine.rb#L121">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">121
122
123
124</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='invoke_popen identifier id'>invoke_popen</span> <span class='cmd identifier id'>cmd</span>
  <span class='comment val'># TEMPORARILY unsupported until someone figures out how to do it.</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unsupported on this platform&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>library_type</h3>
</div><div id="library_type-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>library_type</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This is mostly useful for automated tests. Return a distinctive symbol so
the caller knows whether he&#8217;s dealing with an extension or with a
pure-Ruby library.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 45</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L45">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">45
46
47</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='library_type identifier id'>library_type</span>
  <span class='symbol val'>:pure_ruby</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>next_tick</h3>
</div><div id="next_tick-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>next_tick</span><span class='args'>(pr = nil, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Schedules a proc for execution immediately after the next &quot;turn&quot;
through the reactor core. An advanced technique, this can be useful for
improving memory management and/or application responsiveness, especially
when scheduling large amounts of data for writing to a network connection.
TODO, we need a FAQ entry on this subject.
</p>
<p>
#next_tick takes either a single argument (which must be a Proc) or a
block. &#8212; This works by adding to the @resultqueue that&#8217;s used
for #defer. The general idea is that next_tick is used when we want to give
the reactor a chance to let other operations run, either to balance the
load out more evenly, or to let outbound network buffers drain, or both. So
we probably do NOT want to block, and we probably do NOT want to be
spinning any threads. A program that uses next_tick but not #defer
shouldn&#8217;t suffer the penalty of having Ruby threads running.
They&#8217;re extremely expensive even if they&#8217;re just sleeping.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1108</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1108">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='next_tick identifier id'>next_tick</span> <span class='pr identifier id'>pr</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;no argument or block given&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='pr identifier id'>pr</span> <span class='andop op'>&amp;&amp;</span> <span class='pr identifier id'>pr</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:call</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='@next_tick_queue ivar id'>@next_tick_queue</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='lparen token'>(</span> <span class='pr identifier id'>pr</span> <span class='orop op'>||</span> <span class='block identifier id'>block</span> <span class='rparen token'>)</span>
  <span class='signal_loopbreak identifier id'>signal_loopbreak</span> <span class='if if_mod kw'>if</span> <span class='reactor_running? fid id'>reactor_running?</span>
<span class='comment val'>=begin
  (@next_tick_procs ||= []) &lt;&lt; (pr || block)
  if @next_tick_procs.length == 1
    add_timer(0) {
      @next_tick_procs.each {|t| t.call}
      @next_tick_procs.clear
    }
  end
=end
</span>

<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>open_datagram_socket</h3>
</div><div id="open_datagram_socket-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>open_datagram_socket</span><span class='args'>(address, port, handler = nil, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine#open_datagram_socket is for support of UDP-based protocols.
Its usage is similar to that of EventMachine#start_server. It takes three
parameters: an IP address (which must be valid on the machine which
executes the method), a port number, and an optional Module name which will
handle the data. This method will create a new UDP (datagram) socket and
bind it to the address and port that you specify. The normal callbacks (see
EventMachine#start_server) will be called as events of interest occur on
the newly-created socket, but there are some differences in how they
behave.
</p>
<p>
Connection#receive_data will be called when a datagram packet is received
on the socket, but unlike TCP sockets, the message boundaries of the
received data will be respected. In other words, if the remote peer sent
you a datagram of a particular size, you may rely on
Connection#receive_data to give you the exact data in the packet, with the
original data length. Also observe that Connection#receive_data may be
called with a <em>zero-length</em> data payload, since empty datagrams are
permitted in UDP.
</p>
<p>
Connection#send_data is available with UDP packets as with TCP, but there
is an important difference. Because UDP communications are
<em>connectionless,</em> there is no implicit recipient for the packets you
send. Ordinarily you must specify the recipient for each packet you send.
However, EventMachine provides for the typical pattern of receiving a UDP
datagram from a remote peer, performing some operation, and then sending
one or more packets in response to the same remote peer. To support this
model easily, just use Connection#send_data in the code that you supply for
Connection:receive_data. EventMachine will provide an implicit return
address for any messages sent to Connection#send_data within the context of
a Connection#receive_data callback, and your response will automatically go
to the correct remote peer. (TODO: Example-code needed!)
</p>
<p>
Observe that the port number that you supply to
EventMachine#open_datagram_socket may be zero. In this case, EventMachine
will create a UDP socket that is bound to an <em>ephemeral</em> (not
well-known) port. This is not appropriate for servers that must publish a
well-known port to which remote peers may send datagrams. But it can be
useful for clients that send datagrams to other servers. If you do this,
you will receive any responses from the remote servers through the normal
Connection#receive_data callback. Observe that you will probably have
issues with firewalls blocking the ephemeral port numbers, so this
technique is most appropriate for LANs. (TODO: Need an example!)
</p>
<p>
If you wish to send datagrams to arbitrary remote peers (not necessarily
ones that have sent data to which you are responding), then see
Connection#send_datagram.
</p>
<p>
DO NOT call send_data from a datagram socket outside of a #receive_data
method. Use #send_datagram. If you do use #send_data outside of a
#receive_data method, you&#8217;ll get a confusing error because there is
no &quot;peer,&quot; as #send_data requires. (Inside of #receive_data,
#send_data &quot;fakes&quot; the peer as described above.)
</p>
<p>
&#8212; Replaced the implementation on 01Oct06. Thanks to Tobias Gustafsson
for pointing out that this originally did not take a class but only a
module.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 902</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L902">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='open_datagram_socket identifier id'>open_datagram_socket</span> <span class='address identifier id'>address</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::Connection'</span> <span class='unless unless_mod kw'>unless</span> <span class='Connection constant id'>Connection</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='Connection constant id'>Connection</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='arity identifier id'>arity</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_method identifier id'>instance_method</span><span class='lparen token'>(</span><span class='symbol val'>:initialize</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
  <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='arity identifier id'>arity</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span>
  <span class='end end kw'>end</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='open_udp_socket identifier id'>open_udp_socket</span> <span class='address identifier id'>address</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
  <span class='block_given? fid id'>block_given?</span> <span class='and and kw'>and</span> <span class='yield yield kw'>yield</span> <span class='c identifier id'>c</span>
  <span class='c identifier id'>c</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>open_keyboard</h3>
</div><div id="open_keyboard-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>open_keyboard</span><span class='args'>(handler = nil, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
(Experimental)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1220</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1220">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='open_keyboard identifier id'>open_keyboard</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::Connection'</span> <span class='unless unless_mod kw'>unless</span> <span class='Connection constant id'>Connection</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='Connection constant id'>Connection</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='arity identifier id'>arity</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_method identifier id'>instance_method</span><span class='lparen token'>(</span><span class='symbol val'>:initialize</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
  <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='arity identifier id'>arity</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span>
  <span class='end end kw'>end</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='read_keyboard identifier id'>read_keyboard</span>
  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
  <span class='block_given? fid id'>block_given?</span> <span class='and and kw'>and</span> <span class='yield yield kw'>yield</span> <span class='c identifier id'>c</span>
  <span class='c identifier id'>c</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>open_udp_socket</h3>
</div><div id="open_udp_socket-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>open_udp_socket</span><span class='args'>(host, port)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#open_udp_socket
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 136</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L136">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">136
137
138</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='open_udp_socket identifier id'>open_udp_socket</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
  <span class='EvmaUDPSocket constant id'>EvmaUDPSocket</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='uuid identifier id'>uuid</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>popen</h3>
</div><div id="popen-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>popen</span><span class='args'>(cmd, handler = nil, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Run an external process. This does not currently work on Windows.
</p>
<pre class="code">
 <span class='module module kw'>module</span> <span class='RubyCounter constant id'>RubyCounter</span>
   <span class='def def kw'>def</span> <span class='post_init identifier id'>post_init</span>
     <span class='comment val'># count up to 5</span>
     <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;5\n&quot;</span>
   <span class='end end kw'>end</span>
   <span class='def def kw'>def</span> <span class='receive_data identifier id'>receive_data</span> <span class='data identifier id'>data</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;ruby sent me: #{data}&quot;</span>
   <span class='end end kw'>end</span>
   <span class='def def kw'>def</span> <span class='unbind identifier id'>unbind</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;ruby died with exit status: #{get_status.exitstatus}&quot;</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lbrace token'>{</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='popen identifier id'>popen</span><span class='lparen token'>(</span><span class='string val'>&quot;ruby -e' $stdout.sync = true; gets.to_i.times{ |i| puts i+1; sleep 1 } '&quot;</span><span class='comma token'>,</span> <span class='RubyCounter constant id'>RubyCounter</span><span class='rparen token'>)</span>
 <span class='rbrace token'>}</span>
</pre>
<p>
Also see EventMachine::DeferrableChildProcess and EventMachine.system
&#8212; At this moment, it&#8217;s only available on Unix. Perhaps misnamed
since the underlying function uses socketpair and is full-duplex.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
  </dl>
</div>
</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1184</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1184">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='popen identifier id'>popen</span> <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::Connection'</span> <span class='unless unless_mod kw'>unless</span> <span class='Connection constant id'>Connection</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='Connection constant id'>Connection</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='Shellwords constant id'>Shellwords</span><span class='colon2 op'>::</span><span class='shellwords identifier id'>shellwords</span><span class='lparen token'>(</span> <span class='cmd identifier id'>cmd</span> <span class='rparen token'>)</span>
  <span class='w identifier id'>w</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span> <span class='w identifier id'>w</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='w identifier id'>w</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='invoke_popen identifier id'>invoke_popen</span><span class='lparen token'>(</span> <span class='w identifier id'>w</span> <span class='rparen token'>)</span>
  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
  <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
  <span class='c identifier id'>c</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reactor_running?</h3>
</div><div id="reactor_running-3F-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reactor_running?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Tells you whether the EventMachine reactor loop is currently running.
Returns true or false. Useful when writing libraries that want to run
event-driven code, but may be running in programs that are already
event-driven. In such cases, if EventMachine#reactor_running? returns
false, your code can invoke EventMachine#run and run your application code
inside the block passed to that method. If EventMachine#reactor_running?
returns true, just execute your event-aware code.
</p>
<p>
This method is necessary because calling EventMachine#run inside of another
call to EventMachine#run generates a fatal error.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1212</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1212">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1212
1213
1214</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reactor_running? fid id'>reactor_running?</span>
  <span class='lparen token'>(</span><span class='@reactor_running ivar id'>@reactor_running</span> <span class='orop op'>||</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reactor_thread?</h3>
</div><div id="reactor_thread-3F-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reactor_thread?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if the calling thread is the same thread as the reactor.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 282</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L282">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">282
283
284</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reactor_thread? fid id'>reactor_thread?</span>
  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span> <span class='eq op'>==</span> <span class='@reactor_thread ivar id'>@reactor_thread</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>read_keyboard</h3>
</div><div id="read_keyboard-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>read_keyboard</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#read_keyboard
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 197</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L197">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">197
198
199</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='read_keyboard identifier id'>read_keyboard</span>
  <span class='EvmaKeyboard constant id'>EvmaKeyboard</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='dot token'>.</span><span class='uuid identifier id'>uuid</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reconnect</h3>
</div><div id="reconnect-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reconnect</span><span class='args'>(server, port, handler)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Connect to a given host/port and re-use the provided
EventMachine::Connection instance &#8212; EXPERIMENTAL. DO NOT RELY ON THIS
METHOD TO BE HERE IN THIS FORM, OR AT ALL. (03Nov06) Observe, the test for
already-connected FAILS if we call a reconnect inside post_init, because we
haven&#8217;t set up the connection in @conns by that point. RESIST THE
TEMPTATION to &quot;fix&quot; this problem by redefining the behavior of
post_init.
</p>
<p>
Changed 22Nov06: if called on an already-connected handler, just return the
handler and do nothing more. Originally this condition raised an exception.
We may want to change it yet again and call the block, if any.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 806</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L806">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">806
807
808
809
810
811
812
813
814
815
816</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reconnect identifier id'>reconnect</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span> 
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;invalid handler&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:connection_completed</span><span class='rparen token'>)</span>
  <span class='comment val'>#raise &quot;still connected&quot; if @conns.has_key?(handler.signature)</span>
  <span class='return return kw'>return</span> <span class='handler identifier id'>handler</span> <span class='if if_mod kw'>if</span> <span class='@conns ivar id'>@conns</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span><span class='rparen token'>)</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='connect_server identifier id'>connect_server</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
  <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span> <span class='assign token'>=</span> <span class='s identifier id'>s</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='handler identifier id'>handler</span>
  <span class='block_given? fid id'>block_given?</span> <span class='and and kw'>and</span> <span class='yield yield kw'>yield</span> <span class='handler identifier id'>handler</span>
  <span class='handler identifier id'>handler</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>release_machine</h3>
</div><div id="release_machine-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>release_machine</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
release_machine. Probably a no-op.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 68</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L68">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">68
69</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='release_machine identifier id'>release_machine</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run</h3>
</div><div id="run-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run</span><span class='args'>(blk = nil, tail = nil, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine::run initializes and runs an event loop. This method only
returns if user-callback code calls stop_event_loop. Use the supplied block
to define your clients and servers. The block is called by
EventMachine::run immediately after initializing its internal event loop
but <em>before</em> running the loop. Therefore this block is the right
place to call start_server if you want to accept connections from remote
clients.
</p>
<p>
For programs that are structured as servers, it&#8217;s usually appropriate
to start an event loop by calling EventMachine::run, and let it run
forever. It&#8217;s also possible to use EventMachine::run to make a single
client-connection to a remote server, process the data flow from that
single connection, and then call stop_event_loop to force EventMachine::run
to return. Your program will then continue from the point immediately
following the call to EventMachine::run.
</p>
<p>
You can of course do both client and servers simultaneously in the same
program. One of the strengths of the event-driven programming model is that
the handling of network events on many different connections will be
interleaved, and scheduled according to the actual events themselves. This
maximizes efficiency.
</p>
<h3>Server usage example</h3>
<p>
See EventMachine.start_server
</p>
<h3>Client usage example</h3>
<p>
See EventMachine.connect
</p>
<p>
&#8212; Obsoleted the use_threads mechanism. 25Nov06: Added the
begin/ensure block. We need to be sure that release_machine gets called
even if an exception gets thrown within any of the user code that the event
loop runs. The best way to see this is to run a unit test with two
functions, each of which calls EventMachine#run and each of which throws
something inside of #run. Without the ensure, the second test will start
without release_machine being called and will immediately throw a C++
runtime error.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 223</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L223">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='blk identifier id'>blk</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='tail identifier id'>tail</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='@tails ivar id'>@tails</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='tail identifier id'>tail</span> <span class='and and kw'>and</span> <span class='@tails ivar id'>@tails</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='tail identifier id'>tail</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='reactor_running? fid id'>reactor_running?</span>
    <span class='lparen token'>(</span><span class='b identifier id'>b</span> <span class='assign token'>=</span> <span class='blk identifier id'>blk</span> <span class='orop op'>||</span> <span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='comment val'># next_tick(b)</span>
  <span class='else else kw'>else</span>
    <span class='@conns ivar id'>@conns</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@acceptors ivar id'>@acceptors</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@timers ivar id'>@timers</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@wrapped_exception ivar id'>@wrapped_exception</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='begin begin kw'>begin</span>
      <span class='@reactor_running ivar id'>@reactor_running</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
      <span class='initialize_event_machine identifier id'>initialize_event_machine</span>
      <span class='lparen token'>(</span><span class='b identifier id'>b</span> <span class='assign token'>=</span> <span class='blk identifier id'>blk</span> <span class='orop op'>||</span> <span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='add_timer identifier id'>add_timer</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='@next_tick_queue ivar id'>@next_tick_queue</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@next_tick_queue ivar id'>@next_tick_queue</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
        <span class='add_timer identifier id'>add_timer</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='signal_loopbreak identifier id'>signal_loopbreak</span> <span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>
      <span class='@reactor_thread ivar id'>@reactor_thread</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span>
      <span class='run_machine identifier id'>run_machine</span>
    <span class='ensure ensure kw'>ensure</span>
      <span class='begin begin kw'>begin</span>
        <span class='release_machine identifier id'>release_machine</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='if if kw'>if</span> <span class='@threadpool ivar id'>@threadpool</span>
          <span class='@threadpool ivar id'>@threadpool</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='exit identifier id'>exit</span> <span class='rbrace token'>}</span>
          <span class='@threadpool ivar id'>@threadpool</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='kill! fid id'>kill!</span> <span class='if if_mod kw'>if</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='alive? fid id'>alive?</span> <span class='rbrace token'>}</span>
          <span class='@threadqueue ivar id'>@threadqueue</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
          <span class='@resultqueue ivar id'>@resultqueue</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='end end kw'>end</span>
        <span class='@threadpool ivar id'>@threadpool</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='@next_tick_queue ivar id'>@next_tick_queue</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='end end kw'>end</span>
      <span class='@reactor_running ivar id'>@reactor_running</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
      <span class='@reactor_thread ivar id'>@reactor_thread</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>

    <span class='until until kw'>until</span> <span class='@tails ivar id'>@tails</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='@tails ivar id'>@tails</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
    <span class='end end kw'>end</span>

    <span class='raise identifier id'>raise</span> <span class='@wrapped_exception ivar id'>@wrapped_exception</span> <span class='if if_mod kw'>if</span> <span class='@wrapped_exception ivar id'>@wrapped_exception</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run_block</h3>
</div><div id="run_block-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run_block</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sugars a common use case. Will pass the given block to #run, but will
terminate the reactor loop and exit the function as soon as the code in the
block completes. (Normally, #run keeps running indefinitely, even after the
block supplied to it finishes running, until user code calls #stop.)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 273</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L273">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">273
274
275
276
277
278
279</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='run_block identifier id'>run_block</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='pr identifier id'>pr</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
    <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='stop identifier id'>stop</span>
  <span class='rbrace token'>}</span>
  <span class='run identifier id'>run</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='pr identifier id'>pr</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run_deferred_callbacks</h3>
</div><div id="run_deferred_callbacks-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run_deferred_callbacks</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; The is the responder for the loopback-signalled event. It can be
fired either by code running on a separate thread (EM#defer) or on the main
thread (EM#next_tick). It will often happen that a next_tick handler will
reschedule itself. We consume a copy of the tick queue so that tick events
scheduled by tick events have to wait for the next pass through the reactor
core.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 987</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L987">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='run_deferred_callbacks identifier id'>run_deferred_callbacks</span> 
  <span class='until until kw'>until</span> <span class='lparen token'>(</span><span class='@resultqueue ivar id'>@resultqueue</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='result identifier id'>result</span><span class='comma token'>,</span><span class='cback identifier id'>cback</span> <span class='assign token'>=</span> <span class='@resultqueue ivar id'>@resultqueue</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>
    <span class='cback identifier id'>cback</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='result identifier id'>result</span> <span class='if if_mod kw'>if</span> <span class='cback identifier id'>cback</span>
  <span class='end end kw'>end</span>

  <span class='@next_tick_queue ivar id'>@next_tick_queue</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='l identifier id'>l</span> <span class='assign token'>=</span> <span class='@next_tick_queue ivar id'>@next_tick_queue</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='rparen token'>)</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='l identifier id'>l</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='@next_tick_queue ivar id'>@next_tick_queue</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='rbrace token'>}</span>
    <span class='@next_tick_queue ivar id'>@next_tick_queue</span><span class='dot token'>.</span><span class='slice! fid id'>slice!</span><span class='lparen token'>(</span> <span class='integer val'>0</span><span class='dot3 op'>...</span><span class='l identifier id'>l</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

<span class='comment val'>=begin
  (@next_tick_queue ||= []).length.times {
    cback=@next_tick_queue.pop and cback.call
  }
=end
</span>

<span class='comment val'>=begin
  if (@next_tick_queue ||= []) and @next_tick_queue.length &gt; 0
    ary = @next_tick_queue.dup
    @next_tick_queue.clear
    until ary.empty?
      cback=ary.pop and cback.call
    end
  end
=end
</span>

<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run_machine</h3>
</div><div id="run_machine-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run_machine</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
run_machine
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 63</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L63">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">63
64
65</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='run_machine identifier id'>run_machine</span>
  <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='run identifier id'>run</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>schedule</h3>
</div><div id="schedule-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>schedule</span><span class='args'>(*a, &amp;b)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Runs the given callback on the reactor thread, or immediately if called
from the reactor thread. Accepts the same arguments as EM::Callback
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 288</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L288">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">288
289
290
291
292
293
294
295</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='schedule identifier id'>schedule</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='b identifier id'>b</span><span class='rparen token'>)</span>
  <span class='cb identifier id'>cb</span> <span class='assign token'>=</span> <span class='Callback constant id'>Callback</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='b identifier id'>b</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='reactor_running? fid id'>reactor_running?</span> <span class='andop op'>&amp;&amp;</span> <span class='reactor_thread? fid id'>reactor_thread?</span>
    <span class='cb identifier id'>cb</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
  <span class='else else kw'>else</span>
    <span class='next_tick identifier id'>next_tick</span> <span class='lbrace token'>{</span> <span class='cb identifier id'>cb</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_data</h3>
</div><div id="send_data-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_data</span><span class='args'>(target, data, datalength)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#send_data
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 87</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L87">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">87
88
89
90</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_data identifier id'>send_data</span> <span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='datalength identifier id'>datalength</span>
  <span class='selectable identifier id'>selectable</span> <span class='assign token'>=</span> <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='get_selectable identifier id'>get_selectable</span><span class='lparen token'>(</span> <span class='target identifier id'>target</span> <span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unknown send_data target&quot;</span>
  <span class='selectable identifier id'>selectable</span><span class='dot token'>.</span><span class='send_data identifier id'>send_data</span> <span class='data identifier id'>data</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_datagram</h3>
</div><div id="send_datagram-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_datagram</span><span class='args'>(target, data, datalength, host, port)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#send_datagram. This is currently only for UDP! We need to make it work
with unix-domain sockets as well.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 142</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L142">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">142
143
144
145</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_datagram identifier id'>send_datagram</span> <span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='datalength identifier id'>datalength</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
  <span class='selectable identifier id'>selectable</span> <span class='assign token'>=</span> <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='get_selectable identifier id'>get_selectable</span><span class='lparen token'>(</span> <span class='target identifier id'>target</span> <span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unknown send_data target&quot;</span>
  <span class='selectable identifier id'>selectable</span><span class='dot token'>.</span><span class='send_datagram identifier id'>send_datagram</span> <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='pack_sockaddr_in identifier id'>pack_sockaddr_in</span><span class='lparen token'>(</span><span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_file_data</h3>
</div><div id="send_file_data-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_file_data</span><span class='args'>(sig, filename)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#send_file_data
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 176</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L176">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">176
177
178
179
180
181
182
183
184
185
186</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_file_data identifier id'>send_file_data</span> <span class='sig identifier id'>sig</span><span class='comma token'>,</span> <span class='filename identifier id'>filename</span>
  <span class='sz identifier id'>sz</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;file too large&quot;</span> <span class='if if_mod kw'>if</span> <span class='sz identifier id'>sz</span> <span class='gt op'>&gt;</span> <span class='integer val'>32</span><span class='mult op'>*</span><span class='integer val'>1024</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span>
  <span class='begin begin kw'>begin</span>
    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='filename identifier id'>filename</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='string val'>&quot;&quot;</span>
  <span class='end end kw'>end</span>
  <span class='send_data identifier id'>send_data</span> <span class='sig identifier id'>sig</span><span class='comma token'>,</span> <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_comm_inactivity_timeout</h3>
</div><div id="set_comm_inactivity_timeout-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_comm_inactivity_timeout</span><span class='args'>(sig, tm)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#set_comm_inactivity_timeout
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 203</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L203">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">203
204
205
206</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set_comm_inactivity_timeout identifier id'>set_comm_inactivity_timeout</span> <span class='sig identifier id'>sig</span><span class='comma token'>,</span> <span class='tm identifier id'>tm</span>
  <span class='r identifier id'>r</span> <span class='assign token'>=</span> <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='get_selectable identifier id'>get_selectable</span><span class='lparen token'>(</span> <span class='sig identifier id'>sig</span> <span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;unknown set_comm_inactivity_timeout target&quot;</span>
  <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='set_inactivity_timeout identifier id'>set_inactivity_timeout</span> <span class='tm identifier id'>tm</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_descriptor_table_size</h3>
</div><div id="set_descriptor_table_size-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_descriptor_table_size</span><span class='args'>(n_descriptors = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets the maximum number of file or socket descriptors that your process may
open. You can pass this method an integer specifying the new size of the
descriptor table. Returns the new descriptor-table size, which may be less
than the number you requested. If you call this method with no arguments,
it will simply return the current size of the descriptor table without
attempting to change it.
</p>
<p>
The new limit on open descriptors ONLY applies to sockets and other
descriptors that belong to EventMachine. It has NO EFFECT on the number of
descriptors you can create in ordinary Ruby code.
</p>
<p>
Not available on all platforms. Increasing the number of descriptors beyond
its default limit usually requires superuser privileges. (See
#set_effective_user for a way to drop superuser privileges while your
program is running.)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1154</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1154">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1154
1155
1156</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_descriptor_table_size identifier id'>set_descriptor_table_size</span> <span class='n_descriptors identifier id'>n_descriptors</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span>
  <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='set_rlimit_nofile identifier id'>set_rlimit_nofile</span> <span class='n_descriptors identifier id'>n_descriptors</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_effective_user</h3>
</div><div id="set_effective_user-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_effective_user</span><span class='args'>(username)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
A wrapper over the setuid system call. Particularly useful when opening a
network server on a privileged port because you can use this call to drop
privileges after opening the port. Also very useful after a call to
#set_descriptor_table_size, which generally requires that you start your
process with root privileges.
</p>
<p>
This method has no effective implementation on Windows or in the pure-Ruby
implementation of EventMachine. Call #set_effective_user by passing it a
string containing the effective name of the user whose privilege-level your
process should attain. This method is intended for use in enforcing
security requirements, consequently it will throw a fatal error and end
your program if it fails.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1135</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1135">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1135
1136
1137</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_effective_user identifier id'>set_effective_user</span> <span class='username identifier id'>username</span>
  <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='setuid_string identifier id'>setuid_string</span> <span class='username identifier id'>username</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_max_timer_count</h3>
</div><div id="set_max_timer_count-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_max_timer_count</span><span class='args'>(n)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#set_max_timer_count is a harmless no-op in pure Ruby, which doesn&#8217;t
have a built-in limit on the number of available timers.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 172</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L172">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">172
173</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set_max_timer_count identifier id'>set_max_timer_count</span> <span class='n identifier id'>n</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_max_timers</h3>
</div><div id="set_max_timers-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_max_timers</span><span class='args'>(ct)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets the maximum number of timers and periodic timers that may be
outstanding at any given time. You only need to call #set_max_timers if you
need more than the default number of timers, which on most platforms is
1000. Call this method before calling EventMachine#run.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 945</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L945">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">945
946
947</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_max_timers identifier id'>set_max_timers</span> <span class='ct identifier id'>ct</span>
  <span class='set_max_timer_count identifier id'>set_max_timer_count</span> <span class='ct identifier id'>ct</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_quantum</h3>
</div><div id="set_quantum-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_quantum</span><span class='args'>(mills)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
For advanced users. This function sets the default timer granularity, which
by default is slightly smaller than 100 milliseconds. Call this function to
set a higher or lower granularity. The function affects the behavior of
#add_timer and #add_periodic_timer. Most applications will not need to call
this function.
</p>
<p>
The argument is a number of milliseconds. Avoid setting the quantum to very
low values because that may reduce performance under some extreme
conditions. We recommend that you not set a quantum lower than 10.
</p>
<p>
You may only call this function while an EventMachine loop is running (that
is, after a call to EventMachine#run and before a subsequent call to
EventMachine#stop).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 936</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L936">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">936
937
938</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_quantum identifier id'>set_quantum</span> <span class='mills identifier id'>mills</span>
  <span class='set_timer_quantum identifier id'>set_timer_quantum</span> <span class='mills identifier id'>mills</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_rlimit_nofile</h3>
</div><div id="set_rlimit_nofile-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_rlimit_nofile</span><span class='args'>(n)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#set_rlimit_nofile is a no-op in the pure-Ruby implementation. We simply
return Ruby&#8217;s built-in per-process file-descriptor limit.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 166</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L166">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">166
167
168</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set_rlimit_nofile identifier id'>set_rlimit_nofile</span> <span class='n identifier id'>n</span>
  <span class='integer val'>1024</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_timer_quantum</h3>
</div><div id="set_timer_quantum-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_timer_quantum</span><span class='args'>(interval)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#set_timer_quantum in milliseconds. The underlying Reactor function wants a
(possibly fractional) number of seconds.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 150</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L150">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">150
151
152</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set_timer_quantum identifier id'>set_timer_quantum</span> <span class='interval identifier id'>interval</span>
  <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='set_timer_quantum identifier id'>set_timer_quantum</span><span class='lparen token'>(</span><span class='lparen token'>(</span> <span class='float val'>1.0</span> <span class='mult op'>*</span> <span class='interval identifier id'>interval</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='float val'>1000.0</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>signal_loopbreak</h3>
</div><div id="signal_loopbreak-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>signal_loopbreak</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#signal_loopbreak
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 125</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L125">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">125
126
127</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='signal_loopbreak identifier id'>signal_loopbreak</span>
  <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='signal_loopbreak identifier id'>signal_loopbreak</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>spawn</h3>
</div><div id="spawn-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>spawn</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Spawn an erlang-style process
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/spawnable.rb', line 72</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/spawnable.rb#L72">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">72
73
74
75
76</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='spawn identifier id'>spawn</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='SpawnedProcess constant id'>SpawnedProcess</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='set_receiver identifier id'>set_receiver</span> <span class='block identifier id'>block</span>
  <span class='s identifier id'>s</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>spawn_threadpool</h3>
</div><div id="spawn_threadpool-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>spawn_threadpool</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1071</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1071">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='spawn_threadpool identifier id'>spawn_threadpool</span> 
  <span class='until until kw'>until</span> <span class='@threadpool ivar id'>@threadpool</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='@threadpool_size ivar id'>@threadpool_size</span>
    <span class='thread identifier id'>thread</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span>
      <span class='while while kw'>while</span> <span class='true true kw'>true</span>
        <span class='op identifier id'>op</span><span class='comma token'>,</span> <span class='cback identifier id'>cback</span> <span class='assign token'>=</span> <span class='mult op'>*</span><span class='@threadqueue ivar id'>@threadqueue</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>
        <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='op identifier id'>op</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
        <span class='@resultqueue ivar id'>@resultqueue</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='cback identifier id'>cback</span><span class='rbrack token'>]</span>
        <span class='EventMachine constant id'>EventMachine</span><span class='dot token'>.</span><span class='signal_loopbreak identifier id'>signal_loopbreak</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='@threadpool ivar id'>@threadpool</span> <span class='lshft op'>&lt;&lt;</span> <span class='thread identifier id'>thread</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ssl?</h3>
</div><div id="ssl-3F-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ssl?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#ssl? is not implemented for pure-Ruby implementation
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 160</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L160">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">160
161
162</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ssl? fid id'>ssl?</span>
  <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start_server</h3>
</div><div id="start_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start_server</span><span class='args'>(server, port = nil, handler = nil, *args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine::start_server initiates a TCP server (socket acceptor) on the
specified IP address and port. The IP address must be valid on the machine
where the program runs, and the process must be privileged enough to listen
on the specified port (on Unix-like systems, superuser privileges are
usually required to listen on any port lower than 1024). Only one listener
may be running on any given address/port combination. start_server will
fail if the given address and port are already listening on the machine,
either because of a prior call to start_server or some unrelated process
running on the machine. If start_server succeeds, the new network listener
becomes active immediately and starts accepting connections from remote
peers, and these connections generate callback events that are processed by
the code specified in the handler parameter to start_server.
</p>
<p>
The optional handler which is passed to start_server is the key to
EventMachine&#8217;s ability to handle particular network protocols. The
handler parameter passed to start_server must be a Ruby Module that you
must define. When the network server that is started by start_server
accepts a new connection, it instantiates a new object of an anonymous
class that is inherited from EventMachine::Connection, <em>into which the
methods from your handler have been mixed.</em> Your handler module may
redefine any of the methods in EventMachine::Connection in order to
implement the specific behavior of the network protocol.
</p>
<p>
Callbacks invoked in response to network events <em>always</em> take place
within the execution context of the object derived from
EventMachine::Connection extended by your handler module. There is one
object per connection, and all of the callbacks invoked for a particular
connection take the form of instance methods called against the
corresponding EventMachine::Connection object. Therefore, you are free to
define whatever instance variables you wish, in order to contain the
per-connection state required by the network protocol you are implementing.
</p>
<p>
start_server is often called inside the block passed to EventMachine::run,
but it can be called from any EventMachine callback. start_server will fail
unless the EventMachine event loop is currently running (which is why
it&#8217;s often called in the block suppled to EventMachine::run).
</p>
<p>
You may call start_server any number of times to start up network listeners
on different address/port combinations. The servers will all run
simultaneously. More interestingly, each individual call to start_server
can specify a different handler module and thus implement a different
network protocol from all the others.
</p>
<h3>Usage example</h3>
<p>
Here is an example of a server that counts lines of input from the remote
peer and sends back the total number of lines received, after each line.
Try the example with more than one client connection opened via telnet, and
you will see that the line count increments independently on each of the
client connections. Also very important to note, is that the handler for
the receive_data function, which our handler redefines, may not assume that
the data it receives observes any kind of message boundaries. Also, to use
this example, be sure to change the server and port parameters to the
start_server call to values appropriate for your environment.
</p>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
 <span class='require identifier id'>require</span> <span class='string val'>'eventmachine'</span>

 <span class='module module kw'>module</span> <span class='LineCounter constant id'>LineCounter</span>
   <span class='MaxLinesPerConnection constant id'>MaxLinesPerConnection</span> <span class='assign token'>=</span> <span class='integer val'>10</span>

   <span class='def def kw'>def</span> <span class='post_init identifier id'>post_init</span>
     <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Received a new connection&quot;</span>
     <span class='@data_received ivar id'>@data_received</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
     <span class='@line_count ivar id'>@line_count</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='receive_data identifier id'>receive_data</span> <span class='data identifier id'>data</span>
     <span class='@data_received ivar id'>@data_received</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span>
     <span class='while while kw'>while</span> <span class='@data_received ivar id'>@data_received</span><span class='dot token'>.</span><span class='slice! fid id'>slice!</span><span class='lparen token'>(</span> <span class='regexp val'>/^[^\n]*[\n]/</span><span class='m identifier id'>m</span> <span class='rparen token'>)</span>
       <span class='@line_count ivar id'>@line_count</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
       <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;received #{@line_count} lines so far\r\n&quot;</span>
       <span class='@line_count ivar id'>@line_count</span> <span class='eq op'>==</span> <span class='MaxLinesPerConnection constant id'>MaxLinesPerConnection</span> <span class='and and kw'>and</span> <span class='close_connection_after_writing identifier id'>close_connection_after_writing</span>
     <span class='end end kw'>end</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='host identifier id'>host</span><span class='comma token'>,</span><span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='string val'>&quot;192.168.0.100&quot;</span><span class='comma token'>,</span> <span class='integer val'>8090</span>
   <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='start_server identifier id'>start_server</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='LineCounter constant id'>LineCounter</span>
   <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Now accepting connections on address #{host}, port #{port}...&quot;</span>
   <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='add_periodic_timer identifier id'>add_periodic_timer</span><span class='lparen token'>(</span> <span class='integer val'>10</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='$stderr gvar id'>$stderr</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='string val'>&quot;*&quot;</span> <span class='rbrace token'>}</span>
 <span class='rbrace token'>}</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 540</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L540">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='start_server identifier id'>start_server</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='begin begin kw'>begin</span>
    <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='port identifier id'>port</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='TypeError constant id'>TypeError</span>
    <span class='comment val'># there was no port, so server must be a unix domain socket</span>
    <span class='comment val'># the port argument is actually the handler, and the handler is one of the args</span>
    <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='handler identifier id'>handler</span> <span class='if if_mod kw'>if</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span> <span class='assign token'>=</span> <span class='port identifier id'>port</span>
    <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span> <span class='if if_mod kw'>if</span> <span class='port identifier id'>port</span>

  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::Connection'</span> <span class='unless unless_mod kw'>unless</span> <span class='Connection constant id'>Connection</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='Connection constant id'>Connection</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='arity identifier id'>arity</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_method identifier id'>instance_method</span><span class='lparen token'>(</span><span class='symbol val'>:initialize</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
  <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='arity identifier id'>arity</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span> 
  <span class='end end kw'>end</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='port identifier id'>port</span>
        <span class='start_tcp_server identifier id'>start_tcp_server</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
      <span class='else else kw'>else</span>
        <span class='start_unix_server identifier id'>start_unix_server</span> <span class='server identifier id'>server</span>
      <span class='end end kw'>end</span>
  <span class='@acceptors ivar id'>@acceptors</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='klass identifier id'>klass</span><span class='comma token'>,</span><span class='args identifier id'>args</span><span class='comma token'>,</span><span class='block identifier id'>block</span><span class='rbrack token'>]</span>
  <span class='s identifier id'>s</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start_tcp_server</h3>
</div><div id="start_tcp_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start_tcp_server</span><span class='args'>(host, port)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#start_tcp_server
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 102</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L102">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">102
103
104
105</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='start_tcp_server identifier id'>start_tcp_server</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span>
  <span class='lparen token'>(</span><span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='EvmaTCPServer constant id'>EvmaTCPServer</span><span class='dot token'>.</span><span class='start_server identifier id'>start_server</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;no acceptor&quot;</span>
  <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='uuid identifier id'>uuid</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start_tls</h3>
</div><div id="start_tls-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start_tls</span><span class='args'>(sig)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/jeventmachine.rb', line 99</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/jeventmachine.rb#L99">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">99
100
101</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='start_tls identifier id'>start_tls</span> <span class='sig identifier id'>sig</span>
  <span class='@em ivar id'>@em</span><span class='dot token'>.</span><span class='startTls identifier id'>startTls</span> <span class='sig identifier id'>sig</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start_unix_domain_server</h3>
</div><div id="start_unix_domain_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start_unix_domain_server</span><span class='args'>(filename, *args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Start a Unix-domain server
</p>
<p>
Note that this is an alias for EventMachine::start_server, which can be
used to start both TCP and Unix-domain servers
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 587</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L587">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">587
588
589</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='start_unix_domain_server identifier id'>start_unix_domain_server</span> <span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='start_server identifier id'>start_server</span> <span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start_unix_server</h3>
</div><div id="start_unix_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start_unix_server</span><span class='args'>(chain)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#start_unix_server
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 114</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L114">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">114
115
116
117</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='start_unix_server identifier id'>start_unix_server</span> <span class='chain identifier id'>chain</span>
  <span class='lparen token'>(</span><span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='EvmaUNIXServer constant id'>EvmaUNIXServer</span><span class='dot token'>.</span><span class='start_server identifier id'>start_server</span> <span class='chain identifier id'>chain</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;no acceptor&quot;</span>
  <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='uuid identifier id'>uuid</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stop</h3>
</div><div id="stop-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stop</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#stop
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 72</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L72">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">72
73
74</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='stop identifier id'>stop</span>
  <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='stop identifier id'>stop</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stop_event_loop</h3>
</div><div id="stop_event_loop-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stop_event_loop</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
stop_event_loop may called from within a callback method while
EventMachine&#8217;s processing loop is running. It causes the processing
loop to stop executing, which will cause all open connections and accepting
servers to be run down and closed. <em>Callbacks for connection-termination
will be called</em> as part of the processing of stop_event_loop. (There
currently is no option to panic-stop the loop without closing connections.)
When all of this processing is complete, the call to EventMachine::run
which started the processing loop will return and program flow will resume
from the statement following EventMachine::run call.
</p>
<h3>Usage example</h3>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
 <span class='require identifier id'>require</span> <span class='string val'>'eventmachine'</span>

 <span class='module module kw'>module</span> <span class='Redmond constant id'>Redmond</span>
   <span class='def def kw'>def</span> <span class='post_init identifier id'>post_init</span>
     <span class='puts identifier id'>puts</span> <span class='string val'>&quot;We're sending a dumb HTTP request to the remote peer.&quot;</span>
     <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;GET / HTTP/1.1\r\nHost: www.microsoft.com\r\n\r\n&quot;</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='receive_data identifier id'>receive_data</span> <span class='data identifier id'>data</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;We received #{data.length} bytes from the remote peer.&quot;</span>
     <span class='puts identifier id'>puts</span> <span class='string val'>&quot;We're going to stop the event loop now.&quot;</span>
     <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='stop_event_loop identifier id'>stop_event_loop</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='unbind identifier id'>unbind</span>
     <span class='puts identifier id'>puts</span> <span class='string val'>&quot;A connection has terminated.&quot;</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='puts identifier id'>puts</span> <span class='string val'>&quot;We're starting the event loop now.&quot;</span>
 <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='connect identifier id'>connect</span> <span class='string val'>&quot;www.microsoft.com&quot;</span><span class='comma token'>,</span> <span class='integer val'>80</span><span class='comma token'>,</span> <span class='Redmond constant id'>Redmond</span>
 <span class='rbrace token'>}</span>
 <span class='puts identifier id'>puts</span> <span class='string val'>&quot;The event loop has stopped.&quot;</span>
</pre>
<p>
This program will produce approximately the following output:
</p>
<pre class="code">
 <span class='We constant id'>We</span><span class='string val'>'re starting the event loop now.
 We'</span><span class='re identifier id'>re</span> <span class='sending identifier id'>sending</span> <span class='a identifier id'>a</span> <span class='dumb identifier id'>dumb</span> <span class='HTTP constant id'>HTTP</span> <span class='request identifier id'>request</span> <span class='to identifier id'>to</span> <span class='the identifier id'>the</span> <span class='remote identifier id'>remote</span> <span class='peer identifier id'>peer</span><span class='dot token'>.</span>
 <span class='We constant id'>We</span> <span class='received identifier id'>received</span> <span class='integer val'>1440</span> <span class='bytes identifier id'>bytes</span> <span class='from identifier id'>from</span> <span class='the identifier id'>the</span> <span class='remote identifier id'>remote</span> <span class='peer identifier id'>peer</span><span class='dot token'>.</span>
 <span class='We constant id'>We</span><span class='string val'>'re going to stop the event loop now.
 A connection has terminated.
 The event loop has stopped.
</span></pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 450</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L450">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">450
451
452</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='stop_event_loop identifier id'>stop_event_loop</span>
  <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='stop identifier id'>stop</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stop_server</h3>
</div><div id="stop_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stop_server</span><span class='args'>(signature)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Stop a TCP server socket that was started with EventMachine#start_server.
&#8212; Requested by Kirk Haines. TODO, this isn&#8217;t OOP enough. We
ought somehow to have #start_server return an object that has a close or a
stop method on it.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 579</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L579">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">579
580
581</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='stop_server identifier id'>stop_server</span> <span class='signature identifier id'>signature</span>
  <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='stop_tcp_server identifier id'>stop_tcp_server</span> <span class='signature identifier id'>signature</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stop_tcp_server</h3>
</div><div id="stop_tcp_server-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stop_tcp_server</span><span class='args'>(sig)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
#stop_tcp_server
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pr_eventmachine.rb', line 108</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/pr_eventmachine.rb#L108">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">108
109
110
111</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='stop_tcp_server identifier id'>stop_tcp_server</span> <span class='sig identifier id'>sig</span>
  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='Reactor constant id'>Reactor</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span><span class='dot token'>.</span><span class='get_selectable identifier id'>get_selectable</span><span class='lparen token'>(</span><span class='sig identifier id'>sig</span><span class='rparen token'>)</span>
  <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='schedule_close identifier id'>schedule_close</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>system</h3>
</div><div id="system-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>system</span><span class='args'>(cmd, *args, &amp;cb)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EM::system is a simple wrapper for EM::popen. It is similar to
Kernel::system, but requires a single string argument for the command and
performs no shell expansion.
</p>
<p>
The block or proc passed to EM::system is called with two arguments: the
output generated by the command, and a Process::Status that contains
information about the command&#8217;s execution.
</p>
<pre class="code">
 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lbrace token'>{</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='string val'>'ls'</span><span class='rparen token'>)</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='output identifier id'>output</span><span class='comma token'>,</span><span class='status identifier id'>status</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='output identifier id'>output</span> <span class='if if_mod kw'>if</span> <span class='status identifier id'>status</span><span class='dot token'>.</span><span class='exitstatus identifier id'>exitstatus</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='rbrace token'>}</span>
 <span class='rbrace token'>}</span>
</pre>
<p>
You can also supply an additional proc to send some data to the process:
</p>
<pre class="code">
 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lbrace token'>{</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='string val'>'sh'</span><span class='comma token'>,</span> <span class='proc identifier id'>proc</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='process identifier id'>process</span><span class='bitor op'>|</span>
     <span class='process identifier id'>process</span><span class='dot token'>.</span><span class='send_data identifier id'>send_data</span><span class='lparen token'>(</span><span class='string val'>&quot;echo hello\n&quot;</span><span class='rparen token'>)</span>
     <span class='process identifier id'>process</span><span class='dot token'>.</span><span class='send_data identifier id'>send_data</span><span class='lparen token'>(</span><span class='string val'>&quot;exit\n&quot;</span><span class='rparen token'>)</span>
   <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='proc identifier id'>proc</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='out identifier id'>out</span><span class='comma token'>,</span><span class='status identifier id'>status</span><span class='bitor op'>|</span>
     <span class='puts identifier id'>puts</span><span class='lparen token'>(</span><span class='out identifier id'>out</span><span class='rparen token'>)</span>
   <span class='rbrace token'>}</span><span class='rparen token'>)</span>
 <span class='rbrace token'>}</span>
</pre>
<p>
Like EventMachine.popen, EventMachine.system currently does not work on
windows. It returns the pid of the spawned process.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/processes.rb', line 108</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/processes.rb#L108">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">108
109
110
111
112
113
114
115
116
117
118</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='EventMachine constant id'>EventMachine</span><span class='colon2 op'>::</span><span class='system identifier id'>system</span> <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='cb identifier id'>cb</span>
  <span class='cb identifier id'>cb</span> <span class='opasgn op'>||=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='if if_mod kw'>if</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span> <span class='Proc constant id'>Proc</span>
  <span class='init identifier id'>init</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='if if_mod kw'>if</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span> <span class='Proc constant id'>Proc</span>

  <span class='comment val'># merge remaining arguments into the command</span>
  <span class='cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='cmd identifier id'>cmd</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span>

  <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='get_subprocess_pid identifier id'>get_subprocess_pid</span><span class='lparen token'>(</span><span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='popen identifier id'>popen</span><span class='lparen token'>(</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='SystemCmd constant id'>SystemCmd</span><span class='comma token'>,</span> <span class='cb identifier id'>cb</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span>
    <span class='init identifier id'>init</span><span class='lbrack token'>[</span><span class='c identifier id'>c</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='init identifier id'>init</span>
  <span class='end end kw'>end</span><span class='dot token'>.</span><span class='signature identifier id'>signature</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>watch_file</h3>
</div><div id="watch_file-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>watch_file</span><span class='args'>(filename, handler = nil, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine&#8217;s file monitoring API. Currently supported are the
following events on individual files, using inotify on Linux systems, and
kqueue for OSX/BSD:
</p>
<ul>
<li>File modified (written to)

</li>
<li>File moved/renamed

</li>
<li>File deleted

</li>
</ul>
<p>
EventMachine::watch_file takes a filename and a handler Module containing
your custom callback methods. This will setup the low level monitoring on
the specified file, and create a new EventMachine::FileWatch object with
your Module mixed in. FileWatch is a subclass of EM::Connection, so
callbacks on this object work in the familiar way. The callbacks that will
be fired by EventMachine are:
</p>
<ul>
<li>file_modified

</li>
<li>file_moved

</li>
<li>file_deleted

</li>
</ul>
<p>
You can access the filename being monitored from within this object using
FileWatch#path.
</p>
<p>
When a file is deleted, FileWatch#stop_watching will be called after your
file_deleted callback, to clean up the underlying monitoring and remove
EventMachine&#8217;s reference to the now-useless FileWatch. This will in
turn call unbind, if you wish to use it.
</p>
<p>
The corresponding system-level Errno will be raised when attempting to
monitor non-existent files, files with wrong permissions, or if an error
occurs dealing with inotify/kqueue.
</p>
<h3>Usage example:</h3>
<pre class="code">
 <span class='Make constant id'>Make</span> <span class='sure identifier id'>sure</span> <span class='we identifier id'>we</span> <span class='have identifier id'>have</span> <span class='a identifier id'>a</span> <span class='file identifier id'>file</span> <span class='to identifier id'>to</span> <span class='monitor identifier id'>monitor</span><span class='colon op'>:</span>
 $ <span class='echo identifier id'>echo</span> <span class='string val'>&quot;bar&quot;</span> <span class='gt op'>&gt;</span> <span class='regexp val'>/tmp/</span><span class='foo identifier id'>foo</span>

 <span class='module module kw'>module</span> <span class='Handler constant id'>Handler</span>
   <span class='def def kw'>def</span> <span class='file_modified identifier id'>file_modified</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;#{path} modified&quot;</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='file_moved identifier id'>file_moved</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;#{path} moved&quot;</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='file_deleted identifier id'>file_deleted</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;#{path} deleted&quot;</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='unbind identifier id'>unbind</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;#{path} monitoring ceased&quot;</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='lbrace token'>{</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='watch_file identifier id'>watch_file</span><span class='lparen token'>(</span><span class='string val'>&quot;/tmp/foo&quot;</span><span class='comma token'>,</span> <span class='Handler constant id'>Handler</span><span class='rparen token'>)</span>
 <span class='rbrace token'>}</span>

 $ <span class='echo identifier id'>echo</span> <span class='string val'>&quot;baz&quot;</span> <span class='rshft op'>&gt;&gt;</span> <span class='regexp val'>/tmp/</span><span class='foo identifier id'>foo</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='string val'>&quot;/tmp/foo modified&quot;</span>
 $ <span class='mv identifier id'>mv</span> <span class='div op'>/</span><span class='tmp identifier id'>tmp</span><span class='div op'>/</span><span class='foo identifier id'>foo</span> <span class='regexp val'>/tmp/o</span><span class='of identifier id'>of</span>      <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='string val'>&quot;/tmp/foo moved&quot;</span>
 $ <span class='rm identifier id'>rm</span> <span class='div op'>/</span><span class='tmp identifier id'>tmp</span><span class='div op'>/</span><span class='oof identifier id'>oof</span>               <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='string val'>&quot;/tmp/foo deleted&quot;</span>
                             <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='string val'>&quot;/tmp/foo monitoring ceased&quot;</span>
</pre>
<p>
Note that we have not implemented the ability to pick up on the new
filename after a rename. Calling #path will always return the filename you
originally used.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1301</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1301">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='watch_file identifier id'>watch_file</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::FileWatch'</span> <span class='unless unless_mod kw'>unless</span> <span class='FileWatch constant id'>FileWatch</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='FileWatch constant id'>FileWatch</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='arity identifier id'>arity</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_method identifier id'>instance_method</span><span class='lparen token'>(</span><span class='symbol val'>:initialize</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
  <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='arity identifier id'>arity</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span>
  <span class='end end kw'>end</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='colon2 op'>::</span><span class='watch_filename identifier id'>watch_filename</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='comment val'># we have to set the path like this because of how Connection.new works</span>
  <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='string val'>&quot;@path&quot;</span><span class='comma token'>,</span> <span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
  <span class='block_given? fid id'>block_given?</span> <span class='and and kw'>and</span> <span class='yield yield kw'>yield</span> <span class='c identifier id'>c</span>
  <span class='c identifier id'>c</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>watch_process</h3>
</div><div id="watch_process-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>watch_process</span><span class='args'>(pid, handler = nil, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
EventMachine&#8217;s process monitoring API. Currently supported using
kqueue for OSX/BSD.
</p>
<h3>Usage example:</h3>
<pre class="code">
 <span class='module module kw'>module</span> <span class='ProcessWatcher constant id'>ProcessWatcher</span>
   <span class='def def kw'>def</span> <span class='process_exited identifier id'>process_exited</span>
     <span class='put identifier id'>put</span> <span class='string val'>'the forked child died!'</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='pid identifier id'>pid</span> <span class='assign token'>=</span> <span class='fork identifier id'>fork</span><span class='lbrace token'>{</span> <span class='sleep identifier id'>sleep</span> <span class='rbrace token'>}</span>

 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lbrace token'>{</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='watch_process identifier id'>watch_process</span><span class='lparen token'>(</span><span class='pid identifier id'>pid</span><span class='comma token'>,</span> <span class='ProcessWatcher constant id'>ProcessWatcher</span><span class='rparen token'>)</span>
   <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='add_timer identifier id'>add_timer</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span><span class='lbrace token'>{</span> <span class='Process constant id'>Process</span><span class='dot token'>.</span><span class='kill identifier id'>kill</span><span class='lparen token'>(</span><span class='string val'>'TERM'</span><span class='comma token'>,</span> <span class='pid identifier id'>pid</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
 <span class='rbrace token'>}</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/eventmachine.rb', line 1341</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/eventmachine.rb#L1341">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1341
1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='watch_process identifier id'>watch_process</span><span class='lparen token'>(</span><span class='pid identifier id'>pid</span><span class='comma token'>,</span> <span class='handler identifier id'>handler</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='pid identifier id'>pid</span> <span class='assign token'>=</span> <span class='pid identifier id'>pid</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'must provide module or subclass of EventMachine::ProcessWatch'</span> <span class='unless unless_mod kw'>unless</span> <span class='ProcessWatch constant id'>ProcessWatch</span> <span class='gt op'>&gt;</span> <span class='handler identifier id'>handler</span>
    <span class='handler identifier id'>handler</span>
  <span class='else else kw'>else</span>
    <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='ProcessWatch constant id'>ProcessWatch</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='handler identifier id'>handler</span> <span class='and and kw'>and</span> <span class='include identifier id'>include</span> <span class='handler identifier id'>handler</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='arity identifier id'>arity</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_method identifier id'>instance_method</span><span class='lparen token'>(</span><span class='symbol val'>:initialize</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
  <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='question op'>?</span> <span class='arity identifier id'>arity</span> <span class='colon op'>:</span> <span class='minus op'>-</span><span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='arity identifier id'>arity</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='expected identifier id'>expected</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments for #{klass}#initialize (#{args.size} for #{expected})&quot;</span>
  <span class='end end kw'>end</span>

  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='colon2 op'>::</span><span class='watch_pid identifier id'>watch_pid</span><span class='lparen token'>(</span><span class='pid identifier id'>pid</span><span class='rparen token'>)</span>
  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='s identifier id'>s</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='comment val'># we have to set the path like this because of how Connection.new works</span>
  <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='string val'>&quot;@pid&quot;</span><span class='comma token'>,</span> <span class='pid identifier id'>pid</span><span class='rparen token'>)</span>
  <span class='@conns ivar id'>@conns</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span>
  <span class='block_given? fid id'>block_given?</span> <span class='and and kw'>and</span> <span class='yield yield kw'>yield</span> <span class='c identifier id'>c</span>
  <span class='c identifier id'>c</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>yield</h3>
</div><div id="yield-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>yield</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/spawnable.rb', line 78</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/spawnable.rb#L78">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">78
79
80</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='yield identifier id'>yield</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span> 
  <span class='return return kw'>return</span> <span class='YieldBlockFromSpawnedProcess constant id'>YieldBlockFromSpawnedProcess</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='block identifier id'>block</span><span class='comma token'>,</span> <span class='false false kw'>false</span> <span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>yield_and_notify</h3>
</div><div id="yield_and_notify-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>yield_and_notify</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/spawnable.rb', line 82</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/spawnable.rb#L82">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">82
83
84</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='yield_and_notify identifier id'>yield_and_notify</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span> 
  <span class='return return kw'>return</span> <span class='YieldBlockFromSpawnedProcess constant id'>YieldBlockFromSpawnedProcess</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='block identifier id'>block</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>  
                  
      <div id="footer">
        <div class="site">
          <div class="info">
            <div class="links">
              <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
              <a href="http://github.com/blog">Blog</a> |
              <a href="http://support.github.com/">Support</a> |
              <a href="http://github.com/training">Training</a> |
              <a href="http://github.com/contact">Contact</a> |
              <a href="http://groups.google.com/group/github/">Google Group</a> |
              <a href="http://develop.github.com/">API</a> |
              <a href="http://twitter.com/github">Status</a>
            </div>
            <div class="company">
              <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
              is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
            </div>
          </div>
          <div class="sponsor">
            <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
            <div>
              Hosting provided by our<br> partners at Engine Yard
            </div>
          </div>
        </div>
      </div>
      
      <div id="coming_soon" style="display: none;">
        This feature is coming soon.  Sit tight!
      </div>

      <div id="facebox" style="display: none;">       
        <div class="popup">         
          <table>           
            <tbody>             
              <tr>               
                <td class="tl"></td>
                <td class="b"></td>
                <td class="tr"></td>             
              </tr>             
            <tr>               
              <td class="b"></td>               
              <td class="body">                 
                <div class="content"></div>                 
                <div class="footer">                   
                  <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
                </div>               
              </td>               
              <td class="b"></td>             
            </tr>             
            <tr>               
              <td class="bl"></td>
              <td class="b"></td>
              <td class="br"></td>             
            </tr>           
          </tbody>         
        </table>       
      </div>     
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8555229-2");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>