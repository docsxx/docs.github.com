<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>eventmachine's eventmachine - Class: EventMachine::Protocols::SmtpServer - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/eventmachine/commits/eventmachine/master" rel="alternate" title="Recent Commits to eventmachine:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<style type="text/css">
  #repo_menu { border-bottom: 5px solid #ccc; margin-bottom: 1.5em; }
  #repo_sub_menu { display: none; }
</style>
    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main">
      <div id="header" class="">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/eventmachine/eventmachine/tree/">Source</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/network">Network</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/eventmachine/eventmachine">Wiki</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/graphs">Graphs</a></li>                    
            <li class="active"><a href="/eventmachine/eventmachine">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/eventmachine">eventmachine</a> / <b><a href="http://github.com/eventmachine/eventmachine/tree">eventmachine</a></b>        
                <a id="namespaces_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/>
                </a>
                <a id="methods_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/>
                </a>

                <script type="text/javascript">          
                $('#namespaces_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/namespaces/";
                  $.gitbox(url);
                  return false;
                });

                $('#methods_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/methods/";
                  $.gitbox(url);
                  return false;
                });
                </script>
                
              </div>
            </div>

            <div class="meta">
              <table>
                <tbody>
                  <tr>
                    <td class="label">Description:</td>
                    <td><span id="repository_description" rel="http://github.com/eventmachine/eventmachine/edit/update" class="">No description available</span></td>
                  </tr>              
                </tbody>
              </table>
            </div>
          </div>
                                        
          <div id="content">
            <div class="wikistyle">
  <div class="section class EventMachine_Protocols_SmtpServer">
  <h1>Class: EventMachine::Protocols::SmtpServer</h1>
  <div class="section inheritance">
  <ul>
  <li><a href="../Connection.html" title="EventMachine::Connection">EventMachine::Connection</a></li><ul><li>EventMachine::Protocols::SmtpServer</li>
  </ul></ul>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="LineText2.html" title="EventMachine::Protocols::LineText2">EventMachine::Protocols::LineText2</a></p>
</div><div class="section docstring">
  <p>
This is a protocol handler for the server side of SMTP. It&#8217;s NOT a
complete SMTP server obeying all the semantics of servers conforming to
RFC2821. Rather, it uses overridable method stubs to communicate protocol
states and data to user code. User code is responsible for doing the right
things with the data in order to get complete and correct SMTP server
behavior.
</p>
<p>
&#8212; Useful paragraphs in RFC-2821: 4.3.2: Concise list of command-reply
sequences, in essence a text representation of the command state-machine.
</p>
<p>
STARTTLS is defined in RFC2487. Observe that there are important rules
governing whether a publicly-referenced server (meaning one whose Internet
address appears in public MX records) may require the non-optional use of
TLS. Non-optional TLS does not apply to EHLO, NOOP, QUIT or STARTTLS.
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="AuthRegex-constant">AuthRegex</dt>
      <dd>/\AAUTH\s+/i</dd>
    
      <dt id="DataRegex-constant">DataRegex</dt>
      <dd>/\ADATA/i</dd>
    
      <dt id="EhloRegex-constant">EhloRegex</dt>
      <dd>/\AEHLO\s*/i</dd>
    
      <dt id="ExpnRegex-constant">ExpnRegex</dt>
      <dd>/\AEXPN\s+/i</dd>
    
      <dt id="HeloRegex-constant">HeloRegex</dt>
      <dd>/\AHELO\s*/i</dd>
    
      <dt id="HelpRegex-constant">HelpRegex</dt>
      <dd>/\AHELP/i</dd>
    
      <dt id="MailFromRegex-constant">MailFromRegex</dt>
      <dd>/\AMAIL FROM:\s*/i</dd>
    
      <dt id="NoopRegex-constant">NoopRegex</dt>
      <dd>/\ANOOP/i</dd>
    
      <dt id="QuitRegex-constant">QuitRegex</dt>
      <dd>/\AQUIT/i</dd>
    
      <dt id="RcptToRegex-constant">RcptToRegex</dt>
      <dd>/\ARCPT TO:\s*/i</dd>
    
      <dt id="RsetRegex-constant">RsetRegex</dt>
      <dd>/\ARSET/i</dd>
    
      <dt id="StarttlsRegex-constant">StarttlsRegex</dt>
      <dd>/\ASTARTTLS/i</dd>
    
      <dt id="VrfyRegex-constant">VrfyRegex</dt>
      <dd>/\AVRFY\s+/i</dd>
    
  </dl>
</div>
<div class="included">
  
  <div>
    <h2>Constants Included from <a href="LineText2.html" title="EventMachine::Protocols::LineText2">EventMachine::Protocols::LineText2</a></h2>
    <p><span class='name'><a href="LineText2.html#MaxBinaryLength-constant" title="MaxBinaryLength">MaxBinaryLength</a></span>, <span class='name'><a href="LineText2.html#MaxLineLength-constant" title="MaxLineLength">MaxLineLength</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 82</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L82">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">82
83
84
85
86</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='super super kw'>super</span>
  <span class='@parms ivar id'>@parms</span> <span class='assign token'>=</span> <span class='@@parms ivar id'>@@parms</span>
  <span class='init_protocol_state identifier id'>init_protocol_state</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#parms-class_method">parms</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connection_ended-instance_method">#connection_ended</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sent when the remote peer has ended the connection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_server_domain-instance_method">#get_server_domain</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The domain name returned in the first line of the response to a successful
EHLO or HELO command.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_server_greeting-instance_method">#get_server_greeting</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <hr size="10"></hr><p>
Everything from here on can be overridden in user code.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#init_protocol_state-instance_method">#init_protocol_state</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#parms-instance_method">#parms</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#post_init-instance_method">#post_init</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
In SMTP, the server talks first.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_auth-instance_method">#process_auth</span><span class='args'>(str)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; So far, only AUTH PLAIN is supported but we should do at least
LOGIN as well.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_data-instance_method">#process_data</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; Unusually, we can deal with a Deferrable returned from the user
application.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_data_line-instance_method">#process_data_line</span><span class='args'>(ln)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Send the incoming data to the application one chunk at a time, rather than
one line at a time.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_ehlo-instance_method">#process_ehlo</span><span class='args'>(domain)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; EHLO/HELO is always legal, per the standard.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_expn-instance_method">#process_expn</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO - implement this properly, the implementation is a stub!.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_helo-instance_method">#process_helo</span><span class='args'>(domain)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_help-instance_method">#process_help</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO - implement this properly, the implementation is a stub!.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_mail_from-instance_method">#process_mail_from</span><span class='args'>(sender)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; Requiring TLS is touchy, cf RFC2784.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_noop-instance_method">#process_noop</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_quit-instance_method">#process_quit</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_rcpt_to-instance_method">#process_rcpt_to</span><span class='args'>(rcpt)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; Since we require :mail_from to have been seen before we process
RCPT TO, we don&#8217;t need to repeat the tests for TLS and AUTH.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_rset-instance_method">#process_rset</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_starttls-instance_method">#process_starttls</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; STARTTLS may not be issued before EHLO, or unless the user has
chosen to support it.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_unknown-instance_method">#process_unknown</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_vrfy-instance_method">#process_vrfy</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO - implement this properly, the implementation is a stub!.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_data_chunk-instance_method">#receive_data_chunk</span><span class='args'>(data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sent when data from the remote peer is available.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_data_command-instance_method">#receive_data_command</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Called when the remote peer sends the DATA command.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_ehlo_domain-instance_method">#receive_ehlo_domain</span><span class='args'>(domain)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
A false response from this user-overridable method will cause a 550 error
to be returned to the remote client.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_line-instance_method">#receive_line</span><span class='args'>(ln)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_message-instance_method">#receive_message</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sent after a message has been completely received.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_plain_auth-instance_method">#receive_plain_auth</span><span class='args'>(user, password)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return true or false to indicate that the authentication is acceptable.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_recipient-instance_method">#receive_recipient</span><span class='args'>(rcpt)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Receives the argument of a RCPT TO command.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_reset-instance_method">#receive_reset</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sent when the remote peer issues the RSET command.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_sender-instance_method">#receive_sender</span><span class='args'>(sender)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Receives the argument of the MAIL FROM command.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_transaction-instance_method">#receive_transaction</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This is called when the protocol state is reset.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reset_protocol_state-instance_method">#reset_protocol_state</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; This is called at several points to restore the protocol state to a
pre-transaction state.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_server_greeting-instance_method">#send_server_greeting</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#unbind-instance_method">#unbind</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h2>Public Instance Methods Inherited from <a href="../Connection.html" title="EventMachine::Connection">EventMachine::Connection</a></h2>
    <p><span class='name'><a href="../Connection.html#associate_callback_target-instance_method" title="associate_callback_target">associate_callback_target</a></span>, <span class='name'><a href="../Connection.html#close_connection-instance_method" title="close_connection">close_connection</a></span>, <span class='name'><a href="../Connection.html#close_connection_after_writing-instance_method" title="close_connection_after_writing">close_connection_after_writing</a></span>, <span class='name'><a href="../Connection.html#comm_inactivity_timeout-instance_method" title="comm_inactivity_timeout">comm_inactivity_timeout</a></span>, <span class='name'><a href="../Connection.html#connection_completed-instance_method" title="connection_completed">connection_completed</a></span>, <span class='name'><a href="../Connection.html#detach-instance_method" title="detach">detach</a></span>, <span class='name'><a href="../Connection.html#error%3F-instance_method" title="error?">error?</a></span>, <span class='name'><a href="../Connection.html#get_outbound_data_size-instance_method" title="get_outbound_data_size">get_outbound_data_size</a></span>, <span class='name'><a href="../Connection.html#get_peer_cert-instance_method" title="get_peer_cert">get_peer_cert</a></span>, <span class='name'><a href="../Connection.html#get_peername-instance_method" title="get_peername">get_peername</a></span>, <span class='name'><a href="../Connection.html#get_pid-instance_method" title="get_pid">get_pid</a></span>, <span class='name'><a href="../Connection.html#get_sockname-instance_method" title="get_sockname">get_sockname</a></span>, <span class='name'><a href="../Connection.html#get_status-instance_method" title="get_status">get_status</a></span>, <span class='name'><a href="../Connection.html#receive_data-instance_method" title="receive_data">receive_data</a></span>, <span class='name'><a href="../Connection.html#reconnect-instance_method" title="reconnect">reconnect</a></span>, <span class='name'><a href="../Connection.html#send_data-instance_method" title="send_data">send_data</a></span>, <span class='name'><a href="../Connection.html#send_datagram-instance_method" title="send_datagram">send_datagram</a></span>, <span class='name'><a href="../Connection.html#send_file_data-instance_method" title="send_file_data">send_file_data</a></span>, <span class='name'><a href="../Connection.html#set_comm_inactivity_timeout-instance_method" title="set_comm_inactivity_timeout">set_comm_inactivity_timeout</a></span>, <span class='name'><a href="../Connection.html#ssl_handshake_completed-instance_method" title="ssl_handshake_completed">ssl_handshake_completed</a></span>, <span class='name'><a href="../Connection.html#ssl_verify_peer-instance_method" title="ssl_verify_peer">ssl_verify_peer</a></span>, <span class='name'><a href="../Connection.html#start_tls-instance_method" title="start_tls">start_tls</a></span>, <span class='name'><a href="../Connection.html#stream_file_data-instance_method" title="stream_file_data">stream_file_data</a></span></p>
  </div>
  
</div>
<div class="clear"></div><div class="included">
  
  <div>
    <h2>Public Instance Methods Included from <a href="LineText2.html" title="EventMachine::Protocols::LineText2">EventMachine::Protocols::LineText2</a></h2>
    <p><span class='name'><a href="LineText2.html#receive_binary_data-instance_method" title="receive_binary_data">receive_binary_data</a></span>, <span class='name'><a href="LineText2.html#receive_data-instance_method" title="receive_data">receive_data</a></span>, <span class='name'><a href="LineText2.html#receive_end_of_binary_data-instance_method" title="receive_end_of_binary_data">receive_end_of_binary_data</a></span>, <span class='name'><a href="LineText2.html#set_binary_mode-instance_method" title="set_binary_mode">set_binary_mode</a></span>, <span class='name'><a href="LineText2.html#set_delimiter-instance_method" title="set_delimiter">set_delimiter</a></span>, <span class='name'><a href="LineText2.html#set_line_mode-instance_method" title="set_line_mode">set_line_mode</a></span>, <span class='name'><a href="LineText2.html#set_text_mode-instance_method" title="set_text_mode">set_text_mode</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>parms</h3>
</div><div id="parms-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>parms</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 76</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L76">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">76
77
78</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='parms identifier id'>parms</span><span class='assign token'>=</span> <span class='parms identifier id'>parms</span><span class='assign token'>=</span><span class='semicolon token'>;</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@@parms ivar id'>@@parms</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='parms identifier id'>parms</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>connection_ended</h3>
</div><div id="connection_ended-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connection_ended</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sent when the remote peer has ended the connection.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 510</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L510">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">510
511</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='connection_ended identifier id'>connection_ended</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_server_domain</h3>
</div><div id="get_server_domain-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_server_domain</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The domain name returned in the first line of the response to a successful
EHLO or HELO command.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 470</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L470">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">470
471
472</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_server_domain identifier id'>get_server_domain</span>
  <span class='string val'>&quot;Ok EventMachine SMTP Server&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_server_greeting</h3>
</div><div id="get_server_greeting-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_server_greeting</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <hr size="10"></hr><p>
Everything from here on can be overridden in user code. The greeting
returned in the initial connection message to the client.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 465</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L465">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">465
466
467</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_server_greeting identifier id'>get_server_greeting</span>
  <span class='string val'>&quot;EventMachine SMTP Server&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>init_protocol_state</h3>
</div><div id="init_protocol_state-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>init_protocol_state</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 189</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L189">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">189
190
191</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='init_protocol_state identifier id'>init_protocol_state</span>
  <span class='@state ivar id'>@state</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>parms</h3>
</div><div id="parms-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>parms</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 88</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L88">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">88
89
90</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='parms= identifier id'>parms=</span> <span class='parms identifier id'>parms</span><span class='assign token'>=</span><span class='semicolon token'>;</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@parms ivar id'>@parms</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='parms identifier id'>parms</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>post_init</h3>
</div><div id="post_init-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>post_init</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
In SMTP, the server talks first. But by a (perhaps flawed) axiom in EM,
#post_init will execute BEFORE the block passed to #start_server, for any
given accepted connection. Since in this class we&#8217;ll probably be
getting a lot of initialization parameters, we want the guts of post_init
to run AFTER the application has initialized the connection object. So we
use a spawn to schedule the post_init to run later. It&#8217;s a little
weird, I admit. A reasonable alternative would be to set parameters as a
class variable and to do that before accepting any connections.
</p>
<p>
OBSOLETE, now we have @@parms. But the spawn is nice to keep as an
illustration.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 103</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L103">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">103
104
105
106
107</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='post_init identifier id'>post_init</span>
  <span class='comment val'>#send_data &quot;220 #{get_server_greeting}\r\n&quot; (ORIGINAL)</span>
  <span class='comment val'>#(EM.spawn {|x| x.send_data &quot;220 #{x.get_server_greeting}\r\n&quot;}).notify(self)</span>
  <span class='lparen token'>(</span><span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='spawn identifier id'>spawn</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='send_server_greeting identifier id'>send_server_greeting</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='notify identifier id'>notify</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_auth</h3>
</div><div id="process_auth-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_auth</span><span class='args'>(str)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; So far, only AUTH PLAIN is supported but we should do at least
LOGIN as well. TODO, support clients that send AUTH PLAIN with no
parameter, expecting a 3xx response and a continuation of the auth
conversation.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 259</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L259">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_auth identifier id'>process_auth</span> <span class='str identifier id'>str</span>
  <span class='if if kw'>if</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='auth identifier id'>auth</span><span class='rparen token'>)</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;503 auth already issued\r\n&quot;</span>
  <span class='elsif elsif kw'>elsif</span> <span class='str identifier id'>str</span> <span class='match op'>=~</span> <span class='regexp val'>/\APLAIN\s+/i</span>
    <span class='plain identifier id'>plain</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='$' back_ref id'>$'</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>&quot;m&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='comment val'># Base64::decode64($'.dup)</span>
    <span class='discard identifier id'>discard</span><span class='comma token'>,</span><span class='user identifier id'>user</span><span class='comma token'>,</span><span class='psw identifier id'>psw</span> <span class='assign token'>=</span> <span class='plain identifier id'>plain</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;\000&quot;</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='receive_plain_auth identifier id'>receive_plain_auth</span> <span class='user identifier id'>user</span><span class='comma token'>,</span><span class='psw identifier id'>psw</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;235 authentication ok\r\n&quot;</span>
      <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:auth</span>
    <span class='else else kw'>else</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;535 invalid authentication\r\n&quot;</span>
    <span class='end end kw'>end</span>
    <span class='comment val'>#elsif str =~ /\ALOGIN\s+/i</span>
  <span class='else else kw'>else</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;504 auth mechanism not available\r\n&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_data</h3>
</div><div id="process_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_data</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; Unusually, we can deal with a Deferrable returned from the user
application. This was added to deal with a special case in a particular
application, but it would be a nice idea to add it to the other user-code
callbacks.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 282</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L282">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_data identifier id'>process_data</span>
  <span class='unless unless kw'>unless</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='rcpt identifier id'>rcpt</span><span class='rparen token'>)</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;503 Operation sequence error\r\n&quot;</span>
  <span class='else else kw'>else</span>
    <span class='succeeded identifier id'>succeeded</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;354 Send it\r\n&quot;</span>
      <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:data</span>
      <span class='@databuffer ivar id'>@databuffer</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='rbrace token'>}</span>
    <span class='failed identifier id'>failed</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 Operation failed\r\n&quot;</span>
    <span class='rbrace token'>}</span>

    <span class='d identifier id'>d</span> <span class='assign token'>=</span> <span class='receive_data_command identifier id'>receive_data_command</span>

    <span class='if if kw'>if</span> <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='callback identifier id'>callback</span><span class='rparen token'>)</span>
      <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='succeeded identifier id'>succeeded</span><span class='rparen token'>)</span>
      <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='errback identifier id'>errback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='failed identifier id'>failed</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='lparen token'>(</span><span class='d identifier id'>d</span> <span class='integer val'>? </span><span class='succeeded identifier id'>succeeded</span> <span class='colon op'>:</span> <span class='failed identifier id'>failed</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_data_line</h3>
</div><div id="process_data_line-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_data_line</span><span class='args'>(ln)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Send the incoming data to the application one chunk at a time, rather than
one line at a time. That lets the application be a little more flexible
about storing to disk, etc. Since we clear the chunk array every time we
submit it, the caller needs to be aware to do things like dup it if he
wants to keep it around across calls.
</p>
<p>
DON&#8217;T reset the transaction upon disposition of the incoming message.
This means another DATA command can be accepted with the same sender and
recipients. If the client wants to reset, he can call RSET. Not sure
whether the standard requires a transaction-reset at this point, but it
appears not to.
</p>
<p>
User-written code can return a Deferrable as a response from
receive_message.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 424</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L424">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_data_line identifier id'>process_data_line</span> <span class='ln identifier id'>ln</span>
  <span class='if if kw'>if</span> <span class='ln identifier id'>ln</span> <span class='eq op'>==</span> <span class='string val'>&quot;.&quot;</span>
    <span class='if if kw'>if</span> <span class='@databuffer ivar id'>@databuffer</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='receive_data_chunk identifier id'>receive_data_chunk</span> <span class='@databuffer ivar id'>@databuffer</span>
      <span class='@databuffer ivar id'>@databuffer</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
    <span class='end end kw'>end</span>


    <span class='succeeded identifier id'>succeeded</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Message accepted\r\n&quot;</span>
    <span class='rbrace token'>}</span>
    <span class='failed identifier id'>failed</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 Message rejected\r\n&quot;</span>
    <span class='rbrace token'>}</span>

    <span class='d identifier id'>d</span> <span class='assign token'>=</span> <span class='receive_message identifier id'>receive_message</span>

    <span class='if if kw'>if</span> <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='set_deferred_status identifier id'>set_deferred_status</span><span class='rparen token'>)</span>
      <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='succeeded identifier id'>succeeded</span><span class='rparen token'>)</span>
      <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='errback identifier id'>errback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='failed identifier id'>failed</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='lparen token'>(</span><span class='d identifier id'>d</span> <span class='integer val'>? </span><span class='succeeded identifier id'>succeeded</span> <span class='colon op'>:</span> <span class='failed identifier id'>failed</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
    <span class='end end kw'>end</span>

    <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:data</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># slice off leading . if any</span>
    <span class='ln identifier id'>ln</span><span class='dot token'>.</span><span class='slice! fid id'>slice!</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='integer val'>1</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='ln identifier id'>ln</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>46</span>
    <span class='@databuffer ivar id'>@databuffer</span> <span class='lshft op'>&lt;&lt;</span> <span class='ln identifier id'>ln</span>
    <span class='if if kw'>if</span> <span class='@databuffer ivar id'>@databuffer</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='chunksize identifier id'>chunksize</span><span class='rbrack token'>]</span>
      <span class='receive_data_chunk identifier id'>receive_data_chunk</span> <span class='@databuffer ivar id'>@databuffer</span>
      <span class='@databuffer ivar id'>@databuffer</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_ehlo</h3>
</div><div id="process_ehlo-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_ehlo</span><span class='args'>(domain)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; EHLO/HELO is always legal, per the standard. On success it always
clears buffers and initiates a mail &quot;transaction.&quot; Which means
that a MAIL FROM must follow.
</p>
<p>
Per the standard, an EHLO/HELO or a RSET &quot;initiates&quot; an email
transaction. Thereafter, MAIL FROM must be received before RCPT TO, before
DATA. Not sure what this specific ordering achieves semantically, but it
does make it easier to implement. We also support user-specified
requirements for STARTTLS and AUTH. We make it impossible to proceed to
MAIL FROM without fulfilling tls and/or auth, if the user specified either
or both as required. We need to check the extension standard for auth to
see if a credential is discarded after a RSET along with all the rest of
the state. We&#8217;ll behave as if it is. Now clearly, we can&#8217;t
discard tls after its been negotiated without dropping the connection, so
that flag doesn&#8217;t get cleared.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 212</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L212">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_ehlo identifier id'>process_ehlo</span> <span class='domain identifier id'>domain</span>
  <span class='if if kw'>if</span> <span class='receive_ehlo_domain identifier id'>receive_ehlo_domain</span> <span class='domain identifier id'>domain</span>
    <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;250-#{get_server_domain}\r\n&quot;</span>
    <span class='if if kw'>if</span> <span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='starttls identifier id'>starttls</span><span class='rbrack token'>]</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250-STARTTLS\r\n&quot;</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='auth identifier id'>auth</span><span class='rbrack token'>]</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250-AUTH PLAIN LOGIN\r\n&quot;</span>
    <span class='end end kw'>end</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250-NO-SOLICITING\r\n&quot;</span>
    <span class='comment val'># TODO, size needs to be configurable.</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 SIZE 20000000\r\n&quot;</span>
    <span class='reset_protocol_state identifier id'>reset_protocol_state</span>
    <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:ehlo</span>
  <span class='else else kw'>else</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 Requested action not taken\r\n&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_expn</h3>
</div><div id="process_expn-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_expn</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO - implement this properly, the implementation is a stub!
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 159</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L159">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">159
160
161</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_expn identifier id'>process_expn</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Ok, but unimplemented\r\n&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_helo</h3>
</div><div id="process_helo-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_helo</span><span class='args'>(domain)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 231</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L231">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">231
232
233
234
235
236
237
238
239</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_helo identifier id'>process_helo</span> <span class='domain identifier id'>domain</span>
  <span class='if if kw'>if</span> <span class='receive_ehlo_domain identifier id'>receive_ehlo_domain</span> <span class='domain identifier id'>domain</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;250 #{get_server_domain}\r\n&quot;</span>
    <span class='reset_protocol_state identifier id'>reset_protocol_state</span>
    <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:ehlo</span>
  <span class='else else kw'>else</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 Requested action not taken\r\n&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_help</h3>
</div><div id="process_help-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_help</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO - implement this properly, the implementation is a stub!
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 155</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L155">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">155
156
157</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_help identifier id'>process_help</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Ok, but unimplemented\r\n&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_mail_from</h3>
</div><div id="process_mail_from-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_mail_from</span><span class='args'>(sender)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; Requiring TLS is touchy, cf RFC2784. Requiring AUTH seems to be
much more reasonable. We don&#8217;t currently support any notion of
deriving an authentication from the TLS negotiation, although that would
certainly be reasonable. We DON&#8217;T allow MAIL FROM to be given twice.
We DON&#8217;T enforce all the various rules for validating the sender or
the reverse-path (like whether it should be null), and notifying the
reverse path in case of delivery problems. All of that is left to the
calling application.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 348</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L348">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_mail_from identifier id'>process_mail_from</span> <span class='sender identifier id'>sender</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='starttls identifier id'>starttls</span><span class='rbrack token'>]</span><span class='eq op'>==</span><span class='colon op'>:</span><span class='required identifier id'>required</span> <span class='and and kw'>and</span> <span class='notop op'>!</span><span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='starttls identifier id'>starttls</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 This server requires STARTTLS before MAIL FROM\r\n&quot;</span>
  <span class='elsif elsif kw'>elsif</span> <span class='lparen token'>(</span><span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='eq op'>==</span><span class='symbol val'>:required</span> <span class='and and kw'>and</span> <span class='notop op'>!</span><span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:auth</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 This server requires authentication before MAIL FROM\r\n&quot;</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:mail_from</span><span class='rparen token'>)</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;503 MAIL already given\r\n&quot;</span>
  <span class='else else kw'>else</span>
    <span class='unless unless kw'>unless</span> <span class='receive_sender identifier id'>receive_sender</span> <span class='sender identifier id'>sender</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 sender is unacceptable\r\n&quot;</span>
    <span class='else else kw'>else</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Ok\r\n&quot;</span>
      <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:mail_from</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_noop</h3>
</div><div id="process_noop-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_noop</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 246</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L246">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">246
247
248</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_noop identifier id'>process_noop</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Ok\r\n&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_quit</h3>
</div><div id="process_quit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_quit</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 241</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L241">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">241
242
243
244</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_quit identifier id'>process_quit</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;221 Ok\r\n&quot;</span>
  <span class='close_connection_after_writing identifier id'>close_connection_after_writing</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_rcpt_to</h3>
</div><div id="process_rcpt_to-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_rcpt_to</span><span class='args'>(rcpt)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; Since we require :mail_from to have been seen before we process
RCPT TO, we don&#8217;t need to repeat the tests for TLS and AUTH. Note
that we don&#8217;t remember or do anything else with the recipients. All
of that is on the user code. TODO: we should enforce user-definable limits
on the total number of recipients per transaction. We might want to make
sure that a given recipient is only seen once, but for now we&#8217;ll let
that be the user&#8217;s problem.
</p>
<p>
User-written code can return a deferrable from receive_recipient.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 377</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L377">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_rcpt_to identifier id'>process_rcpt_to</span> <span class='rcpt identifier id'>rcpt</span>
  <span class='unless unless kw'>unless</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='mail_from identifier id'>mail_from</span><span class='rparen token'>)</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;503 MAIL is required before RCPT\r\n&quot;</span>
  <span class='else else kw'>else</span>
    <span class='succeeded identifier id'>succeeded</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Ok\r\n&quot;</span>
      <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:rcpt</span> <span class='unless unless_mod kw'>unless</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:rcpt</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
    <span class='failed identifier id'>failed</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;550 recipient is unacceptable\r\n&quot;</span>
    <span class='rbrace token'>}</span>

    <span class='d identifier id'>d</span> <span class='assign token'>=</span> <span class='receive_recipient identifier id'>receive_recipient</span> <span class='rcpt identifier id'>rcpt</span>

    <span class='if if kw'>if</span> <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='set_deferred_status identifier id'>set_deferred_status</span><span class='rparen token'>)</span>
      <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='succeeded identifier id'>succeeded</span><span class='rparen token'>)</span>
      <span class='d identifier id'>d</span><span class='dot token'>.</span><span class='errback identifier id'>errback</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='failed identifier id'>failed</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='lparen token'>(</span><span class='d identifier id'>d</span> <span class='integer val'>? </span><span class='succeeded identifier id'>succeeded</span> <span class='colon op'>:</span> <span class='failed identifier id'>failed</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
    <span class='end end kw'>end</span>

<span class='comment val'>=begin
  unless receive_recipient rcpt
    send_data &quot;550 recipient is unacceptable\r\n&quot;
  else
    send_data &quot;250 Ok\r\n&quot;
    @state &lt;&lt; :rcpt unless @state.include?(:rcpt)
  end
=end
</span>

  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_rset</h3>
</div><div id="process_rset-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_rset</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 306</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L306">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">306
307
308
309
310</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_rset identifier id'>process_rset</span>
  <span class='reset_protocol_state identifier id'>reset_protocol_state</span>
  <span class='receive_reset identifier id'>receive_reset</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Ok\r\n&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_starttls</h3>
</div><div id="process_starttls-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_starttls</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; STARTTLS may not be issued before EHLO, or unless the user has
chosen to support it. TODO, must support user-supplied certificates.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 321</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L321">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">321
322
323
324
325
326
327
328
329
330
331
332
333
334
335</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_starttls identifier id'>process_starttls</span>
  <span class='if if kw'>if</span> <span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='starttls identifier id'>starttls</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='starttls identifier id'>starttls</span><span class='rparen token'>)</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;503 TLS Already negotiated\r\n&quot;</span>
    <span class='elsif elsif kw'>elsif</span> <span class='notop op'>!</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:ehlo</span><span class='rparen token'>)</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;503 EHLO required before STARTTLS\r\n&quot;</span>
    <span class='else else kw'>else</span>
      <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;220 Start TLS negotiation\r\n&quot;</span>
      <span class='start_tls identifier id'>start_tls</span>
      <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:starttls</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='process_unknown identifier id'>process_unknown</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_unknown</h3>
</div><div id="process_unknown-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_unknown</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 250</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L250">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">250
251
252</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_unknown identifier id'>process_unknown</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;500 Unknown command\r\n&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_vrfy</h3>
</div><div id="process_vrfy-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_vrfy</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO - implement this properly, the implementation is a stub!
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 151</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L151">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">151
152
153</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_vrfy identifier id'>process_vrfy</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;250 Ok, but unimplemented\r\n&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_data_chunk</h3>
</div><div id="receive_data_chunk-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_data_chunk</span><span class='args'>(data)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sent when data from the remote peer is available. The size can be
controlled by setting the :chunksize parameter. This call can be made
multiple times. The goal is to strike a balance between sending the data to
the application one line at a time, and holding all of a very large message
in memory.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 527</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L527">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">527
528
529
530
531</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_data_chunk identifier id'>receive_data_chunk</span> <span class='data identifier id'>data</span>
  <span class='@smtps_msg_size ivar id'>@smtps_msg_size</span> <span class='opasgn op'>||=</span> <span class='integer val'>0</span>
  <span class='@smtps_msg_size ivar id'>@smtps_msg_size</span> <span class='opasgn op'>+=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='STDERR constant id'>STDERR</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;&lt;#{@smtps_msg_size}&gt;&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_data_command</h3>
</div><div id="receive_data_command-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_data_command</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Called when the remote peer sends the DATA command. Returning false will
cause us to send a 550 error to the peer. This can be useful for dealing
with problems that arise from processing the whole set of sender and
recipients.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 518</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L518">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">518
519
520</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_data_command identifier id'>receive_data_command</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_ehlo_domain</h3>
</div><div id="receive_ehlo_domain-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_ehlo_domain</span><span class='args'>(domain)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
A false response from this user-overridable method will cause a 550 error
to be returned to the remote client.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 477</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L477">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">477
478
479</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_ehlo_domain identifier id'>receive_ehlo_domain</span> <span class='domain identifier id'>domain</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_line</h3>
</div><div id="receive_line-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_line</span><span class='args'>(ln)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 113</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L113">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_line identifier id'>receive_line</span> <span class='ln identifier id'>ln</span>
  <span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='symbol val'>:verbose</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='$&gt; gvar id'>$&gt;</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;&gt;&gt;&gt; #{ln}&quot;</span>

  <span class='return return kw'>return</span> <span class='process_data_line identifier id'>process_data_line</span><span class='lparen token'>(</span><span class='ln identifier id'>ln</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@state ivar id'>@state</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:data</span><span class='rparen token'>)</span>

  <span class='case case kw'>case</span> <span class='ln identifier id'>ln</span>
  <span class='when when kw'>when</span> <span class='EhloRegex constant id'>EhloRegex</span>
    <span class='process_ehlo identifier id'>process_ehlo</span> <span class='$' back_ref id'>$'</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='when when kw'>when</span> <span class='HeloRegex constant id'>HeloRegex</span>
    <span class='process_helo identifier id'>process_helo</span> <span class='$' back_ref id'>$'</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='when when kw'>when</span> <span class='MailFromRegex constant id'>MailFromRegex</span>
    <span class='process_mail_from identifier id'>process_mail_from</span> <span class='$' back_ref id'>$'</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='when when kw'>when</span> <span class='RcptToRegex constant id'>RcptToRegex</span>
    <span class='process_rcpt_to identifier id'>process_rcpt_to</span> <span class='$' back_ref id'>$'</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='when when kw'>when</span> <span class='DataRegex constant id'>DataRegex</span>
    <span class='process_data identifier id'>process_data</span>
  <span class='when when kw'>when</span> <span class='RsetRegex constant id'>RsetRegex</span>
    <span class='process_rset identifier id'>process_rset</span>
  <span class='when when kw'>when</span> <span class='VrfyRegex constant id'>VrfyRegex</span>
    <span class='process_vrfy identifier id'>process_vrfy</span>
  <span class='when when kw'>when</span> <span class='ExpnRegex constant id'>ExpnRegex</span>
    <span class='process_expn identifier id'>process_expn</span>
  <span class='when when kw'>when</span> <span class='HelpRegex constant id'>HelpRegex</span>
    <span class='process_help identifier id'>process_help</span>
  <span class='when when kw'>when</span> <span class='NoopRegex constant id'>NoopRegex</span>
    <span class='process_noop identifier id'>process_noop</span>
  <span class='when when kw'>when</span> <span class='QuitRegex constant id'>QuitRegex</span>
    <span class='process_quit identifier id'>process_quit</span>
  <span class='when when kw'>when</span> <span class='StarttlsRegex constant id'>StarttlsRegex</span>
    <span class='process_starttls identifier id'>process_starttls</span>
  <span class='when when kw'>when</span> <span class='AuthRegex constant id'>AuthRegex</span>
    <span class='process_auth identifier id'>process_auth</span> <span class='$' back_ref id'>$'</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='else else kw'>else</span>
    <span class='process_unknown identifier id'>process_unknown</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_message</h3>
</div><div id="receive_message-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_message</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sent after a message has been completely received. User code must return
true or false to indicate whether the message has been accepted for
delivery.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 536</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L536">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">536
537
538
539</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_message identifier id'>receive_message</span>
  <span class='@@parms ivar id'>@@parms</span><span class='lbrack token'>[</span><span class='symbol val'>:verbose</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='$&gt; gvar id'>$&gt;</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='string val'>&quot;Received complete message&quot;</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_plain_auth</h3>
</div><div id="receive_plain_auth-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_plain_auth</span><span class='args'>(user, password)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return true or false to indicate that the authentication is acceptable.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 482</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L482">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">482
483
484</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_plain_auth identifier id'>receive_plain_auth</span> <span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='password identifier id'>password</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_recipient</h3>
</div><div id="receive_recipient-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_recipient</span><span class='args'>(rcpt)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Receives the argument of a RCPT TO command. Can be given multiple times per
transaction. Return false to reject the recipient.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 497</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L497">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">497
498
499</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_recipient identifier id'>receive_recipient</span> <span class='rcpt identifier id'>rcpt</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_reset</h3>
</div><div id="receive_reset-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_reset</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sent when the remote peer issues the RSET command. Since RSET is not
allowed to fail (according to the protocol), we ignore any return value
from user overrides of this method.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 505</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L505">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">505
506</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_reset identifier id'>receive_reset</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_sender</h3>
</div><div id="receive_sender-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_sender</span><span class='args'>(sender)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Receives the argument of the MAIL FROM command. Return false to indicate to
the remote client that the sender is not accepted. This can only be
successfully called once per transaction.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 490</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L490">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">490
491
492</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_sender identifier id'>receive_sender</span> <span class='sender identifier id'>sender</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_transaction</h3>
</div><div id="receive_transaction-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_transaction</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This is called when the protocol state is reset. It happens when the remote
client calls EHLO/HELO or RSET.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 543</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L543">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">543
544</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_transaction identifier id'>receive_transaction</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reset_protocol_state</h3>
</div><div id="reset_protocol_state-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reset_protocol_state</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; This is called at several points to restore the protocol state to a
pre-transaction state. In essence, we &quot;forget&quot; having seen any
valid command except EHLO and STARTTLS. We also have to callback user code,
in case they&#8217;re keeping track of senders, recipients, and whatnot.
</p>
<p>
We try to follow the convention of avoiding the verb &quot;receive&quot;
for internal method names except receive_line (which we inherit), and using
only receive_xxx for user-overridable stubs.
</p>
<p>
init_protocol_state is called when we initialize the connection as well as
during reset_protocol_state. It does NOT call the user override method.
This enables us to promise the users that they won&#8217;t see the
overridable fire except after EHLO and RSET, and after a message has been
received. Although the latter may be wrong. The standard may allow multiple
DATA segments with the same set of senders and recipients.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 182</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L182">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">182
183
184
185
186
187
188</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reset_protocol_state identifier id'>reset_protocol_state</span>
  <span class='init_protocol_state identifier id'>init_protocol_state</span>
  <span class='s identifier id'>s</span><span class='comma token'>,</span><span class='@state ivar id'>@state</span> <span class='assign token'>=</span> <span class='@state ivar id'>@state</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:starttls</span> <span class='if if_mod kw'>if</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:starttls</span><span class='rparen token'>)</span>
  <span class='@state ivar id'>@state</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:ehlo</span> <span class='if if_mod kw'>if</span> <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:ehlo</span><span class='rparen token'>)</span>
  <span class='receive_transaction identifier id'>receive_transaction</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_server_greeting</h3>
</div><div id="send_server_greeting-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_server_greeting</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 109</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L109">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">109
110
111</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_server_greeting identifier id'>send_server_greeting</span>
  <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;220 #{get_server_greeting}\r\n&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>unbind</h3>
</div><div id="unbind-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>unbind</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpserver.rb', line 312</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpserver.rb#L312">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">312
313
314</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='unbind identifier id'>unbind</span>
  <span class='connection_ended identifier id'>connection_ended</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>  
                  
      <div id="footer">
        <div class="site">
          <div class="info">
            <div class="links">
              <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
              <a href="http://github.com/blog">Blog</a> |
              <a href="http://support.github.com/">Support</a> |
              <a href="http://github.com/training">Training</a> |
              <a href="http://github.com/contact">Contact</a> |
              <a href="http://groups.google.com/group/github/">Google Group</a> |
              <a href="http://develop.github.com/">API</a> |
              <a href="http://twitter.com/github">Status</a>
            </div>
            <div class="company">
              <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
              is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
            </div>
          </div>
          <div class="sponsor">
            <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
            <div>
              Hosting provided by our<br> partners at Engine Yard
            </div>
          </div>
        </div>
      </div>
      
      <div id="coming_soon" style="display: none;">
        This feature is coming soon.  Sit tight!
      </div>

      <div id="facebox" style="display: none;">       
        <div class="popup">         
          <table>           
            <tbody>             
              <tr>               
                <td class="tl"></td>
                <td class="b"></td>
                <td class="tr"></td>             
              </tr>             
            <tr>               
              <td class="b"></td>               
              <td class="body">                 
                <div class="content"></div>                 
                <div class="footer">                   
                  <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
                </div>               
              </td>               
              <td class="b"></td>             
            </tr>             
            <tr>               
              <td class="bl"></td>
              <td class="b"></td>
              <td class="br"></td>             
            </tr>           
          </tbody>         
        </table>       
      </div>     
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>