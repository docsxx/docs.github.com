<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>eventmachine's eventmachine - Module: EventMachine::Protocols::SASLauth - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/eventmachine/commits/eventmachine/master" rel="alternate" title="Recent Commits to eventmachine:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<style type="text/css">
  #repo_menu { border-bottom: 5px solid #ccc; margin-bottom: 1.5em; }
  #repo_sub_menu { display: none; }
</style>
    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main">
      <div id="header" class="">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/eventmachine/eventmachine/tree/">Source</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/network">Network</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/eventmachine/eventmachine">Wiki</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/graphs">Graphs</a></li>                    
            <li class="active"><a href="/eventmachine/eventmachine">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/eventmachine">eventmachine</a> / <b><a href="http://github.com/eventmachine/eventmachine/tree">eventmachine</a></b>        
                <a id="namespaces_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/>
                </a>
                <a id="methods_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/>
                </a>

                <script type="text/javascript">          
                $('#namespaces_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/namespaces/";
                  $.gitbox(url);
                  return false;
                });

                $('#methods_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/methods/";
                  $.gitbox(url);
                  return false;
                });
                </script>
                
              </div>
            </div>

            <div class="meta">
              <table>
                <tbody>
                  <tr>
                    <td class="label">Description:</td>
                    <td><span id="repository_description" rel="http://github.com/eventmachine/eventmachine/edit/update" class="">No description available</span></td>
                  </tr>              
                </tbody>
              </table>
            </div>
          </div>
                                        
          <div id="content">
            <div class="wikistyle">
  <div class="section module EventMachine_Protocols_SASLauth">
  <h1>Module: EventMachine::Protocols::SASLauth</h1>
  <div class="section docstring">
  <p>
Implements SASL authd. This is a very, very simple protocol that mimics the
one used by saslauthd and pwcheck, two outboard daemons included in the
standard SASL library distro. The only thing this is really suitable for is
SASL PLAIN (user+password) authentication, but the SASL libs that are
linked into standard servers (like imapd and sendmail) implement the other
ones.
</p>
<p>
SASL-auth is intended for reasonably fast operation inside a single
machine, so it has no transport-security (although there have been
multi-machine extensions incorporating transport-layer encryption).
</p>
<p>
The standard saslauthd module generally runs privileged and does its work
by referring to the system-account files.
</p>
<p>
This feature was added to EventMachine to enable the development of custom
authentication/authorization engines for standard servers.
</p>
<p>
To use SASLauth, include it in a class that subclasses EM::Connection, and
reimplement the validate method.
</p>
<p>
The typical way to incorporate this module into an authentication daemon
would be to set it as the handler for a UNIX-domain socket. The code might
look like this:
</p>
<pre class="code">
 <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='start_unix_domain_server identifier id'>start_unix_domain_server</span><span class='lparen token'>(</span> <span class='string val'>&quot;/var/run/saslauthd/mux&quot;</span><span class='comma token'>,</span> <span class='MyHandler constant id'>MyHandler</span> <span class='rparen token'>)</span>
 <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span> <span class='integer val'>0777</span><span class='comma token'>,</span> <span class='string val'>&quot;/var/run/saslauthd/mux&quot;</span><span class='rparen token'>)</span>
</pre>
<p>
The chmod is probably needed to ensure that unprivileged clients can access
the UNIX-domain socket.
</p>
<p>
It&#8217;s also a very good idea to drop superuser privileges (if any),
after the UNIX-domain socket has been opened. &#8212; Implementation
details: assume the client can send us pipelined requests, and that the
client will close the connection.
</p>
<p>
The client sends us four values, each encoded as a two-byte length field in
network order followed by the specified number of octets. The fields
specify the username, password, service name (such as imap), and the
&quot;realm&quot; name. We send back the barest minimum reply, a single
field also encoded as a two-octet length in network order, followed by
either &quot;NO&quot; or &quot;OK&quot; - simplicity itself.
</p>
<p>
We enforce a maximum field size just as a sanity check. We do NOT
automatically time out the connection.
</p>
<p>
The code we use to parse out the values is ugly and probably slow.
Improvements welcome.
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="MaxFieldSize-constant">MaxFieldSize</dt>
      <dd>128*1024</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#post_init-instance_method">#post_init</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_data-instance_method">#receive_data</span><span class='args'>(data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validate-instance_method">#validate</span><span class='args'>(username, psw, sysname, realm)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>post_init</h3>
</div><div id="post_init-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>post_init</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/saslauth.rb', line 85</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/saslauth.rb#L85">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">85
86
87
88
89</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='post_init identifier id'>post_init</span>
  <span class='super super kw'>super</span>
  <span class='@sasl_data ivar id'>@sasl_data</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
  <span class='@sasl_values ivar id'>@sasl_values</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_data</h3>
</div><div id="receive_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_data</span><span class='args'>(data)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/saslauth.rb', line 91</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/saslauth.rb#L91">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_data identifier id'>receive_data</span> <span class='data identifier id'>data</span>
  <span class='@sasl_data ivar id'>@sasl_data</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span>
  <span class='while while kw'>while</span> <span class='@sasl_data ivar id'>@sasl_data</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='geq op'>&gt;=</span> <span class='integer val'>2</span>
    <span class='len identifier id'>len</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='@sasl_data ivar id'>@sasl_data</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>&quot;n&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='raise identifier id'>raise</span> <span class='string val'>&quot;SASL Max Field Length exceeded&quot;</span> <span class='if if_mod kw'>if</span> <span class='len identifier id'>len</span> <span class='gt op'>&gt;</span> <span class='MaxFieldSize constant id'>MaxFieldSize</span>
    <span class='if if kw'>if</span> <span class='@sasl_data ivar id'>@sasl_data</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='geq op'>&gt;=</span> <span class='lparen token'>(</span><span class='len identifier id'>len</span> <span class='plus op'>+</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
      <span class='@sasl_values ivar id'>@sasl_values</span> <span class='lshft op'>&lt;&lt;</span> <span class='@sasl_data ivar id'>@sasl_data</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='comma token'>,</span><span class='len identifier id'>len</span><span class='rbrack token'>]</span>
      <span class='@sasl_data ivar id'>@sasl_data</span><span class='dot token'>.</span><span class='slice! fid id'>slice!</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='plus op'>+</span><span class='len identifier id'>len</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='@sasl_values ivar id'>@sasl_values</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>4</span>
        <span class='send_data identifier id'>send_data</span><span class='lparen token'>(</span> <span class='validate identifier id'>validate</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='@sasl_values ivar id'>@sasl_values</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='string val'>&quot;\0\002OK&quot;</span> <span class='colon op'>:</span> <span class='string val'>&quot;\0\002NO&quot;</span> <span class='rparen token'>)</span>
        <span class='@sasl_values ivar id'>@sasl_values</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='break break kw'>break</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validate</h3>
</div><div id="validate-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validate</span><span class='args'>(username, psw, sysname, realm)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/saslauth.rb', line 109</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/saslauth.rb#L109">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">109
110
111
112
113
114
115</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validate identifier id'>validate</span> <span class='username identifier id'>username</span><span class='comma token'>,</span> <span class='psw identifier id'>psw</span><span class='comma token'>,</span> <span class='sysname identifier id'>sysname</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span>
  <span class='p identifier id'>p</span> <span class='username identifier id'>username</span>
  <span class='p identifier id'>p</span> <span class='psw identifier id'>psw</span>
  <span class='p identifier id'>p</span> <span class='sysname identifier id'>sysname</span>
  <span class='p identifier id'>p</span> <span class='realm identifier id'>realm</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>  
                  
      <div id="footer">
        <div class="site">
          <div class="info">
            <div class="links">
              <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
              <a href="http://github.com/blog">Blog</a> |
              <a href="http://support.github.com/">Support</a> |
              <a href="http://github.com/training">Training</a> |
              <a href="http://github.com/contact">Contact</a> |
              <a href="http://groups.google.com/group/github/">Google Group</a> |
              <a href="http://develop.github.com/">API</a> |
              <a href="http://twitter.com/github">Status</a>
            </div>
            <div class="company">
              <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
              is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
            </div>
          </div>
          <div class="sponsor">
            <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
            <div>
              Hosting provided by our<br> partners at Engine Yard
            </div>
          </div>
        </div>
      </div>
      
      <div id="coming_soon" style="display: none;">
        This feature is coming soon.  Sit tight!
      </div>

      <div id="facebox" style="display: none;">       
        <div class="popup">         
          <table>           
            <tbody>             
              <tr>               
                <td class="tl"></td>
                <td class="b"></td>
                <td class="tr"></td>             
              </tr>             
            <tr>               
              <td class="b"></td>               
              <td class="body">                 
                <div class="content"></div>                 
                <div class="footer">                   
                  <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
                </div>               
              </td>               
              <td class="b"></td>             
            </tr>             
            <tr>               
              <td class="bl"></td>
              <td class="b"></td>
              <td class="br"></td>             
            </tr>           
          </tbody>         
        </table>       
      </div>     
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>