<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>eventmachine's eventmachine - Class: EventMachine::Protocols::SmtpClient - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/eventmachine/commits/eventmachine/master" rel="alternate" title="Recent Commits to eventmachine:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<style type="text/css">
  #repo_menu { border-bottom: 5px solid #ccc; margin-bottom: 1.5em; }
  #repo_sub_menu { display: none; }
</style>
    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main">
      <div id="header" class="">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/eventmachine/eventmachine/tree/">Source</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/network">Network</a></li>            
            <li class=""><a href="http://github.com/eventmachine/eventmachine/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/eventmachine/eventmachine">Wiki</a></li>
            <li class=""><a href="http://github.com/eventmachine/eventmachine/graphs">Graphs</a></li>                    
            <li class="active"><a href="http://docs.github.com/eventmachine/eventmachine">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/eventmachine">eventmachine</a> / <b><a href="http://github.com/eventmachine/eventmachine/tree">eventmachine</a></b>        
                <a id="namespaces_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/>
                </a>
                <a id="methods_button" rel="eventmachine/eventmachine" href="#">
                  <img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/>
                </a>

                <script type="text/javascript">          
                $('#namespaces_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/namespaces/";
                  $.gitbox(url);
                  return false;
                });

                $('#methods_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/methods/";
                  $.gitbox(url);
                  return false;
                });
                </script>
                
              </div>
            </div>

            <div class="meta">
              <table>
                <tbody>
                  <tr>
                    <td class="label">Description:</td>
                    <td><span id="repository_description" rel="http://github.com/eventmachine/eventmachine/edit/update" class="">No description available</span></td>
                  </tr>              
                </tbody>
              </table>
            </div>
          </div>
                                        
          <div id="content">
            <div class="wikistyle">
  <div class="section class EventMachine_Protocols_SmtpClient">
  <h1>Class: EventMachine::Protocols::SmtpClient</h1>
  <div class="section inheritance">
  <ul>
  <li><a title="EventMachine::Connection" href="../Connection.html">EventMachine::Connection</a></li><ul><li>EventMachine::Protocols::SmtpClient</li>
  </ul></ul>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p><a title="EventMachine::Deferrable" href="../Deferrable.html">EventMachine::Deferrable</a>, <a title="EventMachine::Protocols::LineText2" href="LineText2.html">EventMachine::Protocols::LineText2</a></p>
</div><div class="section docstring">
  <p>
Simple SMTP client
</p>
<pre class="code">
  <span class='email identifier id'>email</span> <span class='assign token'>=</span> <span class='EM constant id'>EM</span><span class='colon2 op'>::</span><span class='Protocols constant id'>Protocols</span><span class='colon2 op'>::</span><span class='SmtpClient constant id'>SmtpClient</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span>
    <span class='symbol val'>:domain=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;example.com&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:host=</span><span class='gt op'>&gt;</span><span class='string val'>'localhost'</span><span class='comma token'>,</span>
    <span class='symbol val'>:port=</span><span class='gt op'>&gt;</span><span class='integer val'>25</span><span class='comma token'>,</span> <span class='comment val'># optional, defaults 25</span>
    <span class='symbol val'>:starttls=</span><span class='gt op'>&gt;</span><span class='true true kw'>true</span><span class='comma token'>,</span> <span class='comment val'># use ssl</span>
    <span class='symbol val'>:from=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;sender@example.com&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:to=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;to_1@example.com&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;to_2@example.com&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:header=</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='geq op'>&gt;=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='This constant id'>This</span> <span class='is identifier id'>is</span> <span class='a identifier id'>a</span> <span class='subject identifier id'>subject</span> <span class='line identifier id'>line</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;,
    :body=&gt; &quot;This is the body of the email&quot;
  )
  email.callback{
    puts 'Email sent!'
  }
  email.errback{ |e|
    puts 'Email failed!'
  }
</span></pre>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">args</td>
          <td class="readwrite">
            [R<span id='args%3D-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
:stopdoc:.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="included">
  
  <div>
    <h2>Constants Included from <a title="EventMachine::Protocols::LineText2" href="LineText2.html">EventMachine::Protocols::LineText2</a></h2>
    <p><span class='name'><a title="MaxBinaryLength" href="LineText2.html#MaxBinaryLength-constant">MaxBinaryLength</a></span>, <span class='name'><a title="MaxLineLength" href="LineText2.html#MaxLineLength-constant">MaxLineLength</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h2>Constructor</h2>
  <p class="inherited_msg">
    This class inherits a constructor from <a title="EventMachine::Connection" href="../Connection.html#initialize-instance_method">EventMachine::Connection</a>.
  </p>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send-class_method">send</span><span class='args'>(args = )</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
:host =&gt; required String
</p>
<pre class="code">
  <span class='a identifier id'>a</span> <span class='string identifier id'>string</span> <span class='containing identifier id'>containing</span> <span class='the identifier id'>the</span> <span class='IP constant id'>IP</span> <span class='address identifier id'>address</span> <span class='or or kw'>or</span> <span class='host identifier id'>host</span> <span class='name identifier id'>name</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='SMTP constant id'>SMTP</span> <span class='server identifier id'>server</span> <span class='to identifier id'>to</span> <span class='connect identifier id'>connect</span> <span class='to identifier id'>to</span><span class='dot token'>.</span>
</pre>

        
      </td>
    </tr>
  
</table><div class="included">
  
  <div>
    <h2>Public Class Methods Included from <a title="EventMachine::Deferrable" href="../Deferrable.html">EventMachine::Deferrable</a></h2>
    <p><span class='name'><a title="future" href="../Deferrable.html#future-class_method">future</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connection_completed-instance_method">#connection_completed</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_auth-instance_method">#invoke_auth</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Perform an authentication.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_data-instance_method">#invoke_data</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_error-instance_method">#invoke_error</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
We encountered an error from the server and will close the connection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_internal_error-instance_method">#invoke_internal_error</span><span class='args'>(msg = &quot;???&quot;)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
We encountered an error on our side of the protocol and will close the
connection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_mail_from-instance_method">#invoke_mail_from</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_rcpt_to-instance_method">#invoke_rcpt_to</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_starttls-instance_method">#invoke_starttls</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#post_init-instance_method">#post_init</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_auth_response-instance_method">#receive_auth_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_data_response-instance_method">#receive_data_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_ehlo_response-instance_method">#receive_ehlo_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_line-instance_method">#receive_line</span><span class='args'>(ln)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_mail_from_response-instance_method">#receive_mail_from_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_message_response-instance_method">#receive_message_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_rcpt_to_response-instance_method">#receive_rcpt_to_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_signon-instance_method">#receive_signon</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_starttls_response-instance_method">#receive_starttls_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#unbind-instance_method">#unbind</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
We can get here in a variety of ways, all of them being failures unless the
@succeeded flag is set.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h2>Public Instance Methods Inherited from <a title="EventMachine::Connection" href="../Connection.html">EventMachine::Connection</a></h2>
    <p><span class='name'><a title="associate_callback_target" href="../Connection.html#associate_callback_target-instance_method">associate_callback_target</a></span>, <span class='name'><a title="close_connection" href="../Connection.html#close_connection-instance_method">close_connection</a></span>, <span class='name'><a title="close_connection_after_writing" href="../Connection.html#close_connection_after_writing-instance_method">close_connection_after_writing</a></span>, <span class='name'><a title="comm_inactivity_timeout" href="../Connection.html#comm_inactivity_timeout-instance_method">comm_inactivity_timeout</a></span>, <span class='name'><a title="detach" href="../Connection.html#detach-instance_method">detach</a></span>, <span class='name'><a title="error?" href="../Connection.html#error%3F-instance_method">error?</a></span>, <span class='name'><a title="get_outbound_data_size" href="../Connection.html#get_outbound_data_size-instance_method">get_outbound_data_size</a></span>, <span class='name'><a title="get_peer_cert" href="../Connection.html#get_peer_cert-instance_method">get_peer_cert</a></span>, <span class='name'><a title="get_peername" href="../Connection.html#get_peername-instance_method">get_peername</a></span>, <span class='name'><a title="get_pid" href="../Connection.html#get_pid-instance_method">get_pid</a></span>, <span class='name'><a title="get_sockname" href="../Connection.html#get_sockname-instance_method">get_sockname</a></span>, <span class='name'><a title="get_status" href="../Connection.html#get_status-instance_method">get_status</a></span>, <span class='name'><a title="receive_data" href="../Connection.html#receive_data-instance_method">receive_data</a></span>, <span class='name'><a title="reconnect" href="../Connection.html#reconnect-instance_method">reconnect</a></span>, <span class='name'><a title="send_data" href="../Connection.html#send_data-instance_method">send_data</a></span>, <span class='name'><a title="send_datagram" href="../Connection.html#send_datagram-instance_method">send_datagram</a></span>, <span class='name'><a title="send_file_data" href="../Connection.html#send_file_data-instance_method">send_file_data</a></span>, <span class='name'><a title="set_comm_inactivity_timeout" href="../Connection.html#set_comm_inactivity_timeout-instance_method">set_comm_inactivity_timeout</a></span>, <span class='name'><a title="ssl_handshake_completed" href="../Connection.html#ssl_handshake_completed-instance_method">ssl_handshake_completed</a></span>, <span class='name'><a title="ssl_verify_peer" href="../Connection.html#ssl_verify_peer-instance_method">ssl_verify_peer</a></span>, <span class='name'><a title="start_tls" href="../Connection.html#start_tls-instance_method">start_tls</a></span>, <span class='name'><a title="stream_file_data" href="../Connection.html#stream_file_data-instance_method">stream_file_data</a></span></p>
  </div>
  
</div>
<div class="clear"></div><div class="included">
  
  <div>
    <h2>Public Instance Methods Included from <a title="EventMachine::Deferrable" href="../Deferrable.html">EventMachine::Deferrable</a></h2>
    <p><span class='name'><a title="callback" href="../Deferrable.html#callback-instance_method">callback</a></span>, <span class='name'><a title="cancel_timeout" href="../Deferrable.html#cancel_timeout-instance_method">cancel_timeout</a></span>, <span class='name'><a title="errback" href="../Deferrable.html#errback-instance_method">errback</a></span>, <span class='name'><a title="fail" href="../Deferrable.html#fail-instance_method">fail</a></span>, <span class='name'><a title="set_deferred_status" href="../Deferrable.html#set_deferred_status-instance_method">set_deferred_status</a></span>, <span class='name'><a title="succeed" href="../Deferrable.html#succeed-instance_method">succeed</a></span>, <span class='name'><a title="timeout" href="../Deferrable.html#timeout-instance_method">timeout</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="EventMachine::Protocols::LineText2" href="LineText2.html">EventMachine::Protocols::LineText2</a></h2>
    <p><span class='name'><a title="receive_binary_data" href="LineText2.html#receive_binary_data-instance_method">receive_binary_data</a></span>, <span class='name'><a title="receive_data" href="LineText2.html#receive_data-instance_method">receive_data</a></span>, <span class='name'><a title="receive_end_of_binary_data" href="LineText2.html#receive_end_of_binary_data-instance_method">receive_end_of_binary_data</a></span>, <span class='name'><a title="set_binary_mode" href="LineText2.html#set_binary_mode-instance_method">set_binary_mode</a></span>, <span class='name'><a title="set_delimiter" href="LineText2.html#set_delimiter-instance_method">set_delimiter</a></span>, <span class='name'><a title="set_line_mode" href="LineText2.html#set_line_mode-instance_method">set_line_mode</a></span>, <span class='name'><a title="set_text_mode" href="LineText2.html#set_text_mode-instance_method">set_text_mode</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>send</h3>
</div><div id="send-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send</span><span class='args'>(args = )</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
:host =&gt; required String
</p>
<pre class="code">
  <span class='a identifier id'>a</span> <span class='string identifier id'>string</span> <span class='containing identifier id'>containing</span> <span class='the identifier id'>the</span> <span class='IP constant id'>IP</span> <span class='address identifier id'>address</span> <span class='or or kw'>or</span> <span class='host identifier id'>host</span> <span class='name identifier id'>name</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='SMTP constant id'>SMTP</span> <span class='server identifier id'>server</span> <span class='to identifier id'>to</span> <span class='connect identifier id'>connect</span> <span class='to identifier id'>to</span><span class='dot token'>.</span>
</pre>
<p>
:port =&gt; optional
</p>
<pre class="code">
  <span class='defaults identifier id'>defaults</span> <span class='to identifier id'>to</span> <span class='float val'>25</span><span class='dot token'>.</span>
</pre>
<p>
:domain =&gt; required String
</p>
<pre class="code">
  <span class='This constant id'>This</span> <span class='is identifier id'>is</span> <span class='passed identifier id'>passed</span> <span class='as identifier id'>as</span> <span class='the identifier id'>the</span> <span class='argument identifier id'>argument</span> <span class='to identifier id'>to</span> <span class='the identifier id'>the</span> <span class='EHLO constant id'>EHLO</span> <span class='command identifier id'>command</span><span class='dot token'>.</span>
</pre>
<p>
:starttls =&gt; optional Boolean
</p>
<pre class="code">
  <span class='If constant id'>If</span> <span class='it identifier id'>it</span> <span class='evaluates identifier id'>evaluates</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='then then kw'>then</span> <span class='the identifier id'>the</span> <span class='client identifier id'>client</span> <span class='will identifier id'>will</span> <span class='initiate identifier id'>initiate</span> <span class='STARTTLS constant id'>STARTTLS</span> <span class='with identifier id'>with</span>
  <span class='the identifier id'>the</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='and and kw'>and</span> <span class='abort identifier id'>abort</span> <span class='the identifier id'>the</span> <span class='connection identifier id'>connection</span> <span class='if if_mod kw'>if</span> <span class='the identifier id'>the</span> <span class='negotiation identifier id'>negotiation</span> <span class='doesn identifier id'>doesn</span><span class='string val'>'t succeed.
  TODO, need to be able to pass certificate parameters with this option.
</span></pre>
<p>
:auth =&gt; optional Hash of auth parameters
</p>
<pre class="code">
  <span class='If constant id'>If</span> <span class='not not kw'>not</span> <span class='given identifier id'>given</span><span class='comma token'>,</span> <span class='then then kw'>then</span> <span class='no identifier id'>no</span> <span class='auth identifier id'>auth</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='attempted identifier id'>attempted</span><span class='dot token'>.</span>
  <span class='lparen token'>(</span><span class='In constant id'>In</span> <span class='that identifier id'>that</span> <span class='case case kw'>case</span><span class='comma token'>,</span> <span class='the identifier id'>the</span> <span class='connection identifier id'>connection</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='aborted identifier id'>aborted</span> <span class='if if_mod kw'>if</span> <span class='the identifier id'>the</span> <span class='server identifier id'>server</span> <span class='requires identifier id'>requires</span> <span class='auth identifier id'>auth</span><span class='dot token'>.</span><span class='rparen token'>)</span>
  <span class='Specify constant id'>Specify</span> <span class='the identifier id'>the</span> <span class='hash identifier id'>hash</span> <span class='value identifier id'>value</span> <span class='symbol val'>:type</span> <span class='to identifier id'>to</span> <span class='determine identifier id'>determine</span> <span class='the identifier id'>the</span> <span class='auth identifier id'>auth</span> <span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='along identifier id'>along</span> <span class='with identifier id'>with</span> <span class='additional identifier id'>additional</span> <span class='parameters identifier id'>parameters</span>
  <span class='depending identifier id'>depending</span> <span class='on identifier id'>on</span> <span class='the identifier id'>the</span> <span class='type identifier id'>type</span><span class='dot token'>.</span>
  <span class='Currently constant id'>Currently</span> <span class='only identifier id'>only</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:plain</span> <span class='is identifier id'>is</span> <span class='supported identifier id'>supported</span><span class='dot token'>.</span> <span class='Pass constant id'>Pass</span> <span class='additional identifier id'>additional</span> <span class='parameters identifier id'>parameters</span> <span class='symbol val'>:username</span> <span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span><span class='comma token'>,</span>
  <span class='and and kw'>and</span> <span class='symbol val'>:password</span> <span class='lparen token'>(</span><span class='either identifier id'>either</span> <span class='a identifier id'>a</span> <span class='String constant id'>String</span> <span class='or or kw'>or</span> <span class='a identifier id'>a</span> <span class='Proc constant id'>Proc</span> <span class='that identifier id'>that</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='called identifier id'>called</span> <span class='at identifier id'>at</span> <span class='auth identifier id'>auth</span><span class='minus op'>-</span><span class='time identifier id'>time</span><span class='rparen token'>)</span><span class='dot token'>.</span>
  <span class='Example constant id'>Example</span><span class='colon op'>:</span> <span class='symbol val'>:auth</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='symbol val'>:username=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='mickey identifier id'>mickey</span><span class='@disney ivar id'>@disney</span><span class='dot token'>.</span><span class='com identifier id'>com</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='comma token'>,</span> <span class='symbol val'>:password=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='mouse identifier id'>mouse</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;
</span></pre>
<p>
:from =&gt; required String
</p>
<pre class="code">
  <span class='Specifies constant id'>Specifies</span> <span class='the identifier id'>the</span> <span class='sender identifier id'>sender</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='message identifier id'>message</span><span class='dot token'>.</span> <span class='Will constant id'>Will</span> <span class='be identifier id'>be</span> <span class='passed identifier id'>passed</span> <span class='as identifier id'>as</span> <span class='the identifier id'>the</span> <span class='argument identifier id'>argument</span>
  <span class='to identifier id'>to</span> <span class='the identifier id'>the</span> <span class='MAIL constant id'>MAIL</span> <span class='FROM constant id'>FROM</span><span class='dot token'>.</span> <span class='Do constant id'>Do</span> <span class='NOT constant id'>NOT</span> <span class='enclose identifier id'>enclose</span> <span class='the identifier id'>the</span> <span class='argument identifier id'>argument</span> <span class='in in kw'>in</span> <span class='angle identifier id'>angle</span><span class='minus op'>-</span><span class='bracket identifier id'>bracket</span> <span class='lparen token'>(</span><span class='lt op'>&lt;</span><span class='gt op'>&gt;</span><span class='rparen token'>)</span> <span class='characters identifier id'>characters</span><span class='dot token'>.</span>
  <span class='The constant id'>The</span> <span class='connection identifier id'>connection</span> <span class='will identifier id'>will</span> <span class='abort identifier id'>abort</span> <span class='if if_mod kw'>if</span> <span class='the identifier id'>the</span> <span class='server identifier id'>server</span> <span class='rejects identifier id'>rejects</span> <span class='the identifier id'>the</span> <span class='value identifier id'>value</span><span class='dot token'>.</span>
</pre>
<p>
:to =&gt; required String or Array of Strings
</p>
<pre class="code">
  <span class='The constant id'>The</span> <span class='recipient identifier id'>recipient</span><span class='lparen token'>(</span><span class='s identifier id'>s</span><span class='rparen token'>)</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='message identifier id'>message</span><span class='dot token'>.</span> <span class='Do constant id'>Do</span> <span class='NOT constant id'>NOT</span> <span class='enclose identifier id'>enclose</span>
  <span class='any identifier id'>any</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='values identifier id'>values</span> <span class='in in kw'>in</span> <span class='angle identifier id'>angle</span><span class='minus op'>-</span><span class='brackets identifier id'>brackets</span> <span class='lparen token'>(</span><span class='lt op'>&lt;</span><span class='gt op'>&gt;</span><span class='rparen token'>)</span> <span class='characters identifier id'>characters</span><span class='dot token'>.</span> <span class='It constant id'>It</span><span class='string val'>'s NOT a fatal error if one or more
  recipients are rejected by the server. (Of course, if ALL of them are, the server will most
  likely trigger an error when we try to send data.) An array of codes containing the status
  of each requested recipient is available after the call completes. TODO, we should define
  an overridable stub that will be called on rejection of a recipient or a sender, giving
  user code the chance to try again or abort the connection.
</span></pre>
<p>
:header =&gt; Required hash of values to be transmitted in the header of
the message.
</p>
<pre class="code">
  <span class='The constant id'>The</span> <span class='hash identifier id'>hash</span> <span class='keys identifier id'>keys</span> <span class='are identifier id'>are</span> <span class='the identifier id'>the</span> <span class='names identifier id'>names</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='headers identifier id'>headers</span> <span class='lparen token'>(</span><span class='do do kw'>do</span> <span class='NOT constant id'>NOT</span> <span class='append identifier id'>append</span> <span class='a identifier id'>a</span> <span class='trailing identifier id'>trailing</span> <span class='colon identifier id'>colon</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='values identifier id'>values</span> <span class='are identifier id'>are</span> <span class='strings identifier id'>strings</span>
  <span class='containing identifier id'>containing</span> <span class='the identifier id'>the</span> <span class='header identifier id'>header</span> <span class='values identifier id'>values</span><span class='dot token'>.</span> <span class='TODO constant id'>TODO</span><span class='comma token'>,</span> <span class='support identifier id'>support</span> <span class='Arrays constant id'>Arrays</span> <span class='of identifier id'>of</span> <span class='header identifier id'>header</span> <span class='values identifier id'>values</span><span class='comma token'>,</span> <span class='which identifier id'>which</span> <span class='would identifier id'>would</span> <span class='cause identifier id'>cause</span> <span class='us identifier id'>us</span> <span class='to identifier id'>to</span>
  <span class='send identifier id'>send</span> <span class='that identifier id'>that</span> <span class='specific identifier id'>specific</span> <span class='header identifier id'>header</span> <span class='line identifier id'>line</span> <span class='more identifier id'>more</span> <span class='than identifier id'>than</span> <span class='once identifier id'>once</span><span class='dot token'>.</span>

  <span class='Example constant id'>Example</span><span class='colon op'>:</span> <span class='symbol val'>:header</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='geq op'>&gt;=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='Bogus constant id'>Bogus</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='CC constant id'>CC</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span> <span class='assign token'>=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='myboss identifier id'>myboss</span><span class='@example ivar id'>@example</span><span class='dot token'>.</span><span class='com identifier id'>com</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;
</span></pre>
<p>
:body =&gt; Optional string, defaults blank.
</p>
<pre class="code">
  <span class='This constant id'>This</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='passed identifier id'>passed</span> <span class='as identifier id'>as</span> <span class='the identifier id'>the</span> <span class='body identifier id'>body</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='email identifier id'>email</span> <span class='message identifier id'>message</span><span class='dot token'>.</span>
  <span class='TODO constant id'>TODO</span><span class='comma token'>,</span> <span class='this identifier id'>this</span> <span class='needs identifier id'>needs</span> <span class='to identifier id'>to</span> <span class='be identifier id'>be</span> <span class='significantly identifier id'>significantly</span> <span class='beefed identifier id'>beefed</span> <span class='up identifier id'>up</span><span class='dot token'>.</span> <span class='As constant id'>As</span> <span class='currently identifier id'>currently</span> <span class='written identifier id'>written</span><span class='comma token'>,</span> <span class='this identifier id'>this</span> <span class='requires identifier id'>requires</span> <span class='the identifier id'>the</span> <span class='caller identifier id'>caller</span>
  <span class='to identifier id'>to</span> <span class='properly identifier id'>properly</span> <span class='format identifier id'>format</span> <span class='the identifier id'>the</span> <span class='input identifier id'>input</span> <span class='into identifier id'>into</span> <span class='CRLF constant id'>CRLF</span><span class='minus op'>-</span><span class='delimited identifier id'>delimited</span> <span class='lines identifier id'>lines</span> <span class='of identifier id'>of</span> <span class='integer val'>7</span><span class='minus op'>-</span><span class='bit identifier id'>bit</span> <span class='characters identifier id'>characters</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='standard identifier id'>standard</span>
  <span class='SMTP constant id'>SMTP</span> <span class='transmission identifier id'>transmission</span> <span class='format identifier id'>format</span><span class='dot token'>.</span> <span class='We constant id'>We</span> <span class='need identifier id'>need</span> <span class='to identifier id'>to</span> <span class='be identifier id'>be</span> <span class='able identifier id'>able</span> <span class='to identifier id'>to</span> <span class='automatically identifier id'>automatically</span> <span class='convert identifier id'>convert</span> <span class='binary identifier id'>binary</span> <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='and and kw'>and</span> <span class='add identifier id'>add</span>
  <span class='correct identifier id'>correct</span> <span class='line identifier id'>line</span><span class='minus op'>-</span><span class='breaks identifier id'>breaks</span> <span class='to identifier id'>to</span> <span class='text identifier id'>text</span> <span class='data identifier id'>data</span><span class='dot token'>.</span> <span class='I constant id'>I</span> <span class='think identifier id'>think</span> <span class='the identifier id'>the</span> <span class='symbol val'>:body</span> <span class='parameter identifier id'>parameter</span> <span class='should identifier id'>should</span> <span class='remain identifier id'>remain</span> <span class='as identifier id'>as</span> <span class='it identifier id'>it</span> <span class='is identifier id'>is</span><span class='comma token'>,</span> <span class='and and kw'>and</span> <span class='we identifier id'>we</span>
  <span class='should identifier id'>should</span> <span class='add identifier id'>add</span> <span class='a identifier id'>a</span> <span class='symbol val'>:content</span> <span class='parameter identifier id'>parameter</span> <span class='that identifier id'>that</span> <span class='contains identifier id'>contains</span> <span class='autoconversions identifier id'>autoconversions</span> <span class='and and kw'>and</span><span class='regexp val'>/or conversion parameters.
  Then we can check if either :body or :content is present and do the right thing.
</span></pre>
<p>
:verbose =&gt; Optional.
</p>
<pre class="code">
  <span class='If constant id'>If</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='will identifier id'>will</span> <span class='cause identifier id'>cause</span> <span class='a identifier id'>a</span> <span class='lot identifier id'>lot</span> <span class='of identifier id'>of</span> <span class='information identifier id'>information</span> <span class='lparen token'>(</span><span class='including identifier id'>including</span> <span class='the identifier id'>the</span> <span class='server identifier id'>server</span><span class='minus op'>-</span><span class='side identifier id'>side</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span>
  <span class='conversation identifier id'>conversation</span><span class='rparen token'>)</span> <span class='to identifier id'>to</span> <span class='be identifier id'>be</span> <span class='dumped identifier id'>dumped</span> <span class='to identifier id'>to</span> <span class='$&gt; gvar id'>$&gt;</span><span class='dot token'>.</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 102</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L102">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='args identifier id'>args</span><span class='assign token'>=</span><span class='semicolon token'>;</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='integer val'>25</span>
  <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='string val'>&quot;&quot;</span>

<span class='comment val'>=begin
(I don't think it's possible for EM#connect to throw an exception under normal
circumstances, so this original code is stubbed out. A connect-failure will result
in the #unbind method being called without calling #connection_completed.)
begin
  EventMachine.connect( args[:host], args[:port], self) {|c|
    # According to the EM docs, we will get here AFTER post_init is called.
    c.args = args
    c.set_comm_inactivity_timeout 60
  }
rescue
  # We'll get here on a connect error. This code mimics the effect
  # of a call to invoke_internal_error. Would be great to DRY this up.
  # (Actually, it may be that we never get here, if EM#connect catches
  # its errors internally.)
  d = EM::DefaultDeferrable.new
  d.set_deferred_status(:failed, {:error=&gt;[:connect, 500, &quot;unable to connect to server&quot;]})
  d
end
=end
</span>

  <span class='EventMachine constant id'>EventMachine</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span><span class='lparen token'>(</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span>
    <span class='comment val'># According to the EM docs, we will get here AFTER post_init is called.</span>
    <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
    <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='set_comm_inactivity_timeout identifier id'>set_comm_inactivity_timeout</span> <span class='integer val'>60</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>connection_completed</h3>
</div><div id="connection_completed-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connection_completed</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 142</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L142">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">142
143
144
145</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='connection_completed identifier id'>connection_completed</span>
  <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_signon</span>
  <span class='@msg ivar id'>@msg</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_auth</h3>
</div><div id="invoke_auth-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_auth</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Perform an authentication. If the caller didn&#8217;t request one, then
fall through to the mail-from state.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 230</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L230">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_auth identifier id'>invoke_auth</span>
  <span class='if if kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='auth identifier id'>auth</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='auth identifier id'>auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='colon op'>:</span><span class='plain identifier id'>plain</span>
      <span class='psw identifier id'>psw</span> <span class='assign token'>=</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:auth</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span>
      <span class='if if kw'>if</span> <span class='psw identifier id'>psw</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='call identifier id'>call</span><span class='rparen token'>)</span>
        <span class='psw identifier id'>psw</span> <span class='assign token'>=</span> <span class='psw identifier id'>psw</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
      <span class='end end kw'>end</span>
      <span class='comment val'>#str = Base64::encode64(&quot;\0#{@args[:auth][:username]}\0#{psw}&quot;).chomp</span>
      <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='dstring node'>&quot;\0#{@args[:auth][:username]}\0#{psw}&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>&quot;m&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span>
      <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;AUTH PLAIN #{str}\r\n&quot;</span>
      <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_auth_response</span>
    <span class='else else kw'>else</span>
      <span class='return return kw'>return</span> <span class='invoke_internal_error identifier id'>invoke_internal_error</span><span class='lparen token'>(</span><span class='string val'>&quot;unsupported auth type&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='invoke_mail_from identifier id'>invoke_mail_from</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_data</h3>
</div><div id="invoke_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_data</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 283</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L283">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">283
284
285
286</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_data identifier id'>invoke_data</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;DATA\r\n&quot;</span>
  <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_data_response</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_error</h3>
</div><div id="invoke_error-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_error</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
We encountered an error from the server and will close the connection. Use
the error and message the server returned.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 177</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L177">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">177
178
179
180
181
182
183
184
185</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_error identifier id'>invoke_error</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='elapsed_time identifier id'>elapsed_time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='start_time identifier id'>start_time</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='responder identifier id'>responder</span> <span class='assign token'>=</span> <span class='@responder ivar id'>@responder</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='@code ivar id'>@code</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='@msg ivar id'>@msg</span>
  <span class='set_deferred_status identifier id'>set_deferred_status</span> <span class='symbol val'>:failed</span><span class='comma token'>,</span> <span class='@return_values ivar id'>@return_values</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;QUIT\r\n&quot;</span>
  <span class='close_connection_after_writing identifier id'>close_connection_after_writing</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_internal_error</h3>
</div><div id="invoke_internal_error-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_internal_error</span><span class='args'>(msg = &quot;???&quot;)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
We encountered an error on our side of the protocol and will close the
connection. Use an extra-protocol error code (900) and use the message from
the caller.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 190</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L190">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">190
191
192
193
194
195
196
197
198</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_internal_error identifier id'>invoke_internal_error</span> <span class='msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='string val'>&quot;???&quot;</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='elapsed_time identifier id'>elapsed_time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='start_time identifier id'>start_time</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='responder identifier id'>responder</span> <span class='assign token'>=</span> <span class='@responder ivar id'>@responder</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='integer val'>900</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='msg identifier id'>msg</span>
  <span class='set_deferred_status identifier id'>set_deferred_status</span> <span class='symbol val'>:failed</span><span class='comma token'>,</span> <span class='@return_values ivar id'>@return_values</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;QUIT\r\n&quot;</span>
  <span class='close_connection_after_writing identifier id'>close_connection_after_writing</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_mail_from</h3>
</div><div id="invoke_mail_from-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_mail_from</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 253</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L253">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">253
254
255
256</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_mail_from identifier id'>invoke_mail_from</span>
  <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;MAIL FROM: &lt;#{@args[:from]}&gt;\r\n&quot;</span>
  <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_mail_from_response</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_rcpt_to</h3>
</div><div id="invoke_rcpt_to-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_rcpt_to</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 262</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L262">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_rcpt_to identifier id'>invoke_rcpt_to</span>
  <span class='@rcpt_responses ivar id'>@rcpt_responses</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='l identifier id'>l</span> <span class='assign token'>=</span> <span class='@rcpt_responses ivar id'>@rcpt_responses</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='to identifier id'>to</span> <span class='assign token'>=</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:to</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:to</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:to</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='l identifier id'>l</span> <span class='lt op'>&lt;</span> <span class='to identifier id'>to</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;RCPT TO: &lt;#{to[l]}&gt;\r\n&quot;</span>
    <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_rcpt_to_response</span>
  <span class='else else kw'>else</span>
    <span class='e identifier id'>e</span> <span class='assign token'>=</span> <span class='@rcpt_responses ivar id'>@rcpt_responses</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='rr identifier id'>rr</span><span class='bitor op'>|</span> <span class='rr identifier id'>rr</span><span class='dot token'>.</span><span class='last identifier id'>last</span> <span class='eq op'>==</span> <span class='integer val'>2</span><span class='rbrace token'>}</span>
    <span class='if if kw'>if</span> <span class='e identifier id'>e</span> <span class='and and kw'>and</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='invoke_data identifier id'>invoke_data</span>
    <span class='else else kw'>else</span>
      <span class='invoke_error identifier id'>invoke_error</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_starttls</h3>
</div><div id="invoke_starttls-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_starttls</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 212</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L212">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">212
213
214
215
216
217
218
219
220
221</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_starttls identifier id'>invoke_starttls</span>
  <span class='if if kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='starttls identifier id'>starttls</span><span class='rbrack token'>]</span>
    <span class='comment val'># It would be more sociable to first ask if @server_caps contains</span>
    <span class='comment val'># the string &quot;STARTTLS&quot; before we invoke it, but hey, life's too short.</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;STARTTLS\r\n&quot;</span>
    <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_starttls_response</span>
  <span class='else else kw'>else</span>
    <span class='invoke_auth identifier id'>invoke_auth</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>post_init</h3>
</div><div id="post_init-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>post_init</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 137</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L137">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">137
138
139
140</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='post_init identifier id'>post_init</span>
  <span class='@return_values ivar id'>@return_values</span> <span class='assign token'>=</span> <span class='OpenStruct constant id'>OpenStruct</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='start_time identifier id'>start_time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_auth_response</h3>
</div><div id="receive_auth_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_auth_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 248</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L248">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">248
249
250
251</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_auth_response identifier id'>receive_auth_response</span>
  <span class='return return kw'>return</span> <span class='invoke_error identifier id'>invoke_error</span> <span class='unless unless_mod kw'>unless</span> <span class='@range ivar id'>@range</span> <span class='eq op'>==</span> <span class='integer val'>2</span>
  <span class='invoke_mail_from identifier id'>invoke_mail_from</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_data_response</h3>
</div><div id="receive_data_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_data_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 287</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L287">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_data_response identifier id'>receive_data_response</span>
  <span class='return return kw'>return</span> <span class='invoke_error identifier id'>invoke_error</span> <span class='unless unless_mod kw'>unless</span> <span class='@range ivar id'>@range</span> <span class='eq op'>==</span> <span class='integer val'>3</span>

  <span class='comment val'># The data to send can be given either in @args[:content] (an array or string of raw data</span>
  <span class='comment val'># which MUST be in correct SMTP body format, including a trailing dot line), or a header and</span>
  <span class='comment val'># body given in @args[:header] and @args[:body].</span>
  <span class='comment val'>#</span>
  <span class='if if kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='content identifier id'>content</span><span class='rbrack token'>]</span>
    <span class='send_data identifier id'>send_data</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:content</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># The header can be a hash or an array.</span>
    <span class='if if kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='header identifier id'>header</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
      <span class='lparen token'>(</span><span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:header</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;#{k}: #{v}\r\n&quot;</span> <span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='send_data identifier id'>send_data</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:header</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='end end kw'>end</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;\r\n&quot;</span>

    <span class='if if kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='body identifier id'>body</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
      <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='e identifier id'>e</span><span class='bitor op'>|</span> <span class='send_data identifier id'>send_data</span> <span class='e identifier id'>e</span><span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='send_data identifier id'>send_data</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='end end kw'>end</span>

    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;\r\n.\r\n&quot;</span>
  <span class='end end kw'>end</span>

  <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_message_response</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_ehlo_response</h3>
</div><div id="receive_ehlo_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_ehlo_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 206</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L206">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">206
207
208
209
210</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_ehlo_response identifier id'>receive_ehlo_response</span>
  <span class='return return kw'>return</span> <span class='invoke_error identifier id'>invoke_error</span> <span class='unless unless_mod kw'>unless</span> <span class='@range ivar id'>@range</span> <span class='eq op'>==</span> <span class='integer val'>2</span>
  <span class='@server_caps ivar id'>@server_caps</span> <span class='assign token'>=</span> <span class='@msg ivar id'>@msg</span>
  <span class='invoke_starttls identifier id'>invoke_starttls</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_line</h3>
</div><div id="receive_line-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_line</span><span class='args'>(ln)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 162</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L162">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">162
163
164
165
166
167
168
169
170
171
172</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_line identifier id'>receive_line</span> <span class='ln identifier id'>ln</span>
  <span class='$&gt; gvar id'>$&gt;</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='ln identifier id'>ln</span> <span class='if if_mod kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:verbose</span><span class='rbrack token'>]</span>
  <span class='@range ivar id'>@range</span> <span class='assign token'>=</span> <span class='ln identifier id'>ln</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='@code ivar id'>@code</span> <span class='assign token'>=</span> <span class='ln identifier id'>ln</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='@msg ivar id'>@msg</span> <span class='lshft op'>&lt;&lt;</span> <span class='ln identifier id'>ln</span><span class='lbrack token'>[</span><span class='float val'>4</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
  <span class='unless unless kw'>unless</span> <span class='ln identifier id'>ln</span><span class='lbrack token'>[</span><span class='float val'>3</span><span class='dot3 op'>...</span><span class='integer val'>4</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'-'</span>
    <span class='$&gt; gvar id'>$&gt;</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='@responder ivar id'>@responder</span> <span class='if if_mod kw'>if</span> <span class='@args ivar id'>@args</span><span class='lbrack token'>[</span><span class='symbol val'>:verbose</span><span class='rbrack token'>]</span>
    <span class='send identifier id'>send</span> <span class='@responder ivar id'>@responder</span>
    <span class='@msg ivar id'>@msg</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_mail_from_response</h3>
</div><div id="receive_mail_from_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_mail_from_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 257</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L257">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">257
258
259
260</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_mail_from_response identifier id'>receive_mail_from_response</span>
  <span class='return return kw'>return</span> <span class='invoke_error identifier id'>invoke_error</span> <span class='unless unless_mod kw'>unless</span> <span class='@range ivar id'>@range</span> <span class='eq op'>==</span> <span class='integer val'>2</span>
  <span class='invoke_rcpt_to identifier id'>invoke_rcpt_to</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_message_response</h3>
</div><div id="receive_message_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_message_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 316</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L316">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">316
317
318
319
320
321
322
323
324
325
326</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_message_response identifier id'>receive_message_response</span>
  <span class='return return kw'>return</span> <span class='invoke_error identifier id'>invoke_error</span> <span class='unless unless_mod kw'>unless</span> <span class='@range ivar id'>@range</span> <span class='eq op'>==</span> <span class='integer val'>2</span>
  <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;QUIT\r\n&quot;</span>
  <span class='close_connection_after_writing identifier id'>close_connection_after_writing</span>
  <span class='@succeeded ivar id'>@succeeded</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='elapsed_time identifier id'>elapsed_time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='start_time identifier id'>start_time</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='responder identifier id'>responder</span> <span class='assign token'>=</span> <span class='@responder ivar id'>@responder</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='@code ivar id'>@code</span>
  <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='@msg ivar id'>@msg</span>
  <span class='set_deferred_status identifier id'>set_deferred_status</span> <span class='symbol val'>:succeeded</span><span class='comma token'>,</span> <span class='@return_values ivar id'>@return_values</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_rcpt_to_response</h3>
</div><div id="receive_rcpt_to_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_rcpt_to_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 278</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L278">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">278
279
280
281</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_rcpt_to_response identifier id'>receive_rcpt_to_response</span>
  <span class='@rcpt_responses ivar id'>@rcpt_responses</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='@code ivar id'>@code</span><span class='comma token'>,</span> <span class='@msg ivar id'>@msg</span><span class='comma token'>,</span> <span class='@range ivar id'>@range</span><span class='rbrack token'>]</span>
  <span class='invoke_rcpt_to identifier id'>invoke_rcpt_to</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_signon</h3>
</div><div id="receive_signon-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_signon</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 200</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L200">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">200
201
202
203
204</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_signon identifier id'>receive_signon</span>
  <span class='return return kw'>return</span> <span class='invoke_error identifier id'>invoke_error</span> <span class='unless unless_mod kw'>unless</span> <span class='@range ivar id'>@range</span> <span class='eq op'>==</span> <span class='integer val'>2</span>
  <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;EHLO #{@args[:domain]}\r\n&quot;</span>
  <span class='@responder ivar id'>@responder</span> <span class='assign token'>=</span> <span class='symbol val'>:receive_ehlo_response</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_starttls_response</h3>
</div><div id="receive_starttls_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_starttls_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 222</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L222">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">222
223
224
225
226</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_starttls_response identifier id'>receive_starttls_response</span>
  <span class='return return kw'>return</span> <span class='invoke_error identifier id'>invoke_error</span> <span class='unless unless_mod kw'>unless</span> <span class='@range ivar id'>@range</span> <span class='eq op'>==</span> <span class='integer val'>2</span>
  <span class='start_tls identifier id'>start_tls</span>
  <span class='invoke_auth identifier id'>invoke_auth</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>unbind</h3>
</div><div id="unbind-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>unbind</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
We can get here in a variety of ways, all of them being failures unless the
@succeeded flag is set. If a protocol success was recorded, then
don&#8217;t set a deferred success because the caller will already have
done it (no need to wait until the connection closes to invoke the
callbacks).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/em/protocols/smtpclient.rb', line 152</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/eventmachine/blob/master/lib/em/protocols/smtpclient.rb#L152">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">152
153
154
155
156
157
158
159
160</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='unbind identifier id'>unbind</span>
  <span class='unless unless kw'>unless</span> <span class='@succeeded ivar id'>@succeeded</span>
    <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='elapsed_time identifier id'>elapsed_time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='start_time identifier id'>start_time</span>
    <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='responder identifier id'>responder</span> <span class='assign token'>=</span> <span class='@responder ivar id'>@responder</span>
    <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='@code ivar id'>@code</span>
    <span class='@return_values ivar id'>@return_values</span><span class='dot token'>.</span><span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='@msg ivar id'>@msg</span>
    <span class='set_deferred_status identifier id'>set_deferred_status</span><span class='lparen token'>(</span><span class='symbol val'>:failed</span><span class='comma token'>,</span> <span class='@return_values ivar id'>@return_values</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>  
                  
      <div id="footer">
        <div class="site">
          <div class="info">
            <div class="links">
              <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
              <a href="http://github.com/blog">Blog</a> |
              <a href="http://support.github.com/">Support</a> |
              <a href="http://github.com/training">Training</a> |
              <a href="http://github.com/contact">Contact</a> |
              <a href="http://groups.google.com/group/github/">Google Group</a> |
              <a href="http://develop.github.com/">API</a> |
              <a href="http://twitter.com/github">Status</a>
            </div>
            <div class="company">
              <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
              is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
            </div>
          </div>
          <div class="sponsor">
            <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
            <div>
              Hosting provided by our<br> partners at Engine Yard
            </div>
          </div>
        </div>
      </div>
      
      <div id="coming_soon" style="display: none;">
        This feature is coming soon.  Sit tight!
      </div>

      <div id="facebox" style="display: none;">       
        <div class="popup">         
          <table>           
            <tbody>             
              <tr>               
                <td class="tl"></td>
                <td class="b"></td>
                <td class="tr"></td>             
              </tr>             
            <tr>               
              <td class="b"></td>               
              <td class="body">                 
                <div class="content"></div>                 
                <div class="footer">                   
                  <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
                </div>               
              </td>               
              <td class="b"></td>             
            </tr>             
            <tr>               
              <td class="bl"></td>
              <td class="b"></td>
              <td class="br"></td>             
            </tr>           
          </tbody>         
        </table>       
      </div>     
    </div>
    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8555229-2");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>