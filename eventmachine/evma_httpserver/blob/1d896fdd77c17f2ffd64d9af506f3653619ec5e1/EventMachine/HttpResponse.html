<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>eventmachine's evma_httpserver - Class: EventMachine::HttpResponse - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/eventmachine/commits/evma_httpserver/master" rel="alternate" title="Recent Commits to evma_httpserver:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("eventmachine", "evma_httpserver", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("eventmachine", "evma_httpserver", "1d896fdd77c17f2ffd64d9af506f3653619ec5e1", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/eventmachine/evma_httpserver/tree/">Source</a></li>
            <li class=""><a href="http://github.com/eventmachine/evma_httpserver/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/eventmachine/evma_httpserver/network">Network</a></li>            
            <li class=""><a href="http://github.com/eventmachine/evma_httpserver/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/eventmachine/evma_httpserver">Wiki</a></li>
            <li class=""><a href="http://github.com/eventmachine/evma_httpserver/graphs">Graphs</a></li>                    
            <li class="active"><a href="/eventmachine/evma_httpserver">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/eventmachine">eventmachine</a> / <b><a href="http://github.com/eventmachine/evma_httpserver/tree">evma_httpserver</a></b>        
                <a id="namespaces_button" rel="eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class EventMachine_HttpResponse">
  <h1>Class: EventMachine::HttpResponse</h1>
  <div class="section docstring">
  <p>
This class provides a wide variety of features for generating and
dispatching HTTP responses. It allows you to conveniently generate headers
and content (including chunks and multiparts), and dispatch responses
(including deferred or partially-complete responses).
</p>
<p>
Although HttpResponse is coded as a class, it&#8217;s not complete as it
stands. It assumes that it has certain of the behaviors of
EventMachine::Connection. You must add these behaviors, either by
subclassing HttpResponse, or using the alternate version of this class,
DelegatedHttpResponse. See the test cases for current information on which
behaviors you have to add.
</p>
<p>
TODO, someday it would be nice to provide a version of this functionality
that is coded as a Module, so it can simply be mixed into an instance of
EventMachine::Connection.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">chunks</td>
          <td class="readwrite">
            [<span id='chunks-instance_method'>R</span><span id='chunks=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>chunks</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">content</td>
          <td class="readwrite">
            [<span id='content-instance_method'>R</span><span id='content=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>content</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">headers</td>
          <td class="readwrite">
            [<span id='headers-instance_method'>R</span><span id='headers=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>headers</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">multiparts</td>
          <td class="readwrite">
            [<span id='multiparts-instance_method'>R</span><span id='multiparts=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>multiparts</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">status</td>
          <td class="readwrite">
            [<span id='status-instance_method'>R</span><span id='status=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>status</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 54</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L54">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">54
55
56</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
  <span class='@headers ivar id'>@headers</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#concoct_multipart_boundary-class_method">concoct_multipart_boundary</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO, this is going to be way too slow.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add_set_cookie-instance_method">#add_set_cookie</span><span class='args'>(*ck)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sugaring for Set-cookie headers.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#chunk-instance_method">#chunk</span><span class='args'>(text)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
add a chunk to go to the output.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#content_type-instance_method">#content_type</span><span class='args'>(*mime)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
sugarings for headers.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fixup_headers-instance_method">#fixup_headers</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Examine the content type and data and other things, and perform a final
fixup of the header array.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#keep_connection_open-instance_method">#keep_connection_open</span><span class='args'>(arg = true)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#multipart-instance_method">#multipart</span><span class='args'>(arg)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
To add a multipart to the outgoing response, specify the headers and the
body.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_body-instance_method">#send_body</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
we send either content, chunks, or multiparts.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_chunks-instance_method">#send_chunks</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
send the contents of the chunk list and clear it out.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_content-instance_method">#send_content</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_headers-instance_method">#send_headers</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Send the headers out in alpha-sorted order.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_multiparts-instance_method">#send_multiparts</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Multipart syntax is defined in RFC 2046, pgh 5.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_redirect-instance_method">#send_redirect</span><span class='args'>(location)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_response-instance_method">#send_response</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This is intended to send a complete HTTP response, including closing the
connection if appropriate at the end of the transmission.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_trailer-instance_method">#send_trailer</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
send a trailer which depends on the type of body we&#8217;re dealing with.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_cookie-instance_method">#set_cookie</span><span class='args'>(*ck)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>concoct_multipart_boundary</h3>
</div><div id="concoct_multipart_boundary-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>concoct_multipart_boundary</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO, this is going to be way too slow. Cache up the uuidgens.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 276</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L276">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">276
277
278
279
280
281
282
283
284
285</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='concoct_multipart_boundary identifier id'>concoct_multipart_boundary</span>
  <span class='@multipart_index ivar id'>@multipart_index</span> <span class='opasgn op'>||=</span> <span class='integer val'>0</span>
  <span class='@multipart_index ivar id'>@multipart_index</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
  <span class='if if kw'>if</span> <span class='@multipart_index ivar id'>@multipart_index</span> <span class='geq op'>&gt;=</span> <span class='integer val'>1000</span>
    <span class='@multipart_index ivar id'>@multipart_index</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='@multipart_guid ivar id'>@multipart_guid</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
  <span class='@multipart_guid ivar id'>@multipart_guid</span> <span class='opasgn op'>||=</span> <span class='xstring val'>`uuidgen -r`</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/\-/</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span>
  <span class='dstring node'>&quot;#{@multipart_guid}#{@multipart_index}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>add_set_cookie</h3>
</div><div id="add_set_cookie-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_set_cookie</span><span class='args'>(*ck)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sugaring for Set-cookie headers. These are a pain because there can easily
and legitimately be more than one. So we use an ugly verb to signify that.
#add_set_cookies does NOT disturb the set-cookie headers which may have
been added on a prior call. #set_cookie clears them out first.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 75</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L75">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">75
76
77
78
79
80</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='add_set_cookie identifier id'>add_set_cookie</span> <span class='mult op'>*</span><span class='ck identifier id'>ck</span>
  <span class='if if kw'>if</span> <span class='ck identifier id'>ck</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Set-cookie&quot;</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='ck identifier id'>ck</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span> <span class='lshft op'>&lt;&lt;</span> <span class='c identifier id'>c</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>chunk</h3>
</div><div id="chunk-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>chunk</span><span class='args'>(text)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
add a chunk to go to the output. Will cause the headers to pick up
&quot;content-transfer-encoding&quot; Add the chunk to a list. Calling
#send_chunks will send out the available chunks and clear the chunk list
WITHOUT closing the connection, so it can be called any number of times.
TODO!!! Per RFC2616, we may not send chunks to an HTTP/1.0 client. Raise an
exception here if our user tries to do so. Chunked transfer coding is
defined in RFC2616 pgh 3.6.1. The argument can be a string or a hash. The
latter allows for sending chunks with extensions (someday).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 216</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L216">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">216
217
218
219</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='chunk identifier id'>chunk</span> <span class='text identifier id'>text</span>
  <span class='@chunks ivar id'>@chunks</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@chunks ivar id'>@chunks</span> <span class='lshft op'>&lt;&lt;</span> <span class='text identifier id'>text</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>content_type</h3>
</div><div id="content_type-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>content_type</span><span class='args'>(*mime)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
sugarings for headers
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 63</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L63">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">63
64
65
66
67
68
69</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='content_type identifier id'>content_type</span> <span class='mult op'>*</span><span class='mime identifier id'>mime</span>
  <span class='if if kw'>if</span> <span class='mime identifier id'>mime</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Content-type&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='mime identifier id'>mime</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='else else kw'>else</span>
    <span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Content-type&quot;</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fixup_headers</h3>
</div><div id="fixup_headers-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fixup_headers</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Examine the content type and data and other things, and perform a final
fixup of the header array. We expect this to be called just before sending
headers to the remote peer. In the case of multiparts, we ASSUME we will
get called before any content gets sent out, because the multipart boundary
is created here.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 143</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L143">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">143
144
145
146
147
148
149
150
151
152
153
154
155
156</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fixup_headers identifier id'>fixup_headers</span>
  <span class='if if kw'>if</span> <span class='@content ivar id'>@content</span>
    <span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Content-length&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='@content ivar id'>@content</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@chunks ivar id'>@chunks</span>
    <span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Transfer-encoding&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;chunked&quot;</span>
    <span class='comment val'># Might be nice to ENSURE there is no content-length header,</span>
    <span class='comment val'># but how to detect all the possible permutations of upper/lower case?</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@multiparts ivar id'>@multiparts</span>
    <span class='@multipart_boundary ivar id'>@multipart_boundary</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='concoct_multipart_boundary identifier id'>concoct_multipart_boundary</span>
    <span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Content-type&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;multipart/x-mixed-replace; boundary=\&quot;#{@multipart_boundary}\&quot;&quot;</span>
  <span class='else else kw'>else</span>
    <span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Content-length&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>keep_connection_open</h3>
</div><div id="keep_connection_open-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>keep_connection_open</span><span class='args'>(arg = true)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 58</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L58">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">58
59
60</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='keep_connection_open identifier id'>keep_connection_open</span> <span class='arg identifier id'>arg</span><span class='assign token'>=</span><span class='true true kw'>true</span>
  <span class='@keep_connection_open ivar id'>@keep_connection_open</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>multipart</h3>
</div><div id="multipart-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>multipart</span><span class='args'>(arg)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
To add a multipart to the outgoing response, specify the headers and the
body. If only a string is given, it&#8217;s treated as the body (in this
case, the header is assumed to be empty).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 247</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L247">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">247
248
249
250
251
252
253
254
255
256</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='multipart identifier id'>multipart</span> <span class='arg identifier id'>arg</span>
  <span class='vals identifier id'>vals</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='lbrace token'>{</span><span class='symbol val'>:body</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='arg identifier id'>arg</span><span class='comma token'>,</span> <span class='symbol val'>:headers</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='arg identifier id'>arg</span>
  <span class='end end kw'>end</span>

  <span class='@multiparts ivar id'>@multiparts</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@multiparts ivar id'>@multiparts</span> <span class='lshft op'>&lt;&lt;</span> <span class='vals identifier id'>vals</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_body</h3>
</div><div id="send_body-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_body</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
we send either content, chunks, or multiparts. Content can only be sent
once. Chunks and multiparts can be sent any number of times. DO NOT close
the connection or send any goodbye kisses. This method can be called
multiple times to send out chunks or multiparts.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 162</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L162">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">162
163
164
165
166
167
168
169
170
171
172
173</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_body identifier id'>send_body</span>
  <span class='if if kw'>if</span> <span class='@content ivar id'>@content</span>
    <span class='send_content identifier id'>send_content</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@chunks ivar id'>@chunks</span>
    <span class='send_chunks identifier id'>send_chunks</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@multiparts ivar id'>@multiparts</span>
    <span class='send_multiparts identifier id'>send_multiparts</span>
  <span class='else else kw'>else</span>
    <span class='@content ivar id'>@content</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
    <span class='send_content identifier id'>send_content</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_chunks</h3>
</div><div id="send_chunks-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_chunks</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
send the contents of the chunk list and clear it out. ASSUMES that headers
have been sent. Does NOT close the connection. Can be called multiple
times. According to RFC2616, phg 3.6.1, the last chunk will be zero length.
But some caller could accidentally set a zero-length chunk in the middle of
the stream. If that should happen, raise an exception. The reason for
supporting chunks that are hashes instead of just strings is to enable
someday supporting chunk-extension codes (cf the RFC). TODO!!! We&#8217;re
not supporting the final entity-header that may be transmitted after the
last (zero-length) chunk.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 233</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L233">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">233
234
235
236
237
238
239
240
241</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_chunks identifier id'>send_chunks</span>
  <span class='send_headers identifier id'>send_headers</span> <span class='unless unless_mod kw'>unless</span> <span class='@sent_headers ivar id'>@sent_headers</span>
  <span class='while while kw'>while</span> <span class='chunk identifier id'>chunk</span> <span class='assign token'>=</span> <span class='@chunks ivar id'>@chunks</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
    <span class='raise identifier id'>raise</span> <span class='string val'>&quot;last chunk already sent&quot;</span> <span class='if if_mod kw'>if</span> <span class='@last_chunk_sent ivar id'>@last_chunk_sent</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='chunk identifier id'>chunk</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='chunk identifier id'>chunk</span><span class='lbrack token'>[</span><span class='symbol val'>:text</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='chunk identifier id'>chunk</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;#{format(&quot;%x&quot;, text.length).upcase}\r\n#{text}\r\n&quot;</span>
    <span class='@last_chunk_sent ivar id'>@last_chunk_sent</span> <span class='assign token'>=</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='text identifier id'>text</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_content</h3>
</div><div id="send_content-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_content</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 199</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L199">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">199
200
201
202
203</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_content identifier id'>send_content</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;sent content already&quot;</span> <span class='if if_mod kw'>if</span> <span class='@sent_content ivar id'>@sent_content</span>
  <span class='@sent_content ivar id'>@sent_content</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='send_data identifier id'>send_data</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='@content ivar id'>@content</span> <span class='orop op'>||</span> <span class='string val'>&quot;&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_headers</h3>
</div><div id="send_headers-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_headers</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Send the headers out in alpha-sorted order. This will degrade performance
to some degree, and is intended only to simplify the construction of unit
tests.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 107</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L107">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">107
108
109
110
111
112
113
114
115
116
117
118
119</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_headers identifier id'>send_headers</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;sent headers already&quot;</span> <span class='if if_mod kw'>if</span> <span class='@sent_headers ivar id'>@sent_headers</span>
  <span class='@sent_headers ivar id'>@sent_headers</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>

  <span class='fixup_headers identifier id'>fixup_headers</span>

  <span class='ary identifier id'>ary</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='ary identifier id'>ary</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;HTTP/1.1 #{@status || 200} ...\r\n&quot;</span>
  <span class='ary identifier id'>ary</span> <span class='opasgn op'>+=</span> <span class='generate_header_lines identifier id'>generate_header_lines</span><span class='lparen token'>(</span><span class='@headers ivar id'>@headers</span><span class='rparen token'>)</span>
  <span class='ary identifier id'>ary</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;\r\n&quot;</span>

  <span class='send_data identifier id'>send_data</span> <span class='ary identifier id'>ary</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_multiparts</h3>
</div><div id="send_multiparts-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_multiparts</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Multipart syntax is defined in RFC 2046, pgh 5.1.1 et seq. The CRLF which
introduces the boundary line of each part (content entity) is defined as
being part of the boundary, not of the preceding part. So we don&#8217;t
need to mess with interpreting the last bytes of a part to ensure they are
CRLF-terminated.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 264</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L264">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">264
265
266
267
268
269
270
271
272</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_multiparts identifier id'>send_multiparts</span>
  <span class='send_headers identifier id'>send_headers</span> <span class='unless unless_mod kw'>unless</span> <span class='@sent_headers ivar id'>@sent_headers</span>
  <span class='while while kw'>while</span> <span class='part identifier id'>part</span> <span class='assign token'>=</span> <span class='@multiparts ivar id'>@multiparts</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
    <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;\r\n--#{@multipart_boundary}\r\n&quot;</span>
    <span class='send_data identifier id'>send_data</span><span class='lparen token'>(</span> <span class='generate_header_lines identifier id'>generate_header_lines</span><span class='lparen token'>(</span> <span class='part identifier id'>part</span><span class='lbrack token'>[</span><span class='symbol val'>:headers</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='rparen token'>)</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='rparen token'>)</span>
    <span class='send_data identifier id'>send_data</span> <span class='string val'>&quot;\r\n&quot;</span>
    <span class='send_data identifier id'>send_data</span> <span class='part identifier id'>part</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_redirect</h3>
</div><div id="send_redirect-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_redirect</span><span class='args'>(location)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 287</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L287">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">287
288
289
290
291</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_redirect identifier id'>send_redirect</span> <span class='location identifier id'>location</span>
  <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='integer val'>302</span> <span class='comment val'># TODO, make 301 available by parameter</span>
  <span class='@headers ivar id'>@headers</span><span class='lbrack token'>[</span><span class='string val'>&quot;Location&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='location identifier id'>location</span>
  <span class='send_response identifier id'>send_response</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_response</h3>
</div><div id="send_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_response</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This is intended to send a complete HTTP response, including closing the
connection if appropriate at the end of the transmission. Don&#8217;t use
this method to send partial or iterated responses. This method will send
chunks and multiparts provided they are all available when we get here.
Note that the default @status is 200 if the value doesn&#8217;t exist.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 97</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L97">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">97
98
99
100
101
102</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_response identifier id'>send_response</span>
  <span class='send_headers identifier id'>send_headers</span>
  <span class='send_body identifier id'>send_body</span>
  <span class='send_trailer identifier id'>send_trailer</span>
  <span class='close_connection_after_writing identifier id'>close_connection_after_writing</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='@keep_connection_open ivar id'>@keep_connection_open</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='@status ivar id'>@status</span> <span class='orop op'>||</span> <span class='integer val'>200</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>200</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_trailer</h3>
</div><div id="send_trailer-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_trailer</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
send a trailer which depends on the type of body we&#8217;re dealing with.
The assumption is that we&#8217;re about to end the transmission of this
particular HTTP response. (A connection-close may or may not follow.)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 179</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L179">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_trailer identifier id'>send_trailer</span>
  <span class='send_headers identifier id'>send_headers</span> <span class='unless unless_mod kw'>unless</span> <span class='@sent_headers ivar id'>@sent_headers</span>
  <span class='if if kw'>if</span> <span class='@content ivar id'>@content</span>
    <span class='comment val'># no-op</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@chunks ivar id'>@chunks</span>
    <span class='unless unless kw'>unless</span> <span class='@last_chunk_sent ivar id'>@last_chunk_sent</span>
      <span class='chunk identifier id'>chunk</span> <span class='string val'>&quot;&quot;</span>
      <span class='send_chunks identifier id'>send_chunks</span>
    <span class='end end kw'>end</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@multiparts ivar id'>@multiparts</span>
    <span class='comment val'># in the lingo of RFC 2046/5.1.1, we're sending an &quot;epilog&quot;</span>
    <span class='comment val'># consisting of a blank line. I really don't know how that is</span>
    <span class='comment val'># supposed to interact with the case where we leave the connection</span>
    <span class='comment val'># open after transmitting the multipart response.</span>
    <span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;\r\n--#{@multipart_boundary}--\r\n\r\n&quot;</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># no-op</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_cookie</h3>
</div><div id="set_cookie-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_cookie</span><span class='args'>(*ck)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/evma_httpserver/response.rb', line 81</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/eventmachine/evma_httpserver/blob/1d896fdd77c17f2ffd64d9af506f3653619ec5e1/lib/evma_httpserver/response.rb#L81">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">81
82
83
84
85
86
87
88
89</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set_cookie identifier id'>set_cookie</span> <span class='mult op'>*</span><span class='ck identifier id'>ck</span>
  <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='@headers ivar id'>@headers</span> <span class='lbrack token'>[</span><span class='string val'>&quot;Set-cookie&quot;</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='ck identifier id'>ck</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='h identifier id'>h</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
    <span class='add_set_cookie identifier id'>add_set_cookie</span> <span class='mult op'>*</span><span class='ck identifier id'>ck</span>
  <span class='else else kw'>else</span>
    <span class='h identifier id'>h</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>