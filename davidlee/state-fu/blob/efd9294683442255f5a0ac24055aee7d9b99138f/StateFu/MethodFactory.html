<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>davidlee's state-fu - Class: StateFu::MethodFactory - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/davidlee/commits/state-fu/master" rel="alternate" title="Recent Commits to state-fu:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("davidlee", "state-fu", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("davidlee", "state-fu", "efd9294683442255f5a0ac24055aee7d9b99138f", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/davidlee/state-fu/tree/">Source</a></li>
            <li class=""><a href="http://github.com/davidlee/state-fu/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/davidlee/state-fu/network">Network</a></li>            
            <li class=""><a href="http://github.com/davidlee/state-fu/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/davidlee/state-fu">Wiki</a></li>
            <li class=""><a href="http://github.com/davidlee/state-fu/graphs">Graphs</a></li>                    
            <li class="active"><a href="/davidlee/state-fu">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/davidlee">davidlee</a> / <b><a href="http://github.com/davidlee/state-fu/tree">state-fu</a></b>        
                <a id="namespaces_button" rel="davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class StateFu_MethodFactory">
  <h1>Class: StateFu::MethodFactory</h1>
  <div class="section docstring">
  <p>
This class is responsible for defining methods at runtime.
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(_binding)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
An instance of MethodFactory is created to define methods on a specific
StateFu::Binding, and the object it is bound to.
</p>
<p>
During the initializer, it will call define_event_methods_on(the binding),
which installs
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/state_fu/method_factory.rb', line 14</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f/lib/state_fu/method_factory.rb#L14">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">14
15
16</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span> <span class='_binding identifier id'>_binding</span> <span class='rparen token'>)</span>
  <span class='@binding ivar id'>@binding</span> <span class='assign token'>=</span> <span class='_binding identifier id'>_binding</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#define_once_only_method_missing-class_method">define_once_only_method_missing</span><span class='args'>(klass)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
When triggered, method_missing will first call state_fu!, instantating all
bindings &amp; installing their attendant MethodFactories, then check if
the object now responds to the missing method name; otherwise it will call
the original method_missing.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#define_singleton_method-class_method">define_singleton_method</span><span class='args'>(object, method_name, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
define a a method on the metaclass of the given object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#prepare_class-class_method">prepare_class</span><span class='args'>(klass)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Class Methods.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#define_event_methods_on-instance_method">#define_event_methods_on</span><span class='args'>(obj)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
For each event, on the given object, define three methods.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#install-21-instance_method">#install!</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Define the same helper methods on the StateFu::Binding and its object.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>define_once_only_method_missing</h3>
</div><div id="define_once_only_method_missing-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>define_once_only_method_missing</span><span class='args'>(klass)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
When triggered, method_missing will first call state_fu!, instantating all
bindings &amp; installing their attendant MethodFactories, then check if
the object now responds to the missing method name; otherwise it will call
the original method_missing.
</p>
<p>
method_missing will then revert to its original implementation.
</p>
<p>
The purpose of all this is to allow dynamically created methods to be
called, without worrying about whether they have been defined yet, and
without incurring the expense of loading all the object&#8217;s
StateFu::Bindings before they&#8217;re likely to be needed.
</p>
<p>
Note that if you redefine method_missing on your StateFul classes,
it&#8217;s best to either do it before you include StateFu, or thoroughly
understand what&#8217;s happening in
MethodFactory#define_once_only_method_missing.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/state_fu/method_factory.rb', line 53</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f/lib/state_fu/method_factory.rb#L53">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='define_once_only_method_missing identifier id'>define_once_only_method_missing</span><span class='lparen token'>(</span> <span class='klass identifier id'>klass</span> <span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='instance_methods identifier id'>instance_methods</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:to_sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='symbol val'>:method_missing_before_state_fu</span>
  <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='class_eval identifier id'>class_eval</span> <span class='do do kw'>do</span>
    <span class='alias_method identifier id'>alias_method</span> <span class='symbol val'>:method_missing_before_state_fu</span><span class='comma token'>,</span> <span class='symbol val'>:method_missing</span>
    <span class='def def kw'>def</span> <span class='method_missing identifier id'>method_missing</span><span class='lparen token'>(</span> <span class='method_name identifier id'>method_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span> <span class='rparen token'>)</span>
      <span class='comment val'># invoke state_fu! to define methods</span>
      <span class='state_fu! fid id'>state_fu!</span>
      <span class='comment val'># reset method_missing for this instance</span>
      <span class='comment val'># more for tidy stack traces than anything else</span>
      <span class='comment val'># TODO - benchmark with presence / absence of this reset</span>
      <span class='metaclass identifier id'>metaclass</span> <span class='assign token'>=</span> <span class='class class kw'>class</span> <span class='lshft op'>&lt;&lt;</span> <span class='self self kw'>self</span><span class='semicolon token'>;</span> <span class='self self kw'>self</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>
      <span class='metaclass identifier id'>metaclass</span><span class='dot token'>.</span><span class='instance_eval identifier id'>instance_eval</span> <span class='do do kw'>do</span>
        <span class='alias_method identifier id'>alias_method</span> <span class='symbol val'>:method_missing</span><span class='comma token'>,</span> <span class='symbol val'>:method_missing_before_state_fu</span>
      <span class='end end kw'>end</span>
      <span class='comment val'># call the newly defined method, or the original method_missing</span>
      <span class='if if kw'>if</span> <span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span> <span class='method_name identifier id'>method_name</span> <span class='rparen token'>)</span> <span class='comment val'># it was defined by calling state_fu!</span>
        <span class='send identifier id'>send</span><span class='lparen token'>(</span> <span class='method_name identifier id'>method_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span> <span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='method_missing_before_state_fu identifier id'>method_missing_before_state_fu</span><span class='lparen token'>(</span> <span class='method_name identifier id'>method_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span> <span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span> <span class='comment val'># method_missing</span>
  <span class='end end kw'>end</span> <span class='comment val'># class_eval</span>
<span class='end end kw'>end</span> <span class='comment val'># define_once_only_method_missing</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>define_singleton_method</h3>
</div><div id="define_singleton_method-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>define_singleton_method</span><span class='args'>(object, method_name, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
define a a method on the metaclass of the given object. The resulting
&quot;singleton method&quot; will be unique to that instance, not shared by
other instances of its class.
</p>
<p>
This allows us to embed a reference to the instance&#8217;s unique binding
in the new method.
</p>
<p>
existing methods will never be overwritten.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/state_fu/method_factory.rb', line 176</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f/lib/state_fu/method_factory.rb#L176">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">176
177
178
179
180
181
182
183
184
185</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='define_singleton_method identifier id'>define_singleton_method</span><span class='lparen token'>(</span> <span class='object identifier id'>object</span><span class='comma token'>,</span> <span class='method_name identifier id'>method_name</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span> <span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='object identifier id'>object</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span> <span class='method_name identifier id'>method_name</span> <span class='rparen token'>)</span>
    <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Existing method #{method_name} for #{object.class} will NOT be overwritten.&quot;</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='metaclass identifier id'>metaclass</span>   <span class='assign token'>=</span> <span class='class class kw'>class</span> <span class='lshft op'>&lt;&lt;</span> <span class='object identifier id'>object</span><span class='semicolon token'>;</span> <span class='self self kw'>self</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>
    <span class='metaclass identifier id'>metaclass</span><span class='dot token'>.</span><span class='class_eval identifier id'>class_eval</span> <span class='do do kw'>do</span>
      <span class='define_method identifier id'>define_method</span><span class='lparen token'>(</span> <span class='method_name identifier id'>method_name</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>prepare_class</h3>
</div><div id="prepare_class-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>prepare_class</span><span class='args'>(klass)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Class Methods
</p>
<p>
This should be called once per class using StateFu. It aliases and
redefines method_missing for the class.
</p>
<p>
Note this happens when a machine is first bound to the class, not when
StateFu is included.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/state_fu/method_factory.rb', line 28</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f/lib/state_fu/method_factory.rb#L28">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">28
29
30
31
32
33</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='prepare_class identifier id'>prepare_class</span><span class='lparen token'>(</span> <span class='klass identifier id'>klass</span> <span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Class constant id'>Class</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='NotImplementedError constant id'>NotImplementedError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;singleton machines are not yet supported&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='define_once_only_method_missing identifier id'>define_once_only_method_missing</span><span class='lparen token'>(</span> <span class='klass identifier id'>klass</span> <span class='rparen token'>)</span>
<span class='end end kw'>end</span> <span class='comment val'># prepare_class</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>define_event_methods_on</h3>
</div><div id="define_event_methods_on-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>define_event_methods_on</span><span class='args'>(obj)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
For each event, on the given object, define three methods.
</p>
<ul>
<li>The first method is the same as the event name. Returns a new, unfired
transition object.

</li>
<li>The second method has a &quot;?&quot; suffix. Returns true if the event can
be fired.

</li>
<li>The third method has a &quot;!&quot; suffix. Creates a new Transition,
fires and returns it once complete.

</li>
</ul>
<p>
The arguments expected depend on whether the event is &quot;simple&quot; -
ie, has only one possible target state.
</p>
<p>
All simple event methods pass their entire argument list directly to
transition. These arguments can be accessed inside event hooks,
requirements, etc by calling Transition#args.
</p>
<p>
All complex event methods require their first argument to be a Symbol
containing a valid target State&#8217;s name, or the State itself. The
remaining arguments are passed into the transition, as with simple event
methods.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/state_fu/method_factory.rb', line 106</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f/lib/state_fu/method_factory.rb#L106">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='define_event_methods_on identifier id'>define_event_methods_on</span><span class='lparen token'>(</span> <span class='obj identifier id'>obj</span> <span class='rparen token'>)</span>
  <span class='comment val'># store @binding in a local variable so it's accessible within</span>
  <span class='comment val'># the closures below (for define_singleton_method ).</span>

  <span class='comment val'># i.e, we're embedding a reference to @binding inside the method</span>

  <span class='_binding identifier id'>_binding</span>        <span class='assign token'>=</span> <span class='@binding ivar id'>@binding</span>
  <span class='simple identifier id'>simple</span><span class='comma token'>,</span> <span class='complex identifier id'>complex</span> <span class='assign token'>=</span> <span class='@binding ivar id'>@binding</span><span class='dot token'>.</span><span class='machine identifier id'>machine</span><span class='dot token'>.</span><span class='events identifier id'>events</span><span class='dot token'>.</span><span class='partition identifier id'>partition</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:simple?</span> <span class='rparen token'>)</span>

  <span class='comment val'># method definitions for simple events (only one possible target)</span>
  <span class='simple identifier id'>simple</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='event identifier id'>event</span><span class='bitor op'>|</span>

    <span class='comment val'># obj.event_name( *args )</span>
    <span class='comment val'># returns a new transition</span>
    <span class='method_name identifier id'>method_name</span> <span class='assign token'>=</span> <span class='event identifier id'>event</span><span class='dot token'>.</span><span class='name identifier id'>name</span>
    <span class='define_singleton_method identifier id'>define_singleton_method</span><span class='lparen token'>(</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='method_name identifier id'>method_name</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='bitor op'>|</span>
      <span class='_binding identifier id'>_binding</span><span class='dot token'>.</span><span class='transition identifier id'>transition</span><span class='lparen token'>(</span> <span class='event identifier id'>event</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># obj.event_name?()</span>
    <span class='comment val'># true if the event is fireable? (ie, requirements met)</span>
    <span class='method_name identifier id'>method_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{event.name}?&quot;</span>
    <span class='define_singleton_method identifier id'>define_singleton_method</span><span class='lparen token'>(</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='method_name identifier id'>method_name</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='_binding identifier id'>_binding</span><span class='dot token'>.</span><span class='fireable? fid id'>fireable?</span><span class='lparen token'>(</span> <span class='event identifier id'>event</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># obj.event_name!( *args )</span>
    <span class='comment val'># creates, fires and returns a transition</span>
    <span class='method_name identifier id'>method_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{event.name}!&quot;</span>
    <span class='define_singleton_method identifier id'>define_singleton_method</span><span class='lparen token'>(</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='method_name identifier id'>method_name</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='bitor op'>|</span>
      <span class='_binding identifier id'>_binding</span><span class='dot token'>.</span><span class='fire! fid id'>fire!</span><span class='lparen token'>(</span> <span class='event identifier id'>event</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span> <span class='comment val'># simple</span>
  <span class='comment val'># method definitions for complex events (target must be specified)</span>
  <span class='complex identifier id'>complex</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='event identifier id'>event</span><span class='bitor op'>|</span>
    <span class='comment val'># obj.event_name( target, *args )</span>
    <span class='comment val'># returns a new transition</span>
    <span class='define_singleton_method identifier id'>define_singleton_method</span><span class='lparen token'>(</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='event identifier id'>event</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='bitor op'>|</span>
      <span class='_binding identifier id'>_binding</span><span class='dot token'>.</span><span class='transition identifier id'>transition</span><span class='lparen token'>(</span> <span class='lbrack token'>[</span><span class='event identifier id'>event</span><span class='comma token'>,</span> <span class='target identifier id'>target</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># obj.event_name?( target )</span>
    <span class='comment val'># true if the event is fireable? (ie, requirements met)</span>
    <span class='method_name identifier id'>method_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{event.name}?&quot;</span>
    <span class='define_singleton_method identifier id'>define_singleton_method</span><span class='lparen token'>(</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='method_name identifier id'>method_name</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='bitor op'>|</span>
      <span class='_binding identifier id'>_binding</span><span class='dot token'>.</span><span class='fireable? fid id'>fireable?</span><span class='lparen token'>(</span> <span class='lbrack token'>[</span><span class='event identifier id'>event</span><span class='comma token'>,</span> <span class='target identifier id'>target</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># obj.event_name!( target, *args )</span>
    <span class='comment val'># creates, fires and returns a transition</span>
    <span class='method_name identifier id'>method_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{event.name}!&quot;</span>
    <span class='define_singleton_method identifier id'>define_singleton_method</span><span class='lparen token'>(</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='method_name identifier id'>method_name</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='bitor op'>|</span>
      <span class='_binding identifier id'>_binding</span><span class='dot token'>.</span><span class='fire! fid id'>fire!</span><span class='lparen token'>(</span> <span class='lbrack token'>[</span><span class='event identifier id'>event</span><span class='comma token'>,</span> <span class='target identifier id'>target</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span> <span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span> <span class='comment val'># complex</span>
<span class='end end kw'>end</span> <span class='comment val'># define_event_methods_on</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>install!</h3>
</div><div id="install-21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>install!</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Define the same helper methods on the StateFu::Binding and its object. Any
existing methods will not be tampered with, but a warning will be issued in
the logs if any methods cannot be defined.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/state_fu/method_factory.rb', line 80</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/davidlee/state-fu/blob/efd9294683442255f5a0ac24055aee7d9b99138f/lib/state_fu/method_factory.rb#L80">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">80
81
82
83</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='install! fid id'>install!</span>
  <span class='define_event_methods_on identifier id'>define_event_methods_on</span><span class='lparen token'>(</span> <span class='@binding ivar id'>@binding</span> <span class='rparen token'>)</span>
  <span class='define_event_methods_on identifier id'>define_event_methods_on</span><span class='lparen token'>(</span> <span class='@binding ivar id'>@binding</span><span class='dot token'>.</span><span class='object identifier id'>object</span> <span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>