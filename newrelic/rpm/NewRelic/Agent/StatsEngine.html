<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: NewRelic::Agent::StatsEngine</title>
  </head>
  <body>
    <div id="content">
      <div class="section class NewRelic_Agent_StatsEngine">
  <h1 class="title">Class: NewRelic::Agent::StatsEngine</h1>
  <div class="section inheritance">
  <ul>
  <li><a href='../../Object.html' title='Object'>Object</a></li><ul><li>NewRelic::Agent::StatsEngine</li>
  </ul></ul>
</div><div class="section attributes">
  <h1>Attributes</h1>

  
    <div class="instance">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">log</td>
          <td class="readwrite">
            [<span id='log-instance_method'>R</span><span id='log%3D-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>log</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h1>Constants</h1>
  <dl>
    
      <dt id="POLL_PERIOD-constant">POLL_PERIOD</dt>
      <dd>10</dd>
    
      <dt id="ScopeStackElement-constant">ScopeStackElement</dt>
      <dd>Struct.new(:name, :children_time, :deduct_call_time_from_parent)</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(log = Logger.new(STDERR))</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


21
22
23
24
25
26
27
28
29
30
31</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 21</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='log identifier id'>log</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='STDERR constant id'>STDERR</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='@stats_hash ivar id'>@stats_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@sampled_items ivar id'>@sampled_items</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='@log ivar id'>@log</span> <span class='assign token'>=</span> <span class='log identifier id'>log</span>
  
  <span class='comment val'># Makes the unit tests happy</span>
  <span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_scope_stack</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  
  <span class='spawn_sampler_thread identifier id'>spawn_sampler_thread</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_sampled_metric-instance_method' title='#add_sampled_metric'>#add_sampled_metric</a></span><span class='args'>(metric_name, &amp;sampler_callback)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_scope_stack_listener-instance_method' title='#add_scope_stack_listener'>#add_scope_stack_listener</a></span><span class='args'>(l)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#end_transaction-instance_method' title='#end_transaction'>#end_transaction</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Try to clean up gracefully, otherwise we leave things hanging around on
thread locals.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#get_stats-instance_method' title='#get_stats'>#get_stats</a></span><span class='args'>(metric_name, use_scope = true)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#get_stats_no_scope-instance_method' title='#get_stats_no_scope'>#get_stats_no_scope</a></span><span class='args'>(metric_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#harvest_timeslice_data-instance_method' title='#harvest_timeslice_data'>#harvest_timeslice_data</a></span><span class='args'>(previous_timeslice_data, metric_ids)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Note: this is not synchronized.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#lookup_stat-instance_method' title='#lookup_stat'>#lookup_stat</a></span><span class='args'>(metric_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#metrics-instance_method' title='#metrics'>#metrics</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#peek_scope-instance_method' title='#peek_scope'>#peek_scope</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#pop_scope-instance_method' title='#pop_scope'>#pop_scope</a></span><span class='args'>(expected_scope, duration, time=Time.now.to_f)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#push_scope-instance_method' title='#push_scope'>#push_scope</a></span><span class='args'>(metric, time = Time.now.to_f, deduct_call_time_from_parent = true)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#remove_scope_stack_listener-instance_method' title='#remove_scope_stack_listener'>#remove_scope_stack_listener</a></span><span class='args'>(l)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#spawn_sampler_thread-instance_method' title='#spawn_sampler_thread'>#spawn_sampler_thread</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#start_transaction-instance_method' title='#start_transaction'>#start_transaction</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#transaction_name-instance_method' title='#transaction_name'>#transaction_name</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
set the name of the transaction for the current thread, which will be used
to define the scope of all traced methods called on this thread until the
scope stack is empty.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h1>Public Instance Methods Inherited from <a href='../../Object.html' title='Object'>Object</a></h1>
    <p><span class='name'><a href='../../Object.html#new_relic_load-instance_method' title='new_relic_load'>new_relic_load</a></span>, <span class='name'><a href='../../Object.html#new_relic_require-instance_method' title='new_relic_require'>new_relic_require</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>add_sampled_metric</h3>
</div><div id="add_sampled_metric-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_sampled_metric</span><span class='args'>(metric_name, &amp;sampler_callback)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


109
110
111
112</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 109</span>

<span class='def def kw'>def</span> <span class='add_sampled_metric identifier id'>add_sampled_metric</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='sampler_callback identifier id'>sampler_callback</span><span class='rparen token'>)</span>
  <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='get_stats identifier id'>get_stats</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='@sampled_items ivar id'>@sampled_items</span> <span class='lshft op'>&lt;&lt;</span> <span class='SampledItem constant id'>SampledItem</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='stats identifier id'>stats</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='sampler_callback identifier id'>sampler_callback</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_scope_stack_listener</h3>
</div><div id="add_scope_stack_listener-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_scope_stack_listener</span><span class='args'>(l)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


59
60
61
62</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 59</span>

<span class='def def kw'>def</span> <span class='add_scope_stack_listener identifier id'>add_scope_stack_listener</span><span class='lparen token'>(</span><span class='l identifier id'>l</span><span class='rparen token'>)</span>
  <span class='fail identifier id'>fail</span> <span class='string val'>&quot;Can't add a scope listener midflight in a transaction&quot;</span> <span class='if if_mod kw'>if</span> <span class='scope_stack identifier id'>scope_stack</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
  <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span> <span class='assign token'>=</span>  <span class='l identifier id'>l</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>end_transaction</h3>
</div><div id="end_transaction-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>end_transaction</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Try to clean up gracefully, otherwise we leave things hanging around on
thread locals
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


223
224
225
226
227
228
229
230
231
232</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 223</span>

<span class='def def kw'>def</span> <span class='end_transaction identifier id'>end_transaction</span>
  <span class='stack identifier id'>stack</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_scope_stack</span><span class='rbrack token'>]</span>
  
  <span class='if if kw'>if</span> <span class='stack identifier id'>stack</span>
    <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span><span class='dot token'>.</span><span class='notice_scope_empty identifier id'>notice_scope_empty</span><span class='lparen token'>(</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> 
    <span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_scope_stack</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
  
  <span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_transaction_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_stats</h3>
</div><div id="get_stats-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_stats</span><span class='args'>(metric_name, use_scope = true)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 147</span>

<span class='def def kw'>def</span> <span class='get_stats identifier id'>get_stats</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='comma token'>,</span> <span class='use_scope identifier id'>use_scope</span> <span class='assign token'>=</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='metric_name identifier id'>metric_name</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='stats identifier id'>stats</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='MethodTraceStats constant id'>MethodTraceStats</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='metric_name identifier id'>metric_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='stats identifier id'>stats</span>
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='use_scope identifier id'>use_scope</span> <span class='andop op'>&amp;&amp;</span> <span class='transaction_name identifier id'>transaction_name</span>
    <span class='spec identifier id'>spec</span> <span class='assign token'>=</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='MetricSpec constant id'>MetricSpec</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='metric_name identifier id'>metric_name</span><span class='comma token'>,</span> <span class='transaction_name identifier id'>transaction_name</span>
    
    <span class='scoped_stats identifier id'>scoped_stats</span> <span class='assign token'>=</span> <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='spec identifier id'>spec</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='scoped_stats identifier id'>scoped_stats</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='scoped_stats identifier id'>scoped_stats</span> <span class='assign token'>=</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='ScopedMethodTraceStats constant id'>ScopedMethodTraceStats</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='stats identifier id'>stats</span>
      <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='spec identifier id'>spec</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='scoped_stats identifier id'>scoped_stats</span>        
    <span class='end end kw'>end</span>
    
    <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='scoped_stats identifier id'>scoped_stats</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='stats identifier id'>stats</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_stats_no_scope</h3>
</div><div id="get_stats_no_scope-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_stats_no_scope</span><span class='args'>(metric_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


138
139
140
141
142
143
144
145</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 138</span>

<span class='def def kw'>def</span> <span class='get_stats_no_scope identifier id'>get_stats_no_scope</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='rparen token'>)</span>
  <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='metric_name identifier id'>metric_name</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='stats identifier id'>stats</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='MethodTraceStats constant id'>MethodTraceStats</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='metric_name identifier id'>metric_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='stats identifier id'>stats</span>
  <span class='end end kw'>end</span>
  <span class='stats identifier id'>stats</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>harvest_timeslice_data</h3>
</div><div id="harvest_timeslice_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>harvest_timeslice_data</span><span class='args'>(previous_timeslice_data, metric_ids)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Note: this is not synchronized. There is still some risk in this and we
will revisit later to see if we can make this more robust without
sacrificing efficiency.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 171</span>

<span class='def def kw'>def</span> <span class='harvest_timeslice_data identifier id'>harvest_timeslice_data</span><span class='lparen token'>(</span><span class='previous_timeslice_data identifier id'>previous_timeslice_data</span><span class='comma token'>,</span> <span class='metric_ids identifier id'>metric_ids</span><span class='rparen token'>)</span>
  <span class='timeslice_data identifier id'>timeslice_data</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@stats_hash ivar id'>@stats_hash</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='metric_spec identifier id'>metric_spec</span><span class='bitor op'>|</span>
    
    
    <span class='comment val'># get a copy of the stats collected since the last harvest, and clear</span>
    <span class='comment val'># the stats inside our hash table for the next time slice.</span>
    <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='metric_spec identifier id'>metric_spec</span><span class='rbrack token'>]</span>

    <span class='comment val'># we have an optimization for unscoped metrics</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='metric_spec identifier id'>metric_spec</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='MetricSpec constant id'>MetricSpec</span><span class='rparen token'>)</span>
      <span class='metric_spec identifier id'>metric_spec</span> <span class='assign token'>=</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='MetricSpec constant id'>MetricSpec</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='metric_spec identifier id'>metric_spec</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='stats identifier id'>stats</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> 
      <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Nil stats for #{metric_spec.name} (#{metric_spec.scope})&quot;</span>
    <span class='end end kw'>end</span>
    
    <span class='stats_copy identifier id'>stats_copy</span> <span class='assign token'>=</span> <span class='stats identifier id'>stats</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
    <span class='stats identifier id'>stats</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span>
    
    <span class='comment val'># if the previous timeslice data has not been reported (due to an error of some sort)</span>
    <span class='comment val'># then we need to merge this timeslice with the previously accumulated - but not sent</span>
    <span class='comment val'># data</span>
    <span class='previous_metric_data identifier id'>previous_metric_data</span> <span class='assign token'>=</span> <span class='previous_timeslice_data identifier id'>previous_timeslice_data</span><span class='lbrack token'>[</span><span class='metric_spec identifier id'>metric_spec</span><span class='rbrack token'>]</span>
    <span class='stats_copy identifier id'>stats_copy</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span> <span class='previous_metric_data identifier id'>previous_metric_data</span><span class='dot token'>.</span><span class='stats identifier id'>stats</span> <span class='unless unless_mod kw'>unless</span> <span class='previous_metric_data identifier id'>previous_metric_data</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    
    <span class='stats_copy identifier id'>stats_copy</span><span class='dot token'>.</span><span class='round! fid id'>round!</span>
    
    <span class='comment val'># don't bother collecting and reporting stats that have zero-values for this timeslice.</span>
    <span class='comment val'># significant performance boost and storage savings.</span>
    <span class='unless unless kw'>unless</span> <span class='stats_copy identifier id'>stats_copy</span><span class='dot token'>.</span><span class='call_count identifier id'>call_count</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span> <span class='stats_copy identifier id'>stats_copy</span><span class='dot token'>.</span><span class='total_call_time identifier id'>total_call_time</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='integer val'>.0</span> <span class='andop op'>&amp;&amp;</span> <span class='stats_copy identifier id'>stats_copy</span><span class='dot token'>.</span><span class='total_exclusive_time identifier id'>total_exclusive_time</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
      
      <span class='metric_spec_for_transport identifier id'>metric_spec_for_transport</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='metric_ids identifier id'>metric_ids</span><span class='lbrack token'>[</span><span class='metric_spec identifier id'>metric_spec</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='metric_spec identifier id'>metric_spec</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span>
      
      <span class='metric_data identifier id'>metric_data</span> <span class='assign token'>=</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='MetricData constant id'>MetricData</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='metric_spec_for_transport identifier id'>metric_spec_for_transport</span><span class='comma token'>,</span> <span class='stats_copy identifier id'>stats_copy</span><span class='comma token'>,</span> <span class='metric_ids identifier id'>metric_ids</span><span class='lbrack token'>[</span><span class='metric_spec identifier id'>metric_spec</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      
      <span class='timeslice_data identifier id'>timeslice_data</span><span class='lbrack token'>[</span><span class='metric_spec identifier id'>metric_spec</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='metric_data identifier id'>metric_data</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='timeslice_data identifier id'>timeslice_data</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>lookup_stat</h3>
</div><div id="lookup_stat-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>lookup_stat</span><span class='args'>(metric_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


131
132
133</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 131</span>

<span class='def def kw'>def</span> <span class='lookup_stat identifier id'>lookup_stat</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='@stats_hash ivar id'>@stats_hash</span><span class='lbrack token'>[</span><span class='metric_name identifier id'>metric_name</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>metrics</h3>
</div><div id="metrics-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>metrics</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


134
135
136</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 134</span>

<span class='def def kw'>def</span> <span class='metrics identifier id'>metrics</span>
  <span class='return return kw'>return</span> <span class='@stats_hash ivar id'>@stats_hash</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>peek_scope</h3>
</div><div id="peek_scope-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>peek_scope</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


105
106
107</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 105</span>

<span class='def def kw'>def</span> <span class='peek_scope identifier id'>peek_scope</span>
  <span class='scope_stack identifier id'>scope_stack</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>pop_scope</h3>
</div><div id="pop_scope-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>pop_scope</span><span class='args'>(expected_scope, duration, time=Time.now.to_f)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 83</span>

<span class='def def kw'>def</span> <span class='pop_scope identifier id'>pop_scope</span><span class='lparen token'>(</span><span class='expected_scope identifier id'>expected_scope</span><span class='comma token'>,</span> <span class='duration identifier id'>duration</span><span class='comma token'>,</span> <span class='time identifier id'>time</span><span class='assign token'>=</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span>

  <span class='stack identifier id'>stack</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_scope_stack</span><span class='rbrack token'>]</span>
  
  <span class='scope identifier id'>scope</span> <span class='assign token'>=</span> <span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>
  
  <span class='fail identifier id'>fail</span> <span class='dstring node'>&quot;unbalanced pop from blame stack: #{scope.name} != #{expected_scope.name}&quot;</span> <span class='if if_mod kw'>if</span> <span class='scope identifier id'>scope</span> <span class='neq op'>!=</span> <span class='expected_scope identifier id'>expected_scope</span>
   
  <span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='children_time identifier id'>children_time</span> <span class='opasgn op'>+=</span> <span class='duration identifier id'>duration</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='orop op'>||</span> <span class='notop op'>!</span><span class='scope identifier id'>scope</span><span class='dot token'>.</span><span class='deduct_call_time_from_parent identifier id'>deduct_call_time_from_parent</span><span class='rparen token'>)</span>
  
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='scope identifier id'>scope</span><span class='dot token'>.</span><span class='deduct_call_time_from_parent identifier id'>deduct_call_time_from_parent</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='children_time identifier id'>children_time</span> <span class='opasgn op'>+=</span> <span class='scope identifier id'>scope</span><span class='dot token'>.</span><span class='children_time identifier id'>children_time</span>
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span>
    <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span><span class='dot token'>.</span><span class='notice_pop_scope identifier id'>notice_pop_scope</span><span class='lparen token'>(</span><span class='scope identifier id'>scope</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='time identifier id'>time</span><span class='rparen token'>)</span>
    <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span><span class='dot token'>.</span><span class='notice_scope_empty identifier id'>notice_scope_empty</span><span class='lparen token'>(</span><span class='time identifier id'>time</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> 
  <span class='end end kw'>end</span>
  
  <span class='scope identifier id'>scope</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>push_scope</h3>
</div><div id="push_scope-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>push_scope</span><span class='args'>(metric, time = Time.now.to_f, deduct_call_time_from_parent = true)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 68</span>

<span class='def def kw'>def</span> <span class='push_scope identifier id'>push_scope</span><span class='lparen token'>(</span><span class='metric identifier id'>metric</span><span class='comma token'>,</span> <span class='time identifier id'>time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='comma token'>,</span> <span class='deduct_call_time_from_parent identifier id'>deduct_call_time_from_parent</span> <span class='assign token'>=</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  
  <span class='stack identifier id'>stack</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_scope_stack</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  
  <span class='if if kw'>if</span> <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span>
    <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span><span class='dot token'>.</span><span class='notice_first_scope_push identifier id'>notice_first_scope_push</span><span class='lparen token'>(</span><span class='time identifier id'>time</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> 
    <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span><span class='dot token'>.</span><span class='notice_push_scope identifier id'>notice_push_scope</span> <span class='metric identifier id'>metric</span><span class='comma token'>,</span> <span class='time identifier id'>time</span>
  <span class='end end kw'>end</span>
  
  <span class='scope identifier id'>scope</span> <span class='assign token'>=</span> <span class='ScopeStackElement constant id'>ScopeStackElement</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='metric identifier id'>metric</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='deduct_call_time_from_parent identifier id'>deduct_call_time_from_parent</span><span class='rparen token'>)</span>
  <span class='stack identifier id'>stack</span><span class='dot token'>.</span><span class='push identifier id'>push</span> <span class='scope identifier id'>scope</span>
  
  <span class='scope identifier id'>scope</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>remove_scope_stack_listener</h3>
</div><div id="remove_scope_stack_listener-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>remove_scope_stack_listener</span><span class='args'>(l)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


64
65
66</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 64</span>

<span class='def def kw'>def</span> <span class='remove_scope_stack_listener identifier id'>remove_scope_stack_listener</span><span class='lparen token'>(</span><span class='l identifier id'>l</span><span class='rparen token'>)</span>
  <span class='@scope_stack_listener ivar id'>@scope_stack_listener</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>spawn_sampler_thread</h3>
</div><div id="spawn_sampler_thread-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>spawn_sampler_thread</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 33</span>

<span class='def def kw'>def</span> <span class='spawn_sampler_thread identifier id'>spawn_sampler_thread</span>
  
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='@sampler_process ivar id'>@sampler_process</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='@sampler_process ivar id'>@sampler_process</span> <span class='eq op'>==</span> <span class='$$ gvar id'>$$</span> 
  
  <span class='comment val'># start up a thread that will periodically poll for metric samples</span>
  <span class='@sampler_thread ivar id'>@sampler_thread</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span>
    <span class='while while kw'>while</span> <span class='true true kw'>true</span> <span class='do do kw'>do</span>
      <span class='begin begin kw'>begin</span>
        <span class='sleep identifier id'>sleep</span> <span class='POLL_PERIOD constant id'>POLL_PERIOD</span>
        <span class='@sampled_items ivar id'>@sampled_items</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='sampled_item identifier id'>sampled_item</span><span class='bitor op'>|</span>
          <span class='begin begin kw'>begin</span> 
            <span class='sampled_item identifier id'>sampled_item</span><span class='dot token'>.</span><span class='poll identifier id'>poll</span>
          <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
            <span class='log identifier id'>log</span><span class='dot token'>.</span><span class='error identifier id'>error</span> <span class='e identifier id'>e</span>
            <span class='@sampled_items ivar id'>@sampled_items</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='sampled_item identifier id'>sampled_item</span>
            <span class='log identifier id'>log</span><span class='dot token'>.</span><span class='error identifier id'>error</span> <span class='dstring node'>&quot;Removing #{sampled_item} from list&quot;</span>
            <span class='log identifier id'>log</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@sampler_process ivar id'>@sampler_process</span> <span class='assign token'>=</span> <span class='$$ gvar id'>$$</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start_transaction</h3>
</div><div id="start_transaction-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start_transaction</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


216
217
218</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 216</span>

<span class='def def kw'>def</span> <span class='start_transaction identifier id'>start_transaction</span>
  <span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_scope_stack</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>transaction_name</h3>
</div><div id="transaction_name-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>transaction_name</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
set the name of the transaction for the current thread, which will be used
to define the scope of all traced methods called on this thread until the
scope stack is empty.
</p>
<p>
currently the transaction name is the name of the controller action that is
invoked via the dispatcher, but conceivably we could use other transaction
names in the future if the traced application does more than service http
request via controller actions
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


126
127
128</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/stats_engine.rb', line 126</span>

<span class='def def kw'>def</span> <span class='transaction_name identifier id'>transaction_name</span>
  <span class='Thread constant id'>Thread</span><span class='colon2 op'>::</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:newrelic_transaction_name</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>