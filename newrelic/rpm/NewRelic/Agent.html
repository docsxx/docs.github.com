<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: NewRelic::Agent</title>
  </head>
  <body>
    <div id="content">
      <div class="section module NewRelic_Agent">
  <h1 class="title">Module: NewRelic::Agent</h1>
  <div class="section docstring">
  <p>
A worker loop executes a set of registered tasks on a single thread. A task
is a proc or block with a specified call period in seconds.
</p>

</div><div class="section constants">
  
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <h1>Public Class Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_custom_parameters-class_method' title='add_custom_parameters'>add_custom_parameters</a></span><span class='args'>(params)</span>
        <span class='block'></span>
        
          <span class='alias'>add_request_parameters</span>
        
      </th>
      <td class="docstring">
        <p>
Add parameters to the current transaction trace.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#agent-class_method' title='agent'>agent</a></span><span class='args'></span>
        <span class='block'></span>
        
          <span class='alias'>instance</span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#disable_sql_recording-class_method' title='disable_sql_recording'>disable_sql_recording</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method sets the state of sql recording in the transaction sampler
feature.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#disable_transaction_tracing-class_method' title='disable_transaction_tracing'>disable_transaction_tracing</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method disables the recording of transaction traces in the given
block.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#get_stats-class_method' title='get_stats'>get_stats</a></span><span class='args'>(metric_name, use_scope=false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Get or create a statistics gatherer that will aggregate numerical data
under a metric name.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#get_stats_no_scope-class_method' title='get_stats_no_scope'>get_stats_no_scope</a></span><span class='args'>(metric_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#ignore_error_filter-class_method' title='ignore_error_filter'>ignore_error_filter</a></span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method allows a filter to be applied to errors that RPM will track.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#manual_start-class_method' title='manual_start'>manual_start</a></span><span class='args'>(environment, identifier)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Call this to manually start the Agent in situations where the Agent does
not auto-start.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#set_sql_obfuscator-class_method' title='set_sql_obfuscator'>set_sql_obfuscator</a></span><span class='args'>(type = :replace, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method sets the block sent to this method as a sql obfuscator.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#should_ignore_error-class_method' title='should_ignore_error'>should_ignore_error</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails class public">
  <h1>Public Class Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>add_custom_parameters</h3>
</div><div id="add_custom_parameters-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_custom_parameters</span><span class='args'>(params)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="add_request_parameters-class_method">add_request_parameters</tt>
  
</p>
</div><div class="section docstring">
  <p>
Add parameters to the current transaction trace
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


125
126
127</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 125</span>

<span class='def def kw'>def</span> <span class='add_custom_parameters identifier id'>add_custom_parameters</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='add_custom_parameters identifier id'>add_custom_parameters</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>agent</h3>
</div><div id="agent-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>agent</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="instance-class_method">instance</tt>
  
</p>
</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


32
33
34</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 32</span>

<span class='def def kw'>def</span> <span class='agent identifier id'>agent</span>
  <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='Agent constant id'>Agent</span><span class='colon2 op'>::</span><span class='Agent constant id'>Agent</span><span class='dot token'>.</span><span class='instance identifier id'>instance</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>disable_sql_recording</h3>
</div><div id="disable_sql_recording-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>disable_sql_recording</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method sets the state of sql recording in the transaction sampler
feature. Within the given block, no sql will be recorded
</p>
<p>
usage:
</p>
<pre class="code">
  <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='Agent constant id'>Agent</span><span class='dot token'>.</span><span class='disable_sql_recording identifier id'>disable_sql_recording</span> <span class='do do kw'>do</span>
    <span class='dot3 op'>...</span>
   <span class='end end kw'>end</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


95
96
97
98
99
100
101
102</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 95</span>

<span class='def def kw'>def</span> <span class='disable_sql_recording identifier id'>disable_sql_recording</span>
  <span class='state identifier id'>state</span> <span class='assign token'>=</span> <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='set_record_sql identifier id'>set_record_sql</span><span class='lparen token'>(</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='begin begin kw'>begin</span>
    <span class='yield yield kw'>yield</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='set_record_sql identifier id'>set_record_sql</span><span class='lparen token'>(</span><span class='state identifier id'>state</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>disable_transaction_tracing</h3>
</div><div id="disable_transaction_tracing-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>disable_transaction_tracing</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method disables the recording of transaction traces in the given
block.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


106
107
108
109
110
111
112
113</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 106</span>

<span class='def def kw'>def</span> <span class='disable_transaction_tracing identifier id'>disable_transaction_tracing</span>
  <span class='state identifier id'>state</span> <span class='assign token'>=</span> <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='set_record_tt identifier id'>set_record_tt</span><span class='lparen token'>(</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='begin begin kw'>begin</span>
    <span class='yield yield kw'>yield</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='set_record_tt identifier id'>set_record_tt</span><span class='lparen token'>(</span><span class='state identifier id'>state</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_stats</h3>
</div><div id="get_stats-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_stats</span><span class='args'>(metric_name, use_scope=false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Get or create a statistics gatherer that will aggregate numerical data
under a metric name.
</p>
<p>
metric_name should follow a slash separated path convention. Application
specific metrics should begin with &quot;Custom/&quot;.
</p>
<p>
the statistical gatherer returned by get_stats accepts data via calls to
add_data_point(value)
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


46
47
48</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 46</span>

<span class='def def kw'>def</span> <span class='get_stats identifier id'>get_stats</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='comma token'>,</span> <span class='use_scope identifier id'>use_scope</span><span class='assign token'>=</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='stats_engine identifier id'>stats_engine</span><span class='dot token'>.</span><span class='get_stats identifier id'>get_stats</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='comma token'>,</span> <span class='use_scope identifier id'>use_scope</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_stats_no_scope</h3>
</div><div id="get_stats_no_scope-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_stats_no_scope</span><span class='args'>(metric_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


50
51
52</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 50</span>

<span class='def def kw'>def</span> <span class='get_stats_no_scope identifier id'>get_stats_no_scope</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='rparen token'>)</span>
  <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='stats_engine identifier id'>stats_engine</span><span class='dot token'>.</span><span class='get_stats_no_scope identifier id'>get_stats_no_scope</span><span class='lparen token'>(</span><span class='metric_name identifier id'>metric_name</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ignore_error_filter</h3>
</div><div id="ignore_error_filter-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ignore_error_filter</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method allows a filter to be applied to errors that RPM will track.
The block should return the exception to track (which could be different
from the original exception) or nil to ignore this exception
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


119
120
121</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 119</span>

<span class='def def kw'>def</span> <span class='ignore_error_filter identifier id'>ignore_error_filter</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='error_collector identifier id'>error_collector</span><span class='dot token'>.</span><span class='ignore_error_filter identifier id'>ignore_error_filter</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>manual_start</h3>
</div><div id="manual_start-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>manual_start</span><span class='args'>(environment, identifier)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Call this to manually start the Agent in situations where the Agent does
not auto-start. When the app environment loads, so does the Agent. However,
the Agent will only connect to RPM if a web front-end is found. If you want
to selectively monitor ruby processes that don&#8217;t use web plugins,
then call this method in your code and the Agent will fire up and start
reporting to RPM.
</p>
<p>
environment - the name of the environment. used for logging only port - the
name of this instance. shows up in the RPM UI screens. can be any String
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


65
66
67</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 65</span>

<span class='def def kw'>def</span> <span class='manual_start identifier id'>manual_start</span><span class='lparen token'>(</span><span class='environment identifier id'>environment</span><span class='comma token'>,</span> <span class='identifier identifier id'>identifier</span><span class='rparen token'>)</span>
  <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='manual_start identifier id'>manual_start</span><span class='lparen token'>(</span><span class='environment identifier id'>environment</span><span class='comma token'>,</span> <span class='identifier identifier id'>identifier</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_sql_obfuscator</h3>
</div><div id="set_sql_obfuscator-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_sql_obfuscator</span><span class='args'>(type = :replace, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method sets the block sent to this method as a sql obfuscator. The
block will be called with a single String SQL statement to obfuscate. The
method must return the obfuscated String SQL. If chaining of obfuscators is
required, use type = :before or :after
</p>
<p>
type = :before, :replace, :after
</p>
<p>
example:
</p>
<pre class="code">
   <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='Agent constant id'>Agent</span><span class='dot token'>.</span><span class='set_sql_obfuscator identifier id'>set_sql_obfuscator</span><span class='lparen token'>(</span><span class='symbol val'>:replace</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='sql identifier id'>sql</span><span class='bitor op'>|</span>
      <span class='my_obfuscator identifier id'>my_obfuscator</span><span class='lparen token'>(</span><span class='sql identifier id'>sql</span><span class='rparen token'>)</span>
   <span class='end end kw'>end</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


81
82
83</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/agent/agent.rb', line 81</span>

<span class='def def kw'>def</span> <span class='set_sql_obfuscator identifier id'>set_sql_obfuscator</span><span class='lparen token'>(</span><span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='symbol val'>:replace</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='agent identifier id'>agent</span><span class='dot token'>.</span><span class='set_sql_obfuscator identifier id'>set_sql_obfuscator</span> <span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>should_ignore_error</h3>
</div><div id="should_ignore_error-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>should_ignore_error</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


63
64</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/shim_agent.rb', line 63</span>

<span class='def def kw'>def</span> <span class='should_ignore_error identifier id'>should_ignore_error</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>