<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: NewRelic::TransactionSample::Segment</title>
  </head>
  <body>
    <div id="content">
      <div class="section class NewRelic_TransactionSample_Segment">
  <h1 class="title">Class: NewRelic::TransactionSample::Segment</h1>
  <div class="section inheritance">
  <ul>
  <li><a href='../../Object.html' title='Object'>Object</a></li><ul><li>NewRelic::TransactionSample::Segment</li>
  </ul></ul>
</div><div class="section attributes">
  <h1>Attributes</h1>

  
    <div class="instance">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">entry_timestamp</td>
          <td class="readwrite">
            [<span id='entry_timestamp-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>entry_timestamp</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">exit_timestamp</td>
          <td class="readwrite">
            [<span id='exit_timestamp-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>exit_timestamp</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">metric_name</td>
          <td class="readwrite">
            [<span id='metric_name-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>metric_name</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">parent_segment</td>
          <td class="readwrite">
            [RW] 
          </td>
          <td class="visibility">
            protected
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>parent_segment</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">segment_id</td>
          <td class="readwrite">
            [<span id='segment_id-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>segment_id</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(timestamp, metric_name, segment_id)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


33
34
35
36
37</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 33</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='timestamp identifier id'>timestamp</span><span class='comma token'>,</span> <span class='metric_name identifier id'>metric_name</span><span class='comma token'>,</span> <span class='segment_id identifier id'>segment_id</span><span class='rparen token'>)</span>
  <span class='@entry_timestamp ivar id'>@entry_timestamp</span> <span class='assign token'>=</span> <span class='timestamp identifier id'>timestamp</span>
  <span class='@metric_name ivar id'>@metric_name</span> <span class='assign token'>=</span> <span class='metric_name identifier id'>metric_name</span>
  <span class='@segment_id ivar id'>@segment_id</span> <span class='assign token'>=</span> <span class='segment_id identifier id'>segment_id</span> <span class='orop op'>||</span> <span class='object_id identifier id'>object_id</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#%5B%5D-instance_method' title='#[]'>#[]</a></span><span class='args'>(key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#%5B%5D%3D-instance_method' title='#[]='>#[]=</a></span><span class='args'>(key, value)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_called_segment-instance_method' title='#add_called_segment'>#add_called_segment</a></span><span class='args'>(s)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#called_segments-instance_method' title='#called_segments'>#called_segments</a></span><span class='args'>=(segments)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#duration-instance_method' title='#duration'>#duration</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
return the total duration of this segment.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#each_segment-instance_method' title='#each_segment'>#each_segment</a></span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
call the provided block for this segment and each of the called segments.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#end_trace-instance_method' title='#end_trace'>#end_trace</a></span><span class='args'>(timestamp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#exclusive_duration-instance_method' title='#exclusive_duration'>#exclusive_duration</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
return the duration of this segment without including the time in the
called segments.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#explain_sql-instance_method' title='#explain_sql'>#explain_sql</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
perform this in the runtime environment of a managed application, to
explain the sql statement(s) executed within a segment of a transaction
sample.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_segment-instance_method' title='#find_segment'>#find_segment</a></span><span class='args'>(id)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#freeze-instance_method' title='#freeze'>#freeze</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#obfuscated_sql-instance_method' title='#obfuscated_sql'>#obfuscated_sql</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#params-instance_method' title='#params'>#params</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#path_string-instance_method' title='#path_string'>#path_string</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#to_debug_str-instance_method' title='#to_debug_str'>#to_debug_str</a></span><span class='args'>(depth)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#to_s-instance_method' title='#to_s'>#to_s</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h1>Public Instance Methods Inherited from <a href='../../Object.html' title='Object'>Object</a></h1>
    <p><span class='name'><a href='../../Object.html#new_relic_load-instance_method' title='new_relic_load'>new_relic_load</a></span>, <span class='name'><a href='../../Object.html#new_relic_require-instance_method' title='new_relic_require'>new_relic_require</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>[]</h3>
</div><div id="%5B%5D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]</span><span class='args'>(key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


116
117
118</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 116</span>

<span class='def def kw'>def</span> <span class='aref op'>[]</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>[]=</h3>
</div><div id="%5B%5D%3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]=</span><span class='args'>(key, value)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


110
111
112
113
114</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 110</span>

<span class='def def kw'>def</span> <span class='aset op'>[]=</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='comment val'># only create a parameters field if a parameter is set; this will save</span>
  <span class='comment val'># bandwidth etc as most segments have no parameters</span>
  <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_called_segment</h3>
</div><div id="add_called_segment-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_called_segment</span><span class='args'>(s)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


43
44
45
46
47</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 43</span>

<span class='def def kw'>def</span> <span class='add_called_segment identifier id'>add_called_segment</span><span class='lparen token'>(</span><span class='s identifier id'>s</span><span class='rparen token'>)</span>
  <span class='@called_segments ivar id'>@called_segments</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@called_segments ivar id'>@called_segments</span> <span class='lshft op'>&lt;&lt;</span> <span class='s identifier id'>s</span>
  <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='parent_segment identifier id'>parent_segment</span> <span class='assign token'>=</span> <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>called_segments</h3>
</div><div id="called_segments-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>called_segments</span><span class='args'>=(segments)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


192
193
194</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 192</span>

<span class='def def kw'>def</span> <span class='called_segments= identifier id'>called_segments=</span><span class='lparen token'>(</span><span class='segments identifier id'>segments</span><span class='rparen token'>)</span>
  <span class='@called_segments ivar id'>@called_segments</span> <span class='assign token'>=</span> <span class='segments identifier id'>segments</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>duration</h3>
</div><div id="duration-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>duration</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
return the total duration of this segment
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


93
94
95</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 93</span>

<span class='def def kw'>def</span> <span class='duration identifier id'>duration</span>
  <span class='@exit_timestamp ivar id'>@exit_timestamp</span> <span class='minus op'>-</span> <span class='@entry_timestamp ivar id'>@entry_timestamp</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>each_segment</h3>
</div><div id="each_segment-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>each_segment</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
call the provided block for this segment and each of the called segments
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


126
127
128
129
130
131
132
133
134</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 126</span>

<span class='def def kw'>def</span> <span class='each_segment identifier id'>each_segment</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='self self kw'>self</span>
  
  <span class='if if kw'>if</span> <span class='@called_segments ivar id'>@called_segments</span>
    <span class='@called_segments ivar id'>@called_segments</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='segment identifier id'>segment</span><span class='bitor op'>|</span>
      <span class='segment identifier id'>segment</span><span class='dot token'>.</span><span class='each_segment identifier id'>each_segment</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>end_trace</h3>
</div><div id="end_trace-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>end_trace</span><span class='args'>(timestamp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


39
40
41</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 39</span>

<span class='def def kw'>def</span> <span class='end_trace identifier id'>end_trace</span><span class='lparen token'>(</span><span class='timestamp identifier id'>timestamp</span><span class='rparen token'>)</span>
  <span class='@exit_timestamp ivar id'>@exit_timestamp</span> <span class='assign token'>=</span> <span class='timestamp identifier id'>timestamp</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>exclusive_duration</h3>
</div><div id="exclusive_duration-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>exclusive_duration</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
return the duration of this segment without including the time in the
called segments
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


99
100
101
102
103
104
105
106
107
108</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 99</span>

<span class='def def kw'>def</span> <span class='exclusive_duration identifier id'>exclusive_duration</span>
  <span class='d identifier id'>d</span> <span class='assign token'>=</span> <span class='duration identifier id'>duration</span>
  
  <span class='if if kw'>if</span> <span class='@called_segments ivar id'>@called_segments</span>
    <span class='@called_segments ivar id'>@called_segments</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='segment identifier id'>segment</span><span class='bitor op'>|</span>
      <span class='d identifier id'>d</span> <span class='opasgn op'>-=</span> <span class='segment identifier id'>segment</span><span class='dot token'>.</span><span class='duration identifier id'>duration</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='d identifier id'>d</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>explain_sql</h3>
</div><div id="explain_sql-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>explain_sql</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
perform this in the runtime environment of a managed application, to
explain the sql statement(s) executed within a segment of a transaction
sample. returns an array of explanations (which is an array rows consisting
of an array of strings for each column returned by the the explain query)
Note this happens only for statements whose execution time exceeds a
threshold (e.g. 500ms) and only within the slowest transaction in a report
period, selected for shipment to RPM
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 151</span>

<span class='def def kw'>def</span> <span class='explain_sql identifier id'>explain_sql</span>        
  <span class='sql identifier id'>sql</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:sql</span><span class='rbrack token'>]</span>
  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='sql identifier id'>sql</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
  <span class='statements identifier id'>statements</span> <span class='assign token'>=</span> <span class='sql identifier id'>sql</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;;\n&quot;</span><span class='rparen token'>)</span>
  <span class='explanations identifier id'>explanations</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='statements identifier id'>statements</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='statement identifier id'>statement</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='statement identifier id'>statement</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='$; gvar id'>$;</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='upcase identifier id'>upcase</span> <span class='eq op'>==</span> <span class='string val'>'SELECT'</span>
      <span class='explain_resultset identifier id'>explain_resultset</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='begin begin kw'>begin</span>
        <span class='connection identifier id'>connection</span> <span class='assign token'>=</span> <span class='NewRelic constant id'>NewRelic</span><span class='colon2 op'>::</span><span class='TransactionSample constant id'>TransactionSample</span><span class='dot token'>.</span><span class='get_connection identifier id'>get_connection</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:connection_config</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>    
        <span class='if if kw'>if</span> <span class='connection identifier id'>connection</span>
          <span class='comment val'># The resultset type varies for different drivers.  Only thing you can count on is</span>
          <span class='comment val'># that it implements each.  Also: can't use select_rows because the native postgres</span>
          <span class='comment val'># driver doesn't know that method.</span>
          <span class='explain_resultset identifier id'>explain_resultset</span> <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='dstring node'>&quot;EXPLAIN #{statement}&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='connection identifier id'>connection</span>
          <span class='rows identifier id'>rows</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
          <span class='comment val'># Note: we can't use map.</span>
          <span class='comment val'># Note: have to convert from native column element types to string so we can</span>
          <span class='comment val'># serialize.  Esp. for postgresql.</span>
          <span class='explain_resultset identifier id'>explain_resultset</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span> <span class='row identifier id'>row</span> <span class='bitor op'>|</span> <span class='rows identifier id'>rows</span> <span class='lshft op'>&lt;&lt;</span> <span class='row identifier id'>row</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:to_s</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>  <span class='comment val'># Can't use map.  Suck it up.</span>
          <span class='explanations identifier id'>explanations</span> <span class='lshft op'>&lt;&lt;</span> <span class='rows identifier id'>rows</span>
          <span class='comment val'># sleep for a very short period of time in order to yield to the main thread</span>
          <span class='comment val'># this is because a remote database call will likely hang the VM</span>
          <span class='sleep identifier id'>sleep</span> <span class='integer val'>0</span><span class='integer val'>.05</span>
        <span class='end end kw'>end</span>
      <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='integer val'>1</span> <span class='comment val'># this is here so that code coverage knows we've entered this block</span>
        <span class='comment val'># swallow failed attempts to run an explain.  One example of a failure is the</span>
        <span class='comment val'># connection for the sql statement is to a different db than the default connection</span>
        <span class='comment val'># specified in AR::Base</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='explanations identifier id'>explanations</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_segment</h3>
</div><div id="find_segment-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_segment</span><span class='args'>(id)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


136
137
138
139
140
141
142
143</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 136</span>

<span class='def def kw'>def</span> <span class='find_segment identifier id'>find_segment</span><span class='lparen token'>(</span><span class='id identifier id'>id</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='@segment_id ivar id'>@segment_id</span> <span class='eq op'>==</span> <span class='id identifier id'>id</span>
  <span class='called_segments identifier id'>called_segments</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='segment identifier id'>segment</span><span class='bitor op'>|</span>
    <span class='found identifier id'>found</span> <span class='assign token'>=</span> <span class='segment identifier id'>segment</span><span class='dot token'>.</span><span class='find_segment identifier id'>find_segment</span><span class='lparen token'>(</span><span class='id identifier id'>id</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='found identifier id'>found</span> <span class='if if_mod kw'>if</span> <span class='found identifier id'>found</span>
  <span class='end end kw'>end</span>
  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>freeze</h3>
</div><div id="freeze-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>freeze</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


82
83
84
85
86
87
88
89
90</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 82</span>

<span class='def def kw'>def</span> <span class='freeze identifier id'>freeze</span>
  <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='freeze identifier id'>freeze</span>
  <span class='if if kw'>if</span> <span class='@called_segments ivar id'>@called_segments</span>
    <span class='@called_segments ivar id'>@called_segments</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
      <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='freeze identifier id'>freeze</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='super super kw'>super</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>obfuscated_sql</h3>
</div><div id="obfuscated_sql-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>obfuscated_sql</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


188
189
190</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 188</span>

<span class='def def kw'>def</span> <span class='obfuscated_sql identifier id'>obfuscated_sql</span>
  <span class='TransactionSample constant id'>TransactionSample</span><span class='dot token'>.</span><span class='obfuscate_sql identifier id'>obfuscate_sql</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:sql</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>params</h3>
</div><div id="params-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>params</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


120
121
122</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 120</span>

<span class='def def kw'>def</span> <span class='params identifier id'>params</span>
  <span class='@params ivar id'>@params</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>path_string</h3>
</div><div id="path_string-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>path_string</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


53
54
55</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 53</span>

<span class='def def kw'>def</span> <span class='path_string identifier id'>path_string</span>
  <span class='dstring node'>&quot;#{metric_name}[#{called_segments.collect {|segment| segment.path_string }.join('')}]&quot;</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>to_debug_str</h3>
</div><div id="to_debug_str-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_debug_str</span><span class='args'>(depth)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 57</span>

<span class='def def kw'>def</span> <span class='to_debug_str identifier id'>to_debug_str</span><span class='lparen token'>(</span><span class='depth identifier id'>depth</span><span class='rparen token'>)</span>
  <span class='tab identifier id'>tab</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span> 
  <span class='depth identifier id'>depth</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='lbrace token'>{</span><span class='tab identifier id'>tab</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;  &quot;</span><span class='rbrace token'>}</span>
  
  <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='tab identifier id'>tab</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
  <span class='s identifier id'>s</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&gt;&gt; #{metric_name}: #{@entry_timestamp.to_ms}\n&quot;</span>
  <span class='unless unless kw'>unless</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='s identifier id'>s</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{tab}#{tab}{\n&quot;</span>
    <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
      <span class='s identifier id'>s</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{tab}#{tab}#{k}: #{v}\n&quot;</span>
    <span class='end end kw'>end</span>
    <span class='s identifier id'>s</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{tab}#{tab}}\n&quot;</span>
  <span class='end end kw'>end</span>
  <span class='called_segments identifier id'>called_segments</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='cs identifier id'>cs</span><span class='bitor op'>|</span>
    <span class='s identifier id'>s</span> <span class='lshft op'>&lt;&lt;</span> <span class='cs identifier id'>cs</span><span class='dot token'>.</span><span class='to_debug_str identifier id'>to_debug_str</span><span class='lparen token'>(</span><span class='depth identifier id'>depth</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='s identifier id'>s</span> <span class='lshft op'>&lt;&lt;</span> <span class='tab identifier id'>tab</span>
  <span class='s identifier id'>s</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;&lt;&lt; #{metric_name}: #{@exit_timestamp ? @exit_timestamp.to_ms : 'n/a'}\n&quot;</span>
  <span class='s identifier id'>s</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>to_s</h3>
</div><div id="to_s-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_s</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


49
50
51</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/new_relic/transaction_sample.rb', line 49</span>

<span class='def def kw'>def</span> <span class='to_s identifier id'>to_s</span>
  <span class='to_debug_str identifier id'>to_debug_str</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>