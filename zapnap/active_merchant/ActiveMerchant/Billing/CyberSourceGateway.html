<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: ActiveMerchant::Billing::CyberSourceGateway</title>
  </head>
  <body>
    <div id="content">
      <div class="section class ActiveMerchant_Billing_CyberSourceGateway">
  <h1 class="title">Class: ActiveMerchant::Billing::CyberSourceGateway</h1>
  <div class="section inheritance">
  <ul>
  <li><a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></li><ul><li>ActiveMerchant::Billing::CyberSourceGateway</li>
  </ul></ul>
</div><div class="section docstring">
  <p>
See the remote and mocked unit test files for example usage. Pay special
attention to the contents of the options hash.
</p>
<p>
Initial setup instructions can be found in
http://cybersource.com/support_center/implementation/downloads/soap_api/SOAP_toolkits.pdf
</p>
<p>
Debugging If you experience an issue with this gateway be sure to examine
the transaction information from a general transaction search inside the
CyberSource Business Center for the full error messages including field
names.
</p>
<p>
Important Notes
</p>
<ul>
<li>AVS and CVV only work against the production server. You will always get
back X for AVS and no response for CVV against the test server.

</li>
<li>Nexus is the list of states or provinces where you have a physical
presence. Nexus is used to calculate tax. Leave blank to tax everyone.

</li>
<li>If you want to calculate VAT for overseas customers you must supply a
registration number in the options hash as vat_reg_number.

</li>
<li>productCode is a value in the line_items hash that is used to tell
CyberSource what kind of item you are selling. It is used when calculating
tax/VAT.

</li>
<li>All transactions use dollar values.

</li>
</ul>

</div><div class="section constants">
  <div class="thisclass">
  <h1>Constants</h1>
  <dl>
    
      <dt id="LIVE_URL-constant">LIVE_URL</dt>
      <dd>'https://ics2ws.ic3.com/commerce/1.x/transactionProcessor'</dd>
    
      <dt id="TEST_URL-constant">TEST_URL</dt>
      <dd>'https://ics2wstest.ic3.com/commerce/1.x/transactionProcessor'</dd>
    
  </dl>
</div>
<div class="inherited">
  
  <div>
    <h1>Constants Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#DEBIT_CARDS-constant' title='DEBIT_CARDS'>DEBIT_CARDS</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
These are the options that can be used when creating a new CyberSource
Gateway object.
</p>
<p>
:login =&gt; your username
</p>
<p>
:password =&gt; the transaction key you generated in the Business Center
</p>
<p>
:test =&gt; true sets the gateway to test mode
</p>
<p>
:vat_reg_number =&gt; your VAT registration number
</p>
<p>
:nexus =&gt; &quot;WI CA QC&quot; sets the states/provinces where you have
a physical presense for tax purposes
</p>
<p>
:ignore_avs =&gt; true don&#8217;t want to use AVS so continue processing
even if AVS would have failed
</p>
<p>
:ignore_cvv =&gt; true don&#8217;t want to use CVV so continue processing
even if CVV would have failed
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


93
94
95
96
97</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 93</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='symbol val'>:login</span><span class='comma token'>,</span> <span class='symbol val'>:password</span><span class='rparen token'>)</span>
  <span class='@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span>
  <span class='super super kw'>super</span>
<span class='end end kw'>end</span>  
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <div class="inherited">
  
  <div>
    <h1>Public Class Methods Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#card_brand-class_method' title='card_brand'>card_brand</a></span>, <span class='name'><a href='Gateway.html#inherited-class_method' title='inherited'>inherited</a></span>, <span class='name'><a href='Gateway.html#supports%3F-class_method' title='supports?'>supports?</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_address-instance_method' title='#add_address'>#add_address</a></span><span class='args'>(xml, creditcard, address, options, shipTo = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_auth_service-instance_method' title='#add_auth_service'>#add_auth_service</a></span><span class='args'>(xml)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_business_rules_data-instance_method' title='#add_business_rules_data'>#add_business_rules_data</a></span><span class='args'>(xml)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_capture_service-instance_method' title='#add_capture_service'>#add_capture_service</a></span><span class='args'>(xml, request_id, request_token)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_credit_service-instance_method' title='#add_credit_service'>#add_credit_service</a></span><span class='args'>(xml, request_id, request_token)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_creditcard-instance_method' title='#add_creditcard'>#add_creditcard</a></span><span class='args'>(xml, creditcard)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_line_item_data-instance_method' title='#add_line_item_data'>#add_line_item_data</a></span><span class='args'>(xml, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_merchant_data-instance_method' title='#add_merchant_data'>#add_merchant_data</a></span><span class='args'>(xml, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_purchase_data-instance_method' title='#add_purchase_data'>#add_purchase_data</a></span><span class='args'>(xml, money = 0, include_grand_total = false, options={})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_purchase_service-instance_method' title='#add_purchase_service'>#add_purchase_service</a></span><span class='args'>(xml, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_tax_service-instance_method' title='#add_tax_service'>#add_tax_service</a></span><span class='args'>(xml)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_void_service-instance_method' title='#add_void_service'>#add_void_service</a></span><span class='args'>(xml, request_id, request_token)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#authorize-instance_method' title='#authorize'>#authorize</a></span><span class='args'>(money, creditcard, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Request an authorization for an amount from CyberSource .
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_auth_request-instance_method' title='#build_auth_request'>#build_auth_request</a></span><span class='args'>(money, creditcard, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_capture_request-instance_method' title='#build_capture_request'>#build_capture_request</a></span><span class='args'>(money, authorization, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_credit_request-instance_method' title='#build_credit_request'>#build_credit_request</a></span><span class='args'>(money, identification, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_purchase_request-instance_method' title='#build_purchase_request'>#build_purchase_request</a></span><span class='args'>(money, creditcard, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_request-instance_method' title='#build_request'>#build_request</a></span><span class='args'>(body, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Where we actually build the full SOAP request using builder.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_tax_calculation_request-instance_method' title='#build_tax_calculation_request'>#build_tax_calculation_request</a></span><span class='args'>(creditcard, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_void_request-instance_method' title='#build_void_request'>#build_void_request</a></span><span class='args'>(identification, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#calculate_tax-instance_method' title='#calculate_tax'>#calculate_tax</a></span><span class='args'>(creditcard, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
CyberSource requires that you provide line item information for tax
calculations If you do not have prices for each item or want to simplify
the situation then pass in one fake line item that costs the subtotal of
the order.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#capture-instance_method' title='#capture'>#capture</a></span><span class='args'>(money, authorization, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Capture an authorization that has previously been requested.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#commit-instance_method' title='#commit'>#commit</a></span><span class='args'>(request, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Contact CyberSource, make the SOAP request, and parse the reply into a
Response object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#credit-instance_method' title='#credit'>#credit</a></span><span class='args'>(money, identification, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#parse-instance_method' title='#parse'>#parse</a></span><span class='args'>(xml)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Parse the SOAP response Technique inspired by the Paypal Gateway.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#parse_element-instance_method' title='#parse_element'>#parse_element</a></span><span class='args'>(reply, node)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#purchase-instance_method' title='#purchase'>#purchase</a></span><span class='args'>(money, creditcard, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Purchase is an auth followed by a capture You must supply an order_id in
the options hash.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#setup_address_hash-instance_method' title='#setup_address_hash'>#setup_address_hash</a></span><span class='args'>(options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create all address hash key value pairs so that we still function if we
were only provided with one or two of them.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#test%3F-instance_method' title='#test?'>#test?</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Should run against the test servers or not?.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#void-instance_method' title='#void'>#void</a></span><span class='args'>(identification, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h1>Public Instance Methods Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#amount-instance_method' title='amount'>amount</a></span>, <span class='name'><a href='Gateway.html#card_brand-instance_method' title='card_brand'>card_brand</a></span>, <span class='name'><a href='Gateway.html#currency-instance_method' title='currency'>currency</a></span>, <span class='name'><a href='Gateway.html#name-instance_method' title='name'>name</a></span>, <span class='name'><a href='Gateway.html#requires_start_date_or_issue_number%3F-instance_method' title='requires_start_date_or_issue_number?'>requires_start_date_or_issue_number?</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>add_address</h3>
</div><div id="add_address-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_address</span><span class='args'>(xml, creditcard, address, options, shipTo = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


269
270
271
272
273
274
275
276
277
278
279
280
281</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 269</span>

<span class='def def kw'>def</span> <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='shipTo identifier id'>shipTo</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>      
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='shipTo identifier id'>shipTo</span> <span class='question op'>?</span> <span class='string val'>'shipTo'</span> <span class='colon op'>:</span> <span class='string val'>'billTo'</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'firstName'</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'lastName'</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='dot token'>.</span><span class='last_name identifier id'>last_name</span> 
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'street1'</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address1</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'street2'</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address2</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'city'</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:city</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'state'</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:state</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'postalCode'</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:zip</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'country'</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:country</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'email'</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:email</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span> 
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_auth_service</h3>
</div><div id="add_auth_service-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_auth_service</span><span class='args'>(xml)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


300
301
302</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 300</span>

<span class='def def kw'>def</span> <span class='add_auth_service identifier id'>add_auth_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'ccAuthService'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'run'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='rbrace token'>}</span> 
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_business_rules_data</h3>
</div><div id="add_business_rules_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_business_rules_data</span><span class='args'>(xml)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


235
236
237
238
239
240</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 235</span>

<span class='def def kw'>def</span> <span class='add_business_rules_data identifier id'>add_business_rules_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'businessRules'</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span><span class='lparen token'>(</span><span class='string val'>'ignoreAVSResult'</span><span class='comma token'>,</span> <span class='string val'>'true'</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:ignore_avs</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span><span class='lparen token'>(</span><span class='string val'>'ignoreCVResult'</span><span class='comma token'>,</span> <span class='string val'>'true'</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:ignore_cvv</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span> 
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_capture_service</h3>
</div><div id="add_capture_service-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_capture_service</span><span class='args'>(xml, request_id, request_token)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


304
305
306
307
308
309</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 304</span>

<span class='def def kw'>def</span> <span class='add_capture_service identifier id'>add_capture_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'ccCaptureService'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'run'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'authRequestID'</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'authRequestToken'</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_credit_service</h3>
</div><div id="add_credit_service-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_credit_service</span><span class='args'>(xml, request_id, request_token)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


323
324
325
326
327
328</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 323</span>

<span class='def def kw'>def</span> <span class='add_credit_service identifier id'>add_credit_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'ccCreditService'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'run'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'captureRequestID'</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'captureRequestToken'</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_creditcard</h3>
</div><div id="add_creditcard-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_creditcard</span><span class='args'>(xml, creditcard)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


283
284
285
286
287
288
289
290
291</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 283</span>

<span class='def def kw'>def</span> <span class='add_creditcard identifier id'>add_creditcard</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='rparen token'>)</span>      
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'card'</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'accountNumber'</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='dot token'>.</span><span class='number identifier id'>number</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'expirationMonth'</span><span class='comma token'>,</span> <span class='format identifier id'>format</span><span class='lparen token'>(</span><span class='creditcard identifier id'>creditcard</span><span class='dot token'>.</span><span class='month identifier id'>month</span><span class='comma token'>,</span> <span class='symbol val'>:two_digits</span><span class='rparen token'>)</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'expirationYear'</span><span class='comma token'>,</span> <span class='format identifier id'>format</span><span class='lparen token'>(</span><span class='creditcard identifier id'>creditcard</span><span class='dot token'>.</span><span class='year identifier id'>year</span><span class='comma token'>,</span> <span class='symbol val'>:four_digits</span><span class='rparen token'>)</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span><span class='lparen token'>(</span><span class='string val'>'cvNumber'</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='dot token'>.</span><span class='verification_value identifier id'>verification_value</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:ignore_cvv</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='creditcard identifier id'>creditcard</span><span class='dot token'>.</span><span class='verification_value identifier id'>verification_value</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='rparen token'>)</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'cardType'</span><span class='comma token'>,</span> <span class='@@credit_card_codes ivar id'>@@credit_card_codes</span><span class='lbrack token'>[</span><span class='card_brand identifier id'>card_brand</span><span class='lparen token'>(</span><span class='creditcard identifier id'>creditcard</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_line_item_data</h3>
</div><div id="add_line_item_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_line_item_data</span><span class='args'>(xml, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


242
243
244
245
246
247
248
249
250
251
252</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 242</span>

<span class='def def kw'>def</span> <span class='add_line_item_data identifier id'>add_line_item_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:line_items</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each_with_index identifier id'>each_with_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='bitor op'>|</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'item'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'id'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='index identifier id'>index</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'unitPrice'</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='symbol val'>:declared_value</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>  
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'quantity'</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='symbol val'>:quantity</span><span class='rbrack token'>]</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'productCode'</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='symbol val'>:code</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>'shipping_only'</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'productName'</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='symbol val'>:description</span><span class='rbrack token'>]</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'productSKU'</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='symbol val'>:sku</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_merchant_data</h3>
</div><div id="add_merchant_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_merchant_data</span><span class='args'>(xml, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


254
255
256
257
258
259
260</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 254</span>

<span class='def def kw'>def</span> <span class='add_merchant_data identifier id'>add_merchant_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'merchantID'</span><span class='comma token'>,</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:login</span><span class='rbrack token'>]</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'merchantReferenceCode'</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'clientLibrary'</span> <span class='comma token'>,</span><span class='string val'>'Ruby Active Merchant'</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'clientLibraryVersion'</span><span class='comma token'>,</span>  <span class='string val'>'1.0'</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'clientEnvironment'</span> <span class='comma token'>,</span> <span class='string val'>'Linux'</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_purchase_data</h3>
</div><div id="add_purchase_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_purchase_data</span><span class='args'>(xml, money = 0, include_grand_total = false, options={})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


262
263
264
265
266
267</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 262</span>

<span class='def def kw'>def</span> <span class='add_purchase_data identifier id'>add_purchase_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='money identifier id'>money</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='include_grand_total identifier id'>include_grand_total</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'purchaseTotals'</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'currency'</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:currency</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='currency identifier id'>currency</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span><span class='lparen token'>(</span><span class='string val'>'grandTotalAmount'</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='rparen token'>)</span>  <span class='if if_mod kw'>if</span> <span class='include_grand_total identifier id'>include_grand_total</span> 
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_purchase_service</h3>
</div><div id="add_purchase_service-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_purchase_service</span><span class='args'>(xml, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


311
312
313
314</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 311</span>

<span class='def def kw'>def</span> <span class='add_purchase_service identifier id'>add_purchase_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'ccAuthService'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'run'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='rbrace token'>}</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'ccCaptureService'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'run'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_tax_service</h3>
</div><div id="add_tax_service-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_tax_service</span><span class='args'>(xml)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


293
294
295
296
297
298</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 293</span>

<span class='def def kw'>def</span> <span class='add_tax_service identifier id'>add_tax_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'taxService'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'run'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span><span class='lparen token'>(</span><span class='string val'>'nexus'</span><span class='comma token'>,</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:nexus</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:nexus</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span><span class='lparen token'>(</span><span class='string val'>'sellerRegistration'</span><span class='comma token'>,</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:vat_reg_number</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:vat_reg_number</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_void_service</h3>
</div><div id="add_void_service-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_void_service</span><span class='args'>(xml, request_id, request_token)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


316
317
318
319
320
321</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 316</span>

<span class='def def kw'>def</span> <span class='add_void_service identifier id'>add_void_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'voidService'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'run'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'voidRequestID'</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'voidRequestToken'</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>authorize</h3>
</div><div id="authorize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authorize</span><span class='args'>(money, creditcard, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Request an authorization for an amount from CyberSource
</p>
<p>
You must supply an :order_id in the options hash
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


107
108
109
110
111</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 107</span>

<span class='def def kw'>def</span> <span class='authorize identifier id'>authorize</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span>  <span class='symbol val'>:order_id</span><span class='comma token'>,</span> <span class='symbol val'>:email</span><span class='rparen token'>)</span>
  <span class='setup_address_hash identifier id'>setup_address_hash</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='build_auth_request identifier id'>build_auth_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_auth_request</h3>
</div><div id="build_auth_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_auth_request</span><span class='args'>(money, creditcard, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


173
174
175
176
177
178
179
180
181</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 173</span>

<span class='def def kw'>def</span> <span class='build_auth_request identifier id'>build_auth_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:billing_address</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_purchase_data identifier id'>add_purchase_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_creditcard identifier id'>add_creditcard</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='rparen token'>)</span>
  <span class='add_auth_service identifier id'>add_auth_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='add_business_rules_data identifier id'>add_business_rules_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_capture_request</h3>
</div><div id="build_capture_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_capture_request</span><span class='args'>(money, authorization, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


194
195
196
197
198
199
200
201
202
203</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 194</span>

<span class='def def kw'>def</span> <span class='build_capture_request identifier id'>build_capture_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='order_id identifier id'>order_id</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span> <span class='assign token'>=</span> <span class='authorization identifier id'>authorization</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;;&quot;</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='order_id identifier id'>order_id</span>

  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='add_purchase_data identifier id'>add_purchase_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_capture_service identifier id'>add_capture_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span><span class='rparen token'>)</span>
  <span class='add_business_rules_data identifier id'>add_business_rules_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span> 
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_credit_request</h3>
</div><div id="build_credit_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_credit_request</span><span class='args'>(money, identification, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


224
225
226
227
228
229
230
231
232
233</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 224</span>

<span class='def def kw'>def</span> <span class='build_credit_request identifier id'>build_credit_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='identification identifier id'>identification</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='order_id identifier id'>order_id</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span> <span class='assign token'>=</span> <span class='identification identifier id'>identification</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;;&quot;</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='order_id identifier id'>order_id</span>
  
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='add_purchase_data identifier id'>add_purchase_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_credit_service identifier id'>add_credit_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span><span class='rparen token'>)</span>
  
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_purchase_request</h3>
</div><div id="build_purchase_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_purchase_request</span><span class='args'>(money, creditcard, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


205
206
207
208
209
210
211
212
213</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 205</span>

<span class='def def kw'>def</span> <span class='build_purchase_request identifier id'>build_purchase_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:billing_address</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_purchase_data identifier id'>add_purchase_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_creditcard identifier id'>add_creditcard</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='rparen token'>)</span>
  <span class='add_purchase_service identifier id'>add_purchase_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_business_rules_data identifier id'>add_business_rules_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_request</h3>
</div><div id="build_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_request</span><span class='args'>(body, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Where we actually build the full SOAP request using builder
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 332</span>

<span class='def def kw'>def</span> <span class='build_request identifier id'>build_request</span><span class='lparen token'>(</span><span class='body identifier id'>body</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='instruct! fid id'>instruct!</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'s:Envelope'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'xmlns:s'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://schemas.xmlsoap.org/soap/envelope/'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'s:Header'</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'wsse:Security'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'s:mustUnderstand'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'1'</span><span class='comma token'>,</span> <span class='string val'>'xmlns:wsse'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'wsse:UsernameToken'</span> <span class='do do kw'>do</span>
            <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'wsse:Username'</span><span class='comma token'>,</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:login</span><span class='rbrack token'>]</span>
            <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'wsse:Password'</span><span class='comma token'>,</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='string val'>'Type'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText'</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'s:Body'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'xmlns:xsi'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://www.w3.org/2001/XMLSchema-instance'</span><span class='comma token'>,</span> <span class='string val'>'xmlns:xsd'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://www.w3.org/2001/XMLSchema'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='string val'>'requestMessage'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='string val'>'xmlns'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'urn:schemas-cybersource-com:transaction-data-1.32'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
          <span class='add_merchant_data identifier id'>add_merchant_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
          <span class='xml identifier id'>xml</span> <span class='lshft op'>&lt;&lt;</span> <span class='body identifier id'>body</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span> 
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_tax_calculation_request</h3>
</div><div id="build_tax_calculation_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_tax_calculation_request</span><span class='args'>(creditcard, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


183
184
185
186
187
188
189
190
191
192</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 183</span>

<span class='def def kw'>def</span> <span class='build_tax_calculation_request identifier id'>build_tax_calculation_request</span><span class='lparen token'>(</span><span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:billing_address</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:shipping_address</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='add_line_item_data identifier id'>add_line_item_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_purchase_data identifier id'>add_purchase_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_tax_service identifier id'>add_tax_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='add_business_rules_data identifier id'>add_business_rules_data</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_void_request</h3>
</div><div id="build_void_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_void_request</span><span class='args'>(identification, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


215
216
217
218
219
220
221
222</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 215</span>

<span class='def def kw'>def</span> <span class='build_void_request identifier id'>build_void_request</span><span class='lparen token'>(</span><span class='identification identifier id'>identification</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='order_id identifier id'>order_id</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span> <span class='assign token'>=</span> <span class='identification identifier id'>identification</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;;&quot;</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='order_id identifier id'>order_id</span>
  
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='add_void_service identifier id'>add_void_service</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request_token identifier id'>request_token</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>calculate_tax</h3>
</div><div id="calculate_tax-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>calculate_tax</span><span class='args'>(creditcard, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
CyberSource requires that you provide line item information for tax
calculations If you do not have prices for each item or want to simplify
the situation then pass in one fake line item that costs the subtotal of
the order
</p>
<p>
The line_item hash goes in the options hash and should look like
</p>
<pre class="code">
        <span class='symbol val'>:line_items</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span>
          <span class='lbrace token'>{</span>
            <span class='symbol val'>:declared_value</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'1'</span><span class='comma token'>,</span>
            <span class='symbol val'>:quantity</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'2'</span><span class='comma token'>,</span>
            <span class='symbol val'>:code</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'default'</span><span class='comma token'>,</span>
            <span class='symbol val'>:description</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Giant Walrus'</span><span class='comma token'>,</span>
            <span class='symbol val'>:sku</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'WA323232323232323'</span>
          <span class='rbrace token'>}</span><span class='comma token'>,</span>
          <span class='lbrace token'>{</span>
            <span class='symbol val'>:declared_value</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'6'</span><span class='comma token'>,</span>
            <span class='symbol val'>:quantity</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'1'</span><span class='comma token'>,</span>
            <span class='symbol val'>:code</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'default'</span><span class='comma token'>,</span>
            <span class='symbol val'>:description</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Marble Snowcone'</span><span class='comma token'>,</span>
            <span class='symbol val'>:sku</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'FAKE1232132113123'</span>
          <span class='rbrace token'>}</span>
        <span class='rbrack token'>]</span>
</pre>
<p>
This functionality is only supported by this particular gateway may be
changed at any time
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


160
161
162
163
164</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 160</span>

<span class='def def kw'>def</span> <span class='calculate_tax identifier id'>calculate_tax</span><span class='lparen token'>(</span><span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span>  <span class='symbol val'>:line_items</span><span class='rparen token'>)</span>
  <span class='setup_address_hash identifier id'>setup_address_hash</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='build_tax_calculation_request identifier id'>build_tax_calculation_request</span><span class='lparen token'>(</span><span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>   
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>capture</h3>
</div><div id="capture-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>capture</span><span class='args'>(money, authorization, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Capture an authorization that has previously been requested
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


114
115
116
117</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 114</span>

<span class='def def kw'>def</span> <span class='capture identifier id'>capture</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='setup_address_hash identifier id'>setup_address_hash</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='build_capture_request identifier id'>build_capture_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>commit</h3>
</div><div id="commit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>commit</span><span class='args'>(request, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Contact CyberSource, make the SOAP request, and parse the reply into a
Response object
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


355
356
357
358
359
360
361
362
363
364
365
366
367
368</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 355</span>

<span class='def def kw'>def</span> <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='ssl_post identifier id'>ssl_post</span><span class='lparen token'>(</span><span class='test? fid id'>test?</span> <span class='integer val'>? </span><span class='TEST_URL constant id'>TEST_URL</span> <span class='colon op'>:</span> <span class='LIVE_URL constant id'>LIVE_URL</span><span class='comma token'>,</span> <span class='build_request identifier id'>build_request</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  
  <span class='success identifier id'>success</span> <span class='assign token'>=</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:decision</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;ACCEPT&quot;</span>
  <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='@@response_codes ivar id'>@@response_codes</span><span class='lbrack token'>[</span><span class='lparen token'>(</span><span class='string val'>'r'</span> <span class='plus op'>+</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:reasonCode</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='rescue rescue kw'>rescue</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> 
  <span class='authorization identifier id'>authorization</span> <span class='assign token'>=</span> <span class='success identifier id'>success</span> <span class='integer val'>? </span><span class='lbrack token'>[</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:requestID</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:requestToken</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;;&quot;</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span>
  
  <span class='Response constant id'>Response</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='success identifier id'>success</span><span class='comma token'>,</span> <span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='comma token'>,</span> 
    <span class='symbol val'>:test</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='test? fid id'>test?</span><span class='comma token'>,</span> 
    <span class='symbol val'>:authorization</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span>
    <span class='symbol val'>:avs_result</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:code</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:avsCode</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='comma token'>,</span>
    <span class='symbol val'>:cvv_result</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:cvCode</span><span class='rbrack token'>]</span>
  <span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>credit</h3>
</div><div id="credit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>credit</span><span class='args'>(money, identification, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


131
132
133</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 131</span>

<span class='def def kw'>def</span> <span class='credit identifier id'>credit</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='identification identifier id'>identification</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='build_credit_request identifier id'>build_credit_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='identification identifier id'>identification</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>parse</h3>
</div><div id="parse-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>parse</span><span class='args'>(xml)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Parse the SOAP response Technique inspired by the Paypal Gateway
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 372</span>

<span class='def def kw'>def</span> <span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='reply identifier id'>reply</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='root identifier id'>root</span> <span class='assign token'>=</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='XPath constant id'>XPath</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='string val'>&quot;//c:replyMessage&quot;</span><span class='rparen token'>)</span>
    <span class='root identifier id'>root</span><span class='dot token'>.</span><span class='elements identifier id'>elements</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='node identifier id'>node</span><span class='bitor op'>|</span>
      <span class='case case kw'>case</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='name identifier id'>name</span>  
      <span class='when when kw'>when</span> <span class='string val'>'c:reasonCode'</span>
        <span class='reply identifier id'>reply</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='reply identifier id'>reply</span><span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='dot token'>.</span><span class='text identifier id'>text</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='parse_element identifier id'>parse_element</span><span class='lparen token'>(</span><span class='reply identifier id'>reply</span><span class='comma token'>,</span> <span class='node identifier id'>node</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='elsif elsif kw'>elsif</span> <span class='root identifier id'>root</span> <span class='assign token'>=</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='XPath constant id'>XPath</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='string val'>&quot;//soap:Fault&quot;</span><span class='rparen token'>)</span> 
    <span class='parse_element identifier id'>parse_element</span><span class='lparen token'>(</span><span class='reply identifier id'>reply</span><span class='comma token'>,</span> <span class='root identifier id'>root</span><span class='rparen token'>)</span>
    <span class='reply identifier id'>reply</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{reply[:faultcode]}: #{reply[:faultstring]}&quot;</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='reply identifier id'>reply</span>
<span class='end end kw'>end</span>     
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>parse_element</h3>
</div><div id="parse_element-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>parse_element</span><span class='args'>(reply, node)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


391
392
393
394
395
396
397
398
399
400
401
402
403</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 391</span>

<span class='def def kw'>def</span> <span class='parse_element identifier id'>parse_element</span><span class='lparen token'>(</span><span class='reply identifier id'>reply</span><span class='comma token'>,</span> <span class='node identifier id'>node</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='has_elements? fid id'>has_elements?</span>
    <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='elements identifier id'>elements</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='e identifier id'>e</span><span class='bitor op'>|</span> <span class='parse_element identifier id'>parse_element</span><span class='lparen token'>(</span><span class='reply identifier id'>reply</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='if if kw'>if</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='match op'>=~</span> <span class='regexp val'>/item/</span>
      <span class='parent identifier id'>parent</span> <span class='assign token'>=</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>&quot;id&quot;</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='string val'>&quot;_&quot;</span> <span class='plus op'>+</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='parent identifier id'>parent</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>&quot;id&quot;</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='string val'>''</span><span class='rparen token'>)</span>
      <span class='reply identifier id'>reply</span><span class='lbrack token'>[</span><span class='lparen token'>(</span><span class='parent identifier id'>parent</span> <span class='plus op'>+</span> <span class='string val'>'_'</span> <span class='plus op'>+</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
    <span class='else else kw'>else</span>  
      <span class='reply identifier id'>reply</span><span class='lbrack token'>[</span><span class='node identifier id'>node</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='reply identifier id'>reply</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>purchase</h3>
</div><div id="purchase-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>purchase</span><span class='args'>(money, creditcard, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Purchase is an auth followed by a capture You must supply an order_id in
the options hash
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


121
122
123
124
125</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 121</span>

<span class='def def kw'>def</span> <span class='purchase identifier id'>purchase</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='symbol val'>:order_id</span><span class='comma token'>,</span> <span class='symbol val'>:email</span><span class='rparen token'>)</span>
  <span class='setup_address_hash identifier id'>setup_address_hash</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='build_purchase_request identifier id'>build_purchase_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>setup_address_hash</h3>
</div><div id="setup_address_hash-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>setup_address_hash</span><span class='args'>(options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create all address hash key value pairs so that we still function if we
were only provided with one or two of them
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


168
169
170
171</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 168</span>

<span class='def def kw'>def</span> <span class='setup_address_hash identifier id'>setup_address_hash</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:billing_address</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:billing_address</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:address</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:shipping_address</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:shipping_address</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>test?</h3>
</div><div id="test%3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>test?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Should run against the test servers or not?
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


100
101
102</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 100</span>

<span class='def def kw'>def</span> <span class='test? fid id'>test?</span>
  <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:test</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='gateway_mode identifier id'>gateway_mode</span> <span class='eq op'>==</span> <span class='symbol val'>:test</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>void</h3>
</div><div id="void-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>void</span><span class='args'>(identification, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


127
128
129</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/cyber_source.rb', line 127</span>

<span class='def def kw'>def</span> <span class='void identifier id'>void</span><span class='lparen token'>(</span><span class='identification identifier id'>identification</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='build_void_request identifier id'>build_void_request</span><span class='lparen token'>(</span><span class='identification identifier id'>identification</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>