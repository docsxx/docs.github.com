<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>evanphx's rubinius - Class: PStore - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/evanphx/commits/rubinius/master" rel="alternate" title="Recent Commits to rubinius:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("evanphx", "rubinius", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("evanphx", "rubinius", "a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/evanphx/rubinius/tree/">Source</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/network">Network</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/evanphx/rubinius">Wiki</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/graphs">Graphs</a></li>                    
            <li class="active"><a href="/evanphx/rubinius">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/evanphx">evanphx</a> / <b><a href="http://github.com/evanphx/rubinius/tree">rubinius</a></b>        
                <a id="namespaces_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class PStore">
  <h1>Class: PStore</h1>
  <div class="section docstring">
  <p>
PStore implements a file based persistance mechanism based on a Hash. User
code can store hierarchies of Ruby objects (values) into the data store
file by name (keys). An object hierarchy may be just a single object. User
code may later read values back from the data store or even update data, as
needed.
</p>
<p>
The transactional behavior ensures that any changes succeed or fail
together. This can be used to ensure that the data store is not left in a
transitory state, where some values were upated but others were not.
</p>
<p>
Behind the scenes, Ruby objects are stored to the data store file with
Marshal. That carries the usual limitations. Proc objects cannot be
marshalled, for example.
</p>
<h2>Usage example:</h2>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>&quot;pstore&quot;</span>

 <span class='comment val'># a mock wiki object...</span>
 <span class='class class kw'>class</span> <span class='WikiPage constant id'>WikiPage</span>
   <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span> <span class='page_name identifier id'>page_name</span><span class='comma token'>,</span> <span class='author identifier id'>author</span><span class='comma token'>,</span> <span class='contents identifier id'>contents</span> <span class='rparen token'>)</span>
     <span class='@page_name ivar id'>@page_name</span> <span class='assign token'>=</span> <span class='page_name identifier id'>page_name</span>
     <span class='@revisions ivar id'>@revisions</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

     <span class='add_revision identifier id'>add_revision</span><span class='lparen token'>(</span><span class='author identifier id'>author</span><span class='comma token'>,</span> <span class='contents identifier id'>contents</span><span class='rparen token'>)</span>
   <span class='end end kw'>end</span>

   <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:page_name</span>

   <span class='def def kw'>def</span> <span class='add_revision identifier id'>add_revision</span><span class='lparen token'>(</span> <span class='author identifier id'>author</span><span class='comma token'>,</span> <span class='contents identifier id'>contents</span> <span class='rparen token'>)</span>
     <span class='@revisions ivar id'>@revisions</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:created</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='comma token'>,</span>
                     <span class='symbol val'>:author</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='author identifier id'>author</span><span class='comma token'>,</span>
                     <span class='symbol val'>:contents</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='contents identifier id'>contents</span> <span class='rbrace token'>}</span>
   <span class='end end kw'>end</span>

   <span class='def def kw'>def</span> <span class='wiki_page_references identifier id'>wiki_page_references</span>
     <span class='lbrack token'>[</span><span class='@page_name ivar id'>@page_name</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='@revisions ivar id'>@revisions</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='lbrack token'>[</span><span class='symbol val'>:contents</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/\b(?:[A-Z]&lt;tt&gt;[a-z]&lt;/</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='rparen token'>)</span><span class='lbrace token'>{</span><span class='integer val'>2</span><span class='comma token'>,</span><span class='rbrace token'>}</span><span class='div op'>/</span><span class='rparen token'>)</span>
   <span class='end end kw'>end</span>

   <span class='comment val'># ...</span>
 <span class='end end kw'>end</span>

 <span class='comment val'># create a new page...</span>
 <span class='home_page identifier id'>home_page</span> <span class='assign token'>=</span> <span class='WikiPage constant id'>WikiPage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;HomePage&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;James Edward Gray II&quot;</span><span class='comma token'>,</span>
                           <span class='string val'>&quot;A page about the JoysOfDocumentation...&quot;</span> <span class='rparen token'>)</span>

 <span class='comment val'># then we want to update page data and the index together, or not at all...</span>
 <span class='wiki identifier id'>wiki</span> <span class='assign token'>=</span> <span class='PStore constant id'>PStore</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;wiki_pages.pstore&quot;</span><span class='rparen token'>)</span>
 <span class='wiki identifier id'>wiki</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>  <span class='comment val'># begin transaction; do all of this or none of it</span>
   <span class='comment val'># store page...</span>
   <span class='wiki identifier id'>wiki</span><span class='lbrack token'>[</span><span class='home_page identifier id'>home_page</span><span class='dot token'>.</span><span class='page_name identifier id'>page_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='home_page identifier id'>home_page</span>
   <span class='comment val'># ensure that an index has been created...</span>
   <span class='wiki identifier id'>wiki</span><span class='lbrack token'>[</span><span class='symbol val'>:wiki_index</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
   <span class='comment val'># update wiki index...</span>
   <span class='wiki identifier id'>wiki</span><span class='lbrack token'>[</span><span class='symbol val'>:wiki_index</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='home_page identifier id'>home_page</span><span class='dot token'>.</span><span class='wiki_page_references identifier id'>wiki_page_references</span><span class='rparen token'>)</span>
 <span class='end end kw'>end</span>                   <span class='comment val'># commit changes to wiki data store file</span>

 <span class='comment val'>### Some time later... ###</span>

 <span class='comment val'># read wiki data...</span>
 <span class='wiki identifier id'>wiki</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>  <span class='comment val'># begin read-only transaction, no changes allowed</span>
   <span class='wiki identifier id'>wiki</span><span class='dot token'>.</span><span class='roots identifier id'>roots</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='data_root_name identifier id'>data_root_name</span><span class='bitor op'>|</span>
     <span class='p identifier id'>p</span> <span class='data_root_name identifier id'>data_root_name</span>
     <span class='p identifier id'>p</span> <span class='wiki identifier id'>wiki</span><span class='lbrack token'>[</span><span class='data_root_name identifier id'>data_root_name</span><span class='rbrack token'>]</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>
</pre>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="RD_ACCESS-constant">RD_ACCESS</dt>
      <dd>File::RDONLY | binmode</dd>
    
      <dt id="RDWR_ACCESS-constant">RDWR_ACCESS</dt>
      <dd>File::RDWR | File::CREAT | binmode</dd>
    
      <dt id="WR_ACCESS-constant">WR_ACCESS</dt>
      <dd>File::WRONLY | File::CREAT | File::TRUNC | binmode</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(file)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
To construct a PStore object, pass in the <em>file</em> path where you
would like the data to be stored.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 94</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L94">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">94
95
96
97
98
99
100
101
102
103
104
105</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
  <span class='dir identifier id'>dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='directory? fid id'>directory?</span> <span class='dir identifier id'>dir</span>
    <span class='raise identifier id'>raise</span> <span class='PStore constant id'>PStore</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='format identifier id'>format</span><span class='lparen token'>(</span><span class='string val'>&quot;directory %s does not exist&quot;</span><span class='comma token'>,</span> <span class='dir identifier id'>dir</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='exist? fid id'>exist?</span> <span class='file identifier id'>file</span> <span class='and and kw'>and</span> <span class='not not kw'>not</span> <span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='readable? fid id'>readable?</span> <span class='file identifier id'>file</span>
    <span class='raise identifier id'>raise</span> <span class='PStore constant id'>PStore</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='format identifier id'>format</span><span class='lparen token'>(</span><span class='string val'>&quot;file %s not readable&quot;</span><span class='comma token'>,</span> <span class='file identifier id'>file</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='@transaction ivar id'>@transaction</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='@filename ivar id'>@filename</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span>
  <span class='@abort ivar id'>@abort</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#-5B-5D-instance_method">#[]</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Retrieves a value from the PStore file data, by <em>name</em>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#-5B-5D-3D-instance_method">#[]=</span><span class='args'>(name, value)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Stores an individual Ruby object or a hierarchy of Ruby objects in the data
store file under the root <em>name</em>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#abort-instance_method">#abort</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Ends the current PStore#transaction, discarding any changes to the data
store.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#commit-instance_method">#commit</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Ends the current PStore#transaction, committing any changes to the data
store immediately.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#delete-instance_method">#delete</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Removes an object hierarchy from the data store, by <em>name</em>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#dump-instance_method">#dump</span><span class='args'>(table)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is just a wrapped around Marshal.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch-instance_method">#fetch</span><span class='args'>(name, default = PStore::Error)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is just like PStore#[], save that you may also provide a
<em>default</em> value for the object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#load-instance_method">#load</span><span class='args'>(content)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is just a wrapped around Marshal.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#load_file-instance_method">#load_file</span><span class='args'>(file)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is just a wrapped around Marshal.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#path-instance_method">#path</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the path to the data store file.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#root-3F-instance_method">#root?</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if the supplied <em>name</em> is currently in the data store.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#roots-instance_method">#roots</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the names of all object hierarchies currently in the store.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#transaction-instance_method">#transaction</span><span class='args'>(read_only = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Opens a new transaction for the data store.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>[]</h3>
</div><div id="-5B-5D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Retrieves a value from the PStore file data, by <em>name</em>. The
hierarchy of Ruby objects stored under that root <em>name</em> will be
returned.
</p>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction. It will
raise PStore::Error if called at any other time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 128</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L128">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">128
129
130
131</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='aref op'>[]</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='in_transaction identifier id'>in_transaction</span>
  <span class='@table ivar id'>@table</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>[]=</h3>
</div><div id="-5B-5D-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]=</span><span class='args'>(name, value)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Stores an individual Ruby object or a hierarchy of Ruby objects in the data
store file under the root <em>name</em>. Assigning to a <em>name</em>
already in the data store clobbers the old data.
</p>
<h2>Example:</h2>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>&quot;pstore&quot;</span>

 <span class='store identifier id'>store</span> <span class='assign token'>=</span> <span class='PStore constant id'>PStore</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;data_file.pstore&quot;</span><span class='rparen token'>)</span>
 <span class='store identifier id'>store</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>  <span class='comment val'># begin transaction</span>
   <span class='comment val'># load some data into the store...</span>
   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:single_object</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;My data...&quot;</span>
   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:obj_heirarchy</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='string val'>&quot;Kev Jackson&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;rational.rb&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;pstore.rb&quot;</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
                             <span class='string val'>&quot;James Gray&quot;</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;erb.rb&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;pstore.rb&quot;</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
 <span class='end end kw'>end</span>                   <span class='comment val'># commit changes to data store file</span>
</pre>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction and it
cannot be read-only. It will raise PStore::Error if called at any other
time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 173</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L173">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">173
174
175
176</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='aset op'>[]=</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='in_transaction_wr identifier id'>in_transaction_wr</span><span class='lparen token'>(</span><span class='rparen token'>)</span>
  <span class='@table ivar id'>@table</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>abort</h3>
</div><div id="abort-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>abort</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Ends the current PStore#transaction, discarding any changes to the data
store.
</p>
<h2>Example:</h2>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>&quot;pstore&quot;</span>

 <span class='store identifier id'>store</span> <span class='assign token'>=</span> <span class='PStore constant id'>PStore</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;data_file.pstore&quot;</span><span class='rparen token'>)</span>
 <span class='store identifier id'>store</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>  <span class='comment val'># begin transaction</span>
   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:one</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>1</span>     <span class='comment val'># this change is not applied, see below...</span>
   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:two</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>2</span>     <span class='comment val'># this change is not applied, see below...</span>

   <span class='store identifier id'>store</span><span class='dot token'>.</span><span class='abort identifier id'>abort</span>         <span class='comment val'># end transaction here, discard all changes</span>

   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:three</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>3</span>   <span class='comment val'># this change is never reached</span>
 <span class='end end kw'>end</span>
</pre>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction. It will
raise PStore::Error if called at any other time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 261</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L261">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">261
262
263
264
265</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='abort identifier id'>abort</span>
  <span class='in_transaction identifier id'>in_transaction</span>
  <span class='@abort ivar id'>@abort</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='throw identifier id'>throw</span> <span class='symbol val'>:pstore_abort_transaction</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>commit</h3>
</div><div id="commit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>commit</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Ends the current PStore#transaction, committing any changes to the data
store immediately.
</p>
<h2>Example:</h2>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>&quot;pstore&quot;</span>

 <span class='store identifier id'>store</span> <span class='assign token'>=</span> <span class='PStore constant id'>PStore</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;data_file.pstore&quot;</span><span class='rparen token'>)</span>
 <span class='store identifier id'>store</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>  <span class='comment val'># begin transaction</span>
   <span class='comment val'># load some data into the store...</span>
   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:one</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:two</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>2</span>

   <span class='store identifier id'>store</span><span class='dot token'>.</span><span class='commit identifier id'>commit</span>        <span class='comment val'># end transaction here, committing changes</span>

   <span class='store identifier id'>store</span><span class='lbrack token'>[</span><span class='symbol val'>:three</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>3</span>   <span class='comment val'># this change is never reached</span>
 <span class='end end kw'>end</span>
</pre>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction. It will
raise PStore::Error if called at any other time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 235</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L235">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">235
236
237
238
239</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='commit identifier id'>commit</span>
  <span class='in_transaction identifier id'>in_transaction</span>
  <span class='@abort ivar id'>@abort</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='throw identifier id'>throw</span> <span class='symbol val'>:pstore_abort_transaction</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>delete</h3>
</div><div id="delete-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>delete</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Removes an object hierarchy from the data store, by <em>name</em>.
</p>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction and it
cannot be read-only. It will raise PStore::Error if called at any other
time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 183</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L183">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">183
184
185
186</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='in_transaction_wr identifier id'>in_transaction_wr</span><span class='lparen token'>(</span><span class='rparen token'>)</span>
  <span class='@table ivar id'>@table</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='name identifier id'>name</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>dump</h3>
</div><div id="dump-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>dump</span><span class='args'>(table)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is just a wrapped around Marshal.dump.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 348</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L348">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">348
349
350</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='table identifier id'>table</span><span class='rparen token'>)</span>  <span class='comment val'># :nodoc:</span>
  <span class='Marshal constant id'>Marshal</span><span class='colon2 op'>::</span><span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='table identifier id'>table</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch</h3>
</div><div id="fetch-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch</span><span class='args'>(name, default = PStore::Error)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is just like PStore#[], save that you may also provide a
<em>default</em> value for the object. In the event the specified
<em>name</em> is not found in the data store, your <em>default</em> will be
returned instead. If you do not specify a default, PStore::Error will be
raised if the object is not found.
</p>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction. It will
raise PStore::Error if called at any other time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 142</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L142">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">142
143
144
145
146
147
148
149
150
151
152</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='default identifier id'>default</span><span class='assign token'>=</span><span class='PStore constant id'>PStore</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='rparen token'>)</span>
  <span class='in_transaction identifier id'>in_transaction</span>
  <span class='unless unless kw'>unless</span> <span class='@table ivar id'>@table</span><span class='dot token'>.</span><span class='key? fid id'>key?</span> <span class='name identifier id'>name</span>
    <span class='if if kw'>if</span> <span class='default identifier id'>default</span><span class='eq op'>==</span><span class='PStore constant id'>PStore</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span>
<span class='raise identifier id'>raise</span> <span class='PStore constant id'>PStore</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='format identifier id'>format</span><span class='lparen token'>(</span><span class='string val'>&quot;undefined root name `%s'&quot;</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
<span class='return return kw'>return</span> <span class='default identifier id'>default</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='@table ivar id'>@table</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>load</h3>
</div><div id="load-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>load</span><span class='args'>(content)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is just a wrapped around Marshal.load.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 353</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L353">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">353
354
355</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='content identifier id'>content</span><span class='rparen token'>)</span>  <span class='comment val'># :nodoc:</span>
  <span class='Marshal constant id'>Marshal</span><span class='colon2 op'>::</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='content identifier id'>content</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>load_file</h3>
</div><div id="load_file-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>load_file</span><span class='args'>(file)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is just a wrapped around Marshal.load.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 358</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L358">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">358
359
360</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='load_file identifier id'>load_file</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>  <span class='comment val'># :nodoc:</span>
  <span class='Marshal constant id'>Marshal</span><span class='colon2 op'>::</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>path</h3>
</div><div id="path-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>path</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the path to the data store file.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 209</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L209">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">209
210
211</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='path identifier id'>path</span>
  <span class='@filename ivar id'>@filename</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>root?</h3>
</div><div id="root-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>root?</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if the supplied <em>name</em> is currently in the data store.
</p>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction. It will
raise PStore::Error if called at any other time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 204</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L204">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">204
205
206
207</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='root? fid id'>root?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='in_transaction identifier id'>in_transaction</span>
  <span class='@table ivar id'>@table</span><span class='dot token'>.</span><span class='key? fid id'>key?</span> <span class='name identifier id'>name</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>roots</h3>
</div><div id="roots-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>roots</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the names of all object hierarchies currently in the store.
</p>
<p>
<b>WARNING</b>: This method is only valid in a PStore#transaction. It will
raise PStore::Error if called at any other time.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 194</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L194">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">194
195
196
197</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='roots identifier id'>roots</span>
  <span class='in_transaction identifier id'>in_transaction</span>
  <span class='@table ivar id'>@table</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>transaction</h3>
</div><div id="transaction-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>transaction</span><span class='args'>(read_only = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Opens a new transaction for the data store. Code executed inside a block
passed to this method may read and write data to and from the data store
file.
</p>
<p>
At the end of the block, changes are committed to the data store
automatically. You may exit the transaction early with a call to either
PStore#commit or PStore#abort. See those methods for details about how
changes are handled. Raising an uncaught Exception in the block is
equivalent to calling PStore#abort.
</p>
<p>
If <em>read_only</em> is set to <tt>true</tt>, you will only be allowed to
read from the data store during the transaction and any attempts to change
the data will raise a PStore::Error.
</p>
<p>
Note that PStore does not support nested transactions.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="PStore/Error.html" title="PStore::Error">PStore::Error</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pstore.rb', line 284</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/pstore.rb#L284">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='transaction identifier id'>transaction</span><span class='lparen token'>(</span><span class='read_only identifier id'>read_only</span><span class='assign token'>=</span><span class='false false kw'>false</span><span class='rparen token'>)</span>  <span class='comment val'># :yields:  pstore</span>
  <span class='raise identifier id'>raise</span> <span class='PStore constant id'>PStore</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='string val'>&quot;nested transaction&quot;</span> <span class='if if_mod kw'>if</span> <span class='@transaction ivar id'>@transaction</span>
  <span class='begin begin kw'>begin</span>
    <span class='@rdonly ivar id'>@rdonly</span> <span class='assign token'>=</span> <span class='read_only identifier id'>read_only</span>
    <span class='@abort ivar id'>@abort</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='@transaction ivar id'>@transaction</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='new_file identifier id'>new_file</span> <span class='assign token'>=</span> <span class='@filename ivar id'>@filename</span> <span class='plus op'>+</span> <span class='string val'>&quot;.new&quot;</span>

    <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='unless unless kw'>unless</span> <span class='read_only identifier id'>read_only</span>
      <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='@filename ivar id'>@filename</span><span class='comma token'>,</span> <span class='RDWR_ACCESS constant id'>RDWR_ACCESS</span><span class='rparen token'>)</span>
      <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='flock identifier id'>flock</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='LOCK_EX constant id'>LOCK_EX</span><span class='rparen token'>)</span>
      <span class='commit_new identifier id'>commit_new</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='FileTest constant id'>FileTest</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='new_file identifier id'>new_file</span><span class='rparen token'>)</span>
      <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='begin begin kw'>begin</span>
        <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='@filename ivar id'>@filename</span><span class='comma token'>,</span> <span class='RD_ACCESS constant id'>RD_ACCESS</span><span class='rparen token'>)</span>
        <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='flock identifier id'>flock</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='LOCK_SH constant id'>LOCK_SH</span><span class='rparen token'>)</span>
        <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='new_file identifier id'>new_file</span><span class='comma token'>,</span> <span class='RD_ACCESS constant id'>RD_ACCESS</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='n identifier id'>n</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='rbrace token'>}</span> <span class='rescue rescue kw'>rescue</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='ENOENT constant id'>ENOENT</span>
        <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='content identifier id'>content</span> <span class='neq op'>!=</span> <span class='string val'>&quot;&quot;</span>
<span class='@table ivar id'>@table</span> <span class='assign token'>=</span> <span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='content identifier id'>content</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='read_only identifier id'>read_only</span>
        <span class='size identifier id'>size</span> <span class='assign token'>=</span> <span class='content identifier id'>content</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
        <span class='md5 identifier id'>md5</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='digest identifier id'>digest</span><span class='lparen token'>(</span><span class='content identifier id'>content</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
<span class='@table ivar id'>@table</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>   <span class='comment val'># unreference huge data</span>

    <span class='begin begin kw'>begin</span>
<span class='catch identifier id'>catch</span><span class='lparen token'>(</span><span class='symbol val'>:pstore_abort_transaction</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span>
<span class='@abort ivar id'>@abort</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
<span class='raise identifier id'>raise</span>
    <span class='ensure ensure kw'>ensure</span>
<span class='if if kw'>if</span> <span class='notop op'>!</span><span class='read_only identifier id'>read_only</span> <span class='and and kw'>and</span> <span class='notop op'>!</span><span class='@abort ivar id'>@abort</span>
        <span class='tmp_file identifier id'>tmp_file</span> <span class='assign token'>=</span> <span class='@filename ivar id'>@filename</span> <span class='plus op'>+</span> <span class='string val'>&quot;.tmp&quot;</span>
  <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='@table ivar id'>@table</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='md5 identifier id'>md5</span> <span class='orop op'>||</span> <span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='content identifier id'>content</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='orop op'>||</span> <span class='md5 identifier id'>md5</span> <span class='neq op'>!=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='digest identifier id'>digest</span><span class='lparen token'>(</span><span class='content identifier id'>content</span><span class='rparen token'>)</span>
          <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='tmp_file identifier id'>tmp_file</span><span class='comma token'>,</span> <span class='WR_ACCESS constant id'>WR_ACCESS</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='content identifier id'>content</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
          <span class='File constant id'>File</span><span class='dot token'>.</span><span class='rename identifier id'>rename</span><span class='lparen token'>(</span><span class='tmp_file identifier id'>tmp_file</span><span class='comma token'>,</span> <span class='new_file identifier id'>new_file</span><span class='rparen token'>)</span>
          <span class='commit_new identifier id'>commit_new</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
        <span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>   <span class='comment val'># unreference huge data</span>
<span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='@table ivar id'>@table</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='@transaction ivar id'>@transaction</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='file identifier id'>file</span>
  <span class='end end kw'>end</span>
  <span class='value identifier id'>value</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>