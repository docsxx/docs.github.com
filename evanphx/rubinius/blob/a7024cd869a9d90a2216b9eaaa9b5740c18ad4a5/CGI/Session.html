<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>evanphx's rubinius - Class: CGI::Session - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/evanphx/commits/rubinius/master" rel="alternate" title="Recent Commits to rubinius:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("evanphx", "rubinius", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("evanphx", "rubinius", "a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/evanphx/rubinius/tree/">Source</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/network">Network</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/evanphx/rubinius">Wiki</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/graphs">Graphs</a></li>                    
            <li class="active"><a href="/evanphx/rubinius">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/evanphx">evanphx</a> / <b><a href="http://github.com/evanphx/rubinius/tree">rubinius</a></b>        
                <a id="namespaces_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class CGI_Session">
  <h1>Class: CGI::Session</h1>
  <div class="section docstring">
  <p>
Class representing an HTTP session. See documentation for the file
cgi/session.rb for an introduction to HTTP sessions.
</p>
<h2>Lifecycle</h2>
<p>
A CGI::Session instance is created from a CGI object. By default, this
CGI::Session instance will start a new session if none currently exists, or
continue the current session for this client if one does exist. The
<tt>new_session</tt> option can be used to either always or never create a
new session. See #new() for more details.
</p>
<p>
#delete() deletes a session from session storage. It does not however
remove the session id from the client. If the client makes another request
with the same id, the effect will be to start a new session with the old
session&#8217;s id.
</p>
<h2>Setting and retrieving session data.</h2>
<p>
The Session class associates data with a session as key-value pairs. This
data can be set and retrieved by indexing the Session instance using
&#8217;[]&#8217;, much the same as hashes (although other hash methods are
not supported).
</p>
<p>
When session processing has been completed for a request, the session
should be closed using the close() method. This will store the
session&#8217;s state to persistent storage. If you want to store the
session&#8217;s state to persistent storage without finishing session
processing for this request, call the update() method.
</p>
<h2>Storing session state</h2>
<p>
The caller can specify what form of storage to use for the session&#8217;s
data with the <tt>database_manager</tt> option to CGI::Session::new. The
following storage classes are provided as part of the standard library:
</p>
<table>
<tr><td valign="top">CGI::Session::FileStore:</td><td>stores data as plain text in a flat file. Only works with String data. This
is the default storage type.

</td></tr>
<tr><td valign="top">CGI::Session::MemoryStore:</td><td>stores data in an in-memory hash. The data only persists for as long as the
current ruby interpreter instance does.

</td></tr>
<tr><td valign="top">CGI::Session::PStore:</td><td>stores data in Marshalled format. Provided by cgi/session/pstore.rb.
Supports data of any type, and provides file-locking and transaction
support.

</td></tr>
</table>
<p>
Custom storage types can also be created by defining a class with the
following methods:
</p>
<pre class="code">
   <span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='session identifier id'>session</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
   <span class='restore identifier id'>restore</span>  <span class='comment val'># returns hash of session data.</span>
   <span class='update identifier id'>update</span>
   <span class='close identifier id'>close</span>
   <span class='delete identifier id'>delete</span>
</pre>
<p>
Changing storage type mid-session does not work. Note in particular that by
default the FileStore and PStore session data files have the same name. If
your application switches from one to the other without making sure that
filenames will be different and clients still have old sessions lying
around in cookies, then things will break nastily!
</p>
<h2>Maintaining the session id.</h2>
<p>
Most session state is maintained on the server. However, a session id must
be passed backwards and forwards between client and server to maintain a
reference to this session state.
</p>
<p>
The simplest way to do this is via cookies. The CGI::Session class provides
transparent support for session id communication via cookies if the client
has cookies enabled.
</p>
<p>
If the client has cookies disabled, the session id must be included as a
parameter of all requests sent by the client to the server. The
CGI::Session class in conjunction with the CGI class will transparently add
the session id as a hidden input field to all forms generated using the
CGI#form() HTML generation method. No built-in support is provided for
other mechanisms, such as URL re-writing. The caller is responsible for
extracting the session id from the session_id attribute and manually
encoding it in URLs and adding it as a hidden input to HTML forms created
by other mechanisms. Also, session expiry is not automatically handled.
</p>
<h2>Examples of use</h2>
<h3>Setting the user&#8217;s name</h3>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'cgi'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'cgi/session'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'cgi/session/pstore'</span>     <span class='comment val'># provides CGI::Session::PStore</span>

  <span class='cgi identifier id'>cgi</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;html4&quot;</span><span class='rparen token'>)</span>

  <span class='session identifier id'>session</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='Session constant id'>Session</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='cgi identifier id'>cgi</span><span class='comma token'>,</span>
      <span class='string val'>'database_manager'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='Session constant id'>Session</span><span class='colon2 op'>::</span><span class='PStore constant id'>PStore</span><span class='comma token'>,</span>  <span class='comment val'># use PStore</span>
      <span class='string val'>'session_key'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'_rb_sess_id'</span><span class='comma token'>,</span>              <span class='comment val'># custom session key</span>
      <span class='string val'>'session_expires'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='plus op'>+</span> <span class='integer val'>30</span> <span class='mult op'>*</span> <span class='integer val'>60</span><span class='comma token'>,</span>     <span class='comment val'># 30 minute timeout</span>
      <span class='string val'>'prefix'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'pstore_sid_'</span><span class='rparen token'>)</span>                   <span class='comment val'># PStore option</span>
  <span class='if if kw'>if</span> <span class='cgi identifier id'>cgi</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='string val'>'user_name'</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='cgi identifier id'>cgi</span><span class='lbrack token'>[</span><span class='string val'>'user_name'</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='string val'>''</span>
      <span class='comment val'># coerce to String: cgi[] returns the</span>
      <span class='comment val'># string-like CGI::QueryExtension::Value</span>
      <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='string val'>'user_name'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='cgi identifier id'>cgi</span><span class='lbrack token'>[</span><span class='string val'>'user_name'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='string val'>'user_name'</span><span class='rbrack token'>]</span>
      <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='string val'>'user_name'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;guest&quot;</span>
  <span class='end end kw'>end</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
</pre>
<h3>Creating a new session safely</h3>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'cgi'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'cgi/session'</span>

  <span class='cgi identifier id'>cgi</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;html4&quot;</span><span class='rparen token'>)</span>

  <span class='comment val'># We make sure to delete an old session if one exists,</span>
  <span class='comment val'># not just to free resources, but to prevent the session</span>
  <span class='comment val'># from being maliciously hijacked later on.</span>
  <span class='begin begin kw'>begin</span>
      <span class='session identifier id'>session</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='Session constant id'>Session</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='cgi identifier id'>cgi</span><span class='comma token'>,</span> <span class='string val'>'new_session'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
      <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span>
  <span class='rescue rescue kw'>rescue</span> <span class='ArgumentError constant id'>ArgumentError</span>  <span class='comment val'># if no old session</span>
  <span class='end end kw'>end</span>
  <span class='session identifier id'>session</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='Session constant id'>Session</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='cgi identifier id'>cgi</span><span class='comma token'>,</span> <span class='string val'>'new_session'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
</pre>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">new_session</td>
          <td class="readwrite">
            [<span id='new_session-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The id of this session.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">session_id</td>
          <td class="readwrite">
            [<span id='session_id-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The id of this session.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(request, option = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create a new CGI::Session object for <tt>request</tt>.
</p>
<p>
<tt>request</tt> is an instance of the <tt>CGI</tt> class (see cgi.rb).
<tt>option</tt> is a hash of options for initialising this CGI::Session
instance. The following options are recognised:
</p>
<table>
<tr><td valign="top">session_key:</td><td>the parameter name used for the session id. Defaults to
&#8216;_session_id&#8217;.

</td></tr>
<tr><td valign="top">session_id:</td><td>the session id to use. If not provided, then it is retrieved from the
<tt>session_key</tt> parameter of the request, or automatically generated
for a new session.

</td></tr>
<tr><td valign="top">new_session:</td><td>if true, force creation of a new session. If not set, a new session is only
created if none currently exists. If false, a new session is never created,
and if none currently exists and the <tt>session_id</tt> option is not set,
an ArgumentError is raised.

</td></tr>
<tr><td valign="top">database_manager:</td><td>the name of the class providing storage facilities for session state
persistence. Built-in support is provided for <tt>FileStore</tt> (the
default), <tt>MemoryStore</tt>, and <tt>PStore</tt> (from
cgi/session/pstore.rb). See the documentation for these classes for more
details.

</td></tr>
</table>
<p>
The following options are also recognised, but only apply if the session id
is stored in a cookie.
</p>
<table>
<tr><td valign="top">session_expires:</td><td>the time the current session expires, as a <tt>Time</tt> object. If not
set, the session will terminate when the user&#8217;s browser is closed.

</td></tr>
<tr><td valign="top">session_domain:</td><td>the hostname domain for which this session is valid. If not set, defaults
to the hostname of the server.

</td></tr>
<tr><td valign="top">session_secure:</td><td>if <tt>true</tt>, this session will only work over HTTPS.

</td></tr>
<tr><td valign="top">session_path:</td><td>the path for which this session applies. Defaults to the directory of the
CGI script.

</td></tr>
</table>
<p>
<tt>option</tt> is also passed on to the session storage class initialiser;
see the documentation for each session storage class for the options they
support.
</p>
<p>
The retrieved or created session is automatically added to <tt>request</tt>
as a cookie, and also to its <tt>output_hidden</tt> table, which is used to
add hidden input elements to forms.
</p>
<p>
<b>WARNING</b> the <tt>output_hidden</tt> fields are surrounded by a
&lt;fieldset&gt; tag in HTML 4 generation, which is <em>not</em> invisible
on many browsers; you may wish to disable the use of fieldsets with code
similar to the following (see
http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-list/37805)
</p>
<pre class="code">
  <span class='cgi identifier id'>cgi</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;html4&quot;</span><span class='rparen token'>)</span>
  <span class='class class kw'>class</span> <span class='lshft op'>&lt;&lt;</span> <span class='cgi identifier id'>cgi</span>
      <span class='undef_method identifier id'>undef_method</span> <span class='symbol val'>:fieldset</span>
  <span class='end end kw'>end</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cgi/session.rb', line 246</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/cgi/session.rb#L246">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='option identifier id'>option</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='@new_session ivar id'>@new_session</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='session_key identifier id'>session_key</span> <span class='assign token'>=</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'session_key'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>'_session_id'</span>
  <span class='session_id identifier id'>session_id</span> <span class='assign token'>=</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'session_id'</span><span class='rbrack token'>]</span>
  <span class='unless unless kw'>unless</span> <span class='session_id identifier id'>session_id</span>
  <span class='if if kw'>if</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'new_session'</span><span class='rbrack token'>]</span>
<span class='session_id identifier id'>session_id</span> <span class='assign token'>=</span> <span class='create_new_id identifier id'>create_new_id</span>
  <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='unless unless kw'>unless</span> <span class='session_id identifier id'>session_id</span>
  <span class='if if kw'>if</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='key? fid id'>key?</span><span class='lparen token'>(</span><span class='session_key identifier id'>session_key</span><span class='rparen token'>)</span>
<span class='session_id identifier id'>session_id</span> <span class='assign token'>=</span> <span class='request identifier id'>request</span><span class='lbrack token'>[</span><span class='session_key identifier id'>session_key</span><span class='rbrack token'>]</span>
<span class='session_id identifier id'>session_id</span> <span class='assign token'>=</span> <span class='session_id identifier id'>session_id</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='if if_mod kw'>if</span> <span class='session_id identifier id'>session_id</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:read</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='unless unless kw'>unless</span> <span class='session_id identifier id'>session_id</span>
<span class='session_id identifier id'>session_id</span><span class='comma token'>,</span> <span class='assign token'>=</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='cookies identifier id'>cookies</span><span class='lbrack token'>[</span><span class='session_key identifier id'>session_key</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='unless unless kw'>unless</span> <span class='session_id identifier id'>session_id</span>
<span class='unless unless kw'>unless</span> <span class='option identifier id'>option</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='string val'>'new_session'</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;session_key `%s' should be supplied&quot;</span><span class='mod op'>%</span><span class='session_key identifier id'>session_key</span>
<span class='end end kw'>end</span>
<span class='session_id identifier id'>session_id</span> <span class='assign token'>=</span> <span class='create_new_id identifier id'>create_new_id</span>
  <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='@session_id ivar id'>@session_id</span> <span class='assign token'>=</span> <span class='session_id identifier id'>session_id</span>
  <span class='dbman identifier id'>dbman</span> <span class='assign token'>=</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'database_manager'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='FileStore constant id'>FileStore</span>
  <span class='begin begin kw'>begin</span>
    <span class='@dbman ivar id'>@dbman</span> <span class='assign token'>=</span> <span class='dbman identifier id'>dbman</span><span class='colon2 op'>::</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='option identifier id'>option</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='NoSession constant id'>NoSession</span>
    <span class='unless unless kw'>unless</span> <span class='option identifier id'>option</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='string val'>'new_session'</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;invalid session_id `%s'&quot;</span><span class='mod op'>%</span><span class='session_id identifier id'>session_id</span>
    <span class='end end kw'>end</span>
    <span class='session_id identifier id'>session_id</span> <span class='assign token'>=</span> <span class='@session_id ivar id'>@session_id</span> <span class='assign token'>=</span> <span class='create_new_id identifier id'>create_new_id</span>
    <span class='retry retry kw'>retry</span>
  <span class='end end kw'>end</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='instance_eval identifier id'>instance_eval</span> <span class='do do kw'>do</span>
  <span class='@output_hidden ivar id'>@output_hidden</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='session_key identifier id'>session_key</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='session_id identifier id'>session_id</span><span class='rbrace token'>}</span> <span class='unless unless_mod kw'>unless</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'no_hidden'</span><span class='rbrack token'>]</span>
  <span class='@output_cookies ivar id'>@output_cookies</span> <span class='assign token'>=</span>  <span class='lbrack token'>[</span>
      <span class='Cookie constant id'>Cookie</span><span class='colon2 op'>::</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;name&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='session_key identifier id'>session_key</span><span class='comma token'>,</span>
      <span class='string val'>&quot;value&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='session_id identifier id'>session_id</span><span class='comma token'>,</span>
      <span class='string val'>&quot;expires&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'session_expires'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='string val'>&quot;domain&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'session_domain'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='string val'>&quot;secure&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'session_secure'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='string val'>&quot;path&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='if if kw'>if</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'session_path'</span><span class='rbrack token'>]</span> <span class='then then kw'>then</span>
      <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'session_path'</span><span class='rbrack token'>]</span>
                <span class='elsif elsif kw'>elsif</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;SCRIPT_NAME&quot;</span><span class='rbrack token'>]</span> <span class='then then kw'>then</span>
      <span class='File constant id'>File</span><span class='colon2 op'>::</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;SCRIPT_NAME&quot;</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='string val'>&quot;&quot;</span>
    <span class='end end kw'>end</span><span class='rparen token'>)</span>
    <span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='option identifier id'>option</span><span class='lbrack token'>[</span><span class='string val'>'no_cookies'</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='@dbprot ivar id'>@dbprot</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='@dbman ivar id'>@dbman</span><span class='rbrack token'>]</span>
  <span class='ObjectSpace constant id'>ObjectSpace</span><span class='colon2 op'>::</span><span class='define_finalizer identifier id'>define_finalizer</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='Session constant id'>Session</span><span class='colon2 op'>::</span><span class='callback identifier id'>callback</span><span class='lparen token'>(</span><span class='@dbprot ivar id'>@dbprot</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#callback-class_method">callback</span><span class='args'>(dbman)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#-5B-5D-instance_method">#[]</span><span class='args'>(key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Retrieve the session data for key <tt>key</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#-5B-5D-3D-instance_method">#[]=</span><span class='args'>(key, val)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Set the session date for key <tt>key</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#close-instance_method">#close</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Store session data on the server and close the session storage.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#delete-instance_method">#delete</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Delete the session from storage.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#update-instance_method">#update</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Store session data on the server.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>callback</h3>
</div><div id="callback-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>callback</span><span class='args'>(dbman)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cgi/session.rb', line 164</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/cgi/session.rb#L164">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">164
165
166
167
168</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='Session constant id'>Session</span><span class='colon2 op'>::</span><span class='callback identifier id'>callback</span><span class='lparen token'>(</span><span class='dbman identifier id'>dbman</span><span class='rparen token'>)</span>  <span class='comment val'>#:nodoc:</span>
  <span class='Proc constant id'>Proc</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lbrace token'>{</span>
  <span class='dbman identifier id'>dbman</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='unless unless_mod kw'>unless</span> <span class='dbman identifier id'>dbman</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>[]</h3>
</div><div id="-5B-5D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]</span><span class='args'>(key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Retrieve the session data for key <tt>key</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cgi/session.rb', line 303</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/cgi/session.rb#L303">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">303
304
305
306</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='aref op'>[]</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='@data ivar id'>@data</span> <span class='opasgn op'>||=</span> <span class='@dbman ivar id'>@dbman</span><span class='dot token'>.</span><span class='restore identifier id'>restore</span>
  <span class='@data ivar id'>@data</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>[]=</h3>
</div><div id="-5B-5D-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]=</span><span class='args'>(key, val)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Set the session date for key <tt>key</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cgi/session.rb', line 309</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/cgi/session.rb#L309">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">309
310
311
312
313</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='aset op'>[]=</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='rparen token'>)</span>
  <span class='@write_lock ivar id'>@write_lock</span> <span class='opasgn op'>||=</span> <span class='true true kw'>true</span>
  <span class='@data ivar id'>@data</span> <span class='opasgn op'>||=</span> <span class='@dbman ivar id'>@dbman</span><span class='dot token'>.</span><span class='restore identifier id'>restore</span>
  <span class='@data ivar id'>@data</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>close</h3>
</div><div id="close-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>close</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Store session data on the server and close the session storage. For some
session storage types, this is a no-op.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cgi/session.rb', line 323</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/cgi/session.rb#L323">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">323
324
325
326</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='close identifier id'>close</span>
  <span class='@dbman ivar id'>@dbman</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='@dbprot ivar id'>@dbprot</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>delete</h3>
</div><div id="delete-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>delete</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Delete the session from storage. Also closes the storage.
</p>
<p>
Note that the session&#8217;s data is <em>not</em> automatically deleted
upon the session expiring.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cgi/session.rb', line 332</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/cgi/session.rb#L332">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">332
333
334
335</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='delete identifier id'>delete</span>
  <span class='@dbman ivar id'>@dbman</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span>
  <span class='@dbprot ivar id'>@dbprot</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>update</h3>
</div><div id="update-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>update</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Store session data on the server. For some session storage types, this is a
no-op.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cgi/session.rb', line 317</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/cgi/session.rb#L317">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">317
318
319</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='update identifier id'>update</span>  
  <span class='@dbman ivar id'>@dbman</span><span class='dot token'>.</span><span class='update identifier id'>update</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>