<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>evanphx's rubinius - Class: SexpProcessor - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/evanphx/commits/rubinius/master" rel="alternate" title="Recent Commits to rubinius:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("evanphx", "rubinius", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("evanphx", "rubinius", "a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/evanphx/rubinius/tree/">Source</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/network">Network</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/evanphx/rubinius">Wiki</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/graphs">Graphs</a></li>                    
            <li class="active"><a href="/evanphx/rubinius">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/evanphx">evanphx</a> / <b><a href="http://github.com/evanphx/rubinius/tree">rubinius</a></b>        
                <a id="namespaces_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class SexpProcessor">
  <h1>Class: SexpProcessor</h1>
  <div class="section docstring">
  <p>
SexpProcessor provides a uniform interface to process Sexps.
</p>
<p>
In order to create your own SexpProcessor subclass you&#8217;ll need to
call super in the initialize method, then set any of the Sexp flags you
want to be different from the defaults.
</p>
<p>
SexpProcessor uses a Sexp&#8217;s type to determine which process method to
call in the subclass. For Sexp <tt>s(:lit, 1)</tt> SexpProcessor will call
#process_lit, if it is defined.
</p>
<p>
You can also specify a default method to call for any Sexp types without a
process_&lt;type&gt; method or use the default processor provided to skip
over them.
</p>
<p>
Here is a simple example:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='MyProcessor constant id'>MyProcessor</span> <span class='lt op'>&lt;</span> <span class='SexpProcessor constant id'>SexpProcessor</span>
    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
      <span class='super super kw'>super</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='strict identifier id'>strict</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='process_lit identifier id'>process_lit</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
      <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
      <span class='return return kw'>return</span> <span class='val identifier id'>val</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">auto_shift_type</td>
          <td class="readwrite">
            [<span id='auto_shift_type-instance_method'>R</span><span id='auto_shift_type=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Automatically shifts off the Sexp type before handing the Sexp to
process_&lt;type&gt;.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">context</td>
          <td class="readwrite">
            [<span id='context-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Return a stack of contexts.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">debug</td>
          <td class="readwrite">
            [<span id='debug-instance_method'>R</span><span id='debug=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
A Hash of Sexp types and Regexp.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">default_method</td>
          <td class="readwrite">
            [<span id='default_method-instance_method'>R</span><span id='default_method=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
A default method to call if a process_&lt;type&gt; method is not found for
the Sexp type.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">env</td>
          <td class="readwrite">
            [<span id='env-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
A scoped environment to make you happy.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">expected</td>
          <td class="readwrite">
            [<span id='expected-instance_method'>R</span><span id='expected=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Expected result class.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">require_empty</td>
          <td class="readwrite">
            [<span id='require_empty-instance_method'>R</span><span id='require_empty=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Raise an exception if the Sexp is not empty after processing.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">strict</td>
          <td class="readwrite">
            [<span id='strict-instance_method'>R</span><span id='strict=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Raise an exception if no process_&lt;type&gt; method is found for a Sexp.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">unsupported</td>
          <td class="readwrite">
            [<span id='unsupported-instance_method'>R</span><span id='unsupported=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
An array that specifies node types that are unsupported by this processor.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">warn_on_default</td>
          <td class="readwrite">
            [<span id='warn_on_default-instance_method'>R</span><span id='warn_on_default=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Emit a warning when the method in #default_method is called.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="VERSION-constant">VERSION</dt>
      <dd>'3.0.0'</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates a new SexpProcessor. Use super to invoke this initializer from
SexpProcessor subclasses, then use the attributes above to customize the
functionality of the SexpProcessor
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 108</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L108">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
  <span class='@default_method ivar id'>@default_method</span>      <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='@warn_on_default ivar id'>@warn_on_default</span>     <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='@auto_shift_type ivar id'>@auto_shift_type</span>     <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='@strict ivar id'>@strict</span>              <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='@unsupported ivar id'>@unsupported</span>         <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='symbol val'>:alloca</span><span class='comma token'>,</span> <span class='symbol val'>:cfunc</span><span class='comma token'>,</span> <span class='symbol val'>:cref</span><span class='comma token'>,</span> <span class='symbol val'>:ifunc</span><span class='comma token'>,</span> <span class='symbol val'>:last</span><span class='comma token'>,</span> <span class='symbol val'>:memo</span><span class='comma token'>,</span>
                          <span class='symbol val'>:newline</span><span class='comma token'>,</span> <span class='symbol val'>:opt_n</span><span class='comma token'>,</span> <span class='symbol val'>:method</span><span class='rbrack token'>]</span>
  <span class='@unsupported_checked ivar id'>@unsupported_checked</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='@debug ivar id'>@debug</span>               <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@expected ivar id'>@expected</span>            <span class='assign token'>=</span> <span class='Sexp constant id'>Sexp</span>
  <span class='@require_empty ivar id'>@require_empty</span>       <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='@exceptions ivar id'>@exceptions</span>          <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='comment val'># we do this on an instance basis so we can subclass it for</span>
  <span class='comment val'># different processors.</span>
  <span class='@processors ivar id'>@processors</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@rewriters ivar id'>@rewriters</span>  <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@context ivar id'>@context</span>    <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='public_methods identifier id'>public_methods</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='bitor op'>|</span>
    <span class='case case kw'>case</span> <span class='name identifier id'>name</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^process_(.*)/</span> <span class='then then kw'>then</span>
      <span class='@processors ivar id'>@processors</span><span class='lbrack token'>[</span><span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='intern identifier id'>intern</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='intern identifier id'>intern</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^rewrite_(.*)/</span> <span class='then then kw'>then</span>
      <span class='@rewriters ivar id'>@rewriters</span><span class='lbrack token'>[</span><span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='intern identifier id'>intern</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='intern identifier id'>intern</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#assert_empty-instance_method">#assert_empty</span><span class='args'>(meth, exp, exp_orig)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#assert_type-instance_method">#assert_type</span><span class='args'>(list, typ)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Raises unless the Sexp type for <tt>list</tt> matches <tt>typ</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#error_handler-instance_method">#error_handler</span><span class='args'>(type, exp = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#on_error_in-instance_method">#on_error_in</span><span class='args'>(node_type, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Registers an error handler for <tt>node</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process-instance_method">#process</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Default Sexp processor.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_dummy-instance_method">#process_dummy</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
A fairly generic processor for a dummy node.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#rewrite-instance_method">#rewrite</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#scope-instance_method">#scope</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Add a scope level to the current env.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>assert_empty</h3>
</div><div id="assert_empty-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>assert_empty</span><span class='args'>(meth, exp, exp_orig)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 137</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L137">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">137
138
139
140
141
142
143</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='assert_empty identifier id'>assert_empty</span><span class='lparen token'>(</span><span class='meth identifier id'>meth</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='exp_orig identifier id'>exp_orig</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='then then kw'>then</span>
    <span class='msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;exp not empty after #{self.class}.#{meth} on #{exp.inspect}&quot;</span>
    <span class='msg identifier id'>msg</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; from #{exp_orig.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='$DEBUG gvar id'>$DEBUG</span>
    <span class='raise identifier id'>raise</span> <span class='NotEmptyError constant id'>NotEmptyError</span><span class='comma token'>,</span> <span class='msg identifier id'>msg</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>assert_type</h3>
</div><div id="assert_type-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>assert_type</span><span class='args'>(list, typ)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Raises unless the Sexp type for <tt>list</tt> matches <tt>typ</tt>
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="SexpProcessor/SexpTypeError.html" title="SexpTypeError">SexpTypeError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 263</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L263">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">263
264
265
266</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='assert_type identifier id'>assert_type</span><span class='lparen token'>(</span><span class='list identifier id'>list</span><span class='comma token'>,</span> <span class='typ identifier id'>typ</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='SexpTypeError constant id'>SexpTypeError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Expected type #{typ.inspect} in #{list.inspect}&quot;</span> <span class='if if_mod kw'>if</span>
    <span class='not not kw'>not</span> <span class='Array constant id'>Array</span> <span class='eqq op'>===</span> <span class='list identifier id'>list</span> <span class='or or kw'>or</span> <span class='list identifier id'>list</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='neq op'>!=</span> <span class='typ identifier id'>typ</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>error_handler</h3>
</div><div id="error_handler-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>error_handler</span><span class='args'>(type, exp = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 268</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L268">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">268
269
270
271
272
273
274
275
276
277
278
279</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='error_handler identifier id'>error_handler</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span> <span class='comment val'># :nodoc:</span>
  <span class='begin begin kw'>begin</span>
    <span class='return return kw'>return</span> <span class='yield yield kw'>yield</span>
  <span class='rescue rescue kw'>rescue</span> <span class='StandardError constant id'>StandardError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
    <span class='if if kw'>if</span> <span class='@exceptions ivar id'>@exceptions</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='type identifier id'>type</span> <span class='then then kw'>then</span>
      <span class='return return kw'>return</span> <span class='@exceptions ivar id'>@exceptions</span><span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;#{err.class} Exception thrown while processing #{type} for sexp #{exp.inspect} #{caller.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='$DEBUG gvar id'>$DEBUG</span>
      <span class='raise identifier id'>raise</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>on_error_in</h3>
</div><div id="on_error_in-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>on_error_in</span><span class='args'>(node_type, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Registers an error handler for <tt>node</tt>
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 284</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L284">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">284
285
286</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='on_error_in identifier id'>on_error_in</span><span class='lparen token'>(</span><span class='node_type identifier id'>node_type</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='@exceptions ivar id'>@exceptions</span><span class='lbrack token'>[</span><span class='node_type identifier id'>node_type</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process</h3>
</div><div id="process-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Default Sexp processor. Invokes process_&lt;type&gt; methods matching the
Sexp type given. Performs additional checks as specified by the
initializer.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="SexpProcessor/UnsupportedNodeError.html" title="UnsupportedNodeError">UnsupportedNodeError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 169</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L169">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='exp identifier id'>exp</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='rewrite identifier id'>rewrite</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

    <span class='unless unless kw'>unless</span> <span class='@unsupported_checked ivar id'>@unsupported_checked</span> <span class='then then kw'>then</span>
      <span class='m identifier id'>m</span> <span class='assign token'>=</span> <span class='public_methods identifier id'>public_methods</span><span class='dot token'>.</span><span class='grep identifier id'>grep</span><span class='lparen token'>(</span><span class='regexp val'>/^process_/</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='o identifier id'>o</span><span class='bitor op'>|</span> <span class='o identifier id'>o</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/^process_/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='intern identifier id'>intern</span> <span class='rbrace token'>}</span>
      <span class='supported identifier id'>supported</span> <span class='assign token'>=</span> <span class='m identifier id'>m</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='m identifier id'>m</span> <span class='minus op'>-</span> <span class='@unsupported ivar id'>@unsupported</span><span class='rparen token'>)</span>

      <span class='raise identifier id'>raise</span> <span class='UnsupportedNodeError constant id'>UnsupportedNodeError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{supported.inspect} shouldn't be in @unsupported&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='supported identifier id'>supported</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

      <span class='@unsupported_checked ivar id'>@unsupported_checked</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='end end kw'>end</span>

    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='expected identifier id'>expected</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

    <span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;type should be a Symbol, not: #{exp.first.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span>
      <span class='Symbol constant id'>Symbol</span> <span class='eqq op'>===</span> <span class='type identifier id'>type</span>

    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='type identifier id'>type</span>

    <span class='if if kw'>if</span> <span class='@debug ivar id'>@debug</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='type identifier id'>type</span> <span class='then then kw'>then</span>
      <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span>
      <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;// DEBUG: #{str}&quot;</span> <span class='if if_mod kw'>if</span> <span class='str identifier id'>str</span> <span class='match op'>=~</span> <span class='@debug ivar id'>@debug</span><span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='exp_orig identifier id'>exp_orig</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='exp_orig identifier id'>exp_orig</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='deep_clone identifier id'>deep_clone</span> <span class='if if_mod kw'>if</span> <span class='$DEBUG gvar id'>$DEBUG</span> <span class='or or kw'>or</span>
      <span class='@debug ivar id'>@debug</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='type identifier id'>type</span> <span class='or or kw'>or</span> <span class='@exceptions ivar id'>@exceptions</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='rparen token'>)</span>

    <span class='raise identifier id'>raise</span> <span class='UnsupportedNodeError constant id'>UnsupportedNodeError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;'#{type}' is not a supported node type&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='@unsupported ivar id'>@unsupported</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='type identifier id'>type</span>

    <span class='if if kw'>if</span> <span class='@debug ivar id'>@debug</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='type identifier id'>type</span> <span class='then then kw'>then</span>
      <span class='str identifier id'>str</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span>
      <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;// DEBUG (rewritten): #{str}&quot;</span> <span class='if if_mod kw'>if</span> <span class='str identifier id'>str</span> <span class='match op'>=~</span> <span class='@debug ivar id'>@debug</span><span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># now do a pass with the real processor (or generic)</span>
    <span class='meth identifier id'>meth</span> <span class='assign token'>=</span> <span class='@processors ivar id'>@processors</span><span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='@default_method ivar id'>@default_method</span>
    <span class='if if kw'>if</span> <span class='meth identifier id'>meth</span> <span class='then then kw'>then</span>

      <span class='if if kw'>if</span> <span class='@warn_on_default ivar id'>@warn_on_default</span> <span class='and and kw'>and</span> <span class='meth identifier id'>meth</span> <span class='eq op'>==</span> <span class='@default_method ivar id'>@default_method</span> <span class='then then kw'>then</span>
        <span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;WARNING: Using default method #{meth} for #{type}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span> <span class='if if_mod kw'>if</span> <span class='@auto_shift_type ivar id'>@auto_shift_type</span> <span class='and and kw'>and</span> <span class='meth identifier id'>meth</span> <span class='neq op'>!=</span> <span class='@default_method ivar id'>@default_method</span>

      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='error_handler identifier id'>error_handler</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='exp_orig identifier id'>exp_orig</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='meth identifier id'>meth</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='raise identifier id'>raise</span> <span class='SexpTypeError constant id'>SexpTypeError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Result must be a #{@expected}, was #{result.class}:#{result.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='@expected ivar id'>@expected</span> <span class='eqq op'>===</span> <span class='result identifier id'>result</span>

      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='assert_empty identifier id'>assert_empty</span><span class='lparen token'>(</span><span class='meth identifier id'>meth</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='exp_orig identifier id'>exp_orig</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@require_empty ivar id'>@require_empty</span>
    <span class='else else kw'>else</span>
      <span class='unless unless kw'>unless</span> <span class='@strict ivar id'>@strict</span> <span class='then then kw'>then</span>
        <span class='until until kw'>until</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='do do kw'>do</span>
          <span class='sub_exp identifier id'>sub_exp</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
          <span class='sub_result identifier id'>sub_result</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
          <span class='if if kw'>if</span> <span class='Array constant id'>Array</span> <span class='eqq op'>===</span> <span class='sub_exp identifier id'>sub_exp</span> <span class='then then kw'>then</span>
            <span class='sub_result identifier id'>sub_result</span> <span class='assign token'>=</span> <span class='error_handler identifier id'>error_handler</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='exp_orig identifier id'>exp_orig</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
              <span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='sub_exp identifier id'>sub_exp</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
            <span class='raise identifier id'>raise</span> <span class='string val'>&quot;Result is a bad type&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='Array constant id'>Array</span> <span class='eqq op'>===</span> <span class='sub_exp identifier id'>sub_exp</span>
            <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Result does not have a type in front: #{sub_exp.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='Symbol constant id'>Symbol</span> <span class='eqq op'>===</span> <span class='sub_exp identifier id'>sub_exp</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='unless unless_mod kw'>unless</span> <span class='sub_exp identifier id'>sub_exp</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
          <span class='else else kw'>else</span>
            <span class='sub_result identifier id'>sub_result</span> <span class='assign token'>=</span> <span class='sub_exp identifier id'>sub_exp</span>
          <span class='end end kw'>end</span>
          <span class='result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='sub_result identifier id'>sub_result</span>
        <span class='end end kw'>end</span>

        <span class='comment val'># NOTE: this is costly, but we are in the generic processor</span>
        <span class='comment val'># so we shouldn't hit it too much with RubyToC stuff at least.</span>
        <span class='comment val'>#if Sexp === exp and not exp.sexp_type.nil? then</span>
        <span class='begin begin kw'>begin</span>
          <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='sexp_type identifier id'>sexp_type</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='sexp_type identifier id'>sexp_type</span>
        <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span>
          <span class='comment val'># nothing to do, on purpose</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;Bug! Unknown node-type #{type.inspect} to #{self.class}&quot;</span>
        <span class='msg identifier id'>msg</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; in #{exp_orig.inspect} from #{caller.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='$DEBUG gvar id'>$DEBUG</span>
        <span class='raise identifier id'>raise</span> <span class='UnknownNodeError constant id'>UnknownNodeError</span><span class='comma token'>,</span> <span class='msg identifier id'>msg</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
    <span class='result identifier id'>result</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Raises unless the Sexp type for +list+ matches +typ+</span>

  <span class='def def kw'>def</span> <span class='assert_type identifier id'>assert_type</span><span class='lparen token'>(</span><span class='list identifier id'>list</span><span class='comma token'>,</span> <span class='typ identifier id'>typ</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='SexpTypeError constant id'>SexpTypeError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Expected type #{typ.inspect} in #{list.inspect}&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='not not kw'>not</span> <span class='Array constant id'>Array</span> <span class='eqq op'>===</span> <span class='list identifier id'>list</span> <span class='or or kw'>or</span> <span class='list identifier id'>list</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='neq op'>!=</span> <span class='typ identifier id'>typ</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='error_handler identifier id'>error_handler</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span> <span class='comment val'># :nodoc:</span>
    <span class='begin begin kw'>begin</span>
      <span class='return return kw'>return</span> <span class='yield yield kw'>yield</span>
    <span class='rescue rescue kw'>rescue</span> <span class='StandardError constant id'>StandardError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
      <span class='if if kw'>if</span> <span class='@exceptions ivar id'>@exceptions</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='type identifier id'>type</span> <span class='then then kw'>then</span>
        <span class='return return kw'>return</span> <span class='@exceptions ivar id'>@exceptions</span><span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;#{err.class} Exception thrown while processing #{type} for sexp #{exp.inspect} #{caller.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='$DEBUG gvar id'>$DEBUG</span>
        <span class='raise identifier id'>raise</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Registers an error handler for +node+</span>

  <span class='def def kw'>def</span> <span class='on_error_in identifier id'>on_error_in</span><span class='lparen token'>(</span><span class='node_type identifier id'>node_type</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='@exceptions ivar id'>@exceptions</span><span class='lbrack token'>[</span><span class='node_type identifier id'>node_type</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># A fairly generic processor for a dummy node. Dummy nodes are used</span>
  <span class='comment val'># when your processor is doing a complicated rewrite that replaces</span>
  <span class='comment val'># the current sexp with multiple sexps.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Bogus Example:</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   def process_something(exp)</span>
  <span class='comment val'>#     return s(:dummy, process(exp), s(:extra, 42))</span>
  <span class='comment val'>#   end</span>

  <span class='def def kw'>def</span> <span class='process_dummy identifier id'>process_dummy</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='@expected ivar id'>@expected</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:dummy</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='@expected ivar id'>@expected</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

    <span class='until until kw'>until</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='do do kw'>do</span>
      <span class='result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='result identifier id'>result</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Add a scope level to the current env. Eg:</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   def process_defn exp</span>
  <span class='comment val'>#     name = exp.shift</span>
  <span class='comment val'>#     args = process(exp.shift)</span>
  <span class='comment val'>#     scope do</span>
  <span class='comment val'>#       body = process(exp.shift)</span>
  <span class='comment val'>#       # ...</span>
  <span class='comment val'>#     end</span>
  <span class='comment val'>#   end</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   env[:x] = 42</span>
  <span class='comment val'>#   scope do</span>
  <span class='comment val'>#     env[:x]       # =&gt; 42</span>
  <span class='comment val'>#     env[:y] = 24</span>
  <span class='comment val'>#   end</span>
  <span class='comment val'>#   env[:y]         # =&gt; nil</span>

  <span class='def def kw'>def</span> <span class='scope identifier id'>scope</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
    <span class='env identifier id'>env</span><span class='dot token'>.</span><span class='scope identifier id'>scope</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># I really hate this here, but I hate subdirs in my lib dir more...</span>
  <span class='comment val'># I guess it is kinda like shaving... I'll split this out when it</span>
  <span class='comment val'># itches too much...</span>

  <span class='class class kw'>class</span> <span class='Environment constant id'>Environment</span>
    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
      <span class='@env ivar id'>@env</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='all identifier id'>all</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='env identifier id'>env</span><span class='comma token'>,</span> <span class='scope identifier id'>scope</span><span class='bitor op'>|</span> <span class='env identifier id'>env</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span> <span class='scope identifier id'>scope</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='depth identifier id'>depth</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># TODO: depth_of</span>

    <span class='def def kw'>def</span> <span class='aref op'>[]</span> <span class='name identifier id'>name</span>
      <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='closure identifier id'>closure</span><span class='bitor op'>|</span> <span class='closure identifier id'>closure</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
      <span class='hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='hash identifier id'>hash</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='aset op'>[]=</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='val identifier id'>val</span>
      <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='closure identifier id'>closure</span><span class='bitor op'>|</span> <span class='closure identifier id'>closure</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='name identifier id'>name</span> <span class='rbrace token'>}</span> <span class='orop op'>||</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='scope identifier id'>scope</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
      <span class='begin begin kw'>begin</span>
        <span class='yield yield kw'>yield</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
        <span class='raise identifier id'>raise</span> <span class='string val'>&quot;You went too far unextending env&quot;</span> <span class='if if_mod kw'>if</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>

<span class='class class kw'>class</span> <span class='Object constant id'>Object</span>

  <span class='comment val'>##</span>
  <span class='comment val'># deep_clone is the usual Marshalling hack to make a deep copy.</span>
  <span class='comment val'># It is rather slow, so use it sparingly. Helps with debugging</span>
  <span class='comment val'># SexpProcessors since you usually shift off sexps.</span>

  <span class='def def kw'>def</span> <span class='deep_clone identifier id'>deep_clone</span>
    <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># SexpProcessor base exception class.</span>

<span class='class class kw'>class</span> <span class='SexpProcessorError constant id'>SexpProcessorError</span> <span class='lt op'>&lt;</span> <span class='StandardError constant id'>StandardError</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Raised by SexpProcessor if it sees a node type listed in its</span>
<span class='comment val'># unsupported list.</span>

<span class='class class kw'>class</span> <span class='UnsupportedNodeError constant id'>UnsupportedNodeError</span> <span class='lt op'>&lt;</span> <span class='SexpProcessorError constant id'>SexpProcessorError</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Raised by SexpProcessor if it is in strict mode and sees a node for</span>
<span class='comment val'># which there is no processor available.</span>

<span class='class class kw'>class</span> <span class='UnknownNodeError constant id'>UnknownNodeError</span> <span class='lt op'>&lt;</span> <span class='SexpProcessorError constant id'>SexpProcessorError</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Raised by SexpProcessor if a processor did not process every node in</span>
<span class='comment val'># a sexp and @require_empty is true.</span>

<span class='class class kw'>class</span> <span class='NotEmptyError constant id'>NotEmptyError</span> <span class='lt op'>&lt;</span> <span class='SexpProcessorError constant id'>SexpProcessorError</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>

<span class='comment val'>##</span>
<span class='comment val'># Raised if assert_type encounters an unexpected sexp type.</span>

<span class='class class kw'>class</span> <span class='SexpTypeError constant id'>SexpTypeError</span> <span class='lt op'>&lt;</span> <span class='SexpProcessorError constant id'>SexpProcessorError</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_dummy</h3>
</div><div id="process_dummy-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_dummy</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
A fairly generic processor for a dummy node. Dummy nodes are used when your
processor is doing a complicated rewrite that replaces the current sexp
with multiple sexps.
</p>
<p>
Bogus Example:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='process_something identifier id'>process_something</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='s identifier id'>s</span><span class='lparen token'>(</span><span class='symbol val'>:dummy</span><span class='comma token'>,</span> <span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='s identifier id'>s</span><span class='lparen token'>(</span><span class='symbol val'>:extra</span><span class='comma token'>,</span> <span class='integer val'>42</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 299</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L299">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_dummy identifier id'>process_dummy</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='@expected ivar id'>@expected</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:dummy</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='@expected ivar id'>@expected</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

    <span class='until until kw'>until</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='do do kw'>do</span>
      <span class='result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='result identifier id'>result</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Add a scope level to the current env. Eg:</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   def process_defn exp</span>
  <span class='comment val'>#     name = exp.shift</span>
  <span class='comment val'>#     args = process(exp.shift)</span>
  <span class='comment val'>#     scope do</span>
  <span class='comment val'>#       body = process(exp.shift)</span>
  <span class='comment val'>#       # ...</span>
  <span class='comment val'>#     end</span>
  <span class='comment val'>#   end</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   env[:x] = 42</span>
  <span class='comment val'>#   scope do</span>
  <span class='comment val'>#     env[:x]       # =&gt; 42</span>
  <span class='comment val'>#     env[:y] = 24</span>
  <span class='comment val'>#   end</span>
  <span class='comment val'>#   env[:y]         # =&gt; nil</span>

  <span class='def def kw'>def</span> <span class='scope identifier id'>scope</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
    <span class='env identifier id'>env</span><span class='dot token'>.</span><span class='scope identifier id'>scope</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># I really hate this here, but I hate subdirs in my lib dir more...</span>
  <span class='comment val'># I guess it is kinda like shaving... I'll split this out when it</span>
  <span class='comment val'># itches too much...</span>

  <span class='class class kw'>class</span> <span class='Environment constant id'>Environment</span>
    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
      <span class='@env ivar id'>@env</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='all identifier id'>all</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='reverse identifier id'>reverse</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='env identifier id'>env</span><span class='comma token'>,</span> <span class='scope identifier id'>scope</span><span class='bitor op'>|</span> <span class='env identifier id'>env</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span> <span class='scope identifier id'>scope</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='depth identifier id'>depth</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># TODO: depth_of</span>

    <span class='def def kw'>def</span> <span class='aref op'>[]</span> <span class='name identifier id'>name</span>
      <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='closure identifier id'>closure</span><span class='bitor op'>|</span> <span class='closure identifier id'>closure</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
      <span class='hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='hash identifier id'>hash</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='aset op'>[]=</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='val identifier id'>val</span>
      <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='closure identifier id'>closure</span><span class='bitor op'>|</span> <span class='closure identifier id'>closure</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='name identifier id'>name</span> <span class='rbrace token'>}</span> <span class='orop op'>||</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='scope identifier id'>scope</span>
      <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
      <span class='begin begin kw'>begin</span>
        <span class='yield yield kw'>yield</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
        <span class='raise identifier id'>raise</span> <span class='string val'>&quot;You went too far unextending env&quot;</span> <span class='if if_mod kw'>if</span> <span class='@env ivar id'>@env</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>rewrite</h3>
</div><div id="rewrite-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>rewrite</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 145</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L145">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='rewrite identifier id'>rewrite</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
  <span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='first identifier id'>first</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='type identifier id'>type</span>

  <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='map! fid id'>map!</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='sub identifier id'>sub</span><span class='bitor op'>|</span> <span class='Array constant id'>Array</span> <span class='eqq op'>===</span> <span class='sub identifier id'>sub</span> <span class='integer val'>? </span><span class='rewrite identifier id'>rewrite</span><span class='lparen token'>(</span><span class='sub identifier id'>sub</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='sub identifier id'>sub</span> <span class='rbrace token'>}</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>

  <span class='begin begin kw'>begin</span>
    <span class='meth identifier id'>meth</span> <span class='assign token'>=</span> <span class='@rewriters ivar id'>@rewriters</span><span class='lbrack token'>[</span><span class='type identifier id'>type</span><span class='rbrack token'>]</span>
    <span class='exp identifier id'>exp</span>  <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='meth identifier id'>meth</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='meth identifier id'>meth</span>
    <span class='break break kw'>break</span> <span class='unless unless_mod kw'>unless</span> <span class='Sexp constant id'>Sexp</span> <span class='eqq op'>===</span> <span class='exp identifier id'>exp</span>
    <span class='old_type identifier id'>old_type</span><span class='comma token'>,</span> <span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='end end kw'>end</span> <span class='until until_mod kw'>until</span> <span class='old_type identifier id'>old_type</span> <span class='eq op'>==</span> <span class='type identifier id'>type</span>

  <span class='exp identifier id'>exp</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>scope</h3>
</div><div id="scope-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>scope</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Add a scope level to the current env. Eg:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='process_defn identifier id'>process_defn</span> <span class='exp identifier id'>exp</span>
    <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
    <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span><span class='rparen token'>)</span>
    <span class='scope identifier id'>scope</span> <span class='do do kw'>do</span>
      <span class='body identifier id'>body</span> <span class='assign token'>=</span> <span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span><span class='rparen token'>)</span>
      <span class='comment val'># ...</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='symbol val'>:x</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>42</span>
  <span class='scope identifier id'>scope</span> <span class='do do kw'>do</span>
    <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='symbol val'>:x</span><span class='rbrack token'>]</span>       <span class='comment val'># =&gt; 42</span>
    <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='symbol val'>:y</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>24</span>
  <span class='end end kw'>end</span>
  <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='symbol val'>:y</span><span class='rbrack token'>]</span>         <span class='comment val'># =&gt; nil</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sexp_processor.rb', line 328</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/sexp_processor.rb#L328">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">328
329
330</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='scope identifier id'>scope</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='env identifier id'>env</span><span class='dot token'>.</span><span class='scope identifier id'>scope</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>