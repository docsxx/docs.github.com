<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>evanphx's rubinius - Class: Gem::RemoteFetcher - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/evanphx/commits/rubinius/master" rel="alternate" title="Recent Commits to rubinius:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("evanphx", "rubinius", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("evanphx", "rubinius", "a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/evanphx/rubinius/tree/">Source</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/network">Network</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/evanphx/rubinius">Wiki</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/graphs">Graphs</a></li>                    
            <li class="active"><a href="/evanphx/rubinius">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/evanphx">evanphx</a> / <b><a href="http://github.com/evanphx/rubinius/tree">rubinius</a></b>        
                <a id="namespaces_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Gem_RemoteFetcher">
  <h1>Class: Gem::RemoteFetcher</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="UserInteraction.html" title="Gem::UserInteraction">Gem::UserInteraction</a></p>
</div><div class="section docstring">
  <p>
RemoteFetcher handles the details of fetching gems and gem information from
a remote source.
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(proxy = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Initialize a remote fetcher using the source URI and possible proxy
information.
</p>
<p>
<tt>proxy</tt>
</p>
<ul>
<li>[String]: explicit specification of proxy; overrides any environment

<pre class="code">
          <span class='variable identifier id'>variable</span> <span class='setting identifier id'>setting</span>
</pre>
</li>
<li>nil: respect environment variables (HTTP_PROXY, HTTP_PROXY_USER,

<pre class="code">
     <span class='HTTP_PROXY_PASS constant id'>HTTP_PROXY_PASS</span><span class='rparen token'>)</span>
</pre>
</li>
<li><tt>:no_proxy</tt>: ignore environment variables and _don&#8217;t_ use a
proxy

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 58</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L58">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">58
59
60
61
62
63
64
65
66
67
68
69
70</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='proxy identifier id'>proxy</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='Socket constant id'>Socket</span><span class='dot token'>.</span><span class='do_not_reverse_lookup identifier id'>do_not_reverse_lookup</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>

  <span class='@connections ivar id'>@connections</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@requests ivar id'>@requests</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='integer val'>0</span>
  <span class='@proxy_uri ivar id'>@proxy_uri</span> <span class='assign token'>=</span>
    <span class='case case kw'>case</span> <span class='proxy identifier id'>proxy</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:no_proxy</span> <span class='then then kw'>then</span> <span class='nil nil kw'>nil</span>
    <span class='when when kw'>when</span> <span class='nil nil kw'>nil</span> <span class='then then kw'>then</span> <span class='get_proxy_from_env identifier id'>get_proxy_from_env</span>
    <span class='when when kw'>when</span> <span class='URI constant id'>URI</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span> <span class='then then kw'>then</span> <span class='proxy identifier id'>proxy</span>
    <span class='else else kw'>else</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='proxy identifier id'>proxy</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetcher-class_method">fetcher</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Cached RemoteFetcher instance.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetcher-3D-class_method">fetcher=</span><span class='args'>(fetcher)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connection_for-instance_method">#connection_for</span><span class='args'>(uri)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates or an HTTP connection based on <tt>uri</tt>, or retrieves an
existing connection, using a proxy if needed.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#download-instance_method">#download</span><span class='args'>(spec, source_uri, install_dir = Gem.dir)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Moves the gem <tt>spec</tt> from <tt>source_uri</tt> to the cache dir
unless it is already there.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#escape-instance_method">#escape</span><span class='args'>(str)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch_path-instance_method">#fetch_path</span><span class='args'>(uri, mtime = nil, head = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Downloads <tt>uri</tt> and returns it as a String.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch_size-instance_method">#fetch_size</span><span class='args'>(uri)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the size of <tt>uri</tt> in bytes.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_proxy_from_env-instance_method">#get_proxy_from_env</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns an HTTP proxy URI if one is set in the environment variables.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#normalize_uri-instance_method">#normalize_uri</span><span class='args'>(uri)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Normalize the URI by adding &quot;http://&quot; if it is missing.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#open_uri_or_path-instance_method">#open_uri_or_path</span><span class='args'>(uri, last_modified = nil, head = false, depth = 0)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Read the data from the (source based) URI, but if it is a file:// URI, read
from the filesystem instead.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#request-instance_method">#request</span><span class='args'>(uri, request_class, last_modified = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Performs a Net::HTTP request of type <tt>request_class</tt> on <tt>uri</tt>
returning a Net::HTTP response object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reset-instance_method">#reset</span><span class='args'>(connection)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Resets HTTP connection <tt>connection</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#unescape-instance_method">#unescape</span><span class='args'>(str)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table><div class="included">
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>fetcher</h3>
</div><div id="fetcher-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetcher</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Cached RemoteFetcher instance.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 43</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L43">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">43
44
45</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fetcher identifier id'>fetcher</span>
  <span class='@fetcher ivar id'>@fetcher</span> <span class='opasgn op'>||=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:http_proxy</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetcher=</h3>
</div><div id="fetcher-3D-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetcher=</span><span class='args'>(fetcher)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/test_utilities.rb', line 92</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/test_utilities.rb#L92">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">92
93
94</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fetcher identifier id'>fetcher</span><span class='assign token'>=</span><span class='lparen token'>(</span><span class='fetcher identifier id'>fetcher</span><span class='rparen token'>)</span>
  <span class='@fetcher ivar id'>@fetcher</span> <span class='assign token'>=</span> <span class='fetcher identifier id'>fetcher</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>connection_for</h3>
</div><div id="connection_for-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connection_for</span><span class='args'>(uri)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates or an HTTP connection based on <tt>uri</tt>, or retrieves an
existing connection, using a proxy if needed.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 224</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L224">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='connection_for identifier id'>connection_for</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
  <span class='net_http_args identifier id'>net_http_args</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='port identifier id'>port</span><span class='rbrack token'>]</span>

  <span class='if if kw'>if</span> <span class='@proxy_uri ivar id'>@proxy_uri</span> <span class='then then kw'>then</span>
    <span class='net_http_args identifier id'>net_http_args</span> <span class='opasgn op'>+=</span> <span class='lbrack token'>[</span>
      <span class='@proxy_uri ivar id'>@proxy_uri</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='comma token'>,</span>
      <span class='@proxy_uri ivar id'>@proxy_uri</span><span class='dot token'>.</span><span class='port identifier id'>port</span><span class='comma token'>,</span>
      <span class='@proxy_uri ivar id'>@proxy_uri</span><span class='dot token'>.</span><span class='user identifier id'>user</span><span class='comma token'>,</span>
      <span class='@proxy_uri ivar id'>@proxy_uri</span><span class='dot token'>.</span><span class='password identifier id'>password</span>
    <span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='connection_id identifier id'>connection_id</span> <span class='assign token'>=</span> <span class='net_http_args identifier id'>net_http_args</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='string val'>':'</span>
  <span class='@connections ivar id'>@connections</span><span class='lbrack token'>[</span><span class='connection_id identifier id'>connection_id</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='net_http_args identifier id'>net_http_args</span><span class='rparen token'>)</span>
  <span class='connection identifier id'>connection</span> <span class='assign token'>=</span> <span class='@connections ivar id'>@connections</span><span class='lbrack token'>[</span><span class='connection_id identifier id'>connection_id</span><span class='rbrack token'>]</span>

  <span class='if if kw'>if</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span> <span class='eq op'>==</span> <span class='string val'>'https'</span> <span class='and and kw'>and</span> <span class='not not kw'>not</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='started? fid id'>started?</span> <span class='then then kw'>then</span>
    <span class='require identifier id'>require</span> <span class='string val'>'net/https'</span>
    <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='use_ssl identifier id'>use_ssl</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='verify_mode identifier id'>verify_mode</span> <span class='assign token'>=</span> <span class='OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='SSL constant id'>SSL</span><span class='colon2 op'>::</span><span class='VERIFY_NONE constant id'>VERIFY_NONE</span>
  <span class='end end kw'>end</span>

  <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='start identifier id'>start</span> <span class='unless unless_mod kw'>unless</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='started? fid id'>started?</span>

  <span class='connection identifier id'>connection</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>download</h3>
</div><div id="download-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>download</span><span class='args'>(spec, source_uri, install_dir = Gem.dir)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Moves the gem <tt>spec</tt> from <tt>source_uri</tt> to the cache dir
unless it is already there. If the source_uri is local the gem cache dir
copy is always replaced.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 77</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L77">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='download identifier id'>download</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='comma token'>,</span> <span class='source_uri identifier id'>source_uri</span><span class='comma token'>,</span> <span class='install_dir identifier id'>install_dir</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='writable? fid id'>writable?</span><span class='lparen token'>(</span><span class='install_dir identifier id'>install_dir</span><span class='rparen token'>)</span>
    <span class='cache_dir identifier id'>cache_dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='install_dir identifier id'>install_dir</span><span class='comma token'>,</span> <span class='string val'>'cache'</span>
  <span class='else else kw'>else</span>
    <span class='cache_dir identifier id'>cache_dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='user_dir identifier id'>user_dir</span><span class='comma token'>,</span> <span class='string val'>'cache'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='gem_file_name identifier id'>gem_file_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{spec.full_name}.gem&quot;</span>
  <span class='local_gem_path identifier id'>local_gem_path</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='cache_dir identifier id'>cache_dir</span><span class='comma token'>,</span> <span class='gem_file_name identifier id'>gem_file_name</span>

  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span> <span class='cache_dir identifier id'>cache_dir</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span> <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span> <span class='cache_dir identifier id'>cache_dir</span>

 <span class='comment val'># Always escape URI's to deal with potential spaces and such</span>
  <span class='unless unless kw'>unless</span> <span class='URI constant id'>URI</span><span class='colon2 op'>::</span><span class='Generic constant id'>Generic</span> <span class='eqq op'>===</span> <span class='source_uri identifier id'>source_uri</span>
    <span class='source_uri identifier id'>source_uri</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='source_uri identifier id'>source_uri</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='scheme identifier id'>scheme</span> <span class='assign token'>=</span> <span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span>

  <span class='comment val'># URI.parse gets confused by MS Windows paths with forward slashes.</span>
  <span class='scheme identifier id'>scheme</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='scheme identifier id'>scheme</span> <span class='match op'>=~</span> <span class='regexp val'>/^[a-z]$/i</span>

  <span class='case case kw'>case</span> <span class='scheme identifier id'>scheme</span>
  <span class='when when kw'>when</span> <span class='string val'>'http'</span><span class='comma token'>,</span> <span class='string val'>'https'</span> <span class='then then kw'>then</span>
    <span class='unless unless kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span> <span class='local_gem_path identifier id'>local_gem_path</span> <span class='then then kw'>then</span>
      <span class='begin begin kw'>begin</span>
        <span class='say identifier id'>say</span> <span class='dstring node'>&quot;Downloading gem #{gem_file_name}&quot;</span> <span class='if if_mod kw'>if</span>
          <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>

        <span class='remote_gem_path identifier id'>remote_gem_path</span> <span class='assign token'>=</span> <span class='source_uri identifier id'>source_uri</span> <span class='plus op'>+</span> <span class='dstring node'>&quot;gems/#{gem_file_name}&quot;</span>

        <span class='gem identifier id'>gem</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fetch_path identifier id'>fetch_path</span> <span class='remote_gem_path identifier id'>remote_gem_path</span>
      <span class='rescue rescue kw'>rescue</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='RemoteFetcher constant id'>RemoteFetcher</span><span class='colon2 op'>::</span><span class='FetchError constant id'>FetchError</span>
        <span class='raise identifier id'>raise</span> <span class='if if_mod kw'>if</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_platform identifier id'>original_platform</span> <span class='eq op'>==</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='platform identifier id'>platform</span>

        <span class='alternate_name identifier id'>alternate_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{spec.original_name}.gem&quot;</span>

        <span class='say identifier id'>say</span> <span class='dstring node'>&quot;Failed, downloading gem #{alternate_name}&quot;</span> <span class='if if_mod kw'>if</span>
          <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>

        <span class='remote_gem_path identifier id'>remote_gem_path</span> <span class='assign token'>=</span> <span class='source_uri identifier id'>source_uri</span> <span class='plus op'>+</span> <span class='dstring node'>&quot;gems/#{alternate_name}&quot;</span>

        <span class='gem identifier id'>gem</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fetch_path identifier id'>fetch_path</span> <span class='remote_gem_path identifier id'>remote_gem_path</span>
      <span class='end end kw'>end</span>

      <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span> <span class='local_gem_path identifier id'>local_gem_path</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fp identifier id'>fp</span><span class='bitor op'>|</span>
        <span class='fp identifier id'>fp</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='gem identifier id'>gem</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='when when kw'>when</span> <span class='string val'>'file'</span> <span class='then then kw'>then</span>
    <span class='begin begin kw'>begin</span>
      <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
      <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='extname identifier id'>extname</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='string val'>'.gem'</span>

      <span class='remote_gem_path identifier id'>remote_gem_path</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'gems'</span><span class='comma token'>,</span> <span class='gem_file_name identifier id'>gem_file_name</span><span class='rparen token'>)</span>

      <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='cp identifier id'>cp</span><span class='lparen token'>(</span><span class='remote_gem_path identifier id'>remote_gem_path</span><span class='comma token'>,</span> <span class='local_gem_path identifier id'>local_gem_path</span><span class='rparen token'>)</span>
    <span class='rescue rescue kw'>rescue</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EACCES constant id'>EACCES</span>
      <span class='local_gem_path identifier id'>local_gem_path</span> <span class='assign token'>=</span> <span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='end end kw'>end</span>

    <span class='say identifier id'>say</span> <span class='dstring node'>&quot;Using local gem #{local_gem_path}&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>
  <span class='when when kw'>when</span> <span class='nil nil kw'>nil</span> <span class='then then kw'>then</span> <span class='comment val'># TODO test for local overriding cache</span>
    <span class='begin begin kw'>begin</span>
      <span class='if if kw'>if</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='win_platform? fid id'>win_platform?</span> <span class='andop op'>&amp;&amp;</span> <span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span>
        <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='cp identifier id'>cp</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span> <span class='plus op'>+</span> <span class='string val'>':'</span> <span class='plus op'>+</span> <span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='local_gem_path identifier id'>local_gem_path</span>
      <span class='else else kw'>else</span>
        <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='cp identifier id'>cp</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='local_gem_path identifier id'>local_gem_path</span>
      <span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EACCES constant id'>EACCES</span>
      <span class='local_gem_path identifier id'>local_gem_path</span> <span class='assign token'>=</span> <span class='source_uri identifier id'>source_uri</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='end end kw'>end</span>

    <span class='say identifier id'>say</span> <span class='dstring node'>&quot;Using local gem #{local_gem_path}&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='InstallError constant id'>InstallError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unsupported URI scheme #{source_uri.scheme}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='local_gem_path identifier id'>local_gem_path</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>escape</h3>
</div><div id="escape-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>escape</span><span class='args'>(str)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 184</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L184">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">184
185
186
187</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='str identifier id'>str</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='str identifier id'>str</span>
  <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='str identifier id'>str</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch_path</h3>
</div><div id="fetch_path-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch_path</span><span class='args'>(uri, mtime = nil, head = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Downloads <tt>uri</tt> and returns it as a String.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="RemoteFetcher/FetchError.html" title="FetchError">FetchError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 163</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L163">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">163
164
165
166
167
168
169
170
171
172
173</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch_path identifier id'>fetch_path</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='mtime identifier id'>mtime</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='head identifier id'>head</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='open_uri_or_path identifier id'>open_uri_or_path</span> <span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='mtime identifier id'>mtime</span><span class='comma token'>,</span> <span class='head identifier id'>head</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='gunzip identifier id'>gunzip</span> <span class='data identifier id'>data</span> <span class='if if_mod kw'>if</span> <span class='data identifier id'>data</span> <span class='and and kw'>and</span> <span class='not not kw'>not</span> <span class='head identifier id'>head</span> <span class='and and kw'>and</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/gz$/</span>
  <span class='data identifier id'>data</span>
<span class='rescue rescue kw'>rescue</span> <span class='FetchError constant id'>FetchError</span>
  <span class='raise identifier id'>raise</span>
<span class='rescue rescue kw'>rescue</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span>
  <span class='raise identifier id'>raise</span> <span class='FetchError constant id'>FetchError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'timed out'</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
<span class='rescue rescue kw'>rescue</span> <span class='IOError constant id'>IOError</span><span class='comma token'>,</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='raise identifier id'>raise</span> <span class='FetchError constant id'>FetchError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{e.class}: #{e}&quot;</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch_size</h3>
</div><div id="fetch_size-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch_size</span><span class='args'>(uri)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the size of <tt>uri</tt> in bytes.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 178</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L178">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">178
179
180
181
182</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch_size identifier id'>fetch_size</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='comment val'># TODO: phase this out</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='fetch_path identifier id'>fetch_path</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>

  <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='string val'>'content-length'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_proxy_from_env</h3>
</div><div id="get_proxy_from_env-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_proxy_from_env</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns an HTTP proxy URI if one is set in the environment variables.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 197</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L197">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_proxy_from_env identifier id'>get_proxy_from_env</span>
  <span class='env_proxy identifier id'>env_proxy</span> <span class='assign token'>=</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'http_proxy'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'HTTP_PROXY'</span><span class='rbrack token'>]</span>

  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='env_proxy identifier id'>env_proxy</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='env_proxy identifier id'>env_proxy</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='normalize_uri identifier id'>normalize_uri</span><span class='lparen token'>(</span><span class='env_proxy identifier id'>env_proxy</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='uri identifier id'>uri</span> <span class='and and kw'>and</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='user identifier id'>user</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='and and kw'>and</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='password identifier id'>password</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
    <span class='comment val'># Probably we have http_proxy_* variables?</span>
    <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'http_proxy_user'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'HTTP_PROXY_USER'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='password identifier id'>password</span> <span class='assign token'>=</span> <span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'http_proxy_pass'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>'HTTP_PROXY_PASS'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='uri identifier id'>uri</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>normalize_uri</h3>
</div><div id="normalize_uri-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>normalize_uri</span><span class='args'>(uri)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Normalize the URI by adding &quot;http://&quot; if it is missing.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 216</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L216">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">216
217
218</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='normalize_uri identifier id'>normalize_uri</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='uri identifier id'>uri</span> <span class='match op'>=~</span> <span class='regexp val'>/^(https?|ftp|file):/</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='uri identifier id'>uri</span> <span class='colon op'>:</span> <span class='dstring node'>&quot;http://#{uri}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>open_uri_or_path</h3>
</div><div id="open_uri_or_path-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>open_uri_or_path</span><span class='args'>(uri, last_modified = nil, head = false, depth = 0)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Read the data from the (source based) URI, but if it is a file:// URI, read
from the filesystem instead.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 255</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L255">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='open_uri_or_path identifier id'>open_uri_or_path</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='last_modified identifier id'>last_modified</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='head identifier id'>head</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='depth identifier id'>depth</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;block is dead&quot;</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>

  <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span> <span class='uri identifier id'>uri</span> <span class='unless unless_mod kw'>unless</span> <span class='URI constant id'>URI</span><span class='colon2 op'>::</span><span class='Generic constant id'>Generic</span> <span class='eqq op'>===</span> <span class='uri identifier id'>uri</span>

  <span class='comment val'># This check is redundant unless Gem::RemoteFetcher is likely</span>
  <span class='comment val'># to be used directly, since the scheme is checked elsewhere.</span>
  <span class='comment val'># - Daniel Berger</span>
  <span class='unless unless kw'>unless</span> <span class='lbrack token'>[</span><span class='string val'>'http'</span><span class='comma token'>,</span> <span class='string val'>'https'</span><span class='comma token'>,</span> <span class='string val'>'file'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span><span class='rparen token'>)</span>
   <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'uri scheme is invalid'</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span> <span class='eq op'>==</span> <span class='string val'>'file'</span>
    <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span>

    <span class='comment val'># Deal with leading slash on Windows paths</span>
    <span class='if if kw'>if</span> <span class='path identifier id'>path</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='chr identifier id'>chr</span> <span class='eq op'>==</span> <span class='string val'>'/'</span> <span class='andop op'>&amp;&amp;</span> <span class='path identifier id'>path</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='chr identifier id'>chr</span> <span class='match op'>=~</span> <span class='regexp val'>/[a-zA-Z]/</span> <span class='andop op'>&amp;&amp;</span> <span class='path identifier id'>path</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='chr identifier id'>chr</span> <span class='eq op'>==</span> <span class='string val'>':'</span>
       <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='path identifier id'>path</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='read_binary identifier id'>read_binary</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='fetch_type identifier id'>fetch_type</span> <span class='assign token'>=</span> <span class='head identifier id'>head</span> <span class='integer val'>? </span><span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='colon2 op'>::</span><span class='Head constant id'>Head</span> <span class='colon op'>:</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span><span class='colon2 op'>::</span><span class='Get constant id'>Get</span>
  <span class='response identifier id'>response</span>   <span class='assign token'>=</span> <span class='request identifier id'>request</span> <span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='fetch_type identifier id'>fetch_type</span><span class='comma token'>,</span> <span class='last_modified identifier id'>last_modified</span>

  <span class='case case kw'>case</span> <span class='response identifier id'>response</span>
  <span class='when when kw'>when</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTPOK constant id'>HTTPOK</span><span class='comma token'>,</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTPNotModified constant id'>HTTPNotModified</span> <span class='then then kw'>then</span>
    <span class='head identifier id'>head</span> <span class='integer val'>? </span><span class='response identifier id'>response</span> <span class='colon op'>:</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='body identifier id'>body</span>
  <span class='when when kw'>when</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTPMovedPermanently constant id'>HTTPMovedPermanently</span><span class='comma token'>,</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTPFound constant id'>HTTPFound</span><span class='comma token'>,</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTPSeeOther constant id'>HTTPSeeOther</span><span class='comma token'>,</span>
       <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTPTemporaryRedirect constant id'>HTTPTemporaryRedirect</span> <span class='then then kw'>then</span>
    <span class='raise identifier id'>raise</span> <span class='FetchError constant id'>FetchError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'too many redirects'</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='depth identifier id'>depth</span> <span class='gt op'>&gt;</span> <span class='integer val'>10</span>

    <span class='open_uri_or_path identifier id'>open_uri_or_path</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='string val'>'Location'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='last_modified identifier id'>last_modified</span><span class='comma token'>,</span> <span class='head identifier id'>head</span><span class='comma token'>,</span> <span class='depth identifier id'>depth</span> <span class='plus op'>+</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='FetchError constant id'>FetchError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;bad response #{response.message} #{response.code}&quot;</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>request</h3>
</div><div id="request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>request</span><span class='args'>(uri, request_class, last_modified = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Performs a Net::HTTP request of type <tt>request_class</tt> on <tt>uri</tt>
returning a Net::HTTP response object. request maintains a table of
persistent connections to reduce connect overhead.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 299</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L299">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='request identifier id'>request</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='request_class identifier id'>request_class</span><span class='comma token'>,</span> <span class='last_modified identifier id'>last_modified</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='request_class identifier id'>request_class</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='request_uri identifier id'>request_uri</span>

  <span class='unless unless kw'>unless</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='user identifier id'>user</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='user identifier id'>user</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='then then kw'>then</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='basic_auth identifier id'>basic_auth</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='password identifier id'>password</span>
  <span class='end end kw'>end</span>

  <span class='ua identifier id'>ua</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;RubyGems/#{Gem::RubyGemsVersion} #{Gem::Platform.local}&quot;</span>
  <span class='ua identifier id'>ua</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; Ruby/#{RUBY_VERSION} (#{RUBY_RELEASE_DATE}&quot;</span>
  <span class='ua identifier id'>ua</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; patchlevel #{RUBY_PATCHLEVEL}&quot;</span> <span class='if if_mod kw'>if</span> <span class='defined? defined kw'>defined?</span> <span class='RUBY_PATCHLEVEL constant id'>RUBY_PATCHLEVEL</span>
  <span class='ua identifier id'>ua</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;)&quot;</span>

  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span> <span class='string val'>'User-Agent'</span><span class='comma token'>,</span> <span class='ua identifier id'>ua</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span> <span class='string val'>'Connection'</span><span class='comma token'>,</span> <span class='string val'>'keep-alive'</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span> <span class='string val'>'Keep-Alive'</span><span class='comma token'>,</span> <span class='string val'>'30'</span>

  <span class='if if kw'>if</span> <span class='last_modified identifier id'>last_modified</span> <span class='then then kw'>then</span>
    <span class='last_modified identifier id'>last_modified</span> <span class='assign token'>=</span> <span class='last_modified identifier id'>last_modified</span><span class='dot token'>.</span><span class='utc identifier id'>utc</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span> <span class='string val'>'If-Modified-Since'</span><span class='comma token'>,</span> <span class='last_modified identifier id'>last_modified</span><span class='dot token'>.</span><span class='rfc2822 identifier id'>rfc2822</span>
  <span class='end end kw'>end</span>

  <span class='connection identifier id'>connection</span> <span class='assign token'>=</span> <span class='connection_for identifier id'>connection_for</span> <span class='uri identifier id'>uri</span>

  <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='bad_response identifier id'>bad_response</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

  <span class='begin begin kw'>begin</span>
    <span class='@requests ivar id'>@requests</span><span class='lbrack token'>[</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span><span class='rbrack token'>]</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='request identifier id'>request</span> <span class='request identifier id'>request</span>
    <span class='say identifier id'>say</span> <span class='dstring node'>&quot;#{request.method} #{response.code} #{response.message}: #{uri}&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTPBadResponse constant id'>HTTPBadResponse</span>
    <span class='reset identifier id'>reset</span> <span class='connection identifier id'>connection</span>

    <span class='raise identifier id'>raise</span> <span class='FetchError constant id'>FetchError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'too many bad responses'</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='bad_response identifier id'>bad_response</span>

    <span class='bad_response identifier id'>bad_response</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='retry retry kw'>retry</span>
  <span class='comment val'># HACK work around EOFError bug in Net::HTTP</span>
  <span class='comment val'># NOTE Errno::ECONNABORTED raised a lot on Windows, and make impossible</span>
  <span class='comment val'># to install gems.</span>
  <span class='rescue rescue kw'>rescue</span> <span class='EOFError constant id'>EOFError</span><span class='comma token'>,</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='ECONNABORTED constant id'>ECONNABORTED</span><span class='comma token'>,</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='ECONNRESET constant id'>ECONNRESET</span>
    <span class='requests identifier id'>requests</span> <span class='assign token'>=</span> <span class='@requests ivar id'>@requests</span><span class='lbrack token'>[</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span><span class='rbrack token'>]</span>
    <span class='say identifier id'>say</span> <span class='dstring node'>&quot;connection reset after #{requests} requests, retrying&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>

    <span class='raise identifier id'>raise</span> <span class='FetchError constant id'>FetchError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'too many connection resets'</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='retried identifier id'>retried</span>

    <span class='reset identifier id'>reset</span> <span class='connection identifier id'>connection</span>

    <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='retry retry kw'>retry</span>
  <span class='end end kw'>end</span>

  <span class='response identifier id'>response</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reset</h3>
</div><div id="reset-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reset</span><span class='args'>(connection)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Resets HTTP connection <tt>connection</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 359</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L359">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">359
360
361
362
363
364</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reset identifier id'>reset</span><span class='lparen token'>(</span><span class='connection identifier id'>connection</span><span class='rparen token'>)</span>
  <span class='@requests ivar id'>@requests</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span>

  <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='finish identifier id'>finish</span>
  <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='start identifier id'>start</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>unescape</h3>
</div><div id="unescape-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>unescape</span><span class='args'>(str)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/remote_fetcher.rb', line 189</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/remote_fetcher.rb#L189">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">189
190
191
192</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='str identifier id'>str</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='str identifier id'>str</span>
  <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='unescape identifier id'>unescape</span><span class='lparen token'>(</span><span class='str identifier id'>str</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>