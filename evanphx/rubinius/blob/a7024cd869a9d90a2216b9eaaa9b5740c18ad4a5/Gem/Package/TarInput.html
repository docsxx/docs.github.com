<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>evanphx's rubinius - Class: Gem::Package::TarInput - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/evanphx/commits/rubinius/master" rel="alternate" title="Recent Commits to rubinius:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("evanphx", "rubinius", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("evanphx", "rubinius", "a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/evanphx/rubinius/tree/">Source</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/network">Network</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/evanphx/rubinius">Wiki</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/graphs">Graphs</a></li>                    
            <li class="active"><a href="/evanphx/rubinius">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/evanphx">evanphx</a> / <b><a href="http://github.com/evanphx/rubinius/tree">rubinius</a></b>        
                <a id="namespaces_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Gem_Package_TarInput">
  <h1>Class: Gem::Package::TarInput</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="FSyncDir.html" title="Gem::Package::FSyncDir">Gem::Package::FSyncDir</a>, <a href="TarInput/Enumerable.html" title="Enumerable">Enumerable</a></p>
</div><div class="section docstring">
  <p>
++ Copyright (C) 2004 Mauricio Julio Fernández Pradier See LICENSE.txt for
additional licensing information. &#8212;
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">metadata</td>
          <td class="readwrite">
            [<span id='metadata-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>metadata</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="included">
  
  <div>
    <h2>Constants Included from <a href="TarInput/Enumerable.html" title="Enumerable">Enumerable</a></h2>
    <p><span class='name'><a href="../../Enumerable.html#Enumerator-constant" title="Enumerator">Enumerator</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(io, security_policy = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="FormatError.html" title="Gem::Package::FormatError">Gem::Package::FormatError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/package/tar_input.rb', line 23</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/package/tar_input.rb#L23">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='io identifier id'>io</span><span class='comma token'>,</span> <span class='security_policy identifier id'>security_policy</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='@io ivar id'>@io</span> <span class='assign token'>=</span> <span class='io identifier id'>io</span>
  <span class='@tarreader ivar id'>@tarreader</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Package constant id'>Package</span><span class='colon2 op'>::</span><span class='TarReader constant id'>TarReader</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='@io ivar id'>@io</span>
  <span class='has_meta identifier id'>has_meta</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

  <span class='data_sig identifier id'>data_sig</span><span class='comma token'>,</span> <span class='meta_sig identifier id'>meta_sig</span><span class='comma token'>,</span> <span class='data_dgst identifier id'>data_dgst</span><span class='comma token'>,</span> <span class='meta_dgst identifier id'>meta_dgst</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span>
  <span class='dgst_algo identifier id'>dgst_algo</span> <span class='assign token'>=</span> <span class='security_policy identifier id'>security_policy</span> <span class='integer val'>? </span><span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Security constant id'>Security</span><span class='colon2 op'>::</span><span class='OPT constant id'>OPT</span><span class='lbrack token'>[</span><span class='symbol val'>:dgst_algo</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span>

  <span class='@tarreader ivar id'>@tarreader</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='entry identifier id'>entry</span><span class='bitor op'>|</span>
    <span class='case case kw'>case</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='full_name identifier id'>full_name</span>
    <span class='when when kw'>when</span> <span class='string val'>&quot;metadata&quot;</span>
      <span class='@metadata ivar id'>@metadata</span> <span class='assign token'>=</span> <span class='load_gemspec identifier id'>load_gemspec</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
      <span class='has_meta identifier id'>has_meta</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='when when kw'>when</span> <span class='string val'>&quot;metadata.gz&quot;</span>
      <span class='begin begin kw'>begin</span>
        <span class='comment val'># if we have a security_policy, then pre-read the metadata file</span>
        <span class='comment val'># and calculate it's digest</span>
        <span class='sio identifier id'>sio</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='if if kw'>if</span> <span class='security_policy identifier id'>security_policy</span>
          <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='ensure_ssl_available identifier id'>ensure_ssl_available</span>
          <span class='sio identifier id'>sio</span> <span class='assign token'>=</span> <span class='StringIO constant id'>StringIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='rparen token'>)</span>
          <span class='meta_dgst identifier id'>meta_dgst</span> <span class='assign token'>=</span> <span class='dgst_algo identifier id'>dgst_algo</span><span class='dot token'>.</span><span class='digest identifier id'>digest</span><span class='lparen token'>(</span><span class='sio identifier id'>sio</span><span class='dot token'>.</span><span class='string identifier id'>string</span><span class='rparen token'>)</span>
          <span class='sio identifier id'>sio</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span>
        <span class='end end kw'>end</span>

        <span class='gzis identifier id'>gzis</span> <span class='assign token'>=</span> <span class='Zlib constant id'>Zlib</span><span class='colon2 op'>::</span><span class='GzipReader constant id'>GzipReader</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='sio identifier id'>sio</span> <span class='orop op'>||</span> <span class='entry identifier id'>entry</span><span class='rparen token'>)</span>
        <span class='comment val'># YAML wants an instance of IO</span>
        <span class='@metadata ivar id'>@metadata</span> <span class='assign token'>=</span> <span class='load_gemspec identifier id'>load_gemspec</span><span class='lparen token'>(</span><span class='gzis identifier id'>gzis</span><span class='rparen token'>)</span>
        <span class='has_meta identifier id'>has_meta</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='gzis identifier id'>gzis</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='unless unless_mod kw'>unless</span> <span class='gzis identifier id'>gzis</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='end end kw'>end</span>
    <span class='when when kw'>when</span> <span class='string val'>'metadata.gz.sig'</span>
      <span class='meta_sig identifier id'>meta_sig</span> <span class='assign token'>=</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
    <span class='when when kw'>when</span> <span class='string val'>'data.tar.gz.sig'</span>
      <span class='data_sig identifier id'>data_sig</span> <span class='assign token'>=</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
    <span class='when when kw'>when</span> <span class='string val'>'data.tar.gz'</span>
      <span class='if if kw'>if</span> <span class='security_policy identifier id'>security_policy</span>
        <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='ensure_ssl_available identifier id'>ensure_ssl_available</span>
        <span class='data_dgst identifier id'>data_dgst</span> <span class='assign token'>=</span> <span class='dgst_algo identifier id'>dgst_algo</span><span class='dot token'>.</span><span class='digest identifier id'>digest</span><span class='lparen token'>(</span><span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='security_policy identifier id'>security_policy</span> <span class='then then kw'>then</span>
    <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='ensure_ssl_available identifier id'>ensure_ssl_available</span>

    <span class='comment val'># map trust policy from string to actual class (or a serialized YAML</span>
    <span class='comment val'># file, if that exists)</span>
    <span class='if if kw'>if</span> <span class='String constant id'>String</span> <span class='eqq op'>===</span> <span class='security_policy identifier id'>security_policy</span> <span class='then then kw'>then</span>
      <span class='if if kw'>if</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Security constant id'>Security</span><span class='colon2 op'>::</span><span class='Policies constant id'>Policies</span><span class='dot token'>.</span><span class='key? fid id'>key?</span> <span class='security_policy identifier id'>security_policy</span> <span class='then then kw'>then</span>
        <span class='comment val'># load one of the pre-defined security policies</span>
        <span class='security_policy identifier id'>security_policy</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Security constant id'>Security</span><span class='colon2 op'>::</span><span class='Policies constant id'>Policies</span><span class='lbrack token'>[</span><span class='security_policy identifier id'>security_policy</span><span class='rbrack token'>]</span>
      <span class='elsif elsif kw'>elsif</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span> <span class='security_policy identifier id'>security_policy</span> <span class='then then kw'>then</span>
        <span class='comment val'># FIXME: this doesn't work yet</span>
        <span class='security_policy identifier id'>security_policy</span> <span class='assign token'>=</span> <span class='YAML constant id'>YAML</span><span class='dot token'>.</span><span class='load identifier id'>load</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='security_policy identifier id'>security_policy</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='raise identifier id'>raise</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Exception constant id'>Exception</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Unknown trust policy '#{security_policy}'&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='data_sig identifier id'>data_sig</span> <span class='andop op'>&amp;&amp;</span> <span class='data_dgst identifier id'>data_dgst</span> <span class='andop op'>&amp;&amp;</span> <span class='meta_sig identifier id'>meta_sig</span> <span class='andop op'>&amp;&amp;</span> <span class='meta_dgst identifier id'>meta_dgst</span> <span class='then then kw'>then</span>
      <span class='comment val'># the user has a trust policy, and we have a signed gem</span>
      <span class='comment val'># file, so use the trust policy to verify the gem signature</span>

      <span class='begin begin kw'>begin</span>
        <span class='security_policy identifier id'>security_policy</span><span class='dot token'>.</span><span class='verify_gem identifier id'>verify_gem</span><span class='lparen token'>(</span><span class='data_sig identifier id'>data_sig</span><span class='comma token'>,</span> <span class='data_dgst identifier id'>data_dgst</span><span class='comma token'>,</span> <span class='@metadata ivar id'>@metadata</span><span class='dot token'>.</span><span class='cert_chain identifier id'>cert_chain</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Couldn't verify data signature: #{e}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='begin begin kw'>begin</span>
        <span class='security_policy identifier id'>security_policy</span><span class='dot token'>.</span><span class='verify_gem identifier id'>verify_gem</span><span class='lparen token'>(</span><span class='meta_sig identifier id'>meta_sig</span><span class='comma token'>,</span> <span class='meta_dgst identifier id'>meta_dgst</span><span class='comma token'>,</span> <span class='@metadata ivar id'>@metadata</span><span class='dot token'>.</span><span class='cert_chain identifier id'>cert_chain</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Couldn't verify metadata signature: #{e}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='elsif elsif kw'>elsif</span> <span class='security_policy identifier id'>security_policy</span><span class='dot token'>.</span><span class='only_signed identifier id'>only_signed</span>
      <span class='raise identifier id'>raise</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Exception constant id'>Exception</span><span class='comma token'>,</span> <span class='string val'>&quot;Unsigned gem&quot;</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># FIXME: should display warning here (trust policy, but</span>
      <span class='comment val'># either unsigned or badly signed gem file)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@tarreader ivar id'>@tarreader</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span>
  <span class='@fileops ivar id'>@fileops</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='FileOperations constant id'>FileOperations</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

  <span class='raise identifier id'>raise</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Package constant id'>Package</span><span class='colon2 op'>::</span><span class='FormatError constant id'>FormatError</span><span class='comma token'>,</span> <span class='string val'>&quot;No metadata found!&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='has_meta identifier id'>has_meta</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#open-class_method">open</span><span class='args'>(io, security_policy = nil, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#close-instance_method">#close</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#each-instance_method">#each</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#extract_entry-instance_method">#extract_entry</span><span class='args'>(destdir, entry, expected_md5sum = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#load_gemspec-instance_method">#load_gemspec</span><span class='args'>(io)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Attempt to YAML-load a gemspec from the given <em>io</em> parameter.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#zipped_stream-instance_method">#zipped_stream</span><span class='args'>(entry)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return an IO stream for the zipped entry.
</p>

        
      </td>
    </tr>
  
</table><div class="included">
  
  <div>
    <h2>Public Instance Methods Included from <a href="TarInput/Enumerable.html" title="Enumerable">Enumerable</a></h2>
    <p><span class='name'><a href="../../Enumerable.html#collect-instance_method" title="collect">collect</a></span>, <span class='name'><a href="../../Enumerable.html#count-instance_method" title="count">count</a></span>, <span class='name'><a href="../../Enumerable.html#cycle-instance_method" title="cycle">cycle</a></span>, <span class='name'><a href="../../Enumerable.html#drop-instance_method" title="drop">drop</a></span>, <span class='name'><a href="../../Enumerable.html#drop_while-instance_method" title="drop_while">drop_while</a></span>, <span class='name'><a href="../../Enumerable.html#each_cons-instance_method" title="each_cons">each_cons</a></span>, <span class='name'><a href="../../Enumerable.html#each_slice-instance_method" title="each_slice">each_slice</a></span>, <span class='name'><a href="../../Enumerable.html#each_with_index-instance_method" title="each_with_index">each_with_index</a></span>, <span class='name'><a href="../../Enumerable.html#each_with_object-instance_method" title="each_with_object">each_with_object</a></span>, <span class='name'><a href="../../Enumerable.html#enum_cons-instance_method" title="enum_cons">enum_cons</a></span>, <span class='name'><a href="../../Enumerable.html#enum_slice-instance_method" title="enum_slice">enum_slice</a></span>, <span class='name'><a href="../../Enumerable.html#enum_with_index-instance_method" title="enum_with_index">enum_with_index</a></span>, <span class='name'><a href="../../Enumerable.html#find-instance_method" title="find">find</a></span>, <span class='name'><a href="../../Enumerable.html#find_all-instance_method" title="find_all">find_all</a></span>, <span class='name'><a href="../../Enumerable.html#find_index-instance_method" title="find_index">find_index</a></span>, <span class='name'><a href="../../Enumerable.html#first-instance_method" title="first">first</a></span>, <span class='name'><a href="../../Enumerable.html#group_by-instance_method" title="group_by">group_by</a></span>, <span class='name'><a href="../../Enumerable.html#inject-instance_method" title="inject">inject</a></span>, <span class='name'><a href="../../Enumerable.html#max_by-instance_method" title="max_by">max_by</a></span>, <span class='name'><a href="../../Enumerable.html#min_by-instance_method" title="min_by">min_by</a></span>, <span class='name'><a href="../../Enumerable.html#minmax-instance_method" title="minmax">minmax</a></span>, <span class='name'><a href="../../Enumerable.html#minmax_by-instance_method" title="minmax_by">minmax_by</a></span>, <span class='name'><a href="../../Enumerable.html#none%3F-instance_method" title="none?">none?</a></span>, <span class='name'><a href="../../Enumerable.html#one%3F-instance_method" title="one?">one?</a></span>, <span class='name'><a href="../../Enumerable.html#partition-instance_method" title="partition">partition</a></span>, <span class='name'><a href="../../Enumerable.html#reject-instance_method" title="reject">reject</a></span>, <span class='name'><a href="../../Enumerable.html#reverse_each-instance_method" title="reverse_each">reverse_each</a></span>, <span class='name'><a href="../../Enumerable.html#take-instance_method" title="take">take</a></span>, <span class='name'><a href="../../Enumerable.html#take_while-instance_method" title="take_while">take_while</a></span>, <span class='name'><a href="../../Enumerable.html#to_a-instance_method" title="to_a">to_a</a></span>, <span class='name'><a href="../../Enumerable.html#to_set-instance_method" title="to_set">to_set</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>open</h3>
</div><div id="open-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>open</span><span class='args'>(io, security_policy = nil, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/package/tar_input.rb', line 15</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/package/tar_input.rb#L15">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">15
16
17
18
19
20
21</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='io identifier id'>io</span><span class='comma token'>,</span> <span class='security_policy identifier id'>security_policy</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span>  <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='is identifier id'>is</span> <span class='assign token'>=</span> <span class='new identifier id'>new</span> <span class='io identifier id'>io</span><span class='comma token'>,</span> <span class='security_policy identifier id'>security_policy</span>

  <span class='yield yield kw'>yield</span> <span class='is identifier id'>is</span>
<span class='ensure ensure kw'>ensure</span>
  <span class='is identifier id'>is</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='is identifier id'>is</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>close</h3>
</div><div id="close-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>close</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/package/tar_input.rb', line 113</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/package/tar_input.rb#L113">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">113
114
115
116</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='close identifier id'>close</span>
  <span class='@io ivar id'>@io</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='@tarreader ivar id'>@tarreader</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>each</h3>
</div><div id="each-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>each</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/package/tar_input.rb', line 118</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/package/tar_input.rb#L118">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='each identifier id'>each</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='@tarreader ivar id'>@tarreader</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='entry identifier id'>entry</span><span class='bitor op'>|</span>
    <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='full_name identifier id'>full_name</span> <span class='eq op'>==</span> <span class='string val'>&quot;data.tar.gz&quot;</span>
    <span class='is identifier id'>is</span> <span class='assign token'>=</span> <span class='zipped_stream identifier id'>zipped_stream</span> <span class='entry identifier id'>entry</span>

    <span class='begin begin kw'>begin</span>
      <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Package constant id'>Package</span><span class='colon2 op'>::</span><span class='TarReader constant id'>TarReader</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='is identifier id'>is</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='inner identifier id'>inner</span><span class='bitor op'>|</span>
        <span class='inner identifier id'>inner</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='ensure ensure kw'>ensure</span>
      <span class='is identifier id'>is</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='is identifier id'>is</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@tarreader ivar id'>@tarreader</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>extract_entry</h3>
</div><div id="extract_entry-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>extract_entry</span><span class='args'>(destdir, entry, expected_md5sum = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/package/tar_input.rb', line 135</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/package/tar_input.rb#L135">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='extract_entry identifier id'>extract_entry</span><span class='lparen token'>(</span><span class='destdir identifier id'>destdir</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='comma token'>,</span> <span class='expected_md5sum identifier id'>expected_md5sum</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span> <span class='then then kw'>then</span>
    <span class='dest identifier id'>dest</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='destdir identifier id'>destdir</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='full_name identifier id'>full_name</span>

    <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span> <span class='dest identifier id'>dest</span> <span class='then then kw'>then</span>
      <span class='@fileops ivar id'>@fileops</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='comma token'>,</span> <span class='dest identifier id'>dest</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
    <span class='else else kw'>else</span>
      <span class='@fileops ivar id'>@fileops</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span> <span class='dest identifier id'>dest</span><span class='comma token'>,</span> <span class='symbol val'>:mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>

    <span class='fsync_dir identifier id'>fsync_dir</span> <span class='dest identifier id'>dest</span>
    <span class='fsync_dir identifier id'>fsync_dir</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='dest identifier id'>dest</span><span class='comma token'>,</span> <span class='string val'>&quot;..&quot;</span><span class='rparen token'>)</span>

    <span class='return return kw'>return</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># it's a file</span>
  <span class='md5 identifier id'>md5</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='expected_md5sum identifier id'>expected_md5sum</span>
  <span class='destdir identifier id'>destdir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='destdir identifier id'>destdir</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='full_name identifier id'>full_name</span><span class='rparen token'>)</span>
  <span class='@fileops ivar id'>@fileops</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span> <span class='destdir identifier id'>destdir</span><span class='comma token'>,</span> <span class='symbol val'>:mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0755</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
  <span class='destfile identifier id'>destfile</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='destdir identifier id'>destdir</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='basename identifier id'>basename</span><span class='lparen token'>(</span><span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='full_name identifier id'>full_name</span><span class='rparen token'>)</span>
  <span class='@fileops ivar id'>@fileops</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span> <span class='integer val'>0600</span><span class='comma token'>,</span> <span class='destfile identifier id'>destfile</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span> <span class='comment val'># Errno::ENOENT</span>

  <span class='open identifier id'>open</span> <span class='destfile identifier id'>destfile</span><span class='comma token'>,</span> <span class='string val'>&quot;wb&quot;</span><span class='comma token'>,</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='os identifier id'>os</span><span class='bitor op'>|</span>
    <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>
      <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='integer val'>4096</span>
      <span class='break break kw'>break</span> <span class='unless unless_mod kw'>unless</span> <span class='data identifier id'>data</span>
      <span class='comment val'># HACK shouldn't we check the MD5 before writing to disk?</span>
      <span class='md5 identifier id'>md5</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span> <span class='if if_mod kw'>if</span> <span class='expected_md5sum identifier id'>expected_md5sum</span>
      <span class='os identifier id'>os</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='os identifier id'>os</span><span class='dot token'>.</span><span class='fsync identifier id'>fsync</span>
  <span class='end end kw'>end</span>

  <span class='@fileops ivar id'>@fileops</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span> <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='mode identifier id'>mode</span><span class='comma token'>,</span> <span class='destfile identifier id'>destfile</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
  <span class='fsync_dir identifier id'>fsync_dir</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='destfile identifier id'>destfile</span><span class='rparen token'>)</span>
  <span class='fsync_dir identifier id'>fsync_dir</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='destfile identifier id'>destfile</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;..&quot;</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='expected_md5sum identifier id'>expected_md5sum</span> <span class='andop op'>&amp;&amp;</span> <span class='expected_md5sum identifier id'>expected_md5sum</span> <span class='neq op'>!=</span> <span class='md5 identifier id'>md5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span> <span class='then then kw'>then</span>
    <span class='raise identifier id'>raise</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Package constant id'>Package</span><span class='colon2 op'>::</span><span class='BadCheckSum constant id'>BadCheckSum</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>load_gemspec</h3>
</div><div id="load_gemspec-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>load_gemspec</span><span class='args'>(io)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Attempt to YAML-load a gemspec from the given <em>io</em> parameter. Return
nil if it fails.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/package/tar_input.rb', line 181</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/package/tar_input.rb#L181">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">181
182
183
184
185</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='load_gemspec identifier id'>load_gemspec</span><span class='lparen token'>(</span><span class='io identifier id'>io</span><span class='rparen token'>)</span>
  <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Specification constant id'>Specification</span><span class='dot token'>.</span><span class='from_yaml identifier id'>from_yaml</span> <span class='io identifier id'>io</span>
<span class='rescue rescue kw'>rescue</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Exception constant id'>Exception</span>
  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>zipped_stream</h3>
</div><div id="zipped_stream-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>zipped_stream</span><span class='args'>(entry)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return an IO stream for the zipped entry.
</p>
<p>
NOTE: Originally this method used two approaches, Return a GZipReader
directly, or read the GZipReader into a string and return a StringIO on the
string. The string IO approach was used for versions of ZLib before 1.2.1
to avoid buffer errors on windows machines. Then we found that errors
happened with 1.2.1 as well, so we changed the condition. Then we
discovered errors occurred with versions as late as 1.2.3. At this point
(after some benchmarking to show we weren&#8217;t seriously crippling the
unpacking speed) we threw our hands in the air and declared that this
method would use the String IO approach on all platforms at all times. And
that&#8217;s the way it is.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/package/tar_input.rb', line 201</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/package/tar_input.rb#L201">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">201
202
203
204
205
206
207
208
209
210
211
212
213
214</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='zipped_stream identifier id'>zipped_stream</span><span class='lparen token'>(</span><span class='entry identifier id'>entry</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='defined? defined kw'>defined?</span> <span class='Rubinius constant id'>Rubinius</span> <span class='then then kw'>then</span>
    <span class='zis identifier id'>zis</span> <span class='assign token'>=</span> <span class='Zlib constant id'>Zlib</span><span class='colon2 op'>::</span><span class='GzipReader constant id'>GzipReader</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='entry identifier id'>entry</span>
    <span class='dis identifier id'>dis</span> <span class='assign token'>=</span> <span class='zis identifier id'>zis</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
    <span class='is identifier id'>is</span> <span class='assign token'>=</span> <span class='StringIO constant id'>StringIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dis identifier id'>dis</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># This is Jamis Buck's Zlib workaround for some unknown issue</span>
    <span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='rparen token'>)</span> <span class='comment val'># skip the gzip header</span>
    <span class='zis identifier id'>zis</span> <span class='assign token'>=</span> <span class='Zlib constant id'>Zlib</span><span class='colon2 op'>::</span><span class='Inflate constant id'>Inflate</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='minus op'>-</span><span class='Zlib constant id'>Zlib</span><span class='colon2 op'>::</span><span class='MAX_WBITS constant id'>MAX_WBITS</span><span class='rparen token'>)</span>
    <span class='is identifier id'>is</span> <span class='assign token'>=</span> <span class='StringIO constant id'>StringIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='zis identifier id'>zis</span><span class='dot token'>.</span><span class='inflate identifier id'>inflate</span><span class='lparen token'>(</span><span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='ensure ensure kw'>ensure</span>
  <span class='zis identifier id'>zis</span><span class='dot token'>.</span><span class='finish identifier id'>finish</span> <span class='if if_mod kw'>if</span> <span class='zis identifier id'>zis</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>