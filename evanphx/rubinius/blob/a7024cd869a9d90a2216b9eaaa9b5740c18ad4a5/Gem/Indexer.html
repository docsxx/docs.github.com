<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>evanphx's rubinius - Class: Gem::Indexer - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/evanphx/commits/rubinius/master" rel="alternate" title="Recent Commits to rubinius:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("evanphx", "rubinius", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("evanphx", "rubinius", "a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/evanphx/rubinius/tree/">Source</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/network">Network</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/evanphx/rubinius">Wiki</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/graphs">Graphs</a></li>                    
            <li class="active"><a href="/evanphx/rubinius">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/evanphx">evanphx</a> / <b><a href="http://github.com/evanphx/rubinius/tree">rubinius</a></b>        
                <a id="namespaces_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Gem_Indexer">
  <h1>Class: Gem::Indexer</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="Text.html" title="Gem::Text">Gem::Text</a>, <a href="UserInteraction.html" title="Gem::UserInteraction">Gem::UserInteraction</a></p>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="Text.html" title="Gem::Text">Gem::Text</a>, <a href="UserInteraction.html" title="Gem::UserInteraction">Gem::UserInteraction</a></p>
</div><div class="section docstring">
  <p>
Top level class for building the gem repository index.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">build_legacy</td>
          <td class="readwrite">
            [<span id='build_legacy-instance_method'>R</span><span id='build_legacy=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Build indexes for RubyGems older than 1.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">build_modern</td>
          <td class="readwrite">
            [<span id='build_modern-instance_method'>R</span><span id='build_modern=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Build indexes for RubyGems 1.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">dest_directory</td>
          <td class="readwrite">
            [<span id='dest_directory-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Index install location.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">dest_latest_specs_index</td>
          <td class="readwrite">
            [<span id='dest_latest_specs_index-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Latest specs index install location.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">dest_prerelease_specs_index</td>
          <td class="readwrite">
            [<span id='dest_prerelease_specs_index-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Prerelease specs index install location.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">dest_specs_index</td>
          <td class="readwrite">
            [<span id='dest_specs_index-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Specs index install location.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">directory</td>
          <td class="readwrite">
            [<span id='directory-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Index build directory.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(directory, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create an indexer that will index the gems in <tt>directory</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 59</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L59">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='directory identifier id'>directory</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='string val'>''</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span> <span class='colon op'>:</span><span class='to_xs identifier id'>to_xs</span> <span class='then then kw'>then</span>
    <span class='fail identifier id'>fail</span> <span class='string val'>&quot;Gem::Indexer requires that the XML Builder library be installed:&quot;</span> \
         <span class='string val'>&quot;\n\tgem install builder&quot;</span>
  <span class='end end kw'>end</span>

  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:build_legacy</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:build_modern</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span> <span class='options identifier id'>options</span>

  <span class='@build_legacy ivar id'>@build_legacy</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:build_legacy</span><span class='rbrack token'>]</span>
  <span class='@build_modern ivar id'>@build_modern</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:build_modern</span><span class='rbrack token'>]</span>

  <span class='@rss_title ivar id'>@rss_title</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:rss_title</span><span class='rbrack token'>]</span>
  <span class='@rss_host ivar id'>@rss_host</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:rss_host</span><span class='rbrack token'>]</span>
  <span class='@rss_gems_host ivar id'>@rss_gems_host</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:rss_gems_host</span><span class='rbrack token'>]</span>

  <span class='@dest_directory ivar id'>@dest_directory</span> <span class='assign token'>=</span> <span class='directory identifier id'>directory</span>
  <span class='@directory ivar id'>@directory</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='tmpdir identifier id'>tmpdir</span><span class='comma token'>,</span> <span class='dstring node'>&quot;gem_generate_index_#{$$}&quot;</span>

  <span class='marshal_name identifier id'>marshal_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;Marshal.#{Gem.marshal_version}&quot;</span>

  <span class='@master_index ivar id'>@master_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='string val'>'yaml'</span>
  <span class='@marshal_index ivar id'>@marshal_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='marshal_name identifier id'>marshal_name</span>

  <span class='@quick_dir ivar id'>@quick_dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='string val'>'quick'</span>

  <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@quick_dir ivar id'>@quick_dir</span><span class='comma token'>,</span> <span class='marshal_name identifier id'>marshal_name</span>

  <span class='@quick_index ivar id'>@quick_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@quick_dir ivar id'>@quick_dir</span><span class='comma token'>,</span> <span class='string val'>'index'</span>
  <span class='@latest_index ivar id'>@latest_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@quick_dir ivar id'>@quick_dir</span><span class='comma token'>,</span> <span class='string val'>'latest_index'</span>

  <span class='@specs_index ivar id'>@specs_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='dstring node'>&quot;specs.#{Gem.marshal_version}&quot;</span>
  <span class='@latest_specs_index ivar id'>@latest_specs_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span>
                                  <span class='dstring node'>&quot;latest_specs.#{Gem.marshal_version}&quot;</span>
  <span class='@prerelease_specs_index ivar id'>@prerelease_specs_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='@directory ivar id'>@directory</span><span class='comma token'>,</span>
                                      <span class='dstring node'>&quot;prerelease_specs.#{Gem.marshal_version}&quot;</span><span class='rparen token'>)</span>

  <span class='@dest_specs_index ivar id'>@dest_specs_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span>
                                <span class='dstring node'>&quot;specs.#{Gem.marshal_version}&quot;</span>
  <span class='@dest_latest_specs_index ivar id'>@dest_latest_specs_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span>
                                       <span class='dstring node'>&quot;latest_specs.#{Gem.marshal_version}&quot;</span>
  <span class='@dest_prerelease_specs_index ivar id'>@dest_prerelease_specs_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span>
                                          <span class='dstring node'>&quot;prerelease_specs.#{Gem.marshal_version}&quot;</span>

  <span class='@rss_index ivar id'>@rss_index</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='string val'>'index.rss'</span>

  <span class='@files ivar id'>@files</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <div class="included">
  
  <div>
    <h2>Public Class Methods Included from <a href="Text.html" title="Gem::Text">Gem::Text</a></h2>
    <p><span class='name'><a href="Text.html#format_text-instance_method" title="format_text">format_text</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#abbreviate-instance_method">#abbreviate</span><span class='args'>(spec)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Abbreviate the spec for downloading.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_indicies-instance_method">#build_indicies</span><span class='args'>(index)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Build various indicies.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_legacy_indicies-instance_method">#build_legacy_indicies</span><span class='args'>(index)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Builds indicies for RubyGems older than 1.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_marshal_gemspecs-instance_method">#build_marshal_gemspecs</span><span class='args'>(index)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Builds Marshal quick index gemspecs.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_modern_index-instance_method">#build_modern_index</span><span class='args'>(index, file, name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Build a single index for RubyGems 1.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_modern_indicies-instance_method">#build_modern_indicies</span><span class='args'>(index)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Builds indicies for RubyGems 1.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_rss-instance_method">#build_rss</span><span class='args'>(index)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Builds an RSS feed for past two days gem releases according to the
gem&#8217;s date.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#collect_specs-instance_method">#collect_specs</span><span class='args'>(gems = gem_file_list)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Collect specifications from .
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#compact_specs-instance_method">#compact_specs</span><span class='args'>(specs)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compacts Marshal output for the specs index data source by using identical
objects as much as possible.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#compress-instance_method">#compress</span><span class='args'>(filename, extension)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compress <tt>filename</tt> with <tt>extension</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#compress_indicies-instance_method">#compress_indicies</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Compresses indicies on disk &#8212; All future files should be compressed
using gzip, not deflate.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#gem_file_list-instance_method">#gem_file_list</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
List of gem file names to index.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#generate_index-instance_method">#generate_index</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Builds and installs indicies.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#gzip-instance_method">#gzip</span><span class='args'>(filename)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Zlib::GzipWriter wrapper that gzips <tt>filename</tt> on disk.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#install_indicies-instance_method">#install_indicies</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Install generated indicies into the destination directory.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#make_temp_directories-instance_method">#make_temp_directories</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Make directories for index generation.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#paranoid-instance_method">#paranoid</span><span class='args'>(path, extension)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Ensure <tt>path</tt> and path with <tt>extension</tt> are identical.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#sanitize-instance_method">#sanitize</span><span class='args'>(spec)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sanitize the descriptive fields in the spec.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#sanitize_string-instance_method">#sanitize_string</span><span class='args'>(string)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sanitize a single string.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#update_index-instance_method">#update_index</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Perform an in-place update of the repository from newly added gems.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#update_specs_index-instance_method">#update_specs_index</span><span class='args'>(index, source, dest)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Combines specs in <tt>index</tt> and <tt>source</tt> then writes out a new
copy to <tt>dest</tt>.
</p>

        
      </td>
    </tr>
  
</table><div class="included">
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>abbreviate</h3>
</div><div id="abbreviate-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>abbreviate</span><span class='args'>(spec)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Abbreviate the spec for downloading. Abbreviated specs are only used for
searching, downloading and related activities and do not need deployment
specific information (e.g. list of files). So we abbreviate the spec,
making it much smaller for quicker downloads.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 113</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L113">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">113
114
115
116
117
118
119
120</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='abbreviate identifier id'>abbreviate</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='rparen token'>)</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='files identifier id'>files</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='test_files identifier id'>test_files</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='rdoc_options identifier id'>rdoc_options</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='extra_rdoc_files identifier id'>extra_rdoc_files</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='cert_chain identifier id'>cert_chain</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='spec identifier id'>spec</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_indicies</h3>
</div><div id="build_indicies-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_indicies</span><span class='args'>(index)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Build various indicies
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 125</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L125">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">125
126
127
128
129
130
131
132
133</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_indicies identifier id'>build_indicies</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span>
  <span class='comment val'># Marshal gemspecs are used by both modern and legacy RubyGems</span>
  <span class='build_marshal_gemspecs identifier id'>build_marshal_gemspecs</span> <span class='index identifier id'>index</span>
  <span class='build_legacy_indicies identifier id'>build_legacy_indicies</span> <span class='index identifier id'>index</span> <span class='if if_mod kw'>if</span> <span class='@build_legacy ivar id'>@build_legacy</span>
  <span class='build_modern_indicies identifier id'>build_modern_indicies</span> <span class='index identifier id'>index</span> <span class='if if_mod kw'>if</span> <span class='@build_modern ivar id'>@build_modern</span>
  <span class='build_rss identifier id'>build_rss</span> <span class='index identifier id'>index</span>

  <span class='compress_indicies identifier id'>compress_indicies</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_legacy_indicies</h3>
</div><div id="build_legacy_indicies-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_legacy_indicies</span><span class='args'>(index)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds indicies for RubyGems older than 1.2.x
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 138</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L138">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_legacy_indicies identifier id'>build_legacy_indicies</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span>
  <span class='progress identifier id'>progress</span> <span class='assign token'>=</span> <span class='ui identifier id'>ui</span><span class='dot token'>.</span><span class='progress_reporter identifier id'>progress_reporter</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>
                                  <span class='dstring node'>&quot;Generating YAML quick index gemspecs for #{index.size} gems&quot;</span><span class='comma token'>,</span>
                                  <span class='string val'>&quot;Complete&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Generated YAML quick index gemspecs'</span> <span class='do do kw'>do</span>
    <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='original_name identifier id'>original_name</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span>
      <span class='spec_file_name identifier id'>spec_file_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{original_name}.gemspec.rz&quot;</span>
      <span class='yaml_name identifier id'>yaml_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@quick_dir ivar id'>@quick_dir</span><span class='comma token'>,</span> <span class='spec_file_name identifier id'>spec_file_name</span>

      <span class='yaml_zipped identifier id'>yaml_zipped</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='deflate identifier id'>deflate</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='to_yaml identifier id'>to_yaml</span>
      <span class='open identifier id'>open</span> <span class='yaml_name identifier id'>yaml_name</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span> <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='yaml_zipped identifier id'>yaml_zipped</span> <span class='end end kw'>end</span>

      <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='updated identifier id'>updated</span> <span class='original_name identifier id'>original_name</span>
    <span class='end end kw'>end</span>

    <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='done identifier id'>done</span>
  <span class='end end kw'>end</span>

  <span class='say identifier id'>say</span> <span class='string val'>&quot;Generating quick index&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Generated quick index'</span> <span class='do do kw'>do</span>
    <span class='open identifier id'>open</span> <span class='@quick_index ivar id'>@quick_index</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='_ identifier id'>_</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_name identifier id'>original_name</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='say identifier id'>say</span> <span class='string val'>&quot;Generating latest index&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Generated latest index'</span> <span class='do do kw'>do</span>
    <span class='open identifier id'>open</span> <span class='@latest_index ivar id'>@latest_index</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='latest_specs identifier id'>latest_specs</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='spec identifier id'>spec</span><span class='bitor op'>|</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_name identifier id'>original_name</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Don't need prerelease legacy index</span>

  <span class='say identifier id'>say</span> <span class='string val'>&quot;Generating Marshal master index&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Generated Marshal master index'</span> <span class='do do kw'>do</span>
    <span class='open identifier id'>open</span> <span class='@marshal_index ivar id'>@marshal_index</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='progress identifier id'>progress</span> <span class='assign token'>=</span> <span class='ui identifier id'>ui</span><span class='dot token'>.</span><span class='progress_reporter identifier id'>progress_reporter</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>
                                  <span class='dstring node'>&quot;Generating YAML master index for #{index.size} gems (this may take a while)&quot;</span><span class='comma token'>,</span>
                                  <span class='string val'>&quot;Complete&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Generated YAML master index'</span> <span class='do do kw'>do</span>
    <span class='open identifier id'>open</span> <span class='@master_index ivar id'>@master_index</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;--- !ruby/object:#{index.class}&quot;</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='string val'>&quot;gems:&quot;</span>

      <span class='gems identifier id'>gems</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='gemspec identifier id'>gemspec</span><span class='bitor op'>|</span> <span class='gemspec identifier id'>gemspec</span><span class='dot token'>.</span><span class='sort_obj identifier id'>sort_obj</span> <span class='rbrace token'>}</span>
      <span class='gems identifier id'>gems</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='original_name identifier id'>original_name</span><span class='comma token'>,</span> <span class='gemspec identifier id'>gemspec</span><span class='bitor op'>|</span>
        <span class='yaml identifier id'>yaml</span> <span class='assign token'>=</span> <span class='gemspec identifier id'>gemspec</span><span class='dot token'>.</span><span class='to_yaml identifier id'>to_yaml</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/^/</span><span class='comma token'>,</span> <span class='string val'>'    '</span><span class='rparen token'>)</span>
        <span class='yaml identifier id'>yaml</span> <span class='assign token'>=</span> <span class='yaml identifier id'>yaml</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/\A    ---/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span> <span class='comment val'># there's a needed extra ' ' here</span>
        <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='dstring node'>&quot;  #{original_name}:&quot;</span>
        <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='yaml identifier id'>yaml</span>

        <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='updated identifier id'>updated</span> <span class='original_name identifier id'>original_name</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='done identifier id'>done</span>
  <span class='end end kw'>end</span>

  <span class='@files ivar id'>@files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@quick_dir ivar id'>@quick_dir</span>
  <span class='@files ivar id'>@files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@master_index ivar id'>@master_index</span>
  <span class='@files ivar id'>@files</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@master_index}.Z&quot;</span>
  <span class='@files ivar id'>@files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@marshal_index ivar id'>@marshal_index</span>
  <span class='@files ivar id'>@files</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@marshal_index}.Z&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_marshal_gemspecs</h3>
</div><div id="build_marshal_gemspecs-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_marshal_gemspecs</span><span class='args'>(index)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds Marshal quick index gemspecs.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 216</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L216">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_marshal_gemspecs identifier id'>build_marshal_gemspecs</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span>
  <span class='progress identifier id'>progress</span> <span class='assign token'>=</span> <span class='ui identifier id'>ui</span><span class='dot token'>.</span><span class='progress_reporter identifier id'>progress_reporter</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>
                                  <span class='dstring node'>&quot;Generating Marshal quick index gemspecs for #{index.size} gems&quot;</span><span class='comma token'>,</span>
                                  <span class='string val'>&quot;Complete&quot;</span>

  <span class='files identifier id'>files</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Generated Marshal quick index gemspecs'</span> <span class='do do kw'>do</span>
    <span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='dot token'>.</span><span class='gems identifier id'>gems</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='dot token'>.</span><span class='prerelease_gems identifier id'>prerelease_gems</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='original_name identifier id'>original_name</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span>
      <span class='spec_file_name identifier id'>spec_file_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{original_name}.gemspec.rz&quot;</span>
      <span class='marshal_name identifier id'>marshal_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span><span class='comma token'>,</span> <span class='spec_file_name identifier id'>spec_file_name</span>

      <span class='marshal_zipped identifier id'>marshal_zipped</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='deflate identifier id'>deflate</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='rparen token'>)</span>
      <span class='open identifier id'>open</span> <span class='marshal_name identifier id'>marshal_name</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span> <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='marshal_zipped identifier id'>marshal_zipped</span> <span class='end end kw'>end</span>

      <span class='files identifier id'>files</span> <span class='lshft op'>&lt;&lt;</span> <span class='marshal_name identifier id'>marshal_name</span>

      <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='updated identifier id'>updated</span> <span class='original_name identifier id'>original_name</span>
    <span class='end end kw'>end</span>

    <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='done identifier id'>done</span>
  <span class='end end kw'>end</span>

  <span class='@files ivar id'>@files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span>

  <span class='files identifier id'>files</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_modern_index</h3>
</div><div id="build_modern_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_modern_index</span><span class='args'>(index, file, name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Build a single index for RubyGems 1.2 and newer
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 247</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L247">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_modern_index identifier id'>build_modern_index</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='file identifier id'>file</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='say identifier id'>say</span> <span class='dstring node'>&quot;Generating #{name} index&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='dstring node'>&quot;Generated #{name} index&quot;</span> <span class='do do kw'>do</span>
    <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='comma token'>,</span> <span class='string val'>'wb'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
      <span class='specs identifier id'>specs</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='spec identifier id'>spec</span><span class='bitor op'>|</span>
        <span class='comment val'># We have to splat here because latest_specs is an array,</span>
        <span class='comment val'># while the others are hashes. See the TODO in source_index.rb</span>
        <span class='spec identifier id'>spec</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
        <span class='platform identifier id'>platform</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_platform identifier id'>original_platform</span>

        <span class='comment val'># win32-api-1.0.4-x86-mswin32-60</span>
        <span class='unless unless kw'>unless</span> <span class='String constant id'>String</span> <span class='eqq op'>===</span> <span class='platform identifier id'>platform</span> <span class='then then kw'>then</span>
          <span class='alert_warning identifier id'>alert_warning</span> <span class='dstring node'>&quot;Skipping invalid platform in gem: #{spec.full_name}&quot;</span>
          <span class='next next kw'>next</span>
        <span class='end end kw'>end</span>

        <span class='platform identifier id'>platform</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Platform constant id'>Platform</span><span class='colon2 op'>::</span><span class='RUBY constant id'>RUBY</span> <span class='if if_mod kw'>if</span> <span class='platform identifier id'>platform</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='platform identifier id'>platform</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
        <span class='lbrack token'>[</span><span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='comma token'>,</span> <span class='platform identifier id'>platform</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>

      <span class='specs identifier id'>specs</span> <span class='assign token'>=</span> <span class='compact_specs identifier id'>compact_specs</span><span class='lparen token'>(</span><span class='specs identifier id'>specs</span><span class='rparen token'>)</span>
      <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span><span class='lparen token'>(</span><span class='specs identifier id'>specs</span><span class='comma token'>,</span> <span class='io identifier id'>io</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_modern_indicies</h3>
</div><div id="build_modern_indicies-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_modern_indicies</span><span class='args'>(index)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds indicies for RubyGems 1.2 and newer. Handles full, latest,
prerelease
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 277</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L277">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_modern_indicies identifier id'>build_modern_indicies</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span>
  <span class='build_modern_index identifier id'>build_modern_index</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='comma token'>,</span> <span class='@specs_index ivar id'>@specs_index</span><span class='comma token'>,</span> <span class='string val'>'specs'</span><span class='rparen token'>)</span>
  <span class='build_modern_index identifier id'>build_modern_index</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='dot token'>.</span><span class='latest_specs identifier id'>latest_specs</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='comma token'>,</span>
                     <span class='@latest_specs_index ivar id'>@latest_specs_index</span><span class='comma token'>,</span>
                     <span class='string val'>'latest specs'</span><span class='rparen token'>)</span>
  <span class='build_modern_index identifier id'>build_modern_index</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='dot token'>.</span><span class='prerelease_specs identifier id'>prerelease_specs</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='comma token'>,</span>
                     <span class='@prerelease_specs_index ivar id'>@prerelease_specs_index</span><span class='comma token'>,</span>
                     <span class='string val'>'prerelease specs'</span><span class='rparen token'>)</span>

  <span class='@files ivar id'>@files</span> <span class='opasgn op'>+=</span> <span class='lbrack token'>[</span><span class='@specs_index ivar id'>@specs_index</span><span class='comma token'>,</span>
             <span class='dstring node'>&quot;#{@specs_index}.gz&quot;</span><span class='comma token'>,</span>
             <span class='@latest_specs_index ivar id'>@latest_specs_index</span><span class='comma token'>,</span>
             <span class='dstring node'>&quot;#{@latest_specs_index}.gz&quot;</span><span class='comma token'>,</span>
             <span class='@prerelease_specs_index ivar id'>@prerelease_specs_index</span><span class='comma token'>,</span>
             <span class='dstring node'>&quot;#{@prerelease_specs_index}.gz&quot;</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_rss</h3>
</div><div id="build_rss-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_rss</span><span class='args'>(index)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds an RSS feed for past two days gem releases according to the
gem&#8217;s date.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 298</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L298">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_rss identifier id'>build_rss</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='@rss_host ivar id'>@rss_host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='@rss_gems_host ivar id'>@rss_gems_host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
    <span class='if if kw'>if</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span> <span class='then then kw'>then</span>
      <span class='alert_warning identifier id'>alert_warning</span> <span class='string val'>&quot;no --rss-host or --rss-gems-host, RSS generation disabled&quot;</span>
    <span class='end end kw'>end</span>
    <span class='return return kw'>return</span>
  <span class='end end kw'>end</span>

  <span class='require identifier id'>require</span> <span class='string val'>'cgi'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'rubygems/text'</span>

  <span class='extend identifier id'>extend</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Text constant id'>Text</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Generated rss'</span> <span class='do do kw'>do</span>
    <span class='open identifier id'>open</span> <span class='@rss_index ivar id'>@rss_index</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
      <span class='rss_host identifier id'>rss_host</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='dot token'>.</span><span class='escapeHTML identifier id'>escapeHTML</span> <span class='@rss_host ivar id'>@rss_host</span>
      <span class='rss_title identifier id'>rss_title</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='dot token'>.</span><span class='escapeHTML identifier id'>escapeHTML</span><span class='lparen token'>(</span><span class='@rss_title ivar id'>@rss_title</span> <span class='orop op'>||</span> <span class='string val'>'gems'</span><span class='rparen token'>)</span>

      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='string val'>&quot;&lt;?xml version=\&quot;1.0\&quot;?&gt;\n&lt;rss version=\&quot;2.0\&quot;&gt;\n&lt;channel&gt;\n&lt;title&gt;\#{rss_title}&lt;/title&gt;\n&lt;link&gt;http://\#{rss_host}&lt;/link&gt;\n&lt;description&gt;Recently released gems from http://\#{rss_host}&lt;/description&gt;\n&lt;generator&gt;RubyGems v\#{Gem::RubyGemsVersion}&lt;/generator&gt;\n&lt;docs&gt;http://cyber.law.harvard.edu/rss/rss.html&lt;/docs&gt;\n&quot;</span>

      <span class='today identifier id'>today</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Specification constant id'>Specification</span><span class='colon2 op'>::</span><span class='TODAY constant id'>TODAY</span>
      <span class='yesterday identifier id'>yesterday</span> <span class='assign token'>=</span> <span class='today identifier id'>today</span> <span class='minus op'>-</span> <span class='integer val'>86400</span>

      <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='_ identifier id'>_</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span>
        <span class='spec_date identifier id'>spec_date</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='date identifier id'>date</span>

        <span class='case case kw'>case</span> <span class='spec_date identifier id'>spec_date</span>
        <span class='when when kw'>when</span> <span class='Date constant id'>Date</span>
          <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='spec_date identifier id'>spec_date</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='geq op'>&gt;=</span> <span class='yesterday identifier id'>yesterday</span>
        <span class='when when kw'>when</span> <span class='Time constant id'>Time</span>
          <span class='spec_date identifier id'>spec_date</span> <span class='geq op'>&gt;=</span> <span class='yesterday identifier id'>yesterday</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='_ identifier id'>_</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span>
        <span class='spec_date identifier id'>spec_date</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='date identifier id'>date</span>

        <span class='case case kw'>case</span> <span class='spec_date identifier id'>spec_date</span>
        <span class='when when kw'>when</span> <span class='Date constant id'>Date</span>
          <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='spec_date identifier id'>spec_date</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='leq op'>&lt;=</span> <span class='today identifier id'>today</span>
        <span class='when when kw'>when</span> <span class='Time constant id'>Time</span>
          <span class='spec_date identifier id'>spec_date</span> <span class='leq op'>&lt;=</span> <span class='today identifier id'>today</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='_ identifier id'>_</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='minus op'>-</span><span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='date identifier id'>date</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='_ identifier id'>_</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span>
        <span class='gem_path identifier id'>gem_path</span> <span class='assign token'>=</span> <span class='CGI constant id'>CGI</span><span class='dot token'>.</span><span class='escapeHTML identifier id'>escapeHTML</span> <span class='dstring node'>&quot;http://#{@rss_gems_host}/gems/#{spec.full_name}.gem&quot;</span>
        <span class='size identifier id'>size</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='stat identifier id'>stat</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='loaded_from identifier id'>loaded_from</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='rescue rescue kw'>rescue</span> <span class='next next kw'>next</span>

        <span class='description identifier id'>description</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='description identifier id'>description</span> <span class='orop op'>||</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='summary identifier id'>summary</span> <span class='orop op'>||</span> <span class='string val'>''</span>
        <span class='authors identifier id'>authors</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='authors identifier id'>authors</span>
        <span class='emails identifier id'>emails</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='email identifier id'>email</span>
        <span class='authors identifier id'>authors</span> <span class='assign token'>=</span> <span class='emails identifier id'>emails</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='authors identifier id'>authors</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='email identifier id'>email</span><span class='comma token'>,</span> <span class='author identifier id'>author</span><span class='bitor op'>|</span>
          <span class='email identifier id'>email</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot; (#{author})&quot;</span> <span class='if if_mod kw'>if</span> <span class='author identifier id'>author</span> <span class='and and kw'>and</span> <span class='not not kw'>not</span> <span class='author identifier id'>author</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
        <span class='end end kw'>end</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='string val'>', '</span>

        <span class='description identifier id'>description</span> <span class='assign token'>=</span> <span class='description identifier id'>description</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\n\n+/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='chunk identifier id'>chunk</span><span class='bitor op'>|</span>
          <span class='format_text identifier id'>format_text</span> <span class='chunk identifier id'>chunk</span><span class='comma token'>,</span> <span class='integer val'>78</span>
        <span class='end end kw'>end</span>

        <span class='description identifier id'>description</span> <span class='assign token'>=</span> <span class='description identifier id'>description</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='string val'>&quot;\n\n&quot;</span>

        <span class='item identifier id'>item</span> <span class='assign token'>=</span> <span class='string val'>''</span>

        <span class='item identifier id'>item</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;item&gt;\n&lt;title&gt;\#{CGI.escapeHTML spec.full_name}&lt;/title&gt;\n&lt;description&gt;\n&amp;lt;pre&amp;gt;\#{CGI.escapeHTML description.chomp}&amp;lt;/pre&amp;gt;\n&lt;/description&gt;\n&lt;author&gt;\#{CGI.escapeHTML authors}&lt;/author&gt;\n&lt;guid&gt;\#{CGI.escapeHTML spec.full_name}&lt;/guid&gt;\n&lt;enclosure url=\\\&quot;\#{gem_path}\\\&quot;\nlength=\\\&quot;\#{size}\\\&quot; type=\\\&quot;application/octet-stream\\\&quot; /&gt;\n&lt;pubDate&gt;\#{spec.date.rfc2822}&lt;/pubDate&gt;\n&quot;</span>

        <span class='item identifier id'>item</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;link&gt;\#{CGI.escapeHTML spec.homepage}&lt;/link&gt;\n&quot;</span> <span class='if if_mod kw'>if</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='homepage identifier id'>homepage</span>

        <span class='item identifier id'>item</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/item&gt;\n&quot;</span>

        <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='item identifier id'>item</span>
      <span class='end end kw'>end</span>

      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='string val'>&quot;&lt;/channel&gt;\n&lt;/rss&gt;\n&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@files ivar id'>@files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@rss_index ivar id'>@rss_index</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>collect_specs</h3>
</div><div id="collect_specs-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>collect_specs</span><span class='args'>(gems = gem_file_list)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Collect specifications from .gem files from the gem directory.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 413</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L413">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='collect_specs identifier id'>collect_specs</span><span class='lparen token'>(</span><span class='gems identifier id'>gems</span> <span class='assign token'>=</span> <span class='gem_file_list identifier id'>gem_file_list</span><span class='rparen token'>)</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='SourceIndex constant id'>SourceIndex</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

  <span class='progress identifier id'>progress</span> <span class='assign token'>=</span> <span class='ui identifier id'>ui</span><span class='dot token'>.</span><span class='progress_reporter identifier id'>progress_reporter</span> <span class='gems identifier id'>gems</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>
                                  <span class='dstring node'>&quot;Loading #{gems.size} gems from #{@dest_directory}&quot;</span><span class='comma token'>,</span>
                                  <span class='string val'>&quot;Loaded all gems&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'loaded'</span> <span class='do do kw'>do</span>
    <span class='gems identifier id'>gems</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='gemfile identifier id'>gemfile</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='lparen token'>(</span><span class='gemfile identifier id'>gemfile</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='then then kw'>then</span>
        <span class='alert_warning identifier id'>alert_warning</span> <span class='dstring node'>&quot;Skipping zero-length gem: #{gemfile}&quot;</span>
        <span class='next next kw'>next</span>
      <span class='end end kw'>end</span>

      <span class='begin begin kw'>begin</span>
        <span class='spec identifier id'>spec</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Format constant id'>Format</span><span class='dot token'>.</span><span class='from_file_by_path identifier id'>from_file_by_path</span><span class='lparen token'>(</span><span class='gemfile identifier id'>gemfile</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='spec identifier id'>spec</span>
        <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='loaded_from identifier id'>loaded_from</span> <span class='assign token'>=</span> <span class='gemfile identifier id'>gemfile</span>

        <span class='unless unless kw'>unless</span> <span class='gemfile identifier id'>gemfile</span> <span class='match op'>=~</span> <span class='dregexp node'>/\/#{Regexp.escape spec.original_name}.*\.gem\z/i</span> <span class='then then kw'>then</span>
          <span class='expected_name identifier id'>expected_name</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='full_name identifier id'>full_name</span>
          <span class='expected_name identifier id'>expected_name</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; (#{spec.original_name})&quot;</span> <span class='if if_mod kw'>if</span>
            <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_name identifier id'>original_name</span> <span class='neq op'>!=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='full_name identifier id'>full_name</span>
          <span class='alert_warning identifier id'>alert_warning</span> <span class='dstring node'>&quot;Skipping misnamed gem: #{gemfile} should be named #{expected_name}&quot;</span>
          <span class='next next kw'>next</span>
        <span class='end end kw'>end</span>

        <span class='abbreviate identifier id'>abbreviate</span> <span class='spec identifier id'>spec</span>
        <span class='sanitize identifier id'>sanitize</span> <span class='spec identifier id'>spec</span>

        <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='add_spec identifier id'>add_spec</span> <span class='spec identifier id'>spec</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_name identifier id'>original_name</span>

        <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='updated identifier id'>updated</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_name identifier id'>original_name</span>

      <span class='rescue rescue kw'>rescue</span> <span class='SignalException constant id'>SignalException</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='alert_error identifier id'>alert_error</span> <span class='string val'>&quot;Received signal, exiting&quot;</span>
        <span class='raise identifier id'>raise</span>
      <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='alert_error identifier id'>alert_error</span> <span class='dstring node'>&quot;Unable to process #{gemfile}\n#{e.message} (#{e.class})\n\t#{e.backtrace.join &quot;\n\t&quot;}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='progress identifier id'>progress</span><span class='dot token'>.</span><span class='done identifier id'>done</span>
  <span class='end end kw'>end</span>

  <span class='index identifier id'>index</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>compact_specs</h3>
</div><div id="compact_specs-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>compact_specs</span><span class='args'>(specs)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compacts Marshal output for the specs index data source by using identical
objects as much as possible.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 495</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L495">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">495
496
497
498
499
500
501
502
503
504
505
506
507</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='compact_specs identifier id'>compact_specs</span><span class='lparen token'>(</span><span class='specs identifier id'>specs</span><span class='rparen token'>)</span>
  <span class='names identifier id'>names</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='versions identifier id'>versions</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='platforms identifier id'>platforms</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='specs identifier id'>specs</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='version identifier id'>version</span><span class='comma token'>,</span> <span class='platform identifier id'>platform</span><span class='rparen token'>)</span><span class='bitor op'>|</span>
    <span class='names identifier id'>names</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span> <span class='unless unless_mod kw'>unless</span> <span class='names identifier id'>names</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='name identifier id'>name</span>
    <span class='versions identifier id'>versions</span><span class='lbrack token'>[</span><span class='version identifier id'>version</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='version identifier id'>version</span> <span class='unless unless_mod kw'>unless</span> <span class='versions identifier id'>versions</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='version identifier id'>version</span>
    <span class='platforms identifier id'>platforms</span><span class='lbrack token'>[</span><span class='platform identifier id'>platform</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='platform identifier id'>platform</span> <span class='unless unless_mod kw'>unless</span> <span class='platforms identifier id'>platforms</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='platform identifier id'>platform</span>

    <span class='lbrack token'>[</span><span class='names identifier id'>names</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='versions identifier id'>versions</span><span class='lbrack token'>[</span><span class='version identifier id'>version</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='platforms identifier id'>platforms</span><span class='lbrack token'>[</span><span class='platform identifier id'>platform</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>compress</h3>
</div><div id="compress-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>compress</span><span class='args'>(filename, extension)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compress <tt>filename</tt> with <tt>extension</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 512</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L512">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">512
513
514
515
516
517
518
519
520</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='compress identifier id'>compress</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='extension identifier id'>extension</span><span class='rparen token'>)</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='read_binary identifier id'>read_binary</span> <span class='filename identifier id'>filename</span>

  <span class='zipped identifier id'>zipped</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='deflate identifier id'>deflate</span> <span class='data identifier id'>data</span>

  <span class='open identifier id'>open</span> <span class='dstring node'>&quot;#{filename}.#{extension}&quot;</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
    <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='zipped identifier id'>zipped</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>compress_indicies</h3>
</div><div id="compress_indicies-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>compress_indicies</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Compresses indicies on disk &#8212; All future files should be compressed
using gzip, not deflate
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 465</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L465">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='compress_indicies identifier id'>compress_indicies</span>
  <span class='say identifier id'>say</span> <span class='string val'>&quot;Compressing indicies&quot;</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Compressed indicies'</span> <span class='do do kw'>do</span>
    <span class='if if kw'>if</span> <span class='@build_legacy ivar id'>@build_legacy</span> <span class='then then kw'>then</span>
      <span class='compress identifier id'>compress</span> <span class='@quick_index ivar id'>@quick_index</span><span class='comma token'>,</span> <span class='string val'>'rz'</span>
      <span class='paranoid identifier id'>paranoid</span> <span class='@quick_index ivar id'>@quick_index</span><span class='comma token'>,</span> <span class='string val'>'rz'</span>

      <span class='compress identifier id'>compress</span> <span class='@latest_index ivar id'>@latest_index</span><span class='comma token'>,</span> <span class='string val'>'rz'</span>
      <span class='paranoid identifier id'>paranoid</span> <span class='@latest_index ivar id'>@latest_index</span><span class='comma token'>,</span> <span class='string val'>'rz'</span>

      <span class='compress identifier id'>compress</span> <span class='@marshal_index ivar id'>@marshal_index</span><span class='comma token'>,</span> <span class='string val'>'Z'</span>
      <span class='paranoid identifier id'>paranoid</span> <span class='@marshal_index ivar id'>@marshal_index</span><span class='comma token'>,</span> <span class='string val'>'Z'</span>

      <span class='compress identifier id'>compress</span> <span class='@master_index ivar id'>@master_index</span><span class='comma token'>,</span> <span class='string val'>'Z'</span>
      <span class='paranoid identifier id'>paranoid</span> <span class='@master_index ivar id'>@master_index</span><span class='comma token'>,</span> <span class='string val'>'Z'</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='@build_modern ivar id'>@build_modern</span> <span class='then then kw'>then</span>
      <span class='gzip identifier id'>gzip</span> <span class='@specs_index ivar id'>@specs_index</span>
      <span class='gzip identifier id'>gzip</span> <span class='@latest_specs_index ivar id'>@latest_specs_index</span>
      <span class='gzip identifier id'>gzip</span> <span class='@prerelease_specs_index ivar id'>@prerelease_specs_index</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>gem_file_list</h3>
</div><div id="gem_file_list-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>gem_file_list</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
List of gem file names to index.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 525</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L525">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">525
526
527</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='gem_file_list identifier id'>gem_file_list</span>
  <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span> <span class='string val'>&quot;gems&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;*.gem&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>generate_index</h3>
</div><div id="generate_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>generate_index</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds and installs indicies.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 532</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L532">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">532
533
534
535
536
537
538
539
540</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='generate_index identifier id'>generate_index</span>
  <span class='make_temp_directories identifier id'>make_temp_directories</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='collect_specs identifier id'>collect_specs</span>
  <span class='build_indicies identifier id'>build_indicies</span> <span class='index identifier id'>index</span>
  <span class='install_indicies identifier id'>install_indicies</span>
<span class='rescue rescue kw'>rescue</span> <span class='SignalException constant id'>SignalException</span>
<span class='ensure ensure kw'>ensure</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rm_rf identifier id'>rm_rf</span> <span class='@directory ivar id'>@directory</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>gzip</h3>
</div><div id="gzip-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>gzip</span><span class='args'>(filename)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Zlib::GzipWriter wrapper that gzips <tt>filename</tt> on disk.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 545</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L545">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">545
546
547
548
549</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='gzip identifier id'>gzip</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='Zlib constant id'>Zlib</span><span class='colon2 op'>::</span><span class='GzipWriter constant id'>GzipWriter</span><span class='dot token'>.</span><span class='open identifier id'>open</span> <span class='dstring node'>&quot;#{filename}.gz&quot;</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
    <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='read_binary identifier id'>read_binary</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>install_indicies</h3>
</div><div id="install_indicies-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>install_indicies</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Install generated indicies into the destination directory.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 554</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L554">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='install_indicies identifier id'>install_indicies</span>
  <span class='verbose identifier id'>verbose</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>

  <span class='say identifier id'>say</span> <span class='dstring node'>&quot;Moving index into production dir #{@dest_directory}&quot;</span> <span class='if if_mod kw'>if</span> <span class='verbose identifier id'>verbose</span>

  <span class='files identifier id'>files</span> <span class='assign token'>=</span> <span class='@files ivar id'>@files</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span> <span class='if if_mod kw'>if</span> <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='@quick_dir ivar id'>@quick_dir</span>

  <span class='if if kw'>if</span> <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span> <span class='and and kw'>and</span>
     <span class='not not kw'>not</span> <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='@quick_dir ivar id'>@quick_dir</span> <span class='then then kw'>then</span>
    <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span>
    <span class='quick_marshal_dir identifier id'>quick_marshal_dir</span> <span class='assign token'>=</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='string val'>''</span>

    <span class='dst_name identifier id'>dst_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span> <span class='quick_marshal_dir identifier id'>quick_marshal_dir</span>

    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='dst_name identifier id'>dst_name</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='verbose identifier id'>verbose</span>
    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rm_rf identifier id'>rm_rf</span> <span class='dst_name identifier id'>dst_name</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='verbose identifier id'>verbose</span>
    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mv identifier id'>mv</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span><span class='comma token'>,</span> <span class='dst_name identifier id'>dst_name</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='verbose identifier id'>verbose</span><span class='comma token'>,</span>
                 <span class='symbol val'>:force</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>

  <span class='files identifier id'>files</span> <span class='assign token'>=</span> <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='path identifier id'>path</span><span class='bitor op'>|</span>
    <span class='path identifier id'>path</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='string val'>''</span>
  <span class='end end kw'>end</span>

  <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='src_name identifier id'>src_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='file identifier id'>file</span>
    <span class='dst_name identifier id'>dst_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span> <span class='file identifier id'>file</span>

    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rm_rf identifier id'>rm_rf</span> <span class='dst_name identifier id'>dst_name</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='verbose identifier id'>verbose</span>
    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mv identifier id'>mv</span> <span class='src_name identifier id'>src_name</span><span class='comma token'>,</span> <span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='verbose identifier id'>verbose</span><span class='comma token'>,</span>
                 <span class='symbol val'>:force</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>make_temp_directories</h3>
</div><div id="make_temp_directories-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>make_temp_directories</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Make directories for index generation
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 592</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L592">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">592
593
594
595
596</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='make_temp_directories identifier id'>make_temp_directories</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rm_rf identifier id'>rm_rf</span> <span class='@directory ivar id'>@directory</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='symbol val'>:mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0700</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span> <span class='@quick_marshal_dir ivar id'>@quick_marshal_dir</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>paranoid</h3>
</div><div id="paranoid-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>paranoid</span><span class='args'>(path, extension)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Ensure <tt>path</tt> and path with <tt>extension</tt> are identical.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 601</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L601">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">601
602
603
604
605
606
607
608</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='paranoid identifier id'>paranoid</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='extension identifier id'>extension</span><span class='rparen token'>)</span>
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='read_binary identifier id'>read_binary</span> <span class='path identifier id'>path</span>
  <span class='compressed_data identifier id'>compressed_data</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='read_binary identifier id'>read_binary</span> <span class='dstring node'>&quot;#{path}.#{extension}&quot;</span>

  <span class='unless unless kw'>unless</span> <span class='data identifier id'>data</span> <span class='eq op'>==</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='inflate identifier id'>inflate</span><span class='lparen token'>(</span><span class='compressed_data identifier id'>compressed_data</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Compressed file #{compressed_path} does not match uncompressed file #{path}&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sanitize</h3>
</div><div id="sanitize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sanitize</span><span class='args'>(spec)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sanitize the descriptive fields in the spec. Sometimes non-ASCII characters
will garble the site index. Non-ASCII characters will be replaced by their
XML entity equivalent.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 615</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L615">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">615
616
617
618
619
620
621
622</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='sanitize identifier id'>sanitize</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='rparen token'>)</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='summary identifier id'>summary</span> <span class='assign token'>=</span> <span class='sanitize_string identifier id'>sanitize_string</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='summary identifier id'>summary</span><span class='rparen token'>)</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='description identifier id'>description</span> <span class='assign token'>=</span> <span class='sanitize_string identifier id'>sanitize_string</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='description identifier id'>description</span><span class='rparen token'>)</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='post_install_message identifier id'>post_install_message</span> <span class='assign token'>=</span> <span class='sanitize_string identifier id'>sanitize_string</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='post_install_message identifier id'>post_install_message</span><span class='rparen token'>)</span>
  <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='authors identifier id'>authors</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='authors identifier id'>authors</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='sanitize_string identifier id'>sanitize_string</span><span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>

  <span class='spec identifier id'>spec</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sanitize_string</h3>
</div><div id="sanitize_string-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sanitize_string</span><span class='args'>(string)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sanitize a single string.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 627</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L627">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">627
628
629
630
631
632</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='sanitize_string identifier id'>sanitize_string</span><span class='lparen token'>(</span><span class='string identifier id'>string</span><span class='rparen token'>)</span>
  <span class='comment val'># HACK the #to_s is in here because RSpec has an Array of Arrays of</span>
  <span class='comment val'># Strings for authors.  Need a way to disallow bad values on gempsec</span>
  <span class='comment val'># generation.  (Probably won't happen.)</span>
  <span class='string identifier id'>string</span> <span class='integer val'>? </span><span class='string identifier id'>string</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_xs identifier id'>to_xs</span> <span class='colon op'>:</span> <span class='string identifier id'>string</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>update_index</h3>
</div><div id="update_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>update_index</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Perform an in-place update of the repository from newly added gems. Only
works for modern indicies, and sets #build_legacy to false when run.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 638</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L638">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='update_index identifier id'>update_index</span>
  <span class='@build_legacy ivar id'>@build_legacy</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

  <span class='make_temp_directories identifier id'>make_temp_directories</span>

  <span class='specs_mtime identifier id'>specs_mtime</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='stat identifier id'>stat</span><span class='lparen token'>(</span><span class='@dest_specs_index ivar id'>@dest_specs_index</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='mtime identifier id'>mtime</span>
  <span class='newest_mtime identifier id'>newest_mtime</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='at identifier id'>at</span> <span class='integer val'>0</span>

  <span class='updated_gems identifier id'>updated_gems</span> <span class='assign token'>=</span> <span class='gem_file_list identifier id'>gem_file_list</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='gem identifier id'>gem</span><span class='bitor op'>|</span>
    <span class='gem_mtime identifier id'>gem_mtime</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='stat identifier id'>stat</span><span class='lparen token'>(</span><span class='gem identifier id'>gem</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='mtime identifier id'>mtime</span>
    <span class='newest_mtime identifier id'>newest_mtime</span> <span class='assign token'>=</span> <span class='gem_mtime identifier id'>gem_mtime</span> <span class='if if_mod kw'>if</span> <span class='gem_mtime identifier id'>gem_mtime</span> <span class='gt op'>&gt;</span> <span class='newest_mtime identifier id'>newest_mtime</span>
    <span class='gem_mtime identifier id'>gem_mtime</span> <span class='geq op'>&gt;=</span> <span class='specs_mtime identifier id'>specs_mtime</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='updated_gems identifier id'>updated_gems</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='then then kw'>then</span>
    <span class='say identifier id'>say</span> <span class='string val'>'No new gems'</span>
    <span class='terminate_interaction identifier id'>terminate_interaction</span> <span class='integer val'>0</span>
  <span class='end end kw'>end</span>

  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='collect_specs identifier id'>collect_specs</span> <span class='updated_gems identifier id'>updated_gems</span>

  <span class='files identifier id'>files</span> <span class='assign token'>=</span> <span class='build_marshal_gemspecs identifier id'>build_marshal_gemspecs</span> <span class='index identifier id'>index</span>

  <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='time identifier id'>time</span> <span class='string val'>'Updated indexes'</span> <span class='do do kw'>do</span>
    <span class='update_specs_index identifier id'>update_specs_index</span> <span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='@dest_specs_index ivar id'>@dest_specs_index</span><span class='comma token'>,</span> <span class='@specs_index ivar id'>@specs_index</span>
    <span class='update_specs_index identifier id'>update_specs_index</span> <span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='@dest_latest_specs_index ivar id'>@dest_latest_specs_index</span><span class='comma token'>,</span> <span class='@latest_specs_index ivar id'>@latest_specs_index</span>
    <span class='update_specs_index identifier id'>update_specs_index</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='dot token'>.</span><span class='prerelease_gems identifier id'>prerelease_gems</span><span class='comma token'>,</span> <span class='@dest_prerelease_specs_index ivar id'>@dest_prerelease_specs_index</span><span class='comma token'>,</span>
                       <span class='@prerelease_specs_index ivar id'>@prerelease_specs_index</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='compress_indicies identifier id'>compress_indicies</span>

  <span class='verbose identifier id'>verbose</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='really_verbose identifier id'>really_verbose</span>

  <span class='say identifier id'>say</span> <span class='dstring node'>&quot;Updating production dir #{@dest_directory}&quot;</span> <span class='if if_mod kw'>if</span> <span class='verbose identifier id'>verbose</span>

  <span class='files identifier id'>files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@specs_index ivar id'>@specs_index</span>
  <span class='files identifier id'>files</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@specs_index}.gz&quot;</span>
  <span class='files identifier id'>files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@latest_specs_index ivar id'>@latest_specs_index</span>
  <span class='files identifier id'>files</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@latest_specs_index}.gz&quot;</span>
  <span class='files identifier id'>files</span> <span class='lshft op'>&lt;&lt;</span> <span class='@prerelease_specs_index ivar id'>@prerelease_specs_index</span>
  <span class='files identifier id'>files</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{@prerelease_specs_index}.gz&quot;</span>

  <span class='files identifier id'>files</span> <span class='assign token'>=</span> <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='path identifier id'>path</span><span class='bitor op'>|</span>
    <span class='path identifier id'>path</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='string val'>''</span>
  <span class='end end kw'>end</span>

  <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='file identifier id'>file</span><span class='bitor op'>|</span>
    <span class='src_name identifier id'>src_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@directory ivar id'>@directory</span><span class='comma token'>,</span> <span class='file identifier id'>file</span>
    <span class='dst_name identifier id'>dst_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='@dest_directory ivar id'>@dest_directory</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>

    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mv identifier id'>mv</span> <span class='src_name identifier id'>src_name</span><span class='comma token'>,</span> <span class='dst_name identifier id'>dst_name</span><span class='comma token'>,</span> <span class='symbol val'>:verbose</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='verbose identifier id'>verbose</span><span class='comma token'>,</span>
                 <span class='symbol val'>:force</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>

    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='utime identifier id'>utime</span> <span class='newest_mtime identifier id'>newest_mtime</span><span class='comma token'>,</span> <span class='newest_mtime identifier id'>newest_mtime</span><span class='comma token'>,</span> <span class='dst_name identifier id'>dst_name</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>update_specs_index</h3>
</div><div id="update_specs_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>update_specs_index</span><span class='args'>(index, source, dest)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Combines specs in <tt>index</tt> and <tt>source</tt> then writes out a new
copy to <tt>dest</tt>. For a latest index, does not ensure the new file is
minimal.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubygems/indexer.rb', line 700</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rubygems/indexer.rb#L700">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">700
701
702
703
704
705
706
707
708
709
710
711
712
713
714</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='update_specs_index identifier id'>update_specs_index</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='comma token'>,</span> <span class='source identifier id'>source</span><span class='comma token'>,</span> <span class='dest identifier id'>dest</span><span class='rparen token'>)</span>
  <span class='specs_index identifier id'>specs_index</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span> <span class='Gem constant id'>Gem</span><span class='dot token'>.</span><span class='read_binary identifier id'>read_binary</span><span class='lparen token'>(</span><span class='source identifier id'>source</span><span class='rparen token'>)</span>

  <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='_ identifier id'>_</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='bitor op'>|</span>
    <span class='platform identifier id'>platform</span> <span class='assign token'>=</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='original_platform identifier id'>original_platform</span>
    <span class='platform identifier id'>platform</span> <span class='assign token'>=</span> <span class='Gem constant id'>Gem</span><span class='colon2 op'>::</span><span class='Platform constant id'>Platform</span><span class='colon2 op'>::</span><span class='RUBY constant id'>RUBY</span> <span class='if if_mod kw'>if</span> <span class='platform identifier id'>platform</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='platform identifier id'>platform</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='specs_index identifier id'>specs_index</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='version identifier id'>version</span><span class='comma token'>,</span> <span class='platform identifier id'>platform</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='specs_index identifier id'>specs_index</span> <span class='assign token'>=</span> <span class='compact_specs identifier id'>compact_specs</span> <span class='specs_index identifier id'>specs_index</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span>

  <span class='open identifier id'>open</span> <span class='dest identifier id'>dest</span><span class='comma token'>,</span> <span class='string val'>'wb'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span>
    <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span> <span class='specs_index identifier id'>specs_index</span><span class='comma token'>,</span> <span class='io identifier id'>io</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>