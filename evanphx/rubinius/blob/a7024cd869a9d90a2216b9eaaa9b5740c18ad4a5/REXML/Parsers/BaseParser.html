<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>evanphx's rubinius - Class: REXML::Parsers::BaseParser - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/evanphx/commits/rubinius/master" rel="alternate" title="Recent Commits to rubinius:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("evanphx", "rubinius", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("evanphx", "rubinius", "a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/evanphx/rubinius/tree/">Source</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/network">Network</a></li>            
            <li class=""><a href="http://github.com/evanphx/rubinius/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/evanphx/rubinius">Wiki</a></li>
            <li class=""><a href="http://github.com/evanphx/rubinius/graphs">Graphs</a></li>                    
            <li class="active"><a href="/evanphx/rubinius">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/evanphx">evanphx</a> / <b><a href="http://github.com/evanphx/rubinius/tree">rubinius</a></b>        
                <a id="namespaces_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class REXML_Parsers_BaseParser">
  <h1>Class: REXML::Parsers::BaseParser</h1>
  <div class="section docstring">
  <h1>Using the Pull Parser</h1>
<p>
<em>This API is experimental, and subject to change.</em>
</p>
<pre class="code">
 <span class='parser identifier id'>parser</span> <span class='assign token'>=</span> <span class='PullParser constant id'>PullParser</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;&lt;a&gt;text&lt;b att='val'/&gt;txet&lt;/a&gt;&quot;</span> <span class='rparen token'>)</span>
 <span class='while while kw'>while</span> <span class='parser identifier id'>parser</span><span class='dot token'>.</span><span class='has_next? fid id'>has_next?</span>
   <span class='res identifier id'>res</span> <span class='assign token'>=</span> <span class='parser identifier id'>parser</span><span class='dot token'>.</span><span class='next identifier id'>next</span>
   <span class='puts identifier id'>puts</span> <span class='res identifier id'>res</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'att'</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='res identifier id'>res</span><span class='dot token'>.</span><span class='start_tag? fid id'>start_tag?</span> <span class='and and kw'>and</span> <span class='res identifier id'>res</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'b'</span>
 <span class='end end kw'>end</span>
</pre>
<p>
See the PullEvent class for information on the content of the results. The
data is identical to the arguments passed for the various events to the
StreamListener API.
</p>
<p>
Notice that:
</p>
<pre class="code">
 <span class='parser identifier id'>parser</span> <span class='assign token'>=</span> <span class='PullParser constant id'>PullParser</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;&lt;a&gt;BAD DOCUMENT&quot;</span> <span class='rparen token'>)</span>
 <span class='while while kw'>while</span> <span class='parser identifier id'>parser</span><span class='dot token'>.</span><span class='has_next? fid id'>has_next?</span>
   <span class='res identifier id'>res</span> <span class='assign token'>=</span> <span class='parser identifier id'>parser</span><span class='dot token'>.</span><span class='next identifier id'>next</span>
   <span class='raise identifier id'>raise</span> <span class='res identifier id'>res</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='res identifier id'>res</span><span class='dot token'>.</span><span class='error? fid id'>error?</span>
 <span class='end end kw'>end</span>
</pre>
<p>
Nat Price gave me some good ideas for the API.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">source</td>
          <td class="readwrite">
            [<span id='source-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>source</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="ATTDEF-constant">ATTDEF</dt>
      <dd>&quot;\\s+#{NAME}\\s+#{ATTTYPE}\\s+#{DEFAULTDECL}&quot;</dd>
    
      <dt id="ATTDEF_RE-constant">ATTDEF_RE</dt>
      <dd>/#{ATTDEF}/</dd>
    
      <dt id="ATTLISTDECL_PATTERN-constant">ATTLISTDECL_PATTERN</dt>
      <dd>/^\s*&lt;!ATTLIST\s+#{NAME}(?:#{ATTDEF})*\s*&gt;/um</dd>
    
      <dt id="ATTLISTDECL_START-constant">ATTLISTDECL_START</dt>
      <dd>/^\s*&lt;!ATTLIST/um</dd>
    
      <dt id="ATTRIBUTE_PATTERN-constant">ATTRIBUTE_PATTERN</dt>
      <dd>/\s*(#{NAME_STR})\s*=\s*([&quot;'])(.*?)\4/um</dd>
    
      <dt id="ATTTYPE-constant">ATTTYPE</dt>
      <dd>&quot;(CDATA|ID|IDREF|IDREFS|ENTITY|ENTITIES|NMTOKEN|NMTOKENS|#{ENUMERATEDTYPE})&quot;</dd>
    
      <dt id="ATTVALUE-constant">ATTVALUE</dt>
      <dd>&quot;(?:\&quot;((?:[^&lt;&amp;\&quot;]|#{REFERENCE})*)\&quot;)|(?:'((?:[^&lt;&amp;']|#{REFERENCE})*)')&quot;</dd>
    
      <dt id="CDATA_END-constant">CDATA_END</dt>
      <dd>/^\s*\]\s*&gt;/um</dd>
    
      <dt id="CDATA_PATTERN-constant">CDATA_PATTERN</dt>
      <dd>/&lt;!\[CDATA\[(.*?)\]\]&gt;/um</dd>
    
      <dt id="CDATA_START-constant">CDATA_START</dt>
      <dd>/\A&lt;!\[CDATA\[/u</dd>
    
      <dt id="CLOSE_MATCH-constant">CLOSE_MATCH</dt>
      <dd>/^\s*&lt;\/(#{NAME_STR})\s*&gt;/um</dd>
    
      <dt id="COMMENT_PATTERN-constant">COMMENT_PATTERN</dt>
      <dd>/&lt;!--(.*?)--&gt;/um</dd>
    
      <dt id="COMMENT_START-constant">COMMENT_START</dt>
      <dd>/\A&lt;!--/u</dd>
    
      <dt id="DEFAULT_ENTITIES-constant">DEFAULT_ENTITIES</dt>
      <dd>{ 
  'gt' =&gt; [/&amp;gt;/, '&amp;gt;', '&gt;', /&gt;/], 
  'lt' =&gt; [/&amp;lt;/, '&amp;lt;', '&lt;', /&lt;/], 
  'quot' =&gt; [/&amp;quot;/, '&amp;quot;', '&quot;', /&quot;/], 
  &quot;apos&quot; =&gt; [/&amp;apos;/, &quot;&amp;apos;&quot;, &quot;'&quot;, /'/] 
}</dd>
    
      <dt id="DEFAULTDECL-constant">DEFAULTDECL</dt>
      <dd>&quot;(#REQUIRED|#IMPLIED|(?:(#FIXED\\s+)?#{ATTVALUE}))&quot;</dd>
    
      <dt id="DOCTYPE_PATTERN-constant">DOCTYPE_PATTERN</dt>
      <dd>/\s*&lt;!DOCTYPE\s+(.*?)(\[|&gt;)/um</dd>
    
      <dt id="DOCTYPE_START-constant">DOCTYPE_START</dt>
      <dd>/\A\s*&lt;!DOCTYPE\s/um</dd>
    
      <dt id="ELEMENTDECL_PATTERN-constant">ELEMENTDECL_PATTERN</dt>
      <dd>/^\s*(&lt;!ELEMENT.*?)&gt;/um</dd>
    
      <dt id="ELEMENTDECL_START-constant">ELEMENTDECL_START</dt>
      <dd>/^\s*&lt;!ELEMENT/um</dd>
    
      <dt id="ENCODING-constant">ENCODING</dt>
      <dd>/\bencoding\s*=\s*[&quot;'](.*?)['&quot;]/um</dd>
    
      <dt id="ENTITY_START-constant">ENTITY_START</dt>
      <dd>/^\s*&lt;!ENTITY/</dd>
    
      <dt id="ENTITYDECL-constant">ENTITYDECL</dt>
      <dd>/\s*(?:#{GEDECL})|(?:#{PEDECL})/um</dd>
    
      <dt id="ENTITYDEF-constant">ENTITYDEF</dt>
      <dd>&quot;(?:#{ENTITYVALUE}|(?:#{EXTERNALID}(#{NDATADECL})?))&quot;</dd>
    
      <dt id="ENTITYVALUE-constant">ENTITYVALUE</dt>
      <dd>%Q{((?:&quot;(?:[^%&amp;&quot;]|#{PEREFERENCE}|#{REFERENCE})*&quot;)|(?:'([^%&amp;']|#{PEREFERENCE}|#{REFERENCE})*'))}</dd>
    
      <dt id="ENUMERATEDTYPE-constant">ENUMERATEDTYPE</dt>
      <dd>&quot;(?:(?:#{NOTATIONTYPE})|(?:#{ENUMERATION}))&quot;</dd>
    
      <dt id="ENUMERATION-constant">ENUMERATION</dt>
      <dd>&quot;\\(\\s*#{NMTOKEN}(?:\\s*\\|\\s*#{NMTOKEN})*\\s*\\)&quot;</dd>
    
      <dt id="EREFERENCE-constant">EREFERENCE</dt>
      <dd>/&amp;(?!#{NAME};)/</dd>
    
      <dt id="EXTERNALID-constant">EXTERNALID</dt>
      <dd>&quot;(?:(?:(SYSTEM)\\s+#{SYSTEMLITERAL})|(?:(PUBLIC)\\s+#{PUBIDLITERAL}\\s+#{SYSTEMLITERAL}))&quot;</dd>
    
      <dt id="GEDECL-constant">GEDECL</dt>
      <dd>&quot;&lt;!ENTITY\\s+#{NAME}\\s+#{ENTITYDEF}\\s*&gt;&quot;</dd>
    
      <dt id="IDENTITY-constant">IDENTITY</dt>
      <dd>/^([!\*\w\-]+)(\s+#{NCNAME_STR})?(\s+[&quot;'](.*?)['&quot;])?(\s+['&quot;](.*?)[&quot;'])?/u</dd>
    
      <dt id="INSTRUCTION_PATTERN-constant">INSTRUCTION_PATTERN</dt>
      <dd>/&lt;\?(.*?)(\s+.*?)?\?&gt;/um</dd>
    
      <dt id="INSTRUCTION_START-constant">INSTRUCTION_START</dt>
      <dd>/\A&lt;\?/u</dd>
    
      <dt id="MISSING_ATTRIBUTE_QUOTES-constant">MISSING_ATTRIBUTE_QUOTES</dt>
      <dd>/^&lt;#{NAME_STR}\s+#{NAME_STR}\s*=\s*[^&quot;']/um</dd>
    
      <dt id="NAME-constant">NAME</dt>
      <dd>&quot;([\\w:]#{NAMECHAR}*)&quot;</dd>
    
      <dt id="NAME_STR-constant">NAME_STR</dt>
      <dd>&quot;(?:(#{NCNAME_STR}):)?(#{NCNAME_STR})&quot;</dd>
    
      <dt id="NAMECHAR-constant">NAMECHAR</dt>
      <dd>'[\-\w\d\.:]'</dd>
    
      <dt id="NCNAME_STR-constant">NCNAME_STR</dt>
      <dd>'[\w:][\-\w\d.]*'</dd>
    
      <dt id="NDATADECL-constant">NDATADECL</dt>
      <dd>&quot;\\s+NDATA\\s+#{NAME}&quot;</dd>
    
      <dt id="NMTOKEN-constant">NMTOKEN</dt>
      <dd>&quot;(?:#{NAMECHAR})+&quot;</dd>
    
      <dt id="NMTOKENS-constant">NMTOKENS</dt>
      <dd>&quot;#{NMTOKEN}(\\s+#{NMTOKEN})*&quot;</dd>
    
      <dt id="NOTATIONDECL_START-constant">NOTATIONDECL_START</dt>
      <dd>/^\s*&lt;!NOTATION/um</dd>
    
      <dt id="NOTATIONTYPE-constant">NOTATIONTYPE</dt>
      <dd>&quot;NOTATION\\s+\\(\\s*#{NAME}(?:\\s*\\|\\s*#{NAME})*\\s*\\)&quot;</dd>
    
      <dt id="PEDECL-constant">PEDECL</dt>
      <dd>&quot;&lt;!ENTITY\\s+(%)\\s+#{NAME}\\s+#{PEDEF}\\s*&gt;&quot;</dd>
    
      <dt id="PEDEF-constant">PEDEF</dt>
      <dd>&quot;(?:#{ENTITYVALUE}|#{EXTERNALID})&quot;</dd>
    
      <dt id="PEREFERENCE-constant">PEREFERENCE</dt>
      <dd>&quot;%#{NAME};&quot;</dd>
    
      <dt id="PUBIDCHAR-constant">PUBIDCHAR</dt>
      <dd>&quot;\x20\x0D\x0Aa-zA-Z0-9\\-()+,./:=?;!*@$_%#&quot;</dd>
    
      <dt id="PUBIDLITERAL-constant">PUBIDLITERAL</dt>
      <dd>%Q{(&quot;[#{PUBIDCHAR}']*&quot;|'[#{PUBIDCHAR}]*')}</dd>
    
      <dt id="PUBLIC-constant">PUBLIC</dt>
      <dd>/^\s*&lt;!NOTATION\s+(\w[\-\w]*)\s+(PUBLIC)\s+([&quot;'])(.*?)\3(?:\s+([&quot;'])(.*?)\5)?\s*&gt;/um</dd>
    
      <dt id="REFERENCE-constant">REFERENCE</dt>
      <dd>&quot;(?:&amp;#{NAME};|&amp;#\\d+;|&amp;#x[0-9a-fA-F]+;)&quot;</dd>
    
      <dt id="REFERENCE_RE-constant">REFERENCE_RE</dt>
      <dd>/#{REFERENCE}/</dd>
    
      <dt id="STANDALONE-constant">STANDALONE</dt>
      <dd>/\bstandalone\s*=\s[&quot;'](.*?)['&quot;]/um</dd>
    
      <dt id="SYSTEM-constant">SYSTEM</dt>
      <dd>/^\s*&lt;!NOTATION\s+(\w[\-\w]*)\s+(SYSTEM)\s+([&quot;'])(.*?)\3\s*&gt;/um</dd>
    
      <dt id="SYSTEMENTITY-constant">SYSTEMENTITY</dt>
      <dd>/^\s*(%.*?;)\s*$/um</dd>
    
      <dt id="SYSTEMLITERAL-constant">SYSTEMLITERAL</dt>
      <dd>%Q{((?:&quot;[^&quot;]*&quot;)|(?:'[^']*'))}</dd>
    
      <dt id="TAG_MATCH-constant">TAG_MATCH</dt>
      <dd>/^&lt;((?&gt;#{NAME_STR}))\s*((?&gt;\s+#{UNAME_STR}\s*=\s*([&quot;']).*?\5)*)\s*(\/)?&gt;/um</dd>
    
      <dt id="TEXT_PATTERN-constant">TEXT_PATTERN</dt>
      <dd>/\A([^&lt;]*)/um</dd>
    
      <dt id="UNAME_STR-constant">UNAME_STR</dt>
      <dd>&quot;(?:#{NCNAME_STR}:)?#{NCNAME_STR}&quot;</dd>
    
      <dt id="VERSION-constant">VERSION</dt>
      <dd>/\bversion\s*=\s*[&quot;'](.*?)['&quot;]/um</dd>
    
      <dt id="XMLDECL_PATTERN-constant">XMLDECL_PATTERN</dt>
      <dd>/&lt;\?xml\s+(.*?)\?&gt;/um</dd>
    
      <dt id="XMLDECL_START-constant">XMLDECL_START</dt>
      <dd>/\A&lt;\?xml\s/u</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(source)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 109</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L109">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">109
110
111</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span> <span class='source identifier id'>source</span> <span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='stream identifier id'>stream</span> <span class='assign token'>=</span> <span class='source identifier id'>source</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add_listener-instance_method">#add_listener</span><span class='args'>(listener)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#empty-3F-instance_method">#empty?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if there are no more events.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#entity-instance_method">#entity</span><span class='args'>(reference, entities)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#has_next-3F-instance_method">#has_next?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if there are more events.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#normalize-instance_method">#normalize</span><span class='args'>(input, entities = nil, entity_filter = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Escapes all possible entities.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#peek-instance_method">#peek</span><span class='args'>(depth = 0)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Peek at the <tt>depth</tt> event in the stack.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#position-instance_method">#position</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#pull-instance_method">#pull</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the next event.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stream-3D-instance_method">#stream=</span><span class='args'>(source)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#unnormalize-instance_method">#unnormalize</span><span class='args'>(string, entities = nil, filter = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Unescapes all possible entities.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#unshift-instance_method">#unshift</span><span class='args'>(token)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Push an event back on the head of the stream.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>add_listener</h3>
</div><div id="add_listener-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_listener</span><span class='args'>(listener)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 113</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L113">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">113
114
115
116
117
118
119</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='add_listener identifier id'>add_listener</span><span class='lparen token'>(</span> <span class='listener identifier id'>listener</span> <span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='defined? defined kw'>defined?</span><span class='lparen token'>(</span><span class='@listeners ivar id'>@listeners</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='notop op'>!</span><span class='@listeners ivar id'>@listeners</span>
    <span class='@listeners ivar id'>@listeners</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='instance_eval identifier id'>instance_eval</span> <span class='string val'>&quot;alias :_old_pull :pull\ndef pull\nevent = _old_pull\n@listeners.each do |listener|\nlistener.receive event\nend\nevent\nend\n&quot;</span>
  <span class='end end kw'>end</span>
  <span class='@listeners ivar id'>@listeners</span> <span class='lshft op'>&lt;&lt;</span> <span class='listener identifier id'>listener</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>empty?</h3>
</div><div id="empty-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>empty?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if there are no more events
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 153</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L153">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">153
154
155</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='empty? fid id'>empty?</span>
  <span class='return return kw'>return</span> <span class='lparen token'>(</span><span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='and and kw'>and</span> <span class='@stack ivar id'>@stack</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>entity</h3>
</div><div id="entity-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>entity</span><span class='args'>(reference, entities)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 424</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L424">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">424
425
426
427
428
429
430
431
432</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='entity identifier id'>entity</span><span class='lparen token'>(</span> <span class='reference identifier id'>reference</span><span class='comma token'>,</span> <span class='entities identifier id'>entities</span> <span class='rparen token'>)</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='entities identifier id'>entities</span><span class='lbrack token'>[</span> <span class='reference identifier id'>reference</span> <span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='entities identifier id'>entities</span>
  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='value identifier id'>value</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='DEFAULT_ENTITIES constant id'>DEFAULT_ENTITIES</span><span class='lbrack token'>[</span> <span class='reference identifier id'>reference</span> <span class='rbrack token'>]</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span>
  <span class='end end kw'>end</span>
  <span class='unnormalize identifier id'>unnormalize</span><span class='lparen token'>(</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='entities identifier id'>entities</span> <span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>has_next?</h3>
</div><div id="has_next-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>has_next?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if there are more events. Synonymous with !empty?
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 158</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L158">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">158
159
160</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='has_next? fid id'>has_next?</span>
  <span class='return return kw'>return</span> <span class='notop op'>!</span><span class='lparen token'>(</span><span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='and and kw'>and</span> <span class='@stack ivar id'>@stack</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>normalize</h3>
</div><div id="normalize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>normalize</span><span class='args'>(input, entities = nil, entity_filter = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Escapes all possible entities
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 435</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L435">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">435
436
437
438
439
440
441
442
443
444
445
446
447
448</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='normalize identifier id'>normalize</span><span class='lparen token'>(</span> <span class='input identifier id'>input</span><span class='comma token'>,</span> <span class='entities identifier id'>entities</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='entity_filter identifier id'>entity_filter</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span> <span class='rparen token'>)</span>
  <span class='copy identifier id'>copy</span> <span class='assign token'>=</span> <span class='input identifier id'>input</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
  <span class='comment val'># Doing it like this rather than in a loop improves the speed</span>
  <span class='copy identifier id'>copy</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='EREFERENCE constant id'>EREFERENCE</span><span class='comma token'>,</span> <span class='string val'>'&amp;amp;'</span> <span class='rparen token'>)</span>
  <span class='entities identifier id'>entities</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='copy identifier id'>copy</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='dstring node'>&quot;&amp;#{key};&quot;</span> <span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='entity_filter identifier id'>entity_filter</span> <span class='and and kw'>and</span> 
                                <span class='entity_filter identifier id'>entity_filter</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='entity identifier id'>entity</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span> <span class='if if_mod kw'>if</span> <span class='entities identifier id'>entities</span>
  <span class='copy identifier id'>copy</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='EREFERENCE constant id'>EREFERENCE</span><span class='comma token'>,</span> <span class='string val'>'&amp;amp;'</span> <span class='rparen token'>)</span>
  <span class='DEFAULT_ENTITIES constant id'>DEFAULT_ENTITIES</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='copy identifier id'>copy</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='copy identifier id'>copy</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>peek</h3>
</div><div id="peek-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>peek</span><span class='args'>(depth = 0)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Peek at the <tt>depth</tt> event in the stack. The first element on the
stack is at depth 0. If <tt>depth</tt> is -1, will parse to the end of the
input stream and return the last event, which is always :end_document. Be
aware that this causes the stream to be parsed up to the <tt>depth</tt>
event, so you can effectively pre-parse the entire document (pull the
entire thing into memory) using this method.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 174</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L174">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='peek identifier id'>peek</span> <span class='depth identifier id'>depth</span><span class='assign token'>=</span><span class='integer val'>0</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>%Q[Illegal argument &quot;#{depth}&quot;]</span> <span class='if if_mod kw'>if</span> <span class='depth identifier id'>depth</span> <span class='lt op'>&lt;</span> <span class='integer val'>-1</span>
  <span class='temp identifier id'>temp</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='depth identifier id'>depth</span> <span class='eq op'>==</span> <span class='integer val'>-1</span>
    <span class='temp identifier id'>temp</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='pull identifier id'>pull</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='until until_mod kw'>until</span> <span class='empty? fid id'>empty?</span>
  <span class='else else kw'>else</span>
    <span class='while while kw'>while</span> <span class='@stack ivar id'>@stack</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='plus op'>+</span><span class='temp identifier id'>temp</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='depth identifier id'>depth</span><span class='plus op'>+</span><span class='integer val'>1</span>
      <span class='temp identifier id'>temp</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='pull identifier id'>pull</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='@stack ivar id'>@stack</span> <span class='opasgn op'>+=</span> <span class='temp identifier id'>temp</span> <span class='if if_mod kw'>if</span> <span class='temp identifier id'>temp</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
  <span class='@stack ivar id'>@stack</span><span class='lbrack token'>[</span><span class='depth identifier id'>depth</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>position</h3>
</div><div id="position-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>position</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 143</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L143">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">143
144
145
146
147
148
149
150</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='position identifier id'>position</span>
  <span class='if if kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span> <span class='colon op'>:</span><span class='position identifier id'>position</span>
    <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='position identifier id'>position</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># FIXME</span>
    <span class='integer val'>0</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>pull</h3>
</div><div id="pull-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>pull</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the next event. This is a <tt>PullEvent</tt> object.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 189</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L189">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='pull identifier id'>pull</span>
  <span class='if if kw'>if</span> <span class='@closed ivar id'>@closed</span>
    <span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='@closed ivar id'>@closed</span> <span class='assign token'>=</span> <span class='@closed ivar id'>@closed</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span>
    <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:end_element</span><span class='comma token'>,</span> <span class='x identifier id'>x</span> <span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:end_document</span> <span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='empty? fid id'>empty?</span>
  <span class='return return kw'>return</span> <span class='@stack ivar id'>@stack</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span> <span class='if if_mod kw'>if</span> <span class='@stack ivar id'>@stack</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
  <span class='comment val'>#STDERR.puts @source.encoding</span>
  <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='if if_mod kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='buffer identifier id'>buffer</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='lt op'>&lt;</span><span class='integer val'>2</span>
  <span class='comment val'>#STDERR.puts &quot;BUFFER = #{@source.buffer.inspect}&quot;</span>
  <span class='if if kw'>if</span> <span class='@document_status ivar id'>@document_status</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span>
    <span class='comment val'>#@source.consume( /^\s*/um )</span>
    <span class='word identifier id'>word</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='regexp val'>/^((?:\s+)|(?:&lt;[^&gt;]*&gt;))/</span><span class='um identifier id'>um</span> <span class='rparen token'>)</span>
    <span class='word identifier id'>word</span> <span class='assign token'>=</span> <span class='word identifier id'>word</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='word identifier id'>word</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='comment val'>#STDERR.puts &quot;WORD = #{word.inspect}&quot;</span>
    <span class='case case kw'>case</span> <span class='word identifier id'>word</span>
    <span class='when when kw'>when</span> <span class='COMMENT_START constant id'>COMMENT_START</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:comment</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='COMMENT_PATTERN constant id'>COMMENT_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='XMLDECL_START constant id'>XMLDECL_START</span>
      <span class='comment val'>#STDERR.puts &quot;XMLDECL&quot;</span>
      <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='XMLDECL_PATTERN constant id'>XMLDECL_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
      <span class='version identifier id'>version</span> <span class='assign token'>=</span> <span class='VERSION constant id'>VERSION</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='results identifier id'>results</span> <span class='rparen token'>)</span>
      <span class='version identifier id'>version</span> <span class='assign token'>=</span> <span class='version identifier id'>version</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='version identifier id'>version</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='encoding identifier id'>encoding</span> <span class='assign token'>=</span> <span class='ENCODING constant id'>ENCODING</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='results identifier id'>results</span><span class='rparen token'>)</span>
      <span class='encoding identifier id'>encoding</span> <span class='assign token'>=</span> <span class='encoding identifier id'>encoding</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='encoding identifier id'>encoding</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='encoding identifier id'>encoding</span> <span class='assign token'>=</span> <span class='encoding identifier id'>encoding</span>
      <span class='standalone identifier id'>standalone</span> <span class='assign token'>=</span> <span class='STANDALONE constant id'>STANDALONE</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='results identifier id'>results</span><span class='rparen token'>)</span>
      <span class='standalone identifier id'>standalone</span> <span class='assign token'>=</span> <span class='standalone identifier id'>standalone</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='standalone identifier id'>standalone</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:xmldecl</span><span class='comma token'>,</span> <span class='version identifier id'>version</span><span class='comma token'>,</span> <span class='encoding identifier id'>encoding</span><span class='comma token'>,</span> <span class='standalone identifier id'>standalone</span> <span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='INSTRUCTION_START constant id'>INSTRUCTION_START</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:processing_instruction</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='INSTRUCTION_PATTERN constant id'>INSTRUCTION_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='DOCTYPE_START constant id'>DOCTYPE_START</span>
      <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='DOCTYPE_PATTERN constant id'>DOCTYPE_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
      <span class='@nsstack ivar id'>@nsstack</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='curr_ns identifier id'>curr_ns</span><span class='assign token'>=</span><span class='Set constant id'>Set</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span>
      <span class='identity identifier id'>identity</span> <span class='assign token'>=</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
      <span class='close identifier id'>close</span> <span class='assign token'>=</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span>
      <span class='identity identifier id'>identity</span> <span class='match op'>=~</span> <span class='IDENTITY constant id'>IDENTITY</span>
      <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span>
      <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;DOCTYPE is missing a name&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='pub_sys identifier id'>pub_sys</span> <span class='assign token'>=</span> <span class='$2 nth_ref id'>$2</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='$2 nth_ref id'>$2</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
      <span class='long_name identifier id'>long_name</span> <span class='assign token'>=</span> <span class='$4 nth_ref id'>$4</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='$4 nth_ref id'>$4</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
      <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='$6 nth_ref id'>$6</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='$6 nth_ref id'>$6</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
      <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='symbol val'>:start_doctype</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='pub_sys identifier id'>pub_sys</span><span class='comma token'>,</span> <span class='long_name identifier id'>long_name</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span> <span class='rbrack token'>]</span>
      <span class='if if kw'>if</span> <span class='close identifier id'>close</span> <span class='eq op'>==</span> <span class='string val'>&quot;&gt;&quot;</span>
        <span class='@document_status ivar id'>@document_status</span> <span class='assign token'>=</span> <span class='symbol val'>:after_doctype</span>
        <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='if if_mod kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='buffer identifier id'>buffer</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='lt op'>&lt;</span><span class='integer val'>2</span>
        <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/^\s*/</span><span class='um identifier id'>um</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
        <span class='@stack ivar id'>@stack</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:end_doctype</span> <span class='rbrack token'>]</span>
      <span class='else else kw'>else</span>
        <span class='@document_status ivar id'>@document_status</span> <span class='assign token'>=</span> <span class='symbol val'>:in_doctype</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span> <span class='args identifier id'>args</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^\s+/</span>
    <span class='else else kw'>else</span>
      <span class='@document_status ivar id'>@document_status</span> <span class='assign token'>=</span> <span class='symbol val'>:after_doctype</span>
      <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='if if_mod kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='buffer identifier id'>buffer</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='lt op'>&lt;</span><span class='integer val'>2</span>
      <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/\s*/</span><span class='um identifier id'>um</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='@document_status ivar id'>@document_status</span> <span class='eq op'>==</span> <span class='symbol val'>:in_doctype</span>
    <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/\s*(.*?&gt;)/</span><span class='um identifier id'>um</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='SYSTEMENTITY constant id'>SYSTEMENTITY</span> 
      <span class='match identifier id'>match</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='SYSTEMENTITY constant id'>SYSTEMENTITY</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:externalentity</span><span class='comma token'>,</span> <span class='match identifier id'>match</span> <span class='rbrack token'>]</span>

    <span class='when when kw'>when</span> <span class='ELEMENTDECL_START constant id'>ELEMENTDECL_START</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:elementdecl</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='ELEMENTDECL_PATTERN constant id'>ELEMENTDECL_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span>

    <span class='when when kw'>when</span> <span class='ENTITY_START constant id'>ENTITY_START</span>
      <span class='match identifier id'>match</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='ENTITYDECL constant id'>ENTITYDECL</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
      <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='symbol val'>:entitydecl</span>
      <span class='ref identifier id'>ref</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
      <span class='if if kw'>if</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'%'</span>
        <span class='ref identifier id'>ref</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
        <span class='match identifier id'>match</span><span class='dot token'>.</span><span class='delete_at identifier id'>delete_at</span> <span class='integer val'>1</span>
      <span class='end end kw'>end</span>
      <span class='comment val'># Now we have to sort out what kind of entity reference this is</span>
      <span class='if if kw'>if</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'SYSTEM'</span>
        <span class='comment val'># External reference</span>
        <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-2</span><span class='rbrack token'>]</span> <span class='comment val'># PUBID</span>
        <span class='match identifier id'>match</span><span class='dot token'>.</span><span class='delete_at identifier id'>delete_at</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='match identifier id'>match</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>4</span> <span class='comment val'># Chop out NDATA decl</span>
        <span class='comment val'># match is [ :entity, name, SYSTEM, pubid(, ndata)? ]</span>
      <span class='elsif elsif kw'>elsif</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'PUBLIC'</span>
        <span class='comment val'># External reference</span>
        <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-2</span><span class='rbrack token'>]</span> <span class='comment val'># PUBID</span>
        <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-2</span><span class='rbrack token'>]</span> <span class='comment val'># HREF</span>
        <span class='comment val'># match is [ :entity, name, PUBLIC, pubid, href ]</span>
      <span class='else else kw'>else</span>
        <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='match identifier id'>match</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-2</span><span class='rbrack token'>]</span>
        <span class='match identifier id'>match</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='if if_mod kw'>if</span> <span class='match identifier id'>match</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>4</span>
        <span class='comment val'># match is [ :entity, name, value ]</span>
      <span class='end end kw'>end</span>
      <span class='match identifier id'>match</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>'%'</span> <span class='if if_mod kw'>if</span> <span class='ref identifier id'>ref</span>
      <span class='return return kw'>return</span> <span class='match identifier id'>match</span>
    <span class='when when kw'>when</span> <span class='ATTLISTDECL_START constant id'>ATTLISTDECL_START</span>
      <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='ATTLISTDECL_PATTERN constant id'>ATTLISTDECL_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;Bad ATTLIST declaration!&quot;</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span> <span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='md identifier id'>md</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='element identifier id'>element</span> <span class='assign token'>=</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
      <span class='contents identifier id'>contents</span> <span class='assign token'>=</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>

      <span class='pairs identifier id'>pairs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
      <span class='values identifier id'>values</span> <span class='assign token'>=</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span> <span class='ATTDEF_RE constant id'>ATTDEF_RE</span> <span class='rparen token'>)</span>
      <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='attdef identifier id'>attdef</span><span class='bitor op'>|</span>
        <span class='unless unless kw'>unless</span> <span class='attdef identifier id'>attdef</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;#IMPLIED&quot;</span>
          <span class='attdef identifier id'>attdef</span><span class='dot token'>.</span><span class='compact! fid id'>compact!</span>
          <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='attdef identifier id'>attdef</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='rbrack token'>]</span>
          <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='attdef identifier id'>attdef</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='val identifier id'>val</span> <span class='eq op'>==</span> <span class='string val'>&quot;#FIXED &quot;</span>
          <span class='pairs identifier id'>pairs</span><span class='lbrack token'>[</span><span class='attdef identifier id'>attdef</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
          <span class='if if kw'>if</span> <span class='attdef identifier id'>attdef</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/^xmlns:(.*)/</span>
            <span class='@nsstack ivar id'>@nsstack</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='$1 nth_ref id'>$1</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:attlistdecl</span><span class='comma token'>,</span> <span class='element identifier id'>element</span><span class='comma token'>,</span> <span class='pairs identifier id'>pairs</span><span class='comma token'>,</span> <span class='contents identifier id'>contents</span> <span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='NOTATIONDECL_START constant id'>NOTATIONDECL_START</span>
      <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='if if kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='PUBLIC constant id'>PUBLIC</span> <span class='rparen token'>)</span>
        <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='PUBLIC constant id'>PUBLIC</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
        <span class='vals identifier id'>vals</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
      <span class='elsif elsif kw'>elsif</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='SYSTEM constant id'>SYSTEM</span> <span class='rparen token'>)</span>
        <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='SYSTEM constant id'>SYSTEM</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
        <span class='vals identifier id'>vals</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span><span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
      <span class='else else kw'>else</span>
        <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;error parsing notation: no matching pattern&quot;</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span> <span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:notationdecl</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='vals identifier id'>vals</span> <span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='CDATA_END constant id'>CDATA_END</span>
      <span class='@document_status ivar id'>@document_status</span> <span class='assign token'>=</span> <span class='symbol val'>:after_doctype</span>
      <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='CDATA_END constant id'>CDATA_END</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:end_doctype</span> <span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='if if kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='buffer identifier id'>buffer</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?&lt;</span>
      <span class='if if kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='buffer identifier id'>buffer</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?/</span>
        <span class='@nsstack ivar id'>@nsstack</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
        <span class='last_tag identifier id'>last_tag</span> <span class='assign token'>=</span> <span class='@tags ivar id'>@tags</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span>
        <span class='comment val'>#md = @source.match_to_consume( '&gt;', CLOSE_MATCH)</span>
        <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='CLOSE_MATCH constant id'>CLOSE_MATCH</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
        <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;Missing end tag for &quot;</span><span class='plus op'>+</span>
          <span class='dstring node'>&quot;'#{last_tag}' (got \&quot;#{md[1]}\&quot;)&quot;</span><span class='comma token'>,</span> 
          <span class='@source ivar id'>@source</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='last_tag identifier id'>last_tag</span> <span class='eq op'>==</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
        <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:end_element</span><span class='comma token'>,</span> <span class='last_tag identifier id'>last_tag</span> <span class='rbrack token'>]</span>
      <span class='elsif elsif kw'>elsif</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='buffer identifier id'>buffer</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?!</span>
        <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='regexp val'>/\A(\s*[^&gt;]*&gt;)/</span><span class='um identifier id'>um</span><span class='rparen token'>)</span>
        <span class='comment val'>#STDERR.puts &quot;SOURCE BUFFER = #{source.buffer}, #{source.buffer.size}&quot;</span>
        <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Malformed node&quot;</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='md identifier id'>md</span>
        <span class='if if kw'>if</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?-</span>
          <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='COMMENT_PATTERN constant id'>COMMENT_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
          <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:comment</span><span class='comma token'>,</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='md identifier id'>md</span>
        <span class='else else kw'>else</span>
          <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='CDATA_PATTERN constant id'>CDATA_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
          <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:cdata</span><span class='comma token'>,</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='md identifier id'>md</span>
        <span class='end end kw'>end</span>
        <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;Declarations can only occur &quot;</span><span class='plus op'>+</span>
          <span class='string val'>&quot;in the doctype declaration.&quot;</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='rparen token'>)</span>
      <span class='elsif elsif kw'>elsif</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='buffer identifier id'>buffer</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>??</span>
        <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='INSTRUCTION_PATTERN constant id'>INSTRUCTION_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
        <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:processing_instruction</span><span class='comma token'>,</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='md identifier id'>md</span>
        <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;Bad instruction declaration&quot;</span><span class='comma token'>,</span>
          <span class='@source ivar id'>@source</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='comment val'># Get the next tag</span>
        <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='TAG_MATCH constant id'>TAG_MATCH</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
        <span class='unless unless kw'>unless</span> <span class='md identifier id'>md</span>
          <span class='comment val'># Check for missing attribute quotes</span>
          <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;missing attribute quote&quot;</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='MISSING_ATTRIBUTE_QUOTES constant id'>MISSING_ATTRIBUTE_QUOTES</span> <span class='rparen token'>)</span>
          <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;malformed XML: missing tag start&quot;</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='rparen token'>)</span> 
        <span class='end end kw'>end</span>
        <span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
        <span class='prefixes identifier id'>prefixes</span> <span class='assign token'>=</span> <span class='Set constant id'>Set</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
        <span class='prefixes identifier id'>prefixes</span> <span class='lshft op'>&lt;&lt;</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span>
        <span class='@nsstack ivar id'>@nsstack</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='curr_ns identifier id'>curr_ns</span><span class='assign token'>=</span><span class='Set constant id'>Set</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
          <span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>4</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span> <span class='ATTRIBUTE_PATTERN constant id'>ATTRIBUTE_PATTERN</span> <span class='rparen token'>)</span>
          <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='dstring node'>&quot;error parsing attributes: [#{attrs.join ', '}], excess = \&quot;#$'\&quot;&quot;</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='$' back_ref id'>$'</span> <span class='and and kw'>and</span> <span class='$' back_ref id'>$'</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
          <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span><span class='b identifier id'>b</span><span class='comma token'>,</span><span class='c identifier id'>c</span><span class='comma token'>,</span><span class='d identifier id'>d</span><span class='comma token'>,</span><span class='e identifier id'>e</span><span class='bitor op'>|</span> 
            <span class='if if kw'>if</span> <span class='b identifier id'>b</span> <span class='eq op'>==</span> <span class='string val'>&quot;xmlns&quot;</span>
              <span class='if if kw'>if</span> <span class='c identifier id'>c</span> <span class='eq op'>==</span> <span class='string val'>&quot;xml&quot;</span>
                <span class='if if kw'>if</span> <span class='d identifier id'>d</span> <span class='neq op'>!=</span> <span class='string val'>&quot;http://www.w3.org/XML/1998/namespace&quot;</span>
                  <span class='msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='string val'>&quot;The 'xml' prefix must not be bound to any other namespace &quot;</span><span class='plus op'>+</span>
                  <span class='string val'>&quot;(http://www.w3.org/TR/REC-xml-names/#ns-decl)&quot;</span>
                  <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='msg identifier id'>msg</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='comma token'>,</span> <span class='self self kw'>self</span> <span class='rparen token'>)</span>
                <span class='end end kw'>end</span>
              <span class='elsif elsif kw'>elsif</span> <span class='c identifier id'>c</span> <span class='eq op'>==</span> <span class='string val'>&quot;xmlns&quot;</span>
                <span class='msg identifier id'>msg</span> <span class='assign token'>=</span> <span class='string val'>&quot;The 'xmlns' prefix must not be declared &quot;</span><span class='plus op'>+</span>
                <span class='string val'>&quot;(http://www.w3.org/TR/REC-xml-names/#ns-decl)&quot;</span>
                <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='msg identifier id'>msg</span><span class='comma token'>,</span> <span class='@source ivar id'>@source</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rparen token'>)</span>
              <span class='end end kw'>end</span>
              <span class='curr_ns identifier id'>curr_ns</span> <span class='lshft op'>&lt;&lt;</span> <span class='c identifier id'>c</span>
            <span class='elsif elsif kw'>elsif</span> <span class='b identifier id'>b</span>
              <span class='prefixes identifier id'>prefixes</span> <span class='lshft op'>&lt;&lt;</span> <span class='b identifier id'>b</span> <span class='unless unless_mod kw'>unless</span> <span class='b identifier id'>b</span> <span class='eq op'>==</span> <span class='string val'>&quot;xml&quot;</span>
            <span class='end end kw'>end</span>
            <span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='e identifier id'>e</span> 
          <span class='rbrace token'>}</span>
        <span class='end end kw'>end</span>
  
        <span class='comment val'># Verify that all of the prefixes have been defined</span>
        <span class='for for kw'>for</span> <span class='prefix identifier id'>prefix</span> <span class='in in kw'>in</span> <span class='prefixes identifier id'>prefixes</span>
          <span class='unless unless kw'>unless</span> <span class='@nsstack ivar id'>@nsstack</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='member? fid id'>member?</span><span class='lparen token'>(</span><span class='prefix identifier id'>prefix</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
            <span class='raise identifier id'>raise</span> <span class='UndefinedNamespaceException constant id'>UndefinedNamespaceException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='prefix identifier id'>prefix</span><span class='comma token'>,</span><span class='@source ivar id'>@source</span><span class='comma token'>,</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>

        <span class='if if kw'>if</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span>
          <span class='@closed ivar id'>@closed</span> <span class='assign token'>=</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
          <span class='@nsstack ivar id'>@nsstack</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
        <span class='else else kw'>else</span>
          <span class='@tags ivar id'>@tags</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
        <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:start_element</span><span class='comma token'>,</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='attributes identifier id'>attributes</span> <span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='md identifier id'>md</span> <span class='assign token'>=</span> <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='TEXT_PATTERN constant id'>TEXT_PATTERN</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
        <span class='@source ivar id'>@source</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span> <span class='regexp val'>/(\s+)/</span><span class='comma token'>,</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='comment val'>#STDERR.puts &quot;GOT #{md[1].inspect}&quot; unless md[0].length == 0</span>
      <span class='comment val'>#return [ :text, &quot;&quot; ] if md[0].length == 0</span>
      <span class='comment val'># unnormalized = Text::unnormalize( md[1], self )</span>
      <span class='comment val'># return PullEvent.new( :text, md[1], unnormalized )</span>
      <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:text</span><span class='comma token'>,</span> <span class='md identifier id'>md</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
  <span class='rescue rescue kw'>rescue</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='UndefinedNamespaceException constant id'>UndefinedNamespaceException</span>
    <span class='raise identifier id'>raise</span>
  <span class='rescue rescue kw'>rescue</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span>
    <span class='raise identifier id'>raise</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span><span class='comma token'>,</span> <span class='NameError constant id'>NameError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='error identifier id'>error</span>
    <span class='raise identifier id'>raise</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='ParseException constant id'>ParseException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;Exception parsing&quot;</span><span class='comma token'>,</span>
      <span class='@source ivar id'>@source</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='error identifier id'>error</span> <span class='integer val'>? </span><span class='error identifier id'>error</span> <span class='colon op'>:</span> <span class='$! gvar id'>$!</span><span class='rparen token'>)</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='lbrack token'>[</span> <span class='symbol val'>:dummy</span> <span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stream=</h3>
</div><div id="stream-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stream=</span><span class='args'>(source)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 133</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L133">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">133
134
135
136
137
138
139
140
141</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='stream= identifier id'>stream=</span><span class='lparen token'>(</span> <span class='source identifier id'>source</span> <span class='rparen token'>)</span>
  <span class='@source ivar id'>@source</span> <span class='assign token'>=</span> <span class='SourceFactory constant id'>SourceFactory</span><span class='dot token'>.</span><span class='create_from identifier id'>create_from</span><span class='lparen token'>(</span> <span class='source identifier id'>source</span> <span class='rparen token'>)</span>
  <span class='@closed ivar id'>@closed</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='@document_status ivar id'>@document_status</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='@tags ivar id'>@tags</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@stack ivar id'>@stack</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@entities ivar id'>@entities</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@nsstack ivar id'>@nsstack</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>unnormalize</h3>
</div><div id="unnormalize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>unnormalize</span><span class='args'>(string, entities = nil, filter = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Unescapes all possible entities
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 451</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L451">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='unnormalize identifier id'>unnormalize</span><span class='lparen token'>(</span> <span class='string identifier id'>string</span><span class='comma token'>,</span> <span class='entities identifier id'>entities</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='filter identifier id'>filter</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span> <span class='rparen token'>)</span>
  <span class='rv identifier id'>rv</span> <span class='assign token'>=</span> <span class='string identifier id'>string</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
  <span class='rv identifier id'>rv</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='regexp val'>/\r\n?/</span><span class='comma token'>,</span> <span class='string val'>&quot;\n&quot;</span> <span class='rparen token'>)</span>
  <span class='matches identifier id'>matches</span> <span class='assign token'>=</span> <span class='rv identifier id'>rv</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span> <span class='REFERENCE_RE constant id'>REFERENCE_RE</span> <span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='rv identifier id'>rv</span> <span class='if if_mod kw'>if</span> <span class='matches identifier id'>matches</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
  <span class='rv identifier id'>rv</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='regexp val'>/&amp;#0*((?:\d+)|(?:x[a-fA-F0-9]+));/</span> <span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span>
    <span class='m identifier id'>m</span><span class='assign token'>=</span><span class='$1 nth_ref id'>$1</span>
    <span class='m identifier id'>m</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;0#{m}&quot;</span> <span class='if if_mod kw'>if</span> <span class='m identifier id'>m</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?x</span>
    <span class='lbrack token'>[</span><span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='pack identifier id'>pack</span><span class='lparen token'>(</span><span class='string val'>'U*'</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
  <span class='matches identifier id'>matches</span><span class='dot token'>.</span><span class='collect! fid id'>collect!</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='compact! fid id'>compact!</span>
  <span class='if if kw'>if</span> <span class='matches identifier id'>matches</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='matches identifier id'>matches</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='entity_reference identifier id'>entity_reference</span><span class='bitor op'>|</span>
      <span class='unless unless kw'>unless</span> <span class='filter identifier id'>filter</span> <span class='and and kw'>and</span> <span class='filter identifier id'>filter</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='entity_reference identifier id'>entity_reference</span><span class='rparen token'>)</span>
        <span class='entity_value identifier id'>entity_value</span> <span class='assign token'>=</span> <span class='entity identifier id'>entity</span><span class='lparen token'>(</span> <span class='entity_reference identifier id'>entity_reference</span><span class='comma token'>,</span> <span class='entities identifier id'>entities</span> <span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='entity_value identifier id'>entity_value</span>
          <span class='re identifier id'>re</span> <span class='assign token'>=</span> <span class='dregexp node'>/&amp;#{entity_reference};/</span>
          <span class='rv identifier id'>rv</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='re identifier id'>re</span><span class='comma token'>,</span> <span class='entity_value identifier id'>entity_value</span> <span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='matches identifier id'>matches</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='entity_reference identifier id'>entity_reference</span><span class='bitor op'>|</span>
      <span class='unless unless kw'>unless</span> <span class='filter identifier id'>filter</span> <span class='and and kw'>and</span> <span class='filter identifier id'>filter</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='entity_reference identifier id'>entity_reference</span><span class='rparen token'>)</span>
        <span class='er identifier id'>er</span> <span class='assign token'>=</span> <span class='DEFAULT_ENTITIES constant id'>DEFAULT_ENTITIES</span><span class='lbrack token'>[</span><span class='entity_reference identifier id'>entity_reference</span><span class='rbrack token'>]</span>
        <span class='rv identifier id'>rv</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='er identifier id'>er</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='er identifier id'>er</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='er identifier id'>er</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='rv identifier id'>rv</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span> <span class='regexp val'>/&amp;amp;/</span><span class='comma token'>,</span> <span class='string val'>'&amp;'</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='rv identifier id'>rv</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>unshift</h3>
</div><div id="unshift-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>unshift</span><span class='args'>(token)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Push an event back on the head of the stream. This method has
(theoretically) infinite depth.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rexml/parsers/baseparser.rb', line 164</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/evanphx/rubinius/blob/a7024cd869a9d90a2216b9eaaa9b5740c18ad4a5/lib/rexml/parsers/baseparser.rb#L164">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">164
165
166</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='unshift identifier id'>unshift</span> <span class='token identifier id'>token</span>
  <span class='@stack ivar id'>@stack</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span><span class='lparen token'>(</span><span class='token identifier id'>token</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>