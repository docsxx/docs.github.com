<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>rack's rack - Class: Rack::Auth::OpenID - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/rack/commits/rack/master" rel="alternate" title="Recent Commits to rack:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("rack", "rack", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("rack", "rack", "fd1c1d2e494d9a7d15e0458602ef121f244addc3", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/rack/rack/tree/">Source</a></li>
            <li class=""><a href="http://github.com/rack/rack/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/rack/rack/network">Network</a></li>            
            <li class=""><a href="http://github.com/rack/rack/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/rack/rack">Wiki</a></li>
            <li class=""><a href="http://github.com/rack/rack/graphs">Graphs</a></li>                    
            <li class="active"><a href="/rack/rack">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/rack">rack</a> / <b><a href="http://github.com/rack/rack/tree">rack</a></b>        
                <a id="namespaces_button" rel="rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Rack_Auth_OpenID">
  <h1>Class: Rack::Auth::OpenID</h1>
  <div class="section docstring">
  <p>
Rack::Auth::OpenID provides a simple method for setting up an OpenID
Consumer. It requires the ruby-openid library from janrain to operate, as
well as a rack method of session management.
</p>
<p>
The ruby-openid home page is at http://openidenabled.com/ruby-openid/.
</p>
<p>
The OpenID specifications can be found at
http://openid.net/specs/openid-authentication-1_1.html and
http://openid.net/specs/openid-authentication-2_0.html. Documentation for
published OpenID extensions and related topics can be found at
http://openid.net/developers/specs/.
</p>
<p>
It is recommended to read through the OpenID spec, as well as
ruby-openid&#8217;s documentation, to understand what exactly goes on.
However a setup as simple as the presented examples is enough to provide
Consumer functionality.
</p>
<p>
This library strongly intends to utilize the OpenID 2.0 features of the
ruby-openid library, which provides OpenID 1.0 compatiblity.
</p>
<p>
NOTE: Due to the amount of data that this library stores in the session,
Rack::Session::Cookie may fault.
</p>
<h2>Examples</h2>
<pre class="code">
  <span class='simple_oid identifier id'>simple_oid</span> <span class='assign token'>=</span> <span class='OpenID constant id'>OpenID</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'http://mysite.com/'</span><span class='rparen token'>)</span>

  <span class='return_oid identifier id'>return_oid</span> <span class='assign token'>=</span> <span class='OpenID constant id'>OpenID</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'http://mysite.com/'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:return_to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://mysite.com/openid'</span>
  <span class='rbrace token'>}</span><span class='rparen token'>)</span>

  <span class='complex_oid identifier id'>complex_oid</span> <span class='assign token'>=</span> <span class='OpenID constant id'>OpenID</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'http://mysite.com/'</span><span class='comma token'>,</span>
    <span class='symbol val'>:immediate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
    <span class='symbol val'>:extensions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span>
      <span class='colon3 op'>::</span><span class='OpenID constant id'>OpenID</span><span class='colon2 op'>::</span><span class='SReg constant id'>SReg</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='string val'>'email'</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='string val'>'nickname'</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
    <span class='rbrace token'>}</span>
  <span class='rparen token'>)</span>
</pre>
<h1>Advanced</h1>
<p>
Most of the functionality of this library is encapsulated such that
expansion and overriding functions isn&#8217;t difficult nor tricky.
Alternately, to avoid opening up singleton objects or subclassing, a
wrapper rack middleware can be composed to act upon Auth::OpenID&#8217;s
responses. See #check and #finish for locations of pertinent data.
</p>
<h2>Responses</h2>
<p>
To change the responses that Auth::OpenID returns, override the methods
#redirect, #bad_request, #unauthorized, #access_denied, and
#foreign_server_failure.
</p>
<p>
Additionally #confirm_post_params is used when the URI would exceed length
limits on a GET request when doing the initial verification request.
</p>
<h2>Processing</h2>
<p>
To change methods of processing completed transactions, override the
methods #success, #setup_needed, #cancel, and #failure. Please ensure the
returned object is a rack compatible response.
</p>
<p>
The first argument is an OpenID::Response, the second is a Rack::Request of
the current request, the last is the hash used in ruby-openid handling,
which can be found manually at env[&#8216;rack.session&#8217;][:openid].
</p>
<p>
This is useful if you wanted to expand the processing done, such as setting
up user accounts.
</p>
<pre class="code">
  <span class='oid_app identifier id'>oid_app</span> <span class='assign token'>=</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Auth constant id'>Auth</span><span class='colon2 op'>::</span><span class='OpenID constant id'>OpenID</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='symbol val'>:return_to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='return_to identifier id'>return_to</span>
  <span class='def def kw'>def</span> <span class='oid_app identifier id'>oid_app</span><span class='dot token'>.</span><span class='success identifier id'>success</span> <span class='oid identifier id'>oid</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='session identifier id'>session</span>
    <span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='Models constant id'>Models</span><span class='colon2 op'>::</span><span class='User constant id'>User</span><span class='lbrack token'>[</span><span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='identity_url identifier id'>identity_url</span><span class='rbrack token'>]</span>
    <span class='user identifier id'>user</span> <span class='opasgn op'>||=</span> <span class='Models constant id'>Models</span><span class='colon2 op'>::</span><span class='User constant id'>User</span><span class='dot token'>.</span><span class='create_from_openid identifier id'>create_from_openid</span> <span class='oid identifier id'>oid</span>
    <span class='request identifier id'>request</span><span class='lbrack token'>[</span><span class='string val'>'rack.session'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:user</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='id identifier id'>id</span>
    <span class='redirect identifier id'>redirect</span> <span class='MyApp constant id'>MyApp</span><span class='dot token'>.</span><span class='site_home identifier id'>site_home</span>
  <span class='end end kw'>end</span>

  <span class='site_map identifier id'>site_map</span><span class='lbrack token'>[</span><span class='string val'>'/openid'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='oid_app identifier id'>oid_app</span>
  <span class='map identifier id'>map</span> <span class='assign token'>=</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='URLMap constant id'>URLMap</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='site_map identifier id'>site_map</span>
  <span class='dot3 op'>...</span>
</pre>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">extensions</td>
          <td class="readwrite">
            [<span id='extensions-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>extensions</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">immediate</td>
          <td class="readwrite">
            [<span id='immediate-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>immediate</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">openid_param</td>
          <td class="readwrite">
            [<span id='openid_param-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>openid_param</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">realm</td>
          <td class="readwrite">
            [<span id='realm-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>realm</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">return_to</td>
          <td class="readwrite">
            [<span id='return_to-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>return_to</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">session_key</td>
          <td class="readwrite">
            [<span id='session_key-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>session_key</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">store</td>
          <td class="readwrite">
            [<span id='store-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>store</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="ValidStatus-constant">ValidStatus</dt>
      <dd>[
  ::OpenID::Consumer::SUCCESS,
  ::OpenID::Consumer::FAILURE,
  ::OpenID::Consumer::CANCEL,
  ::OpenID::Consumer::SETUP_NEEDED
]</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(realm, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The first argument is the realm, identifying the site they are trusting
with their identity. This is required, also treated as the trust_root in
OpenID 1.x exchanges.
</p>
<p>
The lits of acceptable options include :return_to, :session_key,
:openid_param, :store, :immediate, :extensions.
</p>
<p>
<tt>:return_to</tt> defines the url to return to after the client
authenticates with the openid service provider. This url should point to
where Rack::Auth::OpenID is mounted. If unprovided, the url of the current
request is used.
</p>
<p>
<tt>:session_key</tt> defines the key to the session hash in the env. The
default is &#8216;rack.session&#8217;.
</p>
<p>
<tt>:openid_param</tt> defines at what key in the request parameters to
find the identifier to resolve. As per the 2.0 spec, the default is
&#8216;openid_identifier&#8217;.
</p>
<p>
<tt>:store</tt> defined what OpenID Store to use for persistant
information. By default a Store::Memory is used.
</p>
<p>
<tt>:immediate</tt> as true will make initial requests to be of an
immediate type. This is false by default. See OpenID specification
documentation.
</p>
<p>
<tt>:extensions</tt> should be a hash of openid extension implementations.
The key should be the extension module, the value should be an array of
arguments for extension::Request.new(). The hash is iterated over and
passed to #add_extension for processing. Please see #add_extension for
further documentation.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rack/auth/openid.rb', line 155</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3/lib/rack/auth/openid.rb#L155">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='realm identifier id'>realm</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='lparen token'>(</span><span class='realm identifier id'>realm</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Invalid realm: #{realm}&quot;</span> \
    <span class='unless unless_mod kw'>unless</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='absolute? fid id'>absolute?</span> \
    <span class='and and kw'>and</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='fragment identifier id'>fragment</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> \
    <span class='and and kw'>and</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span> <span class='match op'>=~</span> <span class='regexp val'>/^https?$/</span> \
    <span class='and and kw'>and</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='host identifier id'>host</span> <span class='match op'>=~</span> <span class='dregexp node'>/^(\*\.)?#{URI::REGEXP::PATTERN::URIC_NO_SLASH}+/</span>
  <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='string val'>'/'</span> <span class='if if_mod kw'>if</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='@realm ivar id'>@realm</span> <span class='assign token'>=</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>

  <span class='if if kw'>if</span> <span class='ruri identifier id'>ruri</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:return_to</span><span class='rbrack token'>]</span>
    <span class='ruri identifier id'>ruri</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='lparen token'>(</span><span class='ruri identifier id'>ruri</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Invalid return_to: #{ruri}&quot;</span> \
      <span class='unless unless_mod kw'>unless</span> <span class='ruri identifier id'>ruri</span><span class='dot token'>.</span><span class='absolute? fid id'>absolute?</span> \
      <span class='and and kw'>and</span> <span class='ruri identifier id'>ruri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span> <span class='match op'>=~</span> <span class='regexp val'>/^https?$/</span> \
      <span class='and and kw'>and</span> <span class='ruri identifier id'>ruri</span><span class='dot token'>.</span><span class='fragment identifier id'>fragment</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;return_to #{ruri} not within realm #{realm}&quot;</span> \
      <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='within_realm? fid id'>within_realm?</span><span class='lparen token'>(</span><span class='ruri identifier id'>ruri</span><span class='rparen token'>)</span>
    <span class='@return_to ivar id'>@return_to</span> <span class='assign token'>=</span> <span class='ruri identifier id'>ruri</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='end end kw'>end</span>

  <span class='@session_key ivar id'>@session_key</span>  <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:session_key</span><span class='rbrack token'>]</span>   <span class='orop op'>||</span> <span class='string val'>'rack.session'</span>
  <span class='@openid_param ivar id'>@openid_param</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:openid_param</span><span class='rbrack token'>]</span>  <span class='orop op'>||</span> <span class='string val'>'openid_identifier'</span>
  <span class='@store ivar id'>@store</span>        <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:store</span><span class='rbrack token'>]</span>         <span class='orop op'>||</span> <span class='colon3 op'>::</span><span class='OpenID constant id'>OpenID</span><span class='colon2 op'>::</span><span class='Store constant id'>Store</span><span class='colon2 op'>::</span><span class='Memory constant id'>Memory</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='@immediate ivar id'>@immediate</span>    <span class='assign token'>=</span> <span class='notop op'>!</span><span class='notop op'>!</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:immediate</span><span class='rbrack token'>]</span>

  <span class='@extensions ivar id'>@extensions</span>   <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='if if kw'>if</span> <span class='extensions identifier id'>extensions</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:extensions</span><span class='rbrack token'>]</span>
    <span class='extensions identifier id'>extensions</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ext identifier id'>ext</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='bitor op'>|</span>
      <span class='add_extension identifier id'>add_extension</span><span class='lparen token'>(</span><span class='ext identifier id'>ext</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Undocumented, semi-experimental</span>
  <span class='@anonymous ivar id'>@anonymous</span>    <span class='assign token'>=</span> <span class='notop op'>!</span><span class='notop op'>!</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:anonymous</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add_extension-instance_method">#add_extension</span><span class='args'>(ext, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The first argument should be the main extension module.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#call-instance_method">#call</span><span class='args'>(env)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets up and uses session data at <tt>:openid</tt> within the session.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#check-instance_method">#check</span><span class='args'>(consumer, session, req)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
As the first part of OpenID consumer action, #check retrieves the data
required for completion.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#finish-instance_method">#finish</span><span class='args'>(consumer, session, req)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This is the final portion of authentication.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#valid_extension-3F-instance_method">#valid_extension?</span><span class='args'>(ext)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks the validitity, in the context of usage, of a submitted extension.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#within_realm-3F-instance_method">#within_realm?</span><span class='args'>(uri)</span>
        <span class='block'></span>
        
          <span class='alias'>#include?</span>
        
      </th>
      <td class="docstring">
        <p>
Checks the provided uri to ensure it&#8217;d be considered within the
realm.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>add_extension</h3>
</div><div id="add_extension-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_extension</span><span class='args'>(ext, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The first argument should be the main extension module. The extension
module should contain the constants:
</p>
<ul>
<li>class Request, should have OpenID::Extension as an ancestor

</li>
<li>class Response, should have OpenID::Extension as an ancestor

</li>
<li>string NS_URI, which defining the namespace of the extension

</li>
</ul>
<p>
All trailing arguments will be passed to extension::Request.new in #check.
The openid response will be passed to
extension::Response#from_success_response, oid#get_extension_args will be
called on the result to attain the gathered data.
</p>
<p>
This method returns the key at which the response data will be found in the
session, which is the namespace uri by default.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a title="BadExtension" href="OpenID/BadExtension.html">BadExtension</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rack/auth/openid.rb', line 314</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3/lib/rack/auth/openid.rb#L314">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">314
315
316
317
318</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='add_extension identifier id'>add_extension</span><span class='lparen token'>(</span><span class='ext identifier id'>ext</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='BadExtension constant id'>BadExtension</span> <span class='unless unless_mod kw'>unless</span> <span class='valid_extension? fid id'>valid_extension?</span><span class='lparen token'>(</span><span class='ext identifier id'>ext</span><span class='rparen token'>)</span>
  <span class='extensions identifier id'>extensions</span><span class='lbrack token'>[</span><span class='ext identifier id'>ext</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
  <span class='return return kw'>return</span> <span class='ext identifier id'>ext</span><span class='colon2 op'>::</span><span class='NS_URI constant id'>NS_URI</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>call</h3>
</div><div id="call-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>call</span><span class='args'>(env)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets up and uses session data at <tt>:openid</tt> within the session.
Errors in this setup will raise a NoSession exception.
</p>
<p>
If the parameter &#8216;openid.mode&#8217; is set, which implies a followup
from the openid server, processing is passed to #finish and the result is
returned. However, if there is no appropriate openid information in the
session, a 400 error is returned.
</p>
<p>
If the parameter specified by <tt>options[:openid_param]</tt> is present,
processing is passed to #check and the result is returned.
</p>
<p>
If neither of these conditions are met, #bad_request is called.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rack/auth/openid.rb', line 208</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3/lib/rack/auth/openid.rb#L208">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'rack.auth.openid'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='self self kw'>self</span>
  <span class='env_session identifier id'>env_session</span> <span class='assign token'>=</span> <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='@session_key ivar id'>@session_key</span><span class='rbrack token'>]</span>
  <span class='unless unless kw'>unless</span> <span class='env_session identifier id'>env_session</span> <span class='and and kw'>and</span> <span class='env_session identifier id'>env_session</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='NoSession constant id'>NoSession</span><span class='comma token'>,</span> <span class='string val'>'No compatible session.'</span>
  <span class='end end kw'>end</span>
  <span class='comment val'># let us work in our own namespace...</span>
  <span class='session identifier id'>session</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='env_session identifier id'>env_session</span><span class='lbrack token'>[</span><span class='symbol val'>:openid</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='session identifier id'>session</span> <span class='and and kw'>and</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='NoSession constant id'>NoSession</span><span class='comma token'>,</span> <span class='string val'>'Incompatible openid session.'</span>
  <span class='end end kw'>end</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='consumer identifier id'>consumer</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='OpenID constant id'>OpenID</span><span class='colon2 op'>::</span><span class='Consumer constant id'>Consumer</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='session identifier id'>session</span><span class='comma token'>,</span> <span class='@store ivar id'>@store</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='mode identifier id'>mode</span> <span class='assign token'>=</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='GET constant id'>GET</span><span class='lbrack token'>[</span><span class='string val'>'openid.mode'</span><span class='rbrack token'>]</span>
    <span class='finish identifier id'>finish</span><span class='lparen token'>(</span><span class='consumer identifier id'>consumer</span><span class='comma token'>,</span> <span class='session identifier id'>session</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='GET constant id'>GET</span><span class='lbrack token'>[</span><span class='@openid_param ivar id'>@openid_param</span><span class='rbrack token'>]</span>
    <span class='check identifier id'>check</span><span class='lparen token'>(</span><span class='consumer identifier id'>consumer</span><span class='comma token'>,</span> <span class='session identifier id'>session</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='bad_request identifier id'>bad_request</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>check</h3>
</div><div id="check-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>check</span><span class='args'>(consumer, session, req)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
As the first part of OpenID consumer action, #check retrieves the data
required for completion.
</p>
<p>
If all parameters fit within the max length of a URI, a 303 redirect will
be returned. Otherwise #confirm_post_params will be called.
</p>
<p>
Any messages from OpenID&#8217;s request are logged to
env[&#8216;rack.errors&#8217;]
</p>
<p>
<tt>env[&#8216;rack.auth.openid.request&#8217;]</tt> is the openid checkid
request instance.
</p>
<p>
<tt>session[:openid_param]</tt> is set to the openid identifier provided by
the user.
</p>
<p>
<tt>session[:return_to]</tt> is set to the return_to uri given to the
identity provider.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rack/auth/openid.rb', line 249</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3/lib/rack/auth/openid.rb#L249">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='check identifier id'>check</span><span class='lparen token'>(</span><span class='consumer identifier id'>consumer</span><span class='comma token'>,</span> <span class='session identifier id'>session</span><span class='comma token'>,</span> <span class='req identifier id'>req</span><span class='rparen token'>)</span>
  <span class='oid identifier id'>oid</span> <span class='assign token'>=</span> <span class='consumer identifier id'>consumer</span><span class='dot token'>.</span><span class='begin identifier id'>begin</span><span class='lparen token'>(</span><span class='req identifier id'>req</span><span class='dot token'>.</span><span class='GET constant id'>GET</span><span class='lbrack token'>[</span><span class='@openid_param ivar id'>@openid_param</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='@anonymous ivar id'>@anonymous</span><span class='rparen token'>)</span>
  <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'rack.auth.openid.request'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='oid identifier id'>oid</span>
  <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'rack.errors'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span><span class='lparen token'>(</span><span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
  <span class='p identifier id'>p</span> <span class='oid identifier id'>oid</span> <span class='if if_mod kw'>if</span> <span class='$DEBUG gvar id'>$DEBUG</span>

  <span class='comment val'>## Extension support</span>
  <span class='extensions identifier id'>extensions</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ext identifier id'>ext</span><span class='comma token'>,</span><span class='args identifier id'>args</span><span class='bitor op'>|</span>
    <span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='add_extension identifier id'>add_extension</span><span class='lparen token'>(</span><span class='ext identifier id'>ext</span><span class='colon2 op'>::</span><span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:openid_param</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='GET constant id'>GET</span><span class='lbrack token'>[</span><span class='openid_param identifier id'>openid_param</span><span class='rbrack token'>]</span>
  <span class='return_to_uri identifier id'>return_to_uri</span> <span class='assign token'>=</span> <span class='return_to identifier id'>return_to</span> <span class='integer val'>? </span><span class='return_to identifier id'>return_to</span> <span class='colon op'>:</span> <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='url identifier id'>url</span>
  <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:return_to</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='return_to_uri identifier id'>return_to_uri</span>
  <span class='immediate identifier id'>immediate</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='key? fid id'>key?</span><span class='lparen token'>(</span><span class='symbol val'>:setup_needed</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='false false kw'>false</span> <span class='colon op'>:</span> <span class='immediate identifier id'>immediate</span>

  <span class='if if kw'>if</span> <span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='send_redirect? fid id'>send_redirect?</span><span class='lparen token'>(</span><span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='return_to_uri identifier id'>return_to_uri</span><span class='comma token'>,</span> <span class='immediate identifier id'>immediate</span><span class='rparen token'>)</span>
    <span class='redirect identifier id'>redirect</span><span class='lparen token'>(</span><span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='redirect_url identifier id'>redirect_url</span><span class='lparen token'>(</span><span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='return_to_uri identifier id'>return_to_uri</span><span class='comma token'>,</span> <span class='immediate identifier id'>immediate</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='confirm_post_params identifier id'>confirm_post_params</span><span class='lparen token'>(</span><span class='oid identifier id'>oid</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='return_to_uri identifier id'>return_to_uri</span><span class='comma token'>,</span> <span class='immediate identifier id'>immediate</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='colon2 op'>::</span><span class='OpenID constant id'>OpenID</span><span class='colon2 op'>::</span><span class='DiscoveryFailure constant id'>DiscoveryFailure</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='comment val'># thrown from inside OpenID::Consumer#begin by yadis stuff</span>
  <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'rack.errors'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span><span class='lparen token'>(</span> <span class='lbrack token'>[</span><span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='e identifier id'>e</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span><span class='rbrack token'>]</span><span class='mult op'>*</span><span class='string val'>&quot;\n&quot;</span> <span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='foreign_server_failure identifier id'>foreign_server_failure</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>finish</h3>
</div><div id="finish-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>finish</span><span class='args'>(consumer, session, req)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This is the final portion of authentication. If successful, a redirect to
the realm is be returned. Data gathered from extensions are stored in
session[:openid] with the extension&#8217;s namespace uri as the key.
</p>
<p>
Any messages from OpenID&#8217;s response are logged to
env[&#8216;rack.errors&#8217;]
</p>
<p>
<tt>env[&#8216;rack.auth.openid.response&#8217;]</tt> will contain the
openid response.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rack/auth/openid.rb', line 286</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3/lib/rack/auth/openid.rb#L286">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">286
287
288
289
290
291
292
293
294
295
296
297</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='finish identifier id'>finish</span><span class='lparen token'>(</span><span class='consumer identifier id'>consumer</span><span class='comma token'>,</span> <span class='session identifier id'>session</span><span class='comma token'>,</span> <span class='req identifier id'>req</span><span class='rparen token'>)</span>
  <span class='oid identifier id'>oid</span> <span class='assign token'>=</span> <span class='consumer identifier id'>consumer</span><span class='dot token'>.</span><span class='complete identifier id'>complete</span><span class='lparen token'>(</span><span class='req identifier id'>req</span><span class='dot token'>.</span><span class='GET constant id'>GET</span><span class='comma token'>,</span> <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='url identifier id'>url</span><span class='rparen token'>)</span>
  <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'rack.auth.openid.response'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='oid identifier id'>oid</span>
  <span class='req identifier id'>req</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'rack.errors'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span><span class='lparen token'>(</span><span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
  <span class='p identifier id'>p</span> <span class='oid identifier id'>oid</span> <span class='if if_mod kw'>if</span> <span class='$DEBUG gvar id'>$DEBUG</span>

  <span class='if if kw'>if</span> <span class='ValidStatus constant id'>ValidStatus</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='status identifier id'>status</span><span class='rparen token'>)</span>
    <span class='__send__ identifier id'>__send__</span><span class='lparen token'>(</span><span class='oid identifier id'>oid</span><span class='dot token'>.</span><span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='oid identifier id'>oid</span><span class='comma token'>,</span> <span class='req identifier id'>req</span><span class='comma token'>,</span> <span class='session identifier id'>session</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='invalid_status identifier id'>invalid_status</span><span class='lparen token'>(</span><span class='oid identifier id'>oid</span><span class='comma token'>,</span> <span class='req identifier id'>req</span><span class='comma token'>,</span> <span class='session identifier id'>session</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>valid_extension?</h3>
</div><div id="valid_extension-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>valid_extension?</span><span class='args'>(ext)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks the validitity, in the context of usage, of a submitted extension.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rack/auth/openid.rb', line 323</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3/lib/rack/auth/openid.rb#L323">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">323
324
325
326
327
328
329
330
331
332</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='valid_extension? fid id'>valid_extension?</span><span class='lparen token'>(</span><span class='ext identifier id'>ext</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='dstring node'>%w[NS_URI Request Response]</span><span class='dot token'>.</span><span class='all? fid id'>all?</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='ext identifier id'>ext</span><span class='dot token'>.</span><span class='const_defined? fid id'>const_defined?</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'Extension is missing constants.'</span>
  <span class='elsif elsif kw'>elsif</span> <span class='not not kw'>not</span> <span class='ext identifier id'>ext</span><span class='colon2 op'>::</span><span class='Response constant id'>Response</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:from_success_response</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'Response is missing required method.'</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='true true kw'>true</span>
<span class='rescue rescue kw'>rescue</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>within_realm?</h3>
</div><div id="within_realm-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>within_realm?</span><span class='args'>(uri)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="include?-instance_method">include?</tt>
  
</p>
</div><div class="section docstring">
  <p>
Checks the provided uri to ensure it&#8217;d be considered within the
realm. is currently not compatible with wildcard realms.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rack/auth/openid.rb', line 337</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rack/rack/blob/fd1c1d2e494d9a7d15e0458602ef121f244addc3/lib/rack/auth/openid.rb#L337">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">337
338
339
340
341
342
343
344
345
346
347
348</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='within_realm? fid id'>within_realm?</span> <span class='uri identifier id'>uri</span>
  <span class='uri identifier id'>uri</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  <span class='realm identifier id'>realm</span> <span class='assign token'>=</span> <span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='realm identifier id'>realm</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='absolute? fid id'>absolute?</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='host identifier id'>host</span> <span class='eq op'>==</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='host identifier id'>host</span> <span class='or or kw'>or</span> <span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='lbrack token'>[</span><span class='regexp val'>/^\*\./</span><span class='rbrack token'>]</span>
  <span class='comment val'># for wildcard support, is awkward with URI limitations</span>
  <span class='realm_match identifier id'>realm_match</span> <span class='assign token'>=</span> <span class='Regexp constant id'>Regexp</span><span class='dot token'>.</span><span class='escape identifier id'>escape</span><span class='lparen token'>(</span><span class='realm identifier id'>realm</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='rparen token'>)</span><span class='dot token'>.</span>
    <span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/^\*\./</span><span class='comma token'>,</span><span class='dstring node'>&quot;^#{URI::REGEXP::PATTERN::URIC_NO_SLASH}+.&quot;</span><span class='rparen token'>)</span><span class='plus op'>+</span><span class='string val'>'$'</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='dot token'>.</span><span class='match identifier id'>match</span><span class='lparen token'>(</span><span class='realm_match identifier id'>realm_match</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>