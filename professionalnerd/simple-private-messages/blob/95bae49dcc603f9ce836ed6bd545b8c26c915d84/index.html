<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>professionalnerd's simple-private-messages - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/professionalnerd/commits/simple-private-messages/master" rel="alternate" title="Recent Commits to simple-private-messages:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("professionalnerd", "simple-private-messages", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='professionalnerd/simple-private-messages/blob/95bae49dcc603f9ce836ed6bd545b8c26c915d84' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='professionalnerd/simple-private-messages/blob/95bae49dcc603f9ce836ed6bd545b8c26c915d84' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("professionalnerd", "simple-private-messages", "95bae49dcc603f9ce836ed6bd545b8c26c915d84", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/professionalnerd/simple-private-messages/tree/">Source</a></li>
            <li class=""><a href="http://github.com/professionalnerd/simple-private-messages/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/professionalnerd/simple-private-messages/network">Network</a></li>            
            <li class=""><a href="http://github.com/professionalnerd/simple-private-messages/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/professionalnerd/simple-private-messages">Wiki</a></li>
            <li class=""><a href="http://github.com/professionalnerd/simple-private-messages/graphs">Graphs</a></li>                    
            <li class="active"><a href="/professionalnerd/simple-private-messages">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/professionalnerd">professionalnerd</a> / <b><a href="http://github.com/professionalnerd/simple-private-messages/tree">simple-private-messages</a></b>        
                <a id="namespaces_button" rel="professionalnerd/simple-private-messages/blob/95bae49dcc603f9ce836ed6bd545b8c26c915d84" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="professionalnerd/simple-private-messages/blob/95bae49dcc603f9ce836ed6bd545b8c26c915d84" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Simple Private Messages</h1>
<p>
This plugin provides basic private messaging functionality between the
users of a site. It&#8217;s not big on features but the idea is that
it&#8217;s nice and simple and light on resources.
</p>
<p>
It&#8217;s not bound to specific model names and plays nice with
will_paginate.
</p>
<h1>Setup</h1>
<p>
First create the private message model by running the private_message_model
generator, passing two parameters - the name you want to use for the
Message model and the name of the User model.
</p>
<p>
For all examples in the readme, we will use Message and User.
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='private_message_model identifier id'>private_message_model</span> <span class='Message constant id'>Message</span> <span class='User constant id'>User</span>
</pre>
<p>
Now add the following entry to the model which will have the messages
</p>
<pre class="code">
  <span class='has_private_messages identifier id'>has_private_messages</span>
</pre>
<p>
If you have used anything other than &quot;Message&quot;, you will have to
pass the correct class name along as :class_name.
</p>
<p>
That&#8217;s it.
</p>
<h1>Usage</h1>
<p>
Examples assume you&#8217;re using Restful Authentication or AAA, with a
user model of User and message model of Message.
</p>
<h2>Creating / sending a message:</h2>
<pre class="code">
  <span class='frank identifier id'>frank</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span><span class='lparen token'>(</span><span class='string val'>&quot;frank&quot;</span><span class='rparen token'>)</span>
  <span class='george identifier id'>george</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span><span class='lparen token'>(</span><span class='string val'>&quot;george&quot;</span><span class='rparen token'>)</span>

  <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='Message constant id'>Message</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='subject identifier id'>subject</span> <span class='assign token'>=</span> <span class='string val'>&quot;Happy Festivus, son&quot;</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='body identifier id'>body</span> <span class='assign token'>=</span> <span class='string val'>&quot;It's time for the Feats of Strength.&quot;</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='sender identifier id'>sender</span> <span class='assign token'>=</span> <span class='frank identifier id'>frank</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='recipient identifier id'>recipient</span> <span class='assign token'>=</span> <span class='george identifier id'>george</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
</pre>
<h2>Reading a message</h2>
<pre class="code">
  <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='Message constant id'>Message</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='rparen token'>)</span>
</pre>
<p>
Returns the message of the chosen id and ensures the passed user is either
the sender or the recipient. If unread, it checks to see if the passed user
is the recipient and if so marks the read_at timestamp.
</p>
<p>
You can also check if a message has been read with the following:
</p>
<pre class="code">
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='read? fid id'>read?</span>
</pre>
<h2>Retrieving a user&#8217;s received mail</h2>
<pre class="code">
  <span class='newman identifier id'>newman</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span><span class='lparen token'>(</span><span class='string val'>&quot;newman&quot;</span><span class='rparen token'>)</span>
  <span class='newman identifier id'>newman</span><span class='dot token'>.</span><span class='received_messages identifier id'>received_messages</span>
</pre>
<p>
The following will return Newman&#8217;s number of unread messages:
</p>
<pre class="code">
  <span class='newman identifier id'>newman</span><span class='dot token'>.</span><span class='unread_message_count identifier id'>unread_message_count</span>
</pre>
<p>
Or the following for true or false on whether there are unread messages:
</p>
<pre class="code">
  <span class='newman identifier id'>newman</span><span class='dot token'>.</span><span class='unread_messages? fid id'>unread_messages?</span>
</pre>
<h2>Retrieving a user&#8217;s sent mail</h2>
<pre class="code">
  <span class='newman identifier id'>newman</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span><span class='lparen token'>(</span><span class='string val'>&quot;newman&quot;</span><span class='rparen token'>)</span>
  <span class='newman identifier id'>newman</span><span class='dot token'>.</span><span class='sent_messages identifier id'>sent_messages</span>
</pre>
<h2>Custom finds</h2>
<pre class="code">
  <span class='newman identifier id'>newman</span><span class='dot token'>.</span><span class='sent_messages identifier id'>sent_messages</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span>
                          <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;read_at &lt; ?&quot;</span><span class='comma token'>,</span> <span class='float val'>2</span><span class='dot token'>.</span><span class='days identifier id'>days</span><span class='dot token'>.</span><span class='ago identifier id'>ago</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
                          <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>20</span><span class='comma token'>,</span>
                          <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;created_at ASC&quot;</span><span class='rparen token'>)</span>
</pre>
<h2>Deleting a message</h2>
<pre class="code">
  <span class='newman identifier id'>newman</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span><span class='lparen token'>(</span><span class='string val'>&quot;newman&quot;</span><span class='rparen token'>)</span>
  <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='newman identifier id'>newman</span><span class='dot token'>.</span><span class='received_messages identifier id'>received_messages</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='mark_deleted identifier id'>mark_deleted</span><span class='lparen token'>(</span><span class='newman identifier id'>newman</span><span class='rparen token'>)</span>
</pre>
<p>
This will look at a message and mark it read by the sender or recipient,
based on whichever Newman is. It now will no longer appear in
Newman&#8217;s messages.
</p>
<pre class="code">
  <span class='kramer identifier id'>kramer</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span><span class='lparen token'>(</span><span class='string val'>&quot;kramer&quot;</span><span class='rparen token'>)</span>
  <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='kramer identifier id'>kramer</span><span class='dot token'>.</span><span class='sent_messages identifier id'>sent_messages</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='mark_deleted identifier id'>mark_deleted</span>
</pre>
<p>
Now that both sender and recipient have marked the message deleted, it gets
destroyed. Should a message be sent to oneself, it will be deleted in one
step due to the sender and recipient being the same.
</p>
<h1>Scaffold</h1>
<p>
A generator is included to create a basic controller and set of views.
</p>
<p>
Run the private_message_scaffold generator with the same options as before:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='private_message_scaffold identifier id'>private_message_scaffold</span> <span class='Message constant id'>Message</span> <span class='User constant id'>User</span>
</pre>
<p>
The controller will be named with the pluralised version of the model name.
</p>
<p>
After that you need to add the resource to your routes.rb as a nested
resource of the users controller, with a collection for the delete_selected
action.
</p>
<pre class="code">
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:users</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='users identifier id'>users</span><span class='bitor op'>|</span>
    <span class='users identifier id'>users</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:messages</span><span class='comma token'>,</span> <span class='symbol val'>:collection</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:delete_selected</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:post</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Then uncomment the entry at the top of the message model to establish the
:to accessor.
</p>
<p>
You should now have working messaging.
</p>
<h1>Tests</h1>
<p>
Unit tests are provided for the model extensions but not for the generated
scaffold. Running these requires sqlite3.
</p>
<h3>Credits</h3>
<p>
Testing functionality for creating dedicated models / loading of a custom
schema taken from acts_as_taggable_on_steroids.
</p>
<h3>Bug reports / suggestions</h3>
<p>
www.professionalnerd.com /
&quot;jonYADAYADAprofessionalnerd.com&quot;.gsub(/YADAYADA/, &quot;@&quot;)
</p>
<h3>License</h3>
<p>
Copyright &#169; 2007 Jon Gilbraith released under the MIT license
http://en.wikipedia.org/wiki/MIT_License
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>