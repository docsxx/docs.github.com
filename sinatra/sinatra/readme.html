<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <h1>Sinatra</h1>
<p>
Sinatra is a DSL for quickly creating web-applications in Ruby with minimal
effort:
</p>
<pre class="code">
  <span class='comment val'># myapp.rb</span>
  <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'sinatra'</span>
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='string val'>'Hello world!'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Install the gem and run with:
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='sinatra identifier id'>sinatra</span>
  <span class='ruby identifier id'>ruby</span> <span class='myapp identifier id'>myapp</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
View at: http://localhost:4567
</p>
<h2>Routes</h2>
<p>
In Sinatra, a route is an HTTP method paired with an URL matching pattern.
Each route is associated with a block:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='dot2 op'>..</span> <span class='show identifier id'>show</span> <span class='something identifier id'>something</span> <span class='dot2 op'>..</span>
  <span class='end end kw'>end</span>

  <span class='post identifier id'>post</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='dot2 op'>..</span> <span class='create identifier id'>create</span> <span class='something identifier id'>something</span> <span class='dot2 op'>..</span>
  <span class='end end kw'>end</span>

  <span class='put identifier id'>put</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='dot2 op'>..</span> <span class='update identifier id'>update</span> <span class='something identifier id'>something</span> <span class='dot2 op'>..</span>
  <span class='end end kw'>end</span>

  <span class='delete identifier id'>delete</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='dot2 op'>..</span> <span class='annihilate identifier id'>annihilate</span> <span class='something identifier id'>something</span> <span class='dot2 op'>..</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Routes are matched in the order they are defined. The first route that
matches the request is invoked.
</p>
<p>
Route patterns may include named parameters, accessible via the
<tt>params</tt> hash:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/hello/:name'</span> <span class='do do kw'>do</span>
    <span class='comment val'># matches &quot;GET /foo&quot; and &quot;GET /bar&quot;</span>
    <span class='comment val'># params[:name] is 'foo' or 'bar'</span>
    <span class='dstring node'>&quot;Hello #{params[:name]}!&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
You can also access named parameters via block parameters:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/hello/:name'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='n identifier id'>n</span><span class='bitor op'>|</span>
    <span class='dstring node'>&quot;Hello #{n}!&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Route patterns may also include splat (or wildcard) parameters, accessible
via the <tt>params[:splat]</tt> array.
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/say/*/to/*'</span> <span class='do do kw'>do</span>
    <span class='comment val'># matches /say/hello/to/world</span>
    <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:splat</span><span class='rbrack token'>]</span> <span class='comment val'># =&gt; [&quot;hello&quot;, &quot;world&quot;]</span>
  <span class='end end kw'>end</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/download/*.*'</span> <span class='do do kw'>do</span>
    <span class='comment val'># matches /download/path/to/file.xml</span>
    <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:splat</span><span class='rbrack token'>]</span> <span class='comment val'># =&gt; [&quot;path/to/file&quot;, &quot;xml&quot;]</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Route matching with Regular Expressions:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='regexp val'>%r{/hello/([\w]+)}</span> <span class='do do kw'>do</span>
    <span class='dstring node'>&quot;Hello, #{params[:captures].first}!&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Or with a block parameter:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='regexp val'>%r{/hello/([\w]+)}</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span>
    <span class='dstring node'>&quot;Hello, #{c}!&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Routes may include a variety of matching conditions, such as the user
agent:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/foo'</span><span class='comma token'>,</span> <span class='symbol val'>:agent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='regexp val'>/Songbird (\d\.\d)[\d\/]*?/</span> <span class='do do kw'>do</span>
    <span class='dstring node'>&quot;You're using Songbird version #{params[:agent][0]}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/foo'</span> <span class='do do kw'>do</span>
    <span class='comment val'># Matches non-songbird browsers</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Static Files</h2>
<p>
Static files are served from the <tt>./public</tt> directory. You can
specify a different location by setting the <tt>:public</tt> option:
</p>
<pre class="code">
  <span class='set identifier id'>set</span> <span class='symbol val'>:public</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='__FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>'/static'</span>
</pre>
<p>
Note that the public directory name is not included in the URL. A file
<tt>./public/css/style.css</tt> is made available as
<tt>http://example.com/css/style.css</tt>.
</p>
<h2>Views / Templates</h2>
<p>
Templates are assumed to be located directly under the <tt>./views</tt>
directory. To use a different views directory:
</p>
<pre class="code">
  <span class='set identifier id'>set</span> <span class='symbol val'>:views</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='__FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>'/templates'</span>
</pre>
<p>
One important thing to remember is that you always have to reference
templates with symbols, even if they&#8217;re in a subdirectory (in this
case use <tt>:&#8217;subdir/template&#8217;</tt>). Rendering methods will
render any strings passed to them directly.
</p>
<h3>Haml Templates</h3>
<p>
The haml gem/library is required to render HAML templates:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='haml identifier id'>haml</span> <span class='symbol val'>:index</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Renders <tt>./views/index.haml</tt>.
</p>
<p>
{Haml&#8217;s
options}[http://haml.hamptoncatlin.com/docs/rdoc/classes/Haml.html] can be
set globally through Sinatra&#8217;s configurations, see {Options and
Configurations}[http://www.sinatrarb.com/configuration.html], and
overridden on an individual basis.
</p>
<pre class="code">
  <span class='set identifier id'>set</span> <span class='symbol val'>:haml</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:format</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:html5</span> <span class='rbrace token'>}</span> <span class='comment val'># default Haml format is :xhtml</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='haml identifier id'>haml</span> <span class='symbol val'>:index</span><span class='comma token'>,</span> <span class='symbol val'>:haml_options</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:format</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:html4</span> <span class='rbrace token'>}</span> <span class='comment val'># overridden</span>
  <span class='end end kw'>end</span>
</pre>
<h3>Erb Templates</h3>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='erb identifier id'>erb</span> <span class='symbol val'>:index</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Renders <tt>./views/index.erb</tt>
</p>
<h3>Builder Templates</h3>
<p>
The builder gem/library is required to render builder templates:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='content_type identifier id'>content_type</span> <span class='string val'>'application/xml'</span><span class='comma token'>,</span> <span class='symbol val'>:charset</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'utf-8'</span>
    <span class='builder identifier id'>builder</span> <span class='symbol val'>:index</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Renders <tt>./views/index.builder</tt>.
</p>
<h3>Sass Templates</h3>
<p>
The sass gem/library is required to render Sass templates:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/stylesheet.css'</span> <span class='do do kw'>do</span>
    <span class='content_type identifier id'>content_type</span> <span class='string val'>'text/css'</span><span class='comma token'>,</span> <span class='symbol val'>:charset</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'utf-8'</span>
    <span class='sass identifier id'>sass</span> <span class='symbol val'>:stylesheet</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Renders <tt>./views/stylesheet.sass</tt>.
</p>
<p>
{Sass&#8217;
options}[http://haml.hamptoncatlin.com/docs/rdoc/classes/Sass.html] can be
set globally through Sinatra&#8217;s configurations, see {Options and
Configurations}[http://www.sinatrarb.com/configuration.html], and
overridden on an individual basis.
</p>
<pre class="code">
  <span class='set identifier id'>set</span> <span class='symbol val'>:sass</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:style</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:compact</span> <span class='rbrace token'>}</span> <span class='comment val'># default Sass style is :nested</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/stylesheet.css'</span> <span class='do do kw'>do</span>
    <span class='content_type identifier id'>content_type</span> <span class='string val'>'text/css'</span><span class='comma token'>,</span> <span class='symbol val'>:charset</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'utf-8'</span>
    <span class='sass identifier id'>sass</span> <span class='symbol val'>:stylesheet</span><span class='comma token'>,</span> <span class='symbol val'>:sass_options</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:style</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:expanded</span> <span class='rbrace token'>}</span> <span class='comment val'># overridden</span>
  <span class='end end kw'>end</span>
</pre>
<h3>Inline Templates</h3>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='haml identifier id'>haml</span> <span class='string val'>'%div.title Hello World'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Renders the inlined template string.
</p>
<h3>Accessing Variables in Templates</h3>
<p>
Templates are evaluated within the same context as route handlers. Instance
variables set in route handlers are direcly accessible by templates:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/:id'</span> <span class='do do kw'>do</span>
    <span class='@foo ivar id'>@foo</span> <span class='assign token'>=</span> <span class='Foo constant id'>Foo</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='haml identifier id'>haml</span> <span class='string val'>'%h1= @foo.name'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Or, specify an explicit Hash of local variables:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/:id'</span> <span class='do do kw'>do</span>
    <span class='foo identifier id'>foo</span> <span class='assign token'>=</span> <span class='Foo constant id'>Foo</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='haml identifier id'>haml</span> <span class='string val'>'%h1= foo.name'</span><span class='comma token'>,</span> <span class='symbol val'>:locals</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:foo</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='foo identifier id'>foo</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
This is typically used when rendering templates as partials from within
other templates.
</p>
<h3>In-file Templates</h3>
<p>
Templates may be defined at the end of the source file:
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'sinatra'</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='haml identifier id'>haml</span> <span class='symbol val'>:index</span>
  <span class='end end kw'>end</span>

  <span class='__END__ identifier id'>__END__</span>

  <span class='@@ ivar id'>@@</span> <span class='layout identifier id'>layout</span>
  <span class='html identifier id'>html</span>
    <span class='assign token'>=</span> <span class='yield yield kw'>yield</span>

  <span class='@@ ivar id'>@@</span> <span class='index identifier id'>index</span>
  <span class='div identifier id'>div</span><span class='dot token'>.</span><span class='title identifier id'>title</span> <span class='Hello constant id'>Hello</span> <span class='world! fid id'>world!</span><span class='notop op'>!</span><span class='notop op'>!</span><span class='notop op'>!</span><span class='notop op'>!</span>
</pre>
<p>
NOTE: In-file templates defined in the source file that requires sinatra
are automatically loaded. Call the <tt>use_in_file_templates!</tt> method
explicitly if you have in-file templates in other source files.
</p>
<h3>Named Templates</h3>
<p>
Templates may also be defined using the top-level <tt>template</tt> method:
</p>
<pre class="code">
  <span class='template identifier id'>template</span> <span class='symbol val'>:layout</span> <span class='do do kw'>do</span>
    <span class='string val'>&quot;%html\n  =yield\n&quot;</span>
  <span class='end end kw'>end</span>

  <span class='template identifier id'>template</span> <span class='symbol val'>:index</span> <span class='do do kw'>do</span>
    <span class='string val'>'%div.title Hello World!'</span>
  <span class='end end kw'>end</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='haml identifier id'>haml</span> <span class='symbol val'>:index</span>
  <span class='end end kw'>end</span>
</pre>
<p>
If a template named &quot;layout&quot; exists, it will be used each time a
template is rendered. You can disable layouts by passing <tt>:layout =&gt;
false</tt>.
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='haml identifier id'>haml</span> <span class='symbol val'>:index</span><span class='comma token'>,</span> <span class='symbol val'>:layout</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='notop op'>!</span><span class='request identifier id'>request</span><span class='dot token'>.</span><span class='xhr? fid id'>xhr?</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Helpers</h2>
<p>
Use the top-level <tt>helpers</tt> method to define helper methods for use
in route handlers and templates:
</p>
<pre class="code">
  <span class='helpers identifier id'>helpers</span> <span class='do do kw'>do</span>
    <span class='def def kw'>def</span> <span class='bar identifier id'>bar</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
      <span class='dstring node'>&quot;#{name}bar&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/:name'</span> <span class='do do kw'>do</span>
    <span class='bar identifier id'>bar</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Filters</h2>
<p>
Before filters are evaluated before each request within the context of the
request and can modify the request and response. Instance variables set in
filters are accessible by routes and templates:
</p>
<pre class="code">
  <span class='before identifier id'>before</span> <span class='do do kw'>do</span>
    <span class='@note ivar id'>@note</span> <span class='assign token'>=</span> <span class='string val'>'Hi!'</span>
    <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='path_info identifier id'>path_info</span> <span class='assign token'>=</span> <span class='string val'>'/foo/bar/baz'</span>
  <span class='end end kw'>end</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/foo/*'</span> <span class='do do kw'>do</span>
    <span class='@note ivar id'>@note</span> <span class='comment val'>#=&gt; 'Hi!'</span>
    <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:splat</span><span class='rbrack token'>]</span> <span class='comment val'>#=&gt; 'bar/baz'</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Halting</h2>
<p>
To immediately stop a request during a before filter or route use:
</p>
<pre class="code">
  <span class='halt identifier id'>halt</span>
</pre>
<p>
You can also specify a body when halting &#8230;
</p>
<pre class="code">
  <span class='halt identifier id'>halt</span> <span class='string val'>'this will be the body'</span>
</pre>
<p>
Or set the status and body &#8230;
</p>
<pre class="code">
  <span class='halt identifier id'>halt</span> <span class='integer val'>401</span><span class='comma token'>,</span> <span class='string val'>'go away!'</span>
</pre>
<h2>Passing</h2>
<p>
A route can punt processing to the next matching route using <tt>pass</tt>:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/guess/:who'</span> <span class='do do kw'>do</span>
    <span class='pass identifier id'>pass</span> <span class='unless unless_mod kw'>unless</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:who</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'Frank'</span>
    <span class='string val'>&quot;You got me!&quot;</span>
  <span class='end end kw'>end</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/guess/*'</span> <span class='do do kw'>do</span>
    <span class='string val'>&quot;You missed!&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The route block is immediately exited and control continues with the next
matching route. If no matching route is found, a 404 is returned.
</p>
<h2>Configuration</h2>
<p>
Run once, at startup, in any environment:
</p>
<pre class="code">
  <span class='configure identifier id'>configure</span> <span class='do do kw'>do</span>
    <span class='dot3 op'>...</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Run only when the environment (RACK_ENV environment variable) is set to
<tt>:production</tt>:
</p>
<pre class="code">
  <span class='configure identifier id'>configure</span> <span class='symbol val'>:production</span> <span class='do do kw'>do</span>
    <span class='dot3 op'>...</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Run when the environment is set to either <tt>:production</tt> or
<tt>:test</tt>:
</p>
<pre class="code">
  <span class='configure identifier id'>configure</span> <span class='symbol val'>:production</span><span class='comma token'>,</span> <span class='symbol val'>:test</span> <span class='do do kw'>do</span>
    <span class='dot3 op'>...</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Error handling</h2>
<p>
Error handlers run within the same context as routes and before filters,
which means you get all the goodies it has to offer, like <tt>haml</tt>,
<tt>erb</tt>, <tt>halt</tt>, etc.
</p>
<h3>Not Found</h3>
<p>
When a <tt>Sinatra::NotFound</tt> exception is raised, or the
response&#8217;s status code is 404, the <tt>not_found</tt> handler is
invoked:
</p>
<pre class="code">
  <span class='not_found identifier id'>not_found</span> <span class='do do kw'>do</span>
    <span class='string val'>'This is nowhere to be found'</span>
  <span class='end end kw'>end</span>
</pre>
<h3>Error</h3>
<p>
The <tt>error</tt> handler is invoked any time an exception is raised from
a route block or before filter. The exception object can be obtained from
the <tt>sinatra.error</tt> Rack variable:
</p>
<pre class="code">
  <span class='error identifier id'>error</span> <span class='do do kw'>do</span>
    <span class='string val'>'Sorry there was a nasty error - '</span> <span class='plus op'>+</span> <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'sinatra.error'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='name identifier id'>name</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Custom errors:
</p>
<pre class="code">
  <span class='error identifier id'>error</span> <span class='MyCustomError constant id'>MyCustomError</span> <span class='do do kw'>do</span>
    <span class='string val'>'So what happened was...'</span> <span class='plus op'>+</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'sinatra.error'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Then, if this happens:
</p>
<pre class="code">
  <span class='get identifier id'>get</span> <span class='string val'>'/'</span> <span class='do do kw'>do</span>
    <span class='raise identifier id'>raise</span> <span class='MyCustomError constant id'>MyCustomError</span><span class='comma token'>,</span> <span class='string val'>'something bad'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
You get this:
</p>
<pre class="code">
  <span class='So constant id'>So</span> <span class='what identifier id'>what</span> <span class='happened identifier id'>happened</span> <span class='was identifier id'>was</span><span class='dot3 op'>...</span> <span class='something identifier id'>something</span> <span class='bad identifier id'>bad</span>
</pre>
<p>
Sinatra installs special <tt>not_found</tt> and <tt>error</tt> handlers
when running under the development environment.
</p>
<h2>Mime types</h2>
<p>
When using <tt>send_file</tt> or static files you may have mime types
Sinatra doesn&#8217;t understand. Use <tt>mime</tt> to register them by
file extension:
</p>
<pre class="code">
  <span class='mime identifier id'>mime</span> <span class='symbol val'>:foo</span><span class='comma token'>,</span> <span class='string val'>'text/foo'</span>
</pre>
<h2>Rack Middleware</h2>
<p>
Sinatra rides on Rack[http://rack.rubyforge.org/], a minimal standard
interface for Ruby web frameworks. One of Rack&#8217;s most interesting
capabilities for application developers is support for
&quot;middleware&quot; &#8212; components that sit between the server and
your application monitoring and/or manipulating the HTTP request/response
to provide various types of common functionality.
</p>
<p>
Sinatra makes building Rack middleware pipelines a cinch via a top-level
<tt>use</tt> method:
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'sinatra'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'my_custom_middleware'</span>

  <span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Lint constant id'>Lint</span>
  <span class='use identifier id'>use</span> <span class='MyCustomMiddleware constant id'>MyCustomMiddleware</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/hello'</span> <span class='do do kw'>do</span>
    <span class='string val'>'Hello World'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The semantics of <tt>use</tt> are identical to those defined for the
Rack::Builder[http://rack.rubyforge.org/doc/classes/Rack/Builder.html] DSL
(most frequently used from rackup files). For example, the <tt>use</tt>
method accepts multiple/variable args as well as blocks:
</p>
<pre class="code">
  <span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Auth constant id'>Auth</span><span class='colon2 op'>::</span><span class='Basic constant id'>Basic</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='username identifier id'>username</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='bitor op'>|</span>
    <span class='username identifier id'>username</span> <span class='eq op'>==</span> <span class='string val'>'admin'</span> <span class='andop op'>&amp;&amp;</span> <span class='password identifier id'>password</span> <span class='eq op'>==</span> <span class='string val'>'secret'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Rack is distributed with a variety of standard middleware for logging,
debugging, URL routing, authentication, and session handling. Sinatra uses
many of of these components automatically based on configuration so you
typically don&#8217;t have to <tt>use</tt> them explicitly.
</p>
<h2>Testing</h2>
<p>
The Sinatra::Test mixin and Sinatra::TestHarness class include a variety of
helper methods for testing your Sinatra app:
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'my_sinatra_app'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'test/unit'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'sinatra/test'</span>

  <span class='class class kw'>class</span> <span class='MyAppTest constant id'>MyAppTest</span> <span class='lt op'>&lt;</span> <span class='Test constant id'>Test</span><span class='colon2 op'>::</span><span class='Unit constant id'>Unit</span><span class='colon2 op'>::</span><span class='TestCase constant id'>TestCase</span>
    <span class='include identifier id'>include</span> <span class='Sinatra constant id'>Sinatra</span><span class='colon2 op'>::</span><span class='Test constant id'>Test</span>

    <span class='def def kw'>def</span> <span class='test_my_default identifier id'>test_my_default</span>
      <span class='get identifier id'>get</span> <span class='string val'>'/'</span>
      <span class='assert_equal identifier id'>assert_equal</span> <span class='string val'>'Hello World!'</span><span class='comma token'>,</span> <span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='body identifier id'>body</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='test_with_params identifier id'>test_with_params</span>
      <span class='get identifier id'>get</span> <span class='string val'>'/meet'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Frank'</span><span class='rbrace token'>}</span>
      <span class='assert_equal identifier id'>assert_equal</span> <span class='string val'>'Hello Frank!'</span><span class='comma token'>,</span> <span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='body identifier id'>body</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='test_with_rack_env identifier id'>test_with_rack_env</span>
      <span class='get identifier id'>get</span> <span class='string val'>'/'</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='symbol val'>:agent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Songbird'</span>
      <span class='assert_equal identifier id'>assert_equal</span> <span class='string val'>&quot;You're using Songbird!&quot;</span><span class='comma token'>,</span> <span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='body identifier id'>body</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
See http://www.sinatrarb.com/testing.html for more on Sinatra::Test and
using it with other test frameworks such as RSpec, Bacon, and test/spec.
</p>
<h2>Command line</h2>
<p>
Sinatra applications can be run directly:
</p>
<pre class="code">
  <span class='ruby identifier id'>ruby</span> <span class='myapp identifier id'>myapp</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span> <span class='lbrack token'>[</span><span class='minus op'>-</span><span class='h identifier id'>h</span><span class='rbrack token'>]</span> <span class='lbrack token'>[</span><span class='minus op'>-</span><span class='x identifier id'>x</span><span class='rbrack token'>]</span> <span class='lbrack token'>[</span><span class='minus op'>-</span><span class='e identifier id'>e</span> <span class='ENVIRONMENT constant id'>ENVIRONMENT</span><span class='rbrack token'>]</span> <span class='lbrack token'>[</span><span class='minus op'>-</span><span class='p identifier id'>p</span> <span class='PORT constant id'>PORT</span><span class='rbrack token'>]</span> <span class='lbrack token'>[</span><span class='minus op'>-</span><span class='s identifier id'>s</span> <span class='HANDLER constant id'>HANDLER</span><span class='rbrack token'>]</span>
</pre>
<p>
Options are:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='h identifier id'>h</span> <span class='comment val'># help</span>
  <span class='minus op'>-</span><span class='p identifier id'>p</span> <span class='comment val'># set the port (default is 4567)</span>
  <span class='minus op'>-</span><span class='e identifier id'>e</span> <span class='comment val'># set the environment (default is development)</span>
  <span class='minus op'>-</span><span class='s identifier id'>s</span> <span class='comment val'># specify rack server/handler (default is thin)</span>
  <span class='minus op'>-</span><span class='x identifier id'>x</span> <span class='comment val'># turn on the mutex lock (default is off)</span>
</pre>
<h2>The Bleeding Edge</h2>
<p>
If you would like to use Sinatra&#8217;s latest bleeding code, create a
local clone and run your app with the <tt>sinatra/lib</tt> directory on the
<tt>LOAD_PATH</tt>:
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='myapp identifier id'>myapp</span>
  <span class='git identifier id'>git</span> <span class='clone identifier id'>clone</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/s</span><span class='inatra identifier id'>inatra</span><span class='div op'>/</span><span class='sinatra identifier id'>sinatra</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
  <span class='ruby identifier id'>ruby</span> <span class='minus op'>-</span><span class='Isinatra constant id'>Isinatra</span><span class='div op'>/</span><span class='lib identifier id'>lib</span> <span class='myapp identifier id'>myapp</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
Alternatively, you can add the <tt>sinatra/lib&lt;tt&gt; directory to the
&lt;tt&gt;LOAD_PATH</tt> in your application:
</p>
<pre class="code">
  <span class='$LOAD_PATH gvar id'>$LOAD_PATH</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='__FILE__ __file__ kw'>__FILE__</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>'/sinatra/lib'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'sinatra'</span>

  <span class='get identifier id'>get</span> <span class='string val'>'/about'</span> <span class='do do kw'>do</span>
    <span class='string val'>&quot;I'm running version &quot;</span> <span class='plus op'>+</span> <span class='Sinatra constant id'>Sinatra</span><span class='colon2 op'>::</span><span class='VERSION constant id'>VERSION</span>
  <span class='end end kw'>end</span>
</pre>
<p>
To update the Sinatra sources in the future:
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='myproject identifier id'>myproject</span><span class='div op'>/</span><span class='sinatra identifier id'>sinatra</span>
  <span class='git identifier id'>git</span> <span class='pull identifier id'>pull</span>
</pre>
<h2>More</h2>
<ul>
<li>{Project Website}[http://sinatra.github.com/] - Additional documentation,
news, and links to other resources.

</li>
<li>{Contributing}[http://sinatra.github.com/contributing.html] - Find a bug?
Need help? Have a patch?

</li>
<li>{Lighthouse}[http://sinatra.lighthouseapp.com] - Issue tracking and release
planning.

</li>
<li>{Twitter}[http://twitter.com/sinatra]

</li>
<li>{Mailing List}[http://groups.google.com/group/sinatrarb]

</li>
<li>{IRC: #sinatra}[irc://chat.freenode.net/#sinatra] on http://freenode.net

</li>
</ul>

      </div>
    </div>
  </body>
</html>