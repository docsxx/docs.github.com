<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>andre's geokit-rails - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/andre/commits/geokit-rails/master" rel="alternate" title="Recent Commits to geokit-rails:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("andre", "geokit-rails", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='andre/geokit-rails/blob/93a264b2544245b387d2db46feb76a938e041cc8' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='andre/geokit-rails/blob/93a264b2544245b387d2db46feb76a938e041cc8' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("andre", "geokit-rails", "93a264b2544245b387d2db46feb76a938e041cc8", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/andre/geokit-rails/tree/">Source</a></li>
            <li class=""><a href="http://github.com/andre/geokit-rails/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/andre/geokit-rails/network">Network</a></li>            
            <li class=""><a href="http://github.com/andre/geokit-rails/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/andre/geokit-rails">Wiki</a></li>
            <li class=""><a href="http://github.com/andre/geokit-rails/graphs">Graphs</a></li>                    
            <li class="active"><a href="/andre/geokit-rails">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/andre">andre</a> / <b><a href="http://github.com/andre/geokit-rails/tree">geokit-rails</a></b>        
                <a id="namespaces_button" rel="andre/geokit-rails/blob/93a264b2544245b387d2db46feb76a938e041cc8" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="andre/geokit-rails/blob/93a264b2544245b387d2db46feb76a938e041cc8" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h2>INSTALLATION</h2>

<p>Geokit consists of a Gem (<a href="http://github.com/andre/geokit-gem/tree/master">geokit-gem</a>) and a Rails plugin (<a href="http://github.com/andre/geokit-rails/tree/master">geokit-rails</a>).</p>

<h4>1. Install the Rails plugin:</h4>

<pre class="code"><span class='cd identifier id'>cd</span> <span class='lbrack token'>[</span><span class='YOUR_RAILS_APP_ROOT constant id'>YOUR_RAILS_APP_ROOT</span><span class='rbrack token'>]</span>
<span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='andre identifier id'>andre</span><span class='div op'>/</span><span class='geokit identifier id'>geokit</span><span class='minus op'>-</span><span class='rails identifier id'>rails</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>

<h4>2. Add this line to your environment.rb</h4>

<p>(inside the Rails::Initializer.run do |config| block)</p>

<pre class="code">    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>&quot;geokit&quot;</span>
</pre>

<p>This informs Rails of the gem dependency.</p>

<h4>3. Tell Rails to install the gem:</h4>

<pre class="code">    <span class='rake identifier id'>rake</span> <span class='gems identifier id'>gems</span><span class='symbol val'>:install</span>
</pre>

<p>And you're good to go! If you're running an older verion of Rails, just install the gem manually: <code>sudo gem install rails</code></p>

<h2>FEATURE SUMMARY</h2>

<p>Geokit provides key functionality for location-oriented Rails applications:</p>

<ul>
<li>Distance calculations, for both flat and spherical environments. For example,
given the location of two points on the earth, you can calculate the miles/KM
between them.</li>
<li>ActiveRecord distance-based finders. For example, you can find all the points
in your database within a 50-mile radius.</li>
<li>IP-based location lookup utilizing hostip.info. Provide an IP address, and get
city name and latitude/longitude in return</li>
<li>A before_filter helper to geocoder the user's location based on IP address,
and retain the location in a cookie.</li>
<li>Geocoding from multiple providers. It provides a fail-over mechanism, in case
your input fails to geocode in one service. Geocoding is provided buy the Geokit
gem, which you must have installed</li>
</ul>


<p>The goal of this plugin is to provide the common functionality for location-oriented
applications (geocoding, location lookup, distance calculation) in an easy-to-use
package.</p>

<h2>A NOTE ON TERMINOLOGY</h2>

<p>Throughout the code and API, latitude and longitude are referred to as lat
and lng.  We've found over the long term the abbreviation saves lots of typing time.</p>

<h2>LOCATION QUERIES</h2>

<p>To get started, just specify an ActiveRecord class as <code>acts_as_mappale</code>:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Location constant id'>Location</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span>
<span class='end end kw'>end</span>
</pre>

<p>There are some defaults you can override:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Location constant id'>Location</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span> <span class='symbol val'>:default_units</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:miles</span><span class='comma token'>,</span> 
                   <span class='symbol val'>:default_formula</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:sphere</span><span class='comma token'>,</span> 
                   <span class='symbol val'>:distance_field_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:distance</span><span class='comma token'>,</span>
                   <span class='symbol val'>:lat_column_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:lat</span><span class='comma token'>,</span>
                   <span class='symbol val'>:lng_column_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:lng</span>
<span class='end end kw'>end</span>
</pre>

<p>The optional parameters are :units, :formula, and distance_field_name.<br/>
Values for :units can be :miles, :kms (kilometers), or :nms (nautical miles),
with :miles as the default.  Values for :formula can be :sphere or :flat with
:sphere as the default.  :sphere gives you Haversine calculations, while :flat
gives the Pythagoreum Theory.  These defaults persist through out the plug-in.</p>

<p>The plug-in creates a calculated <code>distance</code> field on AR instances that have
been retrieved throw a Geokit location query. By default, these fields are
known as "distance" but this can be changed through the <code>:distance_field_name</code> key.<br/>
</p>

<p>You can also define alternative column names for latitude and longitude using
the <code>:lat_column_name</code> and <code>:lng_column_name</code> keys.  The defaults are 'lat' and
'lng' respectively.</p>

<p>Once you've specified acts_as_mappable, a set of distance-based
finder methods are available:</p>

<p>Origin as a two-element array of latititude/longitude:</p>

<pre class="code">    <span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='float val'>37.792</span><span class='comma token'>,</span><span class='float val'>-122.393</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
</pre>

<p>Origin as a geocodeable string:</p>

<pre class="code">    <span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'100 Spear st, San Francisco, CA'</span><span class='rparen token'>)</span>
</pre>

<p>Origin as an object which responds to lat and lng methods,
or latitude and longitude methods, or whatever methods you have
specified for <code>lng_column_name</code> and <code>lat_column_name</code>:</p>

<pre class="code">    <span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin=</span><span class='gt op'>&gt;</span><span class='my_store identifier id'>my_store</span><span class='rparen token'>)</span> <span class='comment val'># my_store.lat and my_store.lng methods exist</span>
</pre>

<p>Often you will need to find within a certain distance. The prefered syntax is:</p>

<pre class="code"><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='comma token'>,</span> <span class='symbol val'>:within</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>5</span><span class='rparen token'>)</span>
</pre>

<p>. . . however these syntaxes will also work:</p>

<pre class="code"><span class='find_within identifier id'>find_within</span><span class='lparen token'>(</span><span class='integer val'>5</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
<span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;distance &lt; 5&quot;</span><span class='rparen token'>)</span>
</pre>

<p>Note however that the third form should be avoided. With either of the first two,
Geokit automatically adds a bounding box to speed up the radial query in the database.
With the third form, it does not.</p>

<p>If you need to combine distance conditions with other conditions, you should do
so like this:</p>

<pre class="code"><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='comma token'>,</span> <span class='symbol val'>:within</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>5</span><span class='comma token'>,</span> <span class='symbol val'>:conditions=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='string val'>'state=?'</span><span class='comma token'>,</span><span class='state identifier id'>state</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
</pre>

<p>If :origin is not provided in the finder call, the find method
works as normal.  Further, the key is removed
from the :options hash prior to invoking the superclass behavior.</p>

<p>Other convenience methods work intuitively and are as follows:</p>

<pre class="code"><span class='find_within identifier id'>find_within</span><span class='lparen token'>(</span><span class='distance identifier id'>distance</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
<span class='find_beyond identifier id'>find_beyond</span><span class='lparen token'>(</span><span class='distance identifier id'>distance</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
<span class='find_closest identifier id'>find_closest</span><span class='lparen token'>(</span><span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
<span class='find_farthest identifier id'>find_farthest</span><span class='lparen token'>(</span><span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
</pre>

<p>where the options respect the defaults, but can be overridden if
desired.<br/>
</p>

<p>Lastly, if all that is desired is the raw SQL for distance
calculations, you can use the following:</p>

<pre class="code"><span class='distance_sql identifier id'>distance_sql</span><span class='lparen token'>(</span><span class='origin identifier id'>origin</span><span class='comma token'>,</span> <span class='units identifier id'>units</span><span class='assign token'>=</span><span class='default_units identifier id'>default_units</span><span class='comma token'>,</span> <span class='formula identifier id'>formula</span><span class='assign token'>=</span><span class='default_formula identifier id'>default_formula</span><span class='rparen token'>)</span>
</pre>

<p>Thereafter, you are free to use it in find_by_sql as you wish.</p>

<p>There are methods available to enable you to get the count based upon
the find condition that you have provided.  These all work similarly to
the finders.  So for instance:</p>

<pre class="code"><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='symbol val'>:origin</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;distance &lt; 5&quot;</span><span class='rparen token'>)</span>
<span class='count_within identifier id'>count_within</span><span class='lparen token'>(</span><span class='distance identifier id'>distance</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
<span class='count_beyond identifier id'>count_beyond</span><span class='lparen token'>(</span><span class='distance identifier id'>distance</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
</pre>

<h2>FINDING WITHIN A BOUNDING BOX</h2>

<p>If you are displaying points on a map, you probably need to query for whatever falls within the rectangular bounds of the map:</p>

<pre class="code"><span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:bounds=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='sw_point identifier id'>sw_point</span><span class='comma token'>,</span><span class='ne_point identifier id'>ne_point</span><span class='rbrack token'>]</span>
</pre>

<p>The input to :bounds can be array with the two points or a Bounds object. However you provide them, the order should always be the southwest corner, northeast corner of the rectangle. Typically, you will be getting the sw_point and ne_point from a map that is displayed on a web page.</p>

<p>If you need to calculate the bounding box from a point and radius, you can do that:</p>

<pre class="code"><span class='bounds identifier id'>bounds</span><span class='assign token'>=</span><span class='Bounds constant id'>Bounds</span><span class='dot token'>.</span><span class='from_point_and_radius identifier id'>from_point_and_radius</span><span class='lparen token'>(</span><span class='home identifier id'>home</span><span class='comma token'>,</span><span class='integer val'>5</span><span class='rparen token'>)</span>
<span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:bounds=</span><span class='gt op'>&gt;</span><span class='bounds identifier id'>bounds</span>
</pre>

<h2>USING INCLUDES</h2>

<p>You can use includes along with your distance finders:</p>

<pre class="code"><span class='stores identifier id'>stores</span><span class='assign token'>=</span><span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin=</span><span class='gt op'>&gt;</span><span class='home identifier id'>home</span><span class='comma token'>,</span> <span class='symbol val'>:include=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:reviews</span><span class='comma token'>,</span><span class='symbol val'>:cities</span><span class='rbrack token'>]</span> <span class='symbol val'>:within=</span><span class='gt op'>&gt;</span><span class='integer val'>5</span><span class='comma token'>,</span> <span class='symbol val'>:order=</span><span class='gt op'>&gt;</span><span class='string val'>'distance'</span>
</pre>

<p><em>However</em>, ActiveRecord drops the calculated distance column when you use include. So, if you need to
use the distance column, you'll have to re-calculate it post-query in Ruby:</p>

<pre class="code"><span class='stores identifier id'>stores</span><span class='dot token'>.</span><span class='sort_by_distance_from identifier id'>sort_by_distance_from</span><span class='lparen token'>(</span><span class='home identifier id'>home</span><span class='rparen token'>)</span>
</pre>

<p>In this case, you may want to just use the bounding box
condition alone in your SQL (there's no use calculating the distance twice):</p>

<pre class="code"><span class='bounds identifier id'>bounds</span><span class='assign token'>=</span><span class='Bounds constant id'>Bounds</span><span class='dot token'>.</span><span class='from_point_and_radius identifier id'>from_point_and_radius</span><span class='lparen token'>(</span><span class='home identifier id'>home</span><span class='comma token'>,</span><span class='integer val'>5</span><span class='rparen token'>)</span>
<span class='stores identifier id'>stores</span><span class='assign token'>=</span><span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:include=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:reviews</span><span class='comma token'>,</span><span class='symbol val'>:cities</span><span class='rbrack token'>]</span> <span class='symbol val'>:bounds=</span><span class='gt op'>&gt;</span><span class='bounds identifier id'>bounds</span>
<span class='stores identifier id'>stores</span><span class='dot token'>.</span><span class='sort_by_distance_from identifier id'>sort_by_distance_from</span><span class='lparen token'>(</span><span class='home identifier id'>home</span><span class='rparen token'>)</span>
</pre>

<h2>USING :through</h2>

<p>You can also specify a model as mappable "through" another associated model.<br/>
In other words, that associated model is the actual mappable model with
"lat" and "lng" attributes, but this "through" model can still utilize
all of the above find methods to search for records.</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Location constant id'>Location</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:locatable</span><span class='comma token'>,</span> <span class='symbol val'>:polymorphic</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span>
<span class='end end kw'>end</span>

<span class='class class kw'>class</span> <span class='Company constant id'>Company</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='has_one identifier id'>has_one</span> <span class='symbol val'>:location</span><span class='comma token'>,</span> <span class='symbol val'>:as</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:locatable</span>  <span class='comment val'># also works for belongs_to associations</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span> <span class='symbol val'>:through</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:location</span>
<span class='end end kw'>end</span>
</pre>

<p>Then you can still call:</p>

<pre class="code"><span class='Company constant id'>Company</span><span class='dot token'>.</span><span class='find_within identifier id'>find_within</span><span class='lparen token'>(</span><span class='distance identifier id'>distance</span><span class='comma token'>,</span> <span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@somewhere ivar id'>@somewhere</span><span class='rparen token'>)</span>
</pre>

<p>You can also give :through a hash if you location is nested deep. For example, given:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='House constant id'>House</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span>
<span class='end end kw'>end</span>

<span class='class class kw'>class</span> <span class='Family constant id'>Family</span>
  <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:house</span>
<span class='end end kw'>end</span>

<span class='class class kw'>class</span> <span class='Person constant id'>Person</span>
  <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:family</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span> <span class='symbol val'>:through</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:family</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:house</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>

<p>Remember that the notes above about USING INCLUDES apply to the results from
this find, since an include is automatically used.</p>

<h2>IP GEOCODING</h2>

<p>You can obtain the location for an IP at any time using the geocoder
as in the following example:</p>

<pre class="code"><span class='location identifier id'>location</span> <span class='assign token'>=</span> <span class='IpGeocoder constant id'>IpGeocoder</span><span class='dot token'>.</span><span class='geocode identifier id'>geocode</span><span class='lparen token'>(</span><span class='string val'>'12.215.42.19'</span><span class='rparen token'>)</span>
</pre>

<p>where Location is a GeoLoc instance containing the latitude,
longitude, city, state, and country code.  Also, the success
value is true.</p>

<p>If the IP cannot be geocoded, a GeoLoc instance is returned with a
success value of false.<br/>
</p>

<p>It should be noted that the IP address needs to be visible to the
Rails application.  In other words, you need to ensure that the
requesting IP address is forwarded by any front-end servers that
are out in front of the Rails app.  Otherwise, the IP will always
be that of the front-end server.</p>

<p>The Multi-Geocoder will also geocode IP addresses and provide
failover among multiple IP geocoders. Just pass in an IP address for the
parameter instead of a street address. Eg:</p>

<pre class="code"><span class='location identifier id'>location</span> <span class='assign token'>=</span> <span class='Geocoders constant id'>Geocoders</span><span class='colon2 op'>::</span><span class='MultiGeocoder constant id'>MultiGeocoder</span><span class='dot token'>.</span><span class='geocode identifier id'>geocode</span><span class='lparen token'>(</span><span class='string val'>'12.215.42.19'</span><span class='rparen token'>)</span>
</pre>

<p>The MultiGeocoder class requires 2 configuration setting for the provider order.
Ordering is done through <code>Geokit::Geocoders::provider_order</code> and
<code>Geokit::Geocoders::ip_provider_order</code>, found in
<code>config/initializers/geokit_config.rb</code>. If you don't already have a
<code>geokit_config.rb</code> file, the plugin creates one when it is first installed.</p>

<h2>IP GEOCODING HELPER</h2>

<p>A class method called geocode_ip_address has been mixed into the
ActionController::Base.  This enables before_filter style lookup of
the IP address.  Since it is a filter, it can accept any of the
available filter options.</p>

<p>Usage is as below:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='LocationAwareController constant id'>LocationAwareController</span> <span class='lt op'>&lt;</span> <span class='ActionController constant id'>ActionController</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='geocode_ip_address identifier id'>geocode_ip_address</span>
<span class='end end kw'>end</span>
</pre>

<p>A first-time lookup will result in the GeoLoc class being stored
in the session as <code>:geo_location</code> as well as in a cookie called
<code>:geo_session</code>.  Subsequent lookups will use the session value if it
exists or the cookie value if it doesn't exist.  The last resort is
to make a call to the web service.  Clients are free to manage the
cookie as they wish.</p>

<p>The intent of this feature is to be able to provide a good guess as
to a new visitor's location.</p>

<h2>INTEGRATED FIND AND GEOCODING</h2>

<p>Geocoding has been integrated with the finders enabling you to pass
a physical address or an IP address.  This would look the following:</p>

<pre class="code"><span class='Location constant id'>Location</span><span class='dot token'>.</span><span class='find_farthest identifier id'>find_farthest</span><span class='lparen token'>(</span><span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'217.15.10.9'</span><span class='rparen token'>)</span>
<span class='Location constant id'>Location</span><span class='dot token'>.</span><span class='find_farthest identifier id'>find_farthest</span><span class='lparen token'>(</span><span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Irving, TX'</span><span class='rparen token'>)</span>
</pre>

<p>where the IP or physical address would be geocoded to a location and
then the resulting latitude and longitude coordinates would be used
in the find.  This is not expected to be common usage, but it can be
done nevertheless.</p>

<h2>ADDRESS GEOCODING</h2>

<p>Geocoding is provided by the Geokit gem, which is required for this plugin.
See the top of this file for instructions on installing the Geokit gem.</p>

<p>Geokit can geocode addresses using multiple geocodeing web services.
Geokit supports services like Google, Yahoo, and Geocoder.us, and more --
see the Geokit gem API for a complete list.</p>

<p>These geocoder services are made available through the following classes:
GoogleGeocoder, YahooGeocoder, UsGeocoder, CaGeocoder, and GeonamesGeocoder.
Further, an additional geocoder class called MultiGeocoder incorporates an ordered failover
sequence to increase the probability of successful geocoding.</p>

<p>All classes are called using the following signature:</p>

<pre class="code"><span class='include identifier id'>include</span> <span class='Geokit constant id'>Geokit</span><span class='colon2 op'>::</span><span class='Geocoders constant id'>Geocoders</span>
<span class='location identifier id'>location</span> <span class='assign token'>=</span> <span class='XxxGeocoder constant id'>XxxGeocoder</span><span class='dot token'>.</span><span class='geocode identifier id'>geocode</span><span class='lparen token'>(</span><span class='address identifier id'>address</span><span class='rparen token'>)</span>
</pre>

<p>where you replace Xxx Geocoder with the appropriate class.  A GeoLoc
instance is the result of the call.  This class has a "success"
attribute which will be true if a successful geocoding occurred.<br/>
If successful, the lat and lng properties will be populated.</p>

<p>Geocoders are named with the convention NameGeocoder.  This
naming convention enables Geocoder to auto-detect its sub-classes
in order to create methods called <code>name_geocoder(address)</code> so that
all geocoders can be called through the base class.  This is done
purely for convenience; the individual geocoder classes are expected
to be used independently.</p>

<p>The MultiGeocoder class requires the configuration of a provider
order which dictates what order to use the various geocoders.  Ordering
is done through <code>Geokit::Geocoders::provider_order</code>, found in
<code>config/initializers/geokit_config.rb</code>.</p>

<p>If you don't already have a <code>geokit_config.rb</code> file, the plugin creates one
when it is first installed.</p>

<p>Make sure your failover configuration matches the usage characteristics
of your application -- for example, if you routinely get bogus input to
geocode, your code will be much slower if you have to failover among
multiple geocoders before determining that the input was in fact bogus.</p>

<p>The Geocoder.geocode method returns a GeoLoc object. Basic usage:</p>

<pre class="code"><span class='loc identifier id'>loc</span><span class='assign token'>=</span><span class='Geocoder constant id'>Geocoder</span><span class='dot token'>.</span><span class='geocode identifier id'>geocode</span><span class='lparen token'>(</span><span class='string val'>'100 Spear St, San Francisco, CA'</span><span class='rparen token'>)</span>
<span class='if if kw'>if</span> <span class='loc identifier id'>loc</span><span class='dot token'>.</span><span class='success identifier id'>success</span>
  <span class='puts identifier id'>puts</span> <span class='loc identifier id'>loc</span><span class='dot token'>.</span><span class='lat identifier id'>lat</span>
  <span class='puts identifier id'>puts</span> <span class='loc identifier id'>loc</span><span class='dot token'>.</span><span class='lng identifier id'>lng</span>
  <span class='puts identifier id'>puts</span> <span class='loc identifier id'>loc</span><span class='dot token'>.</span><span class='full_address identifier id'>full_address</span>
<span class='end end kw'>end</span>
</pre>

<h2>REVERSE GEOCODING</h2>

<p>Currently, only the Google Geocoder supports reverse geocoding.
Pass the lat/lng as a string, array or LatLng instance:</p>

<pre class="code">    <span class='res identifier id'>res</span><span class='assign token'>=</span><span class='Geokit constant id'>Geokit</span><span class='colon2 op'>::</span><span class='Geocoders constant id'>Geocoders</span><span class='colon2 op'>::</span><span class='GoogleGeocoder constant id'>GoogleGeocoder</span><span class='dot token'>.</span><span class='reverse_geocode identifier id'>reverse_geocode</span> <span class='string val'>&quot;37.791821,-122.394679&quot;</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='comment val'>#&lt;Geokit::GeoLoc:0x558ed0 ...</span>
    <span class='res identifier id'>res</span><span class='dot token'>.</span><span class='full_address identifier id'>full_address</span>
    <span class='string val'>&quot;101-115 Main St, San Francisco, CA 94105, USA&quot;</span>
</pre>

<p>The address will usually appear as a range, as it does in the above example.</p>

<h2>INTEGRATED FIND WITH ADDRESS GEOCODING</h2>

<p>Just has you can pass an IP address directly into an ActiveRecord finder
as the origin, you can also pass a physical address as the origin:</p>

<pre class="code"><span class='Location constant id'>Location</span><span class='dot token'>.</span><span class='find_closest identifier id'>find_closest</span><span class='lparen token'>(</span><span class='symbol val'>:origin</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'100 Spear st, San Francisco, CA'</span><span class='rparen token'>)</span>
</pre>

<p>where the physical address would be geocoded to a location and then the
resulting latitude and longitude coordinates would be used in the
find.</p>

<p>Note that if the address fails to geocode, the find method will raise an
ActiveRecord::GeocodeError you must be prepared to catch. Alternatively,
You can geocoder the address beforehand, and pass the resulting lat/lng
into the finder if successful.</p>

<h2>Auto Geocoding</h2>

<p>If your geocoding needs are simple, you can tell your model to automatically
geocode itself on create:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Store constant id'>Store</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span> <span class='symbol val'>:auto_geocode=</span><span class='gt op'>&gt;</span><span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>

<p>It takes two optional params:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Store constant id'>Store</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span> <span class='symbol val'>:auto_geocode=</span><span class='gt op'>&gt;</span><span class='lbrace token'>{</span><span class='symbol val'>:field=</span><span class='gt op'>&gt;</span><span class='symbol val'>:address</span><span class='comma token'>,</span> <span class='symbol val'>:error_message=</span><span class='gt op'>&gt;</span><span class='string val'>'Could not geocode address'</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>

<p>. . . which is equivilent to:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Store constant id'>Store</span> <span class='lshft op'>&lt;&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='acts_as_mappable identifier id'>acts_as_mappable</span>
  <span class='before_validation_on_create identifier id'>before_validation_on_create</span> <span class='symbol val'>:geocode_address</span>

  <span class='private identifier id'>private</span>
  <span class='def def kw'>def</span> <span class='geocode_address identifier id'>geocode_address</span>
    <span class='geo identifier id'>geo</span><span class='assign token'>=</span><span class='Geokit constant id'>Geokit</span><span class='colon2 op'>::</span><span class='Geocoders constant id'>Geocoders</span><span class='colon2 op'>::</span><span class='MultiGeocoder constant id'>MultiGeocoder</span><span class='dot token'>.</span><span class='geocode identifier id'>geocode</span> <span class='lparen token'>(</span><span class='address identifier id'>address</span><span class='rparen token'>)</span>
    <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='symbol val'>:address</span><span class='comma token'>,</span> <span class='string val'>&quot;Could not Geocode address&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='geo identifier id'>geo</span><span class='dot token'>.</span><span class='success identifier id'>success</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='lat identifier id'>lat</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='lng identifier id'>lng</span> <span class='assign token'>=</span> <span class='geo identifier id'>geo</span><span class='dot token'>.</span><span class='lat identifier id'>lat</span><span class='comma token'>,</span><span class='geo identifier id'>geo</span><span class='dot token'>.</span><span class='lng identifier id'>lng</span> <span class='if if_mod kw'>if</span> <span class='geo identifier id'>geo</span><span class='dot token'>.</span><span class='success identifier id'>success</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>

<p>If you need any more complicated geocoding behavior for your model, you should roll your own
<code>before_validate</code> callback.</p>

<h2>Distances, headings, endpoints, and midpoints</h2>

<pre class="code"><span class='distance identifier id'>distance</span><span class='assign token'>=</span><span class='home identifier id'>home</span><span class='dot token'>.</span><span class='distance_from identifier id'>distance_from</span><span class='lparen token'>(</span><span class='work identifier id'>work</span><span class='comma token'>,</span> <span class='symbol val'>:units=</span><span class='gt op'>&gt;</span><span class='symbol val'>:miles</span><span class='rparen token'>)</span>
<span class='heading identifier id'>heading</span><span class='assign token'>=</span><span class='home identifier id'>home</span><span class='dot token'>.</span><span class='heading_to identifier id'>heading_to</span><span class='lparen token'>(</span><span class='work identifier id'>work</span><span class='rparen token'>)</span> <span class='comment val'># result is in degrees, 0 is north</span>
<span class='endpoint identifier id'>endpoint</span><span class='assign token'>=</span><span class='home identifier id'>home</span><span class='dot token'>.</span><span class='endpoint identifier id'>endpoint</span><span class='lparen token'>(</span><span class='integer val'>90</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rparen token'>)</span>  <span class='comment val'># two miles due east</span>
<span class='midpoing identifier id'>midpoing</span><span class='assign token'>=</span><span class='home identifier id'>home</span><span class='dot token'>.</span><span class='midpoint_to identifier id'>midpoint_to</span><span class='lparen token'>(</span><span class='work identifier id'>work</span><span class='rparen token'>)</span>
</pre>

<h2>Cool stuff you can do with bounds</h2>

<pre class="code"><span class='bounds identifier id'>bounds</span><span class='assign token'>=</span><span class='Bounds constant id'>Bounds</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='sw_point identifier id'>sw_point</span><span class='comma token'>,</span><span class='ne_point identifier id'>ne_point</span><span class='rparen token'>)</span>
<span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='contains? fid id'>contains?</span><span class='lparen token'>(</span><span class='home identifier id'>home</span><span class='rparen token'>)</span>
<span class='puts identifier id'>puts</span> <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='center identifier id'>center</span>
</pre>

<h1>HOW TO . . .</h1>

<p>A few quick examples to get you started ....</p>

<h2>How to install the Geokit Rails plugin</h2>

<p>(See the very top of this file)</p>

<h2>How to find all stores within a 10-mile radius of a given lat/lng</h2>

<ol>
<li><p>ensure your stores table has lat and lng columns with numeric or float
datatypes to store your latitude/longitude</p></li>
<li><p>use <code>acts_as_mappable</code> on your store model:</p>

<p>class Store &lt; ActiveRecord::Base
   acts_as_mappable
   ...
end</p></li>
<li><p>finders now have extra capabilities:</p>

<p>Store.find(:all, :origin =>[32.951613,-96.958444], :within=>10)</p></li>
</ol>


<h2>How to geocode an address</h2>

<ol>
<li><p>configure your geocoder key(s) in <code>config/initializers/geokit_config.rb</code></p></li>
<li><p>also in <code>geokit_config.rb</code>, make sure that <code>Geokit::Geocoders::provider_order</code> reflects the
geocoder(s). If you only want to use one geocoder, there should
be only one symbol in the array. For example:</p>

<p>Geokit::Geocoders::provider_order=[:google]</p></li>
<li><p>Test it out in script/console</p>

<p>include Geokit::Geocoders
res = MultiGeocoder.geocode('100 Spear St, San Francisco, CA')
puts res.lat
puts res.lng
puts res.full_address
... etc. The return type is GeoLoc, see the API for
all the methods you can call on it.</p></li>
</ol>


<h2>How to find all stores within 10 miles of a given address</h2>

<ol>
<li><p>as above, ensure your table has the lat/lng columns, and you've
applied <code>acts_as_mappable</code> to the Store model.</p></li>
<li><p>configure and test out your geocoder, as above</p></li>
<li><p>pass the address in under the :origin key</p>

<pre class="code"><span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin=</span><span class='gt op'>&gt;</span><span class='string val'>'100 Spear st, San Francisco, CA'</span><span class='comma token'>,</span> 
           <span class='symbol val'>:within=</span><span class='gt op'>&gt;</span><span class='integer val'>10</span><span class='rparen token'>)</span>
</pre></li>
<li><p>you can also use a zipcode, or anything else that's geocodable:</p>

<pre class="code"><span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin=</span><span class='gt op'>&gt;</span><span class='string val'>'94117'</span><span class='comma token'>,</span> 
           <span class='symbol val'>:conditions=</span><span class='gt op'>&gt;</span><span class='string val'>'distance&lt;10'</span><span class='rparen token'>)</span>
</pre></li>
</ol>


<h2>How to sort a query by distance from an origin</h2>

<p>You now have access to a 'distance' column, and you can use it
as you would any other column. For example:</p>

<pre class="code">    <span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='symbol val'>:origin=</span><span class='gt op'>&gt;</span><span class='string val'>'94117'</span><span class='comma token'>,</span> <span class='symbol val'>:order=</span><span class='gt op'>&gt;</span><span class='string val'>'distance'</span><span class='rparen token'>)</span>
</pre>

<h2>How to elements of an array according to distance from a common point</h2>

<p>Usually, you can do your sorting in the database as part of your find call.
If you need to sort things post-query, you can do so:</p>

<pre class="code"><span class='stores identifier id'>stores</span><span class='assign token'>=</span><span class='Store constant id'>Store</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='symbol val'>:all</span>
<span class='stores identifier id'>stores</span><span class='dot token'>.</span><span class='sort_by_distance_from identifier id'>sort_by_distance_from</span><span class='lparen token'>(</span><span class='home identifier id'>home</span><span class='rparen token'>)</span>
<span class='puts identifier id'>puts</span> <span class='stores identifier id'>stores</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='distance identifier id'>distance</span>
</pre>

<p>Obviously, each of the items in the array must have a latitude/longitude so
they can be sorted by distance.</p>

<h2>Database Compatability</h2>

<ul>
<li>Geokit works with MySQL (tested with version 5.0.41) or PostgreSQL (tested with version 8.2.6)</li>
<li>Geokit does <em>not</em> work with SQLite, as it lacks the necessary geometry functions.</li>
<li>Geokit is known to <em>not</em> work with Postgres versions under 8.1 -- it uses the least() funciton.</li>
</ul>


<h2>HIGH-LEVEL NOTES ON WHAT'S WHERE</h2>

<p><code>acts_as_mappable.rb</code>, as you'd expect, contains the ActsAsMappable
module which gets mixed into your models to provide the
location-based finder goodness.</p>

<p><code>ip_geocode_lookup.rb</code> contains the before_filter helper method which
enables auto lookup of the requesting IP address.</p>

<h3>The Geokit gem provides the building blocks of distance-based operations:</h3>

<p>The Mappable module, which provides basic
distance calculation methods, i.e., calculating the distance
between two points.</p>

<p>The LatLng class  is a simple container for latitude and longitude, but
it's made more powerful by mixing in the above-mentioned Mappable
module -- therefore, you can calculate easily the distance between two
LatLng ojbects with <code>distance = first.distance_to(other)</code></p>

<p>GeoLoc represents an address or location which
has been geocoded. You can get the city, zipcode, street address, etc.
from a GeoLoc object. GeoLoc extends LatLng, so you also get lat/lng
AND the Mappable modeule goodness for free.</p>

<h2>GOOGLE GROUP</h2>

<p>Follow the Google Group for updates and discussion on Geokit: http://groups.google.com/group/geokit</p>

<h2>IMPORTANT POST-INSTALLATION NOTES:</h2>

<p><em>1. The configuration file</em>: Geokit for Rails uses a configuration file in config/initializers.
You <em>must</em> add your own keys for the various geocoding services if you want to use geocoding.
If you need to refer to the original template again, see the <code>assets/api_keys_template</code> file.</p>

<p><em>2. The gem dependency</em>: Geokit for Rails depends on the Geokit gem. Tell Rails about this
dependency in <code>config/environment.rb</code>, within the initializer block:
config.gem "geokit"</p>

<p><em>If you're having trouble with dependencies ....</em></p>

<p>Try installing the gem manually (sudo gem install geokit), then adding a <code>require 'geokit'</code> to the top of
<code>vendor/plugins/geokit-rails/init.rb</code> and/or <code>config/geokit_config.rb</code>.</p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>