<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>michael's dm-core - Class: DataMapper::Adapters::DataObjectsAdapter - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/michael/commits/dm-core/master" rel="alternate" title="Recent Commits to dm-core:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("michael", "dm-core", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("michael", "dm-core", "e1bd009dff9b6c1bfd91751e87b3989c1c7a1866", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/michael/dm-core/tree/">Source</a></li>
            <li class=""><a href="http://github.com/michael/dm-core/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/michael/dm-core/network">Network</a></li>            
            <li class=""><a href="http://github.com/michael/dm-core/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/michael/dm-core">Wiki</a></li>
            <li class=""><a href="http://github.com/michael/dm-core/graphs">Graphs</a></li>                    
            <li class="active"><a href="/michael/dm-core">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/michael">michael</a> / <b><a href="http://github.com/michael/dm-core/tree">dm-core</a></b>        
                <a id="namespaces_button" rel="michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class DataMapper_Adapters_DataObjectsAdapter">
  <h1>Class: DataMapper::Adapters::DataObjectsAdapter</h1>
  <div class="section inheritance">
  <ul>
  <li><a href="AbstractAdapter.html" title="DataMapper::Adapters::AbstractAdapter">DataMapper::Adapters::AbstractAdapter</a></li><ul><li>DataMapper::Adapters::DataObjectsAdapter</li>
  </ul></ul>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="DataObjectsAdapter/Chainable.html" title="DataMapper::Chainable">DataMapper::Chainable</a></p>
</div><div class="section docstring">
  <p>
DataObjectsAdapter is the base class for all adapers for relational
databases. If you want to add support for a new RDBMS, it makes sense to
make your adapter class inherit from this class.
</p>
<p>
By inheriting from DataObjectsAdapter, you get a copy of all the standard
sub-modules (Quoting, Coersion and Queries) in your own Adapter. You can
extend and overwrite these copies without affecting the originals.
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <p class="inherited_msg">
    This class inherits a constructor from <a href="AbstractAdapter.html#initialize-instance_method" title="DataMapper::Adapters::AbstractAdapter">DataMapper::Adapters::AbstractAdapter</a>.
  </p>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <div class="included">
  
  <div>
    <h2>Public Class Methods Included from <a href="DataObjectsAdapter/Chainable.html" title="DataMapper::Chainable">DataMapper::Chainable</a></h2>
    <p><span class='name'><a href="../Chainable.html#chainable-instance_method" title="chainable">chainable</a></span>, <span class='name'><a href="../Chainable.html#extendable-instance_method" title="extendable">extendable</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create-instance_method">#create</span><span class='args'>(resources)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
For each model instance in resources, issues an SQL INSERT (or equivalent)
statement to create a new record in the data store for the instance.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt>Integer</tt>
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#delete-instance_method">#delete</span><span class='args'>(collection)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Constructs and executes DELETE statement for given query.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt>Integer</tt>
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#execute-instance_method">#execute</span><span class='args'>(statement, *bind_values)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Database-specific method TODO: document.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#query-instance_method">#query</span><span class='args'>(statement, *bind_values)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO: document.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#read-instance_method">#read</span><span class='args'>(query)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Constructs and executes SELECT query, then instantiates one or many object
from result set.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt>Array</tt>
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#update-instance_method">#update</span><span class='args'>(attributes, collection)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Constructs and executes UPDATE statement for given attributes and a query.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt>Integer</tt>
              </span>
          </p>
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>create</h3>
</div><div id="create-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'><tt>Integer</tt></span>
    <span class='name'>create</span><span class='args'>(resources)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
For each model instance in resources, issues an SQL INSERT (or equivalent)
statement to create a new record in the data store for the instance
</p>
<p>
Note that this method does not update identity map. A plugin needs to use
adapter directly, it is up to plugin developer to keep identity map up to
date.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    
      <dt>
        <span class='type'>[<tt>Enumerable(Resource)</tt>]</span>
        <span class='name'>resources</span>
        
      </dt>
      <dd>
        <span class='desc'><p>
The list of resources (model instances) to create
</p>
</span>
      </dd>
    
  
  </dl>
</div><div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>Integer</tt>]</span>
      
      
        <span class='name'></span>
      
      
    </dt>
    <dd>
      <span class='desc'><p>
The number of records that were actually saved into the database
</p>
</span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dm-core/adapters/data_objects_adapter.rb', line 31</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866/lib/dm-core/adapters/data_objects_adapter.rb#L31">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='resources identifier id'>resources</span><span class='rparen token'>)</span>
  <span class='resources identifier id'>resources</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='resource identifier id'>resource</span><span class='bitor op'>|</span>
    <span class='model identifier id'>model</span>          <span class='assign token'>=</span> <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='model identifier id'>model</span>
    <span class='identity_field identifier id'>identity_field</span> <span class='assign token'>=</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='identity_field identifier id'>identity_field</span>
    <span class='attributes identifier id'>attributes</span>     <span class='assign token'>=</span> <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='dirty_attributes identifier id'>dirty_attributes</span>

    <span class='properties identifier id'>properties</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

    <span class='comment val'># make the order of the properties consistent</span>
    <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='bitor op'>|</span>
      <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='key? fid id'>key?</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='rparen token'>)</span>

      <span class='bind_value identifier id'>bind_value</span> <span class='assign token'>=</span> <span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='property identifier id'>property</span><span class='rbrack token'>]</span>

      <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='eql? fid id'>eql?</span><span class='lparen token'>(</span><span class='identity_field identifier id'>identity_field</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='bind_value identifier id'>bind_value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

      <span class='properties identifier id'>properties</span>  <span class='lshft op'>&lt;&lt;</span> <span class='property identifier id'>property</span>
      <span class='bind_values identifier id'>bind_values</span> <span class='lshft op'>&lt;&lt;</span> <span class='bind_value identifier id'>bind_value</span>
    <span class='end end kw'>end</span>

    <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='insert_statement identifier id'>insert_statement</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='comma token'>,</span> <span class='properties identifier id'>properties</span><span class='comma token'>,</span> <span class='identity_field identifier id'>identity_field</span><span class='rparen token'>)</span>
    <span class='result identifier id'>result</span>    <span class='assign token'>=</span> <span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
      <span class='if if kw'>if</span> <span class='identity_field identifier id'>identity_field</span>
        <span class='identity_field identifier id'>identity_field</span><span class='dot token'>.</span><span class='set! fid id'>set!</span><span class='lparen token'>(</span><span class='resource identifier id'>resource</span><span class='comma token'>,</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='insert_id identifier id'>insert_id</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>delete</h3>
</div><div id="delete-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'><tt>Integer</tt></span>
    <span class='name'>delete</span><span class='args'>(collection)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Constructs and executes DELETE statement for given query
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    
      <dt>
        <span class='type'>[<tt><a href="../Collection.html" title="Collection">Collection</a></tt>]</span>
        <span class='name'>collection</span>
        
      </dt>
      <dd>
        <span class='desc'><p>
collection of records to be deleted
</p>
</span>
      </dd>
    
  
  </dl>
</div><div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>Integer</tt>]</span>
      
      
        <span class='name'></span>
      
      
    </dt>
    <dd>
      <span class='desc'><p>
the number of records deleted
</p>
</span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dm-core/adapters/data_objects_adapter.rb', line 143</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866/lib/dm-core/adapters/data_objects_adapter.rb#L143">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">143
144
145
146
147
148
149
150
151</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='collection identifier id'>collection</span><span class='rparen token'>)</span>
  <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='collection identifier id'>collection</span><span class='dot token'>.</span><span class='query identifier id'>query</span>

  <span class='comment val'># TODO: if the query contains any links, a limit or an offset</span>
  <span class='comment val'># use a subselect to get the rows to be deleted</span>

  <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='delete_statement identifier id'>delete_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>execute</h3>
</div><div id="execute-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>execute</span><span class='args'>(statement, *bind_values)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Database-specific method TODO: document
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dm-core/adapters/data_objects_adapter.rb', line 156</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866/lib/dm-core/adapters/data_objects_adapter.rb#L156">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">156
157
158
159
160
161</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span>
  <span class='with_connection identifier id'>with_connection</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='connection identifier id'>connection</span><span class='bitor op'>|</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='create_command identifier id'>create_command</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='rparen token'>)</span>
    <span class='command identifier id'>command</span><span class='dot token'>.</span><span class='execute_non_query identifier id'>execute_non_query</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>query</h3>
</div><div id="query-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>query</span><span class='args'>(statement, *bind_values)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO: document
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dm-core/adapters/data_objects_adapter.rb', line 165</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866/lib/dm-core/adapters/data_objects_adapter.rb#L165">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span>
      <span class='with_connection identifier id'>with_connection</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='connection identifier id'>connection</span><span class='bitor op'>|</span>
        <span class='begin begin kw'>begin</span>
          <span class='reader identifier id'>reader</span> <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='create_command identifier id'>create_command</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='execute_reader identifier id'>execute_reader</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span>

          <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

          <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='fields identifier id'>fields</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
            <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='Extlib constant id'>Extlib</span><span class='colon2 op'>::</span><span class='Inflection constant id'>Inflection</span><span class='dot token'>.</span><span class='underscore identifier id'>underscore</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='rbrace token'>}</span>
            <span class='struct identifier id'>struct</span> <span class='assign token'>=</span> <span class='Struct constant id'>Struct</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='fields identifier id'>fields</span><span class='rparen token'>)</span>

            <span class='while while kw'>while</span><span class='lparen token'>(</span><span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='next! fid id'>next!</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
              <span class='results identifier id'>results</span> <span class='lshft op'>&lt;&lt;</span> <span class='struct identifier id'>struct</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='else else kw'>else</span>
            <span class='while while kw'>while</span><span class='lparen token'>(</span><span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='next! fid id'>next!</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
              <span class='results identifier id'>results</span> <span class='lshft op'>&lt;&lt;</span> <span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>

          <span class='results identifier id'>results</span>
        <span class='ensure ensure kw'>ensure</span>
          <span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='reader identifier id'>reader</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='protected identifier id'>protected</span>

    <span class='comment val'># TODO: document</span>
    <span class='comment val'># @api private</span>
    <span class='def def kw'>def</span> <span class='normalized_uri identifier id'>normalized_uri</span>
      <span class='@normalized_uri ivar id'>@normalized_uri</span> <span class='opasgn op'>||=</span>
        <span class='begin begin kw'>begin</span>
          <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='@options ivar id'>@options</span><span class='dot token'>.</span><span class='except identifier id'>except</span><span class='lparen token'>(</span><span class='symbol val'>:adapter</span><span class='comma token'>,</span> <span class='symbol val'>:user</span><span class='comma token'>,</span> <span class='symbol val'>:password</span><span class='comma token'>,</span> <span class='symbol val'>:host</span><span class='comma token'>,</span> <span class='symbol val'>:port</span><span class='comma token'>,</span> <span class='symbol val'>:path</span><span class='comma token'>,</span> <span class='symbol val'>:fragment</span><span class='comma token'>,</span> <span class='symbol val'>:scheme</span><span class='comma token'>,</span> <span class='symbol val'>:query</span><span class='rparen token'>)</span>
          <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

          <span class='DataObjects constant id'>DataObjects</span><span class='colon2 op'>::</span><span class='URI constant id'>URI</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
            <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:adapter</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:user</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:path</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:database</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='query identifier id'>query</span><span class='comma token'>,</span>
            <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:fragment</span><span class='rbrack token'>]</span>
          <span class='rparen token'>)</span><span class='dot token'>.</span><span class='freeze identifier id'>freeze</span>
        <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='chainable identifier id'>chainable</span> <span class='do do kw'>do</span>
      <span class='protected identifier id'>protected</span>

      <span class='comment val'># Instantiates new connection object</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api semipublic</span>
      <span class='def def kw'>def</span> <span class='create_connection identifier id'>create_connection</span>
        <span class='comment val'># DataObjects::Connection.new(uri) will give you back the right</span>
        <span class='comment val'># driver based on the DataObjects::URI#scheme</span>
        <span class='DataObjects constant id'>DataObjects</span><span class='colon2 op'>::</span><span class='Connection constant id'>Connection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='normalized_uri identifier id'>normalized_uri</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Takes connection and closes it</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api semipublic</span>
      <span class='def def kw'>def</span> <span class='close_connection identifier id'>close_connection</span><span class='lparen token'>(</span><span class='connection identifier id'>connection</span><span class='rparen token'>)</span>
        <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='private identifier id'>private</span>

    <span class='comment val'># TODO: document</span>
    <span class='comment val'># @api public</span>
    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='uri_or_options identifier id'>uri_or_options</span><span class='rparen token'>)</span>
      <span class='super super kw'>super</span>

      <span class='comment val'># Default the driver-specific logger to DataMapper's logger</span>
      <span class='if if kw'>if</span> <span class='driver_module identifier id'>driver_module</span> <span class='assign token'>=</span> <span class='DataObjects constant id'>DataObjects</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='normalized_uri identifier id'>normalized_uri</span><span class='dot token'>.</span><span class='scheme identifier id'>scheme</span><span class='dot token'>.</span><span class='capitalize identifier id'>capitalize</span><span class='rparen token'>)</span>
        <span class='driver_module identifier id'>driver_module</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span> <span class='assign token'>=</span> <span class='DataMapper constant id'>DataMapper</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span> <span class='if if_mod kw'>if</span> <span class='driver_module identifier id'>driver_module</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:logger=</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># TODO: document</span>
    <span class='comment val'># @api private</span>
    <span class='def def kw'>def</span> <span class='with_connection identifier id'>with_connection</span>
      <span class='begin begin kw'>begin</span>
        <span class='connection identifier id'>connection</span> <span class='assign token'>=</span> <span class='create_connection identifier id'>create_connection</span>
        <span class='return return kw'>return</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='connection identifier id'>connection</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
        <span class='DataMapper constant id'>DataMapper</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='error identifier id'>error</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
        <span class='raise identifier id'>raise</span> <span class='e identifier id'>e</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='close_connection identifier id'>close_connection</span><span class='lparen token'>(</span><span class='connection identifier id'>connection</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='connection identifier id'>connection</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># This module is just for organization. The methods are included into the</span>
    <span class='comment val'># Adapter below.</span>
    <span class='module module kw'>module</span> <span class='SQL constant id'>SQL</span> <span class='comment val'>#:nodoc:</span>
      <span class='IDENTIFIER_MAX_LENGTH constant id'>IDENTIFIER_MAX_LENGTH</span> <span class='assign token'>=</span> <span class='integer val'>128</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api semipublic</span>
      <span class='def def kw'>def</span> <span class='property_to_column_name identifier id'>property_to_column_name</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='qualify identifier id'>qualify</span>
          <span class='table_name identifier id'>table_name</span> <span class='assign token'>=</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='model identifier id'>model</span><span class='dot token'>.</span><span class='storage_name identifier id'>storage_name</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
          <span class='dstring node'>&quot;#{quote_name(table_name)}.#{quote_name(property.field)}&quot;</span>
        <span class='else else kw'>else</span>
          <span class='quote_name identifier id'>quote_name</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='field identifier id'>field</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='private identifier id'>private</span>

      <span class='comment val'># Adapters requiring a RETURNING syntax for INSERT statements</span>
      <span class='comment val'># should overwrite this to return true.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='supports_returning? fid id'>supports_returning?</span>
        <span class='false false kw'>false</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Adapters that do not support the DEFAULT VALUES syntax for</span>
      <span class='comment val'># INSERT statements should overwrite this to return false.</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='supports_default_values? fid id'>supports_default_values?</span>
        <span class='true true kw'>true</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs SELECT statement for given query,</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] SELECT statement as a string</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='select_statement identifier id'>select_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
        <span class='model identifier id'>model</span>      <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='model identifier id'>model</span>
        <span class='fields identifier id'>fields</span>     <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='fields identifier id'>fields</span>
        <span class='conditions identifier id'>conditions</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='conditions identifier id'>conditions</span>
        <span class='limit identifier id'>limit</span>      <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='limit identifier id'>limit</span>
        <span class='offset identifier id'>offset</span>     <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='offset identifier id'>offset</span>
        <span class='order identifier id'>order</span>      <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='order identifier id'>order</span>
        <span class='group_by identifier id'>group_by</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

        <span class='comment val'># FIXME: using a boolean for qualify does not work in some cases,</span>
        <span class='comment val'># such as when you have a self-referrential many to many association.</span>
        <span class='comment val'># if you don't qualfiy the columns with a unique alias, then the</span>
        <span class='comment val'># SQL query will fail.  This may mean though, that it might not</span>
        <span class='comment val'># be enough to pass in a Property, but we may need to know the</span>
        <span class='comment val'># table and the alias we should use for the column.</span>

        <span class='qualify identifier id'>qualify</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='links identifier id'>links</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>

        <span class='if if kw'>if</span> <span class='qualify identifier id'>qualify</span> <span class='orop op'>||</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='unique? fid id'>unique?</span>
          <span class='group_by identifier id'>group_by</span> <span class='assign token'>=</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Property constant id'>Property</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
        <span class='end end kw'>end</span>

        <span class='unless unless kw'>unless</span> <span class='lparen token'>(</span><span class='limit identifier id'>limit</span> <span class='andop op'>&amp;&amp;</span> <span class='limit identifier id'>limit</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='offset identifier id'>offset</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='orop op'>||</span> <span class='qualify identifier id'>qualify</span>
          <span class='comment val'># TODO: move this method to Query, so that it walks the conditions</span>
          <span class='comment val'># and finds an OR operator</span>

          <span class='comment val'># TODO: handle cases where two or more properties need to be</span>
          <span class='comment val'># used together to be unique</span>

          <span class='comment val'># if a unique property is used, and there is no OR operator, then an ORDER</span>
          <span class='comment val'># and LIMIT are unecessary because it should only return a single row</span>
          <span class='if if kw'>if</span> <span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='AndOperation constant id'>AndOperation</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span>
             <span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='o identifier id'>o</span><span class='bitor op'>|</span> <span class='o identifier id'>o</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='EqualToComparison constant id'>EqualToComparison</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='o identifier id'>o</span><span class='dot token'>.</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='unique? fid id'>unique?</span> <span class='rbrace token'>}</span> <span class='andop op'>&amp;&amp;</span>
             <span class='notop op'>!</span><span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='o identifier id'>o</span><span class='bitor op'>|</span> <span class='o identifier id'>o</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='OrOperation constant id'>OrOperation</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
            <span class='order identifier id'>order</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
            <span class='limit identifier id'>limit</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>

        <span class='conditions_statement identifier id'>conditions_statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>

        <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;SELECT #{columns_statement(fields, qualify)}&quot;</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; FROM #{quote_name(model.storage_name(name))}&quot;</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='join_statement identifier id'>join_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>                      <span class='if if_mod kw'>if</span> <span class='qualify identifier id'>qualify</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; WHERE #{conditions_statement}&quot;</span>                    <span class='unless unless_mod kw'>unless</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; GROUP BY #{columns_statement(group_by, qualify)}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='group_by identifier id'>group_by</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; ORDER BY #{order_statement(order, qualify)}&quot;</span>      <span class='unless unless_mod kw'>unless</span> <span class='order identifier id'>order</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>

        <span class='if if kw'>if</span> <span class='limit identifier id'>limit</span>
          <span class='statement identifier id'>statement</span>   <span class='lshft op'>&lt;&lt;</span> <span class='string val'>' LIMIT ?'</span>
          <span class='bind_values identifier id'>bind_values</span> <span class='lshft op'>&lt;&lt;</span> <span class='limit identifier id'>limit</span>
        <span class='end end kw'>end</span>

        <span class='if if kw'>if</span> <span class='limit identifier id'>limit</span> <span class='andop op'>&amp;&amp;</span> <span class='offset identifier id'>offset</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
          <span class='statement identifier id'>statement</span>   <span class='lshft op'>&lt;&lt;</span> <span class='string val'>' OFFSET ?'</span>
          <span class='bind_values identifier id'>bind_values</span> <span class='lshft op'>&lt;&lt;</span> <span class='offset identifier id'>offset</span>
        <span class='end end kw'>end</span>

        <span class='return return kw'>return</span> <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs INSERT statement for given query,</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] INSERT statement as a string</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='insert_statement identifier id'>insert_statement</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='comma token'>,</span> <span class='properties identifier id'>properties</span><span class='comma token'>,</span> <span class='identity_field identifier id'>identity_field</span><span class='rparen token'>)</span>
        <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;INSERT INTO #{quote_name(model.storage_name(name))} &quot;</span>

        <span class='if if kw'>if</span> <span class='supports_default_values? fid id'>supports_default_values?</span> <span class='andop op'>&amp;&amp;</span> <span class='properties identifier id'>properties</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
          <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>'DEFAULT VALUES'</span>
        <span class='else else kw'>else</span>
          <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;(\#{properties.map { |p| quote_name(p.field) }.join(', ')})\nVALUES\n(\#{(['?'] * properties.size).join(', ')})\n&quot;</span><span class='dot token'>.</span><span class='compress_lines identifier id'>compress_lines</span>
        <span class='end end kw'>end</span>

        <span class='if if kw'>if</span> <span class='supports_returning? fid id'>supports_returning?</span> <span class='andop op'>&amp;&amp;</span> <span class='identity_field identifier id'>identity_field</span>
          <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; RETURNING #{quote_name(identity_field.field)}&quot;</span>
        <span class='end end kw'>end</span>

        <span class='statement identifier id'>statement</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs UPDATE statement for given query,</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] UPDATE statement as a string</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='update_statement identifier id'>update_statement</span><span class='lparen token'>(</span><span class='properties identifier id'>properties</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>
        <span class='conditions_statement identifier id'>conditions_statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='dot token'>.</span><span class='conditions identifier id'>conditions</span><span class='rparen token'>)</span>

        <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;UPDATE #{quote_name(query.model.storage_name(name))}&quot;</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; SET #{properties.map { |p| &quot;#{quote_name(p.field)} = ?&quot; }.join(', ')}&quot;</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; WHERE #{conditions_statement}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>

        <span class='return return kw'>return</span> <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs DELETE statement for given query,</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] DELETE statement as a string</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='delete_statement identifier id'>delete_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
        <span class='conditions_statement identifier id'>conditions_statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='dot token'>.</span><span class='conditions identifier id'>conditions</span><span class='rparen token'>)</span>

        <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;DELETE FROM #{quote_name(query.model.storage_name(name))}&quot;</span>
        <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; WHERE #{conditions_statement}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>

        <span class='return return kw'>return</span> <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs comma separated list of fields</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] list of fields as a string</span>
      <span class='def def kw'>def</span> <span class='columns_statement identifier id'>columns_statement</span><span class='lparen token'>(</span><span class='properties identifier id'>properties</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='properties identifier id'>properties</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span> <span class='property_to_column_name identifier id'>property_to_column_name</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>', '</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs joins clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] joins clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='join_statement identifier id'>join_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='previous_model identifier id'>previous_model</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='model identifier id'>model</span>

        <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='string val'>''</span>

        <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='links identifier id'>links</span><span class='dot token'>.</span><span class='reverse_each identifier id'>reverse_each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='relationship identifier id'>relationship</span><span class='bitor op'>|</span>
          <span class='model identifier id'>model</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='source_model identifier id'>source_model</span> <span class='eq op'>==</span> <span class='previous_model identifier id'>previous_model</span>
            <span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='target_model identifier id'>target_model</span>
          <span class='else else kw'>else</span>
            <span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='source_model identifier id'>source_model</span>
          <span class='end end kw'>end</span>

          <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; INNER JOIN #{quote_name(model.storage_name(name))} ON &quot;</span>
          <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='target_key identifier id'>target_key</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='source_key identifier id'>source_key</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='target_property identifier id'>target_property</span><span class='comma token'>,</span> <span class='source_property identifier id'>source_property</span><span class='bitor op'>|</span>
            <span class='dstring node'>&quot;#{property_to_column_name(target_property, qualify)} = #{property_to_column_name(source_property, qualify)}&quot;</span>
          <span class='end end kw'>end</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' AND '</span><span class='rparen token'>)</span>

          <span class='previous_model identifier id'>previous_model</span> <span class='assign token'>=</span> <span class='model identifier id'>model</span>
        <span class='end end kw'>end</span>

        <span class='statement identifier id'>statement</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs where clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] where clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
        <span class='case case kw'>case</span> <span class='conditions identifier id'>conditions</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='NotOperation constant id'>NotOperation</span>
            <span class='negate_operation identifier id'>negate_operation</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>

          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='AbstractOperation constant id'>AbstractOperation</span>
            <span class='comment val'># TODO: remove this once conditions can be compressed</span>
            <span class='if if kw'>if</span> <span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='operands identifier id'>operands</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
              <span class='comment val'># factor out operations with a single operand</span>
              <span class='conditions_statement identifier id'>conditions_statement</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='operands identifier id'>operands</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
            <span class='else else kw'>else</span>
              <span class='operation_statement identifier id'>operation_statement</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>

          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='AbstractComparison constant id'>AbstractComparison</span>
            <span class='comparison_statement identifier id'>comparison_statement</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>

          <span class='when when kw'>when</span> <span class='Array constant id'>Array</span>
            <span class='conditions identifier id'>conditions</span>  <span class='comment val'># handle raw conditions</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs order clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] order clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='order_statement identifier id'>order_statement</span><span class='lparen token'>(</span><span class='order identifier id'>order</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='statements identifier id'>statements</span> <span class='assign token'>=</span> <span class='order identifier id'>order</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='direction identifier id'>direction</span><span class='bitor op'>|</span>
          <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='property_to_column_name identifier id'>property_to_column_name</span><span class='lparen token'>(</span><span class='direction identifier id'>direction</span><span class='dot token'>.</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
          <span class='statement identifier id'>statement</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>' DESC'</span> <span class='if if_mod kw'>if</span> <span class='direction identifier id'>direction</span><span class='dot token'>.</span><span class='operator identifier id'>operator</span> <span class='eq op'>==</span> <span class='symbol val'>:desc</span>
          <span class='statement identifier id'>statement</span>
        <span class='end end kw'>end</span>

        <span class='statements identifier id'>statements</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>', '</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='negate_operation identifier id'>negate_operation</span><span class='lparen token'>(</span><span class='operation identifier id'>operation</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='@negated ivar id'>@negated</span> <span class='assign token'>=</span> <span class='notop op'>!</span><span class='@negated ivar id'>@negated</span>
        <span class='begin begin kw'>begin</span>
          <span class='conditions_statement identifier id'>conditions_statement</span><span class='lparen token'>(</span><span class='operation identifier id'>operation</span><span class='dot token'>.</span><span class='operands identifier id'>operands</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='ensure ensure kw'>ensure</span>
          <span class='@negated ivar id'>@negated</span> <span class='assign token'>=</span> <span class='notop op'>!</span><span class='@negated ivar id'>@negated</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='operation_statement identifier id'>operation_statement</span><span class='lparen token'>(</span><span class='operation identifier id'>operation</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='statements identifier id'>statements</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
        <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

        <span class='operation identifier id'>operation</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='operand identifier id'>operand</span><span class='bitor op'>|</span>
          <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='values identifier id'>values</span> <span class='assign token'>=</span> <span class='conditions_statement identifier id'>conditions_statement</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>

          <span class='if if kw'>if</span> <span class='operand identifier id'>operand</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:operands</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='operand identifier id'>operand</span><span class='dot token'>.</span><span class='operands identifier id'>operands</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
            <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;(#{statement})&quot;</span>
          <span class='end end kw'>end</span>

          <span class='statements identifier id'>statements</span> <span class='lshft op'>&lt;&lt;</span> <span class='statement identifier id'>statement</span>
          <span class='bind_values identifier id'>bind_values</span><span class='dot token'>.</span><span class='concat identifier id'>concat</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>

        <span class='join_with identifier id'>join_with</span> <span class='assign token'>=</span> <span class='operation identifier id'>operation</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='OrOperation constant id'>OrOperation</span> <span class='colon op'>:</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='AndOperation constant id'>AndOperation</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='string val'>'AND'</span> <span class='colon op'>:</span> <span class='string val'>'OR'</span>
        <span class='statement identifier id'>statement</span> <span class='assign token'>=</span> <span class='statements identifier id'>statements</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='dstring node'>&quot; #{join_with} &quot;</span><span class='rparen token'>)</span>

        <span class='return return kw'>return</span> <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Constructs comparison clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @return [String] comparison clause</span>
      <span class='comment val'>#</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='comparison_statement identifier id'>comparison_statement</span><span class='lparen token'>(</span><span class='comparison identifier id'>comparison</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='comparison identifier id'>comparison</span><span class='dot token'>.</span><span class='value identifier id'>value</span>

        <span class='comment val'># TODO: move exclusive Range handling into another method, and</span>
        <span class='comment val'># update conditions_statement to use it</span>

        <span class='comment val'># break exclusive Range queries up into two comparisons ANDed together</span>
        <span class='if if kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Range constant id'>Range</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='exclude_end? fid id'>exclude_end?</span>
          <span class='operation identifier id'>operation</span> <span class='assign token'>=</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='Operation constant id'>Operation</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:and</span><span class='comma token'>,</span>
            <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='Comparison constant id'>Comparison</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:gte</span><span class='comma token'>,</span> <span class='comparison identifier id'>comparison</span><span class='dot token'>.</span><span class='property identifier id'>property</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span><span class='comma token'>,</span>
            <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='Comparison constant id'>Comparison</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:lt</span><span class='comma token'>,</span>  <span class='comparison identifier id'>comparison</span><span class='dot token'>.</span><span class='property identifier id'>property</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='rparen token'>)</span>
          <span class='rparen token'>)</span>

          <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='operation_statement identifier id'>operation_statement</span><span class='lparen token'>(</span><span class='operation identifier id'>operation</span><span class='comma token'>,</span> <span class='qualify identifier id'>qualify</span><span class='rparen token'>)</span>

          <span class='return return kw'>return</span> <span class='dstring node'>&quot;(#{statement})&quot;</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span>
        <span class='end end kw'>end</span>

        <span class='operator identifier id'>operator</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='comparison identifier id'>comparison</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='EqualToComparison constant id'>EqualToComparison</span>              <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='inequality_operator identifier id'>inequality_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='equality_operator identifier id'>equality_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='InclusionComparison constant id'>InclusionComparison</span>            <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='exclude_operator identifier id'>exclude_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>    <span class='colon op'>:</span> <span class='include_operator identifier id'>include_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='RegexpComparison constant id'>RegexpComparison</span>               <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='not_regexp_operator identifier id'>not_regexp_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='regexp_operator identifier id'>regexp_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='LikeComparison constant id'>LikeComparison</span>                 <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='unlike_operator identifier id'>unlike_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>     <span class='colon op'>:</span> <span class='like_operator identifier id'>like_operator</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='GreaterThanComparison constant id'>GreaterThanComparison</span>          <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='string val'>'&lt;='</span>                       <span class='colon op'>:</span> <span class='string val'>'&gt;'</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='LessThanComparison constant id'>LessThanComparison</span>             <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='string val'>'&gt;='</span>                       <span class='colon op'>:</span> <span class='string val'>'&lt;'</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='GreaterThanOrEqualToComparison constant id'>GreaterThanOrEqualToComparison</span> <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='string val'>'&lt;'</span>                        <span class='colon op'>:</span> <span class='string val'>'&gt;='</span>
          <span class='when when kw'>when</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Conditions constant id'>Conditions</span><span class='colon2 op'>::</span><span class='LessThanOrEqualToComparison constant id'>LessThanOrEqualToComparison</span>    <span class='then then kw'>then</span> <span class='@negated ivar id'>@negated</span> <span class='question op'>?</span> <span class='string val'>'&gt;'</span>                        <span class='colon op'>:</span> <span class='string val'>'&lt;='</span>
        <span class='end end kw'>end</span>

        <span class='return return kw'>return</span> <span class='dstring node'>&quot;#{property_to_column_name(comparison.property, qualify)} #{operator} ?&quot;</span><span class='comma token'>,</span> <span class='lbrack token'>[</span> <span class='value identifier id'>value</span> <span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='equality_operator identifier id'>equality_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='operand identifier id'>operand</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='string val'>'IS'</span> <span class='colon op'>:</span> <span class='string val'>'='</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='inequality_operator identifier id'>inequality_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='operand identifier id'>operand</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='integer val'>? </span><span class='string val'>'IS NOT'</span> <span class='colon op'>:</span> <span class='string val'>'&lt;&gt;'</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='include_operator identifier id'>include_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='case case kw'>case</span> <span class='operand identifier id'>operand</span>
          <span class='when when kw'>when</span> <span class='Array constant id'>Array</span> <span class='then then kw'>then</span> <span class='string val'>'IN'</span>
          <span class='when when kw'>when</span> <span class='Range constant id'>Range</span> <span class='then then kw'>then</span> <span class='string val'>'BETWEEN'</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='exclude_operator identifier id'>exclude_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='dstring node'>&quot;NOT #{include_operator(operand)}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='regexp_operator identifier id'>regexp_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='string val'>'~'</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='not_regexp_operator identifier id'>not_regexp_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='string val'>'!~'</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='like_operator identifier id'>like_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='string val'>'LIKE'</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='unlike_operator identifier id'>unlike_operator</span><span class='lparen token'>(</span><span class='operand identifier id'>operand</span><span class='rparen token'>)</span>
        <span class='string val'>'NOT LIKE'</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># TODO: document</span>
      <span class='comment val'># @api private</span>
      <span class='def def kw'>def</span> <span class='quote_name identifier id'>quote_name</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
        <span class='dstring node'>&quot;\&quot;#{name[0, self.class::IDENTIFIER_MAX_LENGTH].gsub('&quot;', '&quot;&quot;')}\&quot;&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span> <span class='comment val'>#module SQL</span>

    <span class='include identifier id'>include</span> <span class='SQL constant id'>SQL</span>
  <span class='end end kw'>end</span> <span class='comment val'># class DataObjectsAdapter</span>

  <span class='const_added identifier id'>const_added</span><span class='lparen token'>(</span><span class='symbol val'>:DataObjectsAdapter</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span> <span class='comment val'># module Adapters</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>read</h3>
</div><div id="read-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'><tt>Array</tt></span>
    <span class='name'>read</span><span class='args'>(query)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Constructs and executes SELECT query, then instantiates one or many object
from result set.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    
      <dt>
        <span class='type'>[<tt><a href="../Query.html" title="Query">Query</a></tt>]</span>
        <span class='name'>query</span>
        
      </dt>
      <dd>
        <span class='desc'><p>
composition of the query to perform
</p>
</span>
      </dd>
    
  
  </dl>
</div><div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>Array</tt>]</span>
      
      
        <span class='name'></span>
      
      
    </dt>
    <dd>
      <span class='desc'><p>
result set of the query
</p>
</span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dm-core/adapters/data_objects_adapter.rb', line 73</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866/lib/dm-core/adapters/data_objects_adapter.rb#L73">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='fields identifier id'>fields</span>
  <span class='types identifier id'>types</span>  <span class='assign token'>=</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='primitive identifier id'>primitive</span> <span class='rbrace token'>}</span>

  <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='select_statement identifier id'>select_statement</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>

  <span class='records identifier id'>records</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='with_connection identifier id'>with_connection</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='connection identifier id'>connection</span><span class='bitor op'>|</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='create_command identifier id'>create_command</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='rparen token'>)</span>
    <span class='command identifier id'>command</span><span class='dot token'>.</span><span class='set_types identifier id'>set_types</span><span class='lparen token'>(</span><span class='types identifier id'>types</span><span class='rparen token'>)</span>

    <span class='reader identifier id'>reader</span> <span class='assign token'>=</span> <span class='command identifier id'>command</span><span class='dot token'>.</span><span class='execute_reader identifier id'>execute_reader</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span>

    <span class='begin begin kw'>begin</span>
      <span class='while while kw'>while</span><span class='lparen token'>(</span><span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='next! fid id'>next!</span><span class='rparen token'>)</span>
        <span class='records identifier id'>records</span> <span class='lshft op'>&lt;&lt;</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_hash identifier id'>to_hash</span>
      <span class='end end kw'>end</span>
    <span class='ensure ensure kw'>ensure</span>
      <span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='records identifier id'>records</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>update</h3>
</div><div id="update-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'><tt>Integer</tt></span>
    <span class='name'>update</span><span class='args'>(attributes, collection)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Constructs and executes UPDATE statement for given attributes and a query
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    
      <dt>
        <span class='type'>[<tt>Hash(Property =&gt;Object)</tt>]</span>
        <span class='name'>attributes</span>
        
      </dt>
      <dd>
        <span class='desc'><p>
hash of attribute values to set, keyed by Property
</p>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt><a href="../Collection.html" title="Collection">Collection</a></tt>]</span>
        <span class='name'>collection</span>
        
      </dt>
      <dd>
        <span class='desc'><p>
collection of records to be updated
</p>
</span>
      </dd>
    
  
  </dl>
</div><div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>Integer</tt>]</span>
      
      
        <span class='name'></span>
      
      
    </dt>
    <dd>
      <span class='desc'><p>
the number of records updated
</p>
</span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dm-core/adapters/data_objects_adapter.rb', line 111</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/michael/dm-core/blob/e1bd009dff9b6c1bfd91751e87b3989c1c7a1866/lib/dm-core/adapters/data_objects_adapter.rb#L111">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span><span class='comma token'>,</span> <span class='collection identifier id'>collection</span><span class='rparen token'>)</span>
  <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='collection identifier id'>collection</span><span class='dot token'>.</span><span class='query identifier id'>query</span>

  <span class='comment val'># TODO: if the query contains any links, a limit or an offset</span>
  <span class='comment val'># use a subselect to get the rows to be updated</span>

  <span class='properties identifier id'>properties</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='comment val'># make the order of the properties consistent</span>
  <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='model identifier id'>model</span><span class='dot token'>.</span><span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='bitor op'>|</span>
    <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='key? fid id'>key?</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='rparen token'>)</span>
    <span class='properties identifier id'>properties</span>  <span class='lshft op'>&lt;&lt;</span> <span class='property identifier id'>property</span>
    <span class='bind_values identifier id'>bind_values</span> <span class='lshft op'>&lt;&lt;</span> <span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='property identifier id'>property</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='conditions_bind_values identifier id'>conditions_bind_values</span> <span class='assign token'>=</span> <span class='update_statement identifier id'>update_statement</span><span class='lparen token'>(</span><span class='properties identifier id'>properties</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>

  <span class='bind_values identifier id'>bind_values</span><span class='dot token'>.</span><span class='concat identifier id'>concat</span><span class='lparen token'>(</span><span class='conditions_bind_values identifier id'>conditions_bind_values</span><span class='rparen token'>)</span>

  <span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='statement identifier id'>statement</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>