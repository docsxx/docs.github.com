<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>why's hpricot - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/why/commits/hpricot/master" rel="alternate" title="Recent Commits to hpricot:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("why", "hpricot", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='why/hpricot/blob/38c781c00522494013960a4c0813866f7cd0397b' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='why/hpricot/blob/38c781c00522494013960a4c0813866f7cd0397b' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("why", "hpricot", "38c781c00522494013960a4c0813866f7cd0397b", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/why/hpricot/tree/">Source</a></li>
            <li class=""><a href="http://github.com/why/hpricot/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/why/hpricot/network">Network</a></li>            
            <li class=""><a href="http://github.com/why/hpricot/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/why/hpricot">Wiki</a></li>
            <li class=""><a href="http://github.com/why/hpricot/graphs">Graphs</a></li>                    
            <li class="active"><a href="/why/hpricot">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/why">why</a> / <b><a href="http://github.com/why/hpricot/tree">hpricot</a></b>        
                <a id="namespaces_button" rel="why/hpricot/blob/38c781c00522494013960a4c0813866f7cd0397b" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="why/hpricot/blob/38c781c00522494013960a4c0813866f7cd0397b" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Hpricot, Read Any HTML</h1>
<p>
Hpricot is a fast, flexible HTML parser written in C. It&#8217;s designed
to be very accommodating (like Tanaka Akira&#8217;s HTree) and to have a
very helpful library (like some JavaScript libs &#8212; JQuery, Prototype
&#8212; give you.) The XPath and CSS parser, in fact, is based on John
Resig&#8217;s JQuery.
</p>
<p>
Also, Hpricot can be handy for reading broken XML files, since many of the
same techniques can be used. If a quote is missing, Hpricot tries to figure
it out. If tags overlap, Hpricot works on sorting them out. You know, that
sort of thing.
</p>
<p>
*Please read this entire document* before making assumptions about how this
software works.
</p>
<h2>An Overview</h2>
<p>
Let&#8217;s clear up what Hpricot is.
</p>
<p>
# Hpricot is *a standalone library*. It requires no other libraries. Just
Ruby! # While priding itself on speed, Hpricot *works hard to sort out bad
HTML* and
</p>
<pre class="code">
  <span class='pays identifier id'>pays</span> <span class='a identifier id'>a</span> <span class='small identifier id'>small</span> <span class='penalty identifier id'>penalty</span> <span class='in in kw'>in</span> <span class='order identifier id'>order</span> <span class='to identifier id'>to</span> <span class='get identifier id'>get</span> <span class='that identifier id'>that</span> <span class='right identifier id'>right</span><span class='dot token'>.</span>  <span class='So constant id'>So</span> <span class='that identifier id'>that</span><span class='string val'>'s slightly more important
  to me than speed.
</span></pre>
<p>
# *If you can see it in Firefox, then Hpricot should parse it.*
That&#8217;s
</p>
<pre class="code">
  <span class='how identifier id'>how</span> <span class='it identifier id'>it</span> <span class='should identifier id'>should</span> <span class='be! fid id'>be!</span>  <span class='Let constant id'>Let</span> <span class='me identifier id'>me</span> <span class='know identifier id'>know</span> <span class='the identifier id'>the</span> <span class='minute identifier id'>minute</span> <span class='it identifier id'>it</span><span class='string val'>'s otherwise.
</span></pre>
<p>
# Primarily, Hpricot is used for reading HTML and tries to sort out
troubled
</p>
<pre class="code">
  <span class='HTML constant id'>HTML</span> <span class='by identifier id'>by</span> <span class='having identifier id'>having</span> <span class='some identifier id'>some</span> <span class='idea identifier id'>idea</span> <span class='of identifier id'>of</span> <span class='what identifier id'>what</span> <span class='good identifier id'>good</span> <span class='HTML constant id'>HTML</span> <span class='is identifier id'>is</span><span class='dot token'>.</span>  <span class='Some constant id'>Some</span> <span class='people identifier id'>people</span> <span class='still identifier id'>still</span> <span class='like identifier id'>like</span> <span class='to identifier id'>to</span> <span class='use identifier id'>use</span>
  <span class='Hpricot constant id'>Hpricot</span> <span class='for for kw'>for</span> <span class='XML constant id'>XML</span> <span class='reading identifier id'>reading</span><span class='comma token'>,</span> <span class='but identifier id'>but</span> <span class='mult op'>*</span><span class='remember identifier id'>remember</span> <span class='to identifier id'>to</span> <span class='use identifier id'>use</span> <span class='the identifier id'>the</span> <span class='Hpricot constant id'>Hpricot</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='method identifier id'>method</span><span class='mult op'>*</span> <span class='for for kw'>for</span> <span class='that! fid id'>that!</span>
</pre>
<h2>The Hpricot Kingdom</h2>
<p>
First, here are all the links you need to know:
</p>
<ul>
<li>http://code.whytheluckystiff.net/hpricot is the Hpricot wiki and bug
tracker. Go there for news and recipes and patches. It&#8217;s the center
of activity.

</li>
<li>http://code.whytheluckystiff.net/svn/hpricot/trunk is the main Subversion
repository for Hpricot. You can get the latest code there.

</li>
<li>http://code.whytheluckystiff.net/doc/hpricot is the home for the latest
copy of this reference.

</li>
<li>See COPYING for the terms of this software. (Spoiler: it&#8217;s absolutely
free.)

</li>
</ul>
<p>
If you have any trouble, don&#8217;t hesitate to contact the author. As
always, I&#8217;m not going to say &quot;Use at your own risk&quot; because
I don&#8217;t want this library to be risky. If you trip on something,
I&#8217;ll share the liability by repairing things as quickly as I can.
Your responsibility is to report the inadequacies.
</p>
<h2>Installing Hpricot</h2>
<p>
You may get the latest stable version from Rubyforge. Win32 binaries and
source gems are available.
</p>
<pre class="code">
  $ <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='hpricot identifier id'>hpricot</span>
</pre>
<p>
As Hpricot is still under active development, you can also try the most
recent candidate build here:
</p>
<pre class="code">
  $ <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='hpricot identifier id'>hpricot</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='source identifier id'>source</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/code.whytheluckystiff.net
</span></pre>
<p>
The development gem is usually in pretty good shape actually. You can also
get the bleeding edge code or plain Ruby tarballs on the wiki.
</p>
<h2>An Hpricot Showcase</h2>
<p>
We&#8217;re going to run through a big pile of examples to get you
jump-started. Many of these examples are also found at
http://code.whytheluckystiff.net/hpricot/wiki/HpricotBasics, in case you
want to add some of your own.
</p>
<h3>Loading Hpricot Itself</h3>
<p>
You have probably got the gem, right? To load Hpricot:
</p>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
 <span class='require identifier id'>require</span> <span class='string val'>'hpricot'</span>
</pre>
<p>
If you&#8217;ve installed the plain source distribution, go ahead and just:
</p>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>'hpricot'</span>
</pre>
<h3>Load an HTML Page</h3>
<p>
The <tt>Hpricot()</tt> method takes a string or any IO object and loads the
contents into a document object.
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='Hpricot constant id'>Hpricot</span><span class='lparen token'>(</span><span class='string val'>&quot;&lt;p&gt;A simple &lt;b&gt;test&lt;/b&gt; string.&lt;/p&gt;&quot;</span><span class='rparen token'>)</span>
</pre>
<p>
To load from a file, just get the stream open:
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;index.html&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='Hpricot constant id'>Hpricot</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
</pre>
<p>
To load from a web URL, use <tt>open-uri</tt>, which comes with Ruby:
</p>
<pre class="code">
 <span class='require identifier id'>require</span> <span class='string val'>'open-uri'</span>
 <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;http://qwantz.com/&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='Hpricot constant id'>Hpricot</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
</pre>
<p>
Hpricot uses an internal buffer to parse the file, so the IO will stream
properly and large documents won&#8217;t be loaded into memory all at once.
However, the parsed document object will be present in memory, in its
entirety.
</p>
<h3>Search for Elements</h3>
<p>
Use <tt>Doc.search</tt>:
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;//p[@class='posted']&quot;</span><span class='rparen token'>)</span>
 <span class='comment val'>#=&gt; #&lt;Hpricot:Elements[{p ...}, {p ...}]&gt;</span>
</pre>
<p>
<tt>Doc.search</tt> can take an XPath or CSS expression. In the above
example, all paragraph <tt>&lt;p&gt;</tt> elements are grabbed which have a
<tt>class</tt> attribute of <tt>&quot;posted&quot;</tt>.
</p>
<p>
A shortcut is to use the divisor:
</p>
<pre class="code">
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;p.posted&quot;</span><span class='rparen token'>)</span>
 <span class='comment val'>#=&gt; #&lt;Hpricot:Elements[{p ...}, {p ...}]&gt;</span>
</pre>
<h3>Finding Just One Element</h3>
<p>
If you&#8217;re looking for a single element, the <tt>at</tt> method will
return the first element matched by the expression. In this case,
you&#8217;ll get back the element itself rather than the
<tt>Hpricot::Elements</tt> array.
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='string val'>&quot;body&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='string val'>'onload'</span><span class='rbrack token'>]</span>
</pre>
<p>
The above code will find the body tag and give you back the <tt>onload</tt>
attribute. This is the most common reason to use the element directly: when
reading and writing HTML attributes.
</p>
<h3>Fetching the Contents of an Element</h3>
<p>
Just as with browser scripting, the <tt>inner_html</tt> property can be
used to get the inner contents of an element.
</p>
<pre class="code">
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;#elementID&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='inner_html identifier id'>inner_html</span>
 <span class='comment val'>#=&gt; &quot;..&lt;b&gt;contents&lt;/b&gt;..&quot;</span>
</pre>
<p>
If your expression matches more than one element, you&#8217;ll get back the
contents of &#8217;&#8217;all the matched elements&#8217;&#8217;. So you
may want to use <tt>first</tt> to be sure you get back only one.
</p>
<pre class="code">
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;#elementID&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='inner_html identifier id'>inner_html</span>
 <span class='comment val'>#=&gt; &quot;..&lt;b&gt;contents&lt;/b&gt;..&quot;</span>
</pre>
<h3>Fetching the HTML for an Element</h3>
<p>
If you want the HTML for the whole element (not just the contents), use
<tt>to_html</tt>:
</p>
<pre class="code">
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;#elementID&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_html identifier id'>to_html</span>
 <span class='comment val'>#=&gt; &quot;&lt;div id='elementID'&gt;...&lt;/div&gt;&quot;</span>
</pre>
<h3>Looping</h3>
<p>
All searches return a set of <tt>Hpricot::Elements</tt>. Go ahead and loop
through them like you would an array.
</p>
<pre class="code">
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;p/a/img&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='img identifier id'>img</span><span class='bitor op'>|</span>
   <span class='puts identifier id'>puts</span> <span class='img identifier id'>img</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'class'</span><span class='rbrack token'>]</span>
 <span class='end end kw'>end</span>
</pre>
<h3>Continuing Searches</h3>
<p>
Searches can be continued from a collection of elements, in order to search
deeper.
</p>
<pre class="code">
 <span class='comment val'># find all paragraphs.</span>
 <span class='elements identifier id'>elements</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;/html/body//p&quot;</span><span class='rparen token'>)</span>
 <span class='comment val'># continue the search by finding any images within those paragraphs.</span>
 <span class='lparen token'>(</span><span class='elements identifier id'>elements</span><span class='div op'>/</span><span class='string val'>&quot;img&quot;</span><span class='rparen token'>)</span>
 <span class='comment val'>#=&gt; #&lt;Hpricot::Elements[{img ...}, {img ...}]&gt;</span>
</pre>
<p>
Searches can also be continued by searching within container elements.
</p>
<pre class="code">
 <span class='comment val'># find all images within paragraphs.</span>
 <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;/html/body//p&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='para identifier id'>para</span><span class='bitor op'>|</span>
   <span class='puts identifier id'>puts</span> <span class='string val'>&quot;== Found a paragraph ==&quot;</span>
   <span class='pp identifier id'>pp</span> <span class='para identifier id'>para</span>

   <span class='imgs identifier id'>imgs</span> <span class='assign token'>=</span> <span class='para identifier id'>para</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;img&quot;</span><span class='rparen token'>)</span>
   <span class='if if kw'>if</span> <span class='imgs identifier id'>imgs</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
     <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;== Found #{imgs.length} images inside ==&quot;</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>
</pre>
<p>
Of course, the most succinct ways to do the above are using CSS or XPath.
</p>
<pre class="code">
 <span class='comment val'># the xpath version</span>
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;/html/body//p//img&quot;</span><span class='rparen token'>)</span>
 <span class='comment val'># the css version</span>
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;html &gt; body &gt; p img&quot;</span><span class='rparen token'>)</span>
 <span class='comment val'># ..or symbols work, too!</span>
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='symbol val'>:html</span><span class='div op'>/</span><span class='symbol val'>:body</span><span class='div op'>/</span><span class='symbol val'>:p</span><span class='div op'>/</span><span class='symbol val'>:img</span><span class='rparen token'>)</span>
</pre>
<h3>Looping Edits</h3>
<p>
You may certainly edit objects from within your search loops. Then, when
you spit out the HTML, the altered elements will show.
</p>
<pre class="code">
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;span.entryPermalink&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='span identifier id'>span</span><span class='bitor op'>|</span>
   <span class='span identifier id'>span</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'class'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'newLinks'</span>
 <span class='end end kw'>end</span>
 <span class='puts identifier id'>puts</span> <span class='doc identifier id'>doc</span>
</pre>
<p>
This changes all <tt>span.entryPermalink</tt> elements to
<tt>span.newLinks</tt>. Keep in mind that there are often more convenient
ways of doing this. Such as the <tt>set</tt> method:
</p>
<pre class="code">
 <span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='div op'>/</span><span class='string val'>&quot;span.entryPermalink&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:class</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'newLinks'</span><span class='rparen token'>)</span>
</pre>
<h3>Figuring Out Paths</h3>
<p>
Every element can tell you its unique path (either XPath or CSS) to get to
the element from the root tag.
</p>
<p>
The <tt>css_path</tt> method:
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='string val'>&quot;div &gt; div:nth(1)&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='css_path identifier id'>css_path</span>
   <span class='comment val'>#=&gt; &quot;div &gt; div:nth(1)&quot;</span>
 <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='string val'>&quot;#header&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='css_path identifier id'>css_path</span>
   <span class='comment val'>#=&gt; &quot;#header&quot;</span>
</pre>
<p>
Or, the <tt>xpath</tt> method:
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='string val'>&quot;div &gt; div:nth(1)&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='xpath identifier id'>xpath</span>
   <span class='comment val'>#=&gt; &quot;/div/div:eq(1)&quot;</span>
 <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='string val'>&quot;#header&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='xpath identifier id'>xpath</span>
   <span class='comment val'>#=&gt; &quot;//div[@id='header']&quot;</span>
</pre>
<h2>Hpricot Fixups</h2>
<p>
When loading HTML documents, you have a few settings that can make Hpricot
more or less intense about how it gets involved.
</p>
<h2>:fixup_tags</h2>
<p>
Really, there are so many ways to clean up HTML and your intentions may be
to keep the HTML as-is. So Hpricot&#8217;s default behavior is to keep
things flexible. Making sure to open and close all the tags, but ignore any
validation problems.
</p>
<p>
As of Hpricot 0.4, there&#8217;s a new <tt>:fixup_tags</tt> option which
will attempt to shift the document&#8217;s tags to meet XHTML 1.0 Strict.
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;index.html&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='Hpricot constant id'>Hpricot</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='symbol val'>:fixup_tags</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span>
</pre>
<p>
This doesn&#8217;t quite meet the XHTML 1.0 Strict standard, it just tries
to follow the rules a bit better. Like: say Hpricot finds a paragraph in a
link, it&#8217;s going to move the paragraph below the link. Or up and out
of other elements where paragraphs don&#8217;t belong.
</p>
<p>
If an unknown element is found, it is ignored. Again, <tt>:fixup_tags</tt>.
</p>
<h2>:xhtml_strict</h2>
<p>
So, let&#8217;s go beyond just trying to fix the hierarchy. The
<tt>:xhtml_strict</tt> option really tries to force the document to be an
XHTML 1.0 Strict document. Even at the cost of removing elements that get
in the way.
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;index.html&quot;</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='Hpricot constant id'>Hpricot</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='symbol val'>:xhtml_strict</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span>
</pre>
<p>
What measures does <tt>:xhtml_strict</tt> take?
</p>
<pre class="code">
 <span class='float val'>1</span><span class='dot token'>.</span> <span class='Shift constant id'>Shift</span> <span class='elements identifier id'>elements</span> <span class='into identifier id'>into</span> <span class='their identifier id'>their</span> <span class='proper identifier id'>proper</span> <span class='containers identifier id'>containers</span> <span class='just identifier id'>just</span> <span class='like identifier id'>like</span> <span class='symbol val'>:fixup_tags</span><span class='dot token'>.</span>
 <span class='float val'>2</span><span class='dot token'>.</span> <span class='Remove constant id'>Remove</span> <span class='unknown identifier id'>unknown</span> <span class='elements identifier id'>elements</span><span class='dot token'>.</span>
 <span class='float val'>3</span><span class='dot token'>.</span> <span class='Remove constant id'>Remove</span> <span class='unknown identifier id'>unknown</span> <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span>
 <span class='float val'>4</span><span class='dot token'>.</span> <span class='Remove constant id'>Remove</span> <span class='illegal identifier id'>illegal</span> <span class='content identifier id'>content</span><span class='dot token'>.</span>
 <span class='float val'>5</span><span class='dot token'>.</span> <span class='Alter constant id'>Alter</span> <span class='the identifier id'>the</span> <span class='doctype identifier id'>doctype</span> <span class='to identifier id'>to</span> <span class='XHTML constant id'>XHTML</span> <span class='float val'>1.0</span> <span class='Strict constant id'>Strict</span><span class='dot token'>.</span>
</pre>
<h2>Hpricot.XML()</h2>
<p>
The last option is the <tt>:xml</tt> option, which makes some slight
variations on the standard mode. The main difference is that :xml mode
won&#8217;t try to output tags which are friendlier for browsers. For
example, if an opening and closing <tt>br</tt> tag is found, XML mode
won&#8217;t try to turn that into an empty element.
</p>
<p>
XML mode also doesn&#8217;t downcase the tags and attributes for you. So
pay attention to case, friends.
</p>
<p>
The primary way to use Hpricot&#8217;s XML mode is to call the Hpricot.XML
method:
</p>
<pre class="code">
 <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;http://redhanded.hobix.com/index.xml&quot;</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
   <span class='Hpricot constant id'>Hpricot</span><span class='dot token'>.</span><span class='XML constant id'>XML</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='rparen token'>)</span>
 <span class='end end kw'>end</span>
</pre>
<p>
*Also, :fixup_tags is canceled out by the :xml option.* This is because
:fixup_tags makes assumptions based how HTML is structured. Specifically,
how tags are defined in the XHTML 1.0 DTD.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>