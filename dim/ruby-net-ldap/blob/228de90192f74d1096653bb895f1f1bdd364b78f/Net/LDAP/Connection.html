<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>dim's ruby-net-ldap - Class: Net::LDAP::Connection - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/dim/commits/ruby-net-ldap/master" rel="alternate" title="Recent Commits to ruby-net-ldap:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("dim", "ruby-net-ldap", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("dim", "ruby-net-ldap", "228de90192f74d1096653bb895f1f1bdd364b78f", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/dim/ruby-net-ldap/tree/">Source</a></li>
            <li class=""><a href="http://github.com/dim/ruby-net-ldap/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/dim/ruby-net-ldap/network">Network</a></li>            
            <li class=""><a href="http://github.com/dim/ruby-net-ldap/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/dim/ruby-net-ldap">Wiki</a></li>
            <li class=""><a href="http://github.com/dim/ruby-net-ldap/graphs">Graphs</a></li>                    
            <li class="active"><a href="/dim/ruby-net-ldap">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/dim">dim</a> / <b><a href="http://github.com/dim/ruby-net-ldap/tree">ruby-net-ldap</a></b>        
                <a id="namespaces_button" rel="dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Net_LDAP_Connection">
  <h1>Class: Net::LDAP::Connection</h1>
  <div class="section docstring">
  <p>
This is a private class used internally by the library. It should not be
called by user code.
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="LdapVersion-constant">LdapVersion</dt>
      <dd>3</dd>
    
      <dt id="MaxSaslChallenges-constant">MaxSaslChallenges</dt>
      <dd>10</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(server)</span>
    <span class='block'>{|_self| ... }</span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; initialize
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="yieldparam">
  <h3>Yield Parameters:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a title="Net::LDAP::Connection" href="">Net::LDAP::Connection</a></tt>]</span>
      
      
        <span class='name'>_self</span>
      
      
    </dt>
    <dd>
      <span class='desc'><p>
the object that the method was called on
</p>
</span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1170</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1170">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='server identifier id'>server</span>
  <span class='begin begin kw'>begin</span>
    <span class='@conn ivar id'>@conn</span> <span class='assign token'>=</span> <span class='TCPSocket constant id'>TCPSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='symbol val'>:host</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span>
    <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;no connection to server&quot;</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='symbol val'>:encryption</span><span class='rbrack token'>]</span>
    <span class='setup_encryption identifier id'>setup_encryption</span> <span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='symbol val'>:encryption</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='yield yield kw'>yield</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add-instance_method">#add</span><span class='args'>(args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; add TODO, need to support a time limit, in case the server fails to
respond.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#bind-instance_method">#bind</span><span class='args'>(auth)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; bind.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#bind_simple-instance_method">#bind_simple</span><span class='args'>(auth)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; bind_simple Implements a simple user/psw authentication.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#close-instance_method">#close</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; close This is provided as a convenience method to make sure a
connection object gets closed without waiting for a GC to happen.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#delete-instance_method">#delete</span><span class='args'>(args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; delete TODO, need to support a time limit, in case the server fails
to respond.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#modify-instance_method">#modify</span><span class='args'>(args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; modify TODO, need to support a time limit, in case the server fails
to respond.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#next_msgid-instance_method">#next_msgid</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; next_msgid.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#rename-instance_method">#rename</span><span class='args'>(args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; rename TODO, need to support a time limit, in case the server fails
to respond.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#search-instance_method">#search</span><span class='args'>(args = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; search Alternate implementation, this yields each search entry to
the caller as it are received.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#setup_encryption-instance_method">#setup_encryption</span><span class='args'>(args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; Helper method called only from new, and only after we have a
successfully-opened.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>add</h3>
</div><div id="add-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add</span><span class='args'>(args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; add TODO, need to support a time limit, in case the server fails to
respond. Unlike other operation-methods in this class, we return a result
hash rather than a simple result number. This is experimental, and
eventually we&#8217;ll want to do this with all the others. The point is to
have access to the error message and the matched-DN returned by the server.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1556</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1556">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1556
1557
1558
1559
1560
1561
1562
1563
1564
1565
1566
1567
1568
1569</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='add identifier id'>add</span> <span class='args identifier id'>args</span>
  <span class='add_dn identifier id'>add_dn</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:dn</span><span class='rbrack token'>]</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Unable to add empty DN&quot;</span><span class='rparen token'>)</span>
  <span class='add_attrs identifier id'>add_attrs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:attributes</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='add_attrs identifier id'>add_attrs</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='v identifier id'>v</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='to_ber_set identifier id'>to_ber_set</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
  <span class='rbrace token'>}</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='add_dn identifier id'>add_dn</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='add_attrs identifier id'>add_attrs</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_appsequence identifier id'>to_ber_appsequence</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='rparen token'>)</span>
  <span class='pkt identifier id'>pkt</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='next_msgid identifier id'>next_msgid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
  <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='pkt identifier id'>pkt</span>

  <span class='lparen token'>(</span><span class='be identifier id'>be</span> <span class='assign token'>=</span> <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lparen token'>(</span><span class='AsnSyntax constant id'>AsnSyntax</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span> <span class='assign token'>=</span> <span class='LdapPdu constant id'>LdapPdu</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='be identifier id'>be</span> <span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='app_tag identifier id'>app_tag</span> <span class='eq op'>==</span> <span class='integer val'>9</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;response missing or invalid&quot;</span> <span class='rparen token'>)</span>
  <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result identifier id'>result</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>bind</h3>
</div><div id="bind-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>bind</span><span class='args'>(auth)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; bind
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1266</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1266">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='bind identifier id'>bind</span> <span class='auth identifier id'>auth</span>
  <span class='meth identifier id'>meth</span> <span class='assign token'>=</span> <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='symbol val'>:method</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='lbrack token'>[</span><span class='symbol val'>:simple</span><span class='comma token'>,</span> <span class='symbol val'>:anonymous</span><span class='comma token'>,</span> <span class='symbol val'>:anon</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span> <span class='meth identifier id'>meth</span> <span class='rparen token'>)</span>
    <span class='bind_simple identifier id'>bind_simple</span> <span class='auth identifier id'>auth</span>
  <span class='elsif elsif kw'>elsif</span> <span class='meth identifier id'>meth</span> <span class='eq op'>==</span> <span class='symbol val'>:sasl</span>
    <span class='bind_sasl identifier id'>bind_sasl</span><span class='lparen token'>(</span> <span class='auth identifier id'>auth</span> <span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='meth identifier id'>meth</span> <span class='eq op'>==</span> <span class='symbol val'>:gss_spnego</span>
    <span class='bind_gss_spnego identifier id'>bind_gss_spnego</span><span class='lparen token'>(</span> <span class='auth identifier id'>auth</span> <span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='dstring node'>&quot;unsupported auth method (#{meth})&quot;</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>bind_simple</h3>
</div><div id="bind_simple-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>bind_simple</span><span class='args'>(auth)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; bind_simple Implements a simple user/psw authentication. Accessed
by calling #bind with a method of :simple or :anonymous.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a title="LdapError" href="LdapError.html">LdapError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1284</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1284">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='bind_simple identifier id'>bind_simple</span> <span class='auth identifier id'>auth</span>
  <span class='user identifier id'>user</span><span class='comma token'>,</span><span class='psw identifier id'>psw</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='symbol val'>:method</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='symbol val'>:simple</span>
    <span class='lbrack token'>[</span><span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='symbol val'>:dn</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='lbrack token'>[</span><span class='string val'>&quot;&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;&quot;</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;invalid binding information&quot;</span> <span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='user identifier id'>user</span> <span class='andop op'>&amp;&amp;</span> <span class='psw identifier id'>psw</span><span class='rparen token'>)</span>

  <span class='msgid identifier id'>msgid</span> <span class='assign token'>=</span> <span class='next_msgid identifier id'>next_msgid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='LdapVersion constant id'>LdapVersion</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='psw identifier id'>psw</span><span class='dot token'>.</span><span class='to_ber_contextspecific identifier id'>to_ber_contextspecific</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_appsequence identifier id'>to_ber_appsequence</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='request_pkt identifier id'>request_pkt</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='msgid identifier id'>msgid</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
  <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='request_pkt identifier id'>request_pkt</span>

  <span class='lparen token'>(</span><span class='be identifier id'>be</span> <span class='assign token'>=</span> <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lparen token'>(</span><span class='AsnSyntax constant id'>AsnSyntax</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='pdu identifier id'>pdu</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='LdapPdu constant id'>LdapPdu</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='be identifier id'>be</span> <span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;no bind result&quot;</span> <span class='rparen token'>)</span>
  <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result_code identifier id'>result_code</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>close</h3>
</div><div id="close-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>close</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; close This is provided as a convenience method to make sure a
connection object gets closed without waiting for a GC to happen. Clients
shouldn&#8217;t have to call it, but perhaps it will come in handy someday.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1249</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1249">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1249
1250
1251
1252</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='close identifier id'>close</span>
  <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='@conn ivar id'>@conn</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>delete</h3>
</div><div id="delete-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>delete</span><span class='args'>(args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; delete TODO, need to support a time limit, in case the server fails
to respond.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1594</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1594">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1594
1595
1596
1597
1598
1599
1600
1601
1602
1603</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='delete identifier id'>delete</span> <span class='args identifier id'>args</span>
  <span class='dn identifier id'>dn</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:dn</span><span class='rbrack token'>]</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;Unable to delete empty DN&quot;</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='dn identifier id'>dn</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_ber_application_string identifier id'>to_ber_application_string</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='rparen token'>)</span>
  <span class='pkt identifier id'>pkt</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='next_msgid identifier id'>next_msgid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
  <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='pkt identifier id'>pkt</span>

  <span class='lparen token'>(</span><span class='be identifier id'>be</span> <span class='assign token'>=</span> <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lparen token'>(</span><span class='AsnSyntax constant id'>AsnSyntax</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span> <span class='assign token'>=</span> <span class='LdapPdu constant id'>LdapPdu</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='be identifier id'>be</span> <span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='app_tag identifier id'>app_tag</span> <span class='eq op'>==</span> <span class='integer val'>11</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;response missing or invalid&quot;</span> <span class='rparen token'>)</span>
  <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result_code identifier id'>result_code</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>modify</h3>
</div><div id="modify-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>modify</span><span class='args'>(args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; modify TODO, need to support a time limit, in case the server fails
to respond. TODO!!! We&#8217;re throwing an exception here on empty DN.
Should return a proper error instead, probaby from farther up the chain.
TODO!!! If the user specifies a bogus opcode, we&#8217;ll throw a confusing
error here (&quot;to_ber_enumerated is not defined on nil&quot;).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1529</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1529">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1529
1530
1531
1532
1533
1534
1535
1536
1537
1538
1539
1540
1541
1542
1543
1544
1545</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='modify identifier id'>modify</span> <span class='args identifier id'>args</span>
  <span class='modify_dn identifier id'>modify_dn</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:dn</span><span class='rbrack token'>]</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;Unable to modify empty DN&quot;</span>
  <span class='modify_ops identifier id'>modify_ops</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:operations</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='op identifier id'>op</span><span class='comma token'>,</span> <span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='bitor op'>|</span>
    <span class='comment val'># TODO, fix the following line, which gives a bogus error</span>
    <span class='comment val'># if the opcode is invalid.</span>
    <span class='op_1 identifier id'>op_1</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:add</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='symbol val'>:delete</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:replace</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span><span class='rbrace token'>}</span> <span class='lbrack token'>[</span><span class='op identifier id'>op</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_enumerated identifier id'>to_ber_enumerated</span>
    <span class='modify_ops identifier id'>modify_ops</span> <span class='lshft op'>&lt;&lt;</span> <span class='lbrack token'>[</span><span class='op_1 identifier id'>op_1</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='to_ber_set identifier id'>to_ber_set</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
  <span class='rbrace token'>}</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='modify_dn identifier id'>modify_dn</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='modify_ops identifier id'>modify_ops</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_appsequence identifier id'>to_ber_appsequence</span><span class='lparen token'>(</span><span class='integer val'>6</span><span class='rparen token'>)</span>
  <span class='pkt identifier id'>pkt</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='next_msgid identifier id'>next_msgid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
  <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='pkt identifier id'>pkt</span>

  <span class='lparen token'>(</span><span class='be identifier id'>be</span> <span class='assign token'>=</span> <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lparen token'>(</span><span class='AsnSyntax constant id'>AsnSyntax</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span> <span class='assign token'>=</span> <span class='LdapPdu constant id'>LdapPdu</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='be identifier id'>be</span> <span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='app_tag identifier id'>app_tag</span> <span class='eq op'>==</span> <span class='integer val'>7</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;response missing or invalid&quot;</span> <span class='rparen token'>)</span>
  <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result identifier id'>result</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>next_msgid</h3>
</div><div id="next_msgid-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>next_msgid</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; next_msgid
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1257</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1257">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1257
1258
1259
1260</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='next_msgid identifier id'>next_msgid</span>
  <span class='@msgid ivar id'>@msgid</span> <span class='opasgn op'>||=</span> <span class='integer val'>0</span>
  <span class='@msgid ivar id'>@msgid</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>rename</h3>
</div><div id="rename-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>rename</span><span class='args'>(args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; rename TODO, need to support a time limit, in case the server fails
to respond.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1576</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1576">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1576
1577
1578
1579
1580
1581
1582
1583
1584
1585
1586
1587</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='rename identifier id'>rename</span> <span class='args identifier id'>args</span>
  <span class='old_dn identifier id'>old_dn</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:olddn</span><span class='rbrack token'>]</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;Unable to rename empty DN&quot;</span>
  <span class='new_rdn identifier id'>new_rdn</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:newrdn</span><span class='rbrack token'>]</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='string val'>&quot;Unable to rename to empty RDN&quot;</span>
  <span class='delete_attrs identifier id'>delete_attrs</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:delete_attributes</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='true true kw'>true</span> <span class='colon op'>:</span> <span class='false false kw'>false</span>

  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='old_dn identifier id'>old_dn</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='new_rdn identifier id'>new_rdn</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='delete_attrs identifier id'>delete_attrs</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_appsequence identifier id'>to_ber_appsequence</span><span class='lparen token'>(</span><span class='integer val'>12</span><span class='rparen token'>)</span>
  <span class='pkt identifier id'>pkt</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='next_msgid identifier id'>next_msgid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
  <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='pkt identifier id'>pkt</span>

  <span class='lparen token'>(</span><span class='be identifier id'>be</span> <span class='assign token'>=</span> <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lparen token'>(</span><span class='AsnSyntax constant id'>AsnSyntax</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span> <span class='assign token'>=</span> <span class='LdapPdu constant id'>LdapPdu</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='be identifier id'>be</span> <span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='app_tag identifier id'>app_tag</span> <span class='eq op'>==</span> <span class='integer val'>13</span><span class='rparen token'>)</span> <span class='or or kw'>or</span> <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;response missing or invalid&quot;</span> <span class='rparen token'>)</span>
  <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result_code identifier id'>result_code</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>search</h3>
</div><div id="search-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>search</span><span class='args'>(args = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; search Alternate implementation, this yields each search entry to
the caller as it are received. TODO, certain search parameters are
hardcoded. TODO, if we mis-parse the server results or the results are
wrong, we can block forever. That&#8217;s because we keep reading results
until we get a type-5 packet, which might never come. We need to support
the time-limit in the protocol. &#8212; WARNING: this code substantially
recapitulates the searchx method.
</p>
<p>
02May06: Well, I added support for RFC-2696-style paged searches. This is
used on all queries because the extension is marked non-critical. As far as
I know, only A/D uses this, but it&#8217;s required for A/D. Otherwise you
won&#8217;t get more than 1000 results back from a query. This
implementation is kindof clunky and should probably be refactored. Also, is
it my imagination, or are A/Ds the slowest directory servers ever???
OpenLDAP newer than version 2.2.0 supports paged searches.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a title="LdapError" href="LdapError.html">LdapError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1389</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1389">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483
1484
1485
1486
1487
1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='search identifier id'>search</span> <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='search_filter identifier id'>search_filter</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span> <span class='andop op'>&amp;&amp;</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:filter</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='Filter constant id'>Filter</span><span class='dot token'>.</span><span class='eq identifier id'>eq</span><span class='lparen token'>(</span> <span class='string val'>&quot;objectclass&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;*&quot;</span> <span class='rparen token'>)</span>
  <span class='search_filter identifier id'>search_filter</span> <span class='assign token'>=</span> <span class='Filter constant id'>Filter</span><span class='dot token'>.</span><span class='construct identifier id'>construct</span><span class='lparen token'>(</span><span class='search_filter identifier id'>search_filter</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='search_filter identifier id'>search_filter</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
  <span class='search_base identifier id'>search_base</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span> <span class='andop op'>&amp;&amp;</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:base</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='string val'>&quot;dc=example,dc=com&quot;</span>
  <span class='search_attributes identifier id'>search_attributes</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='args identifier id'>args</span> <span class='andop op'>&amp;&amp;</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:attributes</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span> <span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='rbrace token'>}</span>
  <span class='return_referrals identifier id'>return_referrals</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span> <span class='andop op'>&amp;&amp;</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:return_referrals</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='true true kw'>true</span>
  <span class='sizelimit identifier id'>sizelimit</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span> <span class='andop op'>&amp;&amp;</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:size</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='integer val'>0</span>
  <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;invalid search-size&quot;</span> <span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='sizelimit identifier id'>sizelimit</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>
  <span class='paged_searches_supported identifier id'>paged_searches_supported</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span> <span class='andop op'>&amp;&amp;</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:paged_searches_supported</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='attributes_only identifier id'>attributes_only</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='args identifier id'>args</span> <span class='and and kw'>and</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:attributes_only</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='scope identifier id'>scope</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:scope</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='LDAP constant id'>LDAP</span><span class='colon2 op'>::</span><span class='SearchScope_WholeSubtree constant id'>SearchScope_WholeSubtree</span>
  <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='string val'>&quot;invalid search scope&quot;</span> <span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='SearchScopes constant id'>SearchScopes</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='scope identifier id'>scope</span><span class='rparen token'>)</span>

  <span class='comment val'># An interesting value for the size limit would be close to A/D's built-in</span>
  <span class='comment val'># page limit of 1000 records, but openLDAP newer than version 2.2.0 chokes</span>
  <span class='comment val'># on anything bigger than 126. You get a silent error that is easily visible</span>
  <span class='comment val'># by running slapd in debug mode. Go figure.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Changed this around 06Sep06 to support a caller-specified search-size limit.</span>
  <span class='comment val'># Because we ALWAYS do paged searches, we have to work around the problem that</span>
  <span class='comment val'># it's not legal to specify a &quot;normal&quot; sizelimit (in the body of the search request)</span>
  <span class='comment val'># that is larger than the page size we're requesting. Unfortunately, I have the</span>
  <span class='comment val'># feeling that this will break with LDAP servers that don't support paged searches!!!</span>
  <span class='comment val'># (Because we pass zero as the sizelimit on search rounds when the remaining limit</span>
  <span class='comment val'># is larger than our max page size of 126. In these cases, I think the caller's</span>
  <span class='comment val'># search limit will be ignored!)</span>
  <span class='comment val'># CONFIRMED: This code doesn't work on LDAPs that don't support paged searches</span>
  <span class='comment val'># when the size limit is larger than 126. We're going to have to do a root-DSE record</span>
  <span class='comment val'># search and not do a paged search if the LDAP doesn't support it. Yuck.</span>
  <span class='comment val'>#</span>
  <span class='rfc2696_cookie identifier id'>rfc2696_cookie</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='integer val'>126</span><span class='comma token'>,</span> <span class='string val'>&quot;&quot;</span><span class='rbrack token'>]</span>
  <span class='result_code identifier id'>result_code</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='n_results identifier id'>n_results</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='loop identifier id'>loop</span> <span class='lbrace token'>{</span>
    <span class='comment val'># should collect this into a private helper to clarify the structure</span>

    <span class='query_limit identifier id'>query_limit</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='if if kw'>if</span> <span class='sizelimit identifier id'>sizelimit</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='if if kw'>if</span> <span class='paged_searches_supported identifier id'>paged_searches_supported</span>
        <span class='query_limit identifier id'>query_limit</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='sizelimit identifier id'>sizelimit</span> <span class='minus op'>-</span> <span class='n_results identifier id'>n_results</span><span class='rparen token'>)</span> <span class='lt op'>&lt;</span> <span class='integer val'>126</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='lparen token'>(</span><span class='sizelimit identifier id'>sizelimit</span> <span class='minus op'>-</span> <span class='n_results identifier id'>n_results</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='query_limit identifier id'>query_limit</span> <span class='assign token'>=</span> <span class='sizelimit identifier id'>sizelimit</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span>
      <span class='search_base identifier id'>search_base</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span>
      <span class='scope identifier id'>scope</span><span class='dot token'>.</span><span class='to_ber_enumerated identifier id'>to_ber_enumerated</span><span class='comma token'>,</span>
      <span class='integer val'>0</span><span class='dot token'>.</span><span class='to_ber_enumerated identifier id'>to_ber_enumerated</span><span class='comma token'>,</span>
      <span class='query_limit identifier id'>query_limit</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='comment val'># size limit</span>
      <span class='integer val'>0</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span>
      <span class='attributes_only identifier id'>attributes_only</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span>
      <span class='search_filter identifier id'>search_filter</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span>
      <span class='search_attributes identifier id'>search_attributes</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
    <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_appsequence identifier id'>to_ber_appsequence</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>

    <span class='controls identifier id'>controls</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span>
      <span class='lbrack token'>[</span>
      <span class='LdapControls constant id'>LdapControls</span><span class='colon2 op'>::</span><span class='PagedResults constant id'>PagedResults</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span>
      <span class='false false kw'>false</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='comment val'># criticality MUST be false to interoperate with normal LDAPs.</span>
      <span class='rfc2696_cookie identifier id'>rfc2696_cookie</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span>
      <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
    <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_contextspecific identifier id'>to_ber_contextspecific</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span>

    <span class='pkt identifier id'>pkt</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='next_msgid identifier id'>next_msgid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='controls identifier id'>controls</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
    <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='pkt identifier id'>pkt</span>

    <span class='result_code identifier id'>result_code</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='controls identifier id'>controls</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

    <span class='while while kw'>while</span> <span class='lparen token'>(</span><span class='be identifier id'>be</span> <span class='assign token'>=</span> <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lparen token'>(</span><span class='AsnSyntax constant id'>AsnSyntax</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span> <span class='assign token'>=</span> <span class='LdapPdu constant id'>LdapPdu</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='be identifier id'>be</span> <span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='case case kw'>case</span> <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='app_tag identifier id'>app_tag</span>
      <span class='when when kw'>when</span> <span class='integer val'>4</span> <span class='comment val'># search-data</span>
        <span class='n_results identifier id'>n_results</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
        <span class='yield yield kw'>yield</span><span class='lparen token'>(</span> <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='search_entry identifier id'>search_entry</span> <span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
      <span class='when when kw'>when</span> <span class='integer val'>19</span> <span class='comment val'># search-referral</span>
        <span class='if if kw'>if</span> <span class='return_referrals identifier id'>return_referrals</span>
          <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
            <span class='se identifier id'>se</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='LDAP constant id'>LDAP</span><span class='colon2 op'>::</span><span class='Entry constant id'>Entry</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
            <span class='se identifier id'>se</span><span class='lbrack token'>[</span><span class='symbol val'>:search_referrals</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='search_referrals identifier id'>search_referrals</span> <span class='orop op'>||</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
            <span class='yield yield kw'>yield</span> <span class='se identifier id'>se</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
        <span class='comment val'>#p pdu.referrals</span>
      <span class='when when kw'>when</span> <span class='integer val'>5</span> <span class='comment val'># search-result</span>
        <span class='result_code identifier id'>result_code</span> <span class='assign token'>=</span> <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result_code identifier id'>result_code</span>
        <span class='controls identifier id'>controls</span> <span class='assign token'>=</span> <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result_controls identifier id'>result_controls</span>
        <span class='break break kw'>break</span>
      <span class='else else kw'>else</span>
        <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='dstring node'>&quot;invalid response-type in search: #{pdu.app_tag}&quot;</span> <span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># When we get here, we have seen a type-5 response.</span>
    <span class='comment val'># If there is no error AND there is an RFC-2696 cookie,</span>
    <span class='comment val'># then query again for the next page of results.</span>
    <span class='comment val'># If not, we're done.</span>
    <span class='comment val'># Don't screw this up or we'll break every search we do.</span>
    <span class='comment val'>#</span>
    <span class='comment val'># Noticed 02Sep06, look at the read_ber call in this loop,</span>
    <span class='comment val'># shouldn't that have a parameter of AsnSyntax? Does this</span>
    <span class='comment val'># just accidentally work? According to RFC-2696, the value</span>
    <span class='comment val'># expected in this position is of type OCTET STRING, covered</span>
    <span class='comment val'># in the default syntax supported by read_ber, so I guess</span>
    <span class='comment val'># we're ok.</span>
    <span class='comment val'>#</span>
    <span class='more_pages identifier id'>more_pages</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='if if kw'>if</span> <span class='result_code identifier id'>result_code</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='and and kw'>and</span> <span class='controls identifier id'>controls</span>
      <span class='controls identifier id'>controls</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='oid identifier id'>oid</span> <span class='eq op'>==</span> <span class='LdapControls constant id'>LdapControls</span><span class='colon2 op'>::</span><span class='PagedResults constant id'>PagedResults</span>
          <span class='more_pages identifier id'>more_pages</span> <span class='assign token'>=</span> <span class='false false kw'>false</span> <span class='comment val'># just in case some bogus server sends us &gt;1 of these.</span>
          <span class='if if kw'>if</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='and and kw'>and</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
            <span class='cookie identifier id'>cookie</span> <span class='assign token'>=</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
            <span class='if if kw'>if</span> <span class='cookie identifier id'>cookie</span> <span class='and and kw'>and</span> <span class='cookie identifier id'>cookie</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
              <span class='rfc2696_cookie identifier id'>rfc2696_cookie</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='cookie identifier id'>cookie</span>
              <span class='more_pages identifier id'>more_pages</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='break break kw'>break</span> <span class='unless unless_mod kw'>unless</span> <span class='more_pages identifier id'>more_pages</span>
  <span class='rbrace token'>}</span> <span class='comment val'># loop</span>

  <span class='result_code identifier id'>result_code</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>setup_encryption</h3>
</div><div id="setup_encryption-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>setup_encryption</span><span class='args'>(args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; Helper method called only from new, and only after we have a
successfully-opened
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/net/ldap.rb', line 1211</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/dim/ruby-net-ldap/blob/228de90192f74d1096653bb895f1f1bdd364b78f/lib/net/ldap.rb#L1211">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='setup_encryption identifier id'>setup_encryption</span> <span class='args identifier id'>args</span>
  <span class='case case kw'>case</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='symbol val'>:method</span><span class='rbrack token'>]</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:simple_tls</span>
    <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;openssl unavailable&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='$net_ldap_openssl_available gvar id'>$net_ldap_openssl_available</span>
    <span class='ctx identifier id'>ctx</span> <span class='assign token'>=</span> <span class='OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='SSL constant id'>SSL</span><span class='colon2 op'>::</span><span class='SSLContext constant id'>SSLContext</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='@conn ivar id'>@conn</span> <span class='assign token'>=</span> <span class='OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='SSL constant id'>SSL</span><span class='colon2 op'>::</span><span class='SSLSocket constant id'>SSLSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@conn ivar id'>@conn</span><span class='comma token'>,</span> <span class='ctx identifier id'>ctx</span><span class='rparen token'>)</span>
    <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span>
    <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='sync_close identifier id'>sync_close</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='comment val'># additional branches requiring server validation and peer certs, etc. go here.</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:start_tls</span>
            <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;openssl unavailable&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='$net_ldap_openssl_available gvar id'>$net_ldap_openssl_available</span>
            <span class='msgid identifier id'>msgid</span> <span class='assign token'>=</span> <span class='next_msgid identifier id'>next_msgid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span>
            <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='StartTlsOid constant id'>StartTlsOid</span><span class='dot token'>.</span><span class='to_ber identifier id'>to_ber</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_appsequence identifier id'>to_ber_appsequence</span><span class='lparen token'>(</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='LdapPdu constant id'>LdapPdu</span><span class='colon2 op'>::</span><span class='ExtendedRequest constant id'>ExtendedRequest</span> <span class='rparen token'>)</span>
            <span class='request_pkt identifier id'>request_pkt</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='msgid identifier id'>msgid</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_ber_sequence identifier id'>to_ber_sequence</span>
            <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='request_pkt identifier id'>request_pkt</span>
            <span class='be identifier id'>be</span> <span class='assign token'>=</span> <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='read_ber identifier id'>read_ber</span><span class='lparen token'>(</span><span class='AsnSyntax constant id'>AsnSyntax</span><span class='rparen token'>)</span>
            <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;no start_tls result&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='be identifier id'>be</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
            <span class='pdu identifier id'>pdu</span> <span class='assign token'>=</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='LdapPdu constant id'>LdapPdu</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='be identifier id'>be</span><span class='rparen token'>)</span>
            <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;no start_tls result&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
            <span class='if if kw'>if</span> <span class='pdu identifier id'>pdu</span><span class='dot token'>.</span><span class='result_code identifier id'>result_code</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
                    <span class='ctx identifier id'>ctx</span> <span class='assign token'>=</span> <span class='OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='SSL constant id'>SSL</span><span class='colon2 op'>::</span><span class='SSLContext constant id'>SSLContext</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
                    <span class='@conn ivar id'>@conn</span> <span class='assign token'>=</span> <span class='OpenSSL constant id'>OpenSSL</span><span class='colon2 op'>::</span><span class='SSL constant id'>SSL</span><span class='colon2 op'>::</span><span class='SSLSocket constant id'>SSLSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@conn ivar id'>@conn</span><span class='comma token'>,</span> <span class='ctx identifier id'>ctx</span><span class='rparen token'>)</span>
                    <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span>
                    <span class='@conn ivar id'>@conn</span><span class='dot token'>.</span><span class='sync_close identifier id'>sync_close</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
            <span class='else else kw'>else</span>
                    <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;start_tls failed: #{pdu.result_code}&quot;</span><span class='rparen token'>)</span>
            <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='LdapError constant id'>LdapError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='dstring node'>&quot;unsupported encryption method #{args[:method]}&quot;</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>