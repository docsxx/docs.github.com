<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: RecordFilter::DSL::DSL</title>
  </head>
  <body>
    <div id="content">
      <div class="section class RecordFilter_DSL_DSL">
  <h1 class="title">Class: RecordFilter::DSL::DSL</h1>
  <div class="section inheritance">
  <ul>
  <li><a title="RecordFilter::DSL::ConjunctionDSL" href="ConjunctionDSL.html">RecordFilter::DSL::ConjunctionDSL</a></li><ul><li>RecordFilter::DSL::DSL</li>
  </ul></ul>
</div><div class="section constants">
  
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <p class="inherited_msg">
    This class inherits a constructor from <a title="RecordFilter::DSL::ConjunctionDSL" href="ConjunctionDSL.html#initialize-instance_method">RecordFilter::DSL::ConjunctionDSL</a>.
  </p>
</div><div class="section methodmissing">
  <h1>Dynamic Method Handling</h1>

  <p class="note">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
      in the class <a title="RecordFilter::DSL::ConjunctionDSL" href="ConjunctionDSL.html">RecordFilter::DSL::ConjunctionDSL</a>
    
  </p>

  <div id="method_missing-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>method_missing</span><span class='args'>(method, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Enable calling of named filters from within other filters by catching
unknown calls and assuming that they are to named filters. This enables the
following examples:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Post constant id'>Post</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:comments</span>
    <span class='named_filter identifier id'>named_filter</span><span class='lparen token'>(</span><span class='symbol val'>:empty</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='symbol val'>:contents</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nil identifier id'>nil</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='class class kw'>class</span> <span class='Comment constant id'>Comment</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:post</span>
    <span class='named_filter identifier id'>named_filter</span><span class='lparen token'>(</span><span class='symbol val'>:offensive</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='value identifier id'>value</span><span class='bitor op'>|</span> <span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='symbol val'>:offensive</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='Post constant id'>Post</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span> <span class='do do kw'>do</span>
    <span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='symbol val'>:created_at</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='less_than identifier id'>less_than</span><span class='lparen token'>(</span><span class='float val'>1</span><span class='dot token'>.</span><span class='hour identifier id'>hour</span><span class='dot token'>.</span><span class='ago identifier id'>ago</span><span class='rparen token'>)</span>
    <span class='empty identifier id'>empty</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Results in:</span>
  <span class='comment val'># :conditions =&gt; { ['posts.created_at &lt; ? AND posts.contents IS NULL', 1.hour.ago] }</span>
  <span class='comment val'># And even cooler:</span>

  <span class='Post constant id'>Post</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span> <span class='do do kw'>do</span>
    <span class='having identifier id'>having</span><span class='lparen token'>(</span><span class='symbol val'>:comments</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='offensive identifier id'>offensive</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Results in:</span>
  <span class='comment val'># :conditions =&gt; { ['posts__comments.offensive = ?', true] }</span>
  <span class='comment val'># :joins =&gt; { 'INNER JOIN &quot;comments&quot; AS posts__comments ON &quot;posts&quot;.id = posts__comments.post_id' }</span>
</pre>
<h4>Parameters</h4>
<table>
<tr><td valign="top">args&lt;Array&gt;:</td><td>The arguments to pass to the named filter when called.

</td></tr>
</table>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


280
281
282</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/record_filter/dsl/conjunction_dsl.rb', line 280</span>

<span class='def def kw'>def</span> <span class='method_missing identifier id'>method_missing</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='@conjunction ivar id'>@conjunction</span><span class='dot token'>.</span><span class='add_named_filter identifier id'>add_named_filter</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a title="#group_by" href="#group_by-instance_method">#group_by</a></span><span class='args'>(column)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Specify a group_by clause for the resulting query.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a title="#limit" href="#limit-instance_method">#limit</a></span><span class='args'>(offset, limit = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Define an limit and/or offset for the results returned from the current
filter.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a title="#order" href="#order-instance_method">#order</a></span><span class='args'>(column, direction = :asc)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Define an order clause for the current query, with options for specifying
both the column to use as well as the direction.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h1>Public Instance Methods Inherited from <a title="RecordFilter::DSL::ConjunctionDSL" href="ConjunctionDSL.html">RecordFilter::DSL::ConjunctionDSL</a></h1>
    <p><span class='name'><a title="all_of" href="ConjunctionDSL.html#all_of-instance_method">all_of</a></span>, <span class='name'><a title="any_of" href="ConjunctionDSL.html#any_of-instance_method">any_of</a></span>, <span class='name'><a title="filter_class" href="ConjunctionDSL.html#filter_class-instance_method">filter_class</a></span>, <span class='name'><a title="having" href="ConjunctionDSL.html#having-instance_method">having</a></span>, <span class='name'><a title="join" href="ConjunctionDSL.html#join-instance_method">join</a></span>, <span class='name'><a title="none_of" href="ConjunctionDSL.html#none_of-instance_method">none_of</a></span>, <span class='name'><a title="not_all_of" href="ConjunctionDSL.html#not_all_of-instance_method">not_all_of</a></span>, <span class='name'><a title="on" href="ConjunctionDSL.html#on-instance_method">on</a></span>, <span class='name'><a title="with" href="ConjunctionDSL.html#with-instance_method">with</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>group_by</h3>
</div><div id="group_by-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>group_by</span><span class='args'>(column)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Specify a group_by clause for the resulting query. This method can only be
called in the outermost scope of a filter (i.e. not inside of a having
block, etc.). Multiple calls will create multiple group_by clauses in the
resulting query, and they will be added in the order in which they were
called in the filter. In order to specify grouping on columns added through
joins, a hash can be passed as the argument, specifying a path through the
joins to the column, as in this example:
</p>
<pre class="code">
  <span class='Blog constant id'>Blog</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span> <span class='do do kw'>do</span>
    <span class='having identifier id'>having</span><span class='lparen token'>(</span><span class='symbol val'>:posts</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='having identifier id'>having</span><span class='lparen token'>(</span><span class='symbol val'>:comments</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='symbol val'>:created_at</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='greater_than identifier id'>greater_than</span><span class='lparen token'>(</span><span class='float val'>3</span><span class='dot token'>.</span><span class='days identifier id'>days</span><span class='dot token'>.</span><span class='ago identifier id'>ago</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='group_by identifier id'>group_by</span><span class='lparen token'>(</span><span class='symbol val'>:posts</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:offensive</span><span class='rparen token'>)</span>
    <span class='group_by identifier id'>group_by</span><span class='lparen token'>(</span><span class='symbol val'>:id</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<h4>Parameters</h4>
<table>
<tr><td valign="top">column&lt;Symbol, Hash&gt;:</td><td>If a symbol is specified, it is taken to represent the name of a column on
the class being filtered. If a hash is given, it should represent a path
through the joins to a column in one of the joined tables.

</td></tr>
</table>
<h4>Returns</h4>
<p>
nil
</p>
<h4>Alternatives</h4>
<p>
As described above, it is possible to pass either a symbol or a hash as the
argument.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


106
107
108
109</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/record_filter/dsl/dsl.rb', line 106</span>

<span class='def def kw'>def</span> <span class='group_by identifier id'>group_by</span><span class='lparen token'>(</span><span class='column identifier id'>column</span><span class='rparen token'>)</span>
  <span class='@conjunction ivar id'>@conjunction</span><span class='dot token'>.</span><span class='add_group_by identifier id'>add_group_by</span><span class='lparen token'>(</span><span class='column identifier id'>column</span><span class='rparen token'>)</span>
  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>limit</h3>
</div><div id="limit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>limit</span><span class='args'>(offset, limit = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Define an limit and/or offset for the results returned from the current
filter. This method can only be called from the outermost scope of a filter
(i.e. not inside of a having block, etc.). If it is called multiple times,
the last one will override any others.
</p>
<h4>Parameters</h4>
<table>
<tr><td valign="top">offset&lt;Integer&gt;:</td><td>Used for the offset of the query.

</td></tr>
<tr><td valign="top">limit&lt;Integer:</td><td>Used as the limit for the query.

</td></tr>
</table>
<h4>Returns</h4>
<p>
nil
</p>
<h4>Alternatives</h4>
<p>
If called with a single argument, it is assumed to represent the limit, and
no offset will be specified.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


24
25
26
27
28
29
30
31</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/record_filter/dsl/dsl.rb', line 24</span>

<span class='def def kw'>def</span> <span class='limit identifier id'>limit</span><span class='lparen token'>(</span><span class='offset identifier id'>offset</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='limit identifier id'>limit</span>
    <span class='@conjunction ivar id'>@conjunction</span><span class='dot token'>.</span><span class='add_limit identifier id'>add_limit</span><span class='lparen token'>(</span><span class='limit identifier id'>limit</span><span class='comma token'>,</span> <span class='offset identifier id'>offset</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='@conjunction ivar id'>@conjunction</span><span class='dot token'>.</span><span class='add_limit identifier id'>add_limit</span><span class='lparen token'>(</span><span class='offset identifier id'>offset</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>order</h3>
</div><div id="order-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>order</span><span class='args'>(column, direction = :asc)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Define an order clause for the current query, with options for specifying
both the column to use as well as the direction. This method can only be
called in the outermost scope of a filter (i.e. not inside of a having
block, etc.). Multiple calls will create multiple order clauses in the
resulting query, and they will be added in the order in which they were
called in the filter. In order to specify ordering on columns added through
joins, a hash can be passed as the first argument, specifying a path
through the joins to the column, as in this example:
</p>
<pre class="code">
  <span class='Blog constant id'>Blog</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span> <span class='do do kw'>do</span>
    <span class='having identifier id'>having</span><span class='lparen token'>(</span><span class='symbol val'>:posts</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='having identifier id'>having</span><span class='lparen token'>(</span><span class='symbol val'>:comments</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='symbol val'>:created_at</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='greater_than identifier id'>greater_than</span><span class='lparen token'>(</span><span class='float val'>3</span><span class='dot token'>.</span><span class='days identifier id'>days</span><span class='dot token'>.</span><span class='ago identifier id'>ago</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='order identifier id'>order</span><span class='lparen token'>(</span><span class='symbol val'>:posts</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:created_at</span><span class='comma token'>,</span> <span class='symbol val'>:desc</span><span class='rparen token'>)</span>
    <span class='order identifier id'>order</span><span class='lparen token'>(</span><span class='symbol val'>:id</span><span class='comma token'>,</span> <span class='symbol val'>:asc</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<h4>Parameters</h4>
<table>
<tr><td valign="top">column&lt;Symbol, Hash&gt;:</td><td>Specify the column for the ordering. If a symbol is given, it is assumed to
represent a column in the class that is being filtered. With a hash
argument, it is possible to specify a path to a column in one of the joined
tables, as seen above.

</td></tr>
<tr><td valign="top">direction&lt;Symbol&gt;:</td><td>Specifies the direction of the join. Should be either :asc or :desc and
defaults to :asc.

</td></tr>
</table>
<h4>Returns</h4>
<p>
nil
</p>
<h4>Raises</h4>
<table>
<tr><td valign="top">InvalidFilterException:</td><td>If the direction is neither :asc nor :desc.

</td></tr>
</table>
<h4>Alternatives</h4>
<p>
As described above, it is possible to pass either a symbol or a hash as the
first argument.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


70
71
72
73
74
75
76</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/record_filter/dsl/dsl.rb', line 70</span>

<span class='def def kw'>def</span> <span class='order identifier id'>order</span><span class='lparen token'>(</span><span class='column identifier id'>column</span><span class='comma token'>,</span> <span class='direction identifier id'>direction</span><span class='assign token'>=</span><span class='symbol val'>:asc</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='lbrack token'>[</span><span class='colon op'>:</span><span class='asc identifier id'>asc</span><span class='comma token'>,</span> <span class='symbol val'>:desc</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='direction identifier id'>direction</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='InvalidFilterException constant id'>InvalidFilterException</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;The direction for orders must be either :asc or :desc but was #{direction}&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='@conjunction ivar id'>@conjunction</span><span class='dot token'>.</span><span class='add_order identifier id'>add_order</span><span class='lparen token'>(</span><span class='column identifier id'>column</span><span class='comma token'>,</span> <span class='direction identifier id'>direction</span><span class='rparen token'>)</span>
  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>