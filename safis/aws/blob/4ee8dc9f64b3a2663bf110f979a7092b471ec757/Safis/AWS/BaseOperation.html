<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>safis's aws - Class: Safis::AWS::BaseOperation - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/safis/commits/aws/master" rel="alternate" title="Recent Commits to aws:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("safis", "aws", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("safis", "aws", "4ee8dc9f64b3a2663bf110f979a7092b471ec757", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/safis/aws/tree/">Source</a></li>
            <li class=""><a href="http://github.com/safis/aws/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/safis/aws/network">Network</a></li>            
            <li class=""><a href="http://github.com/safis/aws/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/safis/aws">Wiki</a></li>
            <li class=""><a href="http://github.com/safis/aws/graphs">Graphs</a></li>                    
            <li class="active"><a href="/safis/aws">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/safis">safis</a> / <b><a href="http://github.com/safis/aws/tree">aws</a></b>        
                <a id="namespaces_button" rel="safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Safis_AWS_BaseOperation">
  <h1>Class: Safis::AWS::BaseOperation</h1>
  <div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(requester, signer)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates a new operation object
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    
      <dt>
        <span class='type'>[<tt>Requester</tt>]</span>
        <span class='name'>requester</span>
        
      </dt>
      <dd>
        <span class='desc'><p>
The requester that should be used for this operation.
</p>
</span>
      </dd>
    
  
    
      <dt>
        <span class='type'>[<tt><a href="Signer.html" title="Signer">Signer</a></tt>]</span>
        <span class='name'>signer</span>
        
      </dt>
      <dd>
        <span class='desc'><p>
The request signer that should be used for this operation.
</p>
</span>
      </dd>
    
  
  </dl>
</div>
</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/safis/aws/base_operation.rb', line 28</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757/lib/safis/aws/base_operation.rb#L28">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">28
29
30
31
32
33
34
35
36</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='requester identifier id'>requester</span><span class='comma token'>,</span> <span class='signer identifier id'>signer</span><span class='rparen token'>)</span>
  <span class='@requester ivar id'>@requester</span> <span class='assign token'>=</span> <span class='requester identifier id'>requester</span>
  <span class='@signer ivar id'>@signer</span>    <span class='assign token'>=</span> <span class='signer identifier id'>signer</span>
  
  <span class='@response_mutex ivar id'>@response_mutex</span> <span class='assign token'>=</span> <span class='Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='@response ivar id'>@response</span>       <span class='assign token'>=</span> <span class='Response constant id'>Response</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='comment val'># Map Curl::Easy handles to their original request objects</span>
  <span class='@request_map ivar id'>@request_map</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_request-instance_method">#build_request</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Builds a request.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#flush-instance_method">#flush</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Waits for all requests to finish processing, and returns their responses.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#process_request-instance_method">#process_request</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Processes a request, if there is one to process.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>build_request</h3>
</div><div id="build_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_request</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds a request.
</p>
<p>
By default, just returns a new RESTRequest
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/safis/aws/base_operation.rb', line 41</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757/lib/safis/aws/base_operation.rb#L41">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">41
42
43</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_request identifier id'>build_request</span>
  <span class='return return kw'>return</span> <span class='RESTRequest constant id'>RESTRequest</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>flush</h3>
</div><div id="flush-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>flush</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Waits for all requests to finish processing, and returns their responses
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/safis/aws/base_operation.rb', line 80</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757/lib/safis/aws/base_operation.rb#L80">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='flush identifier id'>flush</span>
    <span class='comment val'># flush any remaining requests</span>
    <span class='while while kw'>while</span> <span class='lparen token'>(</span> <span class='true true kw'>true</span> <span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='process_request identifier id'>process_request</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='end end kw'>end</span>
    
    <span class='@requester ivar id'>@requester</span><span class='dot token'>.</span><span class='block_until_done identifier id'>block_until_done</span>
    
    <span class='comment val'># fill in the response time</span>
    <span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='response_time identifier id'>response_time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='minus op'>-</span> <span class='@request_start ivar id'>@request_start</span>
    
    <span class='return return kw'>return</span> <span class='@response ivar id'>@response</span>
  <span class='end end kw'>end</span>
  
<span class='protected identifier id'>protected</span>
  <span class='comment val'># Appends data onto this operation, to be executed via build_request</span>
  <span class='def def kw'>def</span> <span class='append identifier id'>append</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Appends response data to a response body.</span>
  <span class='comment val'># </span>
  <span class='comment val'># @param [Object] response_body  The response body to append to.</span>
  <span class='comment val'># @param [Nokogiri::XML] response_doc  Response data to parse.</span>
  <span class='comment val'># @param [Curl::Easy] request  The request that this is in response to.</span>
  <span class='def def kw'>def</span> <span class='append_response identifier id'>append_response</span><span class='lparen token'>(</span><span class='response_body identifier id'>response_body</span><span class='comma token'>,</span> <span class='response_doc identifier id'>response_doc</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='response_body identifier id'>response_body</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'>###################</span>
  <span class='comment val'># Utility Methods #</span>
  <span class='comment val'>###################</span>
  
  <span class='comment val'># Parses a request and appends it onto the response object</span>
  <span class='comment val'># </span>
  <span class='comment val'># @param [Curl::Easy] request  The request to parse</span>
  <span class='def def kw'>def</span> <span class='handle_successful_response identifier id'>handle_successful_response</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
    <span class='log identifier id'>log</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Got a successful response in #{request.total_time.round(4)} seconds.&quot;</span>
    
    <span class='response_doc identifier id'>response_doc</span> <span class='assign token'>=</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='dot token'>.</span><span class='body_str identifier id'>body_str</span><span class='rparen token'>)</span>
    
    <span class='comment val'># Grab the response metadata</span>
    <span class='request_id identifier id'>request_id</span> <span class='assign token'>=</span> <span class='response_doc identifier id'>response_doc</span><span class='dot token'>.</span><span class='css identifier id'>css</span><span class='lparen token'>(</span><span class='string val'>'ResponseMetadata RequestId'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
    <span class='box_usage identifier id'>box_usage</span>  <span class='assign token'>=</span> <span class='response_doc identifier id'>response_doc</span><span class='dot token'>.</span><span class='css identifier id'>css</span><span class='lparen token'>(</span><span class='string val'>'ResponseMetadata BoxUsage'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
    
    <span class='@response_mutex ivar id'>@response_mutex</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='do do kw'>do</span>
      <span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='request_ids identifier id'>request_ids</span> <span class='lshft op'>&lt;&lt;</span> <span class='request_id identifier id'>request_id</span>
      <span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='box_usage identifier id'>box_usage</span> <span class='opasgn op'>+=</span> <span class='box_usage identifier id'>box_usage</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
      
      <span class='comment val'># and append to the response body</span>
      <span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='body identifier id'>body</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='append_response identifier id'>append_response</span><span class='lparen token'>(</span><span class='@response ivar id'>@response</span><span class='dot token'>.</span><span class='body identifier id'>body</span><span class='comma token'>,</span> <span class='response_doc identifier id'>response_doc</span><span class='comma token'>,</span> <span class='@request_map ivar id'>@request_map</span><span class='lbrack token'>[</span><span class='request identifier id'>request</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      
      <span class='@request_map ivar id'>@request_map</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Parses a request and appropriately handles things</span>
  <span class='comment val'># </span>
  <span class='comment val'># @param [Curl::Easy] request  The request to parse</span>
  <span class='def def kw'>def</span> <span class='handle_failed_response identifier id'>handle_failed_response</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
    <span class='begin begin kw'>begin</span>
      <span class='error_doc identifier id'>error_doc</span> <span class='assign token'>=</span> <span class='Nokogiri constant id'>Nokogiri</span><span class='colon2 op'>::</span><span class='XML constant id'>XML</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='dot token'>.</span><span class='body_str identifier id'>body_str</span><span class='rparen token'>)</span>
      
      <span class='comment val'># What sort of error do we have?</span>
      <span class='error_code identifier id'>error_code</span> <span class='assign token'>=</span> <span class='error_doc identifier id'>error_doc</span><span class='dot token'>.</span><span class='css identifier id'>css</span><span class='lparen token'>(</span><span class='string val'>'Error Code'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
      <span class='message identifier id'>message</span>    <span class='assign token'>=</span> <span class='error_doc identifier id'>error_doc</span><span class='dot token'>.</span><span class='css identifier id'>css</span><span class='lparen token'>(</span><span class='string val'>'Error Message'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
      <span class='request_id identifier id'>request_id</span> <span class='assign token'>=</span> <span class='error_doc identifier id'>error_doc</span><span class='dot token'>.</span><span class='css identifier id'>css</span><span class='lparen token'>(</span><span class='string val'>'RequestID'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
      
      <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='AWSError constant id'>AWSError</span><span class='dot token'>.</span><span class='error identifier id'>error</span><span class='lparen token'>(</span><span class='error_code identifier id'>error_code</span><span class='comma token'>,</span> <span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='request_id identifier id'>request_id</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='response_code identifier id'>response_code</span><span class='rparen token'>)</span>
    
    <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
      <span class='log identifier id'>log</span><span class='dot token'>.</span><span class='error identifier id'>error</span> <span class='string val'>'Encountered an error on the request, and unable to parse/determine the error type'</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
      <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='AWSError constant id'>AWSError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='err identifier id'>err</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    
    <span class='log identifier id'>log</span><span class='dot token'>.</span><span class='error identifier id'>error</span> <span class='string val'>'Encountered an error on the request'</span><span class='comma token'>,</span> <span class='error identifier id'>error</span>
    <span class='raise identifier id'>raise</span> <span class='error identifier id'>error</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>process_request</h3>
</div><div id="process_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>process_request</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Processes a request, if there is one to process.
</p>
<p>
This asks build_request for something to process.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/safis/aws/base_operation.rb', line 48</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/safis/aws/blob/4ee8dc9f64b3a2663bf110f979a7092b471ec757/lib/safis/aws/base_operation.rb#L48">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='process_request identifier id'>process_request</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='build_request identifier id'>build_request</span>
  
  <span class='if if kw'>if</span> <span class='lparen token'>(</span> <span class='request identifier id'>request</span> <span class='rparen token'>)</span> <span class='then then kw'>then</span>
    <span class='log identifier id'>log</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='string val'>'Initiating request.'</span>
    
    <span class='comment val'># if this is the first request, start the timer</span>
    <span class='@request_start ivar id'>@request_start</span> <span class='opasgn op'>||=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
    
    <span class='easy identifier id'>easy</span> <span class='assign token'>=</span> <span class='@signer ivar id'>@signer</span><span class='dot token'>.</span><span class='convert_request identifier id'>convert_request</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
    <span class='@request_map ivar id'>@request_map</span><span class='lbrack token'>[</span><span class='easy identifier id'>easy</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='request identifier id'>request</span>
    
    <span class='comment val'># set up our event handler</span>
    <span class='easy identifier id'>easy</span><span class='dot token'>.</span><span class='on_complete identifier id'>on_complete</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='request identifier id'>request</span><span class='bitor op'>|</span>
      <span class='comment val'># Was this a 200?</span>
      <span class='if if kw'>if</span> <span class='lparen token'>(</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='response_code identifier id'>response_code</span> <span class='geq op'>&gt;=</span> <span class='integer val'>200</span> <span class='and and kw'>and</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='response_code identifier id'>response_code</span> <span class='leq op'>&lt;=</span> <span class='integer val'>299</span> <span class='rparen token'>)</span> <span class='then then kw'>then</span>
        <span class='comment val'># process the response</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='handle_successful_response identifier id'>handle_successful_response</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
        
      <span class='else else kw'>else</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='handle_failed_response identifier id'>handle_failed_response</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    
    <span class='comment val'># and start the request</span>
    <span class='@requester ivar id'>@requester</span><span class='dot token'>.</span><span class='process_async identifier id'>process_async</span><span class='lparen token'>(</span><span class='easy identifier id'>easy</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='return return kw'>return</span> <span class='request identifier id'>request</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>