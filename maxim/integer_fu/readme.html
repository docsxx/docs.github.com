<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <h1>integer_fu</h1>
<p>
Allows conveniently storing many boolean values (such as checkboxes) in a
single integer field in database. You don&#8217;t have to create new
columns for every boolean value (or every checkbox) that you may add in the
future.
</p>
<h2>Install</h2>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='maxim identifier id'>maxim</span><span class='div op'>/</span><span class='integer_fu identifier id'>integer_fu</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<h2>Usage</h2>
<p>
Let&#8217;s say you have a model called Horse. You want to index all your
horses in your database, including their special characteristics.
Let&#8217;s say your horses can be happy, smug, or fluffy. In fact, a
single horse can be both happy and fluffy, as well as smug and fluffy, or
any other combination for that sake. Looks like if you were to make a form
to input this data, you&#8217;d probably use checkboxes.
</p>
<p>
So you have three values that could be true or false. Usually in your
database you&#8217;d need to create 3 boolean columns: happy, smug, and
fluffy. But that&#8217;s too much work. Imagine if you add new traits
often. You would have to change table structure every time for new columns.
Bleh. With this plugin all you need to have is a single integer column, for
example &quot;traits&quot;. Assuming you have that column, let&#8217;s make
use of this plugin.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Horse constant id'>Horse</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='map_integer identifier id'>map_integer</span> <span class='symbol val'>:traits</span><span class='comma token'>,</span> <span class='symbol val'>:values</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:happy</span><span class='comma token'>,</span> <span class='symbol val'>:smug</span><span class='comma token'>,</span> <span class='symbol val'>:fluffy</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
</pre>
<p>
We just mapped 3 possible traits to a horse. It&#8217;s important to note
that order matters. Once you put :happy first, you should never move it to
any other position. If you swap :happy and :smug - every horse that used to
be :smug will become :happy and vice versa. You CAN however add more
traits! (It&#8217;d be kinda dull otherwise.) If in the future you find
that horses are sometimes gluttonous - you can easily append :gluttonous to
the end of this array without breaking anything.
</p>
<h2>New behavior for your integer attribute</h2>
<p>
Now that we mapped the &#8216;traits&#8217; attribute to your desired
values, what do you get? That&#8217;s right, lots of convenient accessor
options. Here&#8217;s an example.
</p>
<pre class="code">
  <span class='@horse ivar id'>@horse</span> <span class='assign token'>=</span> <span class='Horse constant id'>Horse</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span>                   <span class='comment val'># =&gt; nil</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lbrack token'>[</span><span class='symbol val'>:happy</span><span class='rbrack token'>]</span>           <span class='comment val'># =&gt; false</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lbrack token'>[</span><span class='symbol val'>:smug</span><span class='rbrack token'>]</span>            <span class='comment val'># =&gt; false</span>
</pre>
<p>
Let&#8217;s mark the horse happy.
</p>
<pre class="code">
  <span class='comment val'># one way to mark a horse</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='lshft op'>&lt;&lt;</span> <span class='symbol val'>:happy</span>         <span class='comment val'># =&gt; 1</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span>                   <span class='comment val'># =&gt; 1</span>

  <span class='comment val'># another way to mark a horse (you can use arrays of values too)</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='opasgn op'>+=</span> <span class='symbol val'>:fluffy</span>        <span class='comment val'># =&gt; 5</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span>                   <span class='comment val'># =&gt; 5</span>

  <span class='comment val'># last but not least, there are some hash-like accessors, as well as magic ones</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lbrack token'>[</span><span class='symbol val'>:smug</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='true true kw'>true</span>    <span class='comment val'># =&gt; true</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='smug identifier id'>smug</span>    <span class='assign token'>=</span> <span class='false false kw'>false</span>   <span class='comment val'># =&gt; false</span>
</pre>
<p>
It shouldn&#8217;t really matter to you as a programmer which integer the
attribute was set to. All you need to know is that the horse is happy and
fluffy. You have multiple ways to find out if that&#8217;s the case:
</p>
<pre class="code">
  <span class='comment val'># efficient way</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lbrack token'>[</span><span class='symbol val'>:happy</span><span class='rbrack token'>]</span>           <span class='comment val'># =&gt; true</span>

  <span class='comment val'># this is slower as it relies upon method_missing</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='fluffy? fid id'>fluffy?</span>           <span class='comment val'># =&gt; true</span>

  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:happy</span><span class='rparen token'>)</span>  <span class='comment val'># =&gt; true</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>              <span class='comment val'># =&gt; [:happy, :fluffy]</span>
</pre>
<p>
It&#8217;s also possible to put multiple values in brakets. In that case
you will only get true if ALL of the traits are present.
</p>
<pre class="code">
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lbrack token'>[</span><span class='symbol val'>:happy</span><span class='comma token'>,</span> <span class='symbol val'>:fluffy</span><span class='rbrack token'>]</span>  <span class='comment val'># =&gt; true</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lbrack token'>[</span><span class='symbol val'>:happy</span><span class='comma token'>,</span> <span class='symbol val'>:smug</span><span class='rbrack token'>]</span>    <span class='comment val'># =&gt; false</span>
</pre>
<p>
Alrighty. Now let&#8217;s say the fluffy horse has become quite depressed
lately. We need to remove the :happy trait.
</p>
<pre class="code">
  <span class='comment val'># just subtract the trait</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='opasgn op'>-=</span> <span class='symbol val'>:happy</span>         <span class='comment val'># =&gt; 4</span>
</pre>
<p>
Now say you just want to give your horse a whole different array of traits.
Or hash. These are useful when working with submitted checkbox values.
</p>
<pre class="code">
  <span class='comment val'># simply set the traits to desired array</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>&quot;fluffy&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;smug&quot;</span><span class='rbrack token'>]</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span>                   <span class='comment val'># =&gt; 6</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>              <span class='comment val'># =&gt; [:smug, :fluffy]</span>

  <span class='comment val'># hash also works, but it only sets keys if the value of that key evaluates to true</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='string val'>&quot;fluffy&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;foo&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;smug&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='rbrace token'>}</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span>                   <span class='comment val'># =&gt; 4</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>              <span class='comment val'># =&gt; [:fluffy] (value of &quot;smug&quot; was false, hence only :fluffy was set)</span>
</pre>
<h2>New instance methods</h2>
<p>
Along with having traits, the @horse will not have specialized attributes
for each trait.
</p>
<pre class="code">
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits_fluffy identifier id'>traits_fluffy</span>  <span class='comment val'># =&gt; true</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits_happy identifier id'>traits_happy</span>   <span class='comment val'># =&gt; false</span>
</pre>
<p>
This helps creating checkboxes for Horse model, as follows.
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>%= f.label :traits_fluffy, 'Fluffy' %&gt;
  &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='check_box identifier id'>check_box</span> <span class='symbol val'>:traits_fluffy</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

  <span class='lt op'>&lt;</span><span class='string val'>%= f.label :traits_happy, 'Happy' %&gt;
  &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='check_box identifier id'>check_box</span> <span class='symbol val'>:traits_happy</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
</pre>
<h2>Finding fluffy horse in the database</h2>
<p>
Integer_fu provides an efficient and flexible way to find all matching
horses in database. Here&#8217;s how you find :happy AND :fluffy horses:
</p>
<pre class="code">
  <span class='Horse constant id'>Horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lparen token'>(</span><span class='symbol val'>:happy</span><span class='comma token'>,</span> <span class='symbol val'>:fluffy</span><span class='rparen token'>)</span>   <span class='comment val'># =&gt; []</span>
</pre>
<p>
This will find every horse that&#8217;s both happy and fluffy. Since this
is actually a proper named scope you can chain it with your own finders and
scopes.
</p>
<pre class="code">
  <span class='Horse constant id'>Horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='lparen token'>(</span><span class='symbol val'>:happy</span><span class='comma token'>,</span> <span class='symbol val'>:fluffy</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='lbrace token'>{</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='dot3 op'>...</span><span class='rbrace token'>}</span> <span class='rbrace token'>}</span>
</pre>
<p>
How cool is that?
</p>
<h2>That&#8217;s not all</h2>
<p>
Your traits attribute is now enumerable (although not sortable). It means
you can do this:
</p>
<pre class="code">
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='trait identifier id'>trait</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{trait} horse&quot;</span> <span class='rbrace token'>}</span>  <span class='comment val'># =&gt; [&quot;smug horse&quot;, &quot;fluffy horse&quot;]</span>
</pre>
<h2>How about old integer behavior?</h2>
<p>
Now, I probably haven&#8217;t covered all corners here, but for most
imaginable tasks your attribute still behaves like an integer.
</p>
<pre class="code">
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span>       <span class='comment val'># =&gt; 6</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>  <span class='comment val'># =&gt; [:smug, :fluffy]</span>

  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>  <span class='comment val'># =&gt; 7</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>  <span class='comment val'># =&gt; [:happy, :smug, :fluffy]</span>

  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='gt op'>&gt;</span> <span class='integer val'>5</span>   <span class='comment val'># true</span>
  <span class='@horse ivar id'>@horse</span><span class='dot token'>.</span><span class='traits identifier id'>traits</span> <span class='eq op'>==</span> <span class='integer val'>7</span>  <span class='comment val'># true</span>
</pre>
<p>
And so on.
</p>
<h2>Important little details</h2>
<p>
Above I show you how to add and remove traits using the + and - operators.
They work with either arrays or separate values. However, when you add new
values, they will be added only if they don&#8217;t already exist in the
traits. Respectively, if you subtract values, they only get subtracted if
they do exist.
</p>
<h2>TODO</h2>
<p>
Write tests!!!
</p>
<h2>License</h2>
<p>
Copyright &#169; 2009 Maxim Chernyak
</p>
<p>
Permission is hereby granted, free of charge, to any person obtaining a
copy of this software and associated documentation files (the
&quot;Software&quot;), to deal in the Software without restriction,
including without limitation the rights to use, copy, modify, merge,
publish, distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to the
following conditions:
</p>
<p>
The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.
</p>
<p>
THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN
NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR
OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE
USE OR OTHER DEALINGS IN THE SOFTWARE.
</p>

      </div>
    </div>
  </body>
</html>