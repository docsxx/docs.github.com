<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>technoweenie's attachment_fu - Module: Technoweenie::AttachmentFu::InstanceMethods - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/technoweenie/commits/attachment_fu/master" rel="alternate" title="Recent Commits to attachment_fu:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("technoweenie", "attachment_fu", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("technoweenie", "attachment_fu", "fa08cb03914b02b66853b4615cd3eca768291ca7", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/tree/">Source</a></li>
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/network">Network</a></li>            
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/technoweenie/attachment_fu">Wiki</a></li>
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/graphs">Graphs</a></li>                    
            <li class="active"><a href="/technoweenie/attachment_fu">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/technoweenie">technoweenie</a> / <b><a href="http://github.com/technoweenie/attachment_fu/tree">attachment_fu</a></b>        
                <a id="namespaces_button" rel="technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Technoweenie_AttachmentFu_InstanceMethods">
  <h1>Module: Technoweenie::AttachmentFu::InstanceMethods</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#included-class_method">included</span><span class='args'>(base)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#content_type-3D-instance_method">#content_type=</span><span class='args'>(new_type)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets the content type.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#copy_to_temp_file-instance_method">#copy_to_temp_file</span><span class='args'>(file)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Copies the given file to a randomly named Tempfile.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_or_update_thumbnail-instance_method">#create_or_update_thumbnail</span><span class='args'>(temp_file, file_name_suffix, *size)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates or updates the thumbnail for the current attachment.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_temp_file-instance_method">#create_temp_file</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Stub for creating a temp file from the attachment data.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#filename-3D-instance_method">#filename=</span><span class='args'>(new_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sanitizes a filename.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image-3F-instance_method">#image?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks whether the attachment&#8217;s content type is an image content
type.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_size-instance_method">#image_size</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the width/height in a suitable format for the image_tag helper:
(100x100).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#save_attachment-3F-instance_method">#save_attachment?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if the attachment data will be written to the storage system
on the next save.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_temp_data-instance_method">#set_temp_data</span><span class='args'>(data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Writes the given data to a Tempfile and adds it to the collection of temp
files.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#temp_data-instance_method">#temp_data</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Gets the data from the latest temp file.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#temp_path-instance_method">#temp_path</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Gets the latest temp path from the collection of temp paths.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#temp_paths-instance_method">#temp_paths</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Gets an array of the currently used temp paths.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#thumbnail_class-instance_method">#thumbnail_class</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the class used to create new thumbnails for this attachment.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#thumbnail_name_for-instance_method">#thumbnail_name_for</span><span class='args'>(thumbnail = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Gets the thumbnail name for a filename.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#thumbnailable-3F-instance_method">#thumbnailable?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true/false if an attachment is thumbnailable.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#uploaded_data-instance_method">#uploaded_data</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
nil placeholder in case this field is used in a form.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#uploaded_data-3D-instance_method">#uploaded_data=</span><span class='args'>(file_data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method handles the uploaded file object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#with_image-instance_method">#with_image</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Allows you to work with a processed representation (RMagick, ImageScience,
etc) of the attachment in a block.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#write_to_temp_file-instance_method">#write_to_temp_file</span><span class='args'>(data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Writes the given file to a randomly named Tempfile.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>included</h3>
</div><div id="included-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>included</span><span class='args'>(base)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 257</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L257">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">257
258
259</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='included identifier id'>included</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='define_callbacks identifier id'>define_callbacks</span> <span class='mult op'>*</span><span class='lbrack token'>[</span><span class='symbol val'>:after_resize</span><span class='comma token'>,</span> <span class='symbol val'>:after_attachment_saved</span><span class='comma token'>,</span> <span class='symbol val'>:before_thumbnail_saved</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:define_callbacks</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>content_type=</h3>
</div><div id="content_type-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>content_type=</span><span class='args'>(new_type)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets the content type.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 304</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L304">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">304
305
306</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='content_type= identifier id'>content_type=</span><span class='lparen token'>(</span><span class='new_type identifier id'>new_type</span><span class='rparen token'>)</span>
  <span class='write_attribute identifier id'>write_attribute</span> <span class='symbol val'>:content_type</span><span class='comma token'>,</span> <span class='new_type identifier id'>new_type</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>copy_to_temp_file</h3>
</div><div id="copy_to_temp_file-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>copy_to_temp_file</span><span class='args'>(file)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Copies the given file to a randomly named Tempfile.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 382</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L382">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">382
383
384</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='copy_to_temp_file identifier id'>copy_to_temp_file</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='copy_to_temp_file identifier id'>copy_to_temp_file</span> <span class='file identifier id'>file</span><span class='comma token'>,</span> <span class='random_tempfile_filename identifier id'>random_tempfile_filename</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_or_update_thumbnail</h3>
</div><div id="create_or_update_thumbnail-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_or_update_thumbnail</span><span class='args'>(temp_file, file_name_suffix, *size)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates or updates the thumbnail for the current attachment.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 289</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L289">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">289
290
291
292
293
294
295
296
297
298
299
300
301</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_or_update_thumbnail identifier id'>create_or_update_thumbnail</span><span class='lparen token'>(</span><span class='temp_file identifier id'>temp_file</span><span class='comma token'>,</span> <span class='file_name_suffix identifier id'>file_name_suffix</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='size identifier id'>size</span><span class='rparen token'>)</span>
  <span class='thumbnailable? fid id'>thumbnailable?</span> <span class='orop op'>||</span> <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='ThumbnailError constant id'>ThumbnailError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;Can't create a thumbnail if the content type is not an image or there is no parent_id column&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='returning identifier id'>returning</span> <span class='find_or_initialize_thumbnail identifier id'>find_or_initialize_thumbnail</span><span class='lparen token'>(</span><span class='file_name_suffix identifier id'>file_name_suffix</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='thumb identifier id'>thumb</span><span class='bitor op'>|</span>
    <span class='thumb identifier id'>thumb</span><span class='dot token'>.</span><span class='temp_paths identifier id'>temp_paths</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='temp_file identifier id'>temp_file</span>
    <span class='thumb identifier id'>thumb</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:'attributes='</span><span class='comma token'>,</span> <span class='lbrace token'>{</span>
      <span class='symbol val'>:content_type</span>             <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span>
      <span class='symbol val'>:filename</span>                 <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='thumbnail_name_for identifier id'>thumbnail_name_for</span><span class='lparen token'>(</span><span class='file_name_suffix identifier id'>file_name_suffix</span><span class='rparen token'>)</span><span class='comma token'>,</span>
      <span class='symbol val'>:thumbnail_resize_options</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='size identifier id'>size</span>
    <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
    <span class='callback_with_args identifier id'>callback_with_args</span> <span class='symbol val'>:before_thumbnail_saved</span><span class='comma token'>,</span> <span class='thumb identifier id'>thumb</span>
    <span class='thumb identifier id'>thumb</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_temp_file</h3>
</div><div id="create_temp_file-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_temp_file</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Stub for creating a temp file from the attachment data. This should be
defined in the backend module.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 392</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L392">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_temp_file identifier id'>create_temp_file</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='end end kw'>end</span>

  <span class='comment val'># Allows you to work with a processed representation (RMagick, ImageScience, etc) of the attachment in a block.</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   @attachment.with_image do |img|</span>
  <span class='comment val'>#     self.data = img.thumbnail(100, 100).to_blob</span>
  <span class='comment val'>#   end</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='with_image identifier id'>with_image</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='with_image identifier id'>with_image</span><span class='lparen token'>(</span><span class='temp_path identifier id'>temp_path</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='protected identifier id'>protected</span>
    <span class='comment val'># Generates a unique filename for a Tempfile.</span>
    <span class='def def kw'>def</span> <span class='random_tempfile_filename identifier id'>random_tempfile_filename</span>
      <span class='dstring node'>&quot;#{rand Time.now.to_i}#{filename || 'attachment'}&quot;</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='sanitize_filename identifier id'>sanitize_filename</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='filename identifier id'>filename</span>
      <span class='returning identifier id'>returning</span> <span class='filename identifier id'>filename</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='bitor op'>|</span>
        <span class='comment val'># NOTE: File.basename doesn't work right with Windows paths on Unix</span>
        <span class='comment val'># get only the filename, not the whole path</span>
        <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span> <span class='regexp val'>/^.*(\\|\/)/</span><span class='comma token'>,</span> <span class='string val'>''</span>

        <span class='comment val'># Finally, replace all non alphanumeric, underscore or periods with underscore</span>
        <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span> <span class='regexp val'>/[^A-Za-z0-9\.\-]/</span><span class='comma token'>,</span> <span class='string val'>'_'</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># before_validation callback.</span>
    <span class='def def kw'>def</span> <span class='set_size_from_temp_path identifier id'>set_size_from_temp_path</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='lparen token'>(</span><span class='temp_path identifier id'>temp_path</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='save_attachment? fid id'>save_attachment?</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># validates the size and content_type attributes according to the current model's options</span>
    <span class='def def kw'>def</span> <span class='attachment_attributes_valid? fid id'>attachment_attributes_valid?</span>
      <span class='lbrack token'>[</span><span class='symbol val'>:size</span><span class='comma token'>,</span> <span class='symbol val'>:content_type</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='attr_name identifier id'>attr_name</span><span class='bitor op'>|</span>
        <span class='enum identifier id'>enum</span> <span class='assign token'>=</span> <span class='attachment_options identifier id'>attachment_options</span><span class='lbrack token'>[</span><span class='attr_name identifier id'>attr_name</span><span class='rbrack token'>]</span>
        <span class='if if kw'>if</span> <span class='Object constant id'>Object</span><span class='dot token'>.</span><span class='const_defined? fid id'>const_defined?</span><span class='lparen token'>(</span><span class='symbol val'>:I18n</span><span class='rparen token'>)</span> <span class='comment val'># Rails &gt;= 2.2</span>
          <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='I18n constant id'>I18n</span><span class='dot token'>.</span><span class='translate identifier id'>translate</span><span class='lparen token'>(</span><span class='string val'>&quot;activerecord.errors.messages.inclusion&quot;</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='enum identifier id'>enum</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='else else kw'>else</span>
          <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:inclusion</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Initializes a new thumbnail with the given suffix.</span>
    <span class='def def kw'>def</span> <span class='find_or_initialize_thumbnail identifier id'>find_or_initialize_thumbnail</span><span class='lparen token'>(</span><span class='file_name_suffix identifier id'>file_name_suffix</span><span class='rparen token'>)</span>
      <span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:parent_id</span><span class='rparen token'>)</span> <span class='question op'>?</span>
        <span class='thumbnail_class identifier id'>thumbnail_class</span><span class='dot token'>.</span><span class='find_or_initialize_by_thumbnail_and_parent_id identifier id'>find_or_initialize_by_thumbnail_and_parent_id</span><span class='lparen token'>(</span><span class='file_name_suffix identifier id'>file_name_suffix</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='id identifier id'>id</span><span class='rparen token'>)</span> <span class='colon op'>:</span>
        <span class='thumbnail_class identifier id'>thumbnail_class</span><span class='dot token'>.</span><span class='find_or_initialize_by_thumbnail identifier id'>find_or_initialize_by_thumbnail</span><span class='lparen token'>(</span><span class='file_name_suffix identifier id'>file_name_suffix</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Stub for a #process_attachment method in a processor</span>
    <span class='def def kw'>def</span> <span class='process_attachment identifier id'>process_attachment</span>
      <span class='@saved_attachment ivar id'>@saved_attachment</span> <span class='assign token'>=</span> <span class='save_attachment? fid id'>save_attachment?</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Cleans up after processing.  Thumbnails are created, the attachment is stored to the backend, and the temp_paths are cleared.</span>
    <span class='def def kw'>def</span> <span class='after_process_attachment identifier id'>after_process_attachment</span>
      <span class='if if kw'>if</span> <span class='@saved_attachment ivar id'>@saved_attachment</span>
        <span class='if if kw'>if</span> <span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:process_attachment_with_processing</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='thumbnailable? fid id'>thumbnailable?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='attachment_options identifier id'>attachment_options</span><span class='lbrack token'>[</span><span class='symbol val'>:thumbnails</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='andop op'>&amp;&amp;</span> <span class='parent_id identifier id'>parent_id</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
          <span class='temp_file identifier id'>temp_file</span> <span class='assign token'>=</span> <span class='temp_path identifier id'>temp_path</span> <span class='orop op'>||</span> <span class='create_temp_file identifier id'>create_temp_file</span>
          <span class='attachment_options identifier id'>attachment_options</span><span class='lbrack token'>[</span><span class='symbol val'>:thumbnails</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='suffix identifier id'>suffix</span><span class='comma token'>,</span> <span class='size identifier id'>size</span><span class='bitor op'>|</span> <span class='create_or_update_thumbnail identifier id'>create_or_update_thumbnail</span><span class='lparen token'>(</span><span class='temp_file identifier id'>temp_file</span><span class='comma token'>,</span> <span class='suffix identifier id'>suffix</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='size identifier id'>size</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
        <span class='end end kw'>end</span>
        <span class='save_to_storage identifier id'>save_to_storage</span>
        <span class='@temp_paths ivar id'>@temp_paths</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
        <span class='@saved_attachment ivar id'>@saved_attachment</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='callback identifier id'>callback</span> <span class='symbol val'>:after_attachment_saved</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Resizes the given processed img object with either the attachment resize options or the thumbnail resize options.</span>
    <span class='def def kw'>def</span> <span class='resize_image_or_thumbnail! fid id'>resize_image_or_thumbnail!</span><span class='lparen token'>(</span><span class='img identifier id'>img</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='notop op'>!</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:parent_id</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='parent_id identifier id'>parent_id</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='attachment_options identifier id'>attachment_options</span><span class='lbrack token'>[</span><span class='symbol val'>:resize_to</span><span class='rbrack token'>]</span> <span class='comment val'># parent image</span>
        <span class='resize_image identifier id'>resize_image</span><span class='lparen token'>(</span><span class='img identifier id'>img</span><span class='comma token'>,</span> <span class='attachment_options identifier id'>attachment_options</span><span class='lbrack token'>[</span><span class='symbol val'>:resize_to</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='elsif elsif kw'>elsif</span> <span class='thumbnail_resize_options identifier id'>thumbnail_resize_options</span> <span class='comment val'># thumbnail</span>
        <span class='resize_image identifier id'>resize_image</span><span class='lparen token'>(</span><span class='img identifier id'>img</span><span class='comma token'>,</span> <span class='thumbnail_resize_options identifier id'>thumbnail_resize_options</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Yanked from ActiveRecord::Callbacks, modified so I can pass args to the callbacks besides self.</span>
    <span class='comment val'># Only accept blocks, however</span>
    <span class='if if kw'>if</span> <span class='ActiveSupport constant id'>ActiveSupport</span><span class='dot token'>.</span><span class='const_defined? fid id'>const_defined?</span><span class='lparen token'>(</span><span class='symbol val'>:Callbacks</span><span class='rparen token'>)</span>
      <span class='comment val'># Rails 2.1 and beyond!</span>
      <span class='def def kw'>def</span> <span class='callback_with_args identifier id'>callback_with_args</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='arg identifier id'>arg</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='rparen token'>)</span>
        <span class='notify identifier id'>notify</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span>

        <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='run_callbacks identifier id'>run_callbacks</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='arg identifier id'>arg</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='object identifier id'>object</span><span class='bitor op'>|</span> <span class='result identifier id'>result</span> <span class='eq op'>==</span> <span class='false false kw'>false</span> <span class='rbrace token'>}</span>

        <span class='if if kw'>if</span> <span class='result identifier id'>result</span> <span class='neq op'>!=</span> <span class='false false kw'>false</span> <span class='andop op'>&amp;&amp;</span> <span class='respond_to_without_attributes? fid id'>respond_to_without_attributes?</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span>
          <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>

        <span class='result identifier id'>result</span>
      <span class='end end kw'>end</span>

      <span class='def def kw'>def</span> <span class='run_callbacks identifier id'>run_callbacks</span><span class='lparen token'>(</span><span class='kind identifier id'>kind</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
        <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='reverse_merge! fid id'>reverse_merge!</span><span class='lparen token'>(</span> <span class='symbol val'>:object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='self self kw'>self</span> <span class='rparen token'>)</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{kind}_callback_chain&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:object</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># Rails 2.0</span>
      <span class='def def kw'>def</span> <span class='callback_with_args identifier id'>callback_with_args</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='arg identifier id'>arg</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='rparen token'>)</span>
        <span class='notify identifier id'>notify</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span>

        <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='callbacks_for identifier id'>callbacks_for</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='callback identifier id'>callback</span><span class='bitor op'>|</span>
          <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='callback identifier id'>callback</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='arg identifier id'>arg</span><span class='rparen token'>)</span>
          <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='result identifier id'>result</span> <span class='eq op'>==</span> <span class='false false kw'>false</span>
        <span class='end end kw'>end</span>
        <span class='result identifier id'>result</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Removes the thumbnails for the attachment, if it has any</span>
    <span class='def def kw'>def</span> <span class='destroy_thumbnails identifier id'>destroy_thumbnails</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='thumbnails identifier id'>thumbnails</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='thumbnail identifier id'>thumbnail</span><span class='bitor op'>|</span> <span class='thumbnail identifier id'>thumbnail</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='thumbnailable? fid id'>thumbnailable?</span>
    <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>filename=</h3>
</div><div id="filename-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>filename=</span><span class='args'>(new_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sanitizes a filename.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 309</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L309">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">309
310
311</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='filename= identifier id'>filename=</span><span class='lparen token'>(</span><span class='new_name identifier id'>new_name</span><span class='rparen token'>)</span>
  <span class='write_attribute identifier id'>write_attribute</span> <span class='symbol val'>:filename</span><span class='comma token'>,</span> <span class='sanitize_filename identifier id'>sanitize_filename</span><span class='lparen token'>(</span><span class='new_name identifier id'>new_name</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image?</h3>
</div><div id="image-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks whether the attachment&#8217;s content type is an image content type
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 262</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L262">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">262
263
264</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image? fid id'>image?</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='image? fid id'>image?</span><span class='lparen token'>(</span><span class='content_type identifier id'>content_type</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_size</h3>
</div><div id="image_size-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_size</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the width/height in a suitable format for the image_tag helper:
(100x100)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 314</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L314">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">314
315
316</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_size identifier id'>image_size</span>
  <span class='lbrack token'>[</span><span class='width identifier id'>width</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='height identifier id'>height</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='mult op'>*</span> <span class='string val'>'x'</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>save_attachment?</h3>
</div><div id="save_attachment-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>save_attachment?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if the attachment data will be written to the storage system
on the next save
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 319</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L319">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">319
320
321</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='save_attachment? fid id'>save_attachment?</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='file? fid id'>file?</span><span class='lparen token'>(</span><span class='temp_path identifier id'>temp_path</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_temp_data</h3>
</div><div id="set_temp_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_temp_data</span><span class='args'>(data)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Writes the given data to a Tempfile and adds it to the collection of temp
files.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 377</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L377">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">377
378
379</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set_temp_data identifier id'>set_temp_data</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='rparen token'>)</span>
  <span class='temp_paths identifier id'>temp_paths</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='write_to_temp_file identifier id'>write_to_temp_file</span> <span class='data identifier id'>data</span> <span class='unless unless_mod kw'>unless</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>temp_data</h3>
</div><div id="temp_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>temp_data</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Gets the data from the latest temp file. This will read the file into
memory.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 372</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L372">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">372
373
374</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='temp_data identifier id'>temp_data</span>
  <span class='save_attachment? fid id'>save_attachment?</span> <span class='integer val'>? </span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='temp_path identifier id'>temp_path</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>temp_path</h3>
</div><div id="temp_path-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>temp_path</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Gets the latest temp path from the collection of temp paths. While working
with an attachment, multiple Tempfile objects may be created for various
processing purposes (resizing, for example). An array of all the tempfile
objects is stored so that the Tempfile instance is held on to until
it&#8217;s not needed anymore. The collection is cleared after saving the
attachment.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 360</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L360">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">360
361
362
363</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='temp_path identifier id'>temp_path</span>
  <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='temp_paths identifier id'>temp_paths</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:path</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='path identifier id'>path</span> <span class='colon op'>:</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>temp_paths</h3>
</div><div id="temp_paths-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>temp_paths</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Gets an array of the currently used temp paths. Defaults to a copy of
#full_filename.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 366</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L366">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">366
367
368
369</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='temp_paths identifier id'>temp_paths</span>
  <span class='@temp_paths ivar id'>@temp_paths</span> <span class='opasgn op'>||=</span> <span class='lparen token'>(</span><span class='new_record? fid id'>new_record?</span> <span class='orop op'>||</span> <span class='notop op'>!</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:full_filename</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='notop op'>!</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='full_filename identifier id'>full_filename</span><span class='rparen token'>)</span> <span class='question op'>?</span>
    <span class='lbrack token'>[</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='copy_to_temp_file identifier id'>copy_to_temp_file</span><span class='lparen token'>(</span><span class='full_filename identifier id'>full_filename</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>thumbnail_class</h3>
</div><div id="thumbnail_class-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>thumbnail_class</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the class used to create new thumbnails for this attachment.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 272</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L272">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">272
273
274</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='thumbnail_class identifier id'>thumbnail_class</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='thumbnail_class identifier id'>thumbnail_class</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>thumbnail_name_for</h3>
</div><div id="thumbnail_name_for-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>thumbnail_name_for</span><span class='args'>(thumbnail = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Gets the thumbnail name for a filename. &#8216;foo.jpg&#8217; becomes
&#8216;foo_thumbnail.jpg&#8217;
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 277</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L277">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">277
278
279
280
281
282
283
284
285
286</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='thumbnail_name_for identifier id'>thumbnail_name_for</span><span class='lparen token'>(</span><span class='thumbnail identifier id'>thumbnail</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='filename identifier id'>filename</span> <span class='if if_mod kw'>if</span> <span class='thumbnail identifier id'>thumbnail</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
  <span class='ext identifier id'>ext</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='basename identifier id'>basename</span> <span class='assign token'>=</span> <span class='filename identifier id'>filename</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span> <span class='regexp val'>/\.\w+$/</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
    <span class='ext identifier id'>ext</span> <span class='assign token'>=</span> <span class='s identifier id'>s</span><span class='semicolon token'>;</span> <span class='string val'>''</span>
  <span class='end end kw'>end</span>
  <span class='comment val'># ImageScience doesn't create gif thumbnails, only pngs</span>
  <span class='ext identifier id'>ext</span><span class='dot token'>.</span><span class='sub! fid id'>sub!</span><span class='lparen token'>(</span><span class='regexp val'>/gif$/</span><span class='comma token'>,</span> <span class='string val'>'png'</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='attachment_options identifier id'>attachment_options</span><span class='lbrack token'>[</span><span class='symbol val'>:processor</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;ImageScience&quot;</span>
  <span class='dstring node'>&quot;#{basename}_#{thumbnail}#{ext}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>thumbnailable?</h3>
</div><div id="thumbnailable-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>thumbnailable?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true/false if an attachment is thumbnailable. A thumbnailable
attachment has an image content type and the parent_id attribute.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 267</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L267">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">267
268
269</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='thumbnailable? fid id'>thumbnailable?</span>
  <span class='image? fid id'>image?</span> <span class='andop op'>&amp;&amp;</span> <span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:parent_id</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='parent_id identifier id'>parent_id</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>uploaded_data</h3>
</div><div id="uploaded_data-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>uploaded_data</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
nil placeholder in case this field is used in a form.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 324</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L324">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">324</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='uploaded_data identifier id'>uploaded_data</span><span class='lparen token'>(</span><span class='rparen token'>)</span> <span class='nil nil kw'>nil</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>uploaded_data=</h3>
</div><div id="uploaded_data-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>uploaded_data=</span><span class='args'>(file_data)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method handles the uploaded file object. If you set the field name to
uploaded_data, you don&#8217;t need any special code in your controller.
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>% form_for </span><span class='symbol val'>:attachment</span><span class='comma token'>,</span> <span class='symbol val'>:html</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:multipart</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='minus op'>-</span><span class='string val'>%&gt;
    &lt;p&gt;</span><span class='lt op'>&lt;</span><span class='string val'>%= f.file_field :uploaded_data %&gt;&lt;/p&gt;
    &lt;p&gt;&lt;%=</span> <span class='submit_tag identifier id'>submit_tag</span> <span class='symbol val'>:Save</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='minus op'>-</span><span class='string val'>%&gt;

  @attachment = Attachment.create! params[:attachment]
</span></pre>
<p>
TODO: Allow it to work with Merb tempfiles too.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 337</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L337">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='uploaded_data= identifier id'>uploaded_data=</span><span class='lparen token'>(</span><span class='file_data identifier id'>file_data</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:content_type</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='content_type identifier id'>content_type</span> <span class='assign token'>=</span> <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='content_type identifier id'>content_type</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='filename identifier id'>filename</span>     <span class='assign token'>=</span> <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='original_filename identifier id'>original_filename</span> <span class='if if_mod kw'>if</span> <span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:filename</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='orop op'>||</span> <span class='file_data identifier id'>file_data</span><span class='lbrack token'>[</span><span class='string val'>'size'</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='content_type identifier id'>content_type</span> <span class='assign token'>=</span> <span class='file_data identifier id'>file_data</span><span class='lbrack token'>[</span><span class='string val'>'content_type'</span><span class='rbrack token'>]</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='filename identifier id'>filename</span> <span class='assign token'>=</span>  <span class='file_data identifier id'>file_data</span><span class='lbrack token'>[</span><span class='string val'>'filename'</span><span class='rbrack token'>]</span>
    <span class='file_data identifier id'>file_data</span> <span class='assign token'>=</span> <span class='file_data identifier id'>file_data</span><span class='lbrack token'>[</span><span class='string val'>'tempfile'</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='StringIO constant id'>StringIO</span><span class='rparen token'>)</span>
    <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='rewind identifier id'>rewind</span>
    <span class='set_temp_data identifier id'>set_temp_data</span> <span class='file_data identifier id'>file_data</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
  <span class='else else kw'>else</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='temp_paths identifier id'>temp_paths</span><span class='dot token'>.</span><span class='unshift identifier id'>unshift</span> <span class='file_data identifier id'>file_data</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>with_image</h3>
</div><div id="with_image-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>with_image</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Allows you to work with a processed representation (RMagick, ImageScience,
etc) of the attachment in a block.
</p>
<pre class="code">
  <span class='@attachment ivar id'>@attachment</span><span class='dot token'>.</span><span class='with_image identifier id'>with_image</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='img identifier id'>img</span><span class='bitor op'>|</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='img identifier id'>img</span><span class='dot token'>.</span><span class='thumbnail identifier id'>thumbnail</span><span class='lparen token'>(</span><span class='integer val'>100</span><span class='comma token'>,</span> <span class='integer val'>100</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_blob identifier id'>to_blob</span>
  <span class='end end kw'>end</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 400</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L400">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">400
401
402</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='with_image identifier id'>with_image</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='with_image identifier id'>with_image</span><span class='lparen token'>(</span><span class='temp_path identifier id'>temp_path</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>write_to_temp_file</h3>
</div><div id="write_to_temp_file-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>write_to_temp_file</span><span class='args'>(data)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Writes the given file to a randomly named Tempfile.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/technoweenie/attachment_fu.rb', line 387</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7/lib/technoweenie/attachment_fu.rb#L387">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">387
388
389</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='write_to_temp_file identifier id'>write_to_temp_file</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='write_to_temp_file identifier id'>write_to_temp_file</span> <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='random_tempfile_filename identifier id'>random_tempfile_filename</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>