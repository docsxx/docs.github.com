<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>technoweenie's attachment_fu - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/technoweenie/commits/attachment_fu/master" rel="alternate" title="Recent Commits to attachment_fu:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("technoweenie", "attachment_fu", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("technoweenie", "attachment_fu", "fa08cb03914b02b66853b4615cd3eca768291ca7", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/tree/">Source</a></li>
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/network">Network</a></li>            
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/technoweenie/attachment_fu">Wiki</a></li>
            <li class=""><a href="http://github.com/technoweenie/attachment_fu/graphs">Graphs</a></li>                    
            <li class="active"><a href="/technoweenie/attachment_fu">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/technoweenie">technoweenie</a> / <b><a href="http://github.com/technoweenie/attachment_fu/tree">attachment_fu</a></b>        
                <a id="namespaces_button" rel="technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="technoweenie/attachment_fu/blob/fa08cb03914b02b66853b4615cd3eca768291ca7" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
attachment-fu
</p>
<h6>=======</h6>
<p>
attachment_fu is a plugin by Rick Olson (aka technoweenie
&lt;http://techno-weenie.net&gt;) and is the successor to
acts_as_attachment. To get a basic run-through of its capabilities, check
out Mike Clark&#8217;s tutorial
&lt;http://clarkware.com/cgi/blosxom/2007/02/24#FileUploadFu&gt;.
</p>
<p>
attachment_fu functionality
</p>
<h6>=====================</h6>
<p>
attachment_fu facilitates file uploads in Ruby on Rails. There are a few
storage options for the actual file data, but the plugin always at a
minimum stores metadata for each file in the database.
</p>
<p>
There are four storage options for files uploaded through attachment_fu:
</p>
<pre class="code">
  <span class='File constant id'>File</span> <span class='system identifier id'>system</span>
  <span class='Database constant id'>Database</span> <span class='file identifier id'>file</span>
  <span class='Amazon constant id'>Amazon</span> <span class='S3 constant id'>S3</span>
  <span class='Rackspace constant id'>Rackspace</span> <span class='lparen token'>(</span><span class='Mosso constant id'>Mosso</span><span class='rparen token'>)</span> <span class='Cloud constant id'>Cloud</span> <span class='Files constant id'>Files</span>
</pre>
<p>
Each method of storage many options associated with it that will be covered
in the following section. Something to note, however, is that the Amazon S3
storage requires you to modify config/amazon_s3.yml, the Rackspace Cloud
Files storage requires you to modify config/rackspace_cloudfiles.yml, and
the Database file storage requires an extra table.
</p>
<p>
attachment_fu models
</p>
<h6>==============</h6>
<p>
For all three of these storage options a table of metadata is required.
This table will contain information about the file (hence the
&#8216;meta&#8217;) and its location. This table has no restrictions on
naming, unlike the extra table required for database storage, which must
have a table name of db_files (and by convention a model of DbFile).
</p>
<p>
In the model there are two methods made available by this plugins:
has_attachment and validates_as_attachment.
</p>
<p>
has_attachment(options = {})
</p>
<pre class="code">
  <span class='This constant id'>This</span> <span class='method identifier id'>method</span> <span class='accepts identifier id'>accepts</span> <span class='the identifier id'>the</span> <span class='options identifier id'>options</span> <span class='in in kw'>in</span> <span class='a identifier id'>a</span> <span class='hash identifier id'>hash</span><span class='colon op'>:</span>
    <span class='symbol val'>:content_type</span>     <span class='comment val'># Allowed content types.</span>
                      <span class='comment val'># Allows all by default.  Use :image to allow all standard image types.</span>
    <span class='symbol val'>:min_size</span>         <span class='comment val'># Minimum size allowed.</span>
                      <span class='comment val'># 1 byte is the default.</span>
    <span class='symbol val'>:max_size</span>         <span class='comment val'># Maximum size allowed.</span>
                      <span class='comment val'># 1.megabyte is the default.</span>
    <span class='symbol val'>:size</span>             <span class='comment val'># Range of sizes allowed.</span>
                      <span class='comment val'># (1..1.megabyte) is the default.  This overrides the :min_size and :max_size options.</span>
    <span class='symbol val'>:resize_to</span>        <span class='comment val'># Used by RMagick to resize images.</span>
                      <span class='comment val'># Pass either an array of width/height, or a geometry string.</span>
    <span class='symbol val'>:thumbnails</span>       <span class='comment val'># Specifies a set of thumbnails to generate.</span>
                      <span class='comment val'># This accepts a hash of filename suffixes and RMagick resizing options.</span>
                      <span class='comment val'># This option need only be included if you want thumbnailing.</span>
    <span class='symbol val'>:thumbnail_class</span>  <span class='comment val'># Set which model class to use for thumbnails.</span>
                      <span class='comment val'># This current attachment class is used by default.</span>
    <span class='symbol val'>:path_prefix</span>      <span class='comment val'># Path to store the uploaded files in.</span>
                      <span class='comment val'># Uses public/#{table_name} by default for the filesystem, and just #{table_name} for the S3 and Cloud Files backend.</span>
                      <span class='comment val'># Setting this sets the :storage to :file_system.</span>
    <span class='symbol val'>:partition</span>        <span class='comment val'># Whether to partiton files in directories like /0000/0001/image.jpg. Default is true. Only applicable to the :file_system backend.</span>
    <span class='symbol val'>:storage</span>          <span class='comment val'># Specifies the storage system to use..</span>
                      <span class='comment val'># Defaults to :db_file.  Options are :file_system, :db_file, :s3, and :cloud_files.</span>
    <span class='symbol val'>:cloudfront</span>       <span class='comment val'># If using S3 for storage, this option allows for serving the files via Amazon CloudFront.</span>
                      <span class='comment val'># Defaults to false.</span>
    <span class='symbol val'>:processor</span>        <span class='comment val'># Sets the image processor to use for resizing of the attached image.</span>
                      <span class='comment val'># Options include ImageScience, Rmagick, and MiniMagick.  Default is whatever is installed.</span>
    <span class='symbol val'>:uuid_primary_key</span> <span class='comment val'># If your model's primary key is a 128-bit UUID in hexadecimal format, then set this to true.</span>
    <span class='symbol val'>:association_options</span>  <span class='comment val'># attachment_fu automatically defines associations with thumbnails with has_many and belongs_to. If there are any additional options that you want to pass to these methods, then specify them here.</span>

  <span class='Examples constant id'>Examples</span><span class='colon op'>:</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:max_size</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>1</span><span class='dot token'>.</span><span class='kilobyte identifier id'>kilobyte</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:size</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>1</span><span class='dot token'>.</span><span class='megabyte identifier id'>megabyte</span><span class='dot2 op'>..</span><span class='float val'>2</span><span class='dot token'>.</span><span class='megabytes identifier id'>megabytes</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:content_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'application/pdf'</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:content_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>'application/pdf'</span><span class='comma token'>,</span> <span class='string val'>'application/msword'</span><span class='comma token'>,</span> <span class='string val'>'text/plain'</span><span class='rbrack token'>]</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:content_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:image</span><span class='comma token'>,</span> <span class='symbol val'>:resize_to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>50</span><span class='comma token'>,</span><span class='integer val'>50</span><span class='rbrack token'>]</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:content_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>'application/pdf'</span><span class='comma token'>,</span> <span class='symbol val'>:image</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:resize_to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'x50'</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:thumbnails</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:thumb</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>50</span><span class='comma token'>,</span> <span class='integer val'>50</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:geometry</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'x50'</span> <span class='rbrace token'>}</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:storage</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:file_system</span><span class='comma token'>,</span> <span class='symbol val'>:path_prefix</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'public/files'</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:storage</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:file_system</span><span class='comma token'>,</span> <span class='symbol val'>:path_prefix</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'public/files'</span><span class='comma token'>,</span>
                   <span class='symbol val'>:content_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:image</span><span class='comma token'>,</span> <span class='symbol val'>:resize_to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>50</span><span class='comma token'>,</span><span class='integer val'>50</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:partition</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:storage</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:file_system</span><span class='comma token'>,</span> <span class='symbol val'>:path_prefix</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'public/files'</span><span class='comma token'>,</span>
                   <span class='symbol val'>:thumbnails</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:thumb</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>50</span><span class='comma token'>,</span> <span class='integer val'>50</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:geometry</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'x50'</span> <span class='rbrace token'>}</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:storage</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:s3</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:store</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:s3</span><span class='comma token'>,</span> <span class='symbol val'>:cloudfront</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='has_attachment identifier id'>has_attachment</span> <span class='symbol val'>:storage</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:cloud_files</span>
</pre>
<p>
validates_as_attachment
</p>
<pre class="code">
  <span class='This constant id'>This</span> <span class='method identifier id'>method</span> <span class='prevents identifier id'>prevents</span> <span class='files identifier id'>files</span> <span class='outside identifier id'>outside</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='valid identifier id'>valid</span> <span class='range identifier id'>range</span> <span class='lparen token'>(</span><span class='symbol val'>:min_size</span> <span class='to identifier id'>to</span> <span class='symbol val'>:max_size</span><span class='comma token'>,</span> <span class='or or kw'>or</span> <span class='the identifier id'>the</span> <span class='symbol val'>:size</span> <span class='range identifier id'>range</span><span class='rparen token'>)</span> <span class='from identifier id'>from</span> <span class='being identifier id'>being</span> <span class='saved identifier id'>saved</span><span class='dot token'>.</span>  <span class='It constant id'>It</span> <span class='does identifier id'>does</span> <span class='not not kw'>not</span> <span class='however identifier id'>however</span><span class='comma token'>,</span> <span class='halt identifier id'>halt</span> <span class='the identifier id'>the</span> <span class='upload identifier id'>upload</span> <span class='of identifier id'>of</span> <span class='such identifier id'>such</span> <span class='files identifier id'>files</span><span class='dot token'>.</span>  <span class='They constant id'>They</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='uploaded identifier id'>uploaded</span> <span class='into identifier id'>into</span> <span class='memory identifier id'>memory</span> <span class='regardless identifier id'>regardless</span> <span class='of identifier id'>of</span> <span class='size identifier id'>size</span> <span class='before identifier id'>before</span> <span class='validation identifier id'>validation</span><span class='dot token'>.</span>

  <span class='Example constant id'>Example</span><span class='colon op'>:</span>
    <span class='validates_as_attachment identifier id'>validates_as_attachment</span>
</pre>
<p>
attachment_fu migrations
</p>
<h6>==================</h6>
<p>
Fields for attachment_fu metadata tables&#8230;
</p>
<pre class="code">
  <span class='in in kw'>in</span> <span class='general identifier id'>general</span><span class='colon op'>:</span>
    <span class='size identifier id'>size</span><span class='comma token'>,</span>         <span class='symbol val'>:integer</span>  <span class='comment val'># file size in bytes</span>
    <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>   <span class='comment val'># mime type, ex: application/mp3</span>
    <span class='filename identifier id'>filename</span><span class='comma token'>,</span>     <span class='symbol val'>:string</span>   <span class='comment val'># sanitized filename</span>
  <span class='that identifier id'>that</span> <span class='reference identifier id'>reference</span> <span class='images identifier id'>images</span><span class='colon op'>:</span>
    <span class='height identifier id'>height</span><span class='comma token'>,</span>       <span class='symbol val'>:integer</span>  <span class='comment val'># in pixels</span>
    <span class='width identifier id'>width</span><span class='comma token'>,</span>        <span class='symbol val'>:integer</span>  <span class='comment val'># in pixels</span>
  <span class='that identifier id'>that</span> <span class='reference identifier id'>reference</span> <span class='images identifier id'>images</span> <span class='that identifier id'>that</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='thumbnailed identifier id'>thumbnailed</span><span class='colon op'>:</span>
    <span class='parent_id identifier id'>parent_id</span><span class='comma token'>,</span>    <span class='symbol val'>:integer</span>  <span class='comment val'># id of parent image (on the same table, a self-referencing foreign-key).</span>
                            <span class='comment val'># Only populated if the current object is a thumbnail.</span>
    <span class='thumbnail identifier id'>thumbnail</span><span class='comma token'>,</span>    <span class='symbol val'>:string</span>   <span class='comment val'># the 'type' of thumbnail this attachment record describes.</span>
                            <span class='comment val'># Only populated if the current object is a thumbnail.</span>
                            <span class='comment val'># Usage:</span>
                            <span class='comment val'># [ In Model 'Avatar' ]</span>
                            <span class='comment val'>#   has_attachment :content_type =&gt; :image,</span>
                            <span class='comment val'>#                  :storage =&gt; :file_system,</span>
                            <span class='comment val'>#                  :max_size =&gt; 500.kilobytes,</span>
                            <span class='comment val'>#                  :resize_to =&gt; '320x200&gt;',</span>
                            <span class='comment val'>#                  :thumbnails =&gt; { :small =&gt; '10x10&gt;',</span>
                            <span class='comment val'>#                                   :thumb =&gt; '100x100&gt;' }</span>
                            <span class='comment val'># [ Elsewhere ]</span>
                            <span class='comment val'># @user.avatar.thumbnails.first.thumbnail #=&gt; 'small'</span>
  <span class='that identifier id'>that</span> <span class='reference identifier id'>reference</span> <span class='files identifier id'>files</span> <span class='stored identifier id'>stored</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='database identifier id'>database</span> <span class='lparen token'>(</span><span class='symbol val'>:db_file</span><span class='rparen token'>)</span><span class='colon op'>:</span>
    <span class='db_file_id identifier id'>db_file_id</span><span class='comma token'>,</span>   <span class='symbol val'>:integer</span>  <span class='comment val'># id of the file in the database (foreign key)</span>
</pre>
<p>
Field for attachment_fu db_files table:
</p>
<pre class="code">
  <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='symbol val'>:binary</span> <span class='comment val'># binary file data, for use in database file storage</span>
</pre>
<p>
attachment_fu views
</p>
<h6>=============</h6>
<p>
There are two main views tasks that will be directly affected by
attachment_fu: upload forms and displaying uploaded images.
</p>
<p>
There are two parts of the upload form that differ from typical usage.
</p>
<pre class="code">
  <span class='float val'>1</span><span class='dot token'>.</span> <span class='Include constant id'>Include</span> <span class='string val'>':multipart =&gt; true'</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='html identifier id'>html</span> <span class='options identifier id'>options</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='form_for identifier id'>form_for</span> <span class='tag identifier id'>tag</span><span class='dot token'>.</span>
    <span class='Example constant id'>Example</span><span class='colon op'>:</span>
      <span class='lt op'>&lt;</span><span class='string val'>% form_for(:attachment_metadata, </span><span class='symbol val'>:url</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;create&quot;</span> <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='symbol val'>:html</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:multipart</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='form identifier id'>form</span><span class='bitor op'>|</span> <span class='string val'>%&gt;

  2. Use the file_field helper with :uploaded_data as the field name.
    Example:
      &lt;%= form.file_field :uploaded_data %&gt;</span>
</pre>
<p>
Displaying uploaded images is made easy by the public_filename method of
the ActiveRecord attachment objects using file system, s3, and Cloud Files
storage.
</p>
<p>
public_filename(thumbnail = nil)
</p>
<pre class="code">
  <span class='Returns constant id'>Returns</span> <span class='the identifier id'>the</span> <span class='public identifier id'>public</span> <span class='path identifier id'>path</span> <span class='to identifier id'>to</span> <span class='the identifier id'>the</span> <span class='file identifier id'>file</span><span class='dot token'>.</span>  <span class='If constant id'>If</span> <span class='a identifier id'>a</span> <span class='thumbnail identifier id'>thumbnail</span> <span class='prefix identifier id'>prefix</span> <span class='is identifier id'>is</span> <span class='specified identifier id'>specified</span> <span class='it identifier id'>it</span> <span class='will identifier id'>will</span> <span class='return return kw'>return</span> <span class='the identifier id'>the</span> <span class='public identifier id'>public</span> <span class='file identifier id'>file</span> <span class='path identifier id'>path</span> <span class='to identifier id'>to</span> <span class='the identifier id'>the</span> <span class='corresponding identifier id'>corresponding</span> <span class='thumbnail identifier id'>thumbnail</span><span class='dot token'>.</span>
  <span class='Examples constant id'>Examples</span><span class='colon op'>:</span>
    <span class='attachment_obj identifier id'>attachment_obj</span><span class='dot token'>.</span><span class='public_filename identifier id'>public_filename</span>          <span class='comment val'>#=&gt; /attachments/2/file.jpg</span>
    <span class='attachment_obj identifier id'>attachment_obj</span><span class='dot token'>.</span><span class='public_filename identifier id'>public_filename</span><span class='lparen token'>(</span><span class='symbol val'>:thumb</span><span class='rparen token'>)</span>  <span class='comment val'>#=&gt; /attachments/2/file_thumb.jpg</span>
    <span class='attachment_obj identifier id'>attachment_obj</span><span class='dot token'>.</span><span class='public_filename identifier id'>public_filename</span><span class='lparen token'>(</span><span class='symbol val'>:small</span><span class='rparen token'>)</span>  <span class='comment val'>#=&gt; /attachments/2/file_small.jpg</span>
</pre>
<p>
When serving files from database storage, doing more than simply
downloading the file is beyond the scope of this document.
</p>
<p>
attachment_fu controllers
</p>
<h6>===================</h6>
<p>
There are two considerations to take into account when using attachment_fu
in controllers.
</p>
<p>
The first is when the files have no publicly accessible path and need to be
downloaded through an action.
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='readme identifier id'>readme</span>
    <span class='send_file identifier id'>send_file</span> <span class='string val'>'/path/to/readme.txt'</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'plain/text'</span><span class='comma token'>,</span> <span class='symbol val'>:disposition</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'inline'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
See the possible values for send_file for reference.
</p>
<p>
The second is when saving the file when submitted from a form. Example in
view:
</p>
<pre class="code">
 <span class='lt op'>&lt;</span><span class='string val'>%= form.file_field :attachable, :uploaded_data %&gt;
</span></pre>
<p>
Example in controller:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='create identifier id'>create</span>
    <span class='@attachable_file ivar id'>@attachable_file</span> <span class='assign token'>=</span> <span class='AttachmentMetadataModel constant id'>AttachmentMetadataModel</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:attachable</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='@attachable_file ivar id'>@attachable_file</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
      <span class='flash identifier id'>flash</span><span class='lbrack token'>[</span><span class='symbol val'>:notice</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'Attachment was successfully created.'</span>
      <span class='redirect_to identifier id'>redirect_to</span> <span class='attachable_url identifier id'>attachable_url</span><span class='lparen token'>(</span><span class='@attachable_file ivar id'>@attachable_file</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='render identifier id'>render</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:new</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
attachement_fu scripting
</p>
<h6>==============================</h6>
<p>
You may wish to import a large number of images or attachments. The
following example shows how to upload a file from a script.
</p>
<p>
#!/usr/bin/env ./script/runner
</p>
<p>
# required to use ActionController::TestUploadedFile require
&#8216;action_controller&#8217; require
&#8216;action_controller/test_process.rb&#8217;
</p>
<p>
path = &quot;./public/images/x.jpg&quot;
</p>
<p>
# mimetype is a string like &quot;image/jpeg&quot;. One way to get the
mimetype for a given file on a UNIX system # mimetype = `file -ib
#{path}`.gsub(/\n/,&quot;&quot;)
</p>
<p>
mimetype = &quot;image/jpeg&quot;
</p>
<p>
# This will &quot;upload&quot; the file at path and create the new model.
@attachable = AttachmentMetadataModel.new(:uploaded_data =&gt;
ActionController::TestUploadedFile.new(path, mimetype)) @attachable.save
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>