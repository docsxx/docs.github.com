<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>capistrano's capistrano - Module: Capistrano::Configuration::Actions::Invocation - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/capistrano/commits/capistrano/master" rel="alternate" title="Recent Commits to capistrano:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("capistrano", "capistrano", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("capistrano", "capistrano", "31e16a1c469f797fa4a35a68aecae1acd4d0f471", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/capistrano/capistrano/tree/">Source</a></li>
            <li class=""><a href="http://github.com/capistrano/capistrano/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/capistrano/capistrano/network">Network</a></li>            
            <li class=""><a href="http://github.com/capistrano/capistrano/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/capistrano/capistrano">Wiki</a></li>
            <li class=""><a href="http://github.com/capistrano/capistrano/graphs">Graphs</a></li>                    
            <li class="active"><a href="/capistrano/capistrano">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/capistrano">capistrano</a> / <b><a href="http://github.com/capistrano/capistrano/tree">capistrano</a></b>        
                <a id="namespaces_button" rel="capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Capistrano_Configuration_Actions_Invocation">
  <h1>Module: Capistrano::Configuration::Actions::Invocation</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#included-class_method">included</span><span class='args'>(base)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add_default_command_options-instance_method">#add_default_command_options</span><span class='args'>(options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Merges the various default command options into the options hash and
returns the result.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#continue_execution-instance_method">#continue_execution</span><span class='args'>(tree)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#continue_execution_for_branch-instance_method">#continue_execution_for_branch</span><span class='args'>(branch)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#initialize_with_invocation-instance_method">#initialize_with_invocation</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#invoke_command-instance_method">#invoke_command</span><span class='args'>(cmd, options = {}, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Invokes the given command.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#parallel-instance_method">#parallel</span><span class='args'>(options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Executes different commands in parallel.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run-instance_method">#run</span><span class='args'>(cmd, options = {}, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Execute the given command on all servers that are the target of the current
task.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run_tree-instance_method">#run_tree</span><span class='args'>(tree, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Executes a Capistrano::Command::Tree object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#sudo-instance_method">#sudo</span><span class='args'>(*parameters, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the command string used by capistrano to invoke a comamnd via sudo.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#sudo_behavior_callback-instance_method">#sudo_behavior_callback</span><span class='args'>(fallback)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns a Proc object that defines the behavior of the sudo callback.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#sudo_prompt-instance_method">#sudo_prompt</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the prompt text to use with sudo.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>included</h3>
</div><div id="included-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>included</span><span class='args'>(base)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 7</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L7">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">7
8
9
10
11
12
13
14
15
16
17</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='included identifier id'>included</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span> <span class='comment val'>#:nodoc:</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span><span class='lparen token'>(</span><span class='ClassMethods constant id'>ClassMethods</span><span class='rparen token'>)</span>

  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='symbol val'>:alias_method</span><span class='comma token'>,</span> <span class='symbol val'>:initialize_without_invocation</span><span class='comma token'>,</span> <span class='symbol val'>:initialize</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='symbol val'>:alias_method</span><span class='comma token'>,</span> <span class='symbol val'>:initialize</span><span class='comma token'>,</span> <span class='symbol val'>:initialize_with_invocation</span>

  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='default_io_proc identifier id'>default_io_proc</span> <span class='assign token'>=</span> <span class='Proc constant id'>Proc</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ch identifier id'>ch</span><span class='comma token'>,</span> <span class='stream identifier id'>stream</span><span class='comma token'>,</span> <span class='out identifier id'>out</span><span class='bitor op'>|</span>
    <span class='level identifier id'>level</span> <span class='assign token'>=</span> <span class='stream identifier id'>stream</span> <span class='eq op'>==</span> <span class='symbol val'>:err</span> <span class='question op'>?</span> <span class='symbol val'>:important</span> <span class='colon op'>:</span> <span class='symbol val'>:info</span>
    <span class='ch identifier id'>ch</span><span class='lbrack token'>[</span><span class='symbol val'>:options</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='level identifier id'>level</span><span class='comma token'>,</span> <span class='out identifier id'>out</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{stream} :: #{ch[:server]}&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>add_default_command_options</h3>
</div><div id="add_default_command_options-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_default_command_options</span><span class='args'>(options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Merges the various default command options into the options hash and
returns the result. The default command options that are understand are:
</p>
<ul>
<li>:default_environment: If the :env key already exists, the :env key is
merged into default_environment and then added back into options.

</li>
<li>:default_shell: if the :shell key already exists, it will be used.
Otherwise, if the :default_shell key exists in the configuration, it will
be used. Otherwise, no :shell key is added.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 252</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L252">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">252
253
254
255
256
257
258
259
260
261
262
263
264</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='add_default_command_options identifier id'>add_default_command_options</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='defaults identifier id'>defaults</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='lbrack token'>[</span><span class='symbol val'>:default_run_options</span><span class='rbrack token'>]</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='defaults identifier id'>defaults</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>

  <span class='env identifier id'>env</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='lbrack token'>[</span><span class='symbol val'>:default_environment</span><span class='rbrack token'>]</span>
  <span class='env identifier id'>env</span> <span class='assign token'>=</span> <span class='env identifier id'>env</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:env</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:env</span><span class='rbrack token'>]</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:env</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='env identifier id'>env</span> <span class='unless unless_mod kw'>unless</span> <span class='env identifier id'>env</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='shell identifier id'>shell</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:shell</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='self self kw'>self</span><span class='lbrack token'>[</span><span class='symbol val'>:default_shell</span><span class='rbrack token'>]</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:shell</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='shell identifier id'>shell</span> <span class='unless unless_mod kw'>unless</span> <span class='shell identifier id'>shell</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

  <span class='options identifier id'>options</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>continue_execution</h3>
</div><div id="continue_execution-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>continue_execution</span><span class='args'>(tree)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 271</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L271">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">271
272
273
274
275
276
277
278</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='continue_execution identifier id'>continue_execution</span><span class='lparen token'>(</span><span class='tree identifier id'>tree</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='branches identifier id'>branches</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
    <span class='continue_execution_for_branch identifier id'>continue_execution_for_branch</span><span class='lparen token'>(</span><span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='branches identifier id'>branches</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='branch identifier id'>branch</span><span class='bitor op'>|</span> <span class='branch identifier id'>branch</span><span class='dot token'>.</span><span class='skip! fid id'>skip!</span> <span class='unless unless_mod kw'>unless</span> <span class='continue_execution_for_branch identifier id'>continue_execution_for_branch</span><span class='lparen token'>(</span><span class='branch identifier id'>branch</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='branch identifier id'>branch</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='branch identifier id'>branch</span><span class='dot token'>.</span><span class='skip? fid id'>skip?</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>continue_execution_for_branch</h3>
</div><div id="continue_execution_for_branch-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>continue_execution_for_branch</span><span class='args'>(branch)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 280</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L280">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">280
281
282
283
284
285
286
287
288
289</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='continue_execution_for_branch identifier id'>continue_execution_for_branch</span><span class='lparen token'>(</span><span class='branch identifier id'>branch</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='Capistrano constant id'>Capistrano</span><span class='colon2 op'>::</span><span class='CLI constant id'>CLI</span><span class='dot token'>.</span><span class='debug_prompt identifier id'>debug_prompt</span><span class='lparen token'>(</span><span class='branch identifier id'>branch</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='string val'>&quot;y&quot;</span>
      <span class='true true kw'>true</span>
    <span class='when when kw'>when</span> <span class='string val'>&quot;n&quot;</span>
      <span class='false false kw'>false</span>
    <span class='when when kw'>when</span> <span class='string val'>&quot;a&quot;</span>
      <span class='exit identifier id'>exit</span><span class='lparen token'>(</span><span class='integer val'>-1</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>initialize_with_invocation</h3>
</div><div id="initialize_with_invocation-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize_with_invocation</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 23</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L23">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">23
24
25
26
27</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize_with_invocation identifier id'>initialize_with_invocation</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span> <span class='comment val'>#:nodoc:</span>
  <span class='initialize_without_invocation identifier id'>initialize_without_invocation</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='set identifier id'>set</span> <span class='symbol val'>:default_environment</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='set identifier id'>set</span> <span class='symbol val'>:default_run_options</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>invoke_command</h3>
</div><div id="invoke_command-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>invoke_command</span><span class='args'>(cmd, options = {}, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Invokes the given command. If a <tt>via</tt> key is given, it will be used
to determine what method to use to invoke the command. It defaults to :run,
but may be :sudo, or any other method that conforms to the same interface
as run and sudo.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 86</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L86">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">86
87
88
89
90</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='invoke_command identifier id'>invoke_command</span><span class='lparen token'>(</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='via identifier id'>via</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:via</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='symbol val'>:run</span>
  <span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='via identifier id'>via</span><span class='comma token'>,</span> <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>parallel</h3>
</div><div id="parallel-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>parallel</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Executes different commands in parallel. This is useful for commands that
need to be different on different hosts, but which could be otherwise run
in parallel.
</p>
<p>
The <tt>options</tt> parameter is currently unused.
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='task identifier id'>task</span> <span class='symbol val'>:restart_everything</span> <span class='do do kw'>do</span>
    <span class='parallel identifier id'>parallel</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='session identifier id'>session</span><span class='bitor op'>|</span>
      <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='when identifier id'>when</span> <span class='string val'>&quot;in?(:app)&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/path/to/restart/mongrel&quot;</span>
      <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='when identifier id'>when</span> <span class='string val'>&quot;in?(:web)&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/path/to/restart/apache&quot;</span>
      <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='when identifier id'>when</span> <span class='string val'>&quot;in?(:db)&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/path/to/restart/mysql&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Each command may have its own callback block, for capturing and responding
to output, with semantics identical to #run:
</p>
<pre class="code">
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='when identifier id'>when</span> <span class='string val'>&quot;in?(:app)&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/path/to/restart/mongrel&quot;</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ch identifier id'>ch</span><span class='comma token'>,</span> <span class='stream identifier id'>stream</span><span class='comma token'>,</span> <span class='data identifier id'>data</span><span class='bitor op'>|</span>
    <span class='comment val'># ch is the SSH channel for this command, used to send data</span>
    <span class='comment val'>#    back to the command (e.g. ch.send_data(&quot;password\n&quot;))</span>
    <span class='comment val'># stream is either :out or :err, for which stream the data arrived on</span>
    <span class='comment val'># data is a string containing data sent from the remote command</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Also, you can specify a fallback command, to use when none of the
conditions match a server:
</p>
<pre class="code">
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='else identifier id'>else</span> <span class='string val'>&quot;/execute/something/else&quot;</span>
</pre>
<p>
The string specified as the first argument to <tt>when</tt> may be any
valid Ruby code. It has access to the following variables and methods:
</p>
<ul>
<li><tt>in?(role)</tt> returns true if the server participates in the given role

</li>
<li><tt>server</tt> is the ServerDefinition object for the server. This can be
used to get the host-name, etc.

</li>
<li><tt>configuration</tt> is the current Capistrano::Configuration object,
which you can use to get the value of variables, etc.

</li>
</ul>
<p>
For example:
</p>
<pre class="code">
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='when identifier id'>when</span> <span class='string val'>&quot;server.host =~ /app/&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/some/command&quot;</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='when identifier id'>when</span> <span class='string val'>&quot;server.host == configuration[:some_var]&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/another/command&quot;</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='when identifier id'>when</span> <span class='string val'>&quot;in?(:web) || in?(:app)&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;/more/commands&quot;</span>
</pre>
<p>
See #run for a description of the valid <tt>options</tt>.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 76</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L76">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">76
77
78
79
80</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='parallel identifier id'>parallel</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;parallel() requires a block&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='block_given? fid id'>block_given?</span>
  <span class='tree identifier id'>tree</span> <span class='assign token'>=</span> <span class='Command constant id'>Command</span><span class='colon2 op'>::</span><span class='Tree constant id'>Tree</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span> <span class='t identifier id'>t</span> <span class='rbrace token'>}</span>
  <span class='run_tree identifier id'>run_tree</span><span class='lparen token'>(</span><span class='tree identifier id'>tree</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run</h3>
</div><div id="run-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run</span><span class='args'>(cmd, options = {}, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Execute the given command on all servers that are the target of the current
task. If a block is given, it is invoked for all output generated by the
command, and should accept three parameters: the SSH channel (which may be
used to send data back to the remote process), the stream identifier
(<tt>:err</tt> for stderr, and <tt>:out</tt> for stdout), and the data that
was received.
</p>
<p>
The <tt>options</tt> hash may include any of the following keys:
</p>
<ul>
<li>:hosts - this is either a string (for a single target host) or an array of
strings, indicating which hosts the command should run on. By default, the
hosts are determined from the task definition.

</li>
<li>:roles - this is either a string or symbol (for a single target role) or an
array of strings or symbols, indicating which roles the command should run
on. If :hosts is specified, :roles will be ignored.

</li>
<li>:only - specifies a condition limiting which hosts will be selected to run
the command. This should refer to values set in the role definition. For
example, if a role is defined with :primary =&gt; true, then you could
select only hosts with :primary true by setting :only =&gt; { :primary
=&gt; true }.

</li>
<li>:except - specifies a condition limiting which hosts will be selected to
run the command. This is the inverse of :only (hosts that do <em>not</em>
match the condition will be selected).

</li>
<li>:once - if true, only the first matching server will be selected. The
default is false (all matching servers will be selected).

</li>
<li>:max_hosts - specifies the maximum number of hosts that should be selected
at a time. If this value is less than the number of hosts that are selected
to run, then the hosts will be run in groups of max_hosts. The default is
nil, which indicates that there is no maximum host limit.

</li>
<li>:shell - says which shell should be used to invoke commands. This defaults
to &quot;sh&quot;. Setting this to false causes Capistrano to invoke the
commands directly, without wrapping them in a shell invocation.

</li>
<li>:data - if not nil (the default), this should be a string that will be
passed to the command&#8217;s stdin stream.

</li>
<li>:pty - if true, a pseudo-tty will be allocated for each command. The
default is false. Note that there are benefits and drawbacks both ways.
Empirically, it appears that if a pty is allocated, the SSH server daemon
will <em>not</em> read user shell start-up scripts (e.g. bashrc, etc.).
However, if a pty is <em>not</em> allocated, some commands will refuse to
run in interactive mode and will not prompt for (e.g.) passwords.

</li>
<li>:env - a hash of environment variable mappings that should be made
available to the command. The keys should be environment variable names,
and the values should be their corresponding values. The default is empty,
but may be modified by changing the <tt>default_environment</tt> Capistrano
variable.

</li>
</ul>
<p>
Note that if you set these keys in the <tt>default_run_options</tt>
Capistrano variable, they will apply for all invocations of #run,
#invoke_command, and #parallel.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 140</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L140">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">140
141
142
143
144</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='run identifier id'>run</span><span class='lparen token'>(</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='block identifier id'>block</span> <span class='opasgn op'>||=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='default_io_proc identifier id'>default_io_proc</span>
  <span class='tree identifier id'>tree</span> <span class='assign token'>=</span> <span class='Command constant id'>Command</span><span class='colon2 op'>::</span><span class='Tree constant id'>Tree</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='else identifier id'>else</span><span class='lparen token'>(</span><span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='run_tree identifier id'>run_tree</span><span class='lparen token'>(</span><span class='tree identifier id'>tree</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run_tree</h3>
</div><div id="run_tree-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run_tree</span><span class='args'>(tree, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Executes a Capistrano::Command::Tree object. This is not for direct use,
but should instead be called indirectly, via #run or #parallel, or
#invoke_command.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 149</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L149">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='run_tree identifier id'>run_tree</span><span class='lparen token'>(</span><span class='tree identifier id'>tree</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='comment val'>#:nodoc:</span>
  <span class='if if kw'>if</span> <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='branches identifier id'>branches</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='fallback identifier id'>fallback</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;executing #{tree.fallback}&quot;</span>
  <span class='elsif elsif kw'>elsif</span> <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='branches identifier id'>branches</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;executing multiple commands in parallel&quot;</span>
    <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='branch identifier id'>branch</span><span class='bitor op'>|</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='trace identifier id'>trace</span> <span class='dstring node'>&quot;-&gt; #{branch}&quot;</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;attempt to execute without specifying a command&quot;</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='dry_run identifier id'>dry_run</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='debug identifier id'>debug</span> <span class='andop op'>&amp;&amp;</span> <span class='continue_execution identifier id'>continue_execution</span><span class='lparen token'>(</span><span class='tree identifier id'>tree</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>

  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='add_default_command_options identifier id'>add_default_command_options</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>

  <span class='tree identifier id'>tree</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='branch identifier id'>branch</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='branch identifier id'>branch</span><span class='dot token'>.</span><span class='command identifier id'>command</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='sudo identifier id'>sudo</span><span class='rparen token'>)</span>
      <span class='branch identifier id'>branch</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span> <span class='assign token'>=</span> <span class='sudo_behavior_callback identifier id'>sudo_behavior_callback</span><span class='lparen token'>(</span><span class='branch identifier id'>branch</span><span class='dot token'>.</span><span class='callback identifier id'>callback</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='execute_on_servers identifier id'>execute_on_servers</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='servers identifier id'>servers</span><span class='bitor op'>|</span>
    <span class='targets identifier id'>targets</span> <span class='assign token'>=</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span> <span class='sessions identifier id'>sessions</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
    <span class='Command constant id'>Command</span><span class='dot token'>.</span><span class='process identifier id'>process</span><span class='lparen token'>(</span><span class='tree identifier id'>tree</span><span class='comma token'>,</span> <span class='targets identifier id'>targets</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:logger</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='logger identifier id'>logger</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sudo</h3>
</div><div id="sudo-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sudo</span><span class='args'>(*parameters, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the command string used by capistrano to invoke a comamnd via sudo.
</p>
<pre class="code">
  <span class='run identifier id'>run</span> <span class='dstring node'>&quot;#{sudo :as =&gt; 'bob'} mkdir /path/to/dir&quot;</span>
</pre>
<p>
It can also be invoked like #run, but executing the command via sudo. This
assumes that the sudo password (if required) is the same as the password
for logging in to the server.
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='string val'>&quot;mkdir /path/to/dir&quot;</span>
</pre>
<p>
Also, this method understands a <tt>:sudo</tt> configuration variable,
which (if specified) will be used as the full path to the sudo executable
on the remote machine:
</p>
<pre class="code">
  <span class='set identifier id'>set</span> <span class='symbol val'>:sudo</span><span class='comma token'>,</span> <span class='string val'>&quot;/opt/local/bin/sudo&quot;</span>
</pre>
<p>
If you know what you&#8217;re doing, you can also set
<tt>:sudo_prompt</tt>, which tells capistrano which prompt sudo should use
when asking for a password. (This is so that capistrano knows what prompt
to look for in the output.) If you set :sudo_prompt to an empty string,
Capistrano will not send a preferred prompt.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 199</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L199">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">199
200
201
202
203
204
205
206
207
208
209
210
211
212
213</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='sudo identifier id'>sudo</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='parameters identifier id'>parameters</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='parameters identifier id'>parameters</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='parameters identifier id'>parameters</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:as</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='dstring node'>&quot;-u #{options.delete(:as)}&quot;</span>

  <span class='sudo_prompt_option identifier id'>sudo_prompt_option</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;-p '#{sudo_prompt}'&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='sudo_prompt identifier id'>sudo_prompt</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='sudo_command identifier id'>sudo_command</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:sudo</span><span class='comma token'>,</span> <span class='string val'>&quot;sudo&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='sudo_prompt_option identifier id'>sudo_prompt_option</span><span class='comma token'>,</span> <span class='user identifier id'>user</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='command identifier id'>command</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='sudo_command identifier id'>sudo_command</span> <span class='plus op'>+</span> <span class='string val'>&quot; &quot;</span> <span class='plus op'>+</span> <span class='command identifier id'>command</span>
    <span class='run identifier id'>run</span><span class='lparen token'>(</span><span class='command identifier id'>command</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='return return kw'>return</span> <span class='sudo_command identifier id'>sudo_command</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sudo_behavior_callback</h3>
</div><div id="sudo_behavior_callback-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sudo_behavior_callback</span><span class='args'>(fallback)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns a Proc object that defines the behavior of the sudo callback. The
returned Proc will defer to the <tt>fallback</tt> argument (which should
also be a Proc) for any output it does not explicitly handle.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 219</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L219">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='sudo_behavior_callback identifier id'>sudo_behavior_callback</span><span class='lparen token'>(</span><span class='fallback identifier id'>fallback</span><span class='rparen token'>)</span> <span class='comment val'>#:nodoc:</span>
  <span class='comment val'># in order to prevent _each host_ from prompting when the password</span>
  <span class='comment val'># was wrong, let's track which host prompted first and only allow</span>
  <span class='comment val'># subsequent prompts from that host.</span>
  <span class='prompt_host identifier id'>prompt_host</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='Proc constant id'>Proc</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ch identifier id'>ch</span><span class='comma token'>,</span> <span class='stream identifier id'>stream</span><span class='comma token'>,</span> <span class='out identifier id'>out</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='out identifier id'>out</span> <span class='match op'>=~</span> <span class='regexp val'>/^Sorry, try again/</span>
      <span class='if if kw'>if</span> <span class='prompt_host identifier id'>prompt_host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='prompt_host identifier id'>prompt_host</span> <span class='eq op'>==</span> <span class='ch identifier id'>ch</span><span class='lbrack token'>[</span><span class='symbol val'>:server</span><span class='rbrack token'>]</span>
        <span class='prompt_host identifier id'>prompt_host</span> <span class='assign token'>=</span> <span class='ch identifier id'>ch</span><span class='lbrack token'>[</span><span class='symbol val'>:server</span><span class='rbrack token'>]</span>
        <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='important identifier id'>important</span> <span class='out identifier id'>out</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{stream} :: #{ch[:server]}&quot;</span>
        <span class='reset! fid id'>reset!</span> <span class='symbol val'>:password</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='out identifier id'>out</span> <span class='match op'>=~</span> <span class='dregexp node'>/^#{Regexp.escape(sudo_prompt)}/</span>
      <span class='ch identifier id'>ch</span><span class='dot token'>.</span><span class='send_data identifier id'>send_data</span> <span class='dstring node'>&quot;#{self[:password]}\n&quot;</span>
    <span class='elsif elsif kw'>elsif</span> <span class='fallback identifier id'>fallback</span>
      <span class='fallback identifier id'>fallback</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='ch identifier id'>ch</span><span class='comma token'>,</span> <span class='stream identifier id'>stream</span><span class='comma token'>,</span> <span class='out identifier id'>out</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sudo_prompt</h3>
</div><div id="sudo_prompt-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sudo_prompt</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the prompt text to use with sudo
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/configuration/actions/invocation.rb', line 267</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/capistrano/capistrano/blob/31e16a1c469f797fa4a35a68aecae1acd4d0f471/lib/capistrano/configuration/actions/invocation.rb#L267">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">267
268
269</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='sudo_prompt identifier id'>sudo_prompt</span>
  <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:sudo_prompt</span><span class='comma token'>,</span> <span class='string val'>&quot;sudo password: &quot;</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>