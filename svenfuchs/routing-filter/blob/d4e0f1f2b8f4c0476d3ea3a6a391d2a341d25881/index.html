<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>svenfuchs's routing-filter - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/svenfuchs/commits/routing-filter/master" rel="alternate" title="Recent Commits to routing-filter:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    GitHubRepo.init("svenfuchs", "routing-filter", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='svenfuchs/routing-filter/blob/d4e0f1f2b8f4c0476d3ea3a6a391d2a341d25881' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='svenfuchs/routing-filter/blob/d4e0f1f2b8f4c0476d3ea3a6a391d2a341d25881' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("svenfuchs", "routing-filter", "d4e0f1f2b8f4c0476d3ea3a6a391d2a341d25881", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/svenfuchs/routing-filter/tree/">Source</a></li>
            <li class=""><a href="http://github.com/svenfuchs/routing-filter/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/svenfuchs/routing-filter/network">Network</a></li>            
            <li class=""><a href="http://github.com/svenfuchs/routing-filter/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/svenfuchs/routing-filter">Wiki</a></li>
            <li class=""><a href="http://github.com/svenfuchs/routing-filter/graphs">Graphs</a></li>                    
            <li class="active"><a href="/svenfuchs/routing-filter">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/svenfuchs">svenfuchs</a> / <b><a href="http://github.com/svenfuchs/routing-filter/tree">routing-filter</a></b>        
                <a id="namespaces_button" rel="svenfuchs/routing-filter/blob/d4e0f1f2b8f4c0476d3ea3a6a391d2a341d25881" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="svenfuchs/routing-filter/blob/d4e0f1f2b8f4c0476d3ea3a6a391d2a341d25881" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h2>Routing Filter</h2>

<p>This plugin is a wild hack that wraps around the complex beast that the Rails
routing system is to allow for unseen flexibility and power in Rails URL
recognition and generation.</p>

<p>As powerful and awesome the Rails' routes are, when you need to design your
URLs in a manner that only slightly leaves the paved cowpaths of Rails
conventions, you're usually unable to use all the goodness of helpers and
convenience that Rails ships with.</p>

<h2>Usage</h2>

<p>This plugin comes with a locale routing filter that demonstrates the
implementation of a custom filter. </p>

<p>The following would be a sceleton of an empty filter:</p>

<pre class="code"><span class='module module kw'>module</span> <span class='RoutingFilter constant id'>RoutingFilter</span>
  <span class='class class kw'>class</span> <span class='Awesomeness constant id'>Awesomeness</span> <span class='lt op'>&lt;</span> <span class='Base constant id'>Base</span>
    <span class='def def kw'>def</span> <span class='around_recognize identifier id'>around_recognize</span><span class='lparen token'>(</span><span class='route identifier id'>route</span><span class='comma token'>,</span> <span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='env identifier id'>env</span><span class='rparen token'>)</span>
      <span class='comment val'># Alter the path here before it gets recognized. </span>
      <span class='comment val'># Make sure to yield (calls the next around filter if present and </span>
      <span class='comment val'># eventually `recognize_path` on the routeset):</span>
      <span class='returning identifier id'>returning</span> <span class='yield yield kw'>yield</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='params identifier id'>params</span><span class='bitor op'>|</span>
        <span class='comment val'># You can additionally modify the params here before they get passed</span>
        <span class='comment val'># to the controller.</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='around_generate identifier id'>around_generate</span><span class='lparen token'>(</span><span class='controller identifier id'>controller</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
      <span class='comment val'># Alter arguments here before they are passed to `url_for`. </span>
      <span class='comment val'># Make sure to yield (calls the next around filter if present and </span>
      <span class='comment val'># eventually `url_for` on the controller):</span>
      <span class='returning identifier id'>returning</span> <span class='yield yield kw'>yield</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='bitor op'>|</span>
        <span class='comment val'># You can change the generated url_or_path here. Make sure to use</span>
        <span class='comment val'># one of the &quot;in-place&quot; modifying String methods though (like sub! </span>
        <span class='comment val'># and friends).</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>

<p>You then have to specify the filter explicitely in your routes.rb:</p>

<pre class="code"><span class='ActionController constant id'>ActionController</span><span class='colon2 op'>::</span><span class='Routing constant id'>Routing</span><span class='colon2 op'>::</span><span class='Routes constant id'>Routes</span><span class='dot token'>.</span><span class='draw identifier id'>draw</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='map identifier id'>map</span><span class='bitor op'>|</span>
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span> <span class='string val'>'awesomeness'</span>
<span class='end end kw'>end</span>
</pre>

<p>(I am not sure if it makes sense to provide more technical information than
this because the usage of this plugin definitely requires some advanced
knowledge about Rails internals and especially its routing system. So, I
figure, anyone who could use this should also be able to read the code and
figure out what it's doing much better then from any lengthy documentation.</p>

<p>If I'm mistaken on this please drop me an email with your suggestions.)</p>

<h2>Rationale: Two example usecases</h2>

<p>An early usecase from which this originated was the need to define a locale
at the beginning of an URL in a way so that </p>

<ul>
<li>the locale can be omitted when it is the default locale</li>
<li>all the url_helpers that are generated by named routes continue to work in 
a concise manner (i.e. without specifying all parameters again and again)</li>
<li>ideally also plays nicely with default route helpers in tests/specs</li>
</ul>

<p>You can read about this struggle and two possible, yet unsatisfying solutions
<a href="http://www.artweb-design.de/2007/5/13/concise-localized-rails-url-helpers-solved-twice">here</a>.
The conclusion so far is that Rails itself does not provide the tools to solve
this problem in a clean and dry way.</p>

<p>Another usecase that eventually spawned the manifestation of this plugin was 
the need to map an arbitrary count of path segments to a certain model 
instance. In an application that I've been working on recently I needed to 
map URL paths to a nested tree of models like so:</p>

<pre class="code"><span class='root identifier id'>root</span>
<span class='plus op'>+</span> <span class='docs identifier id'>docs</span>
  <span class='plus op'>+</span> <span class='api identifier id'>api</span>
  <span class='plus op'>+</span> <span class='wiki identifier id'>wiki</span>
</pre>

<p>E.g. the docs section should map to the path <code>/docs</code>, the api section to 
the path <code>/docs/api</code> and so on. Furthermore, after these paths there need to be 
more things to be specified. E.g. the wiki needs to define a whole Rails 
resource with URLs like <code>/docs/wiki/pages/1/edit</code>.</p>

<p>The only way to solve this problem with Rails' routing toolkit is to map
a big, bold <code>/*everything</code> catch-all ("globbing") route and process the whole 
path in a custom dispatcher.</p>

<p>This, of course, is a really unsatisfying solution because one has to
reimplement everything that Rails routes are here to help with: regarding both 
URL recognition (like parameter mappings, resources, ...) and generation 
(url_helpers).</p>

<h2>Solution</h2>

<p>This plugin offers a solution that takes exactly the opposite route. </p>

<p>Instead of trying to change things <em>between</em> the URL recognition and
generation stages to achieve the desired result it <em>wraps around</em> the whole
routing system and allows to pre- and post-filter both what goes into it 
(URL recognition) and what comes out of it (URL generation).</p>

<p>This way we can leave <em>everything</em> else completely untouched. </p>

<ul>
<li>We can tinker with the URLs that we receive from the server and feed URLs to 
Rails that perfectly match the best breed of Rails' conventions. </li>
<li>Inside of the application we can use all the nice helper goodness and 
conveniences that rely on these conventions being followed. </li>
<li>Finally we can accept URLs that have been generated by the url_helpers and,
again, mutate them in the way that matches our requirements.</li>
</ul>

<p>So, even though the plugin itself is a blatant monkey-patch to one of the
most complex area of Rails internals, this solution seems to be effectively
less intrusive and pricey than others are.</p>

<h2>Etc</h2>

<p>Authors: <a href="http://www.artweb-design.de">Sven Fuchs</a> <svenfuchs at artweb-design dot de><br/>
License: MIT </p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>