<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>metaskills's pdf-writer - Class: PDF::Writer::External::Image - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/metaskills/commits/pdf-writer/master" rel="alternate" title="Recent Commits to pdf-writer:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("metaskills", "pdf-writer", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='metaskills/pdf-writer/blob/7f5bc6c9ce69c26574bbfde36ebdb9ecf06709d0' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='metaskills/pdf-writer/blob/7f5bc6c9ce69c26574bbfde36ebdb9ecf06709d0' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("metaskills", "pdf-writer", "7f5bc6c9ce69c26574bbfde36ebdb9ecf06709d0", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/metaskills/pdf-writer/tree/">Source</a></li>
            <li class=""><a href="http://github.com/metaskills/pdf-writer/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/metaskills/pdf-writer/network">Network</a></li>            
            <li class=""><a href="http://github.com/metaskills/pdf-writer/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/metaskills/pdf-writer">Wiki</a></li>
            <li class=""><a href="http://github.com/metaskills/pdf-writer/graphs">Graphs</a></li>                    
            <li class="active"><a href="/metaskills/pdf-writer">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/metaskills">metaskills</a> / <b><a href="http://github.com/metaskills/pdf-writer/tree">pdf-writer</a></b>        
                <a id="namespaces_button" rel="metaskills/pdf-writer/blob/7f5bc6c9ce69c26574bbfde36ebdb9ecf06709d0" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="metaskills/pdf-writer/blob/7f5bc6c9ce69c26574bbfde36ebdb9ecf06709d0" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class PDF_Writer_External_Image">
  <h1>Class: PDF::Writer::External::Image</h1>
  <div class="section inheritance">
  <ul>
  <li><a href="../Object.html" title="PDF::Writer::Object">PDF::Writer::Object</a></li><ul><li><a href="../External.html" title="PDF::Writer::External">PDF::Writer::External</a></li><ul><li>PDF::Writer::External::Image</li>
  </ul></ul></ul>
</div><div class="section docstring">
  <p>
An image object. This will be an /XObject dictionary in the document. This
includes description and data. The diectionary includes:
</p>
<table>
<tr><td valign="top">Type:</td><td>(name, Optional) The type of PDF object that this dictionary describes; if
present, must be /XObject for an image XObject.

</td></tr>
<tr><td valign="top">Subtype:</td><td>(name, Required) The type of XObject that this dictionary describes; must
be /Image for an image /XObject.

</td></tr>
<tr><td valign="top">Width:</td><td>(integer, Required) The width of the image, in samples.

</td></tr>
<tr><td valign="top">Height:</td><td>(integer, Required) The height of the image, in samples.

</td></tr>
<tr><td valign="top">ColorSpace:</td><td>(name or array, Required for images, except those that use the /JPXDecode
filter; not allowed for image masks) The color space in which image samples
are specified; it can be any type of color space except /Pattern. If the
image uses the JPXDecode filter, this entry is optional: * If /ColorSpace
is present, any color space specifications in the JPEG2000 data are
ignored. * If /ColorSpace is absent, the color space specifications in the
JPEG2000 data are used. The /Decode array is also ignored unless /ImageMask
is true.

</td></tr>
<tr><td valign="top">BitsPerComponent:</td><td>(integer, Required except for image masks and images that use the JPXDecode
filter) The number of bits used to represent each color component. Only a
single value may be specified; the number of bits is the same for all color
components. Valid values are 1, 2, 4, 8, and (in PDF 1.5) 16. If /ImageMask
is true, this entry is optional, and if specified, its value must be 1. If
the image stream uses a filter, the value of BitsPerComponent must be
consistent with the size of the data samples that the filter delivers. In
particular, a CCITTFaxDecode or JBIG2Decode filter always delivers 1-bit
samples, a RunLengthDecode or DCTDecode filter delivers 8-bit samples, and
an LZWDecode or FlateDecode filter delivers samples of a specified size if
a predictor function is used. If the image stream uses the JPXDecode
filter, this entry is optional and ignored if present. The bit depth is
determined in the process of decoding the JPEG2000 image.

</td></tr>
<tr><td valign="top">Intent:</td><td>(name, Optional; PDF 1.1) The name of a color rendering intent to be used
in rendering the image (see “Rendering Intents” on page 230). Default
value: the current rendering intent in the graphics state.

</td></tr>
<tr><td valign="top">ImageMask:</td><td>(boolean, Optional) A flag indicating whether the image is to be treated as
an image mask (see Section 4.8.5, “Masked Images”). If this flag is true,
the value of /BitsPerComponent must be 1 and Mask and /ColorSpace should
not be specified; unmasked areas are painted using the current nonstroking
color. Default value: false.

</td></tr>
<tr><td valign="top">Mask:</td><td>(stream or array, Optional except for image masks; not allowed for image
masks; PDF 1.3) An image XObject defining an image mask to be applied to
this image (see “Explicit Masking” on page 321), or an array specifying a
range of colors to be applied to it as a color key mask (see “Color Key
Masking” on page 321). If ImageMask is true, this entry must not be
present. (See implementation note 51 in Appendix H.)

</td></tr>
<tr><td valign="top">Decode:</td><td>(array, Optional) An array of numbers describing how to map image samples
into the range of values appropriate for the image’s color space (see
“Decode Arrays” on page 314). If ImageMask is true, the array must be
either [0 1] or [1 0]; otherwise, its length must be twice the number of
color components required by ColorSpace. If the image uses the JPXDecode
filter and ImageMask is false, Decode is ignored. Default value: see
“Decode Arrays” on page 314.

</td></tr>
<tr><td valign="top">Interpolate:</td><td>(boolean, Optional) A flag indicating whether image interpolation is to be
performed (see “Image Interpolation” on page 316). Default value: false.

</td></tr>
<tr><td valign="top">Alternates:</td><td>(array, Optional; PDF 1.3) An array of alternate image dictionaries for
this image (see “Alternate Images” on page 317). The order of elements
within the array has no significance. This entry may not be present in an
image XObject that is itself an alternate image.

</td></tr>
<tr><td valign="top">SMask:</td><td>(stream, Optional; PDF 1.4) A subsidiary image XObject defining a soft-mask
image (see “Soft-Mask Images” on page 522) to be used as a source of mask
shape or mask opacity values in the transparent imaging model. The alpha
source parameter in the graphics state determines whether the mask values
are interpreted as shape or opacity. If present, this entry overrides the
current soft mask in the graphics state, as well as the image’s Mask entry,
if any. (However, the other transparency related graphics state
parameters—blend mode and alpha constant—remain in effect.) If SMask is
absent, the image has no associated soft mask (although the current soft
mask in the graphics state may still apply).

</td></tr>
<tr><td valign="top">SMaskInData:</td><td>(integer, Optional for images that use the JPXDecode filter, meaningless
otherwise; PDF 1.5) A code specifying how soft-mask information (see
“Soft-Mask Images” on page 522) encoded with image samples should be used:
(0) If present, encoded soft-mask image information should be ignored. (1)
The image’s data stream includes encoded soft-mask values. An application
can create a soft-mask image from the information to be used as a source of
mask shape or mask opacity in the transparency imaging model. (2) The
image’s data stream includes color channels that have been preblended with
a background; the image data also includes an opacity channel. An
application can create a soft-mask image with a Matte entry from the
opacity channel information to be used as a source of mask shape or mask
opacity in the transparency model.

<ul>
<li>If this entry has a nonzero value, SMask should not

</li>
</ul>
<p>
be specified. See also Section 3.3.8, “JPXDecode Filter.” Default value: 0.
</p>
</td></tr>
<tr><td valign="top">Name:</td><td>(name, Required in PDF 1.0; optional otherwise) The name by which this
image XObject is referenced in the XObject subdictionary of the current
resource dictionary (see Section 3.7.2, “Resource Dictionaries”). Note:
This entry is obsolescent and its use is no longer recommended. (See
implementation note 52 in Appendix H.)

</td></tr>
<tr><td valign="top">StructParent:</td><td>(integer, Required if the image is a structural content item; PDF 1.3) The
integer key of the image’s entry in the structural parent tree (see
“Finding Structure Elements from Content Items” on page 797).

</td></tr>
<tr><td valign="top">ID:</td><td>(string, Optional; PDF 1.3; indirect reference preferred) The digital
identifier of the image’s parent Web Capture content set (see Section
10.9.5, “Object Attributes Related to Web Capture”).

</td></tr>
<tr><td valign="top">OPI:</td><td>(dictionary, Optional; PDF 1.2) An OPI version dictionary for the image
(see Section 10.10.6, “Open Prepress Interface (OPI)”). If ImageMask is
true, this entry is ignored.

</td></tr>
<tr><td valign="top">Metadata:</td><td>(stream, Optional; PDF 1.4) A metadata stream containing metadata for the
image (see Section 10.2.2, “Metadata Streams”).

</td></tr>
<tr><td valign="top">OC:</td><td>(dictionary, Optional; PDF 1.5) An optional content group or optional
content membership dictionary (see Section 4.10, “Optional Content”),
specifying the optional content properties for this image XObject. Before
the image is processed, its visibility is determined based on this entry.
If it is determined to be invisible, the entire image is skipped, as if
there were no Do operator to invoke it.

</td></tr>
</table>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">image_info</td>
          <td class="readwrite">
            [<span id='image_info-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>image_info</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">label</td>
          <td class="readwrite">
            [<span id='label-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>label</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(parent, data, image, label)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pdf/writer/object/image.rb', line 157</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/metaskills/pdf-writer/blob/7f5bc6c9ce69c26574bbfde36ebdb9ecf06709d0/lib/pdf/writer/object/image.rb#L157">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='parent identifier id'>parent</span><span class='comma token'>,</span> <span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='image identifier id'>image</span><span class='comma token'>,</span> <span class='label identifier id'>label</span><span class='rparen token'>)</span>
  <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='parent identifier id'>parent</span><span class='rparen token'>)</span>

  <span class='@data ivar id'>@data</span> <span class='assign token'>=</span> <span class='data identifier id'>data</span>

  <span class='@image_info ivar id'>@image_info</span> <span class='assign token'>=</span> <span class='image identifier id'>image</span>

  <span class='@info ivar id'>@info</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='string val'>'Type'</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'/XObject'</span><span class='comma token'>,</span>
    <span class='string val'>'Subtype'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'/Image'</span><span class='comma token'>,</span>
    <span class='string val'>'Width'</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span>
    <span class='string val'>'Height'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='height identifier id'>height</span>
  <span class='rbrace token'>}</span>

  <span class='case case kw'>case</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='format identifier id'>format</span>
  <span class='when when kw'>when</span> <span class='string val'>&quot;JPEG&quot;</span>
    <span class='case case kw'>case</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='channels identifier id'>channels</span>
    <span class='when when kw'>when</span> <span class='integer val'>1</span>
      <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'ColorSpace'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'/DeviceGray'</span>
    <span class='when when kw'>when</span> <span class='integer val'>4</span>
      <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'ColorSpace'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'/DeviceCMYK'</span>
        <span class='comment val'># This should fix problems with CMYK JPEG colours inverted in</span>
        <span class='comment val'># Adobe Acrobat. Enable only if appropriate.</span>
<span class='comment val'>#       @info['Decode'] = '[1.0 0.0 1.0 0.0 1.0 0.0 1.0 0.0]'</span>
    <span class='else else kw'>else</span>
      <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'ColorSpace'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'/DeviceRGB'</span>
    <span class='end end kw'>end</span>
    <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'Filter'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'/DCTDecode'</span>
    <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'BitsPerComponent'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>8</span>
  <span class='when when kw'>when</span> <span class='string val'>&quot;PNG&quot;</span>
    <span class='if if kw'>if</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='symbol val'>:compression_method</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
      <span class='raise identifier id'>raise</span> <span class='TypeError constant id'>TypeError</span><span class='comma token'>,</span> <span class='PDF constant id'>PDF</span><span class='colon2 op'>::</span><span class='Writer constant id'>Writer</span><span class='colon2 op'>::</span><span class='Lang constant id'>Lang</span><span class='lbrack token'>[</span><span class='symbol val'>:png_unsupp_compres</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='symbol val'>:filter_method</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
      <span class='raise identifier id'>raise</span> <span class='TypeError constant id'>TypeError</span><span class='comma token'>,</span> <span class='PDF constant id'>PDF</span><span class='colon2 op'>::</span><span class='Writer constant id'>Writer</span><span class='colon2 op'>::</span><span class='Lang constant id'>Lang</span><span class='lbrack token'>[</span><span class='symbol val'>:png_unsupp_filter</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span><span class='lparen token'>(</span><span class='PDF constant id'>PDF</span><span class='colon2 op'>::</span><span class='Writer constant id'>Writer</span><span class='colon2 op'>::</span><span class='OffsetReader constant id'>OffsetReader</span><span class='rparen token'>)</span>

    <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='integer val'>8</span><span class='rparen token'>)</span>  <span class='comment val'># Skip the default header</span>

    <span class='ok identifier id'>ok</span>      <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='length identifier id'>length</span>  <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
    <span class='palette identifier id'>palette</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
    <span class='idat identifier id'>idat</span>    <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>

    <span class='while while kw'>while</span> <span class='ok identifier id'>ok</span>
      <span class='chunk_size identifier id'>chunk_size</span>  <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>&quot;N&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
      <span class='section identifier id'>section</span>     <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>
      <span class='case case kw'>case</span> <span class='section identifier id'>section</span>
      <span class='when when kw'>when</span> <span class='string val'>'PLTE'</span>
        <span class='palette identifier id'>palette</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='chunk_size identifier id'>chunk_size</span><span class='rparen token'>)</span>
      <span class='when when kw'>when</span> <span class='string val'>'IDAT'</span>
        <span class='idat identifier id'>idat</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='chunk_size identifier id'>chunk_size</span><span class='rparen token'>)</span>
      <span class='when when kw'>when</span> <span class='string val'>'tRNS'</span>
          <span class='comment val'># This chunk can only occur once and it must occur after the</span>
          <span class='comment val'># PLTE chunk and before the IDAT chunk</span>
        <span class='trans identifier id'>trans</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
        <span class='case case kw'>case</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='symbol val'>:color_type</span><span class='rbrack token'>]</span>
        <span class='when when kw'>when</span> <span class='integer val'>3</span>
            <span class='comment val'># Indexed colour, RGB. Each byte in this chunk is an alpha for</span>
            <span class='comment val'># the palette index in the PLTE (&quot;palette&quot;) chunk up until the</span>
            <span class='comment val'># last non-opaque entry. Set up an array, stretching over all</span>
            <span class='comment val'># palette entries which will be 0 (opaque) or 1 (transparent).</span>
          <span class='trans identifier id'>trans</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='string val'>'indexed'</span>
          <span class='trans identifier id'>trans</span><span class='lbrack token'>[</span><span class='symbol val'>:data</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='chunk_size identifier id'>chunk_size</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>&quot;C*&quot;</span><span class='rparen token'>)</span>
        <span class='when when kw'>when</span> <span class='integer val'>0</span>
            <span class='comment val'># Greyscale. Corresponding to entries in the PLTE chunk.</span>
            <span class='comment val'># Grey is two bytes, range 0 .. (2 ^ bit-depth) - 1</span>
          <span class='trans identifier id'>trans</span><span class='lbrack token'>[</span><span class='symbol val'>:grayscale</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>&quot;n&quot;</span><span class='rparen token'>)</span>
          <span class='trans identifier id'>trans</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span>      <span class='assign token'>=</span> <span class='string val'>'indexed'</span>
<span class='comment val'>#           trans[:data]      = data.read_o.unpack(&quot;C&quot;)</span>
        <span class='when when kw'>when</span> <span class='integer val'>2</span>
            <span class='comment val'># True colour with proper alpha channel.</span>
          <span class='trans identifier id'>trans</span><span class='lbrack token'>[</span><span class='symbol val'>:rgb</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='integer val'>6</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>&quot;nnn&quot;</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='offset identifier id'>offset</span> <span class='opasgn op'>+=</span> <span class='chunk_size identifier id'>chunk_size</span>
      <span class='end end kw'>end</span>

      <span class='ok identifier id'>ok</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='section identifier id'>section</span> <span class='neq op'>!=</span> <span class='string val'>&quot;IEND&quot;</span><span class='rparen token'>)</span>

      <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='read_o identifier id'>read_o</span><span class='lparen token'>(</span><span class='integer val'>4</span><span class='rparen token'>)</span>  <span class='comment val'># Skip the CRC</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='bits identifier id'>bits</span> <span class='gt op'>&gt;</span> <span class='integer val'>8</span>
      <span class='raise identifier id'>raise</span> <span class='TypeError constant id'>TypeError</span><span class='comma token'>,</span> <span class='PDF constant id'>PDF</span><span class='colon2 op'>::</span><span class='Writer constant id'>Writer</span><span class='colon2 op'>::</span><span class='Lang constant id'>Lang</span><span class='lbrack token'>[</span><span class='symbol val'>:png_8bit_colour</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='symbol val'>:interlace_method</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
      <span class='raise identifier id'>raise</span> <span class='TypeError constant id'>TypeError</span><span class='comma token'>,</span> <span class='PDF constant id'>PDF</span><span class='colon2 op'>::</span><span class='Writer constant id'>Writer</span><span class='colon2 op'>::</span><span class='Lang constant id'>Lang</span><span class='lbrack token'>[</span><span class='symbol val'>:png_interlace</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='ncolor identifier id'>ncolor</span>  <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='colour identifier id'>colour</span>  <span class='assign token'>=</span> <span class='string val'>'DeviceRGB'</span>
    <span class='case case kw'>case</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='symbol val'>:color_type</span><span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='integer val'>3</span>
      <span class='nil nil kw'>nil</span>
    <span class='when when kw'>when</span> <span class='integer val'>2</span>
      <span class='ncolor identifier id'>ncolor</span> <span class='assign token'>=</span> <span class='integer val'>3</span>
    <span class='when when kw'>when</span> <span class='integer val'>0</span>
      <span class='colour identifier id'>colour</span> <span class='assign token'>=</span> <span class='string val'>'DeviceGray'</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='TypeError constant id'>TypeError</span><span class='comma token'>,</span> <span class='PDF constant id'>PDF</span><span class='colon2 op'>::</span><span class='Writer constant id'>Writer</span><span class='colon2 op'>::</span><span class='Lang constant id'>Lang</span><span class='lbrack token'>[</span><span class='symbol val'>:png_alpha_trans</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'Filter'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'[/FlateDecode]'</span>
    <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'DecodeParms'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;[&lt;&lt;/Predictor 15 /Colors #{ncolor} /Columns #{image.width}&gt;&gt;]&quot;</span>
    <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'BitsPerComponent'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='bits identifier id'>bits</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>

    <span class='unless unless kw'>unless</span> <span class='palette identifier id'>palette</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'ColorSpace'</span><span class='rbrack token'>]</span>  <span class='assign token'>=</span> <span class='dstring node'>&quot; [ /Indexed /DeviceRGB #{(palette.size / 3) - 1} &quot;</span>
      <span class='contents identifier id'>contents</span>            <span class='assign token'>=</span> <span class='PDF constant id'>PDF</span><span class='colon2 op'>::</span><span class='Writer constant id'>Writer</span><span class='colon2 op'>::</span><span class='Object constant id'>Object</span><span class='colon2 op'>::</span><span class='Contents constant id'>Contents</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='parent identifier id'>parent</span><span class='comma token'>,</span>
                                                              <span class='self self kw'>self</span><span class='rparen token'>)</span>
      <span class='contents identifier id'>contents</span><span class='dot token'>.</span><span class='data identifier id'>data</span>       <span class='assign token'>=</span> <span class='palette identifier id'>palette</span>
      <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'ColorSpace'</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{contents.oid} 0 R ]&quot;</span>

      <span class='if if kw'>if</span> <span class='trans identifier id'>trans</span>
        <span class='case case kw'>case</span> <span class='trans identifier id'>trans</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span>
        <span class='when when kw'>when</span> <span class='string val'>'indexed'</span>
          <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'Mask'</span><span class='rbrack token'>]</span>   <span class='assign token'>=</span> <span class='dstring node'>&quot; [ #{trans[:data].join(' ')} ] &quot;</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='@info ivar id'>@info</span><span class='lbrack token'>[</span><span class='string val'>'ColorSpace'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;/#{colour}&quot;</span>
    <span class='end end kw'>end</span>

    <span class='@data ivar id'>@data</span> <span class='assign token'>=</span> <span class='idat identifier id'>idat</span>
  <span class='end end kw'>end</span>

  <span class='@label ivar id'>@label</span> <span class='assign token'>=</span> <span class='label identifier id'>label</span>

    <span class='comment val'># assign it a place in the named resource dictionary as an external</span>
    <span class='comment val'># object, according to the label passed in with it.</span>
  <span class='@parent ivar id'>@parent</span><span class='dot token'>.</span><span class='pages identifier id'>pages</span> <span class='lshft op'>&lt;&lt;</span> <span class='self self kw'>self</span>
    <span class='comment val'># also make sure that we have the right procset object for it.</span>
  <span class='@parent ivar id'>@parent</span><span class='dot token'>.</span><span class='procset identifier id'>procset</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>'ImageC'</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#to_s-instance_method">#to_s</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>to_s</h3>
</div><div id="to_s-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_s</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/pdf/writer/object/image.rb', line 297</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/metaskills/pdf-writer/blob/7f5bc6c9ce69c26574bbfde36ebdb9ecf06709d0/lib/pdf/writer/object/image.rb#L297">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">297
298
299
300
301
302
303</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='to_s identifier id'>to_s</span>
  <span class='tmp identifier id'>tmp</span> <span class='assign token'>=</span> <span class='@data ivar id'>@data</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='res identifier id'>res</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;\n#{@oid} 0 obj\n&lt;&lt;&quot;</span>
  <span class='@info ivar id'>@info</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='res identifier id'>res</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;\n/#{k} #{v}&quot;</span><span class='rbrace token'>}</span>
  <span class='res identifier id'>res</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;\n/Length #{tmp.size} &gt;&gt;\nstream\n#{tmp}\nendstream\nendobj\n&quot;</span>
  <span class='res identifier id'>res</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>