<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jtprince's mspire - Class: SpecID::Precision::Filter - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jtprince/commits/mspire/master" rel="alternate" title="Recent Commits to mspire:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jtprince", "mspire", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jtprince", "mspire", "12c04cb5d772ed265127dd94446ed8162423b373", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jtprince/mspire/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jtprince/mspire/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jtprince/mspire/network">Network</a></li>            
            <li class=""><a href="http://github.com/jtprince/mspire/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jtprince/mspire">Wiki</a></li>
            <li class=""><a href="http://github.com/jtprince/mspire/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jtprince/mspire">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jtprince">jtprince</a> / <b><a href="http://github.com/jtprince/mspire/tree">mspire</a></b>        
                <a id="namespaces_button" rel="jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class SpecID_Precision_Filter">
  <h1>Class: SpecID::Precision::Filter</h1>
  <div class="section docstring">
  <p>
require &#8216;filter/spec_id/cmdline&#8217;
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="FV_DEFAULTS-constant">FV_DEFAULTS</dt>
      <dd>{
  :sequest =&gt; 
  {
    :xcorr1 =&gt; 1.0, 
    :xcorr2 =&gt; 1.5,
    :xcorr3 =&gt; 2.0,
    :deltacn =&gt; 0.1,
    :ppm =&gt; 1000,
    :include_deltacnstar =&gt; true,
  },


  # output
  :proteins =&gt; false,
  :output =&gt; [],

  # general
  :top_hit_by =&gt; :xcorr,
  :postfilter =&gt; :top_per_scan,
  :prefilter =&gt; false,
  :hits_together =&gt; true,

  # These are also defaulted in the commandline because they are necessary
  # for the validators...  could this introduce conflicts somehow?
  :decoy_on_match =&gt; true,
  :ties =&gt; true,

  # UNLISTED FOR NOW:
  :include_ties_in_top_hit_prefilter =&gt; true,
  :include_ties_in_top_hit_postfilter =&gt; false,
}</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#filter_and_validate-instance_method">#filter_and_validate</span><span class='args'>(spec_id_obj, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
# output_array has doublets of [format, handle]
</p>
<pre class="code">
 <span class='comment val'># answer is the answer one gets out of filter_and_validate</span>
 <span class='def def kw'>def</span> <span class='output identifier id'>output</span><span class='lparen token'>(</span><span class='answer identifier id'>answer</span><span class='comma token'>,</span> <span class='output_array identifier id'>output_array</span><span class='rparen token'>)</span>
   <span class='output_array identifier id'>output_array</span><span class='dot token'>.</span>
</pre>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#filter_and_validate_cmdline-instance_method">#filter_and_validate_cmdline</span><span class='args'>(args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_pephit_precision-instance_method">#get_pephit_precision</span><span class='args'>(validators, peps, decoy_peps = nil, grant_transmem_status = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
takes an array of validator objects and peps (already separated out from
decoys; the decoy&#8217;s can be passed in returns an array of results.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#peptide_precision_to_protein_precision-instance_method">#peptide_precision_to_protein_precision</span><span class='args'>(protein_validator, peps, peptide_precision_array, round_num_false = :ceil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
takes peps and a peptide_precision_hash.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>filter_and_validate</h3>
</div><div id="filter_and_validate-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>filter_and_validate</span><span class='args'>(spec_id_obj, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
# output_array has doublets of [format, handle]
</p>
<pre class="code">
 <span class='comment val'># answer is the answer one gets out of filter_and_validate</span>
 <span class='def def kw'>def</span> <span class='output identifier id'>output</span><span class='lparen token'>(</span><span class='answer identifier id'>answer</span><span class='comma token'>,</span> <span class='output_array identifier id'>output_array</span><span class='rparen token'>)</span>
   <span class='output_array identifier id'>output_array</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='format identifier id'>format</span><span class='comma token'>,</span> <span class='handle identifier id'>handle</span><span class='bitor op'>|</span>
     <span class='SpecID constant id'>SpecID</span><span class='colon2 op'>::</span><span class='Precision constant id'>Precision</span><span class='colon2 op'>::</span><span class='Filter constant id'>Filter</span><span class='colon2 op'>::</span><span class='Output constant id'>Output</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='format identifier id'>format</span><span class='comma token'>,</span> <span class='handle identifier id'>handle</span><span class='rparen token'>)</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>
</pre>
<p>
Very high level method that takes simple parameters. spec_id may be a
filename or a SpecID object (containing peps) Default values may be queried
from SpecID::Precision::Filter::FV_DEFAULTS Returns a structured hash:
</p>
<pre class="code">
 <span class='Fl constant id'>Fl</span> <span class='assign token'>=</span> <span class='Float constant id'>Float</span> <span class='semicolon token'>;</span> <span class='Ar constant id'>Ar</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span>
</pre>
<p>
{ :params =&gt; &lt;Hash of filtering params&gt;,
</p>
<pre class="code">
  <span class='symbol val'>:pephits</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='Ar constant id'>Ar</span> <span class='of identifier id'>of</span> <span class='pephits identifier id'>pephits</span><span class='gt op'>&gt;</span><span class='comma token'>,</span>
  <span class='symbol val'>:pephits_precision</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='lt op'>&lt;</span><span class='array identifier id'>array</span> <span class='of identifier id'>of</span> <span class='precision identifier id'>precision</span><span class='gt op'>&gt;</span><span class='rbrack token'>]</span>
     <span class='comment val'># if :proteins =&gt; true</span>
  <span class='symbol val'>:prothits</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='Array constant id'>Array</span> <span class='of identifier id'>of</span> <span class='prothits identifier id'>prothits</span><span class='gt op'>&gt;</span><span class='comma token'>,</span>
  <span class='symbol val'>:prothits_precision</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='Array constant id'>Array</span> <span class='of identifier id'>of</span> <span class='hashes identifier id'>hashes</span> <span class='where identifier id'>where</span> <span class='each identifier id'>each</span> <span class='hash identifier id'>hash</span> <span class='assign token'>=</span>
                            <span class='lbrace token'>{</span> <span class='symbol val'>:worst</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Fl constant id'>Fl</span><span class='comma token'>,</span> <span class='symbol val'>:normal</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Fl constant id'>Fl</span><span class='comma token'>,</span>
                            <span class='symbol val'>:normal_stdev</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Fl constant id'>Fl</span> <span class='rbrace token'>}</span> <span class='rbrack token'>]</span>
</pre>
<p>
}
</p>
<p>
NOTE: Brackets [] indicate an Array! The Bar &#8217;|&#8217; indicates
another option. The asterik &#8217;*&#8217; is the default option.
</p>
<p>
:sequest =&gt; {
</p>
<pre class="code">
  <span class='symbol val'>:xcorr1</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='geq op'>&gt;=</span> <span class='lparen token'>(</span><span class='xcorr identifier id'>xcorr</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='integer val'>1</span> <span class='charge identifier id'>charge</span> <span class='state identifier id'>state</span><span class='rparen token'>)</span>
  <span class='symbol val'>:xcorr2</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='geq op'>&gt;=</span> <span class='lparen token'>(</span><span class='xcorr identifier id'>xcorr</span> <span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;2 charge state)
  :xcorr3 -&gt; &gt;= (xcorr +3 charge state)
  :deltacn -&gt; &gt;= (delta cn)
  :ppm -&gt; &lt;= parts per million (Float)
  :include_deltacnstar =&gt; *true | false  include deltacn (given at 1.1) of
                                         top hit with no 2nd hit
</span></pre>
<p>
} OUTPUT:
</p>
<pre class="code">
  <span class='symbol val'>:proteins</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='bitor op'>|</span> <span class='mult op'>*</span><span class='false false kw'>false</span>    <span class='gives identifier id'>gives</span> <span class='proteins identifier id'>proteins</span> <span class='lparen token'>(</span><span class='and and kw'>and</span> <span class='validation identifier id'>validation</span><span class='rparen token'>)</span>
  <span class='symbol val'>:output</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='format identifier id'>format</span><span class='comma token'>,</span> <span class='FILENAME constant id'>FILENAME</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='dot3 op'>...</span><span class='rbrack token'>]</span>  <span class='formats identifier id'>formats</span> <span class='to identifier id'>to</span> <span class='output identifier id'>output</span> <span class='filtering identifier id'>filtering</span> <span class='results identifier id'>results</span><span class='dot token'>.</span>
                                           <span class='can identifier id'>can</span> <span class='be identifier id'>be</span> <span class='used identifier id'>used</span> <span class='multiple identifier id'>multiple</span> <span class='times identifier id'>times</span>
                                           <span class='FILENAME constant id'>FILENAME</span> <span class='is identifier id'>is</span> <span class='the identifier id'>the</span> <span class='filename identifier id'>filename</span> <span class='to identifier id'>to</span> <span class='use identifier id'>use</span>
                                           <span class='if if kw'>if</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='then then kw'>then</span> <span class='outputs identifier id'>outputs</span> <span class='to identifier id'>to</span> <span class='$stdout gvar id'>$stdout</span>
                                           <span class='valid identifier id'>valid</span> <span class='formats identifier id'>formats</span> <span class='are identifier id'>are</span><span class='colon op'>:</span>
                                           <span class='symbol val'>:text_table</span>   <span class='lparen token'>(</span><span class='default identifier id'>default</span><span class='rparen token'>)</span>
                                           <span class='symbol val'>:yaml</span>         <span class='lparen token'>(</span><span class='need identifier id'>need</span> <span class='to identifier id'>to</span> <span class='implement identifier id'>implement</span><span class='rparen token'>)</span>
                                           <span class='symbol val'>:protein_summary</span> <span class='lparen token'>(</span><span class='need identifier id'>need</span> <span class='to identifier id'>to</span> <span class='implement identifier id'>implement</span><span class='rparen token'>)</span>
                                           <span class='symbol val'>:html_table</span>   <span class='lparen token'>(</span><span class='need identifier id'>need</span> <span class='to identifier id'>to</span> <span class='implement identifier id'>implement</span><span class='rparen token'>)</span>
                                           <span class='default identifier id'>default</span> <span class='value identifier id'>value</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>
                                           <span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='symbol val'>:text_table</span><span class='comma token'>,</span><span class='nil nil kw'>nil</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
</pre>
<p>
VALIDATION:
</p>
<pre class="code">
  <span class='symbol val'>:validators</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='Array constant id'>Array</span><span class='rbrack token'>]</span>  <span class='objects identifier id'>objects</span> <span class='that identifier id'>that</span> <span class='respond identifier id'>respond</span> <span class='to identifier id'>to</span> <span class='pephit_precision identifier id'>pephit_precision</span>
                          <span class='usually identifier id'>usually</span> <span class='of identifier id'>of</span> <span class='base identifier id'>base</span> <span class='class class kw'>class</span> <span class='Validator constant id'>Validator</span>
                          <span class='NOTE constant id'>NOTE</span><span class='colon op'>:</span> <span class='if if kw'>if</span> <span class='you identifier id'>you</span> <span class='have identifier id'>have</span> <span class='decoy identifier id'>decoy</span> <span class='peptides identifier id'>peptides</span><span class='comma token'>,</span> <span class='you identifier id'>you</span> <span class='MUST constant id'>MUST</span> <span class='have identifier id'>have</span>
                          <span class='a identifier id'>a</span> <span class='Validator constant id'>Validator</span><span class='colon2 op'>::</span><span class='Decoy constant id'>Decoy</span> <span class='object identifier id'>object</span> <span class='to identifier id'>to</span> <span class='separate identifier id'>separate</span> <span class='them identifier id'>them</span> <span class='out identifier id'>out</span><span class='dot token'>.</span>
                          <span class='NOTE constant id'>NOTE</span><span class='colon op'>:</span> <span class='if if kw'>if</span> <span class='transmem identifier id'>transmem</span> <span class='validator identifier id'>validator</span> <span class='passed identifier id'>passed</span> <span class='in in kw'>in</span><span class='comma token'>,</span> <span class='the identifier id'>the</span>
                          <span class='proteins identifier id'>proteins</span> <span class='in in kw'>in</span> <span class='spec_id identifier id'>spec_id</span> <span class='must identifier id'>must</span> <span class='already identifier id'>already</span> <span class='be identifier id'>be</span> <span class='granted identifier id'>granted</span>
                          <span class='transmem identifier id'>transmem</span> <span class='status! fid id'>status!</span>
</pre>
<p>
OTHER:
</p>
<pre class="code">
  <span class='symbol val'>:top_hit_by</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='mult op'>*</span><span class='symbol val'>:xcorr</span> <span class='bitor op'>|</span> <span class='symbol val'>:probability</span>
                  <span class='probabilities identifier id'>probabilities</span> <span class='only identifier id'>only</span> <span class='in in kw'>in</span> <span class='bioworks identifier id'>bioworks</span><span class='dot token'>.</span><span class='xml identifier id'>xml</span> <span class='files identifier id'>files</span> <span class='right identifier id'>right</span> <span class='now identifier id'>now</span> <span class='lparen token'>(</span><span class='if if kw'>if</span>
                  <span class='they identifier id'>they</span> <span class='were identifier id'>were</span> <span class='calculated identifier id'>calculated</span><span class='rparen token'>)</span><span class='dot token'>.</span>
  <span class='symbol val'>:postfilter</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='mult op'>*</span><span class='symbol val'>:top_per_scan</span> <span class='bitor op'>|</span> <span class='symbol val'>:top_per_aaseq</span> <span class='bitor op'>|</span> <span class='symbol val'>:top_per_aaseq_charge</span>
                  <span class='symbol val'>:top_per_scan</span> <span class='hashes identifier id'>hashes</span> <span class='by identifier id'>by</span> <span class='filename identifier id'>filename</span> <span class='plus op'>+</span> <span class='scan identifier id'>scan</span>
                  <span class='symbol val'>:top_per_aaseq</span> <span class='hashes identifier id'>hashes</span> <span class='by identifier id'>by</span> <span class='top_per_scan identifier id'>top_per_scan</span> <span class='plus op'>+</span> <span class='aaseq identifier id'>aaseq</span>
                  <span class='symbol val'>:top_per_aaseq_charge</span> <span class='hashes identifier id'>hashes</span> <span class='by identifier id'>by</span> <span class='top_per_aaseq identifier id'>top_per_aaseq</span> <span class='plus op'>+</span> <span class='charge identifier id'>charge</span>
  <span class='symbol val'>:prefilter</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='bitor op'>|</span> <span class='mult op'>*</span><span class='false false kw'>false</span>    <span class='Takes constant id'>Takes</span> <span class='top identifier id'>top</span> <span class='hit identifier id'>hit</span> <span class='per identifier id'>per</span> <span class='file identifier id'>file</span><span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='scan identifier id'>scan</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;charge
  :interactive =&gt; interactive_object
       # should behave like this:
       # interactive_object.filter_args(currentopts) -&gt; args_for_filtering | nil (done)

       # interactive_object.passing(final_answer)
</span></pre>
<p>
The defaults for filter_and_validate
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/spec_id/precision/filter.rb', line 152</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373/lib/spec_id/precision/filter.rb#L152">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='filter_and_validate identifier id'>filter_and_validate</span><span class='lparen token'>(</span><span class='spec_id_obj identifier id'>spec_id_obj</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='comment val'># NOTE:</span>
  <span class='comment val'># This is a fairly complicated method.  The complication comes in doing</span>
  <span class='comment val'># top hit filters on separate/cat searches wanted them to be either</span>
  <span class='comment val'># together or separate.  I opt for fewer conversions between the two, but</span>
  <span class='comment val'># that means keeping track of more things...</span>
  
  <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='FV_DEFAULTS constant id'>FV_DEFAULTS</span><span class='dot token'>.</span><span class='merge_deep identifier id'>merge_deep</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>

  <span class='spec_id identifier id'>spec_id</span> <span class='assign token'>=</span> <span class='spec_id_obj identifier id'>spec_id_obj</span>

  <span class='peps identifier id'>peps</span> <span class='assign token'>=</span> <span class='spec_id identifier id'>spec_id</span><span class='dot token'>.</span><span class='peps identifier id'>peps</span>
  <span class='filename identifier id'>filename</span> <span class='assign token'>=</span> <span class='spec_id identifier id'>spec_id</span><span class='dot token'>.</span><span class='filename identifier id'>filename</span>

  <span class='comment val'>#######################################</span>
  <span class='comment val'># DEFAULTS:</span>
  <span class='interactive_changing_keys identifier id'>interactive_changing_keys</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='symbol val'>:xcorr1</span><span class='comma token'>,</span> <span class='symbol val'>:xcorr2</span><span class='comma token'>,</span> <span class='symbol val'>:xcorr3</span><span class='comma token'>,</span> <span class='symbol val'>:deltacn</span><span class='comma token'>,</span> <span class='symbol val'>:ppm</span><span class='comma token'>,</span> <span class='symbol val'>:include_deltacnstar</span><span class='comma token'>,</span> <span class='symbol val'>:postfilter</span><span class='rbrack token'>]</span>
  <span class='interactive_shortcut_map identifier id'>interactive_shortcut_map</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:xcorr1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'x1'</span><span class='comma token'>,</span>
    <span class='symbol val'>:xcorr2</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'x2'</span><span class='comma token'>,</span>
    <span class='symbol val'>:xcorr3</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'x3'</span><span class='comma token'>,</span>
    <span class='symbol val'>:deltacn</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'dcn'</span><span class='comma token'>,</span>
    <span class='symbol val'>:ppm</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ppm'</span><span class='comma token'>,</span>
    <span class='symbol val'>:include_deltacnstar</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'dcns'</span><span class='comma token'>,</span>
    <span class='symbol val'>:postfilter</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'pf'</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span>
  <span class='to_float identifier id'>to_float</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rbrace token'>}</span>
  <span class='to_bool identifier id'>to_bool</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span>
    <span class='case case kw'>case</span> <span class='x identifier id'>x</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^t/i</span><span class='o identifier id'>o</span>
      <span class='true true kw'>true</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^f/i</span><span class='o identifier id'>o</span>
      <span class='false false kw'>false</span>
    <span class='when when kw'>when</span> <span class='true true kw'>true</span>
      <span class='true true kw'>true</span>
    <span class='when when kw'>when</span> <span class='false false kw'>false</span>
      <span class='false false kw'>false</span>
    <span class='else else kw'>else</span>
      <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='to_postfilter identifier id'>to_postfilter</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span>
    <span class='case case kw'>case</span> <span class='x identifier id'>x</span>
    <span class='when when kw'>when</span> <span class='string val'>'s'</span>
      <span class='symbol val'>:top_per_scan</span>
    <span class='when when kw'>when</span> <span class='string val'>'a'</span>
      <span class='symbol val'>:top_per_aaseq</span>
    <span class='when when kw'>when</span> <span class='string val'>'ac'</span>
      <span class='symbol val'>:top_per_aaseq_charge</span>
    <span class='when when kw'>when</span> <span class='Symbol constant id'>Symbol</span>
      <span class='x identifier id'>x</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='casting_map identifier id'>casting_map</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:xcorr1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_float identifier id'>to_float</span><span class='comma token'>,</span>
    <span class='symbol val'>:xcorr2</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_float identifier id'>to_float</span><span class='comma token'>,</span>
    <span class='symbol val'>:xcorr3</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_float identifier id'>to_float</span><span class='comma token'>,</span>
    <span class='symbol val'>:deltacn</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_float identifier id'>to_float</span><span class='comma token'>,</span>
    <span class='symbol val'>:ppm</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_float identifier id'>to_float</span><span class='comma token'>,</span>
    <span class='symbol val'>:include_deltacnstar</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_bool identifier id'>to_bool</span><span class='comma token'>,</span>
    <span class='symbol val'>:postfilter</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='to_postfilter identifier id'>to_postfilter</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span>
 
  <span class='comment val'># output:  </span>
  <span class='comment val'># NOTE: BOOLEANS that are by default false do not need a default!!</span>
  <span class='comment val'># They will yield false on key lookup if no key or false!</span>
  <span class='comment val'># BOOLEANS that by default are true should be queried like this</span>
  <span class='comment val'># !(opts[:&lt;option&gt;] == false)</span>

  <span class='comment val'># open up each of the files for writing</span>
  <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:output</span><span class='rbrack token'>]</span>
    <span class='outputs identifier id'>outputs</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:output</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='format identifier id'>format</span><span class='comma token'>,</span> <span class='where identifier id'>where</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='where identifier id'>where</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span>
        <span class='where identifier id'>where</span> <span class='assign token'>=</span> <span class='$stdout gvar id'>$stdout</span>
      <span class='end end kw'>end</span>
      <span class='SpecID constant id'>SpecID</span><span class='colon2 op'>::</span><span class='Precision constant id'>Precision</span><span class='colon2 op'>::</span><span class='Filter constant id'>Filter</span><span class='colon2 op'>::</span><span class='Output constant id'>Output</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='format identifier id'>format</span><span class='comma token'>,</span> <span class='where identifier id'>where</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='postfilters_per_hash identifier id'>postfilters_per_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:top_per_scan</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:base_name</span><span class='comma token'>,</span> <span class='symbol val'>:first_scan</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:top_per_aaseq</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:aaseq</span><span class='rbrack token'>]</span><span class='comma token'>,</span>  <span class='comment val'># first by top_per_scan, then this guy</span>
    <span class='symbol val'>:top_per_aaseq_charge</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:aaseq</span><span class='comma token'>,</span> <span class='symbol val'>:charge</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='comment val'># first by top_per_scan, then this one</span>
  <span class='rbrace token'>}</span>

  <span class='top_hit_by__to_sort_by identifier id'>top_hit_by__to_sort_by</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:xcorr</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:xcorr</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:down=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:xcorr</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:probability</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:probability</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='spec_id identifier id'>spec_id</span><span class='dot token'>.</span><span class='hi_prob_best identifier id'>hi_prob_best</span> <span class='integer val'>? </span><span class='lbrace token'>{</span><span class='symbol val'>:down=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:probability</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span>
  <span class='sort_by_att_opts identifier id'>sort_by_att_opts</span> <span class='assign token'>=</span> <span class='top_hit_by__to_sort_by identifier id'>top_hit_by__to_sort_by</span><span class='lbrack token'>[</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:top_hit_by</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
  <span class='opts_for_top_hit_prefilter identifier id'>opts_for_top_hit_prefilter</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:per</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:base_name</span><span class='comma token'>,</span> <span class='symbol val'>:first_scan</span><span class='comma token'>,</span> <span class='symbol val'>:charge</span><span class='rbrack token'>]</span><span class='comma token'>,</span> 
    <span class='symbol val'>:by</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='sort_by_att_opts identifier id'>sort_by_att_opts</span><span class='comma token'>,</span> 
    <span class='symbol val'>:include_ties</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:include_ties_in_top_hit_prefilter</span><span class='rbrack token'>]</span>
  <span class='rbrace token'>}</span>
  <span class='comment val'># PRIVATE DEFAULTS:</span>
  <span class='merge_prefix identifier id'>merge_prefix</span> <span class='assign token'>=</span> <span class='string val'>'DECOY_'</span>
  <span class='unmerge_regexp identifier id'>unmerge_regexp</span> <span class='assign token'>=</span> <span class='regexp val'>/^DECOY_/</span>

  <span class='comment val'>#######################################</span>


  <span class='comment val'># opts_decoy = opts[:decoy]</span>


  
  <span class='comment val'># if we have a Validator::Decoy object, we will use its defaults to split</span>
  <span class='comment val'># peptides.</span>
  <span class='decoy_validator identifier id'>decoy_validator</span> <span class='assign token'>=</span> 
    <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:validators</span><span class='rbrack token'>]</span>
      <span class='decoy_vals identifier id'>decoy_vals</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:validators</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='class identifier id'>class</span> <span class='eq op'>==</span> <span class='Validator constant id'>Validator</span><span class='colon2 op'>::</span><span class='Decoy constant id'>Decoy</span> <span class='rbrace token'>}</span>
      <span class='if if kw'>if</span> <span class='decoy_vals identifier id'>decoy_vals</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
        <span class='nil nil kw'>nil</span>
      <span class='elsif elsif kw'>elsif</span> <span class='decoy_vals identifier id'>decoy_vals</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
        <span class='decoy_vals identifier id'>decoy_vals</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='else else kw'>else</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;can only have one Validator::Decoy object&quot;</span>
      <span class='end end kw'>end</span>

      <span class='comment val'>### suck out the relevant parameters</span>
      <span class='comment val'>#sep_params = [:decoy_on_match, :correct_wins].inject({}) do |hash,k|</span>
      <span class='comment val'>#  hash[k] = decoy_validator.send(k)</span>
      <span class='comment val'>#  hash</span>
      <span class='comment val'>#end</span>
    <span class='else else kw'>else</span>
      <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>

  <span class='decoy_validator_to_split_with identifier id'>decoy_validator_to_split_with</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='pep_sets identifier id'>pep_sets</span> <span class='assign token'>=</span> 
    <span class='if if kw'>if</span> <span class='decoy_validator identifier id'>decoy_validator</span>
      <span class='if if kw'>if</span> <span class='decoy_validator identifier id'>decoy_validator</span><span class='dot token'>.</span><span class='constraint identifier id'>constraint</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Regexp constant id'>Regexp</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:hits_together</span><span class='rbrack token'>]</span>
          <span class='decoy_validator_to_split_with identifier id'>decoy_validator_to_split_with</span> <span class='assign token'>=</span> <span class='decoy_validator identifier id'>decoy_validator</span>
          <span class='lbrack token'>[</span><span class='peps identifier id'>peps</span><span class='rbrack token'>]</span>
        <span class='else else kw'>else</span>
          <span class='lparen token'>(</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='decoy identifier id'>decoy</span><span class='rparen token'>)</span> <span class='assign token'>=</span> <span class='decoy_validator identifier id'>decoy_validator</span><span class='dot token'>.</span><span class='partition identifier id'>partition</span><span class='lparen token'>(</span><span class='peps identifier id'>peps</span><span class='rparen token'>)</span>
          <span class='comment val'>#(target, decoy) = SpecID.classify_by_prot(peps, opts_decoy, sep_params[:decoy_on_match], sep_params[:correct_wins])</span>
          <span class='lbrack token'>[</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='decoy identifier id'>decoy</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
      <span class='elsif elsif kw'>elsif</span> <span class='decoy_validator identifier id'>decoy_validator</span><span class='dot token'>.</span><span class='constraint identifier id'>constraint</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>  <span class='comment val'>## a Filename </span>
        <span class='decoy_peps identifier id'>decoy_peps</span> <span class='assign token'>=</span> <span class='SpecID constant id'>SpecID</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='decoy_validator identifier id'>decoy_validator</span><span class='dot token'>.</span><span class='constraint identifier id'>constraint</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='peps identifier id'>peps</span>
        
        <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:hits_together</span><span class='rbrack token'>]</span>
          <span class='comment val'># we fake that the protein sets are together</span>
          <span class='decoy_validator_to_split_with identifier id'>decoy_validator_to_split_with</span> <span class='assign token'>=</span> <span class='Validator constant id'>Validator</span><span class='colon2 op'>::</span><span class='Decoy constant id'>Decoy</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:constraint</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='unmerge_regexp identifier id'>unmerge_regexp</span><span class='rparen token'>)</span>
          <span class='decoy_peps identifier id'>decoy_peps</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pep identifier id'>pep</span><span class='bitor op'>|</span>
            <span class='pep identifier id'>pep</span><span class='dot token'>.</span><span class='prots identifier id'>prots</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='prt identifier id'>prt</span><span class='bitor op'>|</span> <span class='prt identifier id'>prt</span><span class='dot token'>.</span><span class='reference identifier id'>reference</span> <span class='assign token'>=</span> <span class='merge_prefix identifier id'>merge_prefix</span> <span class='plus op'>+</span> <span class='prt identifier id'>prt</span><span class='dot token'>.</span><span class='reference identifier id'>reference</span> <span class='rbrace token'>}</span>
          <span class='end end kw'>end</span>
          <span class='lbrack token'>[</span><span class='peps identifier id'>peps</span> <span class='plus op'>+</span> <span class='decoy_peps identifier id'>decoy_peps</span><span class='rbrack token'>]</span> <span class='comment val'># wrap them so we get the target out</span>
        <span class='else else kw'>else</span>
          <span class='lbrack token'>[</span><span class='peps identifier id'>peps</span><span class='comma token'>,</span> <span class='decoy_peps identifier id'>decoy_peps</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span> 
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;Decoy::Validator#constraint must be a Regexp or valid SpecID file&quot;</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='lbrack token'>[</span><span class='peps identifier id'>peps</span><span class='rbrack token'>]</span>  <span class='comment val'># no decoy</span>
    <span class='end end kw'>end</span>

  <span class='comment val'># This method doesn't seem to do so well, but a person can use a different </span>
  <span class='comment val'># one and enter in their own custom pi_0 value!</span>
  <span class='comment val'>#if opts[:decoy_pi_zero]</span>
  <span class='comment val'>#  if pep_sets.size &lt; 2</span>
  <span class='comment val'>#    raise ArgumentError, &quot;must have a decoy validator for pi zero calculation!&quot;</span>
  <span class='comment val'>#  end</span>
  <span class='comment val'>#  require 'pi_zero'</span>
  <span class='comment val'>#  (_target, _decoy) = pep_sets</span>
  <span class='comment val'>#  pvals = PiZero.p_values_for_sequest(*pep_sets).sort</span>
  <span class='comment val'>#  pi_zero = PiZero.pi_zero(pvals)</span>
  <span class='comment val'>#  opts[:decoy_pi_zero] = PiZero.pi_zero(pvals)</span>
  <span class='comment val'>#end</span>

  <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:proteins</span><span class='rbrack token'>]</span>
    <span class='protein_validator identifier id'>protein_validator</span> <span class='assign token'>=</span> <span class='Validator constant id'>Validator</span><span class='colon2 op'>::</span><span class='ProtFromPep constant id'>ProtFromPep</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>### TOP HITS PREFILTER &lt; &lt; TOP_HITS_TOGETHER &gt; &gt;</span>
  <span class='comment val'>###########################</span>
  <span class='comment val'># TOP HITS FILTER:</span>
  <span class='comment val'>###########################</span>
  <span class='comment val'># REALLY, this guy only exists for speed and memory consumption</span>
  <span class='comment val'># If we prefilter, we don't have to filter as many hits in every</span>
  <span class='comment val'># interactive round.  I'd leave this guy out if I were doing only a</span>
  <span class='comment val'># sequest filter.  (I should compare results with this filter and w/o)</span>
  <span class='comment val'># This guy is very tricky since we need to consider whether they are to be</span>
  <span class='comment val'># run together or separately and not do more work than we need</span>
  <span class='comment val'># get passed_target for any case (and passed_decoy if opts[:decoy])</span>

  
  <span class='top_hit_prefilter identifier id'>top_hit_prefilter</span> <span class='assign token'>=</span> <span class='SpecID constant id'>SpecID</span><span class='colon2 op'>::</span><span class='Precision constant id'>Precision</span><span class='colon2 op'>::</span><span class='Filter constant id'>Filter</span><span class='colon2 op'>::</span><span class='Peps constant id'>Peps</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:top_hit</span><span class='comma token'>,</span> <span class='opts_for_top_hit_prefilter identifier id'>opts_for_top_hit_prefilter</span><span class='rparen token'>)</span>  <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:prefilter</span><span class='rbrack token'>]</span>

  <span class='if if kw'>if</span> <span class='top_hit_prefilter identifier id'>top_hit_prefilter</span>
    <span class='pep_sets identifier id'>pep_sets</span><span class='dot token'>.</span><span class='map! fid id'>map!</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pep_set identifier id'>pep_set</span><span class='bitor op'>|</span>
      <span class='top_hit_prefilter identifier id'>top_hit_prefilter</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span><span class='lparen token'>(</span><span class='pep_set identifier id'>pep_set</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># prepare our top hit filter:</span>
  <span class='comment val'># since we are now modulating this guy, we need to create it fresh every</span>
  <span class='comment val'># time</span>
  <span class='top_per_scan_postfilter identifier id'>top_per_scan_postfilter</span> <span class='assign token'>=</span> <span class='SpecID constant id'>SpecID</span><span class='colon2 op'>::</span><span class='Precision constant id'>Precision</span><span class='colon2 op'>::</span><span class='Filter constant id'>Filter</span><span class='colon2 op'>::</span><span class='Peps constant id'>Peps</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:top_hit</span><span class='comma token'>,</span> 
                                                <span class='symbol val'>:per</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='postfilters_per_hash identifier id'>postfilters_per_hash</span><span class='lbrack token'>[</span><span class='symbol val'>:top_per_scan</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
                                                <span class='symbol val'>:by</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='sort_by_att_opts identifier id'>sort_by_att_opts</span><span class='comma token'>,</span> 
                                                <span class='symbol val'>:include_ties</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:include_ties_in_top_hit_postfilter</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>



  <span class='comment val'># Prepare to loop</span>
  <span class='comment val'># Give interactive help once here if necessary</span>
  <span class='interactive identifier id'>interactive</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:interactive</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='interactive identifier id'>interactive</span>
    <span class='ARGV constant id'>ARGV</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
    <span class='interactive identifier id'>interactive</span><span class='dot token'>.</span><span class='out identifier id'>out</span><span class='lparen token'>(</span><span class='interactive identifier id'>interactive</span><span class='dot token'>.</span><span class='interactive_help identifier id'>interactive_help</span><span class='lparen token'>(</span><span class='interactive_changing_keys identifier id'>interactive_changing_keys</span><span class='comma token'>,</span> <span class='interactive_shortcut_map identifier id'>interactive_shortcut_map</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='interactive identifier id'>interactive</span><span class='dot token'>.</span><span class='verbose identifier id'>verbose</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># the loop is for if we are interactive</span>
  <span class='final_answer identifier id'>final_answer</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='loop identifier id'>loop</span> <span class='do do kw'>do</span>  

    <span class='if if kw'>if</span> <span class='interactive identifier id'>interactive</span> <span class='comment val'>#interactive</span>
      <span class='comment val'># a bit of a hack, but we shove on the postfilter param to modulate</span>
      <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:sequest</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:postfilter</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:postfilter</span><span class='rbrack token'>]</span>
      <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='interactive identifier id'>interactive</span><span class='dot token'>.</span><span class='filter_args identifier id'>filter_args</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:sequest</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='interactive_changing_keys identifier id'>interactive_changing_keys</span><span class='comma token'>,</span> <span class='interactive_shortcut_map identifier id'>interactive_shortcut_map</span><span class='comma token'>,</span> <span class='casting_map identifier id'>casting_map</span><span class='rparen token'>)</span>
      <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:postfilter</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:sequest</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:postfilter</span><span class='rparen token'>)</span>
      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='response identifier id'>response</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># prepare our top hit filter:</span>
    <span class='comment val'># since we are now modulating this guy, we need to create it fresh every</span>
    <span class='comment val'># time</span>
    
    <span class='sub_postfilter identifier id'>sub_postfilter</span> <span class='assign token'>=</span> 
      <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:postfilter</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='symbol val'>:top_per_scan</span>
        <span class='nil nil kw'>nil</span>
      <span class='else else kw'>else</span>
        <span class='postfilter_per_args identifier id'>postfilter_per_args</span> <span class='assign token'>=</span> <span class='postfilters_per_hash identifier id'>postfilters_per_hash</span><span class='lbrack token'>[</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:postfilter</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
        <span class='SpecID constant id'>SpecID</span><span class='colon2 op'>::</span><span class='Precision constant id'>Precision</span><span class='colon2 op'>::</span><span class='Filter constant id'>Filter</span><span class='colon2 op'>::</span><span class='Peps constant id'>Peps</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:top_hit</span><span class='comma token'>,</span> 
                                 <span class='symbol val'>:per</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='postfilter_per_args identifier id'>postfilter_per_args</span><span class='comma token'>,</span>
                                 <span class='symbol val'>:by</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='sort_by_att_opts identifier id'>sort_by_att_opts</span><span class='comma token'>,</span> 
                                 <span class='symbol val'>:include_ties</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:include_ties_in_top_hit_postfilter</span><span class='rbrack token'>]</span>
                                <span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

    <span class='pep_sets_to_be_filtered identifier id'>pep_sets_to_be_filtered</span> <span class='assign token'>=</span> <span class='pep_sets identifier id'>pep_sets</span><span class='dot token'>.</span><span class='map identifier id'>map</span> 

    <span class='comment val'>### SEQUEST &lt; EITHER &gt;</span>
    <span class='comment val'>###########################</span>
    <span class='comment val'># SEQUEST FILTER:</span>
    <span class='comment val'>###########################</span>
    <span class='comment val'># This guy is immune to the trickiness of top hits, so we just filter</span>
    <span class='comment val'># separately since validation is best done without decoys (except decoy)</span>
    <span class='sequest_args identifier id'>sequest_args</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:sequest</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='values_at identifier id'>values_at</span><span class='lparen token'>(</span> <span class='symbol val'>:xcorr1</span><span class='comma token'>,</span> <span class='symbol val'>:xcorr2</span><span class='comma token'>,</span> <span class='symbol val'>:xcorr3</span><span class='comma token'>,</span> <span class='symbol val'>:deltacn</span><span class='comma token'>,</span> <span class='symbol val'>:ppm</span><span class='comma token'>,</span> <span class='symbol val'>:include_deltacnstar</span> <span class='rparen token'>)</span>
    <span class='sequest_filter identifier id'>sequest_filter</span> <span class='assign token'>=</span> <span class='SpecID constant id'>SpecID</span><span class='colon2 op'>::</span><span class='Precision constant id'>Precision</span><span class='colon2 op'>::</span><span class='Filter constant id'>Filter</span><span class='colon2 op'>::</span><span class='Peps constant id'>Peps</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:standard_sequest_filter</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='sequest_args identifier id'>sequest_args</span><span class='rparen token'>)</span>

    <span class='pep_sets_filtered identifier id'>pep_sets_filtered</span> <span class='assign token'>=</span> <span class='pep_sets_to_be_filtered identifier id'>pep_sets_to_be_filtered</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pep_set identifier id'>pep_set</span><span class='bitor op'>|</span>
      <span class='sequest_filter identifier id'>sequest_filter</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span><span class='lparen token'>(</span><span class='pep_set identifier id'>pep_set</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>### FINAL HIT PER SCAN &lt; &lt; TOP_HITS_TOGETHER &gt; &gt;</span>
    <span class='comment val'>##########################</span>
    <span class='comment val'># FINAL HIT PER SCAN</span>
    <span class='comment val'>##########################</span>
    <span class='comment val'># Why not just do the top hit filter in the top hits pre filter before?</span>
    <span class='comment val'># Good question.  Answer: We may have instances when the top hit (by</span>
    <span class='comment val'># xcorr) has some other poorer attribute than the hit at the other charge.</span>
    <span class='comment val'># In this case, we'd end up with no passing peptide. </span>
    <span class='comment val'># Also, the xcorr filter is per charge, so we may filter out the higher</span>
    <span class='comment val'># scoring peptide hit even though the other would pass based on its charge</span>
    <span class='comment val'># state, etc., etc....</span>
    <span class='comment val'># ###################################################</span>
    <span class='comment val'># NOTE THIS WELL:</span>
    <span class='comment val'># IF IT IS SUPPOSE TO be separate it's *ALREADY* separate, if together its</span>
    <span class='comment val'># *ALREADY* together!!!!</span>
    <span class='comment val'># the implication is that we don't need to do any merging or</span>
    <span class='comment val'># separating before we do this last filter!!!!</span>
    <span class='comment val'># ###################################################</span>

    <span class='comment val'># TODO: We need to add this guy in!</span>
    <span class='comment val'>#if opts[:uniq_aa]</span>
    <span class='comment val'>#  pep_sets_filtered.map do |pep_set|</span>
    <span class='comment val'>#  end</span>
    <span class='comment val'>#end</span>

    <span class='pep_sets_filtered identifier id'>pep_sets_filtered</span><span class='dot token'>.</span><span class='map! fid id'>map!</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pep_set identifier id'>pep_set</span><span class='bitor op'>|</span>
      <span class='top_per_scan_postfilter identifier id'>top_per_scan_postfilter</span><span class='dot token'>.</span><span class='filter! fid id'>filter!</span><span class='lparen token'>(</span><span class='pep_set identifier id'>pep_set</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='sub_postfilter identifier id'>sub_postfilter</span>
        <span class='sub_postfilter identifier id'>sub_postfilter</span><span class='dot token'>.</span><span class='filter! fid id'>filter!</span><span class='lparen token'>(</span><span class='pep_set identifier id'>pep_set</span><span class='rparen token'>)</span> 
      <span class='else else kw'>else</span>
        <span class='pep_set identifier id'>pep_set</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='normal_post_filtered_peps identifier id'>normal_post_filtered_peps</span> <span class='assign token'>=</span> <span class='pep_sets_filtered identifier id'>pep_sets_filtered</span><span class='dot token'>.</span><span class='first identifier id'>first</span>

    <span class='comment val'># separate the decoy's out if they are together</span>
    <span class='if if kw'>if</span> <span class='decoy_validator_to_split_with identifier id'>decoy_validator_to_split_with</span>  <span class='comment val'># only set if opts[:hits_together]!!</span>
      <span class='lparen token'>(</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='decoy identifier id'>decoy</span><span class='rparen token'>)</span> <span class='assign token'>=</span> <span class='decoy_validator_to_split_with identifier id'>decoy_validator_to_split_with</span><span class='dot token'>.</span><span class='partition identifier id'>partition</span><span class='lparen token'>(</span><span class='normal_post_filtered_peps identifier id'>normal_post_filtered_peps</span><span class='rparen token'>)</span>
      <span class='pep_sets_filtered identifier id'>pep_sets_filtered</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='target identifier id'>target</span><span class='comma token'>,</span> <span class='decoy identifier id'>decoy</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>### VALIDATION &lt; SEPARATE &gt;</span>
    <span class='pephit_precision_array identifier id'>pephit_precision_array</span> <span class='assign token'>=</span> <span class='get_pephit_precision identifier id'>get_pephit_precision</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:validators</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='pep_sets_filtered identifier id'>pep_sets_filtered</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:validators</span><span class='rbrack token'>]</span>

    <span class='final_answer identifier id'>final_answer</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
      <span class='symbol val'>:params</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='opts identifier id'>opts</span><span class='comma token'>,</span>
      <span class='symbol val'>:pephits</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='pep_sets_filtered identifier id'>pep_sets_filtered</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='comma token'>,</span> 
    <span class='rbrace token'>}</span>
    <span class='if if kw'>if</span> <span class='pephit_precision_array identifier id'>pephit_precision_array</span>
      <span class='final_answer identifier id'>final_answer</span><span class='lbrack token'>[</span><span class='symbol val'>:pephits_precision</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='pephit_precision_array identifier id'>pephit_precision_array</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:proteins</span><span class='rbrack token'>]</span>       
      <span class='protein_precision_array identifier id'>protein_precision_array</span> <span class='assign token'>=</span> <span class='peptide_precision_to_protein_precision identifier id'>peptide_precision_to_protein_precision</span><span class='lparen token'>(</span><span class='protein_validator identifier id'>protein_validator</span><span class='comma token'>,</span> <span class='normal_post_filtered_peps identifier id'>normal_post_filtered_peps</span><span class='comma token'>,</span> <span class='pephit_precision_array identifier id'>pephit_precision_array</span><span class='rparen token'>)</span>
      <span class='comment val'># this could be factored out (since we do it in protein_precision)</span>

      <span class='comment val'># merge the final prots into a unique set:</span>
      <span class='final_answer identifier id'>final_answer</span><span class='lbrack token'>[</span><span class='symbol val'>:prothits</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='normal_post_filtered_peps identifier id'>normal_post_filtered_peps</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='Set constant id'>Set</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='protset identifier id'>protset</span><span class='comma token'>,</span> <span class='pep identifier id'>pep</span><span class='bitor op'>|</span>
        <span class='protset identifier id'>protset</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='pep identifier id'>pep</span><span class='dot token'>.</span><span class='prots identifier id'>prots</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='final_answer identifier id'>final_answer</span><span class='lbrack token'>[</span><span class='symbol val'>:prothits_precision</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='protein_precision_array identifier id'>protein_precision_array</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>## output the output</span>
    <span class='outputs identifier id'>outputs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='output identifier id'>output</span><span class='bitor op'>|</span> <span class='output identifier id'>output</span><span class='dot token'>.</span><span class='print identifier id'>print</span><span class='lparen token'>(</span><span class='final_answer identifier id'>final_answer</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>

    <span class='if if kw'>if</span> <span class='interactive identifier id'>interactive</span>
      <span class='interactive identifier id'>interactive</span><span class='dot token'>.</span><span class='passing identifier id'>passing</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='comma token'>,</span> <span class='final_answer identifier id'>final_answer</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='interactive identifier id'>interactive</span>
      <span class='break break kw'>break</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='comment val'># Close the filehandles</span>
  <span class='outputs identifier id'>outputs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='output identifier id'>output</span><span class='bitor op'>|</span> <span class='output identifier id'>output</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:output</span><span class='rbrack token'>]</span>
  <span class='final_answer identifier id'>final_answer</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>filter_and_validate_cmdline</h3>
</div><div id="filter_and_validate_cmdline-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>filter_and_validate_cmdline</span><span class='args'>(args)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/spec_id/precision/filter.rb', line 66</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373/lib/spec_id/precision/filter.rb#L66">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">66
67
68
69
70
71
72
73</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='filter_and_validate_cmdline identifier id'>filter_and_validate_cmdline</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='spec_id_obj identifier id'>spec_id_obj</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='option_parser identifier id'>option_parser</span><span class='rparen token'>)</span> <span class='assign token'>=</span> <span class='CmdlineParser constant id'>CmdlineParser</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='spec_id_obj identifier id'>spec_id_obj</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span>
    <span class='puts identifier id'>puts</span> <span class='option_parser identifier id'>option_parser</span>
    <span class='return return kw'>return</span>
  <span class='end end kw'>end</span>
  <span class='final_answer identifier id'>final_answer</span> <span class='assign token'>=</span> <span class='SpecID constant id'>SpecID</span><span class='colon2 op'>::</span><span class='Precision constant id'>Precision</span><span class='colon2 op'>::</span><span class='Filter constant id'>Filter</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='filter_and_validate identifier id'>filter_and_validate</span><span class='lparen token'>(</span><span class='spec_id_obj identifier id'>spec_id_obj</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_pephit_precision</h3>
</div><div id="get_pephit_precision-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_pephit_precision</span><span class='args'>(validators, peps, decoy_peps = nil, grant_transmem_status = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
takes an array of validator objects and peps (already separated out from
decoys; the decoy&#8217;s can be passed in returns an array of results
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/spec_id/precision/filter.rb', line 512</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373/lib/spec_id/precision/filter.rb#L512">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">512
513
514
515
516
517
518
519
520</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_pephit_precision identifier id'>get_pephit_precision</span><span class='lparen token'>(</span><span class='validators identifier id'>validators</span><span class='comma token'>,</span> <span class='peps identifier id'>peps</span><span class='comma token'>,</span> <span class='decoy_peps identifier id'>decoy_peps</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='grant_transmem_status identifier id'>grant_transmem_status</span><span class='assign token'>=</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='validators identifier id'>validators</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='validator identifier id'>validator</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='validator identifier id'>validator</span><span class='dot token'>.</span><span class='class identifier id'>class</span> <span class='eq op'>==</span> <span class='Validator constant id'>Validator</span><span class='colon2 op'>::</span><span class='Decoy constant id'>Decoy</span>
      <span class='validator identifier id'>validator</span><span class='dot token'>.</span><span class='pephit_precision identifier id'>pephit_precision</span><span class='lparen token'>(</span><span class='peps identifier id'>peps</span><span class='comma token'>,</span> <span class='decoy_peps identifier id'>decoy_peps</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='validator identifier id'>validator</span><span class='dot token'>.</span><span class='pephit_precision identifier id'>pephit_precision</span><span class='lparen token'>(</span><span class='peps identifier id'>peps</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>peptide_precision_to_protein_precision</h3>
</div><div id="peptide_precision_to_protein_precision-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>peptide_precision_to_protein_precision</span><span class='args'>(protein_validator, peps, peptide_precision_array, round_num_false = :ceil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
takes peps and a peptide_precision_hash. Returns a hash with the same keys
of peptide_precision_hash where the value is a hash with these keys:
</p>
<pre class="code">
  <span class='symbol val'>:worst</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='worstcase identifier id'>worstcase</span> <span class='protein identifier id'>protein</span> <span class='precision identifier id'>precision</span>
  <span class='symbol val'>:normal</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='estimaton identifier id'>estimaton</span> <span class='by identifier id'>by</span> <span class='binomial identifier id'>binomial</span><span class='div op'>/</span><span class='gaussian identifier id'>gaussian</span> <span class='method identifier id'>method</span> <span class='lparen token'>(</span><span class='optimistic identifier id'>optimistic</span><span class='rparen token'>)</span>
  <span class='symbol val'>:normal_stdev</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='the identifier id'>the</span> <span class='stdev identifier id'>stdev</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='normal identifier id'>normal</span> <span class='method identifier id'>method</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/spec_id/precision/filter.rb', line 497</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/mspire/blob/12c04cb5d772ed265127dd94446ed8162423b373/lib/spec_id/precision/filter.rb#L497">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">497
498
499
500
501
502
503
504
505
506
507</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='peptide_precision_to_protein_precision identifier id'>peptide_precision_to_protein_precision</span><span class='lparen token'>(</span><span class='protein_validator identifier id'>protein_validator</span><span class='comma token'>,</span> <span class='peps identifier id'>peps</span><span class='comma token'>,</span> <span class='peptide_precision_array identifier id'>peptide_precision_array</span><span class='comma token'>,</span> <span class='round_num_false identifier id'>round_num_false</span><span class='assign token'>=</span><span class='symbol val'>:ceil</span><span class='rparen token'>)</span>
  <span class='peptide_precision_array identifier id'>peptide_precision_array</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='precision identifier id'>precision</span><span class='bitor op'>|</span>
    <span class='num_false identifier id'>num_false</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='float val'>1.0</span> <span class='minus op'>-</span> <span class='precision identifier id'>precision</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='peps identifier id'>peps</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ceil identifier id'>ceil</span>
    <span class='reply identifier id'>reply</span> <span class='assign token'>=</span> <span class='protein_validator identifier id'>protein_validator</span><span class='dot token'>.</span><span class='prothit_precision identifier id'>prothit_precision</span><span class='lparen token'>(</span><span class='peps identifier id'>peps</span><span class='comma token'>,</span> <span class='num_false identifier id'>num_false</span><span class='rparen token'>)</span>
    <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='dstring node'>%w(worst normal normal_stdev)</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='reply identifier id'>reply</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='label identifier id'>label</span><span class='comma token'>,</span> <span class='answer identifier id'>answer</span><span class='bitor op'>|</span>
      <span class='hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='label identifier id'>label</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='answer identifier id'>answer</span>
    <span class='end end kw'>end</span>
    <span class='hash identifier id'>hash</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>