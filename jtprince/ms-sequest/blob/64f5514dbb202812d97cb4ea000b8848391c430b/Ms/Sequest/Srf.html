<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jtprince's ms-sequest - Class: Ms::Sequest::Srf - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jtprince/commits/ms-sequest/master" rel="alternate" title="Recent Commits to ms-sequest:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jtprince", "ms-sequest", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jtprince", "ms-sequest", "64f5514dbb202812d97cb4ea000b8848391c430b", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jtprince/ms-sequest/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jtprince/ms-sequest/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jtprince/ms-sequest/network">Network</a></li>            
            <li class=""><a href="http://github.com/jtprince/ms-sequest/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jtprince/ms-sequest">Wiki</a></li>
            <li class=""><a href="http://github.com/jtprince/ms-sequest/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jtprince/ms-sequest">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jtprince">jtprince</a> / <b><a href="http://github.com/jtprince/ms-sequest/tree">ms-sequest</a></b>        
                <a id="namespaces_button" rel="jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Ms_Sequest_Srf">
  <h1>Class: Ms::Sequest::Srf</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p>Ms::Id::Search</p>
</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">base_name</td>
          <td class="readwrite">
            [<span id='base_name-instance_method'>R</span><span id='base_name=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>base_name</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">dta_files</td>
          <td class="readwrite">
            [<span id='dta_files-instance_method'>R</span><span id='dta_files=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>dta_files</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">filtered_by_precursor_mass_tolerance</td>
          <td class="readwrite">
            [<span id='filtered_by_precursor_mass_tolerance-instance_method'>R</span><span id='filtered_by_precursor_mass_tolerance=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
a boolean to indicate if the results have been filtered by the sequest.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">header</td>
          <td class="readwrite">
            [<span id='header-instance_method'>R</span><span id='header=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>header</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">index</td>
          <td class="readwrite">
            [<span id='index-instance_method'>R</span><span id='index=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
a parallel array to dta_files and out_files where each entry is:
[first_scan, last_scan, charge].
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">out_files</td>
          <td class="readwrite">
            [<span id='out_files-instance_method'>R</span><span id='out_files=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>out_files</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">params</td>
          <td class="readwrite">
            [<span id='params-instance_method'>R</span><span id='params=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>params</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">version</td>
          <td class="readwrite">
            [<span id='version-instance_method'>R</span><span id='version=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
inherits peps and prots from Search a String: 3.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(filename = nil, opts = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
opts:
</p>
<pre class="code">
    <span class='symbol val'>:filter_by_precursor_mass_tolerance</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='bitor op'>|</span> <span class='false false kw'>false</span> <span class='lparen token'>(</span><span class='default identifier id'>default</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
    <span class='comment val'># this will filter by the sequest params prec tolerance as is</span>
    <span class='comment val'># typically done by Bioworks.</span>

    <span class='symbol val'>:link_protein_hits</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='bitor op'>|</span> <span class='false false kw'>false</span> <span class='lparen token'>(</span><span class='default identifier id'>default</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
    <span class='comment val'># if true, generates the @prot attribute for the :prot method</span>
    <span class='comment val'>#   and creates one protein per reference that is linked to each</span>
    <span class='comment val'>#   relevant peptide hit.</span>
    <span class='comment val'># if false, each protein for each peptide hit is a unique object</span>
    <span class='comment val'># and the :prots method returns nil.  If you are merging multiple</span>
    <span class='comment val'># searches then you probably want to set this to false to avoid</span>
    <span class='comment val'># recalculation.</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 88</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L88">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">88
89
90
91
92
93
94
95
96</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='@peps ivar id'>@peps</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='@dta_files ivar id'>@dta_files</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@out_files ivar id'>@out_files</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='filename identifier id'>filename</span>
    <span class='from_file identifier id'>from_file</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_sequest_params-class_method">get_sequest_params</span><span class='args'>(filename)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns a Sequest::Params object or nil if none.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#dta_start_byte-instance_method">#dta_start_byte</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#filter_by_precursor_mass_tolerance-21-instance_method">#filter_by_precursor_mass_tolerance!</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
1.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#from_file-instance_method">#from_file</span><span class='args'>(filename, opts)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns self opts are the same as for &#8216;new&#8217;.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#protein_class-instance_method">#protein_class</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#read_dta_files-instance_method">#read_dta_files</span><span class='args'>(fh, num_files, unpack_35)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns an array of dta_files.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#read_out_files-instance_method">#read_out_files</span><span class='args'>(fh, number_files, measured_mhs, unpack_35, dup_refs_gt_0)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
filehandle (fh) must be at the start of the outfiles.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#read_scan_index-instance_method">#read_scan_index</span><span class='args'>(fh, num)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns an index where each entry is [first_scan, last_scan, charge].
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#to_dta_files-instance_method">#to_dta_files</span><span class='args'>(out_folder = nil, compress = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
not given an out_folder, will make one with the basename compress may be:
:zip, :tgz, or nil (no compression) :zip requires gem rubyzip to be
installed and is <b>very</b> bloated as it writes out all the files first!
:tgz requires gem archive-tar-minitar to be installed.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#to_mgf-instance_method">#to_mgf</span><span class='args'>(filename = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Writes an MGF file to given filename or base_name + &#8217;.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#to_sqt-instance_method">#to_sqt</span><span class='args'>(out_filename = nil, opts = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
the out_filename will be the base_name + .
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>get_sequest_params</h3>
</div><div id="get_sequest_params-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_sequest_params</span><span class='args'>(filename)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns a Sequest::Params object or nil if none
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 48</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L48">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='get_sequest_params identifier id'>get_sequest_params</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='comment val'># split the file in half and only read the second half (since we can be</span>
  <span class='comment val'># confident that the params file will be there!)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='string val'>'rb'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='handle identifier id'>handle</span><span class='bitor op'>|</span>
    <span class='halfway identifier id'>halfway</span> <span class='assign token'>=</span> <span class='handle identifier id'>handle</span><span class='dot token'>.</span><span class='stat identifier id'>stat</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='div op'>/</span> <span class='integer val'>2</span>
    <span class='handle identifier id'>handle</span><span class='dot token'>.</span><span class='seek identifier id'>seek</span> <span class='halfway identifier id'>halfway</span>
    <span class='last_half identifier id'>last_half</span> <span class='assign token'>=</span> <span class='handle identifier id'>handle</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
    <span class='if if kw'>if</span> <span class='sequest_start_index identifier id'>sequest_start_index</span> <span class='assign token'>=</span> <span class='last_half identifier id'>last_half</span><span class='dot token'>.</span><span class='rindex identifier id'>rindex</span><span class='lparen token'>(</span><span class='string val'>'[SEQUEST]'</span><span class='rparen token'>)</span>
      <span class='params_start_index identifier id'>params_start_index</span> <span class='assign token'>=</span>  <span class='sequest_start_index identifier id'>sequest_start_index</span> <span class='plus op'>+</span> <span class='halfway identifier id'>halfway</span>
      <span class='handle identifier id'>handle</span><span class='dot token'>.</span><span class='seek identifier id'>seek</span><span class='lparen token'>(</span><span class='params_start_index identifier id'>params_start_index</span><span class='rparen token'>)</span>
      <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Params constant id'>Params</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='parse_io identifier id'>parse_io</span><span class='lparen token'>(</span><span class='handle identifier id'>handle</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;#{filename} has no SEQUEST information, may be a truncated/corrupt file!&quot;</span>
      <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>dta_start_byte</h3>
</div><div id="dta_start_byte-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>dta_start_byte</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 66</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L66">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">66
67
68
69
70
71
72</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='dta_start_byte identifier id'>dta_start_byte</span>
  <span class='case case kw'>case</span> <span class='@version ivar id'>@version</span>
  <span class='when when kw'>when</span> <span class='string val'>'3.2'</span> <span class='semicolon token'>;</span> <span class='integer val'>3260</span>
  <span class='when when kw'>when</span> <span class='string val'>'3.3'</span> <span class='semicolon token'>;</span> <span class='integer val'>3644</span>
  <span class='when when kw'>when</span> <span class='string val'>'3.5'</span> <span class='semicolon token'>;</span> <span class='integer val'>3644</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>filter_by_precursor_mass_tolerance!</h3>
</div><div id="filter_by_precursor_mass_tolerance-21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>filter_by_precursor_mass_tolerance!</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <ol>
<li>updates the out_file&#8217;s list of hits based on passing peptides (but
not

</li>
</ol>
<p>
the original hit id; rank is implicit in array ordering)
</p>
<ol>
<li>recalculates deltacn values completely if number of hits changed (does

</li>
</ol>
<p>
not touch deltacn orig)
</p>
<p>
This can spoil proper protein -&gt; peptide linkages. Ms::Id::Search.merge!
should be run after this method to ensure correct protein -&gt; peptide
linkages.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 107</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L107">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='filter_by_precursor_mass_tolerance! fid id'>filter_by_precursor_mass_tolerance!</span>
  <span class='pmt identifier id'>pmt</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='peptide_mass_tolerance identifier id'>peptide_mass_tolerance</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
  <span class='methd identifier id'>methd</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>  <span class='comment val'># the method to </span>

  <span class='case case kw'>case</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='peptide_mass_units identifier id'>peptide_mass_units</span>
  <span class='when when kw'>when</span> <span class='string val'>'0'</span>
    <span class='amu_based identifier id'>amu_based</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='milli_amu identifier id'>milli_amu</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='when when kw'>when</span> <span class='string val'>'1'</span>
    <span class='amu_based identifier id'>amu_based</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='milli_amu identifier id'>milli_amu</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='when when kw'>when</span> <span class='string val'>'2'</span>
    <span class='amu_based identifier id'>amu_based</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='filtered_by_precursor_mass_tolerance identifier id'>filtered_by_precursor_mass_tolerance</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='out_files identifier id'>out_files</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='out_file identifier id'>out_file</span><span class='bitor op'>|</span>
    <span class='hits identifier id'>hits</span> <span class='assign token'>=</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='hits identifier id'>hits</span>
    <span class='before identifier id'>before</span> <span class='assign token'>=</span> <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
    <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='reject! fid id'>reject!</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pep identifier id'>pep</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='amu_based identifier id'>amu_based</span>
        <span class='if if kw'>if</span> <span class='milli_amu identifier id'>milli_amu</span>
          <span class='lparen token'>(</span><span class='pep identifier id'>pep</span><span class='dot token'>.</span><span class='deltamass identifier id'>deltamass</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span> <span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='pmt identifier id'>pmt</span><span class='div op'>/</span><span class='integer val'>1000</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='else else kw'>else</span>
          <span class='lparen token'>(</span><span class='pep identifier id'>pep</span><span class='dot token'>.</span><span class='deltamass identifier id'>deltamass</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span> <span class='gt op'>&gt;</span> <span class='pmt identifier id'>pmt</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='lparen token'>(</span><span class='pep identifier id'>pep</span><span class='dot token'>.</span><span class='ppm identifier id'>ppm</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span> <span class='gt op'>&gt;</span> <span class='pmt identifier id'>pmt</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='before identifier id'>before</span>
      <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='hits identifier id'>hits</span> <span class='assign token'>=</span> <span class='hits identifier id'>hits</span> <span class='comment val'># &lt;- is this necessary </span>
      <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Srf constant id'>Srf</span><span class='colon2 op'>::</span><span class='Out constant id'>Out</span><span class='colon2 op'>::</span><span class='Pep constant id'>Pep</span><span class='dot token'>.</span><span class='update_deltacns_from_xcorr identifier id'>update_deltacns_from_xcorr</span><span class='lparen token'>(</span><span class='hits identifier id'>hits</span><span class='rparen token'>)</span>
      <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='num_hits identifier id'>num_hits</span> <span class='assign token'>=</span> <span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>from_file</h3>
</div><div id="from_file-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>from_file</span><span class='args'>(filename, opts)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns self opts are the same as for &#8216;new&#8217;
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 148</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L148">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='from_file identifier id'>from_file</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='rparen token'>)</span>
  <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:filter_by_precursor_mass_tolerance</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:link_protein_hits</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Srf constant id'>Srf</span><span class='dot token'>.</span><span class='get_sequest_params identifier id'>get_sequest_params</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='rparen token'>)</span>
  <span class='dup_references identifier id'>dup_references</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='dup_refs_gt_0 identifier id'>dup_refs_gt_0</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='if if kw'>if</span> <span class='params identifier id'>params</span>
    <span class='dup_references identifier id'>dup_references</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='print_duplicate_references identifier id'>print_duplicate_references</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='if if kw'>if</span> <span class='dup_references identifier id'>dup_references</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
      <span class='warn identifier id'>warn</span> <span class='string val'>&quot;*****************************************************************************\nWARNING: This srf file lists only 1 protein per peptide! (based on the\nprint_duplicate_references parameter in the sequest.params file used in its\ncreation)  So, downstream output will likewise only contain a single protein\nfor each peptide hit.  In many instances this is OK since downstream programs\nwill recalculate protein-to-peptide linkages from the database file anyway.\nFor complete protein lists per peptide hit, .srf files must be created with\nprint_duplicate_references &gt; 0. HINT: to capture all duplicate references, \nset the sequest parameter 'print_duplicate_references' to 100 or greater.\n*****************************************************************************\n&quot;</span>
    <span class='else else kw'>else</span>
      <span class='dup_refs_gt_0 identifier id'>dup_refs_gt_0</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='warn identifier id'>warn</span> <span class='string val'>&quot;no params file found in srf, could be truncated file!&quot;</span>
  <span class='end end kw'>end</span>

  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='string val'>'rb'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fh identifier id'>fh</span><span class='bitor op'>|</span>
    <span class='@header ivar id'>@header</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Srf constant id'>Srf</span><span class='colon2 op'>::</span><span class='Header constant id'>Header</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='from_io identifier id'>from_io</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='rparen token'>)</span>      
    <span class='@version ivar id'>@version</span> <span class='assign token'>=</span> <span class='@header ivar id'>@header</span><span class='dot token'>.</span><span class='version identifier id'>version</span>

    <span class='unpack_35 identifier id'>unpack_35</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='@version ivar id'>@version</span>
                <span class='when when kw'>when</span> <span class='string val'>'3.2'</span>
                  <span class='false false kw'>false</span>
                <span class='when when kw'>when</span> <span class='string val'>'3.3'</span>
                  <span class='false false kw'>false</span>
                <span class='when when kw'>when</span> <span class='string val'>'3.5'</span>
                  <span class='true true kw'>true</span>
                <span class='end end kw'>end</span>
    <span class='@dta_files ivar id'>@dta_files</span><span class='comma token'>,</span> <span class='measured_mhs identifier id'>measured_mhs</span> <span class='assign token'>=</span> <span class='read_dta_files identifier id'>read_dta_files</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span><span class='@header ivar id'>@header</span><span class='dot token'>.</span><span class='num_dta_files identifier id'>num_dta_files</span><span class='comma token'>,</span> <span class='unpack_35 identifier id'>unpack_35</span><span class='rparen token'>)</span>

    <span class='@out_files ivar id'>@out_files</span> <span class='assign token'>=</span> <span class='read_out_files identifier id'>read_out_files</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span><span class='@header ivar id'>@header</span><span class='dot token'>.</span><span class='num_dta_files identifier id'>num_dta_files</span><span class='comma token'>,</span> <span class='measured_mhs identifier id'>measured_mhs</span><span class='comma token'>,</span> <span class='unpack_35 identifier id'>unpack_35</span><span class='comma token'>,</span> <span class='dup_refs_gt_0 identifier id'>dup_refs_gt_0</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='fh identifier id'>fh</span><span class='dot token'>.</span><span class='eof? fid id'>eof?</span>
      <span class='comment val'>#warn &quot;FILE: '#{filename}' appears to be an abortive run (no params in srf file)\nstill continuing...&quot;</span>
      <span class='@params ivar id'>@params</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@index ivar id'>@index</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span>
      <span class='@params ivar id'>@params</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Params constant id'>Params</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='parse_io identifier id'>parse_io</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='rparen token'>)</span>
      <span class='comment val'># This is very sensitive to the grab_params method in sequest params</span>
      <span class='fh identifier id'>fh</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>12</span><span class='rparen token'>)</span>  <span class='comment val'>## gap between last params entry and index </span>
      <span class='@index ivar id'>@index</span> <span class='assign token'>=</span> <span class='read_scan_index identifier id'>read_scan_index</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span><span class='@header ivar id'>@header</span><span class='dot token'>.</span><span class='num_dta_files identifier id'>num_dta_files</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>


  <span class='comment val'>### UPDATE SOME THINGS:</span>
  <span class='@base_name ivar id'>@base_name</span> <span class='assign token'>=</span> <span class='@header ivar id'>@header</span><span class='dot token'>.</span><span class='raw_filename identifier id'>raw_filename</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/[\\\/]([^\\\/]+)\.RAW$/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='comment val'># give each hit a base_name, first_scan, last_scan</span>
  <span class='@index ivar id'>@index</span><span class='dot token'>.</span><span class='each_with_index identifier id'>each_with_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='ind identifier id'>ind</span><span class='comma token'>,</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='mass_measured identifier id'>mass_measured</span> <span class='assign token'>=</span> <span class='@dta_files ivar id'>@dta_files</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='@out_files ivar id'>@out_files</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='mult op'>*</span><span class='ind identifier id'>ind</span>
    <span class='pep_hits identifier id'>pep_hits</span> <span class='assign token'>=</span> <span class='@out_files ivar id'>@out_files</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='integer val'>6</span><span class='rbrack token'>]</span>
    <span class='@peps ivar id'>@peps</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span> <span class='mult op'>*</span><span class='pep_hits identifier id'>pep_hits</span> <span class='rparen token'>)</span>
    <span class='pep_hits identifier id'>pep_hits</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='pep_hit identifier id'>pep_hit</span><span class='bitor op'>|</span>
      <span class='pep_hit identifier id'>pep_hit</span><span class='lbrack token'>[</span><span class='integer val'>14</span><span class='comma token'>,</span><span class='integer val'>4</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='@base_name ivar id'>@base_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='ind identifier id'>ind</span>
      <span class='comment val'># add the deltamass</span>
      <span class='pep_hit identifier id'>pep_hit</span><span class='lbrack token'>[</span><span class='integer val'>11</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='pep_hit identifier id'>pep_hit</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='minus op'>-</span> <span class='mass_measured identifier id'>mass_measured</span>  <span class='comment val'># real - measured (deltamass)</span>
      <span class='pep_hit identifier id'>pep_hit</span><span class='lbrack token'>[</span><span class='integer val'>12</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='float val'>1.0e6</span> <span class='mult op'>*</span> <span class='pep_hit identifier id'>pep_hit</span><span class='lbrack token'>[</span><span class='integer val'>11</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span> <span class='div op'>/</span> <span class='mass_measured identifier id'>mass_measured</span> <span class='comment val'>## ppm</span>
      <span class='pep_hit identifier id'>pep_hit</span><span class='lbrack token'>[</span><span class='integer val'>18</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='self self kw'>self</span>  <span class='comment val'>## link with the srf object</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='filter_by_precursor_mass_tolerance! fid id'>filter_by_precursor_mass_tolerance!</span> <span class='if if_mod kw'>if</span> <span class='params identifier id'>params</span>

  <span class='if if kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:link_protein_hits</span><span class='rbrack token'>]</span>
    <span class='lparen token'>(</span><span class='@peps ivar id'>@peps</span><span class='comma token'>,</span> <span class='@prots ivar id'>@prots</span><span class='rparen token'>)</span> <span class='assign token'>=</span> <span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='peps identifier id'>peps</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='_prot identifier id'>_prot</span><span class='comma token'>,</span> <span class='_peps identifier id'>_peps</span><span class='bitor op'>|</span>
      <span class='prot identifier id'>prot</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Srf constant id'>Srf</span><span class='colon2 op'>::</span><span class='Out constant id'>Out</span><span class='colon2 op'>::</span><span class='Prot constant id'>Prot</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='_prot identifier id'>_prot</span><span class='dot token'>.</span><span class='reference identifier id'>reference</span><span class='comma token'>,</span> <span class='_peps identifier id'>_peps</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>protein_class</h3>
</div><div id="protein_class-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>protein_class</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 43</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L43">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">43
44
45</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='protein_class identifier id'>protein_class</span>
  <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Srf constant id'>Srf</span><span class='colon2 op'>::</span><span class='Out constant id'>Out</span><span class='colon2 op'>::</span><span class='Prot constant id'>Prot</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>read_dta_files</h3>
</div><div id="read_dta_files-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>read_dta_files</span><span class='args'>(fh, num_files, unpack_35)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns an array of dta_files
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 247</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L247">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">247
248
249
250
251
252
253
254
255
256
257
258
259
260
261</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='read_dta_files identifier id'>read_dta_files</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span> <span class='num_files identifier id'>num_files</span><span class='comma token'>,</span> <span class='unpack_35 identifier id'>unpack_35</span><span class='rparen token'>)</span>
  <span class='measured_mhs identifier id'>measured_mhs</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='num_files identifier id'>num_files</span><span class='rparen token'>)</span> <span class='comment val'>## A parallel array to capture the actual mh</span>
  <span class='dta_files identifier id'>dta_files</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='num_files identifier id'>num_files</span><span class='rparen token'>)</span>
  <span class='start identifier id'>start</span> <span class='assign token'>=</span> <span class='dta_start_byte identifier id'>dta_start_byte</span>
  <span class='unless unless kw'>unless</span> <span class='fh identifier id'>fh</span><span class='dot token'>.</span><span class='pos identifier id'>pos</span> <span class='eq op'>==</span> <span class='start identifier id'>start</span>
    <span class='fh identifier id'>fh</span><span class='dot token'>.</span><span class='pos identifier id'>pos</span> <span class='assign token'>=</span> <span class='start identifier id'>start</span>
  <span class='end end kw'>end</span>

  <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='num_dta_files identifier id'>num_dta_files</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='dta_file identifier id'>dta_file</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Srf constant id'>Srf</span><span class='colon2 op'>::</span><span class='DTA constant id'>DTA</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='from_io identifier id'>from_io</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span> <span class='unpack_35 identifier id'>unpack_35</span><span class='rparen token'>)</span> 
    <span class='measured_mhs identifier id'>measured_mhs</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dta_file identifier id'>dta_file</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
    <span class='dta_files identifier id'>dta_files</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dta_file identifier id'>dta_file</span>
  <span class='end end kw'>end</span>
  <span class='lbrack token'>[</span><span class='dta_files identifier id'>dta_files</span><span class='comma token'>,</span> <span class='measured_mhs identifier id'>measured_mhs</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>read_out_files</h3>
</div><div id="read_out_files-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>read_out_files</span><span class='args'>(fh, number_files, measured_mhs, unpack_35, dup_refs_gt_0)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
filehandle (fh) must be at the start of the outfiles.
&#8216;read_dta_files&#8217; will put the fh there.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 265</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L265">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">265
266
267
268
269
270
271</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='read_out_files identifier id'>read_out_files</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span><span class='number_files identifier id'>number_files</span><span class='comma token'>,</span> <span class='measured_mhs identifier id'>measured_mhs</span><span class='comma token'>,</span> <span class='unpack_35 identifier id'>unpack_35</span><span class='comma token'>,</span> <span class='dup_refs_gt_0 identifier id'>dup_refs_gt_0</span><span class='rparen token'>)</span>
  <span class='out_files identifier id'>out_files</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='number_files identifier id'>number_files</span><span class='rparen token'>)</span>
  <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='num_dta_files identifier id'>num_dta_files</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='out_files identifier id'>out_files</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Srf constant id'>Srf</span><span class='colon2 op'>::</span><span class='Out constant id'>Out</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='from_io identifier id'>from_io</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span> <span class='unpack_35 identifier id'>unpack_35</span><span class='comma token'>,</span> <span class='dup_refs_gt_0 identifier id'>dup_refs_gt_0</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='out_files identifier id'>out_files</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>read_scan_index</h3>
</div><div id="read_scan_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>read_scan_index</span><span class='args'>(fh, num)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns an index where each entry is [first_scan, last_scan, charge]
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf.rb', line 233</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf.rb#L233">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">233
234
235
236
237
238
239
240
241
242
243
244</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='read_scan_index identifier id'>read_scan_index</span><span class='lparen token'>(</span><span class='fh identifier id'>fh</span><span class='comma token'>,</span> <span class='num identifier id'>num</span><span class='rparen token'>)</span>
  <span class='ind_len identifier id'>ind_len</span> <span class='assign token'>=</span> <span class='integer val'>24</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='num identifier id'>num</span><span class='rparen token'>)</span>
  <span class='unpack_string identifier id'>unpack_string</span> <span class='assign token'>=</span> <span class='string val'>'III'</span>
  <span class='st identifier id'>st</span> <span class='assign token'>=</span> <span class='string val'>''</span>
  <span class='ind_len identifier id'>ind_len</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='st identifier id'>st</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>'0'</span> <span class='end end kw'>end</span>  <span class='comment val'>## create a 24 byte string to receive data</span>
  <span class='num identifier id'>num</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='fh identifier id'>fh</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='ind_len identifier id'>ind_len</span><span class='comma token'>,</span> <span class='st identifier id'>st</span><span class='rparen token'>)</span>
    <span class='index identifier id'>index</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='st identifier id'>st</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='unpack_string identifier id'>unpack_string</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='index identifier id'>index</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>to_dta_files</h3>
</div><div id="to_dta_files-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_dta_files</span><span class='args'>(out_folder = nil, compress = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
not given an out_folder, will make one with the basename compress may be:
:zip, :tgz, or nil (no compression) :zip requires gem rubyzip to be
installed and is <b>very</b> bloated as it writes out all the files first!
:tgz requires gem archive-tar-minitar to be installed
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf/search.rb', line 49</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf/search.rb#L49">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='to_dta_files identifier id'>to_dta_files</span><span class='lparen token'>(</span><span class='out_folder identifier id'>out_folder</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='compress identifier id'>compress</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='outdir identifier id'>outdir</span> <span class='assign token'>=</span> 
    <span class='if if kw'>if</span> <span class='out_folder identifier id'>out_folder</span> <span class='semicolon token'>;</span> <span class='out_folder identifier id'>out_folder</span>
    <span class='else else kw'>else</span> <span class='base_name identifier id'>base_name</span>
    <span class='end end kw'>end</span>

  <span class='case case kw'>case</span> <span class='compress identifier id'>compress</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:tgz</span>
    <span class='begin begin kw'>begin</span>
      <span class='require identifier id'>require</span> <span class='string val'>'archive/tar/minitar'</span>
    <span class='rescue rescue kw'>rescue</span> <span class='LoadError constant id'>LoadError</span>
      <span class='abort identifier id'>abort</span> <span class='dstring node'>&quot;need gem 'archive-tar-minitar' installed' for tgz compression!\n#{$!}&quot;</span>
    <span class='end end kw'>end</span>
    <span class='require identifier id'>require</span> <span class='string val'>'archive/targz'</span>  <span class='comment val'># my own simplified interface!</span>
    <span class='require identifier id'>require</span> <span class='string val'>'zlib'</span>
    <span class='names identifier id'>names</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i_ar identifier id'>i_ar</span><span class='bitor op'>|</span>
      <span class='lbrack token'>[</span><span class='outdir identifier id'>outdir</span><span class='comma token'>,</span> <span class='string val'>'/'</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='base_name identifier id'>base_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='i_ar identifier id'>i_ar</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'.'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>'.dta'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>''</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='comment val'>#Archive::Targz.archive_as_files(outdir + '.tgz', names, dta_file_data)</span>

    <span class='tgz identifier id'>tgz</span> <span class='assign token'>=</span> <span class='Zlib constant id'>Zlib</span><span class='colon2 op'>::</span><span class='GzipWriter constant id'>GzipWriter</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='outdir identifier id'>outdir</span> <span class='plus op'>+</span> <span class='string val'>'.tgz'</span><span class='comma token'>,</span> <span class='string val'>'wb'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

    <span class='Archive constant id'>Archive</span><span class='colon2 op'>::</span><span class='Tar constant id'>Tar</span><span class='colon2 op'>::</span><span class='Minitar constant id'>Minitar</span><span class='colon2 op'>::</span><span class='Output constant id'>Output</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='tgz identifier id'>tgz</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='outp identifier id'>outp</span><span class='bitor op'>|</span>
      <span class='dta_files identifier id'>dta_files</span><span class='dot token'>.</span><span class='each_with_index identifier id'>each_with_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='dta_file identifier id'>dta_file</span><span class='comma token'>,</span> <span class='i identifier id'>i</span><span class='bitor op'>|</span>
        <span class='Archive constant id'>Archive</span><span class='colon2 op'>::</span><span class='Tar constant id'>Tar</span><span class='colon2 op'>::</span><span class='Minitar constant id'>Minitar</span><span class='dot token'>.</span><span class='pack_as_file identifier id'>pack_as_file</span><span class='lparen token'>(</span><span class='names identifier id'>names</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='dta_file identifier id'>dta_file</span><span class='dot token'>.</span><span class='to_dta_file_data identifier id'>to_dta_file_data</span><span class='comma token'>,</span> <span class='outp identifier id'>outp</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:zip</span>
    <span class='begin begin kw'>begin</span>
      <span class='require identifier id'>require</span> <span class='string val'>'zip/zipfilesystem'</span>
    <span class='rescue rescue kw'>rescue</span> <span class='LoadError constant id'>LoadError</span>
      <span class='abort identifier id'>abort</span> <span class='dstring node'>&quot;need gem 'rubyzip' installed' for zip compression!\n#{$!}&quot;</span>
    <span class='end end kw'>end</span>
    <span class='comment val'>#begin ; require 'zip/zipfilesystem' ; rescue LoadError, &quot;need gem 'rubyzip' installed' for zip compression!\n#{$!}&quot; ; end</span>
    <span class='Zip constant id'>Zip</span><span class='colon2 op'>::</span><span class='ZipFile constant id'>ZipFile</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='outdir identifier id'>outdir</span> <span class='plus op'>+</span> <span class='string val'>&quot;.zip&quot;</span><span class='comma token'>,</span> <span class='Zip constant id'>Zip</span><span class='colon2 op'>::</span><span class='ZipFile constant id'>ZipFile</span><span class='colon2 op'>::</span><span class='CREATE constant id'>CREATE</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='zfs identifier id'>zfs</span><span class='bitor op'>|</span>
      <span class='dta_files identifier id'>dta_files</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='dta identifier id'>dta</span><span class='comma token'>,</span><span class='i_ar identifier id'>i_ar</span><span class='bitor op'>|</span>
        <span class='comment val'>#zfs.mkdir(outdir)</span>
        <span class='zfs identifier id'>zfs</span><span class='dot token'>.</span><span class='get_output_stream identifier id'>get_output_stream</span><span class='lparen token'>(</span><span class='outdir identifier id'>outdir</span> <span class='plus op'>+</span> <span class='string val'>'/'</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span><span class='base_name identifier id'>base_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='i_ar identifier id'>i_ar</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'.'</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='string val'>'.dta'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='out identifier id'>out</span><span class='bitor op'>|</span>
          <span class='dta identifier id'>dta</span><span class='dot token'>.</span><span class='write_dta_file identifier id'>write_dta_file</span><span class='lparen token'>(</span><span class='out identifier id'>out</span><span class='rparen token'>)</span>
          <span class='comment val'>#zfs.commit</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>  <span class='comment val'># no compression</span>
    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkpath identifier id'>mkpath</span><span class='lparen token'>(</span><span class='outdir identifier id'>outdir</span><span class='rparen token'>)</span>
    <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='chdir identifier id'>chdir</span><span class='lparen token'>(</span><span class='outdir identifier id'>outdir</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='dta_files identifier id'>dta_files</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='dta identifier id'>dta</span><span class='comma token'>,</span><span class='i_ar identifier id'>i_ar</span><span class='bitor op'>|</span>
        <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='base_name identifier id'>base_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='i_ar identifier id'>i_ar</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>'.'</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>'.dta'</span><span class='comma token'>,</span> <span class='string val'>'wb'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='out identifier id'>out</span><span class='bitor op'>|</span>
          <span class='dta identifier id'>dta</span><span class='dot token'>.</span><span class='write_dta_file identifier id'>write_dta_file</span><span class='lparen token'>(</span><span class='out identifier id'>out</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>to_mgf</h3>
</div><div id="to_mgf-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_mgf</span><span class='args'>(filename = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Writes an MGF file to given filename or base_name + &#8217;.mgf&#8217; if
no filename given.
</p>
<p>
This mimicks the output of merge.pl from mascot The only difference is that
this does not include the &quot;\r\n&quot; that is found after the peak
lists, instead, it uses &quot;\n&quot; throughout the file (thinking that
this is preferable to mixing newline styles!)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf/search.rb', line 20</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf/search.rb#L20">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='to_mgf identifier id'>to_mgf</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='filename identifier id'>filename</span> <span class='assign token'>=</span>
    <span class='if if kw'>if</span> <span class='filename identifier id'>filename</span> <span class='semicolon token'>;</span> <span class='filename identifier id'>filename</span>
    <span class='else else kw'>else</span>
      <span class='base_name identifier id'>base_name</span> <span class='plus op'>+</span> <span class='string val'>'.mgf'</span>
    <span class='end end kw'>end</span>
  <span class='h_plus identifier id'>h_plus</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Mass constant id'>Mass</span><span class='colon2 op'>::</span><span class='MASCOT_H_PLUS constant id'>MASCOT_H_PLUS</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='filename identifier id'>filename</span><span class='comma token'>,</span> <span class='string val'>'wb'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='out identifier id'>out</span><span class='bitor op'>|</span>
    <span class='dta_files identifier id'>dta_files</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='index identifier id'>index</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='dta identifier id'>dta</span><span class='comma token'>,</span> <span class='i_ar identifier id'>i_ar</span><span class='bitor op'>|</span>
      <span class='chrg identifier id'>chrg</span> <span class='assign token'>=</span> <span class='dta identifier id'>dta</span><span class='dot token'>.</span><span class='charge identifier id'>charge</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='string val'>&quot;BEGIN IONS\n&quot;</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='dstring node'>&quot;TITLE=#{[base_name, *i_ar].push('dta').join('.')}\n&quot;</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='dstring node'>&quot;CHARGE=#{chrg}+\n&quot;</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='dstring node'>&quot;PEPMASS=#{(dta.mh+((chrg-1)*h_plus))/chrg}\n&quot;</span>
      <span class='peak_ar identifier id'>peak_ar</span> <span class='assign token'>=</span> <span class='dta identifier id'>dta</span><span class='dot token'>.</span><span class='peaks identifier id'>peaks</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>'e*'</span><span class='rparen token'>)</span>
      <span class='lparen token'>(</span><span class='integer val'>0</span><span class='dot3 op'>...</span><span class='lparen token'>(</span><span class='peak_ar identifier id'>peak_ar</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='step identifier id'>step</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
        <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='print identifier id'>print</span><span class='lparen token'>(</span> <span class='peak_ar identifier id'>peak_ar</span><span class='lbrack token'>[</span><span class='i identifier id'>i</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='string val'>&quot;END IONS\n&quot;</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='string val'>&quot;\n&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>to_sqt</h3>
</div><div id="to_sqt-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_sqt</span><span class='args'>(out_filename = nil, opts = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
the out_filename will be the base_name + .sqt unless
&#8216;out_filename&#8217; is defined :round =&gt; round floating point
numbers etc&#8230;
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ms/sequest/srf/sqt.rb', line 14</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jtprince/ms-sequest/blob/64f5514dbb202812d97cb4ea000b8848391c430b/lib/ms/sequest/srf/sqt.rb#L14">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='to_sqt identifier id'>to_sqt</span><span class='lparen token'>(</span><span class='out_filename identifier id'>out_filename</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='comment val'># default rounding precision (Decimal Places)</span>
  <span class='tic_dp identifier id'>tic_dp</span> <span class='assign token'>=</span> <span class='integer val'>2</span>
  <span class='mh_dp identifier id'>mh_dp</span> <span class='assign token'>=</span> <span class='integer val'>7</span>
  <span class='xcorr_dp identifier id'>xcorr_dp</span> <span class='assign token'>=</span> <span class='integer val'>5</span>
  <span class='sp_dp identifier id'>sp_dp</span> <span class='assign token'>=</span> <span class='integer val'>2</span>
  <span class='dcn_dp identifier id'>dcn_dp</span> <span class='assign token'>=</span> <span class='integer val'>5</span>

  <span class='defaults identifier id'>defaults</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:db_info=</span><span class='gt op'>&gt;</span><span class='false false kw'>false</span><span class='comma token'>,</span> <span class='symbol val'>:new_db_path=</span><span class='gt op'>&gt;</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='symbol val'>:update_db_path=</span><span class='gt op'>&gt;</span><span class='false false kw'>false</span><span class='comma token'>,</span> <span class='symbol val'>:round=</span><span class='gt op'>&gt;</span><span class='false false kw'>false</span><span class='rbrace token'>}</span>
  <span class='opt identifier id'>opt</span> <span class='assign token'>=</span> <span class='defaults identifier id'>defaults</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span>

  <span class='outfile identifier id'>outfile</span> <span class='assign token'>=</span>
    <span class='if if kw'>if</span> <span class='out_filename identifier id'>out_filename</span>
      <span class='out_filename identifier id'>out_filename</span>
    <span class='else else kw'>else</span>
      <span class='base_name identifier id'>base_name</span> <span class='plus op'>+</span> <span class='string val'>'.sqt'</span>
    <span class='end end kw'>end</span>
  <span class='invariant_ordering identifier id'>invariant_ordering</span> <span class='assign token'>=</span> <span class='dstring node'>%w(SQTGenerator SQTGeneratorVersion Database FragmentMasses PrecursorMasses StartTime)</span> <span class='comment val'># just for readability and consistency</span>
  <span class='fmt identifier id'>fmt</span> <span class='assign token'>=</span> 
    <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='fragment_mass_type identifier id'>fragment_mass_type</span> <span class='eq op'>==</span> <span class='string val'>'average'</span> <span class='semicolon token'>;</span> <span class='string val'>'AVG'</span>
    <span class='else else kw'>else</span> <span class='semicolon token'>;</span> <span class='string val'>'MONO'</span>
    <span class='end end kw'>end</span>
  <span class='pmt identifier id'>pmt</span> <span class='assign token'>=</span>
    <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='precursor_mass_type identifier id'>precursor_mass_type</span> <span class='eq op'>==</span> <span class='string val'>'average'</span> <span class='semicolon token'>;</span> <span class='string val'>'AVG'</span>
    <span class='else else kw'>else</span> <span class='semicolon token'>;</span> <span class='string val'>'MONO'</span>
    <span class='end end kw'>end</span>
  
  <span class='mass_index identifier id'>mass_index</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='mass_index identifier id'>mass_index</span>
  <span class='static_mods identifier id'>static_mods</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='static_mods identifier id'>static_mods</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='key identifier id'>key</span> <span class='assign token'>=</span>  <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/_/</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='key identifier id'>key</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
      <span class='key identifier id'>key</span> <span class='plus op'>+</span> <span class='string val'>'='</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='mass_index identifier id'>mass_index</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='else else kw'>else</span>
      <span class='key identifier id'>key</span> <span class='plus op'>+</span> <span class='string val'>'='</span> <span class='plus op'>+</span> <span class='v identifier id'>v</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='dynamic_mods identifier id'>dynamic_mods</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='modifications identifier id'>modifications</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/\((.*?)\)/</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='match identifier id'>match</span><span class='bitor op'>|</span>
    <span class='dynamic_mods identifier id'>dynamic_mods</span> <span class='lshft op'>&lt;&lt;</span> <span class='match identifier id'>match</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/ /</span><span class='comma token'>,</span><span class='string val'>'='</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='plural identifier id'>plural</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='string val'>'StaticMod'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='static_mods identifier id'>static_mods</span><span class='comma token'>,</span>
    <span class='string val'>'DynamicMod'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dynamic_mods identifier id'>dynamic_mods</span><span class='comma token'>,</span>  <span class='comment val'># example as diff mod</span>
    <span class='string val'>'Comment'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>'Created from Bioworks .srf file'</span><span class='rbrack token'>]</span>
  <span class='rbrace token'>}</span>

  <span class='db_filename identifier id'>db_filename</span> <span class='assign token'>=</span> <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='db_filename identifier id'>db_filename</span><span class='dot token'>.</span><span class='sub identifier id'>sub</span><span class='lparen token'>(</span><span class='regexp val'>/\.hdr$/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span> <span class='comment val'># remove the .hdr postfix</span>
  <span class='db_filename_in_sqt identifier id'>db_filename_in_sqt</span> <span class='assign token'>=</span> <span class='db_filename identifier id'>db_filename</span>
  <span class='if if kw'>if</span> <span class='opt identifier id'>opt</span><span class='lbrack token'>[</span><span class='symbol val'>:new_db_path</span><span class='rbrack token'>]</span>
    <span class='db_filename identifier id'>db_filename</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='opt identifier id'>opt</span><span class='lbrack token'>[</span><span class='symbol val'>:new_db_path</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='basename identifier id'>basename</span><span class='lparen token'>(</span><span class='db_filename identifier id'>db_filename</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>'\\'</span><span class='comma token'>,</span> <span class='string val'>'/'</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='opt identifier id'>opt</span><span class='lbrack token'>[</span><span class='symbol val'>:update_db_path</span><span class='rbrack token'>]</span>
      <span class='db_filename_in_sqt identifier id'>db_filename_in_sqt</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='db_filename identifier id'>db_filename</span><span class='rparen token'>)</span>
      <span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;writing Database #{db_filename} to sqt, but it does not exist on this file system&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='db_filename identifier id'>db_filename</span><span class='rparen token'>)</span> 
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='apmu identifier id'>apmu</span> <span class='assign token'>=</span> 
    <span class='case case kw'>case</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='peptide_mass_units identifier id'>peptide_mass_units</span> 
    <span class='when when kw'>when</span> <span class='string val'>'0'</span> <span class='colon op'>:</span> <span class='string val'>'amu'</span> 
    <span class='when when kw'>when</span> <span class='string val'>'1'</span> <span class='colon op'>:</span> <span class='string val'>'mmu'</span>
    <span class='when when kw'>when</span> <span class='string val'>'2'</span> <span class='colon op'>:</span> <span class='string val'>'ppm'</span>
    <span class='end end kw'>end</span>

  <span class='hh identifier id'>hh</span> <span class='assign token'>=</span>  <span class='lbrace token'>{</span>
    <span class='string val'>'SQTGenerator'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;mspire: ms-sequest&quot;</span><span class='comma token'>,</span>
    <span class='string val'>'SQTGeneratorVersion'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='VERSION constant id'>VERSION</span><span class='comma token'>,</span>
    <span class='string val'>'Database'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='db_filename_in_sqt identifier id'>db_filename_in_sqt</span><span class='comma token'>,</span>
    <span class='string val'>'FragmentMasses'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='fmt identifier id'>fmt</span><span class='comma token'>,</span>
    <span class='string val'>'PrecursorMasses'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='pmt identifier id'>pmt</span><span class='comma token'>,</span>
    <span class='string val'>'StartTime'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>''</span><span class='comma token'>,</span>  <span class='comment val'># Bioworks 3.2 also leaves this blank...</span>
    <span class='string val'>'Alg-PreMassTol'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='peptide_mass_tolerance identifier id'>peptide_mass_tolerance</span><span class='comma token'>,</span>
    <span class='string val'>'Alg-FragMassTol'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='fragment_ion_tolerance identifier id'>fragment_ion_tolerance</span><span class='comma token'>,</span>
    <span class='string val'>'Alg-PreMassUnits'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='apmu identifier id'>apmu</span><span class='comma token'>,</span> <span class='comment val'>## mine</span>
    <span class='string val'>'Alg-IonSeries'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='ion_series identifier id'>ion_series</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='lstrip identifier id'>lstrip</span><span class='comma token'>,</span>
    <span class='string val'>'Alg-Enzyme'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='enzyme identifier id'>enzyme</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='comma token'>,</span>
    <span class='string val'>'Alg-MSModel'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='model identifier id'>model</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span>

  <span class='if if kw'>if</span> <span class='opt identifier id'>opt</span><span class='lbrack token'>[</span><span class='symbol val'>:db_info</span><span class='rbrack token'>]</span>
    <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='db_filename identifier id'>db_filename</span><span class='rparen token'>)</span>
      <span class='reply identifier id'>reply</span> <span class='assign token'>=</span> <span class='Ms constant id'>Ms</span><span class='colon2 op'>::</span><span class='Sequest constant id'>Sequest</span><span class='colon2 op'>::</span><span class='Sqt constant id'>Sqt</span><span class='dot token'>.</span><span class='db_info identifier id'>db_info</span><span class='lparen token'>(</span><span class='db_filename identifier id'>db_filename</span><span class='rparen token'>)</span>
      <span class='dstring node'>%w(DBSeqLength DBLocusCount DBMD5Sum)</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='reply identifier id'>reply</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='label identifier id'>label</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='bitor op'>|</span>
        <span class='hh identifier id'>hh</span><span class='lbrack token'>[</span><span class='label identifier id'>label</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;file #{db_filename} does not exist, no extra db info in header!&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='has_hits identifier id'>has_hits</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='out_files identifier id'>out_files</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='has_hits identifier id'>has_hits</span>
    <span class='comment val'># somewhat redundant with above, but we can get this without a db present!</span>
    <span class='hh identifier id'>hh</span><span class='lbrack token'>[</span><span class='string val'>'DBLocusCount'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='out_files identifier id'>out_files</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='db_locus_count identifier id'>db_locus_count</span>
  <span class='end end kw'>end</span>

  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='outfile identifier id'>outfile</span><span class='comma token'>,</span> <span class='string val'>'w'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='out identifier id'>out</span><span class='bitor op'>|</span>
    <span class='comment val'># print the header:</span>
    <span class='invariant_ordering identifier id'>invariant_ordering</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='iv identifier id'>iv</span><span class='bitor op'>|</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='lbrack token'>[</span><span class='string val'>'H'</span><span class='comma token'>,</span> <span class='iv identifier id'>iv</span><span class='comma token'>,</span> <span class='hh identifier id'>hh</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='iv identifier id'>iv</span><span class='rparen token'>)</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\t&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='hh identifier id'>hh</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='lbrack token'>[</span><span class='string val'>'H'</span><span class='comma token'>,</span> <span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\t&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='plural identifier id'>plural</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='vals identifier id'>vals</span><span class='bitor op'>|</span>
      <span class='vals identifier id'>vals</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='val identifier id'>val</span><span class='bitor op'>|</span>
        <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='lbrack token'>[</span><span class='string val'>'H'</span><span class='comma token'>,</span> <span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\t&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##### SPECTRA</span>
    <span class='time_to_process identifier id'>time_to_process</span> <span class='assign token'>=</span> <span class='string val'>'0.0'</span>
    <span class='comment val'>#########################################</span>
    <span class='comment val'># NEED TO FIGURE OUT: (in spectra guy)</span>
    <span class='comment val'>#    * Lowest Sp value for top 500 spectra</span>
    <span class='comment val'>#    * Number of sequences matching this precursor ion </span>
    <span class='comment val'>#########################################</span>

    <span class='manual_validation_status identifier id'>manual_validation_status</span> <span class='assign token'>=</span> <span class='string val'>'U'</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='out_files identifier id'>out_files</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='dta_files identifier id'>dta_files</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='out_file identifier id'>out_file</span><span class='comma token'>,</span> <span class='dta_file identifier id'>dta_file</span><span class='bitor op'>|</span>
      <span class='comment val'># don't have the time to process (using 0.0 like bioworks 3.2)</span>
      <span class='dta_file_mh identifier id'>dta_file_mh</span> <span class='assign token'>=</span> <span class='dta_file identifier id'>dta_file</span><span class='dot token'>.</span><span class='mh identifier id'>mh</span>
      <span class='out_file_total_inten identifier id'>out_file_total_inten</span> <span class='assign token'>=</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='total_inten identifier id'>total_inten</span>
      <span class='out_file_lowest_sp identifier id'>out_file_lowest_sp</span> <span class='assign token'>=</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='lowest_sp identifier id'>lowest_sp</span>
      <span class='if if kw'>if</span> <span class='opt identifier id'>opt</span><span class='lbrack token'>[</span><span class='symbol val'>:round</span><span class='rbrack token'>]</span>
        <span class='dta_file_mh identifier id'>dta_file_mh</span> <span class='assign token'>=</span> <span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='dta_file_mh identifier id'>dta_file_mh</span><span class='comma token'>,</span> <span class='mh_dp identifier id'>mh_dp</span><span class='rparen token'>)</span>
        <span class='out_file_total_inten identifier id'>out_file_total_inten</span> <span class='assign token'>=</span> <span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='out_file_total_inten identifier id'>out_file_total_inten</span><span class='comma token'>,</span> <span class='tic_dp identifier id'>tic_dp</span><span class='rparen token'>)</span>
        <span class='out_file_lowest_sp identifier id'>out_file_lowest_sp</span> <span class='assign token'>=</span> <span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='out_file_lowest_sp identifier id'>out_file_lowest_sp</span><span class='comma token'>,</span> <span class='sp_dp identifier id'>sp_dp</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='lbrack token'>[</span><span class='string val'>'S'</span><span class='comma token'>,</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='first_scan identifier id'>first_scan</span><span class='comma token'>,</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='last_scan identifier id'>last_scan</span><span class='comma token'>,</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='charge identifier id'>charge</span><span class='comma token'>,</span> <span class='time_to_process identifier id'>time_to_process</span><span class='comma token'>,</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='computer identifier id'>computer</span><span class='comma token'>,</span> <span class='dta_file_mh identifier id'>dta_file_mh</span><span class='comma token'>,</span> <span class='out_file_total_inten identifier id'>out_file_total_inten</span><span class='comma token'>,</span> <span class='out_file_lowest_sp identifier id'>out_file_lowest_sp</span><span class='comma token'>,</span> <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='num_matched_peptides identifier id'>num_matched_peptides</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\t&quot;</span><span class='rparen token'>)</span>
      <span class='out_file identifier id'>out_file</span><span class='dot token'>.</span><span class='hits identifier id'>hits</span><span class='dot token'>.</span><span class='each_with_index identifier id'>each_with_index</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='hit identifier id'>hit</span><span class='comma token'>,</span><span class='index identifier id'>index</span><span class='bitor op'>|</span>
        <span class='hit_mh identifier id'>hit_mh</span> <span class='assign token'>=</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='mh identifier id'>mh</span>
        <span class='hit_deltacn_orig_updated identifier id'>hit_deltacn_orig_updated</span> <span class='assign token'>=</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='deltacn_orig_updated identifier id'>deltacn_orig_updated</span>
        <span class='hit_xcorr identifier id'>hit_xcorr</span> <span class='assign token'>=</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='xcorr identifier id'>xcorr</span>
        <span class='hit_sp identifier id'>hit_sp</span> <span class='assign token'>=</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='sp identifier id'>sp</span>
        <span class='if if kw'>if</span> <span class='opt identifier id'>opt</span><span class='lbrack token'>[</span><span class='symbol val'>:round</span><span class='rbrack token'>]</span>
          <span class='hit_mh identifier id'>hit_mh</span> <span class='assign token'>=</span> <span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='hit_mh identifier id'>hit_mh</span><span class='comma token'>,</span> <span class='mh_dp identifier id'>mh_dp</span><span class='rparen token'>)</span>
          <span class='hit_deltacn_orig_updated identifier id'>hit_deltacn_orig_updated</span> <span class='assign token'>=</span> <span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='hit_deltacn_orig_updated identifier id'>hit_deltacn_orig_updated</span><span class='comma token'>,</span> <span class='dcn_dp identifier id'>dcn_dp</span><span class='rparen token'>)</span>
          <span class='hit_xcorr identifier id'>hit_xcorr</span> <span class='assign token'>=</span> <span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='hit_xcorr identifier id'>hit_xcorr</span><span class='comma token'>,</span> <span class='xcorr_dp identifier id'>xcorr_dp</span><span class='rparen token'>)</span>
          <span class='hit_sp identifier id'>hit_sp</span> <span class='assign token'>=</span> <span class='round identifier id'>round</span><span class='lparen token'>(</span><span class='hit_sp identifier id'>hit_sp</span><span class='comma token'>,</span> <span class='sp_dp identifier id'>sp_dp</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
        <span class='comment val'># note that the rank is determined by the order..</span>
        <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='lbrack token'>[</span><span class='string val'>'M'</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='rsp identifier id'>rsp</span><span class='comma token'>,</span> <span class='hit_mh identifier id'>hit_mh</span><span class='comma token'>,</span> <span class='hit_deltacn_orig_updated identifier id'>hit_deltacn_orig_updated</span><span class='comma token'>,</span> <span class='hit_xcorr identifier id'>hit_xcorr</span><span class='comma token'>,</span> <span class='hit_sp identifier id'>hit_sp</span><span class='comma token'>,</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='ions_matched identifier id'>ions_matched</span><span class='comma token'>,</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='ions_total identifier id'>ions_total</span><span class='comma token'>,</span> <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='sequence identifier id'>sequence</span><span class='comma token'>,</span> <span class='manual_validation_status identifier id'>manual_validation_status</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\t&quot;</span><span class='rparen token'>)</span>
        <span class='hit identifier id'>hit</span><span class='dot token'>.</span><span class='prots identifier id'>prots</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='prot identifier id'>prot</span><span class='bitor op'>|</span>
          <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='lbrack token'>[</span><span class='string val'>'L'</span><span class='comma token'>,</span> <span class='prot identifier id'>prot</span><span class='dot token'>.</span><span class='first_entry identifier id'>first_entry</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\t&quot;</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span> <span class='comment val'># close the filehandle</span>
<span class='end end kw'>end</span> <span class='comment val'># method</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>