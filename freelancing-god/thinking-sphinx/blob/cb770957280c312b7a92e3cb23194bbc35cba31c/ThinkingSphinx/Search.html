<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>freelancing-god's thinking-sphinx - Class: ThinkingSphinx::Search - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/freelancing-god/commits/thinking-sphinx/master" rel="alternate" title="Recent Commits to thinking-sphinx:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("freelancing-god", "thinking-sphinx", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("freelancing-god", "thinking-sphinx", "cb770957280c312b7a92e3cb23194bbc35cba31c", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/freelancing-god/thinking-sphinx/tree/">Source</a></li>
            <li class=""><a href="http://github.com/freelancing-god/thinking-sphinx/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/freelancing-god/thinking-sphinx/network">Network</a></li>            
            <li class=""><a href="http://github.com/freelancing-god/thinking-sphinx/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/freelancing-god/thinking-sphinx">Wiki</a></li>
            <li class=""><a href="http://github.com/freelancing-god/thinking-sphinx/graphs">Graphs</a></li>                    
            <li class="active"><a href="/freelancing-god/thinking-sphinx">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/freelancing-god">freelancing-god</a> / <b><a href="http://github.com/freelancing-god/thinking-sphinx/tree">thinking-sphinx</a></b>        
                <a id="namespaces_button" rel="freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class ThinkingSphinx_Search">
  <h1>Class: ThinkingSphinx::Search</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="Search/Facets.html" title="ThinkingSphinx::Search::Facets">ThinkingSphinx::Search::Facets</a></p>
</div><div class="section docstring">
  <p>
Once you&#8217;ve got those indexes in and built, this is the stuff that
matters - how to search! This class provides a generic search interface -
which you can use to search all your indexed models at once. Most times,
you will just want a specific model&#8217;s results - to search and
search_for_ids methods will do the job in exactly the same manner when
called from a model.
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="GlobalFacetOptions-constant">GlobalFacetOptions</dt>
      <dd>{
  :all_attributes =&gt; false,
  :class_facet    =&gt; true
}</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#count-class_method">count</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#retry_search_on_stale_index-class_method">retry_search_on_stale_index</span><span class='args'>(query, options, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#search-class_method">search</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Searches through the Sphinx indexes for relevant matches.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#search_for_id-class_method">search_for_id</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks if a document with the given id exists within a specific index.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#search_for_ids-class_method">search_for_ids</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Searches for results that match the parameters provided.
</p>

        
      </td>
    </tr>
  
</table><div class="included">
  
  <div>
    <h2>Public Class Methods Included from <a href="Search/Facets.html" title="ThinkingSphinx::Search::Facets">ThinkingSphinx::Search::Facets</a></h2>
    <p><span class='name'><a href="Search/Facets.html#facets-instance_method" title="facets">facets</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>count</h3>
</div><div id="count-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>count</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thinking_sphinx/search.rb', line 407</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c/lib/thinking_sphinx/search.rb#L407">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">407
408
409
410</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='results identifier id'>results</span><span class='comma token'>,</span> <span class='client identifier id'>client</span> <span class='assign token'>=</span> <span class='search_results identifier id'>search_results</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span><span class='rparen token'>)</span>
  <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='symbol val'>:total_found</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>0</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>retry_search_on_stale_index</h3>
</div><div id="retry_search_on_stale_index-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>retry_search_on_stale_index</span><span class='args'>(query, options, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thinking_sphinx/search.rb', line 375</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c/lib/thinking_sphinx/search.rb#L375">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='retry_search_on_stale_index identifier id'>retry_search_on_stale_index</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='stale_ids identifier id'>stale_ids</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='stale_retries_left identifier id'>stale_retries_left</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:retry_stale</span><span class='rbrack token'>]</span>
                        <span class='when when kw'>when</span> <span class='true true kw'>true</span>
                          <span class='integer val'>3</span>  <span class='comment val'># default to three retries</span>
                        <span class='when when kw'>when</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='false false kw'>false</span>
                          <span class='integer val'>0</span>  <span class='comment val'># no retries</span>
                        <span class='else else kw'>else</span>             <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:retry_stale</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
                        <span class='end end kw'>end</span>
  <span class='begin begin kw'>begin</span>
    <span class='comment val'># Passing this in an option so Collection.create_from_results can see it.</span>
    <span class='comment val'># It should only raise on stale records if there are any retries left.</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:raise_on_stale</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='stale_retries_left identifier id'>stale_retries_left</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
  <span class='comment val'># If ThinkingSphinx::Collection.create_from_results found records in Sphinx but not</span>
  <span class='comment val'># in the DB and the :raise_on_stale option is set, this exception is raised. We retry</span>
  <span class='comment val'># a limited number of times, excluding the stale ids from the search.</span>
  <span class='rescue rescue kw'>rescue</span> <span class='StaleIdsException constant id'>StaleIdsException</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='stale_retries_left identifier id'>stale_retries_left</span> <span class='opasgn op'>-=</span> <span class='integer val'>1</span>

    <span class='stale_ids identifier id'>stale_ids</span> <span class='opasgn op'>|=</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='ids identifier id'>ids</span>  <span class='comment val'># For logging</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:without_ids</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:without_ids</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='bitor op'>|</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='ids identifier id'>ids</span>  <span class='comment val'># Actual exclusion</span>

    <span class='tries identifier id'>tries</span> <span class='assign token'>=</span> <span class='stale_retries_left identifier id'>stale_retries_left</span>
    <span class='log identifier id'>log</span> <span class='string val'>&quot;Sphinx Stale Ids (%s %s left): %s&quot;</span> <span class='mod op'>%</span> <span class='lbrack token'>[</span>
      <span class='tries identifier id'>tries</span><span class='comma token'>,</span> <span class='lparen token'>(</span><span class='tries identifier id'>tries</span><span class='eq op'>==</span><span class='integer val'>1</span> <span class='question op'>?</span> <span class='string val'>'try'</span> <span class='colon op'>:</span> <span class='string val'>'tries'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='stale_ids identifier id'>stale_ids</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>', '</span><span class='rparen token'>)</span>
    <span class='rbrack token'>]</span>
    
    <span class='retry retry kw'>retry</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>search</h3>
</div><div id="search-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>search</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Searches through the Sphinx indexes for relevant matches. There&#8217;s
various ways to search, sort, group and filter - which are covered below.
</p>
<p>
Also, if you have WillPaginate installed, the search method can be used
just like paginate. The same parameters - :page and :per_page - work as
expected, and the returned result set can be used by the will_paginate
helper.
</p>
<h2>Basic Searching</h2>
<p>
The simplest way of searching is straight text.
</p>
<pre class="code">
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat&quot;</span>
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;google&quot;</span>
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:page</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='Article constant id'>Article</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;relevant news issue of the day&quot;</span>
</pre>
<p>
If you specify :include, like in an #find call, this will be respected when
loading the relevant models from the search results.
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:include</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:posts</span>
</pre>
<h2>Match Modes</h2>
<p>
Sphinx supports 5 different matching modes. By default Thinking Sphinx uses
:all, which unsurprisingly requires all the supplied search terms to match
a result.
</p>
<p>
Alternative modes include:
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat allan&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:match_mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:any</span>
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat allan&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:match_mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:phrase</span>
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat | allan&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:match_mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:boolean</span>
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;@name pat | @username pat&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:match_mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:extended</span>
</pre>
<p>
Any will find results with any of the search terms. Phrase treats the
search terms a single phrase instead of individual words. Boolean and
extended allow for more complex query syntax, refer to the sphinx
documentation for further details.
</p>
<h2>Weighting</h2>
<p>
Sphinx has support for weighting, where matches in one field can be
considered more important than in another. Weights are integers, with 1 as
the default. They can be set per-search like this:
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat allan&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:field_weights</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:alias</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>4</span><span class='comma token'>,</span> <span class='symbol val'>:aka</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span> <span class='rbrace token'>}</span>
</pre>
<p>
If you&#8217;re searching multiple models, you can set per-index weights:
</p>
<pre class="code">
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;pat&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:index_weights</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='User constant id'>User</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span> <span class='rbrace token'>}</span>
</pre>
<p>
See http://sphinxsearch.com/doc.html#weighting for further details.
</p>
<h2>Searching by Fields</h2>
<p>
If you want to step it up a level, you can limit your search terms to
specific fields:
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;pat&quot;</span><span class='rbrace token'>}</span>
</pre>
<p>
This uses Sphinx&#8217;s extended match mode, unless you specify a
different match mode explicitly (but then this way of searching won&#8217;t
work). Also note that you don&#8217;t need to put in a search string.
</p>
<h2>Searching by Attributes</h2>
<p>
Also known as filters, you can limit your searches to documents that have
specific values for their attributes. There are three ways to do this. The
first two techniques work in all scenarios - using the :with or :with_all
options.
</p>
<pre class="code">
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:with</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:tag_ids</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span><span class='rbrace token'>}</span>
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:with</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:tag_ids</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>10</span><span class='comma token'>,</span><span class='integer val'>12</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:with_all</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:tag_ids</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>10</span><span class='comma token'>,</span><span class='integer val'>12</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
</pre>
<p>
The first :with search will match records with a tag_id attribute of 10.
The second :with will match records with a tag_id attribute of 10 OR 12. If
you need to find records that are tagged with ids 10 AND 12, you will need
to use the :with_all search parameter. This is particuarly useful in
conjunction with Multi Value Attributes (MVAs).
</p>
<p>
The third filtering technique is only viable if you&#8217;re searching with
a specific model (not multi-model searching). With a single model, Thinking
Sphinx can figure out what attributes and fields are available, so you can
put it all in the :conditions hash, and it will sort it out.
</p>
<pre class="code">
  <span class='Node constant id'>Node</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:parent_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span><span class='rbrace token'>}</span>
</pre>
<p>
Filters can be single values, arrays of values, or ranges.
</p>
<pre class="code">
  <span class='Article constant id'>Article</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;East Timor&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:rating</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>3</span><span class='dot2 op'>..</span><span class='integer val'>5</span><span class='rbrace token'>}</span>
</pre>
<h2>Excluding by Attributes</h2>
<p>
Sphinx also supports negative filtering - where the filters are of
attribute values to exclude. This is done with the :without option:
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:without</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:role_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rbrace token'>}</span>
</pre>
<h2>Excluding by Primary Key</h2>
<p>
There is a shortcut to exclude records by their ActiveRecord primary key:
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:without_ids</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span>
</pre>
<p>
Pass an array or a single value.
</p>
<p>
The primary key must be an integer as a negative filter is used. Note that
for multi-model search, an id may occur in more than one model.
</p>
<h2>Infix (Star) Searching</h2>
<p>
By default, Sphinx uses English stemming, e.g. matching &quot;shoes&quot;
if you search for &quot;shoe&quot;. It won&#8217;t find
&quot;Melbourne&quot; if you search for &quot;elbourn&quot;, though.
</p>
<p>
Enable infix searching by something like this in config/sphinx.yml:
</p>
<pre class="code">
  <span class='development identifier id'>development</span><span class='colon op'>:</span>
    <span class='enable_star identifier id'>enable_star</span><span class='colon op'>:</span> <span class='integer val'>1</span>
    <span class='min_infix_length identifier id'>min_infix_length</span><span class='colon op'>:</span> <span class='integer val'>2</span>
</pre>
<p>
Note that this will make indexing take longer.
</p>
<p>
With those settings (and after reindexing), wildcard asterisks can be used
in queries:
</p>
<pre class="code">
  <span class='Location constant id'>Location</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;*elbourn*&quot;</span>
</pre>
<p>
To automatically add asterisks around every token (but not operators), pass
the :star option:
</p>
<pre class="code">
  <span class='Location constant id'>Location</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;elbourn -ustrali&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:star</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:match_mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:boolean</span>
</pre>
<p>
This would become &quot;<b>elbourn</b> -<b>ustrali</b>&quot;. The :star
option only adds the asterisks. You need to make the config/sphinx.yml
changes yourself.
</p>
<p>
By default, the tokens are assumed to match the regular expression /\w<tt>/u.
If you&#8217;ve modified the charset_table, pass another regular
expression, e.g.
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;oo@bar.c&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:star</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='regexp val'>/[\w@.]&lt;/</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='regexp val'>/u)
</span></pre>
<p>
to search for &quot;*oo@bar.c*&quot; and not
&quot;<b>oo</b>@<b>bar</b>.<b>c</b>&quot;.
</p>
<h2>Sorting</h2>
<p>
Sphinx can only sort by attributes, so generally you will need to avoid
using field names in your :order option. However, if you&#8217;re searching
on a single model, and have specified some fields as sortable, you can use
those field names and Thinking Sphinx will interpret accordingly. Remember:
this will only happen for single-model searches, and only through the
:order option.
</p>
<pre class="code">
  <span class='Location constant id'>Location</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;Melbourne&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:state</span>
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:role_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;name ASC&quot;</span>
</pre>
<p>
Keep in mind that if you use a string, you <b>must</b> specify the
direction (ASC or DESC) else Sphinx won&#8217;t return any results. If you
use a symbol then Thinking Sphinx assumes ASC, but if you wish to state
otherwise, use the :sort_mode option:
</p>
<pre class="code">
  <span class='Location constant id'>Location</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;Melbourne&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:state</span><span class='comma token'>,</span> <span class='symbol val'>:sort_mode</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:desc</span>
</pre>
<p>
Of course, there are other sort modes - check out the Sphinx
documentation[http://sphinxsearch.com/doc.html] for that level of detail
though.
</p>
<p>
If desired, you can sort by a column in your model instead of a sphinx
field or attribute. This sort only applies to the current page, so is most
useful when performing a search with a single page of results.
</p>
<pre class="code">
  <span class='User constant id'>User</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;pat&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:sql_order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;name&quot;</span><span class='rparen token'>)</span>
</pre>
<h2>Grouping</h2>
<p>
For this you can use the group_by, group_clause and group_function options
- which are all directly linked to Sphinx&#8217;s expectations. No magic
from Thinking Sphinx. It can get a little tricky, so make sure you read all
the relevant documentation[http://sphinxsearch.com/doc.html#clustering]
first.
</p>
<p>
Grouping is done via three parameters within the options hash
</p>
<ul>
<li><tt>:group_function</tt> determines the way grouping is done

</li>
<li><tt>:group_by</tt> determines the field which is used for grouping

</li>
<li><tt>:group_clause</tt> determines the sorting order

</li>
</ul>
<p>
As a convenience, you can also use
</p>
<ul>
<li><tt>:group</tt>

</li>
</ul>
<p>
which sets :group_by and defaults to :group_function of :attr
</p>
<h3>group_function</h3>
<p>
Valid values for :group_function are
</p>
<ul>
<li><tt>:day</tt>, <tt>:week</tt>, <tt>:month</tt>, <tt>:year</tt> - Grouping
is done by the respective timeframes.

</li>
<li><tt>:attr</tt>, <tt>:attrpair</tt> - Grouping is done by the specified
attributes(s)

</li>
</ul>
<h3>group_by</h3>
<p>
This parameter denotes the field by which grouping is done. Note that the
specified field must be a sphinx attribute or index.
</p>
<h3>group_clause</h3>
<p>
This determines the sorting order of the groups. In a grouping search, the
matches within a group will sorted by the <tt>:sort_mode</tt> and
<tt>:order</tt> parameters. The group matches themselves however, will be
sorted by <tt>:group_clause</tt>.
</p>
<p>
The syntax for this is the same as an order parameter in extended sort
mode. Namely, you can specify an SQL-like sort expression with up to 5
attributes (including internal attributes), eg: &quot;@relevance DESC,
price ASC, @id DESC&quot;
</p>
<h3>Grouping by timestamp</h3>
<p>
Timestamp grouping groups off items by the day, week, month or year of the
attribute given. In order to do this you need to define a timestamp
attribute, which pretty much looks like the standard defintion for any
attribute.
</p>
<pre class="code">
  <span class='define_index identifier id'>define_index</span> <span class='do do kw'>do</span>
    <span class='comment val'>#</span>
    <span class='comment val'># All your other stuff</span>
    <span class='comment val'>#</span>
    <span class='has identifier id'>has</span> <span class='symbol val'>:created_at</span>
  <span class='end end kw'>end</span>
</pre>
<p>
When you need to fire off your search, it&#8217;ll go something to the tune
of
</p>
<pre class="code">
  <span class='Fruit constant id'>Fruit</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;apricot&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:group_function</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:day</span><span class='comma token'>,</span> <span class='symbol val'>:group_by</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'created_at'</span>
</pre>
<p>
The <tt>@groupby</tt> special attribute will contain the date for that
group. Depending on the <tt>:group_function</tt> parameter, the date format
will be
</p>
<ul>
<li><tt>:day</tt> - YYYYMMDD

</li>
<li><tt>:week</tt> - YYYYNNN (NNN is the first day of the week in question,
counting from the start of the year )

</li>
<li><tt>:month</tt> - YYYYMM

</li>
<li><tt>:year</tt> - YYYY

</li>
</ul>
<h3>Grouping by attribute</h3>
<p>
The syntax is the same as grouping by timestamp, except for the fact that
the <tt>:group_function</tt> parameter is changed
</p>
<pre class="code">
  <span class='Fruit constant id'>Fruit</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;apricot&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:group_function</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:attr</span><span class='comma token'>,</span> <span class='symbol val'>:group_by</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'size'</span>
</pre>
<h2>Geo/Location Searching</h2>
<p>
Sphinx - and therefore Thinking Sphinx - has the facility to search around
a geographical point, using a given latitude and longitude. To take
advantage of this, you will need to have both of those values in
attributes. To search with that point, you can then use one of the
following syntax examples:
</p>
<pre class="code">
  <span class='Address constant id'>Address</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;Melbourne&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:geo</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='float val'>1.4</span><span class='comma token'>,</span> <span class='float val'>-2.217</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;@geodist asc&quot;</span>
  <span class='Address constant id'>Address</span><span class='dot token'>.</span><span class='search identifier id'>search</span> <span class='string val'>&quot;Australia&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:geo</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>-0</span><span class='integer val'>.55</span><span class='comma token'>,</span> <span class='float val'>3.108</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;@geodist asc&quot;</span>
    <span class='symbol val'>:latitude_attr</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;latit&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:longitude_attr</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;longit&quot;</span>
</pre>
<p>
The first example applies when your latitude and longitude attributes are
named any of lat, latitude, lon, long or longitude. If that&#8217;s not the
case, you will need to explicitly state them in your search, <em>or</em>
you can do so in your model:
</p>
<pre class="code">
  <span class='define_index identifier id'>define_index</span> <span class='do do kw'>do</span>
    <span class='has identifier id'>has</span> <span class='symbol val'>:latit</span>  <span class='comment val'># Float column, stored in radians</span>
    <span class='has identifier id'>has</span> <span class='symbol val'>:longit</span> <span class='comment val'># Float column, stored in radians</span>

    <span class='set_property identifier id'>set_property</span> <span class='symbol val'>:latitude_attr</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;latit&quot;</span>
    <span class='set_property identifier id'>set_property</span> <span class='symbol val'>:longitude_attr</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;longit&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Now, geo-location searching really only has an affect if you have a filter,
sort or grouping clause related to it - otherwise it&#8217;s just a normal
search, and _will not_ return a distance value otherwise. To make use of
the positioning difference, use the special attribute &quot;@geodist&quot;
in any of your filters or sorting or grouping clauses.
</p>
<p>
And don&#8217;t forget - both the latitude and longitude you use in your
search, and the values in your indexes, need to be stored as a float in
radians, <em>not</em> degrees. Keep in mind that if you do this conversion
in SQL you will need to explicitly declare a column type of :float.
</p>
<pre class="code">
  <span class='define_index identifier id'>define_index</span> <span class='do do kw'>do</span>
    <span class='has identifier id'>has</span> <span class='string val'>'RADIANS(lat)'</span><span class='comma token'>,</span> <span class='symbol val'>:as</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:lat</span><span class='comma token'>,</span>  <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:float</span>
    <span class='comment val'># ...</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Once you&#8217;ve got your results set, you can access the distances as
follows:
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thinking_sphinx/search.rb', line 359</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c/lib/thinking_sphinx/search.rb#L359">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">359
360
361
362
363
364
365
366
367
368
369
370
371
372
373</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>  <span class='comment val'># an array</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span>
  
  <span class='retry_search_on_stale_index identifier id'>retry_search_on_stale_index</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='results identifier id'>results</span><span class='comma token'>,</span> <span class='client identifier id'>client</span> <span class='assign token'>=</span> <span class='search_results identifier id'>search_results</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='query identifier id'>query</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span><span class='options identifier id'>options</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    
    <span class='log identifier id'>log</span> <span class='dstring node'>&quot;Sphinx Error: #{results[:error]}&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:error</span> <span class='if if_mod kw'>if</span> <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='symbol val'>:error</span><span class='rbrack token'>]</span>
  
    <span class='klass identifier id'>klass</span>   <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:class</span><span class='rbrack token'>]</span>
    <span class='page identifier id'>page</span>    <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='colon op'>:</span> <span class='integer val'>1</span>
  
    <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='create_from_results identifier id'>create_from_results</span><span class='lparen token'>(</span><span class='results identifier id'>results</span><span class='comma token'>,</span> <span class='page identifier id'>page</span><span class='comma token'>,</span> <span class='client identifier id'>client</span><span class='dot token'>.</span><span class='limit identifier id'>limit</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>search_for_id</h3>
</div><div id="search_for_id-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>search_for_id</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks if a document with the given id exists within a specific index.
Expected parameters:
</p>
<ul>
<li>ID of the document

</li>
<li>Index to check within

</li>
<li>Options hash (defaults to {})

</li>
</ul>
<p>
Example:
</p>
<pre class="code">
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='search_for_id identifier id'>search_for_id</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='comma token'>,</span> <span class='string val'>&quot;user_core&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:class</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='User constant id'>User</span><span class='rparen token'>)</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thinking_sphinx/search.rb', line 423</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c/lib/thinking_sphinx/search.rb#L423">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='search_for_id identifier id'>search_for_id</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span>
  <span class='client identifier id'>client</span>  <span class='assign token'>=</span> <span class='client_from_options identifier id'>client_from_options</span> <span class='options identifier id'>options</span>
  
  <span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='filters identifier id'>filters</span>    <span class='assign token'>=</span> <span class='search_conditions identifier id'>search_conditions</span><span class='lparen token'>(</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:class</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:conditions</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='rparen token'>)</span>
  <span class='client identifier id'>client</span><span class='dot token'>.</span><span class='filters identifier id'>filters</span>   <span class='opasgn op'>+=</span> <span class='filters identifier id'>filters</span>
  <span class='client identifier id'>client</span><span class='dot token'>.</span><span class='match_mode identifier id'>match_mode</span> <span class='assign token'>=</span> <span class='symbol val'>:extended</span> <span class='unless unless_mod kw'>unless</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='client identifier id'>client</span><span class='dot token'>.</span><span class='id_range identifier id'>id_range</span>   <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot2 op'>..</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  
  <span class='begin begin kw'>begin</span>
    <span class='return return kw'>return</span> <span class='client identifier id'>client</span><span class='dot token'>.</span><span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='symbol val'>:matches</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='ECONNREFUSED constant id'>ECONNREFUSED</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
    <span class='raise identifier id'>raise</span> <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='ConnectionError constant id'>ConnectionError</span><span class='comma token'>,</span> <span class='string val'>&quot;Connection to Sphinx Daemon (searchd) failed.&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>search_for_ids</h3>
</div><div id="search_for_ids-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>search_for_ids</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Searches for results that match the parameters provided. Will only return
the ids for the matching objects. See #search for syntax examples.
</p>
<p>
Note that this only searches the Sphinx index, with no ActiveRecord
queries. Thus, if your index is not in sync with the database, this method
may return ids that no longer exist there.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thinking_sphinx/search.rb', line 28</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/freelancing-god/thinking-sphinx/blob/cb770957280c312b7a92e3cb23194bbc35cba31c/lib/thinking_sphinx/search.rb#L28">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">28
29
30
31
32
33
34
35</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='search_for_ids identifier id'>search_for_ids</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='results identifier id'>results</span><span class='comma token'>,</span> <span class='client identifier id'>client</span> <span class='assign token'>=</span> <span class='search_results identifier id'>search_results</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span><span class='rparen token'>)</span>
  
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span>
  <span class='page identifier id'>page</span>    <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='colon op'>:</span> <span class='integer val'>1</span>
  
  <span class='ThinkingSphinx constant id'>ThinkingSphinx</span><span class='colon2 op'>::</span><span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='ids_from_results identifier id'>ids_from_results</span><span class='lparen token'>(</span><span class='results identifier id'>results</span><span class='comma token'>,</span> <span class='page identifier id'>page</span><span class='comma token'>,</span> <span class='client identifier id'>client</span><span class='dot token'>.</span><span class='limit identifier id'>limit</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>