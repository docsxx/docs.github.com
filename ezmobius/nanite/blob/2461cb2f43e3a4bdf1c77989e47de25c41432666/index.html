<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>ezmobius's nanite - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/ezmobius/commits/nanite/master" rel="alternate" title="Recent Commits to nanite:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("ezmobius", "nanite", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='ezmobius/nanite/blob/2461cb2f43e3a4bdf1c77989e47de25c41432666' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='ezmobius/nanite/blob/2461cb2f43e3a4bdf1c77989e47de25c41432666' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("ezmobius", "nanite", "2461cb2f43e3a4bdf1c77989e47de25c41432666", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/ezmobius/nanite/tree/">Source</a></li>
            <li class=""><a href="http://github.com/ezmobius/nanite/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/ezmobius/nanite/network">Network</a></li>            
            <li class=""><a href="http://github.com/ezmobius/nanite/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/ezmobius/nanite">Wiki</a></li>
            <li class=""><a href="http://github.com/ezmobius/nanite/graphs">Graphs</a></li>                    
            <li class="active"><a href="/ezmobius/nanite">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/ezmobius">ezmobius</a> / <b><a href="http://github.com/ezmobius/nanite/tree">nanite</a></b>        
                <a id="namespaces_button" rel="ezmobius/nanite/blob/2461cb2f43e3a4bdf1c77989e47de25c41432666" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="ezmobius/nanite/blob/2461cb2f43e3a4bdf1c77989e47de25c41432666" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Nanite : A self-assembling fabric of Ruby daemons</h1>
<p>
Google Group: http://groups.google.com/group/nanite irc.freenode.net:
#nanite
</p>
<h2>Intro</h2>
<p>
Nanite is a new way of thinking about building cloud ready web
applications. Having a scalable message queueing back-end with all the
discovery and dynamic load based dispatch that Nanite has is a very
scalable way to construct web application back-ends.
</p>
<p>
A Nanite system has two types of components. There are nanite agents, these
are the daemons where you implement your code functionality as actors. And
then there are mappers.
</p>
<p>
Mappers are the control nodes of the system. There can be any number of
mappers, these typically run inside of your merb or rails app running on
the thin webserver (eventmachine is needed) but you can also run command
line mappers from the shell.
</p>
<p>
Each Nanite agent sends a ping to the mapper exchange every @ping_time
seconds. All of the mappers are subscribed to this exchange and they all
get a copy of the ping with your status update. If the mappers do not get a
ping from a certain agent within a timeout @ping_time the mappers will
remove that agent from any dispatch. When the agent comes back online or
gets less busy it will re-advertise itself to the mapper exchange therefore
adding itself back to the dispatch. This makes for a very nice self-healing
cluster of worker processes and a cluster of front-end mapper processes.
</p>
<p>
In your Nanites you can have any number of actor classes. These actors are
like controllers in Rails or Merb and this is where you implement your own
custom functionality. An actor looks like:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Foo constant id'>Foo</span>
    <span class='include identifier id'>include</span> <span class='Nanite constant id'>Nanite</span><span class='colon2 op'>::</span><span class='Actor constant id'>Actor</span>
    <span class='expose identifier id'>expose</span> <span class='symbol val'>:bar</span>
    <span class='def def kw'>def</span> <span class='bar identifier id'>bar</span><span class='lparen token'>(</span><span class='payload identifier id'>payload</span><span class='rparen token'>)</span>
      <span class='dstring node'>&quot;got payload: #{payload}&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='Nanite constant id'>Nanite</span><span class='colon2 op'>::</span><span class='Dispatcher constant id'>Dispatcher</span><span class='dot token'>.</span><span class='register identifier id'>register</span><span class='lparen token'>(</span><span class='Foo constant id'>Foo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span>
</pre>
<p>
The methods that you &#8216;expose&#8217; on the actors are advertised to
the mappers like:
</p>
<pre class="code">
  <span class='Foo constant id'>Foo</span><span class='comment val'>#bar   =&gt; /foo/bar</span>
  <span class='Mock constant id'>Mock</span><span class='comment val'>#list =&gt; /mock/list</span>
</pre>
<p>
Every agent advertises its status every time it pings the mapper cluster.
The default status that is advertised is the load average as a float. This
is used for the default request dispatching based on least loaded server.
</p>
<p>
You can change what is advertised as status to anything you want that is
comparable(&lt;=&gt;) by doing something like this in your agent&#8217;s
init.rb file:
</p>
<pre class="code">
  <span class='status_proc identifier id'>status_proc</span> <span class='assign token'>=</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span> <span class='MyApp constant id'>MyApp</span><span class='dot token'>.</span><span class='some_statistic_indicating_load identifier id'>some_statistic_indicating_load</span> <span class='rbrace token'>}</span>
</pre>
<p>
This proc will be recalled every @ping_time and sent to the mappers.
</p>
<p>
This is the &#8216;fitness function&#8217; for selecting the least loaded
Nanite. You can dream up any scheme of populating this function so the
mappers can select the right Nanites based on their status.
</p>
<h2>A quick note about security:</h2>
<p>
Nanite security is based upon RabbitMQ vhosts so anything attached to one
vhost can talk to anything else on the same vhost. So you generally want
one vhost per app space.
</p>
<h2>Installation</h2>
<p>
Nanite has a lot of moving parts. Follow the directions below and
we&#8217;ll get you up and running in no-time.
</p>
<h3>Install Erlang (OS X)</h3>
<p>
See the Erlang website for the latest info :
http://www.erlang.org/download.html
</p>
<p>
In your chosen source dir which we&#8217;ll refer to as &lt;SRC&gt;:
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='lt op'>&lt;</span><span class='SRC constant id'>SRC</span><span class='gt op'>&gt;</span>
  <span class='wget identifier id'>wget</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.erlang.org/</span><span class='download identifier id'>download</span><span class='div op'>/</span><span class='otp_src_R12B identifier id'>otp_src_R12B</span><span class='minus op'>-</span><span class='float val'>5</span><span class='dot token'>.</span><span class='tar identifier id'>tar</span><span class='dot token'>.</span><span class='gz identifier id'>gz</span>
  <span class='tar identifier id'>tar</span> <span class='minus op'>-</span><span class='zxvf identifier id'>zxvf</span> <span class='otp_src_R12B identifier id'>otp_src_R12B</span><span class='minus op'>-</span><span class='float val'>5</span><span class='dot token'>.</span><span class='tar identifier id'>tar</span><span class='dot token'>.</span><span class='gz identifier id'>gz</span>
  <span class='cd identifier id'>cd</span> <span class='otp_src_R12B identifier id'>otp_src_R12B</span><span class='minus op'>-</span><span class='integer val'>5</span>
  <span class='dot token'>.</span><span class='div op'>/</span><span class='configure identifier id'>configure</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='enable identifier id'>enable</span><span class='minus op'>-</span><span class='hipe identifier id'>hipe</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='enable identifier id'>enable</span><span class='minus op'>-</span><span class='darwin identifier id'>darwin</span><span class='minus op'>-</span><span class='universal identifier id'>universal</span>
  <span class='make identifier id'>make</span>
  <span class='sudo identifier id'>sudo</span> <span class='make identifier id'>make</span> <span class='install identifier id'>install</span>
</pre>
<h3>Install Erlang (Linux .deb)</h3>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='apt identifier id'>apt</span><span class='minus op'>-</span><span class='get identifier id'>get</span> <span class='install identifier id'>install</span> <span class='erlang identifier id'>erlang</span><span class='minus op'>-</span><span class='nox identifier id'>nox</span>
</pre>
<h3>Install Nanite Ruby Gem</h3>
<p>
Installing the gem gives us access to the various Nanite commands in the
default binary path.
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='lt op'>&lt;</span><span class='SRC constant id'>SRC</span><span class='gt op'>&gt;</span>
  <span class='git identifier id'>git</span> <span class='clone identifier id'>clone</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/e</span><span class='zmobius identifier id'>zmobius</span><span class='div op'>/</span><span class='nanite identifier id'>nanite</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
  <span class='cd identifier id'>cd</span> <span class='nanite identifier id'>nanite</span>
  <span class='rake identifier id'>rake</span> <span class='gem identifier id'>gem</span>
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='pkg identifier id'>pkg</span><span class='div op'>/</span><span class='nanite identifier id'>nanite</span><span class='minus op'>-</span><span class='lt op'>&lt;</span><span class='VERSION constant id'>VERSION</span><span class='gt op'>&gt;</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span>
</pre>
<h3>Install EventMachine Ruby Gem</h3>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='eventmachine identifier id'>eventmachine</span>
</pre>
<h3>Install AMQP Ruby Gem</h3>
<pre class="code">
  <span class='comment val'># install version &gt;= 0.6.0 from RubyForge</span>
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='amqp identifier id'>amqp</span>

  <span class='comment val'># or install from source</span>
  <span class='cd identifier id'>cd</span> <span class='lt op'>&lt;</span><span class='SRC constant id'>SRC</span><span class='gt op'>&gt;</span>
  <span class='git identifier id'>git</span> <span class='clone identifier id'>clone</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='tmm1 identifier id'>tmm1</span><span class='div op'>/</span><span class='amqp identifier id'>amqp</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
  <span class='cd identifier id'>cd</span> <span class='amqp identifier id'>amqp</span> <span class='andop op'>&amp;&amp;</span> <span class='rake identifier id'>rake</span> <span class='gem identifier id'>gem</span> <span class='andop op'>&amp;&amp;</span> <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='amqp identifier id'>amqp</span><span class='minus op'>-</span><span class='lt op'>&lt;</span><span class='VERSION constant id'>VERSION</span><span class='gt op'>&gt;</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span>
</pre>
<h3>Install RabbitMQ from source tarball (OS X and generic Linux)</h3>
<p>
In short, you&#8217;ll need a working erlang installation, python, and
simplejson. If your python (&quot;python -V&quot;) is 2.6, simplejson is
included in your distribution. Otherwise, install simplejson:
</p>
<pre class="code">
  <span class='easy_install identifier id'>easy_install</span> <span class='simplejson identifier id'>simplejson</span>
</pre>
<p>
If you don&#8217;t have easy_install, install setuptools from
http://pypi.python.org/pypi/setuptools:
</p>
<pre class="code">
  <span class='comment val'># Get the latest .egg file for your version of python (&quot;python -V&quot;), then run it:</span>
  <span class='wget identifier id'>wget</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/pypi.python.org/</span><span class='packages identifier id'>packages</span><span class='div op'>/</span><span class='float val'>2.5</span><span class='div op'>/</span><span class='s identifier id'>s</span><span class='div op'>/</span><span class='setuptools identifier id'>setuptools</span><span class='div op'>/</span><span class='setuptools identifier id'>setuptools</span><span class='minus op'>-</span><span class='integer val'>0</span><span class='integer val'>.6</span><span class='c9 identifier id'>c9</span><span class='minus op'>-</span><span class='py2 identifier id'>py2</span><span class='float val'>.5</span><span class='dot token'>.</span><span class='egg identifier id'>egg</span>
  <span class='sh identifier id'>sh</span> <span class='setuptools identifier id'>setuptools</span><span class='minus op'>-</span><span class='integer val'>0</span><span class='integer val'>.6</span><span class='c9 identifier id'>c9</span><span class='minus op'>-</span><span class='py2 identifier id'>py2</span><span class='float val'>.5</span><span class='dot token'>.</span><span class='egg identifier id'>egg</span>
</pre>
<p>
and install simplejson, which is needed for the &quot;make&quot; step
below.
</p>
<p>
These instructions assume the latest RabbitMQ release 1.5.3:
</p>
<pre class="code">
  <span class='comment val'># Download somewhere</span>
  <span class='cd identifier id'>cd</span> <span class='regexp val'>/root
  wget http:/</span><span class='div op'>/</span><span class='www identifier id'>www</span><span class='dot token'>.</span><span class='rabbitmq identifier id'>rabbitmq</span><span class='dot token'>.</span><span class='com identifier id'>com</span><span class='div op'>/</span><span class='releases identifier id'>releases</span><span class='div op'>/</span><span class='rabbitmq identifier id'>rabbitmq</span><span class='minus op'>-</span><span class='server identifier id'>server</span><span class='div op'>/</span><span class='v1 identifier id'>v1</span><span class='float val'>.5.3</span><span class='div op'>/</span><span class='rabbitmq identifier id'>rabbitmq</span><span class='minus op'>-</span><span class='server identifier id'>server</span><span class='minus op'>-</span><span class='float val'>1.5</span><span class='float val'>.3</span><span class='dot token'>.</span><span class='tar identifier id'>tar</span><span class='dot token'>.</span><span class='gz identifier id'>gz</span>

  <span class='comment val'># Go to your erlang lib directory, usually /usr/lib/erlang/lib or:</span>
  <span class='cd identifier id'>cd</span> <span class='regexp val'>/usr/</span><span class='local identifier id'>local</span><span class='div op'>/</span><span class='lib identifier id'>lib</span><span class='div op'>/</span><span class='erlang identifier id'>erlang</span><span class='div op'>/</span><span class='lib identifier id'>lib</span>

  <span class='tar identifier id'>tar</span> <span class='minus op'>-</span><span class='zxf identifier id'>zxf</span> <span class='bitnot op'>~</span><span class='regexp val'>/rabbitmq-server-1.5.3.tar.gz
  cd rabbitmq-server-1.5.3
  make

  # There is no &quot;make install&quot; phase.
</span></pre>
<p>
Be sure to add the /usr/local/lib/erlang/lib/rabbitmq-server-1.5.3/scripts
to your $PATH.
</p>
<p>
The following websites may also be useful:
</p>
<ul>
<li>RabbitMQ website for the latest info :
http://www.rabbitmq.com/download.html

</li>
<li>RabbitMQ server source download : http://www.rabbitmq.com/server.html

</li>
<li>RabbitMQ build instructions : http://www.rabbitmq.com/build-server.html

</li>
<li>RabbitMQ install instructions : http://www.rabbitmq.com/install.html

</li>
</ul>
<h3>Install RabbitMQ (Linux .deb)</h3>
<pre class="code">
  <span class='wget identifier id'>wget</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.rabbitmq.com/</span><span class='releases identifier id'>releases</span><span class='div op'>/</span><span class='rabbitmq identifier id'>rabbitmq</span><span class='minus op'>-</span><span class='server identifier id'>server</span><span class='div op'>/</span><span class='v1 identifier id'>v1</span><span class='float val'>.5.3</span><span class='div op'>/</span><span class='rabbitmq identifier id'>rabbitmq</span><span class='minus op'>-</span><span class='server_1 identifier id'>server_1</span><span class='float val'>.5.3</span><span class='minus op'>-</span><span class='integer val'>1_</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='deb identifier id'>deb</span>
  <span class='sudo identifier id'>sudo</span> <span class='apt identifier id'>apt</span><span class='minus op'>-</span><span class='get identifier id'>get</span> <span class='install identifier id'>install</span> <span class='logrotate identifier id'>logrotate</span>
  <span class='sudo identifier id'>sudo</span> <span class='dpkg identifier id'>dpkg</span> <span class='minus op'>-</span><span class='i identifier id'>i</span> <span class='rabbitmq identifier id'>rabbitmq</span><span class='minus op'>-</span><span class='server_1 identifier id'>server_1</span><span class='float val'>.5.3</span><span class='minus op'>-</span><span class='integer val'>1_</span><span class='all identifier id'>all</span><span class='dot token'>.</span><span class='deb identifier id'>deb</span>
</pre>
<h2>Test your installation</h2>
<h3>Test your Erlang install</h3>
<p>
Start an Erlang shell
</p>
<pre class="code">
  <span class='erl identifier id'>erl</span>
</pre>
<p>
Enter the following commands in the Erlang shell (When installed correctly
each should print a great deal of erlang config info):
</p>
<pre class="code">
  <span class='rabbit identifier id'>rabbit</span><span class='symbol val'>:module_info</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='dot token'>.</span>
</pre>
<p>
Exit the Erlang shell with the following command (or Ctrl-c):
</p>
<pre class="code">
  <span class='q identifier id'>q</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='dot token'>.</span>
</pre>
<h3>Start RabbitMQ</h3>
<p>
All directories will be automatically set up on first run.
</p>
<p>
To run RabbitMQ in the foreground:
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='rabbitmq identifier id'>rabbitmq</span><span class='minus op'>-</span><span class='server identifier id'>server</span>
</pre>
<p>
To run RabbitMQ in the background:
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='rabbitmq identifier id'>rabbitmq</span><span class='minus op'>-</span><span class='server identifier id'>server</span> <span class='minus op'>-</span><span class='detached identifier id'>detached</span>
</pre>
<p>
To check status:
</p>
<pre class="code">
  <span class='rabbitmqctl identifier id'>rabbitmqctl</span> <span class='status identifier id'>status</span>
</pre>
<p>
To stop server:
</p>
<pre class="code">
  <span class='rabbitmqctl identifier id'>rabbitmqctl</span> <span class='stop identifier id'>stop</span>
</pre>
<p>
You can learn more about RabbitMQ admin here:
http://www.rabbitmq.com/admin-guide.html
</p>
<h3>Test Ruby/EventMachine/AMQP end-to-end with a running RabbitMQ instance</h3>
<p>
You can test that all the moving parts are working end-to-end by running
one of the AMQP example programs. There are a number of example tests
provided with AMQP but the one we will try simply queues and prints two
messages immediately, and another one five seconds later.
</p>
<pre class="code">
  <span class='comment val'># this test can only be run if you made a local clone</span>
  <span class='comment val'># of the amqp repository during the amqp installation above</span>
  <span class='comment val'># (it does not matter however if the gem was installed from src or rubyforge)</span>
  <span class='cd identifier id'>cd</span> <span class='lt op'>&lt;</span><span class='SRC constant id'>SRC</span><span class='gt op'>&gt;</span><span class='regexp val'>/amqp
  ruby examples/</span><span class='mq identifier id'>mq</span><span class='div op'>/</span><span class='simple identifier id'>simple</span><span class='minus op'>-</span><span class='get identifier id'>get</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<h3>Test Nanite (finally)</h3>
<p>
First we&#8217;ll do a little setup and run a script which adds an agent
account (nanite), a mapper account (mapper) and a &#8217;/nanite&#8217;
vhost to RabbitMQ. RabbitMQ broker must of course be running before you run
this script.
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='nanite identifier id'>nanite</span>
  <span class='dot token'>.</span><span class='div op'>/</span><span class='examples identifier id'>examples</span><span class='div op'>/</span><span class='rabbitconf identifier id'>rabbitconf</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
Now lets run a few agents. Each of these is a long running process and
needs to run in its own shell. Each agent also needs its own unique
identity, or token to differentiate it from the other running agents. You
can try opening a couple of them now if you like. The agents will generally
provide no output when running. You can always get more help about the
nanite command with &#8216;nanite --help&#8217;.
</p>
<p>
First shell
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='examples identifier id'>examples</span><span class='div op'>/</span><span class='simpleagent identifier id'>simpleagent</span>
  <span class='nanite identifier id'>nanite</span><span class='minus op'>-</span><span class='agent identifier id'>agent</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='token identifier id'>token</span> <span class='fred identifier id'>fred</span>
</pre>
<p>
Second shell
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='examples identifier id'>examples</span><span class='div op'>/</span><span class='simpleagent identifier id'>simpleagent</span>
  <span class='nanite identifier id'>nanite</span><span class='minus op'>-</span><span class='agent identifier id'>agent</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='token identifier id'>token</span> <span class='bob identifier id'>bob</span>
</pre>
<p>
Now run a mapper. Mappers can be run from within your Merb or Rails app,
from an interactive irb shell, or from the command line. For this example
we&#8217;ll run it from the command line so open a third shell window and
run the following:
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='examples identifier id'>examples</span><span class='div op'>/</span><span class='simpleagent identifier id'>simpleagent</span>
  <span class='dot token'>.</span><span class='div op'>/</span><span class='cli identifier id'>cli</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
Which should soon return something like the following.
</p>
<pre class="code">
  <span class='lbrace token'>{</span><span class='string val'>&quot;bob&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;hello nanite&quot;</span><span class='rbrace token'>}</span>                                 <span class='comment val'># where the '--token bob' parameter was passed</span>
  <span class='lbrace token'>{</span><span class='string val'>&quot;55a7f300c454203eacc218b6fbd2edc6&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;hello nanite&quot;</span><span class='rbrace token'>}</span>    <span class='comment val'># where no '--token' was passed.  auto-generated identity.</span>
</pre>
<p>
Now if you want to make this interesting, you can issue a Ctrl-c in one of
the agent&#8217;s windows to kill it. And then run cli.rb again. You should
see that you still get a result back since the mapper is finding the
remaining agent to do its work.
</p>
<p>
If you want to try requesting work to be done by an agent from an
interactive command shell try the following. This assumes that you have the
agents running as indicated in the example above (&#8217;&gt;&gt;&#8217; is
the nanite shell prompt).
</p>
<pre class="code">
  <span class='cd identifier id'>cd</span> <span class='nanite identifier id'>nanite</span>
  <span class='dot token'>.</span><span class='div op'>/</span><span class='bin identifier id'>bin</span><span class='div op'>/</span><span class='nanite identifier id'>nanite</span><span class='minus op'>-</span><span class='mapper identifier id'>mapper</span> <span class='minus op'>-</span><span class='i identifier id'>i</span> <span class='minus op'>-</span><span class='u identifier id'>u</span> <span class='mapper identifier id'>mapper</span> <span class='minus op'>-</span><span class='p identifier id'>p</span> <span class='testing identifier id'>testing</span> <span class='minus op'>-</span><span class='v identifier id'>v</span> <span class='regexp val'>/nanite
  Starting mapper console
  &gt;&gt; request('/s</span><span class='imple identifier id'>imple</span><span class='div op'>/</span><span class='echo identifier id'>echo</span><span class='string val'>') {|res| p res }
</span></pre>
<p>
By default this will dispatch to the agent with the lowest reported load
average.
</p>
<p>
There are a few other selectors as well:
</p>
<pre class="code">
  <span class='comment val'># run this request on *all* agents that expose the /foo/bar Foo#bar actor</span>
  <span class='rshft op'>&gt;&gt;</span> <span class='request identifier id'>request</span><span class='lparen token'>(</span><span class='string val'>'/foo/bar'</span><span class='comma token'>,</span> <span class='string val'>'hi'</span><span class='comma token'>,</span> <span class='symbol val'>:selector</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:all</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='res identifier id'>res</span><span class='bitor op'>|</span> <span class='p identifier id'>p</span> <span class='res identifier id'>res</span> <span class='rbrace token'>}</span>

  <span class='comment val'># run this request on one random agent that expose the /whatever/hello Whatever#hello actor</span>
  <span class='rshft op'>&gt;&gt;</span> <span class='request identifier id'>request</span><span class='lparen token'>(</span><span class='string val'>'/whatever/hello'</span><span class='comma token'>,</span> <span class='integer val'>42</span><span class='comma token'>,</span> <span class='symbol val'>:selector</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:random</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='res identifier id'>res</span><span class='bitor op'>|</span> <span class='p identifier id'>p</span> <span class='res identifier id'>res</span> <span class='rbrace token'>}</span>
</pre>
<p>
You can create your own selectors based on arbitrary stuff you put in
status from your agents see cluster.rb for examples of how least_loaded,
all and random are implemented.
</p>
<p>
You can run as many mappers as you want, they will all be hot masters.
</p>
<p>
The calls are asynchronous. This means the block you pass to
Nanite::Agent#request is not run until the response from the agent(s) have
returned. So keep that in mind. Should you need to poll from an ajax web
app for results you should have your block stuff the results in the
database for any web front end to pick up with the next poll.
</p>
<p>
Another option to test your agents is to use nanite-admin
</p>
<pre class="code">
  $ <span class='nanite identifier id'>nanite</span><span class='minus op'>-</span><span class='admin identifier id'>admin</span>
  <span class='starting identifier id'>starting</span> <span class='nanite identifier id'>nanite</span><span class='minus op'>-</span><span class='admin identifier id'>admin</span>
  <span class='rshft op'>&gt;&gt;</span> <span class='Thin constant id'>Thin</span> <span class='web identifier id'>web</span> <span class='server identifier id'>server</span> <span class='lparen token'>(</span><span class='v1 identifier id'>v1</span><span class='float val'>.0.1</span> <span class='codename identifier id'>codename</span> <span class='question op'>?</span><span class='rparen token'>)</span>
  <span class='rshft op'>&gt;&gt;</span> <span class='Maximum constant id'>Maximum</span> <span class='connections identifier id'>connections</span> <span class='set identifier id'>set</span> <span class='to identifier id'>to</span> <span class='integer val'>1024</span>
  <span class='rshft op'>&gt;&gt;</span> <span class='Listening constant id'>Listening</span> <span class='on identifier id'>on</span> <span class='integer val'>0</span><span class='float val'>.0.0</span><span class='integer val'>.0</span><span class='symbol val'>:4000</span><span class='comma token'>,</span> <span class='CTRL constant id'>CTRL</span><span class='plus op'>+</span><span class='C constant id'>C</span> <span class='to identifier id'>to</span> <span class='stop identifier id'>stop</span>
</pre>
<p>
and bring up the Nanite Control Tower at http://localhost:4000 .
</p>
<p>
Have fun!
</p>
<h2>Web Framework Integration</h2>
<p>
The integration of Nanite into web frameworks depends on the web server
running our application and, more importantly, if it uses EventMachine or
not.
</p>
<p>
Thin is EventMachine-based, so we only need to make sure that the
EventMachine reactor is already &#8216;heated&#8217; up
</p>
<pre class="code">
  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span>
    <span class='until until kw'>until</span> <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='reactor_running? fid id'>reactor_running?</span>
      <span class='sleep identifier id'>sleep</span> <span class='integer val'>1</span>
    <span class='end end kw'>end</span>
    <span class='Nanite constant id'>Nanite</span><span class='dot token'>.</span><span class='start_mapper identifier id'>start_mapper</span><span class='lparen token'>(</span><span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'localhost'</span><span class='comma token'>,</span> <span class='symbol val'>:user</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'mapper'</span><span class='comma token'>,</span> <span class='symbol val'>:pass</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'testing'</span><span class='comma token'>,</span> <span class='symbol val'>:vhost</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'/nanite'</span><span class='comma token'>,</span> <span class='symbol val'>:log_level</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'info'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Mongrel on the other hand does not use EventMachine and therefore requires
to wrap the start of our mapper
</p>
<pre class="code">
  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span>
    <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='do do kw'>do</span>
      <span class='Nanite constant id'>Nanite</span><span class='dot token'>.</span><span class='start_mapper identifier id'>start_mapper</span><span class='lparen token'>(</span><span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'localhost'</span><span class='comma token'>,</span> <span class='symbol val'>:user</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'mapper'</span><span class='comma token'>,</span> <span class='symbol val'>:pass</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'testing'</span><span class='comma token'>,</span> <span class='symbol val'>:vhost</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'/nanite'</span><span class='comma token'>,</span> <span class='symbol val'>:log_level</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'info'</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Using nanite with Passenger:
</p>
<p>
if defined?(PhusionPassenger)
</p>
<pre class="code">
 <span class='PhusionPassenger constant id'>PhusionPassenger</span><span class='dot token'>.</span><span class='on_event identifier id'>on_event</span><span class='lparen token'>(</span><span class='symbol val'>:starting_worker_process</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='forked identifier id'>forked</span><span class='bitor op'>|</span>
   <span class='if if kw'>if</span> <span class='forked identifier id'>forked</span>
     <span class='if if kw'>if</span> <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='reactor_running? fid id'>reactor_running?</span>
       <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='stop_event_loop identifier id'>stop_event_loop</span>
       <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='release_machine identifier id'>release_machine</span>
       <span class='EM constant id'>EM</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span> <span class='string val'>'@reactor_running'</span><span class='comma token'>,</span> <span class='false false kw'>false</span> <span class='rparen token'>)</span>
     <span class='end end kw'>end</span>
     <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:mq</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
     <span class='AMQP constant id'>AMQP</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='string val'>'@conn'</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
   <span class='end end kw'>end</span>

   <span class='th identifier id'>th</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span>
   <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lbrace token'>{</span>
     <span class='Nanite constant id'>Nanite</span><span class='dot token'>.</span><span class='start_mapper identifier id'>start_mapper</span><span class='lparen token'>(</span><span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'localhost'</span><span class='comma token'>,</span> <span class='symbol val'>:user</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'mapper'</span><span class='comma token'>,</span> <span class='symbol val'>:pass</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'testing'</span><span class='comma token'>,</span> <span class='symbol val'>:vhost</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'/nanite'</span><span class='comma token'>,</span> <span class='symbol val'>:log_level</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'info'</span><span class='rparen token'>)</span>
   <span class='rbrace token'>}</span>
   <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='stop identifier id'>stop</span>
 <span class='end end kw'>end</span>
</pre>
<p>
end
</p>
<h6>=</h6>
<p>
Where to put the mapper initialization code depends on the framework and
our preference. For Rails the canonical place to start our mapper is within
nanite.rb (or any other filename you prefer) in config/initalizers. In Merb
we can use init.rb in config.
</p>
<h2>Security</h2>
<p>
Nanite implements a secure serializer which can be used in place of the
other serializers to encrypt the AMQP messages exchanged between the
mappers and the agents.
</p>
<p>
The secure serializer uses X.509 certificates and cryptographic keys to
sign and encrypt the messages.
</p>
<p>
It is important to understand that:
</p>
<ol>
<li>A certificate only includes the public key component of a cryptographic key
pair.

</li>
<li>Signing requires the use of a certificate and its private key, checking the
signature then only requires the certificate (the idea is that only the
signer has the secret private key and thus can sign but anyone can check
the signature).

</li>
<li>Encrypting only requires the certificate but decrypting also requires the
private key (anyone can encrypt the data but only the intended recipient
can decrypt it).

</li>
</ol>
<p>
A signing serializer thus needs access to the signer certificate and
private key. An encrypting serializer <b>also</b> needs access to the
intended recipients certificates. There needs to be a way to dynamically
retrieve the corresponding certificates. This is done using certificate
stores.
</p>
<p>
Certificate stores associate identities with certificates. The identity is
associated when the data is serialized and can be keyed off to retrieve the
right certificate upon deserialization.
</p>
<p>
Nanite provides a static store implementation which can be used when the
certificates used for serialization are always the same and can be kept in
memory. Nanite also provides a certificate store proxy cache which can be
associated with any store implementation and will cache the most used
certificates.
</p>
<p>
The serializer should be initialized prior to being used by calling the
&#8216;init&#8217; method:
</p>
<pre class="code">
  <span class='comment val'># Initialize serializer, must be called prior to using it.</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#  - 'identity':   Identity associated with serialized messages</span>
  <span class='comment val'>#  - 'cert':       Certificate used to sign serialized messages and</span>
  <span class='comment val'>#                  decrypt encrypted messages</span>
  <span class='comment val'>#  - 'key':        Private key corresponding to 'cert'</span>
  <span class='comment val'>#  - 'store':      Certificate store. Exposes certificates used for</span>
  <span class='comment val'>#                  encryption and signature validation.</span>
  <span class='comment val'>#  - 'encrypt':    Whether data should be signed and encrypted ('true')</span>
  <span class='comment val'>#                  or just signed ('false'), 'true' by default.</span>
  <span class='comment val'>#</span>
  <span class='def def kw'>def</span> <span class='SecureSerializer constant id'>SecureSerializer</span><span class='dot token'>.</span><span class='init identifier id'>init</span><span class='lparen token'>(</span><span class='identity identifier id'>identity</span><span class='comma token'>,</span> <span class='cert identifier id'>cert</span><span class='comma token'>,</span> <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='store identifier id'>store</span><span class='comma token'>,</span> <span class='encrypt identifier id'>encrypt</span> <span class='assign token'>=</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
</pre>
<p>
The &#8216;secure&#8217; agent example (examples\secure) shows how the
mappers and agents should be configured to use the secure serializer.
</p>
<h2>Troubleshooting</h2>
<p>
** IMPORTANT ** If you are using Apple&#8217;s built in Ruby that comes
with Leopard (10.5.x) or Tiger (10.4.x) then your READLINE lib is hosed and
the interactive shell will not work. As soon as you drop into a shell
Apple&#8217;s fakey READLINE will halt the event machine loop so you
won&#8217;t see any nanites registering. I don&#8217;t have a good
workaround except to tell you not to use Apple&#8217;s Ruby, build your own
or use ports.
</p>
<p>
** What to do if rabbitconf.rb dies with: <tt>badrpc,nodedown</tt> and nothing you
do seems to matter **
</p>
<p>
If rabbitconf.rb dies saying &quot;{badrpc,nodedown}&quot; it means that
for some reason, the rabbitmqctl program rabbitconf.rb is using to setup
the agent accounts for nanite is not able to connect to your RabbitMQ
server. Assuming RabbitMQ is running and is known to work (try the examples
that come with the amqp library), then there&#8217;s a chance something is
going wrong with using short node names in your Erlang install.
</p>
<p>
The easiest way to verify it is by starting two separate Erlang shells like
this (note that &quot;odin&quot; is my hostname):
</p>
<pre class="code">
  $ <span class='erl identifier id'>erl</span> <span class='minus op'>-</span><span class='sname identifier id'>sname</span> <span class='fred identifier id'>fred</span>
  <span class='lparen token'>(</span><span class='fred identifier id'>fred</span><span class='@odin ivar id'>@odin</span><span class='rparen token'>)</span><span class='integer val'>1</span><span class='gt op'>&gt;</span>

  $ <span class='erl identifier id'>erl</span> <span class='minus op'>-</span><span class='sname identifier id'>sname</span> <span class='bob identifier id'>bob</span>
  <span class='lparen token'>(</span><span class='bob identifier id'>bob</span><span class='@odin ivar id'>@odin</span><span class='rparen token'>)</span><span class='integer val'>1</span><span class='gt op'>&gt;</span>
</pre>
<p>
And then trying to &#8216;ping&#8217; one from the other. In the
&#8216;fred&#8217; node you can do that like this:
</p>
<pre class="code">
  <span class='lparen token'>(</span><span class='fred identifier id'>fred</span><span class='@odin ivar id'>@odin</span><span class='rparen token'>)</span><span class='integer val'>1</span><span class='gt op'>&gt;</span> <span class='net_adm identifier id'>net_adm</span><span class='symbol val'>:ping</span><span class='lparen token'>(</span><span class='bob identifier id'>bob</span><span class='@odin ivar id'>@odin</span><span class='rparen token'>)</span><span class='dot token'>.</span>
  <span class='pang identifier id'>pang</span>
</pre>
<p>
Note : If your hostname has a hyphen in it (e.g. macbook-pro) you should
include the user@hostname in quotes like:
</p>
<pre class="code">
  <span class='net_adm identifier id'>net_adm</span><span class='symbol val'>:ping</span><span class='lparen token'>(</span><span class='string val'>'bob@macbook-pro'</span><span class='rparen token'>)</span><span class='dot token'>.</span>
</pre>
<p>
If you see &#8216;pang&#8217; (which is apparently Swedish for something
like &quot;crap! it&#8217;s broken.&quot;) then short name distribution
isn&#8217;t working for you, and you need to fall back to using a full
name. If you see &#8216;pong&#8217;, then that&#8217;s not actually your
problem.
</p>
<p>
First, verify that your system&#8217;s hostname is set to a fully qualified
domain name. On OS X it can end in &#8217;.local&#8217;:
</p>
<pre class="code">
  <span class='hostname identifier id'>hostname</span>
  <span class='odin identifier id'>odin</span><span class='dot token'>.</span><span class='local identifier id'>local</span>
</pre>
<p>
Then test that <b>this</b> will work by starting a node with the full name
of &#8216;fred@&lt;your hostname&gt;&#8217;:
</p>
<pre class="code">
  <span class='erl identifier id'>erl</span> <span class='minus op'>-</span><span class='name identifier id'>name</span> <span class='fred identifier id'>fred</span><span class='@odin ivar id'>@odin</span><span class='dot token'>.</span><span class='local identifier id'>local</span>
  <span class='lparen token'>(</span><span class='fred identifier id'>fred</span><span class='@odin ivar id'>@odin</span><span class='dot token'>.</span><span class='local identifier id'>local</span><span class='rparen token'>)</span><span class='integer val'>1</span><span class='gt op'>&gt;</span>
</pre>
<p>
then bob@&lt;yourhostname&gt;, and then finally try to ping fred:
</p>
<pre class="code">
  <span class='erl identifier id'>erl</span> <span class='minus op'>-</span><span class='name identifier id'>name</span> <span class='bob identifier id'>bob</span><span class='@odin ivar id'>@odin</span><span class='dot token'>.</span><span class='local identifier id'>local</span>
  <span class='lparen token'>(</span><span class='bob identifier id'>bob</span><span class='@odin ivar id'>@odin</span><span class='dot token'>.</span><span class='local identifier id'>local</span><span class='rparen token'>)</span><span class='integer val'>1</span><span class='gt op'>&gt;</span> <span class='net_adm identifier id'>net_adm</span><span class='symbol val'>:ping</span><span class='lparen token'>(</span><span class='fred identifier id'>fred</span><span class='@odin ivar id'>@odin</span><span class='dot token'>.</span><span class='local identifier id'>local</span><span class='rparen token'>)</span><span class='dot token'>.</span>
  <span class='pong identifier id'>pong</span>
</pre>
<p>
In my case, it looks like that worked. Now&#8230; on to getting
rabbitconf.rb to run! To do that, you need to edit the
&#8216;rabbitmq-server&#8217; and &#8216;rabbitmqctl&#8217; scripts in your
RabbitMQ distribution and edit the -sname arguments to use -name and a full
name.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>