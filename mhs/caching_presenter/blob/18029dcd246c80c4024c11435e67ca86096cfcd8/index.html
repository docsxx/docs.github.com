<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>mhs's caching_presenter - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/mhs/commits/caching_presenter/master" rel="alternate" title="Recent Commits to caching_presenter:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("mhs", "caching_presenter", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='mhs/caching_presenter/blob/18029dcd246c80c4024c11435e67ca86096cfcd8' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='mhs/caching_presenter/blob/18029dcd246c80c4024c11435e67ca86096cfcd8' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("mhs", "caching_presenter", "18029dcd246c80c4024c11435e67ca86096cfcd8", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/mhs/caching_presenter/tree/">Source</a></li>
            <li class=""><a href="http://github.com/mhs/caching_presenter/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/mhs/caching_presenter/network">Network</a></li>            
            <li class=""><a href="http://github.com/mhs/caching_presenter/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/mhs/caching_presenter">Wiki</a></li>
            <li class=""><a href="http://github.com/mhs/caching_presenter/graphs">Graphs</a></li>                    
            <li class="active"><a href="/mhs/caching_presenter">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/mhs">mhs</a> / <b><a href="http://github.com/mhs/caching_presenter/tree">caching_presenter</a></b>        
                <a id="namespaces_button" rel="mhs/caching_presenter/blob/18029dcd246c80c4024c11435e67ca86096cfcd8" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="mhs/caching_presenter/blob/18029dcd246c80c4024c11435e67ca86096cfcd8" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>CachingPresenter - an implementation of the presenter pattern in Ruby</h1>
<h2>What is the presenter pattern?</h2>
<p>
The presenter pattern is a technique used to separate presentation logic
(aka display logic or view logic) from domain logic and from the view
templates themselves. There are a number of reasons this pattern is
beneficial when used:
</p>
<ul>
<li>it stops presentation logic from creeping into domain objects and muddying
up their implementation and their business logic

</li>
<li>it stops unnecessary logic from creeping into the views themselves which
should be as simple, flexible, and changeable as possible

</li>
<li>it allows you to organize presentation logic in better ways than simply
maintaining helper modules that are included everywhere

</li>
</ul>
<h2>Simple Example</h2>
<pre class="code">
  <span class='class class kw'>class</span> <span class='ProjectPresenter constant id'>ProjectPresenter</span> <span class='lt op'>&lt;</span> <span class='CachingPresenter constant id'>CachingPresenter</span>
    <span class='presents identifier id'>presents</span> <span class='symbol val'>:project</span>

    <span class='def def kw'>def</span> <span class='possible_managers identifier id'>possible_managers</span>
      <span class='if if kw'>if</span> <span class='@project ivar id'>@project</span><span class='dot token'>.</span><span class='top_secret? fid id'>top_secret?</span>
        <span class='User constant id'>User</span><span class='dot token'>.</span><span class='with_area_51_clearance identifier id'>with_area_51_clearance</span><span class='dot token'>.</span><span class='all identifier id'>all</span>
      <span class='else else kw'>else</span>
        <span class='User constant id'>User</span><span class='dot token'>.</span><span class='all identifier id'>all</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In this example, there is most likely a view template which displays a drop
down of possible managers for the project. When the project is top secret
then only users with Area 51 clearance will be selectable from the UI,
otherwise any user in the system will be selectable.
</p>
<p>
Without some form of a presenter this logic will either creep up in the
view template, be pushed down to a model, or be stuck in an application
object (like a Rails controller). None of those spots are a very good home
for this logic.
</p>
<p>
Now, let&#8217;s say we want to use the presenter in the view when
generating the form for creating a project. Here&#8217;s an example of what
they would look like using a Rails html.erb template:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>% form_for </span><span class='@project ivar id'>@project</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='string val'>%&gt;
    ...
    &lt;%= f.collection_select, :manager_id, @project.possible_managers, :id, :name %&gt;</span>
    <span class='dot3 op'>...</span>
  <span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='mod op'>%</span><span class='gt op'>&gt;</span>
</pre>
<p>
Now to make this possible we&#8217;d have to assign @project to an instance
of ProjectPresenter. Here&#8217;s an example of doing that in a Rails
controller:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='ProjectsController constant id'>ProjectsController</span> <span class='lt op'>&lt;</span> <span class='ApplicationController constant id'>ApplicationController</span>
    <span class='def def kw'>def</span> <span class='new identifier id'>new</span>
      <span class='@project ivar id'>@project</span> <span class='assign token'>=</span> <span class='present identifier id'>present</span> <span class='Project constant id'>Project</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='update identifier id'>update</span>
      <span class='project identifier id'>project</span> <span class='assign token'>=</span> <span class='Project constant id'>Project</span><span class='dot token'>.</span><span class='find identifier id'>find</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span>
      <span class='@project ivar id'>@project</span> <span class='assign token'>=</span> <span class='present identifier id'>present</span> <span class='Project constant id'>Project</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Won&#8217;t this screw up the views that rely on it being a Project? Nope.
That&#8217;s one of the features of CachingPresenter. It lets you decorate
the object you want to present on, but it will behave and act just like
that object. This includes delegating any methods it doesn&#8217;t know
about to the object that is being presented on. And it&#8217;s optimized
for the views.
</p>
<h2>Optimized</h2>
<p>
CachingPresenter memoizes all method calls made through it. That is, you
call a method once and all subsequent calls return the cached value from
the first call. This works with method arguments as well. It will not cache
the following types of method calls:
</p>
<ul>
<li>any assignment method, # ie: #bar=

</li>
<li>any method that takes a block, ie: #each, #map, etc.

</li>
</ul>
<p>
Basically, it&#8217;s designed to cache any read-oriented method call.
Here&#8217;s an example:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='ProjectPresenter constant id'>ProjectPresenter</span> <span class='lt op'>&lt;</span> <span class='CachingPresenter constant id'>CachingPresenter</span>
    <span class='comment val'># writes a constructed for ProjectPresenter.new :project =&gt; ...</span>
    <span class='presents identifier id'>presents</span> <span class='symbol val'>:project</span>

    <span class='def def kw'>def</span> <span class='foo identifier id'>foo</span><span class='lparen token'>(</span><span class='arg identifier id'>arg</span><span class='rparen token'>)</span>
      <span class='comment val'># this method is automatically memoized</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># the 'bar' method is automatically memoized</span>
    <span class='delegate identifier id'>delegate</span> <span class='symbol val'>:bar</span><span class='comma token'>,</span> <span class='symbol val'>:to</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:@project</span>
  <span class='end end kw'>end</span>

  <span class='presenter identifier id'>presenter</span> <span class='assign token'>=</span> <span class='ProjectPresenter constant id'>ProjectPresenter</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:project</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Project constant id'>Project</span><span class='dot token'>.</span><span class='first identifier id'>first</span>

  <span class='comment val'># executes the first time, but the second time it returns the cached result</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='foo identifier id'>foo</span> <span class='string val'>&quot;something&quot;</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='foo identifier id'>foo</span> <span class='string val'>&quot;something&quot;</span>

  <span class='comment val'># even though we called #foo, this time its with a different argument</span>
  <span class='comment val'># so it executes for the first time, and then returns the cached result</span>
  <span class='comment val'># the second time</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='foo identifier id'>foo</span> <span class='string val'>&quot;anything&quot;</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='foo identifier id'>foo</span> <span class='string val'>&quot;anything&quot;</span>

  <span class='comment val'># the 'id' method doesn't exist on the presenter, but the project</span>
  <span class='comment val'># has an 'id' method, so this will automatically memoize that</span>
  <span class='comment val'># method call, so it will be execute the first time it is called, but then</span>
  <span class='comment val'># it will return the cached result the second time</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='id identifier id'>id</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='id identifier id'>id</span>

  <span class='comment val'># even though we called 'foo' earlier, this time it's called with a block</span>
  <span class='comment val'># and CachingPresenter will always execute this. Both of these calls</span>
  <span class='comment val'># are executed without caching/memoization techniques.</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='foo identifier id'>foo</span> <span class='lbrace token'>{</span> <span class='do_something identifier id'>do_something</span> <span class='rbrace token'>}</span>
  <span class='presenter identifier id'>presenter</span><span class='dot token'>.</span><span class='foo identifier id'>foo</span> <span class='lbrace token'>{</span> <span class='do_something_else identifier id'>do_something_else</span> <span class='rbrace token'>}</span>
</pre>
<h2>Github</h2>
<ul>
<li>repos: http://github.com/mhs/caching_presenter/

</li>
<li>wiki: http://github.com/mhs/caching_presenter/wiki

</li>
</ul>
<h2>Developers</h2>
<ul>
<li>Zach Dennis, zdennis@mutuallyhuman.com, http://www.continuousthinking.com

</li>
<li>Mark VanHolstyn, mvanholstyn@mutuallyhuman.com

</li>
</ul>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>