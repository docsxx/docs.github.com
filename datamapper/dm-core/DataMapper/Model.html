<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: DataMapper::Model</title>
  </head>
  <body>
    <div id="content">
      <div class="section module DataMapper_Model">
  <h1 class="title">Module: DataMapper::Model</h1>
  <div class="section mixins">
  <h1>Included Modules</h1>
  <p><a href='Model/Transaction.html' title='DataMapper::Model::Transaction'>DataMapper::Model::Transaction</a>, <a href='Model/Migration.html' title='DataMapper::Model::Migration'>DataMapper::Model::Migration</a></p>
</div><div class="section docstring">
  <p>
TODO: move to dm-ar-finders
</p>

</div><div class="section constants">
  
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <h1>Public Class Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#append_extensions-class_method' title='append_extensions'>append_extensions</a></span><span class='args'>(*extensions)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Extends the model with this module after DataMapper::Resource has been
included.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt>TrueClass</tt>
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#extended-class_method' title='extended'>extended</a></span><span class='args'>(model)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#extra_extensions-class_method' title='extra_extensions'>extra_extensions</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#%5B%5D-instance_method' title='#[]'>#[]</a></span><span class='args'>(*key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#_load-instance_method' title='#_load'>#_load</a></span><span class='args'>(marshalled)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO: add docs.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#all-instance_method' title='#all'>#all</a></span><span class='args'>(query = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#base_model-instance_method' title='#base_model'>#base_model</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#copy-instance_method' title='#copy'>#copy</a></span><span class='args'>(source, destination, query = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Copy a set of records from one repository to another.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 <tt><a href='Collection.html' title='DataMapper::Collection'>DataMapper::Collection</a></tt>
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#create-instance_method' title='#create'>#create</a></span><span class='args'>(attributes = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create an instance of Resource with the given attributes.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#create%21-instance_method' title='#create!'>#create!</a></span><span class='args'>(attributes = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is deprecated, and will be removed from dm-core.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#default_order-instance_method' title='#default_order'>#default_order</a></span><span class='args'>(repository_name = default_repository_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#default_repository_name-instance_method' title='#default_repository_name'>#default_repository_name</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#eager_properties-instance_method' title='#eager_properties'>#eager_properties</a></span><span class='args'>(repository_name = default_repository_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#field_naming_convention-instance_method' title='#field_naming_convention'>#field_naming_convention</a></span><span class='args'>(repository_name = default_storage_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The field naming conventions for this resource across all repositories.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_by_sql-instance_method' title='#find_by_sql'>#find_by_sql</a></span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Find instances by manually providing SQL.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#first-instance_method' title='#first'>#first</a></span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#first_or_create-instance_method' title='#first_or_create'>#first_or_create</a></span><span class='args'>(query, attributes = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#get-instance_method' title='#get'>#get</a></span><span class='args'>(*key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#get%21-instance_method' title='#get!'>#get!</a></span><span class='args'>(*key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#inheritance_property-instance_method' title='#inheritance_property'>#inheritance_property</a></span><span class='args'>(repository_name = default_repository_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#inherited-instance_method' title='#inherited'>#inherited</a></span><span class='args'>(target)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#key-instance_method' title='#key'>#key</a></span><span class='args'>(repository_name = default_repository_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#load-instance_method' title='#load'>#load</a></span><span class='args'>(values, query)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#paranoid_properties-instance_method' title='#paranoid_properties'>#paranoid_properties</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#properties-instance_method' title='#properties'>#properties</a></span><span class='args'>(repository_name = default_repository_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#properties_with_subclasses-instance_method' title='#properties_with_subclasses'>#properties_with_subclasses</a></span><span class='args'>(repository_name = default_repository_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#property-instance_method' title='#property'>#property</a></span><span class='args'>(name, type, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
defines a property on the resource.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#repositories-instance_method' title='#repositories'>#repositories</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#repository-instance_method' title='#repository'>#repository</a></span><span class='args'>(name = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Get the repository with a given name, or the default one for the current
context, or the default one for this class.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#repository_name-instance_method' title='#repository_name'>#repository_name</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#storage_name-instance_method' title='#storage_name'>#storage_name</a></span><span class='args'>(repository_name = default_repository_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
the name of the storage recepticle for this resource.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#storage_names-instance_method' title='#storage_names'>#storage_names</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
the names of the storage recepticles for this resource across all
repositories.
</p>

        
          <p class='returns'>
            Returns: 
              <span class='return_types'>
                 
              </span>
          </p>
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#to_query-instance_method' title='#to_query'>#to_query</a></span><span class='args'>(repository, key, query = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO: spec this.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#typecast_key-instance_method' title='#typecast_key'>#typecast_key</a></span><span class='args'>(key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table><div class="included">
  
  <div>
    <h1>Public Instance Methods Included from <a href='Model/Transaction.html' title='DataMapper::Model::Transaction'>DataMapper::Model::Transaction</a></h1>
    <p><span class='name'><a href='Model/Transaction.html#transaction-instance_method' title='transaction'>transaction</a></span></p>
  </div>
  
  <div>
    <h1>Public Instance Methods Included from <a href='Model/Migration.html' title='DataMapper::Model::Migration'>DataMapper::Model::Migration</a></h1>
    <p><span class='name'><a href='Model/Migration.html#storage_exists%3F-instance_method' title='storage_exists?'>storage_exists?</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails class public">
  <h1>Public Class Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>append_extensions</h3>
</div><div id="append_extensions-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'><tt>TrueClass</tt></span>
    <span class='name'>append_extensions</span><span class='args'>(*extensions)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Extends the model with this module after DataMapper::Resource has been
included.
</p>
<p>
This is a useful way to extend DataMapper::Model while still retaining a
self.extended method.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>Module</tt>]</span>
      
      
        <span class='name'>extensions</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
the module that is to be extend the model after after DataMapper::Model
</p>
</span>
    </dd>
  
  </dl>
</div>
<div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>TrueClass</tt>, <tt>FalseClass</tt>]</span>
      
      
        <span class='name'></span>
      
    </dt>
    <dd>
      <span class='desc'><p>
whether or not the inclusions have been successfully appended to the list -
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


22
23
24
25</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 22</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='append_extensions identifier id'>append_extensions</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='extensions identifier id'>extensions</span><span class='rparen token'>)</span>
  <span class='extra_extensions identifier id'>extra_extensions</span><span class='dot token'>.</span><span class='concat identifier id'>concat</span> <span class='extensions identifier id'>extensions</span>
  <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>extended</h3>
</div><div id="extended-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>extended</span><span class='args'>(model)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


31
32
33
34
35
36</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 31</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='extended identifier id'>extended</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='rparen token'>)</span>
  <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@storage_names</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@properties</span><span class='comma token'>,</span>    <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@field_naming_conventions</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='extra_extensions identifier id'>extra_extensions</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='extension identifier id'>extension</span><span class='bitor op'>|</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span><span class='lparen token'>(</span><span class='extension identifier id'>extension</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>extra_extensions</h3>
</div><div id="extra_extensions-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>extra_extensions</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


27
28
29</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 27</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='extra_extensions identifier id'>extra_extensions</span>
  <span class='@extra_extensions ivar id'>@extra_extensions</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div><div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>[]</h3>
</div><div id="%5B%5D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]</span><span class='args'>(*key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


272
273
274
275</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 272</span>

<span class='def def kw'>def</span> <span class='aref op'>[]</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='warn identifier id'>warn</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{name}[] is deprecated. Use #{name}.get! instead.&quot;</span><span class='rparen token'>)</span>
  <span class='get! fid id'>get!</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>_load</h3>
</div><div id="_load-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>_load</span><span class='args'>(marshalled)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO: add docs
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


401
402
403
404
405</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 401</span>

<span class='def def kw'>def</span> <span class='_load identifier id'>_load</span><span class='lparen token'>(</span><span class='marshalled identifier id'>marshalled</span><span class='rparen token'>)</span>
  <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='allocate identifier id'>allocate</span>
  <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='marshalled identifier id'>marshalled</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='kv identifier id'>kv</span><span class='bitor op'>|</span> <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='kv identifier id'>kv</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='resource identifier id'>resource</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>all</h3>
</div><div id="all-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>all</span><span class='args'>(query = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


256
257
258
259</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 256</span>

<span class='def def kw'>def</span> <span class='all identifier id'>all</span><span class='lparen token'>(</span><span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='scoped_query identifier id'>scoped_query</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='read_many identifier id'>read_many</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>base_model</h3>
</div><div id="base_model-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>base_model</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


88
89
90</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 88</span>

<span class='def def kw'>def</span> <span class='base_model identifier id'>base_model</span>
  <span class='@base_model ivar id'>@base_model</span> <span class='opasgn op'>||=</span> <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>copy</h3>
</div><div id="copy-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'><tt><a href='Collection.html' title='DataMapper::Collection'>DataMapper::Collection</a></tt></span>
    <span class='name'>copy</span><span class='args'>(source, destination, query = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Copy a set of records from one repository to another.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>String</tt>]</span>
      
      
        <span class='name'>source</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
The name of the Repository the resources should be copied <em>from</em>
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'>[<tt>String</tt>]</span>
      
      
        <span class='name'>destination</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
The name of the Repository the resources should be copied <em>to</em>
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'>[<tt>Hash</tt>]</span>
      
      
        <span class='name'>query</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
The conditions with which to find the records to copy. These conditions are
merged with Model.query
</p>
</span>
    </dd>
  
  </dl>
</div>
<div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href='Collection.html' title='DataMapper::Collection'>DataMapper::Collection</a></tt>]</span>
      
      
        <span class='name'></span>
      
    </dt>
    <dd>
      <span class='desc'><p>
A Collection of the Resource instances created in the operation
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


329
330
331
332
333
334
335
336
337
338
339
340</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 329</span>

<span class='def def kw'>def</span> <span class='copy identifier id'>copy</span><span class='lparen token'>(</span><span class='source identifier id'>source</span><span class='comma token'>,</span> <span class='destination identifier id'>destination</span><span class='comma token'>,</span> <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>

  <span class='comment val'># get the list of properties that exist in the source and destination</span>
  <span class='destination_properties identifier id'>destination_properties</span> <span class='assign token'>=</span> <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='destination identifier id'>destination</span><span class='rparen token'>)</span>
  <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='lbrack token'>[</span><span class='symbol val'>:fields</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='source identifier id'>source</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span> <span class='destination_properties identifier id'>destination_properties</span><span class='dot token'>.</span><span class='has_property? fid id'>has_property?</span><span class='lparen token'>(</span><span class='p identifier id'>p</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>

  <span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='destination identifier id'>destination</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='all identifier id'>all</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:repository</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='source identifier id'>source</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='resource identifier id'>resource</span><span class='bitor op'>|</span>
      <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='resource identifier id'>resource</span><span class='rparen token'>)</span> <span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='to_hash identifier id'>to_hash</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create</h3>
</div><div id="create-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create</span><span class='args'>(attributes = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create an instance of Resource with the given attributes
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>&lt;Hash(Symbol</span>
      
    </dt>
    <dd>
      <span class='desc'><h1>&gt; Object)&gt; attributes hash of attributes to set</h1>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


298
299
300
301
302</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 298</span>

<span class='def def kw'>def</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span><span class='rparen token'>)</span>
  <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
  <span class='resource identifier id'>resource</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create!</h3>
</div><div id="create%21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create!</span><span class='args'>(attributes = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is deprecated, and will be removed from dm-core.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href='PersistenceError.html' title='PersistenceError'>PersistenceError</a></tt>]</span>
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


307
308
309
310
311
312</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 307</span>

<span class='def def kw'>def</span> <span class='create! fid id'>create!</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='warn identifier id'>warn</span><span class='lparen token'>(</span><span class='string val'>&quot;Model#create! is deprecated. It is moving to dm-validations, and will be used to create a record without validations&quot;</span><span class='rparen token'>)</span>
  <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='PersistenceError constant id'>PersistenceError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Resource not saved: :new_record =&gt; #{resource.new_record?}, :dirty_attributes =&gt; #{resource.dirty_attributes.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span>
  <span class='resource identifier id'>resource</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>default_order</h3>
</div><div id="default_order-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>default_order</span><span class='args'>(repository_name = default_repository_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


242
243
244
245</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 242</span>

<span class='def def kw'>def</span> <span class='default_order identifier id'>default_order</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span><span class='rparen token'>)</span>
  <span class='@default_order ivar id'>@default_order</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@default_order ivar id'>@default_order</span><span class='lbrack token'>[</span><span class='repository_name identifier id'>repository_name</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='key identifier id'>key</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='bitor op'>|</span> <span class='Query constant id'>Query</span><span class='colon2 op'>::</span><span class='Direction constant id'>Direction</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>default_repository_name</h3>
</div><div id="default_repository_name-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>default_repository_name</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


411
412
413</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 411</span>

<span class='def def kw'>def</span> <span class='default_repository_name identifier id'>default_repository_name</span>
  <span class='Repository constant id'>Repository</span><span class='dot token'>.</span><span class='default_name identifier id'>default_name</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>eager_properties</h3>
</div><div id="eager_properties-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>eager_properties</span><span class='args'>(repository_name = default_repository_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


217
218
219</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 217</span>

<span class='def def kw'>def</span> <span class='eager_properties identifier id'>eager_properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span><span class='rparen token'>)</span>
  <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='defaults identifier id'>defaults</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>field_naming_convention</h3>
</div><div id="field_naming_convention-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>field_naming_convention</span><span class='args'>(repository_name = default_storage_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The field naming conventions for this resource across all repositories.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'></span>
      
    </dt>
    <dd>
      <span class='desc'><p>
&lt;String&gt; The naming convention for the given repository
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


140
141
142</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 140</span>

<span class='def def kw'>def</span> <span class='field_naming_convention identifier id'>field_naming_convention</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_storage_name identifier id'>default_storage_name</span><span class='rparen token'>)</span>
  <span class='@field_naming_conventions ivar id'>@field_naming_conventions</span><span class='lbrack token'>[</span><span class='repository_name identifier id'>repository_name</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='adapter identifier id'>adapter</span><span class='dot token'>.</span><span class='field_naming_convention identifier id'>field_naming_convention</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_by_sql</h3>
</div><div id="find_by_sql-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_by_sql</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Find instances by manually providing SQL
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>sql&lt;String&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
an SQL query to execute
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>&lt;Array&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
an Array containing a String (being the SQL query to execute) and the
parameters to the query. example: [&quot;SELECT name FROM users WHERE id =
?&quot;, id]
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>query&lt;DataMapper::Query&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
a prepared Query to execute.
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>opts&lt;Hash&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
an options hash. :repository&lt;Symbol&gt; the name of the repository to
execute the query in. Defaults to self.default_repository_name.
:reload&lt;Boolean&gt; whether to reload any instances found that already
exist in the identity map. Defaults to false. :properties&lt;Array&gt; the
Properties of the instance that the query loads. Must contain
DataMapper::Properties. Defaults to self.properties.
</p>
</span>
    </dd>
  
  </dl>
</div>
<div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'></span>
      
    </dt>
    <dd>
      <span class='desc'><p>
&lt;Collection&gt; the instance matched by the query.
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/adapters/data_objects_adapter.rb', line 668</span>

<span class='def def kw'>def</span> <span class='find_by_sql identifier id'>find_by_sql</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='sql identifier id'>sql</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='properties identifier id'>properties</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='do_reload identifier id'>do_reload</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span>
  <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='arg identifier id'>arg</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
      <span class='sql identifier id'>sql</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span>
    <span class='elsif elsif kw'>elsif</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
      <span class='sql identifier id'>sql</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span><span class='lbrack token'>[</span><span class='float val'>1</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
    <span class='elsif elsif kw'>elsif</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Query constant id'>Query</span><span class='rparen token'>)</span>
      <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span>
    <span class='elsif elsif kw'>elsif</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
      <span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:repository</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:repository</span><span class='rparen token'>)</span>
      <span class='properties identifier id'>properties</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:properties</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:properties</span><span class='rparen token'>)</span>
      <span class='do_reload identifier id'>do_reload</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:reload</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:reload</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;unknown options to #find_by_sql: #{arg.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='repository identifier id'>repository</span> <span class='assign token'>=</span> <span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;#find_by_sql only available for Repositories served by a DataObjectsAdapter&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='adapter identifier id'>adapter</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Adapters constant id'>Adapters</span><span class='colon2 op'>::</span><span class='DataObjectsAdapter constant id'>DataObjectsAdapter</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='query identifier id'>query</span>
    <span class='sql identifier id'>sql</span> <span class='assign token'>=</span> <span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='adapter identifier id'>adapter</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:read_statement</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>
    <span class='bind_values identifier id'>bind_values</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='bind_values identifier id'>bind_values</span>
  <span class='end end kw'>end</span>

  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;#find_by_sql requires a query of some kind to work&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='sql identifier id'>sql</span>

  <span class='properties identifier id'>properties</span> <span class='opasgn op'>||=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>

  <span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='Query constant id'>Query</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='repository identifier id'>repository</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='collection identifier id'>collection</span><span class='bitor op'>|</span>
    <span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='adapter identifier id'>adapter</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:with_connection</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='connection identifier id'>connection</span><span class='bitor op'>|</span>
      <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='create_command identifier id'>create_command</span><span class='lparen token'>(</span><span class='sql identifier id'>sql</span><span class='rparen token'>)</span>

      <span class='begin begin kw'>begin</span>
        <span class='reader identifier id'>reader</span> <span class='assign token'>=</span> <span class='command identifier id'>command</span><span class='dot token'>.</span><span class='execute_reader identifier id'>execute_reader</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='bind_values identifier id'>bind_values</span><span class='rparen token'>)</span>

        <span class='while while kw'>while</span><span class='lparen token'>(</span><span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='next! fid id'>next!</span><span class='rparen token'>)</span>
          <span class='collection identifier id'>collection</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='reader identifier id'>reader</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='reader identifier id'>reader</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>first</h3>
</div><div id="first-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>first</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


261
262
263
264
265
266
267
268
269
270</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 261</span>

<span class='def def kw'>def</span> <span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:merge</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='scoped_query identifier id'>scoped_query</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='orop op'>||</span> <span class='integer val'>1</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
    <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='read_many identifier id'>read_many</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='read_one identifier id'>read_one</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>first_or_create</h3>
</div><div id="first_or_create-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>first_or_create</span><span class='args'>(query, attributes = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 277</span>

<span class='def def kw'>def</span> <span class='first_or_create identifier id'>first_or_create</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='begin begin kw'>begin</span>
    <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='allocate identifier id'>allocate</span>
    <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>

    <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='key identifier id'>key</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
        <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{property.name}=&quot;</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span><span class='rparen token'>)</span>
    <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='resource identifier id'>resource</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get</h3>
</div><div id="get-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get</span><span class='args'>(*key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


247
248
249
250</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 247</span>

<span class='def def kw'>def</span> <span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='key identifier id'>key</span> <span class='assign token'>=</span> <span class='typecast_key identifier id'>typecast_key</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='identity_map identifier id'>identity_map</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='to_query identifier id'>to_query</span><span class='lparen token'>(</span><span class='repository identifier id'>repository</span><span class='comma token'>,</span> <span class='key identifier id'>key</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get!</h3>
</div><div id="get%21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get!</span><span class='args'>(*key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


252
253
254</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 252</span>

<span class='def def kw'>def</span> <span class='get! fid id'>get!</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='ObjectNotFoundError constant id'>ObjectNotFoundError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;Could not find #{self.name} with key #{key.inspect}&quot;</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>inheritance_property</h3>
</div><div id="inheritance_property-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>inheritance_property</span><span class='args'>(repository_name = default_repository_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


238
239
240</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 238</span>

<span class='def def kw'>def</span> <span class='inheritance_property identifier id'>inheritance_property</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span><span class='rparen token'>)</span>
  <span class='@properties ivar id'>@properties</span><span class='lbrack token'>[</span><span class='repository_name identifier id'>repository_name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='bitor op'>|</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='type identifier id'>type</span> <span class='eq op'>==</span> <span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Types constant id'>Types</span><span class='colon2 op'>::</span><span class='Discriminator constant id'>Discriminator</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>inherited</h3>
</div><div id="inherited-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>inherited</span><span class='args'>(target)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 38</span>

<span class='def def kw'>def</span> <span class='inherited identifier id'>inherited</span><span class='lparen token'>(</span><span class='target identifier id'>target</span><span class='rparen token'>)</span>
  <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@storage_names</span><span class='comma token'>,</span>       <span class='@storage_names ivar id'>@storage_names</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span><span class='rparen token'>)</span>
  <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@properties</span><span class='comma token'>,</span>          <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@base_model</span><span class='comma token'>,</span>          <span class='self self kw'>self</span><span class='dot token'>.</span><span class='base_model identifier id'>base_model</span><span class='rparen token'>)</span>
  <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@paranoid_properties</span><span class='comma token'>,</span> <span class='@paranoid_properties ivar id'>@paranoid_properties</span><span class='rparen token'>)</span>
  <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@field_naming_conventions</span><span class='comma token'>,</span>  <span class='@field_naming_conventions ivar id'>@field_naming_conventions</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='validators identifier id'>validators</span><span class='rparen token'>)</span>
    <span class='@validations ivar id'>@validations</span><span class='dot token'>.</span><span class='contexts identifier id'>contexts</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='context identifier id'>context</span><span class='comma token'>,</span> <span class='validators identifier id'>validators</span><span class='bitor op'>|</span>
      <span class='validators identifier id'>validators</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='validator identifier id'>validator</span><span class='bitor op'>|</span> <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='validators identifier id'>validators</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='validator identifier id'>validator</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='@properties ivar id'>@properties</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='repository_name identifier id'>repository_name</span><span class='comma token'>,</span><span class='properties identifier id'>properties</span><span class='bitor op'>|</span>
    <span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='properties identifier id'>properties</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='bitor op'>|</span>
        <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='has_property? fid id'>has_property?</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
        <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='property identifier id'>property</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='@relationships ivar id'>@relationships</span>
    <span class='duped_relationships identifier id'>duped_relationships</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@relationships ivar id'>@relationships</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='repository_name identifier id'>repository_name</span><span class='comma token'>,</span><span class='relationships identifier id'>relationships</span><span class='bitor op'>|</span>
      <span class='relationships identifier id'>relationships</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='relationship identifier id'>relationship</span><span class='bitor op'>|</span>
        <span class='dup identifier id'>dup</span> <span class='assign token'>=</span> <span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
        <span class='dup identifier id'>dup</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@child_model</span><span class='comma token'>,</span> <span class='target identifier id'>target</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='dup identifier id'>dup</span><span class='dot token'>.</span><span class='instance_variable_get identifier id'>instance_variable_get</span><span class='lparen token'>(</span><span class='symbol val'>:@child_model</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='self self kw'>self</span>
        <span class='dup identifier id'>dup</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@parent_model</span><span class='comma token'>,</span> <span class='target identifier id'>target</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='dup identifier id'>dup</span><span class='dot token'>.</span><span class='instance_variable_get identifier id'>instance_variable_get</span><span class='lparen token'>(</span><span class='symbol val'>:@parent_model</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='self self kw'>self</span>
        <span class='duped_relationships identifier id'>duped_relationships</span><span class='lbrack token'>[</span><span class='repository_name identifier id'>repository_name</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
        <span class='duped_relationships identifier id'>duped_relationships</span><span class='lbrack token'>[</span><span class='repository_name identifier id'>repository_name</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dup identifier id'>dup</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='target identifier id'>target</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@relationships</span><span class='comma token'>,</span> <span class='duped_relationships identifier id'>duped_relationships</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>key</h3>
</div><div id="key-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>key</span><span class='args'>(repository_name = default_repository_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


234
235
236</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 234</span>

<span class='def def kw'>def</span> <span class='key identifier id'>key</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span><span class='rparen token'>)</span>
  <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='key identifier id'>key</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>load</h3>
</div><div id="load-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>load</span><span class='args'>(values, query)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 344</span>

<span class='def def kw'>def</span> <span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='repository identifier id'>repository</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span>
  <span class='model identifier id'>model</span>      <span class='assign token'>=</span> <span class='self self kw'>self</span>

  <span class='if if kw'>if</span> <span class='inheritance_property_index identifier id'>inheritance_property_index</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='inheritance_property_index identifier id'>inheritance_property_index</span>
    <span class='model identifier id'>model</span> <span class='assign token'>=</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='inheritance_property_index identifier id'>inheritance_property_index</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='model identifier id'>model</span>
  <span class='end end kw'>end</span>

  <span class='key_values identifier id'>key_values</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='identity_map identifier id'>identity_map</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='if if kw'>if</span> <span class='key_property_indexes identifier id'>key_property_indexes</span> <span class='assign token'>=</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='key_property_indexes identifier id'>key_property_indexes</span><span class='lparen token'>(</span><span class='repository identifier id'>repository</span><span class='rparen token'>)</span>
    <span class='key_values identifier id'>key_values</span>   <span class='assign token'>=</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='values_at identifier id'>values_at</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='key_property_indexes identifier id'>key_property_indexes</span><span class='rparen token'>)</span>
    <span class='identity_map identifier id'>identity_map</span> <span class='assign token'>=</span> <span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='identity_map identifier id'>identity_map</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='identity_map identifier id'>identity_map</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='key_values identifier id'>key_values</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='resource identifier id'>resource</span> <span class='unless unless_mod kw'>unless</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='reload? fid id'>reload?</span>
    <span class='else else kw'>else</span>
      <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='allocate identifier id'>allocate</span>
      <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@repository</span><span class='comma token'>,</span> <span class='repository identifier id'>repository</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='resource identifier id'>resource</span> <span class='assign token'>=</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='allocate identifier id'>allocate</span>
    <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='readonly! fid id'>readonly!</span>
  <span class='end end kw'>end</span>

  <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='instance_variable_set identifier id'>instance_variable_set</span><span class='lparen token'>(</span><span class='symbol val'>:@new_record</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>

  <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='comma token'>,</span><span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='custom? fid id'>custom?</span> <span class='integer val'>? </span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='type identifier id'>type</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='property identifier id'>property</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='typecast identifier id'>typecast</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='set! fid id'>set!</span><span class='lparen token'>(</span><span class='resource identifier id'>resource</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='track identifier id'>track</span> <span class='assign token'>=</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='track identifier id'>track</span>
      <span class='case case kw'>case</span> <span class='track identifier id'>track</span>
        <span class='when when kw'>when</span> <span class='symbol val'>:hash</span>
          <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='original_values identifier id'>original_values</span><span class='lbrack token'>[</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span><span class='dot token'>.</span><span class='hash identifier id'>hash</span> <span class='unless unless_mod kw'>unless</span> <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='original_values identifier id'>original_values</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='hash identifier id'>hash</span>
        <span class='when when kw'>when</span> <span class='symbol val'>:load</span>
          <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='original_values identifier id'>original_values</span><span class='lbrack token'>[</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span> <span class='unless unless_mod kw'>unless</span> <span class='resource identifier id'>resource</span><span class='dot token'>.</span><span class='original_values identifier id'>original_values</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='key_values identifier id'>key_values</span> <span class='andop op'>&amp;&amp;</span> <span class='identity_map identifier id'>identity_map</span>
    <span class='identity_map identifier id'>identity_map</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='key_values identifier id'>key_values</span><span class='comma token'>,</span> <span class='resource identifier id'>resource</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='resource identifier id'>resource</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>paranoid_properties</h3>
</div><div id="paranoid_properties-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>paranoid_properties</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


415
416
417
418</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 415</span>

<span class='def def kw'>def</span> <span class='paranoid_properties identifier id'>paranoid_properties</span>
  <span class='@paranoid_properties ivar id'>@paranoid_properties</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@paranoid_properties ivar id'>@paranoid_properties</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>properties</h3>
</div><div id="properties-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>properties</span><span class='args'>(repository_name = default_repository_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 199</span>

<span class='def def kw'>def</span> <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span><span class='rparen token'>)</span>
  <span class='comment val'># We need to check whether all relations are already set up.</span>
  <span class='comment val'># If this isn't the case, we try to reload them here</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='@_valid_relations ivar id'>@_valid_relations</span> <span class='andop op'>&amp;&amp;</span> <span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='many_to_one_relationships identifier id'>many_to_one_relationships</span><span class='rparen token'>)</span>
    <span class='@_valid_relations ivar id'>@_valid_relations</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='begin begin kw'>begin</span>
      <span class='many_to_one_relationships identifier id'>many_to_one_relationships</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
        <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='child_key identifier id'>child_key</span>
      <span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='NameError constant id'>NameError</span>
      <span class='comment val'># Apparently not all relations are loaded,</span>
      <span class='comment val'># so we will try again later on</span>
      <span class='@_valid_relations ivar id'>@_valid_relations</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='@properties ivar id'>@properties</span><span class='lbrack token'>[</span><span class='repository_name identifier id'>repository_name</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='repository_name identifier id'>repository_name</span> <span class='eq op'>==</span> <span class='Repository constant id'>Repository</span><span class='dot token'>.</span><span class='default_name identifier id'>default_name</span> <span class='integer val'>? </span><span class='PropertySet constant id'>PropertySet</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='colon op'>:</span> <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='Repository constant id'>Repository</span><span class='dot token'>.</span><span class='default_name identifier id'>default_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>properties_with_subclasses</h3>
</div><div id="properties_with_subclasses-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>properties_with_subclasses</span><span class='args'>(repository_name = default_repository_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


222
223
224
225
226
227
228
229
230
231
232</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 222</span>

<span class='def def kw'>def</span> <span class='properties_with_subclasses identifier id'>properties_with_subclasses</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span><span class='rparen token'>)</span>
  <span class='properties identifier id'>properties</span> <span class='assign token'>=</span> <span class='PropertySet constant id'>PropertySet</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='lparen token'>(</span><span class='lbrack token'>[</span> <span class='self self kw'>self</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_set identifier id'>to_set</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:descendants</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='descendants identifier id'>descendants</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='model identifier id'>model</span><span class='bitor op'>|</span>
    <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='relationships identifier id'>relationships</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each_value identifier id'>each_value</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='relationship identifier id'>relationship</span><span class='bitor op'>|</span> <span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='child_key identifier id'>child_key</span> <span class='rbrace token'>}</span>
    <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='many_to_one_relationships identifier id'>many_to_one_relationships</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='relationship identifier id'>relationship</span><span class='bitor op'>|</span> <span class='relationship identifier id'>relationship</span><span class='dot token'>.</span><span class='child_key identifier id'>child_key</span> <span class='end end kw'>end</span>
    <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='property identifier id'>property</span><span class='bitor op'>|</span>
      <span class='properties identifier id'>properties</span> <span class='lshft op'>&lt;&lt;</span> <span class='property identifier id'>property</span> <span class='unless unless_mod kw'>unless</span> <span class='properties identifier id'>properties</span><span class='dot token'>.</span><span class='has_property? fid id'>has_property?</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='properties identifier id'>properties</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>property</h3>
</div><div id="property-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>property</span><span class='args'>(name, type, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
defines a property on the resource
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>&lt;Symbol&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
name the name for which to call this property
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>&lt;Type&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
type the type to define this property ass
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>&lt;Hash(Symbol</span>
      
    </dt>
    <dd>
      <span class='desc'><h1>&gt; String)&gt; options a hash of available options</h1>
</span>
    </dd>
  
  </dl>
</div>
<div class="see">
  <h3>See Also:</h3>
  <dl>
    <dt></dt>
    <dd>
      <span class='desc'>
        <tt><a href='Property.html' title='DataMapper::Property'>DataMapper::Property</a></tt>
      </span>
    </dd>
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 151</span>

<span class='def def kw'>def</span> <span class='property identifier id'>property</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='property identifier id'>property</span> <span class='assign token'>=</span> <span class='Property constant id'>Property</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>

  <span class='create_property_getter identifier id'>create_property_getter</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='rparen token'>)</span>
  <span class='create_property_setter identifier id'>create_property_setter</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='rparen token'>)</span>

  <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='property identifier id'>property</span>
  <span class='@_valid_relations ivar id'>@_valid_relations</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

  <span class='comment val'># Add property to the other mappings as well if this is for the default</span>
  <span class='comment val'># repository.</span>
  <span class='if if kw'>if</span> <span class='repository_name identifier id'>repository_name</span> <span class='eq op'>==</span> <span class='default_repository_name identifier id'>default_repository_name</span>
    <span class='@properties ivar id'>@properties</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='repository_name identifier id'>repository_name</span><span class='comma token'>,</span> <span class='properties identifier id'>properties</span><span class='bitor op'>|</span>
      <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='repository_name identifier id'>repository_name</span> <span class='eq op'>==</span> <span class='default_repository_name identifier id'>default_repository_name</span>
      <span class='properties identifier id'>properties</span> <span class='lshft op'>&lt;&lt;</span> <span class='property identifier id'>property</span> <span class='unless unless_mod kw'>unless</span> <span class='properties identifier id'>properties</span><span class='dot token'>.</span><span class='has_property? fid id'>has_property?</span><span class='lparen token'>(</span><span class='property identifier id'>property</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Add the property to the lazy_loads set for this resources repository</span>
  <span class='comment val'># only.</span>
  <span class='comment val'># TODO Is this right or should we add the lazy contexts to all</span>
  <span class='comment val'># repositories?</span>
  <span class='if if kw'>if</span> <span class='property identifier id'>property</span><span class='dot token'>.</span><span class='lazy? fid id'>lazy?</span>
    <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='symbol val'>:lazy</span><span class='comma token'>,</span> <span class='symbol val'>:default</span><span class='rparen token'>)</span>
    <span class='context identifier id'>context</span> <span class='assign token'>=</span> <span class='symbol val'>:default</span> <span class='if if_mod kw'>if</span> <span class='context identifier id'>context</span> <span class='eq op'>==</span> <span class='true true kw'>true</span>

    <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='context identifier id'>context</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='bitor op'>|</span>
      <span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='lazy_context identifier id'>lazy_context</span><span class='lparen token'>(</span><span class='item identifier id'>item</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='name identifier id'>name</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># add the property to the child classes only if the property was</span>
  <span class='comment val'># added after the child classes' properties have been copied from</span>
  <span class='comment val'># the parent</span>
  <span class='if if kw'>if</span> <span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='colon op'>:</span><span class='descendants identifier id'>descendants</span><span class='rparen token'>)</span>
    <span class='descendants identifier id'>descendants</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='model identifier id'>model</span><span class='bitor op'>|</span>
      <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='properties identifier id'>properties</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='has_property? fid id'>has_property?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
      <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='property identifier id'>property</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='property identifier id'>property</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>repositories</h3>
</div><div id="repositories-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>repositories</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


195
196
197</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 195</span>

<span class='def def kw'>def</span> <span class='repositories identifier id'>repositories</span>
  <span class='lbrack token'>[</span> <span class='repository identifier id'>repository</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_set identifier id'>to_set</span> <span class='plus op'>+</span> <span class='@properties ivar id'>@properties</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='repository_name identifier id'>repository_name</span><span class='bitor op'>|</span> <span class='DataMapper constant id'>DataMapper</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>repository</h3>
</div><div id="repository-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>repository</span><span class='args'>(name = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Get the repository with a given name, or the default one for the current
context, or the default one for this class.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="param">
  <h3>Parameters:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>name&lt;Symbol&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
the name of the repository wanted
</p>
</span>
    </dd>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'>block&lt;Block&gt;</span>
      
    </dt>
    <dd>
      <span class='desc'><p>
block to execute with the fetched repository as parameter
</p>
</span>
    </dd>
  
  </dl>
</div>
<div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'></span>
      
    </dt>
    <dd>
      <span class='desc'><p>
&lt;Object, DataMapper::Respository&gt; whatever the block returns, if
given a block, otherwise the requested repository. -
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


107
108
109
110
111
112
113
114
115
116
117
118</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 107</span>

<span class='def def kw'>def</span> <span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='comment val'>#</span>
  <span class='comment val'># There has been a couple of different strategies here, but me (zond) and dkubb are at least</span>
  <span class='comment val'># united in the concept of explicitness over implicitness. That is - the explicit wish of the</span>
  <span class='comment val'># caller (+name+) should be given more priority than the implicit wish of the caller (Repository.context.last).</span>
  <span class='comment val'>#</span>
  <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='DataMapper constant id'>DataMapper</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='name identifier id'>name</span> <span class='orop op'>||</span> <span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='DataMapper constant id'>DataMapper</span><span class='dot token'>.</span><span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='name identifier id'>name</span> <span class='orop op'>||</span> <span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>repository_name</h3>
</div><div id="repository_name-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>repository_name</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


92
93
94</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 92</span>

<span class='def def kw'>def</span> <span class='repository_name identifier id'>repository_name</span>
  <span class='Repository constant id'>Repository</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='integer val'>? </span><span class='Repository constant id'>Repository</span><span class='dot token'>.</span><span class='context identifier id'>context</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='colon op'>:</span> <span class='default_repository_name identifier id'>default_repository_name</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>storage_name</h3>
</div><div id="storage_name-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>storage_name</span><span class='args'>(repository_name = default_repository_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
the name of the storage recepticle for this resource. IE. table name, for
database stores
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'></span>
      
    </dt>
    <dd>
      <span class='desc'><p>
&lt;String&gt; the storage name (IE table name, for database stores)
associated with this resource in the given repository
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


124
125
126</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 124</span>

<span class='def def kw'>def</span> <span class='storage_name identifier id'>storage_name</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span> <span class='assign token'>=</span> <span class='default_repository_name identifier id'>default_repository_name</span><span class='rparen token'>)</span>
  <span class='@storage_names ivar id'>@storage_names</span><span class='lbrack token'>[</span><span class='repository_name identifier id'>repository_name</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='repository identifier id'>repository</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='adapter identifier id'>adapter</span><span class='dot token'>.</span><span class='resource_naming_convention identifier id'>resource_naming_convention</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='base_model identifier id'>base_model</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:default_storage_name</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>storage_names</h3>
</div><div id="storage_names-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>storage_names</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
the names of the storage recepticles for this resource across all
repositories
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="return">
  <h3>Returns:</h3>
  <dl>
  
    <dt>
      
        <span class='type'></span>
      
      
        <span class='name'></span>
      
    </dt>
    <dd>
      <span class='desc'><p>
&lt;Hash(Symbol =&gt; String)&gt; All available names of storage
recepticles
</p>
</span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


132
133
134</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 132</span>

<span class='def def kw'>def</span> <span class='storage_names identifier id'>storage_names</span>
  <span class='@storage_names ivar id'>@storage_names</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>to_query</h3>
</div><div id="to_query-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_query</span><span class='args'>(repository, key, query = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO: spec this
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


394
395
396
397</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 394</span>

<span class='def def kw'>def</span> <span class='to_query identifier id'>to_query</span><span class='lparen token'>(</span><span class='repository identifier id'>repository</span><span class='comma token'>,</span> <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='query identifier id'>query</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='conditions identifier id'>conditions</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='lbrack token'>[</span> <span class='mult op'>*</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='key identifier id'>key</span><span class='lparen token'>(</span><span class='repository identifier id'>repository</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span> <span class='rbrack token'>]</span>
  <span class='Query constant id'>Query</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='repository identifier id'>repository</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>typecast_key</h3>
</div><div id="typecast_key-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>typecast_key</span><span class='args'>(key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


407
408
409</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/dm-core/model.rb', line 407</span>

<span class='def def kw'>def</span> <span class='typecast_key identifier id'>typecast_key</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='key identifier id'>key</span><span class='lparen token'>(</span><span class='repository_name identifier id'>repository_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='typecast identifier id'>typecast</span><span class='lparen token'>(</span><span class='v identifier id'>v</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>