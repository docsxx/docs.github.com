<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>fauna's ultrasphinx - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/fauna/commits/ultrasphinx/master" rel="alternate" title="Recent Commits to ultrasphinx:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("fauna", "ultrasphinx", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='fauna/ultrasphinx/blob/e3fe8c6a055fb19219b115b17c3d581c7b301e2d' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='fauna/ultrasphinx/blob/e3fe8c6a055fb19219b115b17c3d581c7b301e2d' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("fauna", "ultrasphinx", "e3fe8c6a055fb19219b115b17c3d581c7b301e2d", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/fauna/ultrasphinx/tree/">Source</a></li>
            <li class=""><a href="http://github.com/fauna/ultrasphinx/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/fauna/ultrasphinx/network">Network</a></li>            
            <li class=""><a href="http://github.com/fauna/ultrasphinx/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/fauna/ultrasphinx">Wiki</a></li>
            <li class=""><a href="http://github.com/fauna/ultrasphinx/graphs">Graphs</a></li>                    
            <li class="active"><a href="/fauna/ultrasphinx">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/fauna">fauna</a> / <b><a href="http://github.com/fauna/ultrasphinx/tree">ultrasphinx</a></b>        
                <a id="namespaces_button" rel="fauna/ultrasphinx/blob/e3fe8c6a055fb19219b115b17c3d581c7b301e2d" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="fauna/ultrasphinx/blob/e3fe8c6a055fb19219b115b17c3d581c7b301e2d" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
Ultrasphinx
</p>
<p>
Ruby on Rails configurator and client to the Sphinx full text search
engine.
</p>
<h2>License</h2>
<p>
Copyright 2007-2008 Cloudburst, LLC. Licensed under the AFL 3. See the
included LICENSE file. Some portions copyright Pat Allan, distributed under
the MIT license, and used with permission. Some portions copyright PJ Hyett
and Mislav MarohniÄ‡, distributed under the MIT license, and used with
permission.
</p>
<p>
The public certificate for the gem is
here[http://rubyforge.org/frs/download.php/25331/evan_weaver-original-public_cert.pem].
</p>
<p>
If you use this software, please {make a
donation}[http://blog.evanweaver.com/donate/], or <tt>Evan</tt>[http://www.workingwithrails.com/person/7739-evan-weaver] at Working
with Rails.
</p>
<h2>Requirements</h2>
<ul>
<li>MySQL 5.0, or PostgreSQL 8.2

</li>
<li>Sphinx 0.9.8-rc2

</li>
<li>Rails 2.0.2

</li>
</ul>
<p>
More recent versions than listed are usually ok.
</p>
<h2>Features</h2>
<p>
Sphinx/Ultrasphinx is the fastest and most stable Rails fulltext search
solution.
</p>
<p>
Features include:
</p>
<ul>
<li>searching and ranking across multiple models

</li>
<li>delta index support

</li>
<li>excerpt highlighting

</li>
<li>Google-style query parser

</li>
<li>spellcheck

</li>
<li>faceting on text, date, and numeric fields

</li>
<li>field weighting, merging, and aliasing

</li>
<li>geodistance

</li>
<li><tt>belongs_to</tt> and <tt>has_many</tt> includes

</li>
<li>drop-in compatibility with
will_paginate[http://err.lighthouseapp.com/projects/466/home]

</li>
<li>drop-in compatibility with
Interlock[http://blog.evanweaver.com/files/doc/fauna/interlock/]

</li>
<li>multiple deployment environments

</li>
<li>comprehensive Rake tasks

</li>
</ul>
<p>
And some other things.
</p>
<h1>Usage</h1>
<h2>Installation</h2>
<p>
First, install Sphinx itself. Get the <tt>snapshot</tt>[http://www.sphinxsearch.com/downloads.html], then run
<tt>./configure</tt>, <tt>make</tt>, and <tt>sudo make install</tt>. Make
sure to set your <tt>./configure</tt> flags: <tt>---prefix</tt> if
necessary, and also <tt>---with-pgsql</tt> if you need Postgres
support.
</p>
<p>
You also need the <tt>chronic</tt> gem:
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='chronic identifier id'>chronic</span>
</pre>
<p>
Then, install the plugin:
</p>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='fauna identifier id'>fauna</span><span class='div op'>/</span><span class='ultrasphinx identifier id'>ultrasphinx</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<p>
Next, copy the <tt>examples/default.base</tt> file to
<tt>RAILS_ROOT/config/ultrasphinx/default.base</tt>. This file sets up the
Sphinx daemon options such as port, host, and index location.
</p>
<p>
If you need per-environment configuration, you can use
<tt>RAILS_ROOT/config/ultrasphinx/development.base</tt>, etc. Note that ERb
is also allowed within the <tt>.base</tt> files, and can be an alternative
way to DRY up multiple configurations.
</p>
<p>
Now, in your models, use the <tt>is_indexed</tt> method to configure a
model as searchable. For example:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Post constant id'>Post</span>
    <span class='is_indexed identifier id'>is_indexed</span> <span class='symbol val'>:fields</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>'created_at'</span><span class='comma token'>,</span> <span class='string val'>'title'</span><span class='comma token'>,</span> <span class='string val'>'body'</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
</pre>
<p>
For more index options, see ActiveRecord::Base .is_indexed.
</p>
<h2>Building the index</h2>
<p>
Now run:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='ultrasphinx identifier id'>ultrasphinx</span><span class='symbol val'>:configure</span>
  <span class='rake identifier id'>rake</span> <span class='ultrasphinx identifier id'>ultrasphinx</span><span class='symbol val'>:index</span>
  <span class='rake identifier id'>rake</span> <span class='ultrasphinx identifier id'>ultrasphinx</span><span class='symbol val'>:daemon</span><span class='symbol val'>:start</span>
</pre>
<p>
To rotate the index, just rerun <tt>rake ultrasphinx:index</tt>. If the
search daemon is running, it will have its index rotated live. Otherwise
the new index will be installed but the daemon will remain stopped.
</p>
<h2>Running queries</h2>
<p>
Query the daemon as so:
</p>
<pre class="code">
  <span class='@search ivar id'>@search</span> <span class='assign token'>=</span> <span class='Ultrasphinx constant id'>Ultrasphinx</span><span class='colon2 op'>::</span><span class='Search constant id'>Search</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:query</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='@query ivar id'>@query</span><span class='rparen token'>)</span>
  <span class='@search ivar id'>@search</span><span class='dot token'>.</span><span class='run identifier id'>run</span>
  <span class='@search ivar id'>@search</span><span class='dot token'>.</span><span class='results identifier id'>results</span>
</pre>
<p>
For more query options, including excerpt mode, see Ultrasphinx::Search.
</p>
<h1>Extras</h1>
<h2>Pagination</h2>
<p>
Once the <tt>@search</tt> object has been <tt>run</tt>, it is directly
compatible with the <tt>will_paginate</tt> view helper. In your view, just
do:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>%= will_paginate(@search) %&gt;
</span></pre>
<h2>Spell checking</h2>
<p>
See Ultrasphinx::Spell.
</p>
<h2>Delta indexing</h2>
<p>
Delta indexing speeds up your updates by not reindexing the entire dataset
every time.
</p>
<p>
First, in your <tt>.base</tt> file, set the indexer option <tt>delta</tt>
to your maximum interval between full reindexes. A day or a week is good,
depending. Add a little bit to account for the time it takes the actual
index to run:
</p>
<pre class="code">
  <span class='delta identifier id'>delta</span> <span class='assign token'>=</span> <span class='lt op'>&lt;</span><span class='string val'>%= 1.day + 30.minutes %&gt;
</span></pre>
<p>
Now, configure your models for delta indexing in the <tt>is_indexed</tt>
call:
</p>
<pre class="code">
  <span class='is_indexed identifier id'>is_indexed</span> <span class='symbol val'>:fields</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>'created_at'</span><span class='comma token'>,</span> <span class='string val'>'title'</span><span class='comma token'>,</span> <span class='string val'>'body'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:delta</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
</pre>
<p>
Now you can run <tt>rake ultrasphinx:index:delta</tt> frequently, and only
records that were changed within 1 day will be reindexed. You will need to
run <tt>rake ultrasphinx:index:main</tt> once a day to move the delta
contents into the main index.
</p>
<p>
See ActiveRecord::Base .is_indexed and
DEPLOYMENT_NOTES[link:files/DEPLOYMENT_NOTES.html] for more.
</p>
<h2>Available Rake tasks</h2>
<p>
See RAKE_TASKS[link:files/RAKE_TASKS.html].
</p>
<h2>Deployment notes</h2>
<p>
See DEPLOYMENT_NOTES[link:files/DEPLOYMENT_NOTES.html].
</p>
<h2>Gotchas</h2>
<p>
Note that since Ultrasphinx preloads indexed models, you need to make sure
those models have their own dependencies in place early in the boot
process. This may require adjusting the general plugin load order or moving
monkey-patches from <tt>lib/</tt> to <tt>vendor/plugins/</tt>.
</p>
<p>
PostgreSQL 8.2 and higher are well supported. However, make sure the stored
procedure migration gets generated correctly. If you did not install the
plugin via <tt>script/install</tt>, run <tt>script/generate
ultrasphinx_migration</tt> by hand.
</p>
<h2>Reporting problems</h2>
<p>
The support forum is
here[http://rubyforge.org/forum/forum.php?forum_id=14244].
</p>
<p>
Patches and contributions are very welcome. Please note that contributors
are required to assign copyright for their additions to Cloudburst, LLC.
</p>
<h2>Further resources</h2>
<ul>
<li>http://sphinxsearch.com/doc.html

</li>
<li>http://sphinxsearch.com/forum/forum.html?id=1

</li>
<li>http://blog.evanweaver.com/articles/2007/07/09/ultrasphinx-searching-the-world-in-231-seconds

</li>
</ul>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>