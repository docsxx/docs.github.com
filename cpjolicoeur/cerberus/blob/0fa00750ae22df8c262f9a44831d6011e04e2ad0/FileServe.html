<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>cpjolicoeur's cerberus - Class: FileServe - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/cpjolicoeur/commits/cerberus/master" rel="alternate" title="Recent Commits to cerberus:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("cpjolicoeur", "cerberus", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("cpjolicoeur", "cerberus", "0fa00750ae22df8c262f9a44831d6011e04e2ad0", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/cpjolicoeur/cerberus/tree/">Source</a></li>
            <li class=""><a href="http://github.com/cpjolicoeur/cerberus/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/cpjolicoeur/cerberus/network">Network</a></li>            
            <li class=""><a href="http://github.com/cpjolicoeur/cerberus/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/cpjolicoeur/cerberus">Wiki</a></li>
            <li class=""><a href="http://github.com/cpjolicoeur/cerberus/graphs">Graphs</a></li>                    
            <li class="active"><a href="/cpjolicoeur/cerberus">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/cpjolicoeur">cpjolicoeur</a> / <b><a href="http://github.com/cpjolicoeur/cerberus/tree">cerberus</a></b>        
                <a id="namespaces_button" rel="cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class FileServe">
  <h1>Class: FileServe</h1>
  <div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(conf)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb', line 177</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0/lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb#L177">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='conf identifier id'>conf</span><span class='rparen token'>)</span>
  <span class='@uploads ivar id'>@uploads</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='@downloads ivar id'>@downloads</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='@transfers ivar id'>@transfers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@transfers_lock ivar id'>@transfers_lock</span> <span class='assign token'>=</span> <span class='Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

  <span class='@client ivar id'>@client</span> <span class='assign token'>=</span> <span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='Client constant id'>Client</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='JID constant id'>JID</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='conf identifier id'>conf</span><span class='lbrack token'>[</span><span class='string val'>'jabber'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'jid'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='@client ivar id'>@client</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span>
  <span class='@client ivar id'>@client</span><span class='dot token'>.</span><span class='auth identifier id'>auth</span><span class='lparen token'>(</span><span class='conf identifier id'>conf</span><span class='lbrack token'>[</span><span class='string val'>'jabber'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'password'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='@ft ivar id'>@ft</span> <span class='assign token'>=</span> <span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='FileTransfer constant id'>FileTransfer</span><span class='colon2 op'>::</span><span class='Helper constant id'>Helper</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@client ivar id'>@client</span><span class='rparen token'>)</span>
  <span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='Version constant id'>Version</span><span class='colon2 op'>::</span><span class='SimpleResponder constant id'>SimpleResponder</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@client ivar id'>@client</span><span class='comma token'>,</span>
                                     <span class='string val'>&quot;XMPP4R FileServe example&quot;</span><span class='comma token'>,</span>
                                     <span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='XMPP4R_VERSION constant id'>XMPP4R_VERSION</span><span class='comma token'>,</span>
                                     <span class='IO constant id'>IO</span><span class='dot token'>.</span><span class='popen identifier id'>popen</span><span class='lparen token'>(</span><span class='string val'>'uname -sr'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='readlines identifier id'>readlines</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='rparen token'>)</span>
  <span class='register_handlers identifier id'>register_handlers</span>

  <span class='@directory ivar id'>@directory</span> <span class='assign token'>=</span> <span class='conf identifier id'>conf</span><span class='lbrack token'>[</span><span class='string val'>'directory'</span><span class='rbrack token'>]</span>
  <span class='@directory ivar id'>@directory</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/\/+$/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>

  <span class='@socksserver ivar id'>@socksserver</span> <span class='assign token'>=</span> <span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='Bytestreams constant id'>Bytestreams</span><span class='colon2 op'>::</span><span class='SOCKS5BytestreamsServer constant id'>SOCKS5BytestreamsServer</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='conf identifier id'>conf</span><span class='lbrack token'>[</span><span class='string val'>'socks'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'port'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='conf identifier id'>conf</span><span class='lbrack token'>[</span><span class='string val'>'socks'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'addresses'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='addr identifier id'>addr</span><span class='bitor op'>|</span> <span class='@socksserver ivar id'>@socksserver</span><span class='dot token'>.</span><span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='addr identifier id'>addr</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>

  <span class='@proxies ivar id'>@proxies</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='conf identifier id'>conf</span><span class='lbrack token'>[</span><span class='string val'>'socks'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'proxies'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='jid identifier id'>jid</span><span class='bitor op'>|</span>
    <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Querying proxy #{jid}...&quot;</span>
    <span class='begin begin kw'>begin</span>
      <span class='@proxies ivar id'>@proxies</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='Bytestreams constant id'>Bytestreams</span><span class='colon2 op'>::</span><span class='SOCKS5Bytestreams constant id'>SOCKS5Bytestreams</span><span class='colon2 op'>::</span><span class='query_streamhost identifier id'>query_streamhost</span><span class='lparen token'>(</span><span class='@client ivar id'>@client</span><span class='comma token'>,</span> <span class='jid identifier id'>jid</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rescue rescue kw'>rescue</span>
      <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Error: #{$!}&quot;</span>
    <span class='end end kw'>end</span>
  <span class='rbrace token'>}</span>

  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='presence identifier id'>presence</span> <span class='rbrace token'>}</span>
  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='cleaner identifier id'>cleaner</span> <span class='rbrace token'>}</span>

  <span class='comment val'># Panic reboot ;-)</span>
  <span class='@client ivar id'>@client</span><span class='dot token'>.</span><span class='on_exception identifier id'>on_exception</span> <span class='lbrace token'>{</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='conf identifier id'>conf</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cleaner-instance_method">#cleaner</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#command-instance_method">#command</span><span class='args'>(from, cmd, arg)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#presence-instance_method">#presence</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#register_handlers-instance_method">#register_handlers</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#say-instance_method">#say</span><span class='args'>(to, text)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>cleaner</h3>
</div><div id="cleaner-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cleaner</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb', line 331</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0/lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb#L331">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">331
332
333
334
335
336
337
338
339
340</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cleaner identifier id'>cleaner</span>
  <span class='loop identifier id'>loop</span> <span class='lbrace token'>{</span>

    <span class='@transfers_lock ivar id'>@transfers_lock</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='@transfers ivar id'>@transfers</span><span class='dot token'>.</span><span class='delete_if identifier id'>delete_if</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='done? fid id'>done?</span> <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>

    <span class='sleep identifier id'>sleep</span> <span class='integer val'>1</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>command</h3>
</div><div id="command-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>command</span><span class='args'>(from, cmd, arg)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb', line 283</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0/lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb#L283">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='command identifier id'>command</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='comma token'>,</span> <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='arg identifier id'>arg</span><span class='rparen token'>)</span>
  <span class='say identifier id'>say</span> <span class='assign token'>=</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='text identifier id'>text</span><span class='bitor op'>|</span>
    <span class='say identifier id'>say</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='comma token'>,</span> <span class='text identifier id'>text</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
  <span class='socksconf identifier id'>socksconf</span> <span class='assign token'>=</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='stream identifier id'>stream</span><span class='bitor op'>|</span>
    <span class='stream identifier id'>stream</span><span class='dot token'>.</span><span class='add_streamhost identifier id'>add_streamhost</span><span class='lparen token'>(</span><span class='@socksserver ivar id'>@socksserver</span><span class='rparen token'>)</span>
    <span class='@proxies ivar id'>@proxies</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='sh identifier id'>sh</span><span class='bitor op'>|</span>
      <span class='stream identifier id'>stream</span><span class='dot token'>.</span><span class='add_streamhost identifier id'>add_streamhost</span><span class='lparen token'>(</span><span class='sh identifier id'>sh</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span>

  <span class='case case kw'>case</span> <span class='cmd identifier id'>cmd</span>
    <span class='when when kw'>when</span> <span class='string val'>'get'</span>
      <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/\//</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>
      <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/^\.+/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>
      <span class='transfer identifier id'>transfer</span> <span class='assign token'>=</span> <span class='Download constant id'>Download</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@ft ivar id'>@ft</span><span class='comma token'>,</span> <span class='from identifier id'>from</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{@directory}/#{arg}&quot;</span><span class='comma token'>,</span> <span class='say identifier id'>say</span><span class='comma token'>,</span> <span class='socksconf identifier id'>socksconf</span><span class='rparen token'>)</span>
      <span class='@downloads ivar id'>@downloads</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
      <span class='@transfers_lock ivar id'>@transfers_lock</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
        <span class='@transfers ivar id'>@transfers</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='transfer identifier id'>transfer</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
    <span class='when when kw'>when</span> <span class='string val'>'ls'</span>
      <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
      <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='foreach identifier id'>foreach</span><span class='lparen token'>(</span><span class='@directory ivar id'>@directory</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='file identifier id'>file</span><span class='bitor op'>|</span>
        <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='file identifier id'>file</span> <span class='match op'>=~</span> <span class='regexp val'>/^\./</span>
        <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{@directory}/#{file}&quot;</span>
        <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{file} (#{human_readable File.size(path)})\n&quot;</span> <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='file? fid id'>file?</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
      <span class='say identifier id'>say</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='text identifier id'>text</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='string val'>'stat'</span>
      <span class='@transfers_lock ivar id'>@transfers_lock</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
        <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{@transfers.size} transfers:\n&quot;</span>
        <span class='@transfers ivar id'>@transfers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span>
          <span class='text identifier id'>text</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;#{t.filename} (#{t.peer}): #{(t.bytes * 100) / t.filesize}% (#{human_readable t.stats}/s)\n&quot;</span>
        <span class='rbrace token'>}</span>
      <span class='rbrace token'>}</span>
      <span class='say identifier id'>say</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='text identifier id'>text</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='string val'>'help'</span>
      <span class='say identifier id'>say</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='string val'>&quot;Download a file: get &lt;filename&gt;\nList directory contents: ls\nLook who is currently wasting bandwidth: stat\nUpload a file, simply send this file&quot;</span>
    <span class='else else kw'>else</span>
      <span class='say identifier id'>say</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='dstring node'>&quot;Unknown command: #{cmd}, try help&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>presence</h3>
</div><div id="presence-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>presence</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb', line 219</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0/lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb#L219">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='presence identifier id'>presence</span>
  <span class='rate_upload identifier id'>rate_upload</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='rate_download identifier id'>rate_download</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

  <span class='old_status identifier id'>old_status</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='loop identifier id'>loop</span> <span class='lbrace token'>{</span>
    <span class='comment val'># Update the @rate_* variables</span>
    <span class='@transfers_lock ivar id'>@transfers_lock</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='@transfers ivar id'>@transfers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Upload constant id'>Upload</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='stats identifier id'>stats</span> <span class='gt op'>&gt;</span> <span class='rate_upload identifier id'>rate_upload</span>
          <span class='rate_upload identifier id'>rate_upload</span> <span class='assign token'>=</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='stats identifier id'>stats</span>
        <span class='elsif elsif kw'>elsif</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Download constant id'>Download</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='stats identifier id'>stats</span> <span class='gt op'>&gt;</span> <span class='rate_download identifier id'>rate_download</span>
          <span class='rate_download identifier id'>rate_download</span> <span class='assign token'>=</span> <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='stats identifier id'>stats</span>
        <span class='end end kw'>end</span>
      <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>
    <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;Attempted #{@downloads} downloads (max. #{human_readable rate_download}/s) and #{@uploads} uploads (max. #{human_readable rate_upload}/s)&quot;</span>

    <span class='@client ivar id'>@client</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='Presence constant id'>Presence</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:chat</span><span class='comma token'>,</span> <span class='status identifier id'>status</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='status identifier id'>status</span> <span class='neq op'>!=</span> <span class='old_status identifier id'>old_status</span>
    <span class='old_status identifier id'>old_status</span> <span class='assign token'>=</span> <span class='status identifier id'>status</span>

    <span class='sleep identifier id'>sleep</span> <span class='integer val'>1</span>

  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>register_handlers</h3>
</div><div id="register_handlers-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>register_handlers</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb', line 245</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0/lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb#L245">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='register_handlers identifier id'>register_handlers</span>
  <span class='@client ivar id'>@client</span><span class='dot token'>.</span><span class='add_message_callback identifier id'>add_message_callback</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='msg identifier id'>msg</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='msg identifier id'>msg</span><span class='dot token'>.</span><span class='type identifier id'>type</span> <span class='eq op'>==</span> <span class='symbol val'>:chat</span> <span class='and and kw'>and</span> <span class='msg identifier id'>msg</span><span class='dot token'>.</span><span class='body identifier id'>body</span> <span class='and and kw'>and</span> <span class='msg identifier id'>msg</span><span class='dot token'>.</span><span class='from identifier id'>from</span> <span class='neq op'>!=</span> <span class='string val'>'pentabarf@pentabarf.org/rails'</span>
      <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;&lt;#{msg.from}&gt; #{msg.body.strip}&quot;</span>
      <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='arg identifier id'>arg</span> <span class='assign token'>=</span> <span class='msg identifier id'>msg</span><span class='dot token'>.</span><span class='body identifier id'>body</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/ /</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>

      <span class='command identifier id'>command</span><span class='lparen token'>(</span><span class='msg identifier id'>msg</span><span class='dot token'>.</span><span class='from identifier id'>from</span><span class='comma token'>,</span> <span class='cmd identifier id'>cmd</span><span class='comma token'>,</span> <span class='arg identifier id'>arg</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='rbrace token'>}</span>

  <span class='@ft ivar id'>@ft</span><span class='dot token'>.</span><span class='add_incoming_callback identifier id'>add_incoming_callback</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='iq identifier id'>iq</span><span class='comma token'>,</span><span class='file identifier id'>file</span><span class='bitor op'>|</span>

    <span class='say identifier id'>say</span> <span class='assign token'>=</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='text identifier id'>text</span><span class='bitor op'>|</span>
      <span class='say identifier id'>say</span><span class='lparen token'>(</span><span class='iq identifier id'>iq</span><span class='dot token'>.</span><span class='from identifier id'>from</span><span class='comma token'>,</span> <span class='text identifier id'>text</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>

    <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Incoming file transfer from #{iq.from}: #{file.fname} (#{file.size / 1024} KB)&quot;</span>
    <span class='filename identifier id'>filename</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='fname identifier id'>fname</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/\//</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
    <span class='filename identifier id'>filename</span><span class='dot token'>.</span><span class='gsub! fid id'>gsub!</span><span class='lparen token'>(</span><span class='regexp val'>/^\.+/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>

    <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;Range: #{file.range != nil}&quot;</span>
    <span class='transfer identifier id'>transfer</span> <span class='assign token'>=</span> <span class='Upload constant id'>Upload</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@ft ivar id'>@ft</span><span class='comma token'>,</span> <span class='iq identifier id'>iq</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{@directory}/#{filename}&quot;</span><span class='comma token'>,</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='range identifier id'>range</span> <span class='neq op'>!=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='say identifier id'>say</span><span class='rparen token'>)</span>
    <span class='@uploads ivar id'>@uploads</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>

    <span class='@transfers_lock ivar id'>@transfers_lock</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='@transfers ivar id'>@transfers</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='transfer identifier id'>transfer</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>

  <span class='rbrace token'>}</span>

  <span class='roster identifier id'>roster</span> <span class='assign token'>=</span> <span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='Roster constant id'>Roster</span><span class='colon2 op'>::</span><span class='Helper constant id'>Helper</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@client ivar id'>@client</span><span class='rparen token'>)</span>

  <span class='roster identifier id'>roster</span><span class='dot token'>.</span><span class='add_subscription_request_callback identifier id'>add_subscription_request_callback</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='item identifier id'>item</span><span class='comma token'>,</span><span class='presence identifier id'>presence</span><span class='bitor op'>|</span>
    <span class='roster identifier id'>roster</span><span class='dot token'>.</span><span class='accept_subscription identifier id'>accept_subscription</span><span class='lparen token'>(</span><span class='presence identifier id'>presence</span><span class='dot token'>.</span><span class='from identifier id'>from</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>

<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>say</h3>
</div><div id="say-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>say</span><span class='args'>(to, text)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb', line 326</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/cpjolicoeur/cerberus/blob/0fa00750ae22df8c262f9a44831d6011e04e2ad0/lib/vendor/xmpp4r/data/doc/xmpp4r/examples/advanced/fileserve.rb#L326">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">326
327
328
329</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='say identifier id'>say</span><span class='lparen token'>(</span><span class='to identifier id'>to</span><span class='comma token'>,</span> <span class='text identifier id'>text</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;&gt;#{to}&lt; #{text.strip}&quot;</span>
  <span class='@client ivar id'>@client</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='Jabber constant id'>Jabber</span><span class='colon2 op'>::</span><span class='Message constant id'>Message</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='to identifier id'>to</span><span class='comma token'>,</span> <span class='text identifier id'>text</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='set_type identifier id'>set_type</span><span class='lparen token'>(</span><span class='symbol val'>:chat</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>