<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>rubyrep's rubyrep - Class: RR::ReplicationInitializer - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/rubyrep/commits/rubyrep/master" rel="alternate" title="Recent Commits to rubyrep:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("rubyrep", "rubyrep", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("rubyrep", "rubyrep", "64a23bf39a24022e6750b440453796498b882b0e", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/rubyrep/rubyrep/tree/">Source</a></li>
            <li class=""><a href="http://github.com/rubyrep/rubyrep/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/rubyrep/rubyrep/network">Network</a></li>            
            <li class=""><a href="http://github.com/rubyrep/rubyrep/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/rubyrep/rubyrep">Wiki</a></li>
            <li class=""><a href="http://github.com/rubyrep/rubyrep/graphs">Graphs</a></li>                    
            <li class="active"><a href="/rubyrep/rubyrep">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/rubyrep">rubyrep</a> / <b><a href="http://github.com/rubyrep/rubyrep/tree">rubyrep</a></b>        
                <a id="namespaces_button" rel="rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class RR_ReplicationInitializer">
  <h1>Class: RR::ReplicationInitializer</h1>
  <div class="section docstring">
  <p>
Ensures all preconditions are met to start with replication
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">session</td>
          <td class="readwrite">
            [<span id='session-instance_method'>R</span><span id='session=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The active Session.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="DESCRIPTION_SIZE-constant">DESCRIPTION_SIZE</dt>
      <dd>255</dd>
    
      <dt id="DIFF_DUMP_SIZE-constant">DIFF_DUMP_SIZE</dt>
      <dd>2000</dd>
    
      <dt id="LONG_DESCRIPTION_SIZE-constant">LONG_DESCRIPTION_SIZE</dt>
      <dd>1000</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(session)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates a new RepInititializer for the given Session
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 14</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L14">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">14
15
16</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='session identifier id'>session</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='session identifier id'>session</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#change_log_exists-3F-instance_method">#change_log_exists?</span><span class='args'>(database)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns <tt>true</tt> if the change log exists in the specified database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#clear_sequence_setup-instance_method">#clear_sequence_setup</span><span class='args'>(database, table)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Restores the original sequence settings for the named table.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_change_log-instance_method">#create_change_log</span><span class='args'>(database)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates the change log table in the specified database
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>.

</li>
</ul>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_event_log-instance_method">#create_event_log</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates the replication log table.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_trigger-instance_method">#create_trigger</span><span class='args'>(database, table)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates a trigger logging all table changes
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
<li>table: name of the table.

</li>
</ul>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_activity_markers-instance_method">#drop_activity_markers</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks in both databases, if the activity_marker tables exist.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_change_log-instance_method">#drop_change_log</span><span class='args'>(database)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Drops the change log table in the specified database
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>.

</li>
</ul>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_change_logs-instance_method">#drop_change_logs</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks in both databases, if the change_log tables exist.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_event_log-instance_method">#drop_event_log</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Drops the replication log table.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_infrastructure-instance_method">#drop_infrastructure</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Removes all rubyrep infrastructure tables from both databases.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_trigger-instance_method">#drop_trigger</span><span class='args'>(database, table)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Drops the replication trigger of the named table.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ensure_activity_markers-instance_method">#ensure_activity_markers</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks in both databases, if the activity marker tables exist and if not,
creates them.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ensure_change_logs-instance_method">#ensure_change_logs</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks in both databases, if the change log tables exists and creates them
if necessary.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ensure_event_log-instance_method">#ensure_event_log</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks if the event log table already exists and creates it if necessary.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ensure_infrastructure-instance_method">#ensure_infrastructure</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks in both databases, if the infrastructure tables (change log, event
log) exist and creates them if necessary.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ensure_sequence_setup-instance_method">#ensure_sequence_setup</span><span class='args'>(table_pair, increment, left_offset, right_offset)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Ensures that the sequences of the named table (normally the primary key
column) are generated with the correct increment and offset in both left
and right database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#event_log_exists-3F-instance_method">#event_log_exists?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns <tt>true</tt> if the replication log exists.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#exclude_rubyrep_tables-instance_method">#exclude_rubyrep_tables</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds to the current session&#8217;s configuration an exclusion of rubyrep
tables.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#options-instance_method">#options</span><span class='args'>(table = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the options for the given table.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#prepare_replication-instance_method">#prepare_replication</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Prepares the database / tables for replication.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#restore_unconfigured_tables-instance_method">#restore_unconfigured_tables</span><span class='args'>(configured_table_pairs = session.configured_table_pairs)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Checks for tables that have triggers but are not in the list of configured
tables.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#silence_ddl_notices-instance_method">#silence_ddl_notices</span><span class='args'>(database)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Ensures that create_table and related statements don&#8217;t print notices
to stdout.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#trigger_exists-3F-instance_method">#trigger_exists?</span><span class='args'>(database, table)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns <tt>true</tt> if the replication trigger for the given table
exists.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>change_log_exists?</h3>
</div><div id="change_log_exists-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>change_log_exists?</span><span class='args'>(database)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns <tt>true</tt> if the change log exists in the specified database.
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 104</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L104">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">104
105
106</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='change_log_exists? fid id'>change_log_exists?</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='tables identifier id'>tables</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_pending_changes&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>clear_sequence_setup</h3>
</div><div id="clear_sequence_setup-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>clear_sequence_setup</span><span class='args'>(database, table)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Restores the original sequence settings for the named table. (Actually it
sets the sequence increment to 1. If before, it had a different value, then
the restoration will not be correct.)
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
<li><tt>table_name</tt>: name of the table

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 93</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L93">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">93
94
95
96
97
98
99
100</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='clear_sequence_setup identifier id'>clear_sequence_setup</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table identifier id'>table</span><span class='rparen token'>)</span>
  <span class='table_options identifier id'>table_options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lparen token'>(</span><span class='table identifier id'>table</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:adjust_sequences</span><span class='rbrack token'>]</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='clear_sequence_setup identifier id'>clear_sequence_setup</span><span class='lparen token'>(</span>
      <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:rep_prefix</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='table identifier id'>table</span>
    <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_change_log</h3>
</div><div id="create_change_log-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_change_log</span><span class='args'>(database)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates the change log table in the specified database
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 170</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L170">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">170
171
172
173
174
175
176
177
178
179
180
181</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_change_log identifier id'>create_change_log</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span>
  <span class='silence_ddl_notices identifier id'>silence_ddl_notices</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='create_table identifier id'>create_table</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_pending_changes&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:change_table</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:change_key</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:change_new_key</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:change_type</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:change_time</span><span class='comma token'>,</span> <span class='symbol val'>:timestamp</span>
    <span class='end end kw'>end</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='add_big_primary_key identifier id'>add_big_primary_key</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_pending_changes&quot;</span><span class='comma token'>,</span> <span class='string val'>'id'</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_event_log</h3>
</div><div id="create_event_log-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_event_log</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates the replication log table.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 150</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L150">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_event_log identifier id'>create_event_log</span>
  <span class='silence_ddl_notices identifier id'>silence_ddl_notices</span><span class='lparen token'>(</span><span class='symbol val'>:left</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='left identifier id'>left</span><span class='dot token'>.</span><span class='create_table identifier id'>create_table</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_logged_events&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:activity</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:change_table</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:diff_type</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:change_key</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:left_change_type</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:right_change_type</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:description</span><span class='comma token'>,</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='DESCRIPTION_SIZE constant id'>DESCRIPTION_SIZE</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:long_description</span><span class='comma token'>,</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='LONG_DESCRIPTION_SIZE constant id'>LONG_DESCRIPTION_SIZE</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:event_time</span><span class='comma token'>,</span> <span class='symbol val'>:timestamp</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:diff_dump</span><span class='comma token'>,</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='DIFF_DUMP_SIZE constant id'>DIFF_DUMP_SIZE</span>
    <span class='end end kw'>end</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='left identifier id'>left</span><span class='dot token'>.</span><span class='add_big_primary_key identifier id'>add_big_primary_key</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_logged_events&quot;</span><span class='comma token'>,</span> <span class='string val'>'id'</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_trigger</h3>
</div><div id="create_trigger-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_trigger</span><span class='args'>(database, table)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates a trigger logging all table changes
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
<li>table: name of the table

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 31</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L31">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">31
32
33
34
35
36
37
38
39
40
41
42
43
44
45</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_trigger identifier id'>create_trigger</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table identifier id'>table</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lparen token'>(</span><span class='table identifier id'>table</span><span class='rparen token'>)</span>

  <span class='params identifier id'>params</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:trigger_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_#{table}&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:table</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='table identifier id'>table</span><span class='comma token'>,</span>
    <span class='symbol val'>:keys</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='primary_key_names identifier id'>primary_key_names</span><span class='lparen token'>(</span><span class='table identifier id'>table</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='symbol val'>:log_table</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_pending_changes&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:activity_table</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_running_flags&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:key_sep</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:key_sep</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:exclude_rr_activity</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span>

  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='create_replication_trigger identifier id'>create_replication_trigger</span> <span class='params identifier id'>params</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_activity_markers</h3>
</div><div id="drop_activity_markers-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_activity_markers</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks in both databases, if the activity_marker tables exist. If yes,
drops them.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 230</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L230">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">230
231
232
233
234
235
236
237</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_activity_markers identifier id'>drop_activity_markers</span>
  <span class='table_name identifier id'>table_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_running_flags&quot;</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='comma token'>,</span> <span class='symbol val'>:right</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='database identifier id'>database</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='tables identifier id'>tables</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='table_name identifier id'>table_name</span>
      <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='drop_table identifier id'>drop_table</span> <span class='table_name identifier id'>table_name</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_change_log</h3>
</div><div id="drop_change_log-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_change_log</span><span class='args'>(database)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Drops the change log table in the specified database
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 115</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L115">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">115
116
117</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_change_log identifier id'>drop_change_log</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='drop_table identifier id'>drop_table</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_pending_changes&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_change_logs</h3>
</div><div id="drop_change_logs-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_change_logs</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks in both databases, if the change_log tables exist. If yes, drops
them.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 223</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L223">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">223
224
225
226
227</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_change_logs identifier id'>drop_change_logs</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='comma token'>,</span> <span class='symbol val'>:right</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='database identifier id'>database</span><span class='bitor op'>|</span>
    <span class='drop_change_log identifier id'>drop_change_log</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='change_log_exists? fid id'>change_log_exists?</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_event_log</h3>
</div><div id="drop_event_log-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_event_log</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Drops the replication log table.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 120</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L120">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">120
121
122</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_event_log identifier id'>drop_event_log</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='left identifier id'>left</span><span class='dot token'>.</span><span class='drop_table identifier id'>drop_table</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_logged_events&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_infrastructure</h3>
</div><div id="drop_infrastructure-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_infrastructure</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Removes all rubyrep infrastructure tables from both databases.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 240</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L240">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">240
241
242
243
244</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_infrastructure identifier id'>drop_infrastructure</span>
  <span class='drop_event_log identifier id'>drop_event_log</span> <span class='if if_mod kw'>if</span> <span class='event_log_exists? fid id'>event_log_exists?</span>
  <span class='drop_change_logs identifier id'>drop_change_logs</span>
  <span class='drop_activity_markers identifier id'>drop_activity_markers</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_trigger</h3>
</div><div id="drop_trigger-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_trigger</span><span class='args'>(database, table)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Drops the replication trigger of the named table.
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
<li>table: name of the table

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 58</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L58">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">58
59
60
61</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_trigger identifier id'>drop_trigger</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table identifier id'>table</span><span class='rparen token'>)</span>
  <span class='trigger_name identifier id'>trigger_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{options(table)[:rep_prefix]}_#{table}&quot;</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='drop_replication_trigger identifier id'>drop_replication_trigger</span> <span class='trigger_name identifier id'>trigger_name</span><span class='comma token'>,</span> <span class='table identifier id'>table</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ensure_activity_markers</h3>
</div><div id="ensure_activity_markers-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ensure_activity_markers</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks in both databases, if the activity marker tables exist and if not,
creates them.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 190</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L190">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">190
191
192
193
194
195
196
197
198
199</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ensure_activity_markers identifier id'>ensure_activity_markers</span>
  <span class='table_name identifier id'>table_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_running_flags&quot;</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='comma token'>,</span> <span class='symbol val'>:right</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='database identifier id'>database</span><span class='bitor op'>|</span>
    <span class='unless unless kw'>unless</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='tables identifier id'>tables</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='table_name identifier id'>table_name</span>
      <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='create_table identifier id'>create_table</span> <span class='table_name identifier id'>table_name</span><span class='comma token'>,</span> <span class='symbol val'>:id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span>
        <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='column identifier id'>column</span> <span class='symbol val'>:active</span><span class='comma token'>,</span> <span class='symbol val'>:integer</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ensure_change_logs</h3>
</div><div id="ensure_change_logs-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ensure_change_logs</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks in both databases, if the change log tables exists and creates them
if necessary
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 208</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L208">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">208
209
210
211
212</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ensure_change_logs identifier id'>ensure_change_logs</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='comma token'>,</span> <span class='symbol val'>:right</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='database identifier id'>database</span><span class='bitor op'>|</span>
    <span class='create_change_log identifier id'>create_change_log</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='change_log_exists? fid id'>change_log_exists?</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ensure_event_log</h3>
</div><div id="ensure_event_log-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ensure_event_log</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks if the event log table already exists and creates it if necessary
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 202</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L202">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">202
203
204</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ensure_event_log identifier id'>ensure_event_log</span>
  <span class='create_event_log identifier id'>create_event_log</span> <span class='unless unless_mod kw'>unless</span> <span class='event_log_exists? fid id'>event_log_exists?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ensure_infrastructure</h3>
</div><div id="ensure_infrastructure-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ensure_infrastructure</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks in both databases, if the infrastructure tables (change log, event
log) exist and creates them if necessary.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 216</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L216">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">216
217
218
219
220</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ensure_infrastructure identifier id'>ensure_infrastructure</span>
  <span class='ensure_activity_markers identifier id'>ensure_activity_markers</span>
  <span class='ensure_change_logs identifier id'>ensure_change_logs</span>
  <span class='ensure_event_log identifier id'>ensure_event_log</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ensure_sequence_setup</h3>
</div><div id="ensure_sequence_setup-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ensure_sequence_setup</span><span class='args'>(table_pair, increment, left_offset, right_offset)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Ensures that the sequences of the named table (normally the primary key
column) are generated with the correct increment and offset in both left
and right database. The sequence is always updated in both databases.
</p>
<ul>
<li><tt>table_pair</tt>: a hash of names of corresponding :left and :right
tables

</li>
<li><tt>increment</tt>: increment of the sequence

</li>
<li><tt>left_offset</tt>: offset of table in left database

</li>
<li><tt>right_offset</tt>: offset of table in right database

</li>
</ul>
<ol>
<li type="A">g. an increment of 2 and offset of 1 will lead to generation of odd

</li>
</ol>
<p>
numbers.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 73</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L73">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">73
74
75
76
77
78
79
80
81
82
83
84
85
86</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ensure_sequence_setup identifier id'>ensure_sequence_setup</span><span class='lparen token'>(</span><span class='table_pair identifier id'>table_pair</span><span class='comma token'>,</span> <span class='increment identifier id'>increment</span><span class='comma token'>,</span> <span class='left_offset identifier id'>left_offset</span><span class='comma token'>,</span> <span class='right_offset identifier id'>right_offset</span><span class='rparen token'>)</span>
  <span class='table_options identifier id'>table_options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lparen token'>(</span><span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:adjust_sequences</span><span class='rbrack token'>]</span>
    <span class='rep_prefix identifier id'>rep_prefix</span> <span class='assign token'>=</span> <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:rep_prefix</span><span class='rbrack token'>]</span>
    <span class='left_sequence_values identifier id'>left_sequence_values</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='left identifier id'>left</span><span class='dot token'>.</span><span class='sequence_values identifier id'>sequence_values</span> <span class='rep_prefix identifier id'>rep_prefix</span><span class='comma token'>,</span> <span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='rbrack token'>]</span>
    <span class='right_sequence_values identifier id'>right_sequence_values</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='right identifier id'>right</span><span class='dot token'>.</span><span class='sequence_values identifier id'>sequence_values</span> <span class='rep_prefix identifier id'>rep_prefix</span><span class='comma token'>,</span> <span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='symbol val'>:right</span><span class='rbrack token'>]</span>
    <span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='comma token'>,</span> <span class='symbol val'>:right</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='database identifier id'>database</span><span class='bitor op'>|</span>
      <span class='offset identifier id'>offset</span> <span class='assign token'>=</span> <span class='database identifier id'>database</span> <span class='eq op'>==</span> <span class='symbol val'>:left</span> <span class='question op'>?</span> <span class='left_offset identifier id'>left_offset</span> <span class='colon op'>:</span> <span class='right_offset identifier id'>right_offset</span>
      <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='update_sequences identifier id'>update_sequences</span> \
        <span class='rep_prefix identifier id'>rep_prefix</span><span class='comma token'>,</span> <span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='database identifier id'>database</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='increment identifier id'>increment</span><span class='comma token'>,</span> <span class='offset identifier id'>offset</span><span class='comma token'>,</span>
        <span class='left_sequence_values identifier id'>left_sequence_values</span><span class='comma token'>,</span> <span class='right_sequence_values identifier id'>right_sequence_values</span><span class='comma token'>,</span> <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:sequence_adjustment_buffer</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>event_log_exists?</h3>
</div><div id="event_log_exists-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>event_log_exists?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns <tt>true</tt> if the replication log exists.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 109</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L109">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">109
110
111</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='event_log_exists? fid id'>event_log_exists?</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='left identifier id'>left</span><span class='dot token'>.</span><span class='tables identifier id'>tables</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='dstring node'>&quot;#{options[:rep_prefix]}_logged_events&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>exclude_rubyrep_tables</h3>
</div><div id="exclude_rubyrep_tables-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>exclude_rubyrep_tables</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds to the current session&#8217;s configuration an exclusion of rubyrep
tables.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 184</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L184">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">184
185
186</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='exclude_rubyrep_tables identifier id'>exclude_rubyrep_tables</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='exclude_rubyrep_tables identifier id'>exclude_rubyrep_tables</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>options</h3>
</div><div id="options-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>options</span><span class='args'>(table = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the options for the given table. If table is <tt>nil</tt>, returns
general options.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 20</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L20">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">20
21
22
23
24
25
26</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='options identifier id'>options</span><span class='lparen token'>(</span><span class='table identifier id'>table</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='table identifier id'>table</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='options_for_table identifier id'>options_for_table</span> <span class='table identifier id'>table</span>
  <span class='else else kw'>else</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='options identifier id'>options</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>prepare_replication</h3>
</div><div id="prepare_replication-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>prepare_replication</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Prepares the database / tables for replication.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 266</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L266">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='prepare_replication identifier id'>prepare_replication</span>
  <span class='exclude_rubyrep_tables identifier id'>exclude_rubyrep_tables</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Verifying RubyRep tables&quot;</span>
  <span class='ensure_infrastructure identifier id'>ensure_infrastructure</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Checking for and removing rubyrep triggers from unconfigured tables&quot;</span>
  <span class='restore_unconfigured_tables identifier id'>restore_unconfigured_tables</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Verifying rubyrep triggers of configured tables&quot;</span>
  <span class='unsynced_table_pairs identifier id'>unsynced_table_pairs</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='table_pairs identifier id'>table_pairs</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='sort_table_pairs identifier id'>sort_table_pairs</span><span class='lparen token'>(</span><span class='session identifier id'>session</span><span class='dot token'>.</span><span class='configured_table_pairs identifier id'>configured_table_pairs</span><span class='rparen token'>)</span>
  <span class='table_pairs identifier id'>table_pairs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='table_pair identifier id'>table_pair</span><span class='bitor op'>|</span>
    <span class='table_options identifier id'>table_options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lparen token'>(</span><span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='ensure_sequence_setup identifier id'>ensure_sequence_setup</span> <span class='table_pair identifier id'>table_pair</span><span class='comma token'>,</span>
      <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:sequence_increment</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:left_sequence_offset</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='table_options identifier id'>table_options</span><span class='lbrack token'>[</span><span class='symbol val'>:right_sequence_offset</span><span class='rbrack token'>]</span>

    <span class='unsynced identifier id'>unsynced</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='comma token'>,</span> <span class='symbol val'>:right</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='database identifier id'>database</span><span class='bitor op'>|</span>
      <span class='unless unless kw'>unless</span> <span class='trigger_exists? fid id'>trigger_exists?</span> <span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='database identifier id'>database</span><span class='rbrack token'>]</span>
        <span class='create_trigger identifier id'>create_trigger</span> <span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='database identifier id'>database</span><span class='rbrack token'>]</span>
        <span class='unsynced identifier id'>unsynced</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='unsynced_table_pairs identifier id'>unsynced_table_pairs</span> <span class='lshft op'>&lt;&lt;</span> <span class='table_pair identifier id'>table_pair</span> <span class='if if_mod kw'>if</span> <span class='unsynced identifier id'>unsynced</span>
  <span class='end end kw'>end</span>
  <span class='unsynced_table_specs identifier id'>unsynced_table_specs</span> <span class='assign token'>=</span> <span class='unsynced_table_pairs identifier id'>unsynced_table_pairs</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='table_pair identifier id'>table_pair</span><span class='bitor op'>|</span>
    <span class='dstring node'>&quot;#{table_pair[:left]}, #{table_pair[:right]}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='unless unless kw'>unless</span> <span class='unsynced_table_specs identifier id'>unsynced_table_specs</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Executing initial table syncs&quot;</span>
    <span class='runner identifier id'>runner</span> <span class='assign token'>=</span> <span class='SyncRunner constant id'>SyncRunner</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='runner identifier id'>runner</span><span class='dot token'>.</span><span class='session identifier id'>session</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span>
    <span class='runner identifier id'>runner</span><span class='dot token'>.</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:table_specs</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='unsynced_table_specs identifier id'>unsynced_table_specs</span><span class='rbrace token'>}</span>
    <span class='runner identifier id'>runner</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span>
  <span class='end end kw'>end</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Starting replication&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>restore_unconfigured_tables</h3>
</div><div id="restore_unconfigured_tables-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>restore_unconfigured_tables</span><span class='args'>(configured_table_pairs = session.configured_table_pairs)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Checks for tables that have triggers but are not in the list of configured
tables. Removes triggers and restores sequences of those tables.
</p>
<ul>
<li><tt>configured_table_pairs</tt>: An array of table pairs (e. g. [{:left
=&gt; &#8216;xy&#8217;, :right =&gt; &#8216;xy2&#8217;}]).

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 250</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L250">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">250
251
252
253
254
255
256
257
258
259
260
261
262
263</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='restore_unconfigured_tables identifier id'>restore_unconfigured_tables</span><span class='lparen token'>(</span><span class='configured_table_pairs identifier id'>configured_table_pairs</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='configured_table_pairs identifier id'>configured_table_pairs</span><span class='rparen token'>)</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:left</span><span class='comma token'>,</span> <span class='symbol val'>:right</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='database identifier id'>database</span><span class='bitor op'>|</span>
    <span class='configured_tables identifier id'>configured_tables</span> <span class='assign token'>=</span> <span class='configured_table_pairs identifier id'>configured_table_pairs</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='table_pair identifier id'>table_pair</span><span class='bitor op'>|</span> <span class='table_pair identifier id'>table_pair</span><span class='lbrack token'>[</span><span class='database identifier id'>database</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
    <span class='unconfigured_tables identifier id'>unconfigured_tables</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='tables identifier id'>tables</span> <span class='minus op'>-</span> <span class='configured_tables identifier id'>configured_tables</span>
    <span class='unconfigured_tables identifier id'>unconfigured_tables</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='table identifier id'>table</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='trigger_exists? fid id'>trigger_exists?</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table identifier id'>table</span><span class='rparen token'>)</span>
        <span class='drop_trigger identifier id'>drop_trigger</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table identifier id'>table</span><span class='rparen token'>)</span>
        <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span><span class='lparen token'>(</span>
          <span class='dstring node'>&quot;delete from #{options[:rep_prefix]}_pending_changes where change_table = '#{table}'&quot;</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='clear_sequence_setup identifier id'>clear_sequence_setup</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table identifier id'>table</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>silence_ddl_notices</h3>
</div><div id="silence_ddl_notices-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>silence_ddl_notices</span><span class='args'>(database)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Ensures that create_table and related statements don&#8217;t print notices
to stdout. Then restored original message setting.
</p>
<ul>
<li><tt>database</tt>: either :<tt>left</tt> or :<tt>right</tt>

</li>
</ul>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 136</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L136">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">136
137
138
139
140
141
142
143
144
145
146
147</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='silence_ddl_notices identifier id'>silence_ddl_notices</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='symbol val'>:adapter</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/postgres/</span>
    <span class='old_message_level identifier id'>old_message_level</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span>
      <span class='select_one identifier id'>select_one</span><span class='lparen token'>(</span><span class='string val'>&quot;show client_min_messages&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='string val'>'client_min_messages'</span><span class='rbrack token'>]</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span> <span class='string val'>&quot;set client_min_messages = warning&quot;</span>
  <span class='end end kw'>end</span>
  <span class='yield yield kw'>yield</span>
<span class='ensure ensure kw'>ensure</span>
  <span class='if if kw'>if</span> <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='symbol val'>:adapter</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/postgres/</span>
    <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span> <span class='dstring node'>&quot;set client_min_messages = #{old_message_level}&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>trigger_exists?</h3>
</div><div id="trigger_exists-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>trigger_exists?</span><span class='args'>(database, table)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns <tt>true</tt> if the replication trigger for the given table
exists.
</p>
<ul>
<li>database: either :<tt>left</tt> or :<tt>right</tt>

</li>
<li>table: name of the table

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rubyrep/replication_initializer.rb', line 50</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rubyrep/rubyrep/blob/64a23bf39a24022e6750b440453796498b882b0e/lib/rubyrep/replication_initializer.rb#L50">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">50
51
52
53</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='trigger_exists? fid id'>trigger_exists?</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='table identifier id'>table</span><span class='rparen token'>)</span>
  <span class='trigger_name identifier id'>trigger_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{options(table)[:rep_prefix]}_#{table}&quot;</span>
  <span class='session identifier id'>session</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='replication_trigger_exists? fid id'>replication_trigger_exists?</span> <span class='trigger_name identifier id'>trigger_name</span><span class='comma token'>,</span> <span class='table identifier id'>table</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>