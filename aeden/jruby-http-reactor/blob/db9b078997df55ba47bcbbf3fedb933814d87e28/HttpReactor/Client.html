<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>aeden's jruby-http-reactor - Class: HttpReactor::Client - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/aeden/commits/jruby-http-reactor/master" rel="alternate" title="Recent Commits to jruby-http-reactor:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("aeden", "jruby-http-reactor", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='aeden/jruby-http-reactor/blob/db9b078997df55ba47bcbbf3fedb933814d87e28' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='aeden/jruby-http-reactor/blob/db9b078997df55ba47bcbbf3fedb933814d87e28' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("aeden", "jruby-http-reactor", "db9b078997df55ba47bcbbf3fedb933814d87e28", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/aeden/jruby-http-reactor/tree/">Source</a></li>
            <li class=""><a href="http://github.com/aeden/jruby-http-reactor/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/aeden/jruby-http-reactor/network">Network</a></li>            
            <li class=""><a href="http://github.com/aeden/jruby-http-reactor/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/aeden/jruby-http-reactor">Wiki</a></li>
            <li class=""><a href="http://github.com/aeden/jruby-http-reactor/graphs">Graphs</a></li>                    
            <li class="active"><a href="/aeden/jruby-http-reactor">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/aeden">aeden</a> / <b><a href="http://github.com/aeden/jruby-http-reactor/tree">jruby-http-reactor</a></b>        
                <a id="namespaces_button" rel="aeden/jruby-http-reactor/blob/db9b078997df55ba47bcbbf3fedb933814d87e28" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="aeden/jruby-http-reactor/blob/db9b078997df55ba47bcbbf3fedb933814d87e28" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class HttpReactor_Client">
  <h1>Class: HttpReactor::Client</h1>
  <div class="section docstring">
  <p>
An HTTP client that uses the Reactor pattern.
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(uris = [], handler_proc = nil, session_request_callback = SessionRequestCallback)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create a new HttpReactor client that will request the given URIs.
</p>
<p>
Parameters:
</p>
<ul>
<li><tt>uris</tt>: An array of URI objects.

</li>
<li><tt>handler_proc</tt>: A Proc that will be called with the response and
context

</li>
<li><tt>session_request_callback</tt>: A class that implements the session
request callback interface found in the HttpCore library.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/http_reactor/client.rb', line 116</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/aeden/jruby-http-reactor/blob/db9b078997df55ba47bcbbf3fedb933814d87e28/lib/http_reactor/client.rb#L116">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='uris identifier id'>uris</span><span class='assign token'>=</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='handler_proc identifier id'>handler_proc</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='session_request_callback identifier id'>session_request_callback</span><span class='assign token'>=</span><span class='SessionRequestCallback constant id'>SessionRequestCallback</span><span class='rparen token'>)</span>
  <span class='handler_proc identifier id'>handler_proc</span> <span class='opasgn op'>||=</span> <span class='default_handler_proc identifier id'>default_handler_proc</span>
  
  <span class='params identifier id'>params</span> <span class='assign token'>=</span> <span class='BasicHttpParams constant id'>BasicHttpParams</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='set_int_parameter identifier id'>set_int_parameter</span><span class='lparen token'>(</span><span class='CoreConnectionPNames constant id'>CoreConnectionPNames</span><span class='dot token'>.</span><span class='SO_TIMEOUT constant id'>SO_TIMEOUT</span><span class='comma token'>,</span> <span class='integer val'>5000</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='set_int_parameter identifier id'>set_int_parameter</span><span class='lparen token'>(</span><span class='CoreConnectionPNames constant id'>CoreConnectionPNames</span><span class='dot token'>.</span><span class='CONNECTION_TIMEOUT constant id'>CONNECTION_TIMEOUT</span><span class='comma token'>,</span> <span class='integer val'>10000</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='set_int_parameter identifier id'>set_int_parameter</span><span class='lparen token'>(</span><span class='CoreConnectionPNames constant id'>CoreConnectionPNames</span><span class='dot token'>.</span><span class='SOCKET_BUFFER_SIZE constant id'>SOCKET_BUFFER_SIZE</span><span class='comma token'>,</span> <span class='integer val'>8</span> <span class='mult op'>*</span> <span class='integer val'>1024</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='set_boolean_parameter identifier id'>set_boolean_parameter</span><span class='lparen token'>(</span><span class='CoreConnectionPNames constant id'>CoreConnectionPNames</span><span class='dot token'>.</span><span class='STALE_CONNECTION_CHECK constant id'>STALE_CONNECTION_CHECK</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='set_boolean_parameter identifier id'>set_boolean_parameter</span><span class='lparen token'>(</span><span class='CoreConnectionPNames constant id'>CoreConnectionPNames</span><span class='dot token'>.</span><span class='TCP_NODELAY constant id'>TCP_NODELAY</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span><span class='dot token'>.</span><span class='set_parameter identifier id'>set_parameter</span><span class='lparen token'>(</span><span class='CoreProtocolPNames constant id'>CoreProtocolPNames</span><span class='dot token'>.</span><span class='USER_AGENT constant id'>USER_AGENT</span><span class='comma token'>,</span> <span class='string val'>&quot;JRubyHttpReactor/0.0.1&quot;</span><span class='rparen token'>)</span>
  
  <span class='io_reactor identifier id'>io_reactor</span> <span class='assign token'>=</span> <span class='DefaultConnectingIOReactor constant id'>DefaultConnectingIOReactor</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  
  <span class='httpproc identifier id'>httpproc</span> <span class='assign token'>=</span> <span class='BasicHttpProcessor constant id'>BasicHttpProcessor</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='semicolon token'>;</span>
  <span class='httpproc identifier id'>httpproc</span><span class='dot token'>.</span><span class='add_interceptor identifier id'>add_interceptor</span><span class='lparen token'>(</span><span class='RequestContent constant id'>RequestContent</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  <span class='httpproc identifier id'>httpproc</span><span class='dot token'>.</span><span class='add_interceptor identifier id'>add_interceptor</span><span class='lparen token'>(</span><span class='RequestTargetHost constant id'>RequestTargetHost</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  <span class='httpproc identifier id'>httpproc</span><span class='dot token'>.</span><span class='add_interceptor identifier id'>add_interceptor</span><span class='lparen token'>(</span><span class='RequestConnControl constant id'>RequestConnControl</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  <span class='httpproc identifier id'>httpproc</span><span class='dot token'>.</span><span class='add_interceptor identifier id'>add_interceptor</span><span class='lparen token'>(</span><span class='RequestUserAgent constant id'>RequestUserAgent</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  <span class='httpproc identifier id'>httpproc</span><span class='dot token'>.</span><span class='add_interceptor identifier id'>add_interceptor</span><span class='lparen token'>(</span><span class='RequestExpectContinue constant id'>RequestExpectContinue</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
  
  <span class='comment val'># We are going to use this object to synchronize between the </span>
  <span class='comment val'># I/O event and main threads</span>
  <span class='request_count identifier id'>request_count</span> <span class='assign token'>=</span> <span class='java identifier id'>java</span><span class='dot token'>.</span><span class='util identifier id'>util</span><span class='dot token'>.</span><span class='concurrent identifier id'>concurrent</span><span class='dot token'>.</span><span class='CountDownLatch constant id'>CountDownLatch</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='uris identifier id'>uris</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>

  <span class='handler identifier id'>handler</span> <span class='assign token'>=</span> <span class='BufferingHttpClientHandler constant id'>BufferingHttpClientHandler</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
    <span class='httpproc identifier id'>httpproc</span><span class='comma token'>,</span>
    <span class='RequestExecutionHandler constant id'>RequestExecutionHandler</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='request_count identifier id'>request_count</span><span class='comma token'>,</span> <span class='handler_proc identifier id'>handler_proc</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='org identifier id'>org</span><span class='dot token'>.</span><span class='apache identifier id'>apache</span><span class='dot token'>.</span><span class='http identifier id'>http</span><span class='dot token'>.</span><span class='impl identifier id'>impl</span><span class='dot token'>.</span><span class='DefaultConnectionReuseStrategy constant id'>DefaultConnectionReuseStrategy</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='comma token'>,</span>
    <span class='params identifier id'>params</span>
  <span class='rparen token'>)</span>
   
  <span class='handler identifier id'>handler</span><span class='dot token'>.</span><span class='event_listener identifier id'>event_listener</span> <span class='assign token'>=</span> <span class='EventLogger constant id'>EventLogger</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
  <span class='io_event_dispatch identifier id'>io_event_dispatch</span> <span class='assign token'>=</span> <span class='DefaultClientIOEventDispatch constant id'>DefaultClientIOEventDispatch</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='handler identifier id'>handler</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='rparen token'>)</span>

  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='abort_on_exception identifier id'>abort_on_exception</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='do do kw'>do</span>
    <span class='begin begin kw'>begin</span>
      <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Executing IO reactor&quot;</span>
      <span class='io_reactor identifier id'>io_reactor</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='io_event_dispatch identifier id'>io_event_dispatch</span><span class='rparen token'>)</span>
    <span class='rescue rescue kw'>rescue</span> <span class='java identifier id'>java</span><span class='dot token'>.</span><span class='io identifier id'>io</span><span class='dot token'>.</span><span class='InterruptedIOException constant id'>InterruptedIOException</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Interrupted&quot;</span>
    <span class='rescue rescue kw'>rescue</span> <span class='java identifier id'>java</span><span class='dot token'>.</span><span class='io identifier id'>io</span><span class='dot token'>.</span><span class='IOException constant id'>IOException</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;I/O error in reactor execution thread: #{e.message}&quot;</span>
    <span class='end end kw'>end</span>
    <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Shutdown&quot;</span>
  <span class='end end kw'>end</span>
  
  <span class='uris identifier id'>uris</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='uri identifier id'>uri</span><span class='bitor op'>|</span>
    <span class='io_reactor identifier id'>io_reactor</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span><span class='lparen token'>(</span>
      <span class='java identifier id'>java</span><span class='dot token'>.</span><span class='net identifier id'>net</span><span class='dot token'>.</span><span class='InetSocketAddress constant id'>InetSocketAddress</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='port identifier id'>port</span><span class='rparen token'>)</span><span class='comma token'>,</span> 
      <span class='nil nil kw'>nil</span><span class='comma token'>,</span> 
      <span class='lbrace token'>{</span><span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='HttpHost constant id'>HttpHost</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='host identifier id'>host</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:path</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='uri identifier id'>uri</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
      <span class='session_request_callback identifier id'>session_request_callback</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='request_count identifier id'>request_count</span><span class='rparen token'>)</span>
    <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Block until all connections signal</span>
  <span class='comment val'># completion of the request execution</span>
  <span class='request_count identifier id'>request_count</span><span class='dot token'>.</span><span class='await identifier id'>await</span><span class='lparen token'>(</span><span class='rparen token'>)</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Shutting down I/O reactor&quot;</span>

  <span class='io_reactor identifier id'>io_reactor</span><span class='dot token'>.</span><span class='shutdown identifier id'>shutdown</span><span class='lparen token'>(</span><span class='rparen token'>)</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Done&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>
</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>