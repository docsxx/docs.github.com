<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>crafterm's sprinkle - Module: Sprinkle::Package - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/crafterm/commits/sprinkle/master" rel="alternate" title="Recent Commits to sprinkle:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("crafterm", "sprinkle", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='crafterm/sprinkle/blob/518e33c835986c03ec7ae8ea88c657443b006f28' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='crafterm/sprinkle/blob/518e33c835986c03ec7ae8ea88c657443b006f28' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("crafterm", "sprinkle", "518e33c835986c03ec7ae8ea88c657443b006f28", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/crafterm/sprinkle/tree/">Source</a></li>
            <li class=""><a href="http://github.com/crafterm/sprinkle/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/crafterm/sprinkle/network">Network</a></li>            
            <li class=""><a href="http://github.com/crafterm/sprinkle/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/crafterm/sprinkle">Wiki</a></li>
            <li class=""><a href="http://github.com/crafterm/sprinkle/graphs">Graphs</a></li>                    
            <li class="active"><a href="/crafterm/sprinkle">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/crafterm">crafterm</a> / <b><a href="http://github.com/crafterm/sprinkle/tree">sprinkle</a></b>        
                <a id="namespaces_button" rel="crafterm/sprinkle/blob/518e33c835986c03ec7ae8ea88c657443b006f28" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="crafterm/sprinkle/blob/518e33c835986c03ec7ae8ea88c657443b006f28" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Sprinkle_Package">
  <h1>Module: Sprinkle::Package</h1>
  <div class="section docstring">
  <h1>Packages</h1>
<p>
A package defines one or more things to provision onto the server. There is
a lot of flexibility in a way a package is defined but let me give you a
basic example:
</p>
<pre class="code">
  <span class='package identifier id'>package</span> <span class='symbol val'>:ruby</span> <span class='do do kw'>do</span>
    <span class='description identifier id'>description</span> <span class='string val'>'Ruby MRI'</span>
    <span class='version identifier id'>version</span> <span class='string val'>'1.8.6'</span>
    <span class='apt identifier id'>apt</span> <span class='string val'>'ruby'</span>

    <span class='verify identifier id'>verify</span> <span class='lbrace token'>{</span> <span class='has_executable identifier id'>has_executable</span> <span class='string val'>'ruby'</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The above would define a package named &#8216;ruby&#8217; and give it a
description and explicitly say its version. It is installed via apt and to
verify the installation was successful sprinkle will check for the
executable &#8216;ruby&#8217; being availble. Pretty simple, right?
</p>
<p>
<b>Note:</b> Defining a package does not INSTALL it. To install a package,
you must require it in a Sprinkle::Policy block.
</p>
<h2>Pre-Requirements</h2>
<p>
Most packages have some sort of pre-requisites in order to be installed.
Sprinkle allows you to define the requirements of the package, which will
be installed before the package itself. An example below:
</p>
<pre class="code">
  <span class='package identifier id'>package</span> <span class='symbol val'>:rubygems</span> <span class='do do kw'>do</span>
    <span class='source identifier id'>source</span> <span class='string val'>'http://rubyforge.org/rubygems.tgz'</span>
    <span class='requires identifier id'>requires</span> <span class='symbol val'>:ruby</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In this case, when rubygems is being installed, Sprinkle will first
provision the server with Ruby to make sure the requirements are met. In
turn, if ruby has requirements, it installs those first, and so on.
</p>
<h2>Verifications</h2>
<p>
Most of the time its important to know whether the software you&#8217;re
attempting to install was installed successfully or not. For this, Sprinkle
provides verifications. Verifications are one or more blocks which define
rules with which Sprinkle can check if it installed the package
successfully. If these verification blocks fail, then Sprinkle will
gracefully stop the entire process. An example below:
</p>
<pre class="code">
  <span class='package identifier id'>package</span> <span class='symbol val'>:rubygems</span> <span class='do do kw'>do</span>
    <span class='source identifier id'>source</span> <span class='string val'>'http://rubyforge.org/rubygems.tgz'</span>
    <span class='requires identifier id'>requires</span> <span class='symbol val'>:ruby</span>

    <span class='verify identifier id'>verify</span> <span class='lbrace token'>{</span> <span class='has_executable identifier id'>has_executable</span> <span class='string val'>'gem'</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In addition to verifying an installation was successfully, by default
Sprinkle runs these verifications <em>before</em> the installation to check
if the package is already installed. If the verifications pass before
installing the package, it skips the package. To override this behavior,
set the -f flag on the sprinkle script or set the :force option to true in
Sprinkle::OPTIONS
</p>
<p>
For more information on verifications and to see all the available
verifications, see Sprinkle::Verify
</p>
<h2>Virtual Packages</h2>
<p>
Sometimes, there are multiple packages available for a single task. An
example is a database package. It can contain mySQL, postgres, or sqlite!
This is where virtual packages come in handy. They are defined as follows:
</p>
<pre class="code">
  <span class='package identifier id'>package</span> <span class='symbol val'>:sqlite3</span><span class='comma token'>,</span> <span class='symbol val'>:provides</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:database</span> <span class='do do kw'>do</span>
    <span class='apt identifier id'>apt</span> <span class='string val'>'sqlite3'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The :provides option allows you to reference this package either by
:sqlite3 or by :database. But whereas the package name is unique, multiple
packages may share the same provision. If this is the case, when running
Sprinkle, the script will ask you which provision you want to install. At
this time, you can only install one.
</p>
<h2>Meta-Packages</h2>
<p>
A package doesn&#8217;t require an installer. If you want to define a
package which merely encompasses other packages, that is fine too. Example:
</p>
<pre class="code">
  <span class='package identifier id'>package</span> <span class='symbol val'>:meta</span> <span class='do do kw'>do</span>
    <span class='requires identifier id'>requires</span> <span class='symbol val'>:magic_beans</span>
    <span class='requires identifier id'>requires</span> <span class='symbol val'>:magic_sauce</span>
  <span class='end end kw'>end</span>
</pre>
<p>
&#8212; FIXME: Should probably document recommendations. ++
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="PACKAGES-constant">PACKAGES</dt>
      <dd>{}</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#package-instance_method">#package</span><span class='args'>(name, metadata = {}, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>package</h3>
</div><div id="package-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>package</span><span class='args'>(name, metadata = {}, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sprinkle/package.rb', line 97</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/crafterm/sprinkle/blob/518e33c835986c03ec7ae8ea88c657443b006f28/lib/sprinkle/package.rb#L97">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">97
98
99
100
101
102
103
104
105
106</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='package identifier id'>package</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='metadata identifier id'>metadata</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='package identifier id'>package</span> <span class='assign token'>=</span> <span class='Package constant id'>Package</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='metadata identifier id'>metadata</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='PACKAGES constant id'>PACKAGES</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='package identifier id'>package</span>

  <span class='if if kw'>if</span> <span class='package identifier id'>package</span><span class='dot token'>.</span><span class='provides identifier id'>provides</span>
    <span class='lparen token'>(</span><span class='PACKAGES constant id'>PACKAGES</span><span class='lbrack token'>[</span><span class='package identifier id'>package</span><span class='dot token'>.</span><span class='provides identifier id'>provides</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='package identifier id'>package</span>
  <span class='end end kw'>end</span>

  <span class='package identifier id'>package</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>