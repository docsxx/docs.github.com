<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>crafterm's comma - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/crafterm/commits/comma/master" rel="alternate" title="Recent Commits to comma:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("crafterm", "comma", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='crafterm/comma/blob/3e63ecf185a20fd23c762854dcb718d718a7d5de' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='crafterm/comma/blob/3e63ecf185a20fd23c762854dcb718d718a7d5de' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("crafterm", "comma", "3e63ecf185a20fd23c762854dcb718d718a7d5de", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/crafterm/comma/tree/">Source</a></li>
            <li class=""><a href="http://github.com/crafterm/comma/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/crafterm/comma/network">Network</a></li>            
            <li class=""><a href="http://github.com/crafterm/comma/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/crafterm/comma">Wiki</a></li>
            <li class=""><a href="http://github.com/crafterm/comma/graphs">Graphs</a></li>                    
            <li class="active"><a href="/crafterm/comma">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/crafterm">crafterm</a> / <b><a href="http://github.com/crafterm/comma/tree">comma</a></b>        
                <a id="namespaces_button" rel="crafterm/comma/blob/3e63ecf185a20fd23c762854dcb718d718a7d5de" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="crafterm/comma/blob/3e63ecf185a20fd23c762854dcb718d718a7d5de" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>= COMMA</p>

<p><a href="http://github.com/crafterm/comma">http://github.com/crafterm/comma</a></p>

<p>== DESCRIPTION:</p>

<p>Comma is a CSV (ie. comma separated values) generation extension for Ruby objects, that lets you seamlessly define a CSV output format via a small DSL. Comma works well on pure Ruby objects with attributes, as well as complex ones such as ActiveRecord objects with associations, extensions, etc. It doesn't distinguish between attributes, methods, associations, extensions, etc - they all are considered equal and invoked identically via the Comma DSL description. Multiple different CSV output descriptions can also be defined.</p>

<p>When multiple objects in an Array are converted to CSV, the output includes generation of a header row reflected from names of the properties requested, or specified via the DSL.</p>

<p>CSV can be a bit of a boring format - the motivation behind Comma was to have a CSV extension that was simple, flexible, and would treat attributes, methods, associations, etc, all the same without the need for any complex configuration, and also work on Ruby objects, not just ActiveRecord or other base class derivatives.</p>

<p>An example Comma CSV enabled ActiveRecord class:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Book constant id'>Book</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>

  <span class='comment val'># ================</span>
  <span class='comment val'># = Associations =</span>
  <span class='comment val'># ================</span>
  <span class='has_many identifier id'>has_many</span>   <span class='symbol val'>:pages</span>
  <span class='has_one identifier id'>has_one</span>    <span class='symbol val'>:isbn</span>
  <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:publisher</span>

  <span class='comment val'># ===============</span>
  <span class='comment val'># = CSV support =</span>
  <span class='comment val'># ===============</span>
  <span class='comma identifier id'>comma</span> <span class='do do kw'>do</span>

    <span class='name identifier id'>name</span>
    <span class='description identifier id'>description</span>

    <span class='pages identifier id'>pages</span> <span class='symbol val'>:size</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Pages'</span>
    <span class='publisher identifier id'>publisher</span> <span class='symbol val'>:name</span>
    <span class='isbn identifier id'>isbn</span> <span class='symbol val'>:number_10</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ISBN-10'</span><span class='comma token'>,</span> <span class='symbol val'>:number_13</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ISBN-13'</span>
    <span class='blurb identifier id'>blurb</span> <span class='string val'>'Summary'</span>

  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre>

<p>Annotated, the comma description is as follows:</p>

<pre class="code"><span class='comment val'># starts a Comma description block, generating 2 methods #to_comma and #to_comma_headers for this class.</span>
<span class='comma identifier id'>comma</span> <span class='do do kw'>do</span>

  <span class='comment val'># name, description are attributes of Book with the header being reflected as 'Name', 'Description'</span>
  <span class='name identifier id'>name</span>
  <span class='description identifier id'>description</span>

  <span class='comment val'># pages is an association returning an array, :size is called on the association results, with the header name specifed as 'Pages'</span>
  <span class='pages identifier id'>pages</span> <span class='symbol val'>:size</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Pages'</span>

  <span class='comment val'># publisher is an association returning an object, :name is called on the associated object, with the reflected header 'Name'</span>
  <span class='publisher identifier id'>publisher</span> <span class='symbol val'>:name</span>

  <span class='comment val'># isbn is an association returning an object, :number_10 and :number_13 are called on the object with the specified headers 'ISBN-10' and 'ISBN-13'</span>
  <span class='isbn identifier id'>isbn</span> <span class='symbol val'>:number_10</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ISBN-10'</span><span class='comma token'>,</span> <span class='symbol val'>:number_13</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ISBN-13'</span>

  <span class='comment val'># blurb is an attribute of Book, with the header being specified directly as 'Summary'</span>
  <span class='blurb identifier id'>blurb</span> <span class='string val'>'Summary'</span>

<span class='end end kw'>end</span>
</pre>

<p>In the above example, any of the declarations (name, description, pages, publisher, isbn, blurb, etc), could be methods, attributes, associations, etc - no distinction during configuration is required, as everything is invoked via Ruby's #send method.</p>

<p>You can get the CSV representation of any object by calling the to_comma method, optionally providing a CSV description name to use.</p>

<p>Object values are automatically converted to strings via to_s allowing you to reuse any existing to_s methods on your objects (instead of having to call particular properties or define CSV specific output methods). Header names are also automatically humanized when reflected (eg. replacing _ characters with whitespace). The 'isbn' example above shows how multiple values can be added to the CSV output.</p>

<p>Multiple CSV descriptions can also be specified for the same class, eg:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Book constant id'>Book</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>

  <span class='comment val'># ================</span>
  <span class='comment val'># = Associations =</span>
  <span class='comment val'># ================</span>
  <span class='has_many identifier id'>has_many</span>   <span class='symbol val'>:pages</span>
  <span class='has_one identifier id'>has_one</span>    <span class='symbol val'>:isbn</span>
  <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:publisher</span>

  <span class='comment val'># ===============</span>
  <span class='comment val'># = CSV support =</span>
  <span class='comment val'># ===============</span>
  <span class='comma identifier id'>comma</span> <span class='do do kw'>do</span>

    <span class='name identifier id'>name</span>
    <span class='description identifier id'>description</span>

    <span class='pages identifier id'>pages</span> <span class='symbol val'>:size</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Pages'</span>
    <span class='publisher identifier id'>publisher</span> <span class='symbol val'>:name</span>
    <span class='isbn identifier id'>isbn</span> <span class='symbol val'>:number_10</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ISBN-10'</span><span class='comma token'>,</span> <span class='symbol val'>:number_13</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ISBN-13'</span>
    <span class='blurb identifier id'>blurb</span> <span class='string val'>'Summary'</span>

  <span class='end end kw'>end</span>

  <span class='comma identifier id'>comma</span> <span class='symbol val'>:brief</span> <span class='do do kw'>do</span>

    <span class='name identifier id'>name</span>
    <span class='description identifier id'>description</span>
    <span class='blurb identifier id'>blurb</span> <span class='string val'>'Summary'</span>

  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre>

<p>You can specify which output format you would like to use via an optional parameter to to_comma:</p>

<pre class="code"><span class='Book constant id'>Book</span><span class='dot token'>.</span><span class='limited identifier id'>limited</span><span class='lparen token'>(</span><span class='integer val'>10</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_comma identifier id'>to_comma</span><span class='lparen token'>(</span><span class='symbol val'>:brief</span><span class='rparen token'>)</span>
</pre>

<p>Specifying no description name to to_comma is equivalent to specifying :default as the description name.</p>

<p>When used with Rails (ie. add 'comma' as a gem dependency), Comma automatically adds support for rendering CSV output in your controllers:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='BooksController constant id'>BooksController</span> <span class='lt op'>&lt;</span> <span class='ApplicationController constant id'>ApplicationController</span>

  <span class='def def kw'>def</span> <span class='index identifier id'>index</span>
    <span class='respond_to identifier id'>respond_to</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='format identifier id'>format</span><span class='bitor op'>|</span>
      <span class='format identifier id'>format</span><span class='dot token'>.</span><span class='csv identifier id'>csv</span> <span class='lbrace token'>{</span> <span class='render identifier id'>render</span> <span class='symbol val'>:csv</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Book constant id'>Book</span><span class='dot token'>.</span><span class='limited identifier id'>limited</span><span class='lparen token'>(</span><span class='integer val'>50</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre>

<p>If you have any questions or suggestions for Comma, please feel free to contact me at crafterm@redartisan.com, all feedback welcome!</p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>