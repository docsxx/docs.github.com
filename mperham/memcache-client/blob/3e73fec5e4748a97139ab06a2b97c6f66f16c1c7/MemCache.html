<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>mperham's memcache-client - Class: MemCache - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/mperham/commits/memcache-client/master" rel="alternate" title="Recent Commits to memcache-client:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("mperham", "memcache-client", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("mperham", "memcache-client", "3e73fec5e4748a97139ab06a2b97c6f66f16c1c7", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/mperham/memcache-client/tree/">Source</a></li>
            <li class=""><a href="http://github.com/mperham/memcache-client/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/mperham/memcache-client/network">Network</a></li>            
            <li class=""><a href="http://github.com/mperham/memcache-client/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/mperham/memcache-client">Wiki</a></li>
            <li class=""><a href="http://github.com/mperham/memcache-client/graphs">Graphs</a></li>                    
            <li class="active"><a href="/mperham/memcache-client">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/mperham">mperham</a> / <b><a href="http://github.com/mperham/memcache-client/tree">memcache-client</a></b>        
                <a id="namespaces_button" rel="mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class MemCache">
  <h1>Class: MemCache</h1>
  <div class="section docstring">
  <p>
A Ruby client library for memcached.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">failover</td>
          <td class="readwrite">
            [<span id='failover-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Should the client try to failover to another server if the first server is
down? Defaults to true.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">logger</td>
          <td class="readwrite">
            [<span id='logger-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Log debug/info/warn/error to the given Logger, defaults to nil.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">multithread</td>
          <td class="readwrite">
            [<span id='multithread-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The multithread setting for this instance.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">namespace</td>
          <td class="readwrite">
            [<span id='namespace-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The namespace for this instance.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">no_reply</td>
          <td class="readwrite">
            [<span id='no_reply-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Don&#8217;t send or look for a reply from the memcached server for write
operations.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">servers</td>
          <td class="readwrite">
            [<span id='servers-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The servers this client talks to.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">timeout</td>
          <td class="readwrite">
            [<span id='timeout-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Socket timeout limit with this client, defaults to 0.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="DEFAULT_OPTIONS-constant">DEFAULT_OPTIONS</dt>
      <dd>{
  :namespace   =&gt; nil,
  :readonly    =&gt; false,
  :multithread =&gt; true,
  :failover    =&gt; true,
  :timeout     =&gt; 0.5,
  :logger      =&gt; nil,
  :no_reply    =&gt; false,
  :check_size  =&gt; true
}</dd>
    
      <dt id="DEFAULT_PORT-constant">DEFAULT_PORT</dt>
      <dd>11211</dd>
    
      <dt id="DEFAULT_WEIGHT-constant">DEFAULT_WEIGHT</dt>
      <dd>1</dd>
    
      <dt id="ONE_MB-constant">ONE_MB</dt>
      <dd>1024 * 1024</dd>
    
      <dt id="VERSION-constant">VERSION</dt>
      <dd>'1.7.4'</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Accepts a list of <tt>servers</tt> and a list of <tt>opts</tt>.
<tt>servers</tt> may be omitted. See <tt>servers=</tt> for acceptable server list
arguments.
</p>
<p>
Valid options for <tt>opts</tt> are:
</p>
<pre class="code">
  <span class='lbrack token'>[</span><span class='symbol val'>:namespace</span><span class='rbrack token'>]</span>   <span class='Prepends constant id'>Prepends</span> <span class='this identifier id'>this</span> <span class='value identifier id'>value</span> <span class='to identifier id'>to</span> <span class='all identifier id'>all</span> <span class='keys identifier id'>keys</span> <span class='added identifier id'>added</span> <span class='or or kw'>or</span> <span class='retrieved identifier id'>retrieved</span><span class='dot token'>.</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:readonly</span><span class='rbrack token'>]</span>    <span class='Raises constant id'>Raises</span> <span class='an identifier id'>an</span> <span class='exception identifier id'>exception</span> <span class='on identifier id'>on</span> <span class='cache identifier id'>cache</span> <span class='writes identifier id'>writes</span> <span class='when when kw'>when</span> <span class='true true kw'>true</span><span class='dot token'>.</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:multithread</span><span class='rbrack token'>]</span> <span class='Wraps constant id'>Wraps</span> <span class='cache identifier id'>cache</span> <span class='access identifier id'>access</span> <span class='in in kw'>in</span> <span class='a identifier id'>a</span> <span class='Mutex constant id'>Mutex</span> <span class='for for kw'>for</span> <span class='thread identifier id'>thread</span> <span class='safety identifier id'>safety</span><span class='dot token'>.</span> <span class='Defaults constant id'>Defaults</span> <span class='to identifier id'>to</span> <span class='true true kw'>true</span><span class='dot token'>.</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:failover</span><span class='rbrack token'>]</span>    <span class='Should constant id'>Should</span> <span class='the identifier id'>the</span> <span class='client identifier id'>client</span> <span class='try identifier id'>try</span> <span class='to identifier id'>to</span> <span class='failover identifier id'>failover</span> <span class='to identifier id'>to</span> <span class='another identifier id'>another</span> <span class='server identifier id'>server</span> <span class='if if_mod kw'>if</span> <span class='the identifier id'>the</span>
                 <span class='first identifier id'>first</span> <span class='server identifier id'>server</span> <span class='is identifier id'>is</span> <span class='down? fid id'>down?</span>  <span class='Defaults constant id'>Defaults</span> <span class='to identifier id'>to</span> <span class='true true kw'>true</span><span class='dot token'>.</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:timeout</span><span class='rbrack token'>]</span>     <span class='Time constant id'>Time</span> <span class='to identifier id'>to</span> <span class='use identifier id'>use</span> <span class='as identifier id'>as</span> <span class='the identifier id'>the</span> <span class='socket identifier id'>socket</span> <span class='read identifier id'>read</span> <span class='timeout identifier id'>timeout</span><span class='dot token'>.</span>  <span class='Defaults constant id'>Defaults</span> <span class='to identifier id'>to</span> <span class='integer val'>0</span><span class='integer val'>.5</span> <span class='sec identifier id'>sec</span><span class='comma token'>,</span>
                 <span class='set identifier id'>set</span> <span class='to identifier id'>to</span> <span class='nil nil kw'>nil</span> <span class='to identifier id'>to</span> <span class='disable identifier id'>disable</span> <span class='timeouts identifier id'>timeouts</span><span class='dot token'>.</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span>      <span class='Logger constant id'>Logger</span> <span class='to identifier id'>to</span> <span class='use identifier id'>use</span> <span class='for for kw'>for</span> <span class='info identifier id'>info</span><span class='div op'>/</span><span class='debug identifier id'>debug</span> <span class='output identifier id'>output</span><span class='comma token'>,</span> <span class='defaults identifier id'>defaults</span> <span class='to identifier id'>to</span> <span class='nil nil kw'>nil</span>
  <span class='lbrack token'>[</span><span class='symbol val'>:no_reply</span><span class='rbrack token'>]</span>    <span class='Don constant id'>Don</span><span class='string val'>'t bother looking for a reply for write operations (i.e. they
                 become '</span><span class='fire identifier id'>fire</span> <span class='and and kw'>and</span> <span class='forget identifier id'>forget</span><span class='string val'>'), memcached 1.2.5 and later only, speeds up
                 set/add/delete/incr/decr significantly.
  [:check_size]  Raises a MemCacheError if the value to be set is greater than 1 MB, which
                 is the maximum key size for the standard memcached server.  Defaults to true.
</span></pre>
<p>
Other options are ignored.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 104</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L104">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='servers identifier id'>servers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='case case kw'>case</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='when when kw'>when</span> <span class='integer val'>0</span> <span class='then then kw'>then</span> <span class='comment val'># NOP</span>
  <span class='when when kw'>when</span> <span class='integer val'>1</span> <span class='then then kw'>then</span>
    <span class='arg identifier id'>arg</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
    <span class='case case kw'>case</span> <span class='arg identifier id'>arg</span>
    <span class='when when kw'>when</span> <span class='Hash constant id'>Hash</span>   <span class='then then kw'>then</span> <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span>
    <span class='when when kw'>when</span> <span class='Array constant id'>Array</span>  <span class='then then kw'>then</span> <span class='servers identifier id'>servers</span> <span class='assign token'>=</span> <span class='arg identifier id'>arg</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span> <span class='then then kw'>then</span> <span class='servers identifier id'>servers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='arg identifier id'>arg</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span> <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'first argument must be Array, Hash or String'</span>
    <span class='end end kw'>end</span>
  <span class='when when kw'>when</span> <span class='integer val'>2</span> <span class='then then kw'>then</span>
    <span class='servers identifier id'>servers</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;wrong number of arguments (#{args.length} for 2)&quot;</span>
  <span class='end end kw'>end</span>

  <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='DEFAULT_OPTIONS constant id'>DEFAULT_OPTIONS</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span> <span class='opts identifier id'>opts</span>
  <span class='@namespace ivar id'>@namespace</span>   <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:namespace</span><span class='rbrack token'>]</span>
  <span class='@readonly ivar id'>@readonly</span>    <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:readonly</span><span class='rbrack token'>]</span>
  <span class='@multithread ivar id'>@multithread</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:multithread</span><span class='rbrack token'>]</span>
  <span class='@timeout ivar id'>@timeout</span>     <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:timeout</span><span class='rbrack token'>]</span>
  <span class='@failover ivar id'>@failover</span>    <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:failover</span><span class='rbrack token'>]</span>
  <span class='@logger ivar id'>@logger</span>      <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span>
  <span class='@no_reply ivar id'>@no_reply</span>    <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:no_reply</span><span class='rbrack token'>]</span>
  <span class='@check_size ivar id'>@check_size</span>  <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:check_size</span><span class='rbrack token'>]</span>
  <span class='@mutex ivar id'>@mutex</span>       <span class='assign token'>=</span> <span class='Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>

  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;memcache-client #{VERSION} #{Array(servers).inspect}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>

  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:memcache_client</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='@multithread ivar id'>@multithread</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='servers identifier id'>servers</span> <span class='assign token'>=</span> <span class='servers identifier id'>servers</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#-5B-5D-3D-instance_method">#[]=</span><span class='args'>(key, value)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Shortcut to save a value in the cache.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#active-3F-instance_method">#active?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns whether there is at least one active server for the object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#add-instance_method">#add</span><span class='args'>(key, value, expiry = 0, raw = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
<tt>expiry</tt> seconds, but only if <tt>key</tt> does not already exist in
the cache.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#append-instance_method">#append</span><span class='args'>(key, value)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Append - &#8216;add this data to an existing key after existing data&#8217;
Please note the value is always passed to memcached as raw since it
doesn&#8217;t make a lot of sense to concatenate marshalled data together.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cache_decr-instance_method">#cache_decr</span><span class='args'>(server, cache_key, amount)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Performs a raw decr for <tt>cache_key</tt> from <tt>server</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cache_get-instance_method">#cache_get</span><span class='args'>(server, cache_key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches the raw data for <tt>cache_key</tt> from <tt>server</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cache_get_multi-instance_method">#cache_get_multi</span><span class='args'>(server, cache_keys)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches <tt>cache_keys</tt> from <tt>server</tt> using a multi-get.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cache_incr-instance_method">#cache_incr</span><span class='args'>(server, cache_key, amount)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Performs a raw incr for <tt>cache_key</tt> from <tt>server</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cas-instance_method">#cas</span><span class='args'>(key, expiry = 0, raw = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&quot;cas&quot; is a check and set operation which means &quot;store this
data but only if no one else has updated since I last fetched it.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#check_multithread_status-21-instance_method">#check_multithread_status!</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_continuum_for-instance_method">#create_continuum_for</span><span class='args'>(servers)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#decr-instance_method">#decr</span><span class='args'>(key, amount = 1)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Decrements the value for <tt>key</tt> by <tt>amount</tt> and returns the
new value.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#delete-instance_method">#delete</span><span class='args'>(key, expiry = 0)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Removes <tt>key</tt> from the cache in <tt>expiry</tt> seconds.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#entry_count_for-instance_method">#entry_count_for</span><span class='args'>(server, total_servers, total_weight)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch-instance_method">#fetch</span><span class='args'>(key, expiry = 0, raw = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Performs a <tt>get</tt> with the given <tt>key</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#flush_all-instance_method">#flush_all</span><span class='args'>(delay = 0)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Flush the cache from all memcache servers.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get-instance_method">#get</span><span class='args'>(key, raw = false)</span>
        <span class='block'></span>
        
          <span class='alias'>#[]</span>
        
      </th>
      <td class="docstring">
        <p>
Retrieves <tt>key</tt> from memcache.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_multi-instance_method">#get_multi</span><span class='args'>(*keys)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Retrieves multiple values from memcached in parallel, if possible.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_server_for_key-instance_method">#get_server_for_key</span><span class='args'>(key, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Pick a server to handle the request based on a hash of the key.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#gets-instance_method">#gets</span><span class='args'>(key, raw = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#handle_error-instance_method">#handle_error</span><span class='args'>(server, error)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Handles <tt>error</tt> from <tt>server</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#hash_for-instance_method">#hash_for</span><span class='args'>(key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns an interoperable hash value for <tt>key</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#incr-instance_method">#incr</span><span class='args'>(key, amount = 1)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Increments the value for <tt>key</tt> by <tt>amount</tt> and returns the
new value.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#inspect-instance_method">#inspect</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns a string representation of the cache object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#make_cache_key-instance_method">#make_cache_key</span><span class='args'>(key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create a key for the cache, incorporating the namespace qualifier if
requested.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#noreply-instance_method">#noreply</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#prepend-instance_method">#prepend</span><span class='args'>(key, value)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Prepend - &#8216;add this data to an existing key before existing
data&#8217; Please note the value is always passed to memcached as raw
since it doesn&#8217;t make a lot of sense to concatenate marshalled data
together.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#raise_on_error_response-21-instance_method">#raise_on_error_response!</span><span class='args'>(response)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#readonly-3F-instance_method">#readonly?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns whether or not the cache object was created read only.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#replace-instance_method">#replace</span><span class='args'>(key, value, expiry = 0, raw = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
<tt>expiry</tt> seconds, but only if <tt>key</tt> already exists in the
cache.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#request_setup-instance_method">#request_setup</span><span class='args'>(key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Performs setup for making a request with <tt>key</tt> from memcached.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reset-instance_method">#reset</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Reset the connection to all memcache servers.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#servers-3D-instance_method">#servers=</span><span class='args'>(servers)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Set the servers that the requests will be distributed between.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set-instance_method">#set</span><span class='args'>(key, value, expiry = 0, raw = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stats-instance_method">#stats</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns statistics for each memcached server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#with_server-instance_method">#with_server</span><span class='args'>(key)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#with_socket_management-instance_method">#with_socket_management</span><span class='args'>(server, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Gets or creates a socket connected to the given server, and yields it to
the block, wrapped in a mutex synchronization if @multithread is true.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>[]=</h3>
</div><div id="-5B-5D-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>[]=</span><span class='args'>(key, value)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Shortcut to save a value in the cache. This method does not set an
expiration on the entry. Use set to specify an explicit expiry.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 617</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L617">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">617
618
619</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='aset op'>[]=</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='set identifier id'>set</span> <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>active?</h3>
</div><div id="active-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>active?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns whether there is at least one active server for the object.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 153</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L153">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">153
154
155</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='active? fid id'>active?</span>
  <span class='not not kw'>not</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add</h3>
</div><div id="add-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add</span><span class='args'>(key, value, expiry = 0, raw = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
<tt>expiry</tt> seconds, but only if <tt>key</tt> does not already exist in
the cache. If <tt>raw</tt> is true, <tt>value</tt> will not be Marshalled.
</p>
<p>
Readers should call this method in the event of a cache miss, not
MemCache#set.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 397</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L397">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='expiry identifier id'>expiry</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span> <span class='value identifier id'>value</span> <span class='unless unless_mod kw'>unless</span> <span class='raw identifier id'>raw</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;add #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;add #{cache_key} 0 #{expiry} #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>

    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='command identifier id'>command</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>
      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>append</h3>
</div><div id="append-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>append</span><span class='args'>(key, value)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Append - &#8216;add this data to an existing key after existing data&#8217;
Please note the value is always passed to memcached as raw since it
doesn&#8217;t make a lot of sense to concatenate marshalled data together.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 439</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L439">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">439
440
441
442
443
444
445
446
447
448
449
450
451
452
453</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='append identifier id'>append</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;append #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;append #{cache_key} 0 0 #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>

    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='command identifier id'>command</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>
      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cache_decr</h3>
</div><div id="cache_decr-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cache_decr</span><span class='args'>(server, cache_key, amount)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Performs a raw decr for <tt>cache_key</tt> from <tt>server</tt>. Returns
nil if not found.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 670</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L670">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">670
671
672
673
674
675
676
677
678
679</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cache_decr identifier id'>cache_decr</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='rparen token'>)</span>
  <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
    <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;decr #{cache_key} #{amount}#{noreply}\r\n&quot;</span>
    <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
    <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='text identifier id'>text</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;NOT_FOUND\r\n&quot;</span>
    <span class='return return kw'>return</span> <span class='text identifier id'>text</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cache_get</h3>
</div><div id="cache_get-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cache_get</span><span class='args'>(server, cache_key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches the raw data for <tt>cache_key</tt> from <tt>server</tt>. Returns
nil on cache miss.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 685</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L685">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cache_get identifier id'>cache_get</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='rparen token'>)</span>
  <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
    <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;get #{cache_key}\r\n&quot;</span>
    <span class='keyline identifier id'>keyline</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span> <span class='comment val'># &quot;VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt;\r\n&quot;</span>

    <span class='if if kw'>if</span> <span class='keyline identifier id'>keyline</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
      <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
    <span class='end end kw'>end</span>

    <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='keyline identifier id'>keyline</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='keyline identifier id'>keyline</span> <span class='eq op'>==</span> <span class='string val'>&quot;END\r\n&quot;</span>

    <span class='unless unless kw'>unless</span> <span class='keyline identifier id'>keyline</span> <span class='match op'>=~</span> <span class='regexp val'>/(\d+)\r/</span> <span class='then then kw'>then</span>
      <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unexpected response #{keyline.inspect}&quot;</span>
    <span class='end end kw'>end</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='integer val'>2</span> <span class='comment val'># &quot;\r\n&quot;</span>
    <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>   <span class='comment val'># &quot;END\r\n&quot;</span>
    <span class='return return kw'>return</span> <span class='value identifier id'>value</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cache_get_multi</h3>
</div><div id="cache_get_multi-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cache_get_multi</span><span class='args'>(server, cache_keys)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches <tt>cache_keys</tt> from <tt>server</tt> using a multi-get.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 744</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L744">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cache_get_multi identifier id'>cache_get_multi</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_keys identifier id'>cache_keys</span><span class='rparen token'>)</span>
    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='values identifier id'>values</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;get #{cache_keys}\r\n&quot;</span>

      <span class='while while kw'>while</span> <span class='keyline identifier id'>keyline</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span> <span class='do do kw'>do</span>
        <span class='return return kw'>return</span> <span class='values identifier id'>values</span> <span class='if if_mod kw'>if</span> <span class='keyline identifier id'>keyline</span> <span class='eq op'>==</span> <span class='string val'>&quot;END\r\n&quot;</span>
        <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='keyline identifier id'>keyline</span>

        <span class='unless unless kw'>unless</span> <span class='keyline identifier id'>keyline</span> <span class='match op'>=~</span> <span class='regexp val'>/\AVALUE (.+) (.+) (.+)/</span> <span class='then then kw'>then</span>
          <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
          <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unexpected response #{keyline.inspect}&quot;</span>
        <span class='end end kw'>end</span>

        <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='data_length identifier id'>data_length</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span><span class='comma token'>,</span> <span class='$3 nth_ref id'>$3</span>
        <span class='values identifier id'>values</span><span class='lbrack token'>[</span><span class='$1 nth_ref id'>$1</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='data_length identifier id'>data_length</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
        <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='comment val'># &quot;\r\n&quot;</span>
      <span class='end end kw'>end</span>

      <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span> <span class='comment val'># TODO: retry here too</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Performs a raw incr for +cache_key+ from +server+.  Returns nil if not</span>
  <span class='comment val'># found.</span>

  <span class='def def kw'>def</span> <span class='cache_incr identifier id'>cache_incr</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='rparen token'>)</span>
    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;incr #{cache_key} #{amount}#{noreply}\r\n&quot;</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='text identifier id'>text</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;NOT_FOUND\r\n&quot;</span>
      <span class='return return kw'>return</span> <span class='text identifier id'>text</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Gets or creates a socket connected to the given server, and yields it</span>
  <span class='comment val'># to the block, wrapped in a mutex synchronization if @multithread is true.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If a socket error (SocketError, SystemCallError, IOError) or protocol error</span>
  <span class='comment val'># (MemCacheError) is raised by the block, closes the socket, attempts to</span>
  <span class='comment val'># connect again, and retries the block (once).  If an error is again raised,</span>
  <span class='comment val'># reraises it as MemCacheError.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If unable to connect to the server (or if in the reconnect wait period),</span>
  <span class='comment val'># raises MemCacheError.  Note that the socket connect code marks a server</span>
  <span class='comment val'># dead for a timeout period, so retrying does not apply to connection attempt</span>
  <span class='comment val'># failures (but does still apply to unexpectedly lost connections etc.).</span>

  <span class='def def kw'>def</span> <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='check_multithread_status! fid id'>check_multithread_status!</span>

    <span class='@mutex ivar id'>@mutex</span><span class='dot token'>.</span><span class='lock identifier id'>lock</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>
    <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

    <span class='begin begin kw'>begin</span>
      <span class='socket identifier id'>socket</span> <span class='assign token'>=</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='socket identifier id'>socket</span>

      <span class='comment val'># Raise an IndexError to show this server is out of whack. If were inside</span>
      <span class='comment val'># a with_server block, we'll catch it and attempt to restart the operation.</span>

      <span class='raise identifier id'>raise</span> <span class='IndexError constant id'>IndexError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;No connection to server (#{server.status})&quot;</span> <span class='if if_mod kw'>if</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

      <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>

    <span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EAGAIN constant id'>EAGAIN</span><span class='comma token'>,</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Socket failure: #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='mark_dead identifier id'>mark_dead</span><span class='lparen token'>(</span><span class='err identifier id'>err</span><span class='rparen token'>)</span>
      <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span>

    <span class='rescue rescue kw'>rescue</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Generic failure: #{err.class.name}: #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='retried identifier id'>retried</span> <span class='orop op'>||</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
      <span class='retry retry kw'>retry</span>
    <span class='end end kw'>end</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='@mutex ivar id'>@mutex</span><span class='dot token'>.</span><span class='unlock identifier id'>unlock</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='begin begin kw'>begin</span>
      <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span> <span class='assign token'>=</span> <span class='request_setup identifier id'>request_setup</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
      <span class='yield yield kw'>yield</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span>
    <span class='rescue rescue kw'>rescue</span> <span class='IndexError constant id'>IndexError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Server failed: #{e.class.name}: #{e.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='retried identifier id'>retried</span> <span class='andop op'>&amp;&amp;</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
        <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Connection to server #{server.inspect} DIED! Retrying operation...&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
        <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
        <span class='retry retry kw'>retry</span>
      <span class='end end kw'>end</span>
      <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Handles +error+ from +server+.</span>

  <span class='def def kw'>def</span> <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='error identifier id'>error</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='error identifier id'>error</span> <span class='if if_mod kw'>if</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='MemCacheError constant id'>MemCacheError</span><span class='rparen token'>)</span>
    <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='server identifier id'>server</span>
    <span class='new_error identifier id'>new_error</span> <span class='assign token'>=</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
    <span class='new_error identifier id'>new_error</span><span class='dot token'>.</span><span class='set_backtrace identifier id'>set_backtrace</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span>
    <span class='raise identifier id'>raise</span> <span class='new_error identifier id'>new_error</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='noreply identifier id'>noreply</span>
    <span class='@no_reply ivar id'>@no_reply</span> <span class='question op'>?</span> <span class='string val'>' noreply'</span> <span class='colon op'>:</span> <span class='string val'>''</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Performs setup for making a request with +key+ from memcached.  Returns</span>
  <span class='comment val'># the server to fetch the key from and the complete key to use.</span>

  <span class='def def kw'>def</span> <span class='request_setup identifier id'>request_setup</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>'No active servers'</span> <span class='unless unless_mod kw'>unless</span> <span class='active? fid id'>active?</span>
    <span class='cache_key identifier id'>cache_key</span> <span class='assign token'>=</span> <span class='make_cache_key identifier id'>make_cache_key</span> <span class='key identifier id'>key</span>
    <span class='server identifier id'>server</span> <span class='assign token'>=</span> <span class='get_server_for_key identifier id'>get_server_for_key</span> <span class='cache_key identifier id'>cache_key</span>
    <span class='return return kw'>return</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='raise_on_error_response! fid id'>raise_on_error_response!</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='response identifier id'>response</span> <span class='match op'>=~</span> <span class='regexp val'>/\A(?:CLIENT_|SERVER_)?ERROR(.*)/</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='create_continuum_for identifier id'>create_continuum_for</span><span class='lparen token'>(</span><span class='servers identifier id'>servers</span><span class='rparen token'>)</span>
    <span class='total_weight identifier id'>total_weight</span> <span class='assign token'>=</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='memo identifier id'>memo</span><span class='comma token'>,</span> <span class='srv identifier id'>srv</span><span class='bitor op'>|</span> <span class='memo identifier id'>memo</span> <span class='plus op'>+</span> <span class='srv identifier id'>srv</span><span class='dot token'>.</span><span class='weight identifier id'>weight</span> <span class='rbrace token'>}</span>
    <span class='continuum identifier id'>continuum</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

    <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
      <span class='entry_count_for identifier id'>entry_count_for</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span> <span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='idx identifier id'>idx</span><span class='bitor op'>|</span>
        <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='SHA1 constant id'>SHA1</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{server.host}:#{server.port}:#{idx}&quot;</span><span class='rparen token'>)</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='dstring node'>&quot;0x#{hash[0..7]}&quot;</span><span class='rparen token'>)</span>
        <span class='continuum identifier id'>continuum</span> <span class='lshft op'>&lt;&lt;</span> <span class='Continuum constant id'>Continuum</span><span class='colon2 op'>::</span><span class='Entry constant id'>Entry</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='continuum identifier id'>continuum</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='cmp op'>&lt;=&gt;</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='entry_count_for identifier id'>entry_count_for</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='total_servers identifier id'>total_servers</span><span class='comma token'>,</span> <span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span>
    <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='total_servers identifier id'>total_servers</span> <span class='mult op'>*</span> <span class='Continuum constant id'>Continuum</span><span class='colon2 op'>::</span><span class='POINTS_PER_SERVER constant id'>POINTS_PER_SERVER</span> <span class='mult op'>*</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='weight identifier id'>weight</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='check_multithread_status! fid id'>check_multithread_status!</span>
    <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>

    <span class='if if kw'>if</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:memcache_client</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;You are accessing this memcache-client instance from multiple threads but have not enabled multithread support.\nNormally:  MemCache.new(['localhost:11211'], :multithread =&gt; true)\nIn Rails:  config.cache_store = [:mem_cache_store, 'localhost:11211', { :multithread =&gt; true }]\n&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># This class represents a memcached server instance.</span>

  <span class='class class kw'>class</span> <span class='Server constant id'>Server</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The amount of time to wait before attempting to re-establish a</span>
    <span class='comment val'># connection with a server that is marked dead.</span>

    <span class='RETRY_DELAY constant id'>RETRY_DELAY</span> <span class='assign token'>=</span> <span class='float val'>30.0</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The host the memcached server is running on.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:host</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The port the memcached server is listening on.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:port</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The weight given to the server.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:weight</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The time of next retry if the connection is dead.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:retry</span>

    <span class='comment val'>##</span>
    <span class='comment val'># A text status string describing the state of the server.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:status</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:logger</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Create a new MemCache::Server object for the memcached instance</span>
    <span class='comment val'># listening on the given host and port, weighted by the given weight.</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='memcache identifier id'>memcache</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='DEFAULT_PORT constant id'>DEFAULT_PORT</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span> <span class='assign token'>=</span> <span class='DEFAULT_WEIGHT constant id'>DEFAULT_WEIGHT</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;No host specified&quot;</span> <span class='if if_mod kw'>if</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;No port specified&quot;</span> <span class='if if_mod kw'>if</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>

      <span class='@host ivar id'>@host</span>   <span class='assign token'>=</span> <span class='host identifier id'>host</span>
      <span class='@port ivar id'>@port</span>   <span class='assign token'>=</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='@weight ivar id'>@weight</span> <span class='assign token'>=</span> <span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

      <span class='@sock ivar id'>@sock</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='string val'>'NOT CONNECTED'</span>
      <span class='@timeout ivar id'>@timeout</span> <span class='assign token'>=</span> <span class='memcache identifier id'>memcache</span><span class='dot token'>.</span><span class='timeout identifier id'>timeout</span>
      <span class='@logger ivar id'>@logger</span> <span class='assign token'>=</span> <span class='memcache identifier id'>memcache</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Return a string representation of the server object.</span>

    <span class='def def kw'>def</span> <span class='inspect identifier id'>inspect</span>
      <span class='string val'>&quot;&lt;MemCache::Server: %s:%d [%d] (%s)&gt;&quot;</span> <span class='mod op'>%</span> <span class='lbrack token'>[</span><span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='comma token'>,</span> <span class='@weight ivar id'>@weight</span><span class='comma token'>,</span> <span class='@status ivar id'>@status</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Check whether the server connection is alive.  This will cause the</span>
    <span class='comment val'># socket to attempt to connect if it isn't already connected and or if</span>
    <span class='comment val'># the server was previously marked as down and the retry time has</span>
    <span class='comment val'># been exceeded.</span>

    <span class='def def kw'>def</span> <span class='alive? fid id'>alive?</span>
      <span class='notop op'>!</span><span class='notop op'>!</span><span class='socket identifier id'>socket</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Try to connect to the memcached server targeted by this object.</span>
    <span class='comment val'># Returns the connected socket object on success or nil on failure.</span>

    <span class='def def kw'>def</span> <span class='socket identifier id'>socket</span>
      <span class='return return kw'>return</span> <span class='@sock ivar id'>@sock</span> <span class='if if_mod kw'>if</span> <span class='@sock ivar id'>@sock</span> <span class='and and kw'>and</span> <span class='not not kw'>not</span> <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>

      <span class='@sock ivar id'>@sock</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

      <span class='comment val'># If the host was dead, don't retry for a while.</span>
      <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@retry ivar id'>@retry</span> <span class='and and kw'>and</span> <span class='@retry ivar id'>@retry</span> <span class='gt op'>&gt;</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>

      <span class='comment val'># Attempt to connect if not already connected.</span>
      <span class='begin begin kw'>begin</span>
        <span class='@sock ivar id'>@sock</span> <span class='assign token'>=</span> <span class='connect_to identifier id'>connect_to</span><span class='lparen token'>(</span><span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='comma token'>,</span> <span class='@timeout ivar id'>@timeout</span><span class='rparen token'>)</span>
        <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='IPPROTO_TCP constant id'>IPPROTO_TCP</span><span class='comma token'>,</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='TCP_NODELAY constant id'>TCP_NODELAY</span><span class='comma token'>,</span> <span class='integer val'>1</span>
        <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='string val'>'CONNECTED'</span>
      <span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
        <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Unable to open socket: #{err.class.name}, #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
        <span class='mark_dead identifier id'>mark_dead</span> <span class='err identifier id'>err</span>
      <span class='end end kw'>end</span>

      <span class='return return kw'>return</span> <span class='@sock ivar id'>@sock</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='connect_to identifier id'>connect_to</span><span class='lparen token'>(</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='timeout identifier id'>timeout</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
      <span class='io identifier id'>io</span> <span class='assign token'>=</span> <span class='MemCache constant id'>MemCache</span><span class='colon2 op'>::</span><span class='BufferedIO constant id'>BufferedIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='TCPSocket constant id'>TCPSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='read_timeout identifier id'>read_timeout</span> <span class='assign token'>=</span> <span class='timeout identifier id'>timeout</span>
      <span class='io identifier id'>io</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Close the connection to the memcached server targeted by this</span>
    <span class='comment val'># object.  The server is not considered dead.</span>

    <span class='def def kw'>def</span> <span class='close identifier id'>close</span>
      <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='@sock ivar id'>@sock</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>
      <span class='@sock ivar id'>@sock</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='string val'>&quot;NOT CONNECTED&quot;</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Mark the server as dead and close its socket.</span>

    <span class='def def kw'>def</span> <span class='mark_dead identifier id'>mark_dead</span><span class='lparen token'>(</span><span class='error identifier id'>error</span><span class='rparen token'>)</span>
      <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='@sock ivar id'>@sock</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>
      <span class='@sock ivar id'>@sock</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='plus op'>+</span> <span class='RETRY_DELAY constant id'>RETRY_DELAY</span>

      <span class='reason identifier id'>reason</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{error.class.name}: #{error.message}&quot;</span>
      <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='sprintf identifier id'>sprintf</span> <span class='string val'>&quot;%s:%s DEAD (%s), will retry at %s&quot;</span><span class='comma token'>,</span> <span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='comma token'>,</span> <span class='reason identifier id'>reason</span><span class='comma token'>,</span> <span class='@retry ivar id'>@retry</span>
      <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='lbrace token'>{</span> <span class='@status ivar id'>@status</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='@logger ivar id'>@logger</span>
    <span class='end end kw'>end</span>

  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Base MemCache exception class.</span>

  <span class='class class kw'>class</span> <span class='MemCacheError constant id'>MemCacheError</span> <span class='lt op'>&lt;</span> <span class='RuntimeError constant id'>RuntimeError</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>

  <span class='class class kw'>class</span> <span class='BufferedIO constant id'>BufferedIO</span> <span class='lt op'>&lt;</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='BufferedIO constant id'>BufferedIO</span> <span class='comment val'># :nodoc:</span>
    <span class='BUFSIZE constant id'>BUFSIZE</span> <span class='assign token'>=</span> <span class='integer val'>1024</span> <span class='mult op'>*</span> <span class='integer val'>16</span>

    <span class='if if kw'>if</span> <span class='RUBY_VERSION constant id'>RUBY_VERSION</span> <span class='lt op'>&lt;</span> <span class='string val'>'1.9.1'</span>
      <span class='def def kw'>def</span> <span class='rbuf_fill identifier id'>rbuf_fill</span>
        <span class='begin begin kw'>begin</span>
          <span class='@rbuf ivar id'>@rbuf</span> <span class='lshft op'>&lt;&lt;</span> <span class='@io ivar id'>@io</span><span class='dot token'>.</span><span class='read_nonblock identifier id'>read_nonblock</span><span class='lparen token'>(</span><span class='BUFSIZE constant id'>BUFSIZE</span><span class='rparen token'>)</span>
        <span class='rescue rescue kw'>rescue</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EWOULDBLOCK constant id'>EWOULDBLOCK</span>
          <span class='retry retry kw'>retry</span> <span class='unless unless_mod kw'>unless</span> <span class='@read_timeout ivar id'>@read_timeout</span>
          <span class='if if kw'>if</span> <span class='IO constant id'>IO</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='@io ivar id'>@io</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='@read_timeout ivar id'>@read_timeout</span><span class='rparen token'>)</span>
            <span class='retry retry kw'>retry</span>
          <span class='else else kw'>else</span>
            <span class='raise identifier id'>raise</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='string val'>'IO timeout'</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='setsockopt identifier id'>setsockopt</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
      <span class='@io ivar id'>@io</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='gets identifier id'>gets</span>
      <span class='readuntil identifier id'>readuntil</span><span class='lparen token'>(</span><span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cache_incr</h3>
</div><div id="cache_incr-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cache_incr</span><span class='args'>(server, cache_key, amount)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Performs a raw incr for <tt>cache_key</tt> from <tt>server</tt>. Returns
nil if not found.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 772</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L772">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">772
773
774
775
776
777
778
779
780
781</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cache_incr identifier id'>cache_incr</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='rparen token'>)</span>
  <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
    <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;incr #{cache_key} #{amount}#{noreply}\r\n&quot;</span>
    <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
    <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
    <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='text identifier id'>text</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;NOT_FOUND\r\n&quot;</span>
    <span class='return return kw'>return</span> <span class='text identifier id'>text</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cas</h3>
</div><div id="cas-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cas</span><span class='args'>(key, expiry = 0, raw = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&quot;cas&quot; is a check and set operation which means &quot;store this
data but only if no one else has updated since I last fetched it.&quot;
This can be used as a form of optimistic locking.
</p>
<p>
Works in block form like so:
</p>
<pre class="code">
  <span class='cache identifier id'>cache</span><span class='dot token'>.</span><span class='cas identifier id'>cas</span><span class='lparen token'>(</span><span class='string val'>'some-key'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='value identifier id'>value</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Returns: <tt>nil</tt> if the value was not found on the memcached server.
<tt>STORED</tt> if the value was updated successfully <tt>EXISTS</tt> if
the value was updated by someone else since last fetch
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 360</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L360">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cas identifier id'>cas</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='expiry identifier id'>expiry</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span><span class='assign token'>=</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;A block is required&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='block_given? fid id'>block_given?</span>

  <span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='token identifier id'>token</span><span class='rparen token'>)</span> <span class='assign token'>=</span> <span class='gets identifier id'>gets</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='unless unless_mod kw'>unless</span> <span class='value identifier id'>value</span>
  <span class='updated identifier id'>updated</span> <span class='assign token'>=</span> <span class='yield yield kw'>yield</span> <span class='value identifier id'>value</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span> <span class='updated identifier id'>updated</span> <span class='unless unless_mod kw'>unless</span> <span class='raw identifier id'>raw</span>

  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;cas #{key} to #{server.inspect}: #{value.to_s.size}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;cas #{cache_key} 0 #{expiry} #{value.to_s.size} #{token}#{noreply}\r\n#{value}\r\n&quot;</span>

    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='command identifier id'>command</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>

      <span class='if if kw'>if</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
        <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>check_multithread_status!</h3>
</div><div id="check_multithread_status-21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>check_multithread_status!</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 895</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L895">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">895
896
897
898
899
900
901</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='check_multithread_status! fid id'>check_multithread_status!</span>
  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>

  <span class='if if kw'>if</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:memcache_client</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span>
    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;You are accessing this memcache-client instance from multiple threads but have not enabled multithread support.\nNormally:  MemCache.new(['localhost:11211'], :multithread =&gt; true)\nIn Rails:  config.cache_store = [:mem_cache_store, 'localhost:11211', { :multithread =&gt; true }]\n&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_continuum_for</h3>
</div><div id="create_continuum_for-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_continuum_for</span><span class='args'>(servers)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 876</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L876">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">876
877
878
879
880
881
882
883
884
885
886
887
888
889</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_continuum_for identifier id'>create_continuum_for</span><span class='lparen token'>(</span><span class='servers identifier id'>servers</span><span class='rparen token'>)</span>
  <span class='total_weight identifier id'>total_weight</span> <span class='assign token'>=</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='memo identifier id'>memo</span><span class='comma token'>,</span> <span class='srv identifier id'>srv</span><span class='bitor op'>|</span> <span class='memo identifier id'>memo</span> <span class='plus op'>+</span> <span class='srv identifier id'>srv</span><span class='dot token'>.</span><span class='weight identifier id'>weight</span> <span class='rbrace token'>}</span>
  <span class='continuum identifier id'>continuum</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

  <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
    <span class='entry_count_for identifier id'>entry_count_for</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span> <span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='idx identifier id'>idx</span><span class='bitor op'>|</span>
      <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='SHA1 constant id'>SHA1</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{server.host}:#{server.port}:#{idx}&quot;</span><span class='rparen token'>)</span>
      <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='dstring node'>&quot;0x#{hash[0..7]}&quot;</span><span class='rparen token'>)</span>
      <span class='continuum identifier id'>continuum</span> <span class='lshft op'>&lt;&lt;</span> <span class='Continuum constant id'>Continuum</span><span class='colon2 op'>::</span><span class='Entry constant id'>Entry</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='continuum identifier id'>continuum</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='cmp op'>&lt;=&gt;</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>decr</h3>
</div><div id="decr-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>decr</span><span class='args'>(key, amount = 1)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Decrements the value for <tt>key</tt> by <tt>amount</tt> and returns the
new value. <tt>key</tt> must already exist. If <tt>key</tt> is not an
integer, it is assumed to be
</p>
<ol>
<li><tt>key</tt> can not be decremented below 0.

</li>
</ol>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 196</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L196">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">196
197
198
199
200
201
202
203</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='decr identifier id'>decr</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span> <span class='assign token'>=</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='cache_decr identifier id'>cache_decr</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='TypeError constant id'>TypeError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
  <span class='handle_error identifier id'>handle_error</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>delete</h3>
</div><div id="delete-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>delete</span><span class='args'>(key, expiry = 0)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Removes <tt>key</tt> from the cache in <tt>expiry</tt> seconds.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 478</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L478">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">478
479
480
481
482
483
484
485
486
487
488
489
490</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='expiry identifier id'>expiry</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;delete #{cache_key} on #{server}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;delete #{cache_key} #{expiry}#{noreply}\r\n&quot;</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>
      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>entry_count_for</h3>
</div><div id="entry_count_for-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>entry_count_for</span><span class='args'>(server, total_servers, total_weight)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 891</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L891">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">891
892
893</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='entry_count_for identifier id'>entry_count_for</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='total_servers identifier id'>total_servers</span><span class='comma token'>,</span> <span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='total_servers identifier id'>total_servers</span> <span class='mult op'>*</span> <span class='Continuum constant id'>Continuum</span><span class='colon2 op'>::</span><span class='POINTS_PER_SERVER constant id'>POINTS_PER_SERVER</span> <span class='mult op'>*</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='weight identifier id'>weight</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch</h3>
</div><div id="fetch-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch</span><span class='args'>(key, expiry = 0, raw = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Performs a <tt>get</tt> with the given <tt>key</tt>. If the value does not
exist and a block was given, the block will be called and the result saved
via <tt>add</tt>.
</p>
<p>
If you do not provide a block, using this method is the same as using
<tt>get</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 229</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L229">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">229
230
231
232
233
234
235
236
237
238</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='expiry identifier id'>expiry</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='block_given? fid id'>block_given?</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='yield yield kw'>yield</span>
    <span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='expiry identifier id'>expiry</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='value identifier id'>value</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>flush_all</h3>
</div><div id="flush_all-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>flush_all</span><span class='args'>(delay = 0)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Flush the cache from all memcache servers. A non-zero value for
<tt>delay</tt> will ensure that the flush is propogated slowly through your
memcached server farm. The Nth server will be flushed N*delay seconds from
now, asynchronously so this method returns quickly. This prevents a huge
database spike due to a total flush all at once.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 501</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L501">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='flush_all identifier id'>flush_all</span><span class='lparen token'>(</span><span class='delay identifier id'>delay</span><span class='assign token'>=</span><span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>'No active servers'</span> <span class='unless unless_mod kw'>unless</span> <span class='active? fid id'>active?</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>

  <span class='begin begin kw'>begin</span>
    <span class='delay_time identifier id'>delay_time</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
      <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
        <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;flush_all #{delay_time} on #{server}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
        <span class='if if kw'>if</span> <span class='delay identifier id'>delay</span> <span class='eq op'>==</span> <span class='integer val'>0</span> <span class='comment val'># older versions of memcached will fail silently otherwise</span>
          <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;flush_all#{noreply}\r\n&quot;</span>
        <span class='else else kw'>else</span>
          <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;flush_all #{delay_time}#{noreply}\r\n&quot;</span>
        <span class='end end kw'>end</span>
        <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
        <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
        <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>
        <span class='result identifier id'>result</span>
      <span class='end end kw'>end</span>
      <span class='delay_time identifier id'>delay_time</span> <span class='opasgn op'>+=</span> <span class='delay identifier id'>delay</span>
    <span class='end end kw'>end</span>
  <span class='rescue rescue kw'>rescue</span> <span class='IndexError constant id'>IndexError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
    <span class='handle_error identifier id'>handle_error</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get</h3>
</div><div id="get-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get</span><span class='args'>(key, raw = false)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="[]-instance_method">[]</tt>
  
</p>
</div><div class="section docstring">
  <p>
Retrieves <tt>key</tt> from memcache. If <tt>raw</tt> is false, the value
will be unmarshalled.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 209</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L209">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">209
210
211
212
213
214
215
216
217
218
219</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;get #{key} from #{server.inspect}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='cache_get identifier id'>cache_get</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span> <span class='value identifier id'>value</span> <span class='unless unless_mod kw'>unless</span> <span class='raw identifier id'>raw</span>
    <span class='return return kw'>return</span> <span class='value identifier id'>value</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='TypeError constant id'>TypeError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
  <span class='handle_error identifier id'>handle_error</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_multi</h3>
</div><div id="get_multi-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_multi</span><span class='args'>(*keys)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Retrieves multiple values from memcached in parallel, if possible.
</p>
<p>
The memcached protocol supports the ability to retrieve multiple keys in a
single request. Pass in an array of keys to this method and it will:
</p>
<ol>
<li>map the key to the appropriate memcached server

</li>
<li>send a single request to each server that has one or more key values

</li>
</ol>
<p>
Returns a hash of values.
</p>
<pre class="code">
  <span class='cache identifier id'>cache</span><span class='lbrack token'>[</span><span class='string val'>&quot;a&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
  <span class='cache identifier id'>cache</span><span class='lbrack token'>[</span><span class='string val'>&quot;b&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>2</span>
  <span class='cache identifier id'>cache</span><span class='dot token'>.</span><span class='get_multi identifier id'>get_multi</span> <span class='string val'>&quot;a&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;b&quot;</span> <span class='comment val'># =&gt; { &quot;a&quot; =&gt; 1, &quot;b&quot; =&gt; 2 }</span>
</pre>
<p>
Note that get_multi assumes the values are marshalled.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 258</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L258">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_multi identifier id'>get_multi</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='keys identifier id'>keys</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>'No active servers'</span> <span class='unless unless_mod kw'>unless</span> <span class='active? fid id'>active?</span>

  <span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='flatten! fid id'>flatten!</span>
  <span class='key_count identifier id'>key_count</span> <span class='assign token'>=</span> <span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
  <span class='cache_keys identifier id'>cache_keys</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='server_keys identifier id'>server_keys</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>

  <span class='comment val'># map keys to servers</span>
  <span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='bitor op'>|</span>
    <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span> <span class='assign token'>=</span> <span class='request_setup identifier id'>request_setup</span> <span class='key identifier id'>key</span>
    <span class='cache_keys identifier id'>cache_keys</span><span class='lbrack token'>[</span><span class='cache_key identifier id'>cache_key</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='key identifier id'>key</span>
    <span class='server_keys identifier id'>server_keys</span><span class='lbrack token'>[</span><span class='server identifier id'>server</span><span class='rbrack token'>]</span> <span class='lshft op'>&lt;&lt;</span> <span class='cache_key identifier id'>cache_key</span>
  <span class='end end kw'>end</span>

  <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='server_keys identifier id'>server_keys</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='keys_for_server identifier id'>keys_for_server</span><span class='bitor op'>|</span>
    <span class='keys_for_server_str identifier id'>keys_for_server_str</span> <span class='assign token'>=</span> <span class='keys_for_server identifier id'>keys_for_server</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='string val'>' '</span>
    <span class='begin begin kw'>begin</span>
      <span class='values identifier id'>values</span> <span class='assign token'>=</span> <span class='cache_get_multi identifier id'>cache_get_multi</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='keys_for_server_str identifier id'>keys_for_server_str</span>
      <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='cache_keys identifier id'>cache_keys</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span> <span class='value identifier id'>value</span>
      <span class='end end kw'>end</span>
    <span class='rescue rescue kw'>rescue</span> <span class='IndexError constant id'>IndexError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='comment val'># Ignore this server and try the others</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Unable to retrieve #{keys_for_server.size} elements from #{server.inspect}: #{e.message}&quot;</span><span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='results identifier id'>results</span>
<span class='rescue rescue kw'>rescue</span> <span class='TypeError constant id'>TypeError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
  <span class='handle_error identifier id'>handle_error</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_server_for_key</h3>
</div><div id="get_server_for_key-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_server_for_key</span><span class='args'>(key, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Pick a server to handle the request based on a hash of the key.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 646</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L646">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get_server_for_key identifier id'>get_server_for_key</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;illegal character in key #{key.inspect}&quot;</span> <span class='if if_mod kw'>if</span>
    <span class='key identifier id'>key</span> <span class='match op'>=~</span> <span class='regexp val'>/\s/</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;key too long #{key.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='key identifier id'>key</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>250</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;No servers available&quot;</span> <span class='if if_mod kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='return return kw'>return</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='if if_mod kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span>

  <span class='hkey identifier id'>hkey</span> <span class='assign token'>=</span> <span class='hash_for identifier id'>hash_for</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>

  <span class='float val'>20</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='try identifier id'>try</span><span class='bitor op'>|</span>
    <span class='entryidx identifier id'>entryidx</span> <span class='assign token'>=</span> <span class='Continuum constant id'>Continuum</span><span class='dot token'>.</span><span class='binary_search identifier id'>binary_search</span><span class='lparen token'>(</span><span class='@continuum ivar id'>@continuum</span><span class='comma token'>,</span> <span class='hkey identifier id'>hkey</span><span class='rparen token'>)</span>
    <span class='server identifier id'>server</span> <span class='assign token'>=</span> <span class='@continuum ivar id'>@continuum</span><span class='lbrack token'>[</span><span class='entryidx identifier id'>entryidx</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='server identifier id'>server</span>
    <span class='return return kw'>return</span> <span class='server identifier id'>server</span> <span class='if if_mod kw'>if</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='alive? fid id'>alive?</span>
    <span class='break break kw'>break</span> <span class='unless unless_mod kw'>unless</span> <span class='failover identifier id'>failover</span>
    <span class='hkey identifier id'>hkey</span> <span class='assign token'>=</span> <span class='hash_for identifier id'>hash_for</span> <span class='dstring node'>&quot;#{try}#{key}&quot;</span>
  <span class='end end kw'>end</span>
  
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;No servers available&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>gets</h3>
</div><div id="gets-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>gets</span><span class='args'>(key, raw = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 709</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L709">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='gets identifier id'>gets</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;gets #{key} from #{server.inspect}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;gets #{cache_key}\r\n&quot;</span>
      <span class='keyline identifier id'>keyline</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span> <span class='comment val'># &quot;VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt; &lt;cas token&gt;\r\n&quot;</span>

      <span class='if if kw'>if</span> <span class='keyline identifier id'>keyline</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
        <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='keyline identifier id'>keyline</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='keyline identifier id'>keyline</span> <span class='eq op'>==</span> <span class='string val'>&quot;END\r\n&quot;</span>

      <span class='unless unless kw'>unless</span> <span class='keyline identifier id'>keyline</span> <span class='match op'>=~</span> <span class='regexp val'>/(\d+) (\w+)\r/</span> <span class='then then kw'>then</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
        <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unexpected response #{keyline.inspect}&quot;</span>
      <span class='end end kw'>end</span>
      <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='integer val'>2</span> <span class='comment val'># &quot;\r\n&quot;</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>   <span class='comment val'># &quot;END\r\n&quot;</span>
      <span class='lbrack token'>[</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='$2 nth_ref id'>$2</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
    <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='raw identifier id'>raw</span>
    <span class='result identifier id'>result</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='TypeError constant id'>TypeError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
  <span class='handle_error identifier id'>handle_error</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>handle_error</h3>
</div><div id="handle_error-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>handle_error</span><span class='args'>(server, error)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Handles <tt>error</tt> from <tt>server</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 847</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L847">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">847
848
849
850
851
852
853</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='error identifier id'>error</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='error identifier id'>error</span> <span class='if if_mod kw'>if</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='MemCacheError constant id'>MemCacheError</span><span class='rparen token'>)</span>
  <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='server identifier id'>server</span>
  <span class='new_error identifier id'>new_error</span> <span class='assign token'>=</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
  <span class='new_error identifier id'>new_error</span><span class='dot token'>.</span><span class='set_backtrace identifier id'>set_backtrace</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span>
  <span class='raise identifier id'>raise</span> <span class='new_error identifier id'>new_error</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>hash_for</h3>
</div><div id="hash_for-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>hash_for</span><span class='args'>(key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns an interoperable hash value for <tt>key</tt>. (I think, docs are
sketchy for down servers).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 639</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L639">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">639
640
641</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='hash_for identifier id'>hash_for</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='Zlib constant id'>Zlib</span><span class='dot token'>.</span><span class='crc32 identifier id'>crc32</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>incr</h3>
</div><div id="incr-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>incr</span><span class='args'>(key, amount = 1)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Increments the value for <tt>key</tt> by <tt>amount</tt> and returns the
new value. <tt>key</tt> must already exist. If <tt>key</tt> is not an
integer, it is assumed to be 0.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 298</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L298">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">298
299
300
301
302
303
304
305</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='incr identifier id'>incr</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span> <span class='assign token'>=</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='cache_incr identifier id'>cache_incr</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='TypeError constant id'>TypeError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
  <span class='handle_error identifier id'>handle_error</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>inspect</h3>
</div><div id="inspect-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>inspect</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns a string representation of the cache object.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 145</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L145">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">145
146
147
148</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='inspect identifier id'>inspect</span>
  <span class='string val'>&quot;&lt;MemCache: %d servers, ns: %p, ro: %p&gt;&quot;</span> <span class='mod op'>%</span>
    <span class='lbrack token'>[</span><span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='comma token'>,</span> <span class='@namespace ivar id'>@namespace</span><span class='comma token'>,</span> <span class='@readonly ivar id'>@readonly</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>make_cache_key</h3>
</div><div id="make_cache_key-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>make_cache_key</span><span class='args'>(key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create a key for the cache, incorporating the namespace qualifier if
requested.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 627</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L627">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">627
628
629
630
631
632
633</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='make_cache_key identifier id'>make_cache_key</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='namespace identifier id'>namespace</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
    <span class='key identifier id'>key</span>
  <span class='else else kw'>else</span>
    <span class='dstring node'>&quot;#{@namespace}:#{key}&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>noreply</h3>
</div><div id="noreply-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>noreply</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 855</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L855">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">855
856
857</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='noreply identifier id'>noreply</span>
  <span class='@no_reply ivar id'>@no_reply</span> <span class='question op'>?</span> <span class='string val'>' noreply'</span> <span class='colon op'>:</span> <span class='string val'>''</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>prepend</h3>
</div><div id="prepend-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>prepend</span><span class='args'>(key, value)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Prepend - &#8216;add this data to an existing key before existing
data&#8217; Please note the value is always passed to memcached as raw
since it doesn&#8217;t make a lot of sense to concatenate marshalled data
together.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 459</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L459">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">459
460
461
462
463
464
465
466
467
468
469
470
471
472
473</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='prepend identifier id'>prepend</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;prepend #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;prepend #{cache_key} 0 0 #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>

    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='command identifier id'>command</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>
      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>raise_on_error_response!</h3>
</div><div id="raise_on_error_response-21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>raise_on_error_response!</span><span class='args'>(response)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 870</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L870">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">870
871
872
873
874</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='raise_on_error_response! fid id'>raise_on_error_response!</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='response identifier id'>response</span> <span class='match op'>=~</span> <span class='regexp val'>/\A(?:CLIENT_|SERVER_)?ERROR(.*)/</span>
    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>readonly?</h3>
</div><div id="readonly-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>readonly?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns whether or not the cache object was created read only.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 160</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L160">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">160
161
162</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='readonly? fid id'>readonly?</span>
  <span class='@readonly ivar id'>@readonly</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>replace</h3>
</div><div id="replace-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>replace</span><span class='args'>(key, value, expiry = 0, raw = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Add <tt>key</tt> to the cache with value <tt>value</tt> that expires in
<tt>expiry</tt> seconds, but only if <tt>key</tt> already exists in the
cache. If <tt>raw</tt> is true, <tt>value</tt> will not be Marshalled.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 418</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L418">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='replace identifier id'>replace</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='expiry identifier id'>expiry</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>
  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span> <span class='value identifier id'>value</span> <span class='unless unless_mod kw'>unless</span> <span class='raw identifier id'>raw</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;replace #{key} to #{server}: #{value ? value.to_s.size : 'nil'}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;replace #{cache_key} 0 #{expiry} #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>

    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='command identifier id'>command</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>
      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>request_setup</h3>
</div><div id="request_setup-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>request_setup</span><span class='args'>(key)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Performs setup for making a request with <tt>key</tt> from memcached.
Returns the server to fetch the key from and the complete key to use.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 863</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L863">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">863
864
865
866
867
868</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='request_setup identifier id'>request_setup</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>'No active servers'</span> <span class='unless unless_mod kw'>unless</span> <span class='active? fid id'>active?</span>
  <span class='cache_key identifier id'>cache_key</span> <span class='assign token'>=</span> <span class='make_cache_key identifier id'>make_cache_key</span> <span class='key identifier id'>key</span>
  <span class='server identifier id'>server</span> <span class='assign token'>=</span> <span class='get_server_for_key identifier id'>get_server_for_key</span> <span class='cache_key identifier id'>cache_key</span>
  <span class='return return kw'>return</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reset</h3>
</div><div id="reset-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reset</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Reset the connection to all memcache servers. This should be called if
there is a problem with a cache lookup that might have left the connection
in a corrupted state.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 532</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L532">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">532
533
534</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reset identifier id'>reset</span>
  <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>servers=</h3>
</div><div id="servers-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>servers=</span><span class='args'>(servers)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Set the servers that the requests will be distributed between. Entries can
be either strings of the form &quot;hostname:port&quot; or
&quot;hostname:port:weight&quot; or MemCache::Server objects.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 169</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L169">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='servers= identifier id'>servers=</span><span class='lparen token'>(</span><span class='servers identifier id'>servers</span><span class='rparen token'>)</span>
  <span class='comment val'># Create the server objects.</span>
  <span class='@servers ivar id'>@servers</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='servers identifier id'>servers</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
    <span class='case case kw'>case</span> <span class='server identifier id'>server</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span>
      <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span> <span class='assign token'>=</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='split identifier id'>split</span> <span class='string val'>':'</span><span class='comma token'>,</span> <span class='integer val'>3</span>
      <span class='port identifier id'>port</span> <span class='opasgn op'>||=</span> <span class='DEFAULT_PORT constant id'>DEFAULT_PORT</span>
      <span class='weight identifier id'>weight</span> <span class='opasgn op'>||=</span> <span class='DEFAULT_WEIGHT constant id'>DEFAULT_WEIGHT</span>
      <span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='self self kw'>self</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span>
    <span class='else else kw'>else</span>
      <span class='server identifier id'>server</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Servers now: #{@servers.inspect}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>

  <span class='comment val'># There's no point in doing this if there's only one server</span>
  <span class='@continuum ivar id'>@continuum</span> <span class='assign token'>=</span> <span class='create_continuum_for identifier id'>create_continuum_for</span><span class='lparen token'>(</span><span class='@servers ivar id'>@servers</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>

  <span class='@servers ivar id'>@servers</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set</h3>
</div><div id="set-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set</span><span class='args'>(key, value, expiry = 0, raw = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 316</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L316">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='expiry identifier id'>expiry</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Update of readonly cache&quot;</span> <span class='if if_mod kw'>if</span> <span class='@readonly ivar id'>@readonly</span>

  <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='dump identifier id'>dump</span> <span class='value identifier id'>value</span> <span class='unless unless_mod kw'>unless</span> <span class='raw identifier id'>raw</span>
  <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;set #{key} to #{server.inspect}: #{value.to_s.size}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>

    <span class='if if kw'>if</span> <span class='@check_size ivar id'>@check_size</span> <span class='andop op'>&amp;&amp;</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='ONE_MB constant id'>ONE_MB</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;Value too large, memcached can only store 1MB of data per key&quot;</span>
    <span class='end end kw'>end</span>

    <span class='command identifier id'>command</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;set #{cache_key} 0 #{expiry} #{value.to_s.size}#{noreply}\r\n#{value}\r\n&quot;</span>

    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='command identifier id'>command</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='result identifier id'>result</span>

      <span class='if if kw'>if</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
        <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stats</h3>
</div><div id="stats-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stats</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns statistics for each memcached server. An explanation of the
statistics can be found in the memcached docs:
</p>
<p>
http://code.sixapart.com/svn/memcached/trunk/server/doc/protocol.txt
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='rshft op'>&gt;&gt;</span> <span class='pp identifier id'>pp</span> <span class='CACHE constant id'>CACHE</span><span class='dot token'>.</span><span class='stats identifier id'>stats</span>
  <span class='lbrace token'>{</span><span class='string val'>&quot;localhost:11211&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span>
    <span class='lbrace token'>{</span><span class='string val'>&quot;bytes&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>4718</span><span class='comma token'>,</span>
     <span class='string val'>&quot;pid&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>20188</span><span class='comma token'>,</span>
     <span class='string val'>&quot;connection_structures&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>4</span><span class='comma token'>,</span>
     <span class='string val'>&quot;time&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>1162278121</span><span class='comma token'>,</span>
     <span class='string val'>&quot;pointer_size&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>32</span><span class='comma token'>,</span>
     <span class='string val'>&quot;limit_maxbytes&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>67108864</span><span class='comma token'>,</span>
     <span class='string val'>&quot;cmd_get&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>14532</span><span class='comma token'>,</span>
     <span class='string val'>&quot;version&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;1.2.0&quot;</span><span class='comma token'>,</span>
     <span class='string val'>&quot;bytes_written&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>432583</span><span class='comma token'>,</span>
     <span class='string val'>&quot;cmd_set&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>32</span><span class='comma token'>,</span>
     <span class='string val'>&quot;get_misses&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>0</span><span class='comma token'>,</span>
     <span class='string val'>&quot;total_connections&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>19</span><span class='comma token'>,</span>
     <span class='string val'>&quot;curr_connections&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>3</span><span class='comma token'>,</span>
     <span class='string val'>&quot;curr_items&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>4</span><span class='comma token'>,</span>
     <span class='string val'>&quot;uptime&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>1557</span><span class='comma token'>,</span>
     <span class='string val'>&quot;get_hits&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>14532</span><span class='comma token'>,</span>
     <span class='string val'>&quot;total_items&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>32</span><span class='comma token'>,</span>
     <span class='string val'>&quot;rusage_system&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>0</span><span class='integer val'>.313952</span><span class='comma token'>,</span>
     <span class='string val'>&quot;rusage_user&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>0</span><span class='integer val'>.119981</span><span class='comma token'>,</span>
     <span class='string val'>&quot;bytes_read&quot;</span><span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='integer val'>190619</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span>
  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span>
</pre>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href="MemCache/MemCacheError.html" title="MemCacheError">MemCacheError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 568</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L568">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684
685
686
687
688
689
690
691
692
693
694
695
696
697
698
699
700
701
702
703
704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744
745
746
747
748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782
783
784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838
839
840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938
939
940
941
942
943
944
945
946
947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969
970
971
972
973
974
975
976
977
978
979
980
981
982
983
984
985
986
987
988
989
990
991
992
993
994
995
996
997
998
999
1000
1001
1002
1003
1004
1005
1006
1007
1008
1009
1010
1011
1012
1013
1014
1015
1016
1017
1018
1019
1020
1021
1022
1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='stats identifier id'>stats</span>
    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;No active servers&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='active? fid id'>active?</span>
    <span class='server_stats identifier id'>server_stats</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

    <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
      <span class='next next kw'>next</span> <span class='unless unless_mod kw'>unless</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='alive? fid id'>alive?</span>

      <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='string val'>&quot;stats\r\n&quot;</span>
        <span class='stats identifier id'>stats</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
        <span class='while while kw'>while</span> <span class='line identifier id'>line</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span> <span class='do do kw'>do</span>
          <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='line identifier id'>line</span>
          <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='line identifier id'>line</span> <span class='eq op'>==</span> <span class='string val'>&quot;END\r\n&quot;</span>
          <span class='if if kw'>if</span> <span class='line identifier id'>line</span> <span class='match op'>=~</span> <span class='regexp val'>/\ASTAT ([\S]+) ([\w\.\:]+)/</span> <span class='then then kw'>then</span>
            <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span><span class='comma token'>,</span> <span class='$2 nth_ref id'>$2</span>
            <span class='stats identifier id'>stats</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='name identifier id'>name</span>
                          <span class='when when kw'>when</span> <span class='string val'>'version'</span>
                            <span class='value identifier id'>value</span>
                          <span class='when when kw'>when</span> <span class='string val'>'rusage_user'</span><span class='comma token'>,</span> <span class='string val'>'rusage_system'</span> <span class='then then kw'>then</span>
                            <span class='seconds identifier id'>seconds</span><span class='comma token'>,</span> <span class='microseconds identifier id'>microseconds</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>/:/</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
                            <span class='microseconds identifier id'>microseconds</span> <span class='opasgn op'>||=</span> <span class='integer val'>0</span>
                            <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='seconds identifier id'>seconds</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='microseconds identifier id'>microseconds</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='integer val'>1_000_000</span><span class='rparen token'>)</span>
                          <span class='else else kw'>else</span>
                            <span class='if if kw'>if</span> <span class='value identifier id'>value</span> <span class='match op'>=~</span> <span class='regexp val'>/\A\d+\Z/</span> <span class='then then kw'>then</span>
                              <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
                            <span class='else else kw'>else</span>
                              <span class='value identifier id'>value</span>
                            <span class='end end kw'>end</span>
                          <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
        <span class='server_stats identifier id'>server_stats</span><span class='lbrack token'>[</span><span class='dstring node'>&quot;#{server.host}:#{server.port}&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='stats identifier id'>stats</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;No active servers&quot;</span> <span class='if if_mod kw'>if</span> <span class='server_stats identifier id'>server_stats</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='server_stats identifier id'>server_stats</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Shortcut to get a value from the cache.</span>

  <span class='alias alias kw'>alias</span> <span class='aref op'>[]</span> <span class='get identifier id'>get</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Shortcut to save a value in the cache.  This method does not set an</span>
  <span class='comment val'># expiration on the entry.  Use set to specify an explicit expiry.</span>

  <span class='def def kw'>def</span> <span class='aset op'>[]=</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span>
    <span class='set identifier id'>set</span> <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span>
  <span class='end end kw'>end</span>

  <span class='protected identifier id'>protected</span> <span class='unless unless_mod kw'>unless</span> <span class='$TESTING gvar id'>$TESTING</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Create a key for the cache, incorporating the namespace qualifier if</span>
  <span class='comment val'># requested.</span>

  <span class='def def kw'>def</span> <span class='make_cache_key identifier id'>make_cache_key</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='namespace identifier id'>namespace</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
      <span class='key identifier id'>key</span>
    <span class='else else kw'>else</span>
      <span class='dstring node'>&quot;#{@namespace}:#{key}&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Returns an interoperable hash value for +key+.  (I think, docs are</span>
  <span class='comment val'># sketchy for down servers).</span>

  <span class='def def kw'>def</span> <span class='hash_for identifier id'>hash_for</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='Zlib constant id'>Zlib</span><span class='dot token'>.</span><span class='crc32 identifier id'>crc32</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Pick a server to handle the request based on a hash of the key.</span>

  <span class='def def kw'>def</span> <span class='get_server_for_key identifier id'>get_server_for_key</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;illegal character in key #{key.inspect}&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='key identifier id'>key</span> <span class='match op'>=~</span> <span class='regexp val'>/\s/</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;key too long #{key.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='key identifier id'>key</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>250</span>
    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;No servers available&quot;</span> <span class='if if_mod kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='return return kw'>return</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='if if_mod kw'>if</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span>

    <span class='hkey identifier id'>hkey</span> <span class='assign token'>=</span> <span class='hash_for identifier id'>hash_for</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>

    <span class='float val'>20</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='try identifier id'>try</span><span class='bitor op'>|</span>
      <span class='entryidx identifier id'>entryidx</span> <span class='assign token'>=</span> <span class='Continuum constant id'>Continuum</span><span class='dot token'>.</span><span class='binary_search identifier id'>binary_search</span><span class='lparen token'>(</span><span class='@continuum ivar id'>@continuum</span><span class='comma token'>,</span> <span class='hkey identifier id'>hkey</span><span class='rparen token'>)</span>
      <span class='server identifier id'>server</span> <span class='assign token'>=</span> <span class='@continuum ivar id'>@continuum</span><span class='lbrack token'>[</span><span class='entryidx identifier id'>entryidx</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='server identifier id'>server</span>
      <span class='return return kw'>return</span> <span class='server identifier id'>server</span> <span class='if if_mod kw'>if</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='alive? fid id'>alive?</span>
      <span class='break break kw'>break</span> <span class='unless unless_mod kw'>unless</span> <span class='failover identifier id'>failover</span>
      <span class='hkey identifier id'>hkey</span> <span class='assign token'>=</span> <span class='hash_for identifier id'>hash_for</span> <span class='dstring node'>&quot;#{try}#{key}&quot;</span>
    <span class='end end kw'>end</span>
    
    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;No servers available&quot;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Performs a raw decr for +cache_key+ from +server+.  Returns nil if not</span>
  <span class='comment val'># found.</span>

  <span class='def def kw'>def</span> <span class='cache_decr identifier id'>cache_decr</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='rparen token'>)</span>
    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;decr #{cache_key} #{amount}#{noreply}\r\n&quot;</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='text identifier id'>text</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;NOT_FOUND\r\n&quot;</span>
      <span class='return return kw'>return</span> <span class='text identifier id'>text</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Fetches the raw data for +cache_key+ from +server+.  Returns nil on cache</span>
  <span class='comment val'># miss.</span>

  <span class='def def kw'>def</span> <span class='cache_get identifier id'>cache_get</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='rparen token'>)</span>
    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;get #{cache_key}\r\n&quot;</span>
      <span class='keyline identifier id'>keyline</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span> <span class='comment val'># &quot;VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt;\r\n&quot;</span>

      <span class='if if kw'>if</span> <span class='keyline identifier id'>keyline</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
        <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
      <span class='end end kw'>end</span>

      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='keyline identifier id'>keyline</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='keyline identifier id'>keyline</span> <span class='eq op'>==</span> <span class='string val'>&quot;END\r\n&quot;</span>

      <span class='unless unless kw'>unless</span> <span class='keyline identifier id'>keyline</span> <span class='match op'>=~</span> <span class='regexp val'>/(\d+)\r/</span> <span class='then then kw'>then</span>
        <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
        <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unexpected response #{keyline.inspect}&quot;</span>
      <span class='end end kw'>end</span>
      <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='integer val'>2</span> <span class='comment val'># &quot;\r\n&quot;</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>   <span class='comment val'># &quot;END\r\n&quot;</span>
      <span class='return return kw'>return</span> <span class='value identifier id'>value</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='gets identifier id'>gets</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='raw identifier id'>raw</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
    <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='bitor op'>|</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;gets #{key} from #{server.inspect}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
        <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;gets #{cache_key}\r\n&quot;</span>
        <span class='keyline identifier id'>keyline</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span> <span class='comment val'># &quot;VALUE &lt;key&gt; &lt;flags&gt; &lt;bytes&gt; &lt;cas token&gt;\r\n&quot;</span>

        <span class='if if kw'>if</span> <span class='keyline identifier id'>keyline</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='then then kw'>then</span>
          <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
          <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span>
        <span class='end end kw'>end</span>

        <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='keyline identifier id'>keyline</span>
        <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='keyline identifier id'>keyline</span> <span class='eq op'>==</span> <span class='string val'>&quot;END\r\n&quot;</span>

        <span class='unless unless kw'>unless</span> <span class='keyline identifier id'>keyline</span> <span class='match op'>=~</span> <span class='regexp val'>/(\d+) (\w+)\r/</span> <span class='then then kw'>then</span>
          <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
          <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unexpected response #{keyline.inspect}&quot;</span>
        <span class='end end kw'>end</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
        <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='integer val'>2</span> <span class='comment val'># &quot;\r\n&quot;</span>
        <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>   <span class='comment val'># &quot;END\r\n&quot;</span>
        <span class='lbrack token'>[</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='$2 nth_ref id'>$2</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
      <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Marshal constant id'>Marshal</span><span class='dot token'>.</span><span class='load identifier id'>load</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='raw identifier id'>raw</span>
      <span class='result identifier id'>result</span>
    <span class='end end kw'>end</span>
  <span class='rescue rescue kw'>rescue</span> <span class='TypeError constant id'>TypeError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
    <span class='handle_error identifier id'>handle_error</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='err identifier id'>err</span>
  <span class='end end kw'>end</span>


  <span class='comment val'>##</span>
  <span class='comment val'># Fetches +cache_keys+ from +server+ using a multi-get.</span>

  <span class='def def kw'>def</span> <span class='cache_get_multi identifier id'>cache_get_multi</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_keys identifier id'>cache_keys</span><span class='rparen token'>)</span>
    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='values identifier id'>values</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;get #{cache_keys}\r\n&quot;</span>

      <span class='while while kw'>while</span> <span class='keyline identifier id'>keyline</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span> <span class='do do kw'>do</span>
        <span class='return return kw'>return</span> <span class='values identifier id'>values</span> <span class='if if_mod kw'>if</span> <span class='keyline identifier id'>keyline</span> <span class='eq op'>==</span> <span class='string val'>&quot;END\r\n&quot;</span>
        <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='keyline identifier id'>keyline</span>

        <span class='unless unless kw'>unless</span> <span class='keyline identifier id'>keyline</span> <span class='match op'>=~</span> <span class='regexp val'>/\AVALUE (.+) (.+) (.+)/</span> <span class='then then kw'>then</span>
          <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
          <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;unexpected response #{keyline.inspect}&quot;</span>
        <span class='end end kw'>end</span>

        <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='data_length identifier id'>data_length</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span><span class='comma token'>,</span> <span class='$3 nth_ref id'>$3</span>
        <span class='values identifier id'>values</span><span class='lbrack token'>[</span><span class='$1 nth_ref id'>$1</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span> <span class='data_length identifier id'>data_length</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
        <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='integer val'>2</span><span class='rparen token'>)</span> <span class='comment val'># &quot;\r\n&quot;</span>
      <span class='end end kw'>end</span>

      <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;lost connection to #{server.host}:#{server.port}&quot;</span> <span class='comment val'># TODO: retry here too</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Performs a raw incr for +cache_key+ from +server+.  Returns nil if not</span>
  <span class='comment val'># found.</span>

  <span class='def def kw'>def</span> <span class='cache_incr identifier id'>cache_incr</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='rparen token'>)</span>
    <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='socket identifier id'>socket</span><span class='bitor op'>|</span>
      <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='dstring node'>&quot;incr #{cache_key} #{amount}#{noreply}\r\n&quot;</span>
      <span class='break break kw'>break</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='@no_reply ivar id'>@no_reply</span>
      <span class='text identifier id'>text</span> <span class='assign token'>=</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='raise_on_error_response! fid id'>raise_on_error_response!</span> <span class='text identifier id'>text</span>
      <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='text identifier id'>text</span> <span class='eq op'>==</span> <span class='string val'>&quot;NOT_FOUND\r\n&quot;</span>
      <span class='return return kw'>return</span> <span class='text identifier id'>text</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Gets or creates a socket connected to the given server, and yields it</span>
  <span class='comment val'># to the block, wrapped in a mutex synchronization if @multithread is true.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If a socket error (SocketError, SystemCallError, IOError) or protocol error</span>
  <span class='comment val'># (MemCacheError) is raised by the block, closes the socket, attempts to</span>
  <span class='comment val'># connect again, and retries the block (once).  If an error is again raised,</span>
  <span class='comment val'># reraises it as MemCacheError.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If unable to connect to the server (or if in the reconnect wait period),</span>
  <span class='comment val'># raises MemCacheError.  Note that the socket connect code marks a server</span>
  <span class='comment val'># dead for a timeout period, so retrying does not apply to connection attempt</span>
  <span class='comment val'># failures (but does still apply to unexpectedly lost connections etc.).</span>

  <span class='def def kw'>def</span> <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='check_multithread_status! fid id'>check_multithread_status!</span>

    <span class='@mutex ivar id'>@mutex</span><span class='dot token'>.</span><span class='lock identifier id'>lock</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>
    <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

    <span class='begin begin kw'>begin</span>
      <span class='socket identifier id'>socket</span> <span class='assign token'>=</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='socket identifier id'>socket</span>

      <span class='comment val'># Raise an IndexError to show this server is out of whack. If were inside</span>
      <span class='comment val'># a with_server block, we'll catch it and attempt to restart the operation.</span>

      <span class='raise identifier id'>raise</span> <span class='IndexError constant id'>IndexError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;No connection to server (#{server.status})&quot;</span> <span class='if if_mod kw'>if</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

      <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>

    <span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EAGAIN constant id'>EAGAIN</span><span class='comma token'>,</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Socket failure: #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='mark_dead identifier id'>mark_dead</span><span class='lparen token'>(</span><span class='err identifier id'>err</span><span class='rparen token'>)</span>
      <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span>

    <span class='rescue rescue kw'>rescue</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Generic failure: #{err.class.name}: #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='retried identifier id'>retried</span> <span class='orop op'>||</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
      <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
      <span class='retry retry kw'>retry</span>
    <span class='end end kw'>end</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='@mutex ivar id'>@mutex</span><span class='dot token'>.</span><span class='unlock identifier id'>unlock</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='begin begin kw'>begin</span>
      <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span> <span class='assign token'>=</span> <span class='request_setup identifier id'>request_setup</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
      <span class='yield yield kw'>yield</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span>
    <span class='rescue rescue kw'>rescue</span> <span class='IndexError constant id'>IndexError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Server failed: #{e.class.name}: #{e.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='retried identifier id'>retried</span> <span class='andop op'>&amp;&amp;</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
        <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Connection to server #{server.inspect} DIED! Retrying operation...&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
        <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
        <span class='retry retry kw'>retry</span>
      <span class='end end kw'>end</span>
      <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Handles +error+ from +server+.</span>

  <span class='def def kw'>def</span> <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='error identifier id'>error</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='error identifier id'>error</span> <span class='if if_mod kw'>if</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='MemCacheError constant id'>MemCacheError</span><span class='rparen token'>)</span>
    <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='server identifier id'>server</span>
    <span class='new_error identifier id'>new_error</span> <span class='assign token'>=</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
    <span class='new_error identifier id'>new_error</span><span class='dot token'>.</span><span class='set_backtrace identifier id'>set_backtrace</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span>
    <span class='raise identifier id'>raise</span> <span class='new_error identifier id'>new_error</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='noreply identifier id'>noreply</span>
    <span class='@no_reply ivar id'>@no_reply</span> <span class='question op'>?</span> <span class='string val'>' noreply'</span> <span class='colon op'>:</span> <span class='string val'>''</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Performs setup for making a request with +key+ from memcached.  Returns</span>
  <span class='comment val'># the server to fetch the key from and the complete key to use.</span>

  <span class='def def kw'>def</span> <span class='request_setup identifier id'>request_setup</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>'No active servers'</span> <span class='unless unless_mod kw'>unless</span> <span class='active? fid id'>active?</span>
    <span class='cache_key identifier id'>cache_key</span> <span class='assign token'>=</span> <span class='make_cache_key identifier id'>make_cache_key</span> <span class='key identifier id'>key</span>
    <span class='server identifier id'>server</span> <span class='assign token'>=</span> <span class='get_server_for_key identifier id'>get_server_for_key</span> <span class='cache_key identifier id'>cache_key</span>
    <span class='return return kw'>return</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='raise_on_error_response! fid id'>raise_on_error_response!</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='response identifier id'>response</span> <span class='match op'>=~</span> <span class='regexp val'>/\A(?:CLIENT_|SERVER_)?ERROR(.*)/</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='$1 nth_ref id'>$1</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='create_continuum_for identifier id'>create_continuum_for</span><span class='lparen token'>(</span><span class='servers identifier id'>servers</span><span class='rparen token'>)</span>
    <span class='total_weight identifier id'>total_weight</span> <span class='assign token'>=</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='memo identifier id'>memo</span><span class='comma token'>,</span> <span class='srv identifier id'>srv</span><span class='bitor op'>|</span> <span class='memo identifier id'>memo</span> <span class='plus op'>+</span> <span class='srv identifier id'>srv</span><span class='dot token'>.</span><span class='weight identifier id'>weight</span> <span class='rbrace token'>}</span>
    <span class='continuum identifier id'>continuum</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

    <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='bitor op'>|</span>
      <span class='entry_count_for identifier id'>entry_count_for</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='servers identifier id'>servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span> <span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='idx identifier id'>idx</span><span class='bitor op'>|</span>
        <span class='hash identifier id'>hash</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='SHA1 constant id'>SHA1</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{server.host}:#{server.port}:#{idx}&quot;</span><span class='rparen token'>)</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='Integer constant id'>Integer</span><span class='lparen token'>(</span><span class='dstring node'>&quot;0x#{hash[0..7]}&quot;</span><span class='rparen token'>)</span>
        <span class='continuum identifier id'>continuum</span> <span class='lshft op'>&lt;&lt;</span> <span class='Continuum constant id'>Continuum</span><span class='colon2 op'>::</span><span class='Entry constant id'>Entry</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='continuum identifier id'>continuum</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='cmp op'>&lt;=&gt;</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='entry_count_for identifier id'>entry_count_for</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='total_servers identifier id'>total_servers</span><span class='comma token'>,</span> <span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span>
    <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='total_servers identifier id'>total_servers</span> <span class='mult op'>*</span> <span class='Continuum constant id'>Continuum</span><span class='colon2 op'>::</span><span class='POINTS_PER_SERVER constant id'>POINTS_PER_SERVER</span> <span class='mult op'>*</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='weight identifier id'>weight</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='total_weight identifier id'>total_weight</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='floor identifier id'>floor</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='check_multithread_status! fid id'>check_multithread_status!</span>
    <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>

    <span class='if if kw'>if</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:memcache_client</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span>
      <span class='raise identifier id'>raise</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='string val'>&quot;You are accessing this memcache-client instance from multiple threads but have not enabled multithread support.\nNormally:  MemCache.new(['localhost:11211'], :multithread =&gt; true)\nIn Rails:  config.cache_store = [:mem_cache_store, 'localhost:11211', { :multithread =&gt; true }]\n&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># This class represents a memcached server instance.</span>

  <span class='class class kw'>class</span> <span class='Server constant id'>Server</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The amount of time to wait before attempting to re-establish a</span>
    <span class='comment val'># connection with a server that is marked dead.</span>

    <span class='RETRY_DELAY constant id'>RETRY_DELAY</span> <span class='assign token'>=</span> <span class='float val'>30.0</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The host the memcached server is running on.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:host</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The port the memcached server is listening on.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:port</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The weight given to the server.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:weight</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The time of next retry if the connection is dead.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:retry</span>

    <span class='comment val'>##</span>
    <span class='comment val'># A text status string describing the state of the server.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:status</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:logger</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Create a new MemCache::Server object for the memcached instance</span>
    <span class='comment val'># listening on the given host and port, weighted by the given weight.</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='memcache identifier id'>memcache</span><span class='comma token'>,</span> <span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span> <span class='assign token'>=</span> <span class='DEFAULT_PORT constant id'>DEFAULT_PORT</span><span class='comma token'>,</span> <span class='weight identifier id'>weight</span> <span class='assign token'>=</span> <span class='DEFAULT_WEIGHT constant id'>DEFAULT_WEIGHT</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;No host specified&quot;</span> <span class='if if_mod kw'>if</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;No port specified&quot;</span> <span class='if if_mod kw'>if</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>

      <span class='@host ivar id'>@host</span>   <span class='assign token'>=</span> <span class='host identifier id'>host</span>
      <span class='@port ivar id'>@port</span>   <span class='assign token'>=</span> <span class='port identifier id'>port</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
      <span class='@weight ivar id'>@weight</span> <span class='assign token'>=</span> <span class='weight identifier id'>weight</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>

      <span class='@sock ivar id'>@sock</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='string val'>'NOT CONNECTED'</span>
      <span class='@timeout ivar id'>@timeout</span> <span class='assign token'>=</span> <span class='memcache identifier id'>memcache</span><span class='dot token'>.</span><span class='timeout identifier id'>timeout</span>
      <span class='@logger ivar id'>@logger</span> <span class='assign token'>=</span> <span class='memcache identifier id'>memcache</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Return a string representation of the server object.</span>

    <span class='def def kw'>def</span> <span class='inspect identifier id'>inspect</span>
      <span class='string val'>&quot;&lt;MemCache::Server: %s:%d [%d] (%s)&gt;&quot;</span> <span class='mod op'>%</span> <span class='lbrack token'>[</span><span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='comma token'>,</span> <span class='@weight ivar id'>@weight</span><span class='comma token'>,</span> <span class='@status ivar id'>@status</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Check whether the server connection is alive.  This will cause the</span>
    <span class='comment val'># socket to attempt to connect if it isn't already connected and or if</span>
    <span class='comment val'># the server was previously marked as down and the retry time has</span>
    <span class='comment val'># been exceeded.</span>

    <span class='def def kw'>def</span> <span class='alive? fid id'>alive?</span>
      <span class='notop op'>!</span><span class='notop op'>!</span><span class='socket identifier id'>socket</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Try to connect to the memcached server targeted by this object.</span>
    <span class='comment val'># Returns the connected socket object on success or nil on failure.</span>

    <span class='def def kw'>def</span> <span class='socket identifier id'>socket</span>
      <span class='return return kw'>return</span> <span class='@sock ivar id'>@sock</span> <span class='if if_mod kw'>if</span> <span class='@sock ivar id'>@sock</span> <span class='and and kw'>and</span> <span class='not not kw'>not</span> <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>

      <span class='@sock ivar id'>@sock</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

      <span class='comment val'># If the host was dead, don't retry for a while.</span>
      <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@retry ivar id'>@retry</span> <span class='and and kw'>and</span> <span class='@retry ivar id'>@retry</span> <span class='gt op'>&gt;</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>

      <span class='comment val'># Attempt to connect if not already connected.</span>
      <span class='begin begin kw'>begin</span>
        <span class='@sock ivar id'>@sock</span> <span class='assign token'>=</span> <span class='connect_to identifier id'>connect_to</span><span class='lparen token'>(</span><span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='comma token'>,</span> <span class='@timeout ivar id'>@timeout</span><span class='rparen token'>)</span>
        <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='IPPROTO_TCP constant id'>IPPROTO_TCP</span><span class='comma token'>,</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='TCP_NODELAY constant id'>TCP_NODELAY</span><span class='comma token'>,</span> <span class='integer val'>1</span>
        <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='string val'>'CONNECTED'</span>
      <span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
        <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Unable to open socket: #{err.class.name}, #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
        <span class='mark_dead identifier id'>mark_dead</span> <span class='err identifier id'>err</span>
      <span class='end end kw'>end</span>

      <span class='return return kw'>return</span> <span class='@sock ivar id'>@sock</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='connect_to identifier id'>connect_to</span><span class='lparen token'>(</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='comma token'>,</span> <span class='timeout identifier id'>timeout</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
      <span class='io identifier id'>io</span> <span class='assign token'>=</span> <span class='MemCache constant id'>MemCache</span><span class='colon2 op'>::</span><span class='BufferedIO constant id'>BufferedIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='TCPSocket constant id'>TCPSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='host identifier id'>host</span><span class='comma token'>,</span> <span class='port identifier id'>port</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='read_timeout identifier id'>read_timeout</span> <span class='assign token'>=</span> <span class='timeout identifier id'>timeout</span>
      <span class='io identifier id'>io</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Close the connection to the memcached server targeted by this</span>
    <span class='comment val'># object.  The server is not considered dead.</span>

    <span class='def def kw'>def</span> <span class='close identifier id'>close</span>
      <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='@sock ivar id'>@sock</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>
      <span class='@sock ivar id'>@sock</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='string val'>&quot;NOT CONNECTED&quot;</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Mark the server as dead and close its socket.</span>

    <span class='def def kw'>def</span> <span class='mark_dead identifier id'>mark_dead</span><span class='lparen token'>(</span><span class='error identifier id'>error</span><span class='rparen token'>)</span>
      <span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='@sock ivar id'>@sock</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@sock ivar id'>@sock</span><span class='dot token'>.</span><span class='closed? fid id'>closed?</span>
      <span class='@sock ivar id'>@sock</span>   <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
      <span class='@retry ivar id'>@retry</span>  <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span> <span class='plus op'>+</span> <span class='RETRY_DELAY constant id'>RETRY_DELAY</span>

      <span class='reason identifier id'>reason</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{error.class.name}: #{error.message}&quot;</span>
      <span class='@status ivar id'>@status</span> <span class='assign token'>=</span> <span class='sprintf identifier id'>sprintf</span> <span class='string val'>&quot;%s:%s DEAD (%s), will retry at %s&quot;</span><span class='comma token'>,</span> <span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='comma token'>,</span> <span class='reason identifier id'>reason</span><span class='comma token'>,</span> <span class='@retry ivar id'>@retry</span>
      <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='lbrace token'>{</span> <span class='@status ivar id'>@status</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='@logger ivar id'>@logger</span>
    <span class='end end kw'>end</span>

  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Base MemCache exception class.</span>

  <span class='class class kw'>class</span> <span class='MemCacheError constant id'>MemCacheError</span> <span class='lt op'>&lt;</span> <span class='RuntimeError constant id'>RuntimeError</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>

  <span class='class class kw'>class</span> <span class='BufferedIO constant id'>BufferedIO</span> <span class='lt op'>&lt;</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='BufferedIO constant id'>BufferedIO</span> <span class='comment val'># :nodoc:</span>
    <span class='BUFSIZE constant id'>BUFSIZE</span> <span class='assign token'>=</span> <span class='integer val'>1024</span> <span class='mult op'>*</span> <span class='integer val'>16</span>

    <span class='if if kw'>if</span> <span class='RUBY_VERSION constant id'>RUBY_VERSION</span> <span class='lt op'>&lt;</span> <span class='string val'>'1.9.1'</span>
      <span class='def def kw'>def</span> <span class='rbuf_fill identifier id'>rbuf_fill</span>
        <span class='begin begin kw'>begin</span>
          <span class='@rbuf ivar id'>@rbuf</span> <span class='lshft op'>&lt;&lt;</span> <span class='@io ivar id'>@io</span><span class='dot token'>.</span><span class='read_nonblock identifier id'>read_nonblock</span><span class='lparen token'>(</span><span class='BUFSIZE constant id'>BUFSIZE</span><span class='rparen token'>)</span>
        <span class='rescue rescue kw'>rescue</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EWOULDBLOCK constant id'>EWOULDBLOCK</span>
          <span class='retry retry kw'>retry</span> <span class='unless unless_mod kw'>unless</span> <span class='@read_timeout ivar id'>@read_timeout</span>
          <span class='if if kw'>if</span> <span class='IO constant id'>IO</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='@io ivar id'>@io</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='@read_timeout ivar id'>@read_timeout</span><span class='rparen token'>)</span>
            <span class='retry retry kw'>retry</span>
          <span class='else else kw'>else</span>
            <span class='raise identifier id'>raise</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='string val'>'IO timeout'</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='setsockopt identifier id'>setsockopt</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
      <span class='@io ivar id'>@io</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='gets identifier id'>gets</span>
      <span class='readuntil identifier id'>readuntil</span><span class='lparen token'>(</span><span class='string val'>&quot;\n&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>

<span class='module module kw'>module</span> <span class='Continuum constant id'>Continuum</span>
  <span class='POINTS_PER_SERVER constant id'>POINTS_PER_SERVER</span> <span class='assign token'>=</span> <span class='integer val'>160</span> <span class='comment val'># this is the default in libmemcached</span>

  <span class='comment val'># Find the closest index in Continuum with value &lt;= the given value</span>
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='binary_search identifier id'>binary_search</span><span class='lparen token'>(</span><span class='ary identifier id'>ary</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='upper identifier id'>upper</span> <span class='assign token'>=</span> <span class='ary identifier id'>ary</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
    <span class='lower identifier id'>lower</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='idx identifier id'>idx</span> <span class='assign token'>=</span> <span class='integer val'>0</span>

    <span class='while while kw'>while</span><span class='lparen token'>(</span><span class='lower identifier id'>lower</span> <span class='leq op'>&lt;=</span> <span class='upper identifier id'>upper</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='idx identifier id'>idx</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lower identifier id'>lower</span> <span class='plus op'>+</span> <span class='upper identifier id'>upper</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='integer val'>2</span>
      <span class='comp identifier id'>comp</span> <span class='assign token'>=</span> <span class='ary identifier id'>ary</span><span class='lbrack token'>[</span><span class='idx identifier id'>idx</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='value identifier id'>value</span> <span class='cmp op'>&lt;=&gt;</span> <span class='value identifier id'>value</span>

      <span class='if if kw'>if</span> <span class='comp identifier id'>comp</span> <span class='eq op'>==</span> <span class='integer val'>0</span>
        <span class='return return kw'>return</span> <span class='idx identifier id'>idx</span>
      <span class='elsif elsif kw'>elsif</span> <span class='comp identifier id'>comp</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
        <span class='upper identifier id'>upper</span> <span class='assign token'>=</span> <span class='idx identifier id'>idx</span> <span class='minus op'>-</span> <span class='integer val'>1</span>
      <span class='else else kw'>else</span>
        <span class='lower identifier id'>lower</span> <span class='assign token'>=</span> <span class='idx identifier id'>idx</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='return return kw'>return</span> <span class='upper identifier id'>upper</span>
  <span class='end end kw'>end</span>

  <span class='class class kw'>class</span> <span class='Entry constant id'>Entry</span>
    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:value</span>
    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:server</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='comma token'>,</span> <span class='srv identifier id'>srv</span><span class='rparen token'>)</span>
      <span class='@value ivar id'>@value</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span>
      <span class='@server ivar id'>@server</span> <span class='assign token'>=</span> <span class='srv identifier id'>srv</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='inspect identifier id'>inspect</span>
      <span class='dstring node'>&quot;&lt;#{value}, #{server.host}:#{server.port}&gt;&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
<span class='require identifier id'>require</span> <span class='string val'>'continuum_native'</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>with_server</h3>
</div><div id="with_server-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>with_server</span><span class='args'>(key)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 828</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L828">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">828
829
830
831
832
833
834
835
836
837
838
839
840
841
842</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='with_server identifier id'>with_server</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
  <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='begin begin kw'>begin</span>
    <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span> <span class='assign token'>=</span> <span class='request_setup identifier id'>request_setup</span><span class='lparen token'>(</span><span class='key identifier id'>key</span><span class='rparen token'>)</span>
    <span class='yield yield kw'>yield</span> <span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='cache_key identifier id'>cache_key</span>
  <span class='rescue rescue kw'>rescue</span> <span class='IndexError constant id'>IndexError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Server failed: #{e.class.name}: #{e.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='retried identifier id'>retried</span> <span class='andop op'>&amp;&amp;</span> <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Connection to server #{server.inspect} DIED! Retrying operation...&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
      <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
      <span class='retry retry kw'>retry</span>
    <span class='end end kw'>end</span>
    <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>with_socket_management</h3>
</div><div id="with_socket_management-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>with_socket_management</span><span class='args'>(server, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Gets or creates a socket connected to the given server, and yields it to
the block, wrapped in a mutex synchronization if @multithread is true.
</p>
<p>
If a socket error (SocketError, SystemCallError, IOError) or protocol error
(MemCacheError) is raised by the block, closes the socket, attempts to
connect again, and retries the block (once). If an error is again raised,
reraises it as MemCacheError.
</p>
<p>
If unable to connect to the server (or if in the reconnect wait period),
raises MemCacheError. Note that the socket connect code marks a server dead
for a timeout period, so retrying does not apply to connection attempt
failures (but does still apply to unexpectedly lost connections etc.).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/memcache.rb', line 797</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mperham/memcache-client/blob/3e73fec5e4748a97139ab06a2b97c6f66f16c1c7/lib/memcache.rb#L797">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='with_socket_management identifier id'>with_socket_management</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='check_multithread_status! fid id'>check_multithread_status!</span>

  <span class='@mutex ivar id'>@mutex</span><span class='dot token'>.</span><span class='lock identifier id'>lock</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>
  <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

  <span class='begin begin kw'>begin</span>
    <span class='socket identifier id'>socket</span> <span class='assign token'>=</span> <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='socket identifier id'>socket</span>

    <span class='comment val'># Raise an IndexError to show this server is out of whack. If were inside</span>
    <span class='comment val'># a with_server block, we'll catch it and attempt to restart the operation.</span>

    <span class='raise identifier id'>raise</span> <span class='IndexError constant id'>IndexError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;No connection to server (#{server.status})&quot;</span> <span class='if if_mod kw'>if</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='socket identifier id'>socket</span><span class='rparen token'>)</span>

  <span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='Errno constant id'>Errno</span><span class='colon2 op'>::</span><span class='EAGAIN constant id'>EAGAIN</span><span class='comma token'>,</span> <span class='Timeout constant id'>Timeout</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Socket failure: #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='server identifier id'>server</span><span class='dot token'>.</span><span class='mark_dead identifier id'>mark_dead</span><span class='lparen token'>(</span><span class='err identifier id'>err</span><span class='rparen token'>)</span>
    <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span>

  <span class='rescue rescue kw'>rescue</span> <span class='MemCacheError constant id'>MemCacheError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='err identifier id'>err</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;Generic failure: #{err.class.name}: #{err.message}&quot;</span> <span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='logger identifier id'>logger</span>
    <span class='handle_error identifier id'>handle_error</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='retried identifier id'>retried</span> <span class='orop op'>||</span> <span class='socket identifier id'>socket</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='retried identifier id'>retried</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='retry retry kw'>retry</span>
  <span class='end end kw'>end</span>
<span class='ensure ensure kw'>ensure</span>
  <span class='@mutex ivar id'>@mutex</span><span class='dot token'>.</span><span class='unlock identifier id'>unlock</span> <span class='if if_mod kw'>if</span> <span class='@multithread ivar id'>@multithread</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>