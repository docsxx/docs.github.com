<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <p>
h1. Marvin
</p>
<p>
Marvin is a ruby irc framework / library built on top of event machine.
It&#8217;s been build from scratch to be evented - you build
&quot;handlers&quot; which are called whenever an event occurs.
</p>
<p>
A single client instance can handle multiple IRC connections (and will
automatically reconnect in the case that a connection is lost). Distributed
support (e.g. 1 client =&gt; multiple handler backends) is built in out of
the box on top of DRb.
</p>
<p>
h2. Getting Started
</p>
<p>
Starting out with Marvin is simple. You can either go the &quot;edge&quot;
route - cloning from the GitHub repository (in this case,
[here](http://github.com/sutto/marvin)) and then running the following:
</p>
<pre class="code">
  $ <span class='rake identifier id'>rake</span> <span class='gemspec identifier id'>gemspec</span>
  $ <span class='gem identifier id'>gem</span> <span class='build identifier id'>build</span> <span class='marvin identifier id'>marvin</span><span class='dot token'>.</span><span class='gemspec identifier id'>gemspec</span>
  $ <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='marvin identifier id'>marvin</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span>
</pre>
<p>
Or, for a generally more stable release you can install it from the GitHub
gem server (requiring Rubygems &gt;= 1.2.0 with the GitHub sources added),
by running the following:
</p>
<pre class="code">
  $ <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='Sutto constant id'>Sutto</span><span class='minus op'>-</span><span class='marvin identifier id'>marvin</span>
</pre>
<p>
Installing the gem will make available a new executable -
&quot;<tt>marvin</tt>&quot; - which is used as an easy way to do a variety
of tasks. To get started, you can create a project located at given path
using the following command:
</p>
<pre class="code">
  $ <span class='marvin identifier id'>marvin</span> <span class='create identifier id'>create</span> <span class='path identifier id'>path</span><span class='minus op'>-</span><span class='to identifier id'>to</span><span class='minus op'>-</span><span class='my identifier id'>my</span><span class='minus op'>-</span><span class='bot identifier id'>bot</span>
</pre>
<p>
Once that&#8217;s done, you&#8217;ll have a blank slate loaded with the
default marvin handlers - <tt>HelloWorld</tt> (which will respond to any
addressed &quot;hello&quot;&#8217;s) and an empty debug handler which you
can use for generic debugging. To run the new app, you can use either of
the following:
</p>
<pre class="code">
  $ <span class='cd identifier id'>cd</span> <span class='path identifier id'>path</span><span class='minus op'>-</span><span class='to identifier id'>to</span><span class='minus op'>-</span><span class='my identifier id'>my</span><span class='minus op'>-</span><span class='bot identifier id'>bot</span> <span class='andop op'>&amp;&amp;</span> <span class='script identifier id'>script</span><span class='div op'>/</span><span class='client identifier id'>client</span>
</pre>
<p>
or, alternatively,
</p>
<pre class="code">
  $ <span class='marvin identifier id'>marvin</span> <span class='client identifier id'>client</span> <span class='path identifier id'>path</span><span class='minus op'>-</span><span class='to identifier id'>to</span><span class='minus op'>-</span><span class='my identifier id'>my</span><span class='minus op'>-</span><span class='bot identifier id'>bot</span>
</pre>
<p>
There are a couple of options available for the client (as well as the
marvin library), Each of which can be found by appending the
&quot;&#8212;help&quot; option to the command.
</p>
<p>
Once your client has been started (assuming the name wasn&#8217;t taken /
it could connect), simply join the chat room your bot was instructed to
join and say the following (substiting BotNick for the nick name your bot
connected with):
</p>
<pre class="code">
  <span class='BotNick constant id'>BotNick</span><span class='colon op'>:</span> <span class='hello identifier id'>hello</span>
</pre>
<p>
Or even easier, by PM&#8217;ing the bot with:
</p>
<pre class="code">
  <span class='hello identifier id'>hello</span>
</pre>
<p>
Assuming all went well, your bot should reply back with something akin to
(where YourNick) if the nickname you connected with):
</p>
<pre class="code">
  <span class='YourNick constant id'>YourNick</span><span class='colon op'>:</span> <span class='Hola constant id'>Hola</span> <span class='from identifier id'>from</span> <span class='process identifier id'>process</span> <span class='with identifier id'>with</span> <span class='pid identifier id'>pid</span> <span class='integer val'>12342</span>
</pre>
<p>
h2. Distributed Bots
</p>
<p>
One of the relatively unique features of Marvin is the ability to write
bots which use DRb and Rinda which can grow with relative ease.
</p>
<p>
It&#8217;s important to keep in mind that keeping state is discouraged in
this case as it can not be ensured that clients are still active or that
you will always get messages from the same client.
</p>
<p>
For a start, take a look at the default +config/setup.rb+ file which
contains an example of registering handlers on a distributed client as well
as setting up the distributed handler which needs to be setup on the main
client.
</p>
<p>
By default, the messages will be dispatched to the first discovered tuple
space (using Rinda::RingFinger) and will be of the format:
</p>
<pre class="code">
  <span class='lbrack token'>[</span><span class='symbol val'>:marvin_format</span><span class='comma token'>,</span> <span class='symbol val'>:your_namespace</span><span class='comma token'>,</span> <span class='symbol val'>:message_name</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;options&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='client_reference identifier id'>client_reference</span><span class='rbrack token'>]</span>
</pre>
<p>
You can change the namespace (which defaults to +:default+) by setting
+Marvin::Settings.distributed_namespace+
</p>
<p>
Running a distributed client requires three things:
</p>
<ul>
<li>1 Ring server instance (+script/ring_server+ or +marvin ring_server+ or
+marvin rs+)

</li>
<li>1+ Client instances (+script/client+ or +marvin client+ or +marvin cl+)

</li>
<li>1+ Distributed Client instances (+script/distributed_client+ or +marvin
distributed_client+ or +marvin dc+)

</li>
</ul>
<p>
Each of which takes the default options of:
</p>
<ul>
<li>-v - Be verbose and print to STDOUT if not daemonized

</li>
<li>-level=something - set level, defaults to info

</li>
<li>-d - daemonize the process

</li>
<li>-k - kill all daemonized instances of this specific kind

</li>
</ul>
<p>
h2. Example Bots
</p>
<p>
Coming soon.
</p>
<p>
h2. Thanks
</p>
<p>
Thanks go to:
</p>
<ul>
<li>Jeff Rafter - contributed code and doc changes, now one of the
co-developers.

</li>
<li>epitron / halogrium - For the ragel state machine used in
Marvin::Parsers::RagelParser

</li>
<li>The creator of Ruby-IRCD - the server component is heavily influenced by /
part derivative of said work.

</li>
</ul>

      </div>
    </div>
  </body>
</html>