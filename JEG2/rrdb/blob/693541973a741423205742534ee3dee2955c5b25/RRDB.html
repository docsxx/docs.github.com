<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>JEG2's rrdb - Class: RRDB - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/JEG2/commits/rrdb/master" rel="alternate" title="Recent Commits to rrdb:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("JEG2", "rrdb", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("JEG2", "rrdb", "693541973a741423205742534ee3dee2955c5b25", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/JEG2/rrdb/tree/">Source</a></li>
            <li class=""><a href="http://github.com/JEG2/rrdb/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/JEG2/rrdb/network">Network</a></li>            
            <li class=""><a href="http://github.com/JEG2/rrdb/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/JEG2/rrdb">Wiki</a></li>
            <li class=""><a href="http://github.com/JEG2/rrdb/graphs">Graphs</a></li>                    
            <li class="active"><a href="/JEG2/rrdb">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/JEG2">JEG2</a> / <b><a href="http://github.com/JEG2/rrdb/tree">rrdb</a></b>        
                <a id="namespaces_button" rel="JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class RRDB">
  <h1>Class: RRDB</h1>
  <div class="section docstring">
  <p>
This class wraps an .rrd file on the disk by shelling out to rrdtool to
perform read and write actions on the database. The primary features of
this simple wrapper are:
</p>
<ul>
<li>Each instance manages a separate database keyed on unique ID&#8217;s you
provide

</li>
<li>Database creation is delayed until the first update so fields will be known

</li>
<li>Extra fields can be reserved in the database and the wrapper will
automatically claim them as needed when new fields appear in future updates

</li>
<li>Field names are safely mapped to names acceptable to rrdtool whenever
possible and a method is provided to help you map them back to your
preferred names

</li>
<li>Fetch operations return data in time slots, by field name

</li>
</ul>
<p>
This class is not multiprocessing safe for write operations.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">id</td>
          <td class="readwrite">
            [<span id='id-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The unique <tt>id</tt> for this database instance.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="VERSION-constant">VERSION</dt>
      <dd>&quot;0.0.2&quot;</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(id)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This constructor build a new instance to wrap a round robin database with
the provided unique <tt>id</tt>. This <tt>id</tt> will be part of the file
name used to store this database. If a database with the <tt>id</tt>
already exists, it will be used for all interactions with the object.
Otherwise, a new database will be created on the first call to update().
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 150</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L150">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">150
151
152</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='id identifier id'>id</span><span class='rparen token'>)</span>
  <span class='@id ivar id'>@id</span> <span class='assign token'>=</span> <span class='id identifier id'>id</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#config-class_method">config</span><span class='args'>(hash_or_key = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
:call-seq:
</p>
<pre class="code">
  <span class='config identifier id'>config</span>         <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='config_hash identifier id'>config_hash</span>
  <span class='config identifier id'>config</span><span class='lparen token'>(</span> <span class='hash identifier id'>hash</span> <span class='rparen token'>)</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='updated_config_hash identifier id'>updated_config_hash</span>
  <span class='config identifier id'>config</span><span class='lparen token'>(</span> <span class='key identifier id'>key</span>  <span class='rparen token'>)</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='config_value identifier id'>config_value</span><span class='dot token'>.</span>
</pre>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#const_missing-class_method">const_missing</span><span class='args'>(error_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method generates Exception subclasses, as needed.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#field_name-class_method">field_name</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given a field name used in a call to update(), this method will return the
name used inside the .
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#last_error-class_method">last_error</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the contents of the combined STDOUT and STDERR stream after a call
to run_command() where the command reported a non-success exit status.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run_command-class_method">run_command</span><span class='args'>(command)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This helper is used to shell out to external command, like rrdtool.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch-instance_method">#fetch</span><span class='args'>(field, range = Hash.new)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is the primary interface for reading data out of the database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fields-instance_method">#fields</span><span class='args'>(include_types = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns an Array of field names used in the database, if
<tt>include_types</tt> is <tt>false</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#path-instance_method">#path</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The path to the disk file representation of this database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#step-instance_method">#step</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the step used in this database, or the default 300 for an uncreated
database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#update-instance_method">#update</span><span class='args'>(time, data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is the interface for adding data to the database.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>config</h3>
</div><div id="config-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>config</span><span class='args'>(hash_or_key = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
:call-seq:
</p>
<pre class="code">
  <span class='config identifier id'>config</span>         <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='config_hash identifier id'>config_hash</span>
  <span class='config identifier id'>config</span><span class='lparen token'>(</span> <span class='hash identifier id'>hash</span> <span class='rparen token'>)</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='updated_config_hash identifier id'>updated_config_hash</span>
  <span class='config identifier id'>config</span><span class='lparen token'>(</span> <span class='key identifier id'>key</span>  <span class='rparen token'>)</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='config_value identifier id'>config_value</span>
</pre>
<p>
This method allows you to read and write configuration settings for this
class. Just pass in a Hash of new settings to have them merged into the
existing configuration. Recognized settings are:
</p>
<table>
<tr><td valign="top"><tt>:rrdtool_path</tt>:</td><td>The path to the rrdtool executable. This library will attempt to find it on
load, but you may need to help it along under some circumstances.

</td></tr>
<tr><td valign="top"><tt>:database_directory</tt>:</td><td>The directory .rrd files will be stored in. This defaults to the working
directory.

</td></tr>
<tr><td valign="top"><tt>:reserve_fields</tt>:</td><td>The total number of fields the database is expected to have. A number of
fields will be reserved in all databases created equal to this count minus
the count of fields in the first update for that database. These fields
will be claimed as needed by future updates. Defaults to <tt>10</tt>.

</td></tr>
<tr><td valign="top"><tt>:data_sources</tt>:</td><td>If set to a String, this value will be used as the Data Source Type for all
fields created. Alternately, you may set this to any object with a
<tt>[]</tt> method that looks up the field and returns a DST String (Hash
and Proc are good examples). This defaults to
<tt>&quot;GAUGE:600:U:U&quot;</tt>.

</td></tr>
<tr><td valign="top"><tt>:round_robin_archives</tt>:</td><td>An Array of RRA statements added to all databases generated by this
library. (You don&#8217;t need to include the &quot;RRA:&quot; prefix.)
This field defaults to an empty Array and thus must be set or overriden by
your code.

</td></tr>
<tr><td valign="top"><tt>:database_step</tt>:</td><td>The optional step parameter passed to all databases created.

</td></tr>
<tr><td valign="top"><tt>:database_start</tt>:</td><td>If set, this will override the start time for all databases created.

</td></tr>
</table>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 114</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L114">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">114
115
116
117
118
119
120
121
122
123</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lparen token'>(</span><span class='hash_or_key identifier id'>hash_or_key</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='hash_or_key identifier id'>hash_or_key</span>
  <span class='when when kw'>when</span> <span class='nil nil kw'>nil</span>
    <span class='@config ivar id'>@config</span> <span class='opasgn op'>||=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='when when kw'>when</span> <span class='Hash constant id'>Hash</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='hash_or_key identifier id'>hash_or_key</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='hash_or_key identifier id'>hash_or_key</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>const_missing</h3>
</div><div id="const_missing-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>const_missing</span><span class='args'>(error_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method generates Exception subclasses, as needed. When the code
references any constant ending in Error, a subclass of RuntimeError is
built and assigned to that name. See the documentation for each method for
a list of the errors it can raise.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 36</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L36">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">36
37
38
39
40
41
42</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='const_missing identifier id'>const_missing</span><span class='lparen token'>(</span><span class='error_name identifier id'>error_name</span><span class='rparen token'>)</span>  <span class='comment val'># :nodoc:</span>
  <span class='if if kw'>if</span> <span class='error_name identifier id'>error_name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/Error\z/</span>
    <span class='const_set identifier id'>const_set</span><span class='lparen token'>(</span><span class='error_name identifier id'>error_name</span><span class='comma token'>,</span> <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='RuntimeError constant id'>RuntimeError</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='super super kw'>super</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>field_name</h3>
</div><div id="field_name-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>field_name</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given a field name used in a call to update(), this method will return the
name used inside the .rrd file. This is helpful for mapping field back to
the values your application prefers.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 138</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L138">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">138
139
140
141</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='field_name identifier id'>field_name</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='tr identifier id'>tr</span><span class='lparen token'>(</span> <span class='string val'>&quot;-~!@\#$%^&amp;*+=|&lt;&gt;./?&quot;</span><span class='comma token'>,</span>
                <span class='string val'>&quot;mtbahdpcnmveplgddq&quot;</span> <span class='rparen token'>)</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='string val'>&quot;^a-zA-Z0-9_&quot;</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>18</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>last_error</h3>
</div><div id="last_error-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>last_error</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the contents of the combined STDOUT and STDERR stream after a call
to run_command() where the command reported a non-success exit status. This
method will always return <tt>nil</tt> after a successful call to
run_command().
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 69</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L69">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">69
70
71</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='last_error identifier id'>last_error</span>
  <span class='@last_error ivar id'>@last_error</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run_command</h3>
</div><div id="run_command-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run_command</span><span class='args'>(command)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This helper is used to shell out to external command, like rrdtool. It runs
the command with STDOUT and STDERR merged into a single stream. If the
command exits successfully, the output from this combined stream is
returned. Otherwise, <tt>nil</tt> is returned and you can call last_error()
to retrieve the contents of the stream.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 51</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L51">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">51
52
53
54
55
56
57
58
59
60
61
62</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='run_command identifier id'>run_command</span><span class='lparen token'>(</span><span class='command identifier id'>command</span><span class='rparen token'>)</span>
  <span class='output identifier id'>output</span> <span class='assign token'>=</span> <span class='dxstring node'>`#{command} 2&gt;&amp;1`</span>
  <span class='if if kw'>if</span> <span class='$? gvar id'>$?</span><span class='dot token'>.</span><span class='success? fid id'>success?</span>
    <span class='@last_error ivar id'>@last_error</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='output identifier id'>output</span>
  <span class='else else kw'>else</span>
    <span class='@last_error ivar id'>@last_error</span> <span class='assign token'>=</span> <span class='output identifier id'>output</span>
    <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span>
  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch</h3>
</div><div id="fetch-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch</span><span class='args'>(field, range = Hash.new)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is the primary interface for reading data out of the database.
Pass into <tt>field</tt> the name of the consolidation function you wish to
pull data from. You may also pass standard RRDtool fetch options in the
<tt>range</tt> Hash (<tt>:start</tt>, <tt>:end</tt>, and
<tt>:resolution</tt>). The return value is a Hash, keyed by times, where
the value for each time is a nested Hash of fields and their values at that
time.
</p>
<p>
This method can raise a FetchError if data cannot be read for any reason.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 259</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L259">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='range identifier id'>range</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span>
  <span class='params identifier id'>params</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;'#{field}' &quot;</span>
  <span class='dstring node'>%w[start end resolution]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='option identifier id'>option</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='param identifier id'>param</span> <span class='assign token'>=</span> <span class='range identifier id'>range</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='range identifier id'>range</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span>
      <span class='params identifier id'>params</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; --#{option} '#{param.to_i}'&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='data identifier id'>data</span>    <span class='assign token'>=</span> <span class='rrdtool identifier id'>rrdtool</span><span class='lparen token'>(</span><span class='symbol val'>:fetch</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='fields identifier id'>fields</span>  <span class='assign token'>=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='split identifier id'>split</span>
  <span class='results identifier id'>results</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='dregexp node'>/^\s*(\d+):((?:\s+\S+){#{fields.size}})/</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='time identifier id'>time</span><span class='comma token'>,</span> <span class='values identifier id'>values</span><span class='bitor op'>|</span>
    <span class='floats identifier id'>floats</span> <span class='assign token'>=</span> <span class='values identifier id'>values</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='f identifier id'>f</span> <span class='match op'>=~</span> <span class='regexp val'>/\A\d/</span> <span class='question op'>?</span> <span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='integer val'>0</span> <span class='rbrace token'>}</span>
    <span class='results identifier id'>results</span><span class='lbrack token'>[</span><span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='at identifier id'>at</span><span class='lparen token'>(</span><span class='time identifier id'>time</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='lbrack token'>[</span><span class='mult op'>*</span><span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='zip identifier id'>zip</span><span class='lparen token'>(</span><span class='floats identifier id'>floats</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='results identifier id'>results</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fields</h3>
</div><div id="fields-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fields</span><span class='args'>(include_types = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns an Array of field names used in the database, if
<tt>include_types</tt> is <tt>false</tt>. When <tt>true</tt>, a Hash is
returned mapping field names to their DST. An empty Array or Hash is
returned for uncreated databases.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 171</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L171">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fields identifier id'>fields</span><span class='lparen token'>(</span><span class='include_types identifier id'>include_types</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='schema identifier id'>schema</span> <span class='assign token'>=</span> <span class='rrdtool identifier id'>rrdtool</span><span class='lparen token'>(</span><span class='symbol val'>:info</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='fields identifier id'>fields</span> <span class='assign token'>=</span> <span class='schema identifier id'>schema</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/^ds\[([^\]]+)\]/</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span>
  <span class='if if kw'>if</span> <span class='include_types identifier id'>include_types</span>
    <span class='Hash constant id'>Hash</span><span class='lbrack token'>[</span> <span class='mult op'>*</span><span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
      <span class='lbrack token'>[</span> <span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{schema[/^ds\[#{f}\]\.type\s*=\s*&quot;([^&quot;]+)&quot;/, 1]}:&quot;</span>            <span class='plus op'>+</span>
           <span class='dstring node'>&quot;#{schema[/^ds\[#{f}\]\.minimal_heartbeat\s*=\s*(\d+)/, 1]}:&quot;</span>   <span class='plus op'>+</span> 
           <span class='dstring node'>&quot;#{schema[/^ds\[#{f}\]\.min\s*=\s*(\S+)/, 1].sub('NaN', 'U')}:&quot;</span> <span class='plus op'>+</span>
           <span class='dstring node'>&quot;#{schema[/^ds\[#{f}\]\.max\s*=\s*(\S+)/, 1].sub('NaN', 'U')}&quot;</span> <span class='rbrack token'>]</span>
    <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span> <span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='fields identifier id'>fields</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='InfoError constant id'>InfoError</span>
  <span class='include_types identifier id'>include_types</span> <span class='integer val'>? </span><span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='colon op'>:</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>path</h3>
</div><div id="path-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>path</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The path to the disk file representation of this database. Be warned that
this may not exist yet for a new <tt>id</tt> where update() has not yet
been called.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 162</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L162">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">162
163
164</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='path identifier id'>path</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:database_directory</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{id}.rrd&quot;</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>step</h3>
</div><div id="step-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>step</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the step used in this database, or the default 300 for an uncreated
database.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 192</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L192">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">192
193
194
195
196</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='step identifier id'>step</span>
  <span class='lparen token'>(</span><span class='rrdtool identifier id'>rrdtool</span><span class='lparen token'>(</span><span class='symbol val'>:info</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='lbrack token'>[</span><span class='regexp val'>/^step\s+=\s+(\d+)/</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>300</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
<span class='rescue rescue kw'>rescue</span> <span class='InfoError constant id'>InfoError</span>
  <span class='integer val'>300</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>update</h3>
</div><div id="update-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>update</span><span class='args'>(time, data)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is the interface for adding data to the database. You pass a
<tt>time</tt> the data should be recorded under and a <tt>data</tt> Hash of
fields you wish to store in the database.
</p>
<p>
The first time this method is called for a new database, the database will
be generated to contain the needed fields (plus any extras reserved by the
configuration). Future calls will claim reserved fields if needed, to
support new field names. Either way, both types of calls end with the data
being pushed into the database.
</p>
<p>
This method can raise the following errors:
</p>
<table>
<tr><td valign="top"><tt>FieldNameConflictError</tt>:</td><td>This error signals that your field names cannot be cleanly converted into
names RRDtool will accept. It&#8217;s possible that cleaning them resulted
in an unacceptable size or that cleaning them led to duplicate names.

</td></tr>
<tr><td valign="top"><tt>FieldsExhaustedError</tt>:</td><td>An attempt to claim new fields was made, but there are not enough reserved
fields in the database to satisfy the request.

</td></tr>
<tr><td valign="top"><tt>CreateError</tt>:</td><td>A database could not be created, likely due to a malformed schema taken
from the configuration settings.

</td></tr>
<tr><td valign="top"><tt>TuneError</tt>:</td><td>A database could not be modified, again probably because of a malformed
schema.

</td></tr>
<tr><td valign="top"><tt>UpdateError</tt>:</td><td>The attempt to add data to the database failed for whatever reason (a time
before the previous update, for example).

</td></tr>
</table>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rrdb.rb', line 229</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/JEG2/rrdb/blob/693541973a741423205742534ee3dee2955c5b25/lib/rrdb.rb#L229">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='time identifier id'>time</span><span class='comma token'>,</span> <span class='data identifier id'>data</span><span class='rparen token'>)</span>
  <span class='safe_data identifier id'>safe_data</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='lbrack token'>[</span><span class='mult op'>*</span><span class='data identifier id'>data</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='field_name identifier id'>field_name</span><span class='lparen token'>(</span><span class='f identifier id'>f</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='safe_data identifier id'>safe_data</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='neq op'>!=</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='or or kw'>or</span>
     <span class='safe_data identifier id'>safe_data</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='not not kw'>not</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='dot token'>.</span><span class='between? fid id'>between?</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='integer val'>19</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='raise identifier id'>raise</span> <span class='FieldNameConflictError constant id'>FieldNameConflictError</span><span class='comma token'>,</span>
          <span class='string val'>&quot;Your field names cannot be unambiguously converted to RRDtool &quot;</span> <span class='plus op'>+</span>
          <span class='string val'>&quot;field names (1 to 19 [a-zA-Z0-9_] characters).&quot;</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span> <span class='path identifier id'>path</span>
    <span class='claim_new_fields identifier id'>claim_new_fields</span><span class='lparen token'>(</span><span class='safe_data identifier id'>safe_data</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='create_database identifier id'>create_database</span><span class='lparen token'>(</span><span class='time identifier id'>time</span><span class='comma token'>,</span> <span class='safe_data identifier id'>safe_data</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='params identifier id'>params</span> <span class='assign token'>=</span> <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
    <span class='digits identifier id'>digits</span> <span class='assign token'>=</span> <span class='safe_data identifier id'>safe_data</span><span class='lbrack token'>[</span><span class='f identifier id'>f</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='string val'>&quot;^0-9.&quot;</span><span class='rparen token'>)</span>
    <span class='digits identifier id'>digits</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='digits identifier id'>digits</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;.&quot;</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='symbol val'>:to_f</span> <span class='colon op'>:</span> <span class='symbol val'>:to_i</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='rrdtool identifier id'>rrdtool</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='comma token'>,</span> <span class='dstring node'>&quot;'#{time.to_i}:#{params.join(':')}'&quot;</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>