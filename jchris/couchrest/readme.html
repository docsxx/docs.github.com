<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <p>
# CouchRest: CouchDB, close to the metal
</p>
<p>
CouchRest is based on [CouchDB&#8217;s couch.js test
library](http://svn.apache.org/repos/asf/incubator/couchdb/trunk/share/www/script/couch.js),
which I find to be concise, clear, and well designed. CouchRest lightly
wraps CouchDB&#8217;s HTTP API, managing JSON serialization, and
remembering the URI-paths to CouchDB&#8217;s API endpoints so you
don&#8217;t have to.
</p>
<p>
CouchRest is designed to make a simple base for application and
framework-specific object oriented APIs. CouchRest is Object-Mapper
agnostic, the parsed JSON it returns from CouchDB shows up as subclasses of
Ruby&#8217;s Hash. Naked JSON, just as it was mean to be.
</p>
<p>
## Easy Install
</p>
<p>
Easy Install is moving to RubyForge, heads up for the gem.
</p>
<p>
### Relax, it&#8217;s RESTful
</p>
<p>
The core of Couchrest is Heroku’s excellent REST Client Ruby HTTP
wrapper. REST Client takes all the nastyness of Net::HTTP and gives is a
pretty face, while still giving you more control than Open-URI. I recommend
it anytime you’re interfacing with a well-defined web service.
</p>
<p>
### Running the Specs
</p>
<p>
The most complete documentation is the spec/ directory. To validate your
CouchRest install, from the project root directory run `rake`, or
`autotest` (requires RSpec and optionally ZenTest for autotest support).
</p>
<p>
## Examples
</p>
<p>
Quick Start:
</p>
<pre class="code">
    <span class='comment val'># with !, it creates the database if it doesn't already exist</span>
    <span class='@db ivar id'>@db</span> <span class='assign token'>=</span> <span class='CouchRest constant id'>CouchRest</span><span class='dot token'>.</span><span class='database! fid id'>database!</span><span class='lparen token'>(</span><span class='string val'>&quot;http://127.0.0.1:5984/couchrest-test&quot;</span><span class='rparen token'>)</span>
    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='save_doc identifier id'>save_doc</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='symbol val'>:key</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'value'</span><span class='comma token'>,</span> <span class='string val'>'another key'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'another value'</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='get identifier id'>get</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='string val'>'id'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='puts identifier id'>puts</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span>
</pre>
<p>
Bulk Save:
</p>
<pre class="code">
    <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='bulk_save identifier id'>bulk_save</span><span class='lparen token'>(</span><span class='lbrack token'>[</span>
        <span class='lbrace token'>{</span><span class='string val'>&quot;wild&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;and random&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='lbrace token'>{</span><span class='string val'>&quot;mild&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;yet local&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
        <span class='lbrace token'>{</span><span class='string val'>&quot;another&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;set&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;of&quot;</span><span class='comma token'>,</span><span class='string val'>&quot;keys&quot;</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
      <span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='comment val'># returns ids and revs of the current docs</span>
    <span class='puts identifier id'>puts</span> <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='documents identifier id'>documents</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span>
</pre>
<p>
Creating and Querying Views:
</p>
<pre class="code">
    <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='save_doc identifier id'>save_doc</span><span class='lparen token'>(</span><span class='lbrace token'>{</span>
      <span class='string val'>&quot;_id&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;_design/first&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:views</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span>
        <span class='symbol val'>:test</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span>
          <span class='symbol val'>:map</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;function(doc){for(var w in doc){ if(!w.match(/^_/))emit(w,doc[w])}}&quot;</span>
          <span class='rbrace token'>}</span>
        <span class='rbrace token'>}</span>
      <span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='puts identifier id'>puts</span> <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='view identifier id'>view</span><span class='lparen token'>(</span><span class='string val'>'first/test'</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='string val'>'rows'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span>
</pre>
<p>
## CouchRest::Model
</p>
<p>
CouchRest::Model has been deprecated and replaced by
CouchRest::ExtendedDocument
</p>
<p>
## CouchRest::ExtendedDocument
</p>
<p>
### Callbacks
</p>
<p>
`CouchRest::ExtendedDocuments` instances have 2 callbacks already defined
for you:
</p>
<pre class="code">
    <span class='xstring val'>`create_callback`</span><span class='comma token'>,</span> <span class='xstring val'>`save_callback`</span><span class='comma token'>,</span> <span class='xstring val'>`update_callback`</span> <span class='and and kw'>and</span> <span class='xstring val'>`destroy_callback`</span>
</pre>
<p>
In your document inherits from `CouchRest::ExtendedDocument`, define your
callback as follows:
</p>
<pre class="code">
    <span class='save_callback identifier id'>save_callback</span> <span class='symbol val'>:before</span><span class='comma token'>,</span> <span class='symbol val'>:generate_slug_from_name</span>
</pre>
<p>
CouchRest uses a mixin you can find in lib/mixins/callbacks which is
extracted from Rails 3, here are some simple usage examples:
</p>
<pre class="code">
    <span class='save_callback identifier id'>save_callback</span> <span class='symbol val'>:before</span><span class='comma token'>,</span> <span class='symbol val'>:before_method</span>
    <span class='save_callback identifier id'>save_callback</span> <span class='symbol val'>:after</span><span class='comma token'>,</span>  <span class='symbol val'>:after_method</span><span class='comma token'>,</span> <span class='symbol val'>:if</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:condition</span>
    <span class='save_callback identifier id'>save_callback</span> <span class='symbol val'>:around</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span> <span class='stuff identifier id'>stuff</span><span class='semicolon token'>;</span> <span class='yield yield kw'>yield</span><span class='semicolon token'>;</span> <span class='stuff identifier id'>stuff</span> <span class='rbrace token'>}</span>
</pre>
<p>
Check the mixin or the ExtendedDocument class to see how to implement your
own callbacks.
</p>
<p>
### Casting
</p>
<p>
Often, you will want to store multiple objects within a document, to be
able to retrieve your objects when you load the document, you can define
some casting rules.
</p>
<pre class="code">
    <span class='property identifier id'>property</span> <span class='symbol val'>:casted_attribute</span><span class='comma token'>,</span> <span class='symbol val'>:cast_as</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'WithCastedModelMixin'</span>
    <span class='property identifier id'>property</span> <span class='symbol val'>:keywords</span><span class='comma token'>,</span>         <span class='symbol val'>:cast_as</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;String&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
If you want to cast an array of instances from a specific Class, use the
trick shown above [&quot;ClassName&quot;]
</p>

      </div>
    </div>
  </body>
</html>