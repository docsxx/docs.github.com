<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>pauldix's feedzirra - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/pauldix/commits/feedzirra/master" rel="alternate" title="Recent Commits to feedzirra:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("pauldix", "feedzirra", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='pauldix/feedzirra/blob/7e44171efe7bc7c89361e3245d1ff8ad534e18a5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='pauldix/feedzirra/blob/7e44171efe7bc7c89361e3245d1ff8ad534e18a5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("pauldix", "feedzirra", "7e44171efe7bc7c89361e3245d1ff8ad534e18a5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/pauldix/feedzirra/tree/">Source</a></li>
            <li class=""><a href="http://github.com/pauldix/feedzirra/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/pauldix/feedzirra/network">Network</a></li>            
            <li class=""><a href="http://github.com/pauldix/feedzirra/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/pauldix/feedzirra">Wiki</a></li>
            <li class=""><a href="http://github.com/pauldix/feedzirra/graphs">Graphs</a></li>                    
            <li class="active"><a href="/pauldix/feedzirra">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/pauldix">pauldix</a> / <b><a href="http://github.com/pauldix/feedzirra/tree">feedzirra</a></b>        
                <a id="namespaces_button" rel="pauldix/feedzirra/blob/7e44171efe7bc7c89361e3245d1ff8ad534e18a5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="pauldix/feedzirra/blob/7e44171efe7bc7c89361e3245d1ff8ad534e18a5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Feedzirra</h1>
<p><a href="http://github.com/pauldix/feedzirra/tree/master">http://github.com/pauldix/feedzirra/tree/master</a></p>
<p>I&#8217;d like feedback on the api and any bugs encountered on feeds in the wild. I&#8217;ve set up a <a href="http://groups.google.com/group/feedzirra">google group here</a>.</p>
<h2>Summary</h2>
<p>A feed fetching and parsing library that treats the internet like Godzilla treats Japan: it dominates and eats all.</p>
<h2>Description</h2>
<p>Feedzirra is a feed library that is designed to get and update many feeds as quickly as possible. This includes using libcurl-multi through the <a href="http://github.com/taf2/curb/tree/master">taf2-curb</a> gem for faster http gets, and libxml through <a href="http://github.com/tenderlove/nokogiri/tree/master">nokogiri</a> and <a href="http://github.com/pauldix/sax-machine/tree/master">sax-machine</a> for faster parsing.</p>
<p>Once you have fetched feeds using Feedzirra, they can be updated using the feed objects. Feedzirra automatically inserts etag and last-modified information from the http response headers to lower bandwidth usage, eliminate unnecessary parsing, and make things speedier in general.</p>
<p>Another feature present in Feedzirra is the ability to create callback functions that get called &#8220;on success&#8221; and &#8220;on failure&#8221; when getting a feed. This makes it easy to do things like log errors or update data stores.</p>
<p>The fetching and parsing logic have been decoupled so that either of them can be used in isolation if you&#8217;d prefer not to use everything that Feedzirra offers. However, the code examples below use helper methods in the Feed class that put everything together to make things as simple as possible.</p>
<p>The final feature of Feedzirra is the ability to define custom parsing classes. In truth, Feedzirra could be used to parse much more than feeds. Microformats, page scraping, and almost anything else are fair game.</p>
<h2>Installation</h2>
<p>For now Feedzirra exists only on github. It also has a few gem requirements that are only on github. Before you start you need to have <a href="http://curl.haxx.se/">libcurl</a> and <a href="http://xmlsoft.org/">libxml</a> installed. If you&#8217;re on Leopard you have both. Otherwise, you&#8217;ll need to grab them. Once you&#8217;ve got those libraries, these are the gems that get used: nokogiri, pauldix-sax-machine, taf2-curb (note that this is a fork that lives on github and not the Ruby Forge version of curb), and pauldix-feedzirra. The feedzirra gemspec has all the dependencies so you should be able to get up and running with the standard github gem install routine:</p>
<pre class="code">
<span class='gem identifier id'>gem</span> <span class='sources identifier id'>sources</span> <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com # if you haven't already
gem install pauldix-feedzirra
</span></pre>
<p><b><span class="caps">NOTE</span>:</b>Some people have been reporting a few issues related to installation. First, the Ruby Forge version of curb is not what you want. It will not work. Nor will the curl-multi gem that lives on Ruby Forge. You have to get the <a href="http://github.com/taf2/curb/tree/master">taf2-curb</a> fork installed.</p>
<p>If you see this error when doing a require: <br />
<pre class="code"><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
/</span><span class='Library constant id'>Library</span><span class='div op'>/</span><span class='Ruby constant id'>Ruby</span><span class='div op'>/</span><span class='Site constant id'>Site</span><span class='div op'>/</span><span class='float val'>1.8</span><span class='div op'>/</span><span class='rubygems identifier id'>rubygems</span><span class='div op'>/</span><span class='custom_require identifier id'>custom_require</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span><span class='symbol val'>:31</span><span class='symbol val'>:in</span> <span class='xstring val'>`gem_original_require&amp;#8217;: no such file to load &amp;#8212; curb_core (LoadError)&lt;br /&gt;
</span></pre><br />
It means that the taf2-curb gem didn&#8217;t build correctly. To resolve this you can do a git clone git://github.com/taf2/curb.git then run rake gem in the curb directory, then sudo gem install pkg/curb-0.2.4.0.gem. After that you should be good.</p>
<p>If you see something like this when trying to run it:<br />
<pre class="code"><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
NoMethodError: undefined method `on_success&amp;#8217; for #&lt;Curl::Easy:0x1182724&gt;&lt;br /</span><span class='gt op'>&gt;</span>
  <span class='from identifier id'>from</span> <span class='dot token'>.</span><span class='div op'>/</span><span class='lib identifier id'>lib</span><span class='div op'>/</span><span class='feedzirra identifier id'>feedzirra</span><span class='div op'>/</span><span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span><span class='symbol val'>:88</span><span class='symbol val'>:in</span> <span class='xstring val'>`add_url_to_multi&amp;#8217;&lt;br /&gt;
</span></pre><br />
This means that you are requiring curl-multi or the Ruby Forge version of Curb somewhere. You can&#8217;t use those and need to get the taf2 version up and running.</p>
<p>If you&#8217;re on Debian or Ubuntu and getting errors while trying to install the taf2-curb gem, it could be because you don&#8217;t have the latest version of libcurl installed. Do this to fix:<br />
<pre class="code"><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
sudo apt-get install libcurl4-gnutls-dev&lt;br /</span><span class='gt op'>&gt;</span>
</pre></p>
<p>Another problem could be if you are running Mac Ports and you have libcurl installed through there. You need to uninstall it for curb to work! The version in Mac Ports is old and doesn&#8217;t play nice with curb. If you&#8217;re running Leopard, you can just uninstall and you should be golden. If you&#8217;re on an older version of OS X, you&#8217;ll then need to <a href="http://curl.haxx.se/download.html">download curl</a> and build from source. Then you&#8217;ll have to install the taf2-curb gem again. You might have to perform the step above.</p>
<p>If you&#8217;re still having issues, please let me know on the mailing list. Also, <a href="http://github.com/taf2" title="taf2">Todd Fisher</a> is working on fixing the gem install. Please send him a full error report.</p>
<h2>Usage</h2>
<p><a href="http://gist.github.com/57285">A gist of the following code</a><br />
<pre class="code"><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
require &amp;#8216;feedzirra&amp;#8217;&lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='ol identifier id'>ol</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='fetching identifier id'>fetching</span> <span class='a identifier id'>a</span> <span class='single identifier id'>single</span> <span class='feed identifier id'>feed</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
feed = Feedzirra::Feed.fetch_and_parse(&amp;#8220;http:/</span><span class='div op'>/</span><span class='feeds identifier id'>feeds</span><span class='dot token'>.</span><span class='feedburner identifier id'>feedburner</span><span class='dot token'>.</span><span class='com identifier id'>com</span><span class='div op'>/</span><span class='PaulDixExplainsNothing constant id'>PaulDixExplainsNothing</span><span class='bitand op'>&amp;</span><span class='comment val'>#8221;)&lt;/li&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;feed and entries accessors&lt;br /</span><span class='gt op'>&gt;</span>
<span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='title identifier id'>title</span>          <span class='comment val'># =&gt; &amp;#8220;Paul Dix Explains Nothing&amp;#8221;&lt;br /&gt;</span>
<span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='url identifier id'>url</span>            <span class='comment val'># =&gt; &amp;#8220;http://www.pauldix.net&amp;#8221;&lt;br /&gt;</span>
<span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='feed_url identifier id'>feed_url</span>       <span class='comment val'># =&gt; &amp;#8220;http://feeds.feedburner.com/PaulDixExplainsNothing&amp;#8221;&lt;br /&gt;</span>
<span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='etag identifier id'>etag</span>           <span class='comment val'># =&gt; &amp;#8220;GunxqnEP4NeYhrqq9TyVKTuDnh0&amp;#8221;&lt;br /&gt;</span>
<span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='last_modified identifier id'>last_modified</span>  <span class='comment val'># =&gt; Sat Jan 31 17:58:16 -0500 2009 # it&amp;#8217;s a Time object&lt;/li&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;p&gt;entry = feed.entries.first&lt;br /</span><span class='gt op'>&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='title identifier id'>title</span>      <span class='comment val'># =&gt; &amp;#8220;Ruby Http Client Library Performance&amp;#8221;&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='url identifier id'>url</span>        <span class='comment val'># =&gt; &amp;#8220;http://www.pauldix.net/2009/01/ruby-http-client-library-performance.html&amp;#8221;&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='author identifier id'>author</span>     <span class='comment val'># =&gt; &amp;#8220;Paul Dix&amp;#8221;&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='summary identifier id'>summary</span>    <span class='comment val'># =&gt; &amp;#8220;&amp;#8230;&amp;#8221;&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='content identifier id'>content</span>    <span class='comment val'># =&gt; &amp;#8220;&amp;#8230;&amp;#8221;&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='published identifier id'>published</span>  <span class='comment val'># =&gt; Thu Jan 29 17:00:19 &lt;span class=&quot;caps&quot;&gt;UTC&lt;/span&gt; 2009 # it&amp;#8217;s a Time object&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='categories identifier id'>categories</span> <span class='comment val'># =&gt; [&amp;#8220;&amp;#8230;&amp;#8221;, &amp;#8220;&amp;#8230;&amp;#8221;]&lt;/p&gt;</span>
<span class='lt op'>&lt;</span><span class='ol identifier id'>ol</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='sanitizing identifier id'>sanitizing</span> <span class='an identifier id'>an</span> <span class='entry identifier id'>entry</span><span class='bitand op'>&amp;</span><span class='comment val'>#8217;s content&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='title identifier id'>title</span><span class='dot token'>.</span><span class='sanitize identifier id'>sanitize</span>   <span class='comment val'># =&gt; returns the title with harmful stuff escaped&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='author identifier id'>author</span><span class='dot token'>.</span><span class='sanitize identifier id'>sanitize</span>  <span class='comment val'># =&gt; returns the author with harmful stuff escaped&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='content identifier id'>content</span><span class='dot token'>.</span><span class='sanitize identifier id'>sanitize</span> <span class='comment val'># =&gt; returns the content with harmful stuff escaped&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='content identifier id'>content</span><span class='dot token'>.</span><span class='sanitize! fid id'>sanitize!</span> <span class='comment val'># =&gt; returns content with harmful stuff escaped and replaces original (also exists for author and title)&lt;br /&gt;</span>
<span class='entry identifier id'>entry</span><span class='dot token'>.</span><span class='sanitize! fid id'>sanitize!</span>         <span class='comment val'># =&gt; sanitizes the entry&amp;#8217;s title, author, and content in place (as in, it changes the value to clean versions)&lt;br /&gt;</span>
<span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='sanitize_entries! fid id'>sanitize_entries!</span>  <span class='comment val'># =&gt; sanitizes all entries in place&lt;/li&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;updating a single feed&lt;br /</span><span class='gt op'>&gt;</span>
<span class='updated_feed identifier id'>updated_feed</span> <span class='assign token'>=</span> <span class='Feedzirra constant id'>Feedzirra</span><span class='colon2 op'>::</span><span class='Feed constant id'>Feed</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='feed identifier id'>feed</span><span class='rparen token'>)</span><span class='lt op'>&lt;</span><span class='regexp val'>/li&gt;
&lt;/o</span><span class='l identifier id'>l</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='ol identifier id'>ol</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='an identifier id'>an</span> <span class='updated identifier id'>updated</span> <span class='feed identifier id'>feed</span> <span class='has identifier id'>has</span> <span class='the identifier id'>the</span> <span class='following identifier id'>following</span> <span class='extra identifier id'>extra</span> <span class='accessors identifier id'>accessors</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
updated_feed.updated?     # returns true if any of the feed attributes have been modified. will return false if only new entries&lt;br /</span><span class='gt op'>&gt;</span>
<span class='updated_feed identifier id'>updated_feed</span><span class='dot token'>.</span><span class='new_entries identifier id'>new_entries</span>  <span class='comment val'># a collection of the entry objects that are newer than the latest in the feed before update&lt;/li&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;fetching multiple feeds&lt;br /</span><span class='gt op'>&gt;</span>
<span class='feed_urls identifier id'>feed_urls</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='bitand op'>&amp;</span><span class='comment val'>#8220;http://feeds.feedburner.com/PaulDixExplainsNothing&amp;#8221;, &amp;#8220;http://feeds.feedburner.com/trottercashion&amp;#8221;]&lt;br /&gt;</span>
<span class='feeds identifier id'>feeds</span> <span class='assign token'>=</span> <span class='Feedzirra constant id'>Feedzirra</span><span class='colon2 op'>::</span><span class='Feed constant id'>Feed</span><span class='dot token'>.</span><span class='fetch_and_parse identifier id'>fetch_and_parse</span><span class='lparen token'>(</span><span class='feed_urls identifier id'>feed_urls</span><span class='rparen token'>)</span><span class='lt op'>&lt;</span><span class='regexp val'>/li&gt;
&lt;/o</span><span class='l identifier id'>l</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='ol identifier id'>ol</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='feeds identifier id'>feeds</span> <span class='is identifier id'>is</span> <span class='now identifier id'>now</span> <span class='a identifier id'>a</span> <span class='hash identifier id'>hash</span> <span class='with identifier id'>with</span> <span class='the identifier id'>the</span> <span class='feed_urls identifier id'>feed_urls</span> <span class='as identifier id'>as</span> <span class='keys identifier id'>keys</span> <span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='parsed identifier id'>parsed</span> <span class='feed identifier id'>feed</span> <span class='objects identifier id'>objects</span> <span class='as identifier id'>as</span> <span class='values identifier id'>values</span><span class='dot token'>.</span> <span class='If constant id'>If</span> <span class='an identifier id'>an</span> <span class='error identifier id'>error</span> <span class='was identifier id'>was</span> <span class='thrown identifier id'>thrown</span><span class='lt op'>&lt;</span><span class='regexp val'>/li&gt;
  &lt;li&gt;there will be a Fixnum of the http response code instead of a feed object&lt;/</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;updating multiple feeds. it expects a collection of feed objects&lt;br /</span><span class='gt op'>&gt;</span>
<span class='updated_feeds identifier id'>updated_feeds</span> <span class='assign token'>=</span> <span class='Feedzirra constant id'>Feedzirra</span><span class='colon2 op'>::</span><span class='Feed constant id'>Feed</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='feeds identifier id'>feeds</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='rparen token'>)</span><span class='lt op'>&lt;</span><span class='regexp val'>/li&gt;
&lt;/o</span><span class='l identifier id'>l</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='ol identifier id'>ol</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='defining identifier id'>defining</span> <span class='custom identifier id'>custom</span> <span class='behavior identifier id'>behavior</span> <span class='on identifier id'>on</span> <span class='failure identifier id'>failure</span> <span class='or or kw'>or</span> <span class='success identifier id'>success</span><span class='dot token'>.</span> <span class='note identifier id'>note</span> <span class='that identifier id'>that</span> <span class='a identifier id'>a</span> <span class='return return kw'>return</span> <span class='status identifier id'>status</span> <span class='of identifier id'>of</span> <span class='integer val'>304</span> <span class='lparen token'>(</span><span class='not not kw'>not</span> <span class='updated identifier id'>updated</span><span class='rparen token'>)</span> <span class='will identifier id'>will</span> <span class='call identifier id'>call</span> <span class='the identifier id'>the</span> <span class='on_success identifier id'>on_success</span> <span class='handler identifier id'>handler</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
feed = Feedzirra::Feed.fetch_and_parse(&amp;#8220;http:/</span><span class='div op'>/</span><span class='feeds identifier id'>feeds</span><span class='dot token'>.</span><span class='feedburner identifier id'>feedburner</span><span class='dot token'>.</span><span class='com identifier id'>com</span><span class='div op'>/</span><span class='PaulDixExplainsNothing constant id'>PaulDixExplainsNothing</span><span class='bitand op'>&amp;</span><span class='comment val'>#8221;,&lt;br /&gt;</span>
  <span class='symbol val'>:on_success</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='feed identifier id'>feed</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='feed identifier id'>feed</span><span class='dot token'>.</span><span class='title identifier id'>title</span> <span class='rbrace token'>}</span><span class='comma token'>,</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
  :on_failure =&gt; lambda {|url, response_code, response_header, response_body| puts response_body })&lt;/</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='if if kw'>if</span> <span class='a identifier id'>a</span> <span class='collection identifier id'>collection</span> <span class='was identifier id'>was</span> <span class='passed identifier id'>passed</span> <span class='into identifier id'>into</span> <span class='fetch_and_parse identifier id'>fetch_and_parse</span><span class='comma token'>,</span> <span class='the identifier id'>the</span> <span class='handlers identifier id'>handlers</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='called identifier id'>called</span> <span class='for for kw'>for</span> <span class='each identifier id'>each</span> <span class='one identifier id'>one</span><span class='lt op'>&lt;</span><span class='regexp val'>/li&gt;
&lt;/o</span><span class='l identifier id'>l</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='ol identifier id'>ol</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='the identifier id'>the</span> <span class='behavior identifier id'>behavior</span> <span class='for for kw'>for</span> <span class='the identifier id'>the</span> <span class='handlers identifier id'>handlers</span> <span class='when when kw'>when</span> <span class='using identifier id'>using</span> <span class='Feedzirra constant id'>Feedzirra</span><span class='colon2 op'>::</span><span class='Feed constant id'>Feed</span><span class='dot token'>.</span><span class='update identifier id'>update</span> <span class='is identifier id'>is</span> <span class='slightly identifier id'>slightly</span> <span class='different identifier id'>different</span><span class='dot token'>.</span> <span class='The constant id'>The</span> <span class='feed identifier id'>feed</span> <span class='passed identifier id'>passed</span> <span class='into identifier id'>into</span> <span class='on_success identifier id'>on_success</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span><span class='lt op'>&lt;</span><span class='regexp val'>/li&gt;
  &lt;li&gt;the updated feed with the standard updated accessors. on failure it will be the original feed object passed into update&lt;/</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;You can add custom parsing to the feed entry classes. Say you want the wfw:comments fields in an entry&lt;br /</span><span class='gt op'>&gt;</span>
<span class='Feedzirra constant id'>Feedzirra</span><span class='colon2 op'>::</span><span class='Feed constant id'>Feed</span><span class='dot token'>.</span><span class='add_common_feed_entry_element identifier id'>add_common_feed_entry_element</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='comment val'>#8220;wfw:commentRss&amp;#8221;, :as =&gt; :comment_rss)&lt;/li&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='The constant id'>The</span> <span class='arguments identifier id'>arguments</span> <span class='are identifier id'>are</span> <span class='the identifier id'>the</span> <span class='same identifier id'>same</span> <span class='as identifier id'>as</span> <span class='the identifier id'>the</span> <span class='SAXMachine constant id'>SAXMachine</span> <span class='arguments identifier id'>arguments</span> <span class='for for kw'>for</span> <span class='the identifier id'>the</span> <span class='element identifier id'>element</span> <span class='method identifier id'>method</span><span class='dot token'>.</span> <span class='For constant id'>For</span> <span class='more identifier id'>more</span> <span class='example identifier id'>example</span> <span class='usage identifier id'>usage</span> <span class='look identifier id'>look</span> <span class='at identifier id'>at</span> <span class='the identifier id'>the</span> <span class='RSSEntry constant id'>RSSEntry</span> <span class='and and kw'>and</span><span class='lt op'>&lt;</span><span class='regexp val'>/li&gt;
  &lt;li&gt;AtomEntry classes. Now you can access those in an atom feed:&lt;br /</span><span class='gt op'>&gt;</span>
<span class='Feedzirra constant id'>Feedzirra</span><span class='colon2 op'>::</span><span class='Feed constant id'>Feed</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='some_atom_xml identifier id'>some_atom_xml</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='entries identifier id'>entries</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='comment_rss_ identifier id'>comment_rss_</span> <span class='comment val'># =&gt; wfw:commentRss is now parsed!&lt;/li&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;You can also define your own parsers and add them to the ones Feedzirra knows about. Here&amp;#8217;s an example that adds&lt;/</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='ITunesRSS constant id'>ITunesRSS</span> <span class='parsing identifier id'>parsing</span><span class='dot token'>.</span> <span class='It constant id'>It</span><span class='bitand op'>&amp;</span><span class='comment val'>#8217;s included in the library, but not part of Feedzirra by default because some of the field names&lt;/li&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='differ identifier id'>differ</span> <span class='from identifier id'>from</span> <span class='other identifier id'>other</span> <span class='classes identifier id'>classes</span><span class='comma token'>,</span> <span class='thus identifier id'>thus</span> <span class='breaking identifier id'>breaking</span> <span class='normalization identifier id'>normalization</span><span class='dot token'>.</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
Feedzirra::Feed.add_feed_class(ITunesRSS) # now all feeds will be checked to see if they match ITunesRSS before others&lt;/</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;You can also access http basic auth feeds. Unfortunately, you can&amp;#8217;t get to these inside of a bulk get of a bunch of feeds.&lt;/</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='You constant id'>You</span><span class='bitand op'>&amp;</span><span class='comment val'>#8217;ll have to do it on its own like so:&lt;br /&gt;</span>
<span class='Feedzirra constant id'>Feedzirra</span><span class='colon2 op'>::</span><span class='Feed constant id'>Feed</span><span class='dot token'>.</span><span class='fetch_and_parse identifier id'>fetch_and_parse</span><span class='lparen token'>(</span><span class='some_url identifier id'>some_url</span><span class='comma token'>,</span> <span class='symbol val'>:http_authentication</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='bitand op'>&amp;</span><span class='comment val'>#8220;myusername&amp;#8221;, &amp;#8220;mypassword&amp;#8221;])&lt;/li&gt;</span>
<span class='lt op'>&lt;</span><span class='regexp val'>/ol&gt;
&lt;ol&gt;
  &lt;li&gt;Defining custom parsers&lt;/</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='li identifier id'>li</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='span identifier id'>span</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>&quot;caps&quot;</span><span class='gt op'>&gt;</span><span class='TODO constant id'>TODO</span><span class='lt op'>&lt;</span><span class='regexp val'>/span&gt;: the functionality is here, just write some good examples that show how to do this&lt;br /</span><span class='gt op'>&gt;</span>
</pre></li>
</ol>
<h2>Benchmarks</h2>
<p>One of the goals of Feedzirra is speed. This includes not only parsing, but fetching multiple feeds as quickly as possible. I ran a benchmark getting 20 feeds 10 times using Feedzirra, rFeedParser, and FeedNormalizer. For more details the <a href="http://github.com/pauldix/feedzirra/blob/7fb5634c5c16e9c6ec971767b462c6518cd55f5d/spec/benchmarks/feedzirra_benchmarks.rb">benchmark code can be found in the project in spec/benchmarks/feedzirra_benchmarks.rb</a><br />
<pre class="code"><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
feedzirra          5.170000   1.290000   6.460000 ( 18.917796)&lt;br /</span><span class='gt op'>&gt;</span>
<span class='rfeedparser identifier id'>rfeedparser</span>      <span class='float val'>104.260000</span>  <span class='float val'>12.220000</span> <span class='float val'>116.480000</span> <span class='lparen token'>(</span><span class='float val'>244.799063</span><span class='rparen token'>)</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
feed-normalizer   66.250000   4.010000  70.260000 (191.589862)&lt;br /</span><span class='gt op'>&gt;</span>
</pre><br />
The result of that benchmark is a bit sketchy because of the network variability. Running 10 times against the same 20 feeds was meant to smooth some of that out. However, there is also a <a href="http://github.com/pauldix/feedzirra/blob/7fb5634c5c16e9c6ec971767b462c6518cd55f5d/spec/benchmarks/parsing_benchmark.rb">benchmark comparing parsing speed in spec/benchmarks/parsing_benchmark.rb</a> on an atom feed.<br />
<pre class="code"><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
feedzirra        0.500000   0.030000   0.530000 (  0.658744)&lt;br /</span><span class='gt op'>&gt;</span>
<span class='rfeedparser identifier id'>rfeedparser</span>      <span class='float val'>8.400000</span>   <span class='float val'>1.110000</span>   <span class='float val'>9.510000</span> <span class='lparen token'>(</span> <span class='float val'>11.839827</span><span class='rparen token'>)</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
feed-normalizer  5.980000   0.160000   6.140000 (  7.576140)&lt;br /</span><span class='gt op'>&gt;</span>
</pre><br />
There&#8217;s also a <a href="http://github.com/pauldix/feedzirra/blob/45d64319544c61a4c9eb9f7f825c73b9f9030cb3/spec/benchmarks/updating_benchmarks.rb">benchmark that shows the results of using Feedzirra to perform updates on feeds</a> you&#8217;ve already pulled in. I tested against 179 feeds. The first is the initial pull and the second is an update 65 seconds later. I&#8217;m not sure how many of them support etag and last-modified, so performance may be better or worse depending on what feeds you&#8217;re requesting.<br />
<pre class="code"><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
feedzirra fetch and parse  4.010000   0.710000   4.720000 ( 15.110101)&lt;br /</span><span class='gt op'>&gt;</span>
<span class='feedzirra identifier id'>feedzirra</span> <span class='update identifier id'>update</span>           <span class='integer val'>0</span><span class='integer val'>.660000</span>   <span class='integer val'>0</span><span class='integer val'>.280000</span>   <span class='integer val'>0</span><span class='integer val'>.940000</span> <span class='lparen token'>(</span>  <span class='float val'>5.152709</span><span class='rparen token'>)</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
</span></pre></p>
<h2>Next Steps</h2>
<p>This thing needs to hammer on many different feeds in the wild. I&#8217;m sure there will be bugs. I want to find them and crush them. I didn&#8217;t bother using the test suite for feedparser. i wanted to start fresh.</p>
<p>Here are some more specific TODOs.</p>
<ul>
	<li>Fix the iTunes parser so things are normalized again</li>
	<li>Fix the Zlib deflate error</li>
	<li>Fix this error: http://github.com/inbox/70508</li>
	<li>Convert to use Typhoeus instead of taf2-curb</li>
	<li>Make the entries parse all link fields</li>
	<li>Make a feedzirra-rails gem to integrate feedzirra seamlessly with Rails and ActiveRecord.</li>
	<li>Create a super sweet <span class="caps">DSL</span> for defining new parsers.</li>
	<li>Test against Ruby 1.9.1 and fix any bugs.</li>
	<li>Clean up the fetching code inside feed.rb so it doesn&#8217;t suck so hard.</li>
	<li>Readdress how feeds determine if they can parse a document. Maybe I should use namespaces instead?</li>
</ul>
<h2><span class="caps">LICENSE</span></h2>
<p>(The <span class="caps">MIT</span> License)<br />
 <br />
Copyright &#169; 2009:<br />
 <br />
<a href="http://pauldix.net">Paul Dix</a><br />
 <br />
Permission is hereby granted, free of charge, to any person obtaining<br />
a copy of this software and associated documentation files (the<br />
&#8216;Software&#8217;), to deal in the Software without restriction, including<br />
without limitation the rights to use, copy, modify, merge, publish,<br />
distribute, sublicense, and/or sell copies of the Software, and to<br />
permit persons to whom the Software is furnished to do so, subject to<br />
the following conditions:<br />
 <br />
The above copyright notice and this permission notice shall be<br />
included in all copies or substantial portions of the Software.<br />
 <br />
<span class="caps">THE</span> <span class="caps">SOFTWARE</span> IS <span class="caps">PROVIDED</span> &#8216;AS IS&#8217;, <span class="caps">WITHOUT</span> <span class="caps">WARRANTY</span> OF <span class="caps">ANY</span> <span class="caps">KIND</span>,<br />
<span class="caps">EXPRESS</span> OR <span class="caps">IMPLIED</span>, <span class="caps">INCLUDING</span> <span class="caps">BUT</span> <span class="caps">NOT</span> <span class="caps">LIMITED</span> TO <span class="caps">THE</span> <span class="caps">WARRANTIES</span> OF<br />
<span class="caps">MERCHANTABILITY</span>, <span class="caps">FITNESS</span> <span class="caps">FOR</span> A <span class="caps">PARTICULAR</span> <span class="caps">PURPOSE</span> <span class="caps">AND</span> <span class="caps">NONINFRINGEMENT</span>.<br />
IN NO <span class="caps">EVENT</span> <span class="caps">SHALL</span> <span class="caps">THE</span> <span class="caps">AUTHORS</span> OR <span class="caps">COPYRIGHT</span> <span class="caps">HOLDERS</span> BE <span class="caps">LIABLE</span> <span class="caps">FOR</span> <span class="caps">ANY</span><br />
<span class="caps">CLAIM</span>, <span class="caps">DAMAGES</span> OR <span class="caps">OTHER</span> <span class="caps">LIABILITY</span>, <span class="caps">WHETHER</span> IN AN <span class="caps">ACTION</span> OF <span class="caps">CONTRACT</span>,<br />
<span class="caps">TORT</span> OR <span class="caps">OTHERWISE</span>, <span class="caps">ARISING</span> <span class="caps">FROM</span>, <span class="caps">OUT</span> OF OR IN <span class="caps">CONNECTION</span> <span class="caps">WITH</span> <span class="caps">THE</span><br />
<span class="caps">SOFTWARE</span> OR <span class="caps">THE</span> <span class="caps">USE</span> OR <span class="caps">OTHER</span> <span class="caps">DEALINGS</span> IN <span class="caps">THE</span> <span class="caps">SOFTWARE</span>.</p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>