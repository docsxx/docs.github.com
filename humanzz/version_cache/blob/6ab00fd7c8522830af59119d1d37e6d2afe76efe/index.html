<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>humanzz's version_cache - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/humanzz/commits/version_cache/master" rel="alternate" title="Recent Commits to version_cache:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("humanzz", "version_cache", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='humanzz/version_cache/blob/6ab00fd7c8522830af59119d1d37e6d2afe76efe' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='humanzz/version_cache/blob/6ab00fd7c8522830af59119d1d37e6d2afe76efe' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("humanzz", "version_cache", "6ab00fd7c8522830af59119d1d37e6d2afe76efe", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/humanzz/version_cache/tree/">Source</a></li>
            <li class=""><a href="http://github.com/humanzz/version_cache/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/humanzz/version_cache/network">Network</a></li>            
            <li class=""><a href="http://github.com/humanzz/version_cache/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/humanzz/version_cache">Wiki</a></li>
            <li class=""><a href="http://github.com/humanzz/version_cache/graphs">Graphs</a></li>                    
            <li class="active"><a href="/humanzz/version_cache">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/humanzz">humanzz</a> / <b><a href="http://github.com/humanzz/version_cache/tree">version_cache</a></b>        
                <a id="namespaces_button" rel="humanzz/version_cache/blob/6ab00fd7c8522830af59119d1d37e6d2afe76efe" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="humanzz/version_cache/blob/6ab00fd7c8522830af59119d1d37e6d2afe76efe" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
VersionCache
</p>
<h6>=====</h6>
<p>
A Ruby on rails (v2.1.0) plugin that provides additional caching features.
Version caching is similar to action caching but it solves one major
problem. It solves the problem of having to expire your cached stuff via
the provided rails methods. Instead, it relies on versions. For example,
say we have a PostsController and a corresponding Post model and we need to
cache the show action of the PostsController.
</p>
<p>
For generating a response to the request http://localhost:3000/posts/1 the
following will happen
</p>
<ol>
<li>Check the version of Post with id 1 from cache store with the key
&quot;Post_1&quot;

</li>
<li>if not found then the version is assumed to be 0

</li>
<li>The cache store is queried using a key that&#8217;s composed of the
request&#8217;s url + the version.

</li>
<li>If the cache hits then the response is fetched from the cache but if it
misses then the response is generated normally and stored in the cache.

</li>
</ol>
<p>
However there needs to be some means to change the versions. This is
achieved using observers. A cache observer will observe the model and
change its version upon creation, updating, or deletion.
</p>
<p>
The first time a request is made to http://localhost:3000/posts/1, the page
is stored in the cache store with the key &quot;localhost.:posts/1:0&quot;.
Subsequent requests will be served from cache until an update is made to
post 1 which will cause the version to become 1.
</p>
<p>
One more feature of the plugin is time caching.
</p>
<p>
Introducing the plugin blog entry
</p>
<h6>===========================</h6>
<p>
http://humanzz.spaces.live.com/blog/cns!82322F9506CB0449!713.entry
</p>
<p>
Setup
</p>
<h5></h5>
<pre class="code">
        <span class='ruby identifier id'>ruby</span> <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='humanzz identifier id'>humanzz</span><span class='div op'>/</span><span class='version_cache identifier id'>version_cache</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<p>
After installing the version_cache plugin you&#8217;ll need to do the
following
</p>
<ol>
<li>Generate the version_cache_observer using the supplied generator as follows

<pre class="code">
     <span class='ruby identifier id'>ruby</span> <span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='version_cache_observer identifier id'>version_cache_observer</span> <span class='ObserverName constant id'>ObserverName</span> <span class='Model1 constant id'>Model1</span> <span class='Model2 constant id'>Model2</span>

     <span class='Example constant id'>Example</span><span class='colon op'>:</span>
             <span class='ruby identifier id'>ruby</span> <span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='version_cache_observer identifier id'>version_cache_observer</span> <span class='Cache constant id'>Cache</span> <span class='Post constant id'>Post</span> <span class='Topic constant id'>Topic</span>

             <span class='This constant id'>This</span> <span class='will identifier id'>will</span> <span class='create identifier id'>create</span><span class='colon op'>:</span>
     <span class='Observer constant id'>Observer</span><span class='colon op'>:</span>      <span class='app identifier id'>app</span><span class='div op'>/</span><span class='models identifier id'>models</span><span class='div op'>/</span><span class='cache_observer identifier id'>cache_observer</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
   <span class='The constant id'>The</span> <span class='cache_observer identifier id'>cache_observer</span> <span class='will identifier id'>will</span> <span class='observe identifier id'>observe</span> <span class='Topic constant id'>Topic</span> <span class='and and kw'>and</span> <span class='Post constant id'>Post</span> <span class='models identifier id'>models</span>
</pre>
</li>
<li>Register the observer in your environment

<pre class="code">
     <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='active_record identifier id'>active_record</span><span class='dot token'>.</span><span class='observers identifier id'>observers</span> <span class='ObserverName constant id'>ObserverName</span>
</pre>
</li>
</ol>
<p>
Usage
</p>
<h5></h5>
<ul>
<li>To version cache an action put the following line in the controller

</li>
</ul>
<p>
class ItemsController &lt; ApplicationController
</p>
<pre class="code">
        <span class='dot token'>.</span>
        <span class='version_cache identifier id'>version_cache</span> <span class='Item constant id'>Item</span><span class='comma token'>,</span> <span class='symbol val'>:expiry</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>20</span>
        <span class='dot token'>.</span>
        <span class='dot token'>.</span>
</pre>
<p>
end
</p>
<pre class="code">
        <span class='Item constant id'>Item</span><span class='colon op'>:</span> <span class='model identifier id'>model</span> <span class='whose identifier id'>whose</span> <span class='version identifier id'>version</span> <span class='is identifier id'>is</span> <span class='used identifier id'>used</span>
        <span class='expiry identifier id'>expiry</span><span class='colon op'>:</span> <span class='integer val'>0</span> <span class='means identifier id'>means</span> <span class='don identifier id'>don</span><span class='string val'>'t expire, any other number is taken to be a maximum time to cache (in minutes)
</span></pre>
<p>
if used without declaring an :action option then the show action is the one
that&#8217;ll be used.
</p>
<ul>
<li>To time cache an action

</li>
</ul>
<p>
class WelcomeController &lt; ApplicationController
</p>
<pre class="code">
  <span class='dot token'>.</span>
  <span class='dot token'>.</span>
        <span class='time_cache identifier id'>time_cache</span> <span class='symbol val'>:index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:expiry</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>20</span><span class='rbrace token'>}</span> <span class='comment val'>#cache for 20 minutes</span>
        <span class='time_cache identifier id'>time_cache</span> <span class='symbol val'>:show</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:expiry</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>5</span><span class='comma token'>,</span> <span class='symbol val'>:browser_cache</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rbrace token'>}</span>
        <span class='dot token'>.</span>
        <span class='dot token'>.</span>
</pre>
<p>
end
</p>
<pre class="code">
        <span class='symbol val'>:expiry</span> <span class='is identifier id'>is</span> <span class='the identifier id'>the</span> <span class='amount identifier id'>amount</span> <span class='of identifier id'>of</span> <span class='time identifier id'>time</span> <span class='in in kw'>in</span> <span class='minutes identifier id'>minutes</span>
        <span class='symbol val'>:browser_cache</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='true true kw'>true</span><span class='bitor op'>|</span><span class='false false kw'>false</span><span class='rparen token'>)</span> <span class='which identifier id'>which</span> <span class='causes identifier id'>causes</span> <span class='the identifier id'>the</span> <span class='insertion identifier id'>insertion</span> <span class='of identifier id'>of</span> <span class='expires identifier id'>expires</span> <span class='and and kw'>and</span> <span class='cache identifier id'>cache</span><span class='minus op'>-</span><span class='control identifier id'>control</span> <span class='headers identifier id'>headers</span>
        <span class='so identifier id'>so</span> <span class='that identifier id'>that</span> <span class='the identifier id'>the</span> <span class='browser identifier id'>browser</span> <span class='can identifier id'>can</span> <span class='serve identifier id'>serve</span> <span class='the identifier id'>the</span> <span class='page identifier id'>page</span> <span class='from identifier id'>from</span> <span class='its identifier id'>its</span> <span class='local identifier id'>local</span> <span class='cache identifier id'>cache</span> <span class='without identifier id'>without</span> <span class='even identifier id'>even</span> <span class='consulting identifier id'>consulting</span> <span class='your identifier id'>your</span>
        <span class='application identifier id'>application</span>
</pre>
<ul>
<li>An additional feature is that some models updates should not only change
their versions, but versions of other models as well. For example, we have
ItemsController and Item model and User model where an item belongs to a
user, and we want the user&#8217;s version to change when the item&#8217;s
vesion change. We do the following

</li>
</ul>
<p>
class ItemsController &lt; ApplicationController
</p>
<pre class="code">
  <span class='dot token'>.</span>
  <span class='version_cache identifier id'>version_cache</span> <span class='Item constant id'>Item</span>
  <span class='dot token'>.</span>
  <span class='dot token'>.</span>
</pre>
<p>
end
</p>
<p>
class Item &lt; ActiveRecord::Base
</p>
<pre class="code">
  <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:user</span>

  <span class='has_cache_associates identifier id'>has_cache_associates</span> <span class='symbol val'>:user</span>
</pre>
<p>
end
</p>
<p>
Now whenever an item is created, updated or destroyed not only will its
version be incremented but it&#8217;s user&#8217;s version as well.
</p>
<p>
Other convenience methods
</p>
<h6>===================</h6>
<p>
These are methods that can be overriden in your controllers to provide some
effect
</p>
<ul>
<li>version_cache_model_id

</li>
</ul>
<p>
Consider the case of the url http://localhost:3000/users/59/profile. If you
want to cache that page based on the user model&#8217;s version, then you
should do the following
</p>
<p>
class ProfilesController &lt; ApplicationController
</p>
<pre class="code">
        <span class='dot token'>.</span>
        <span class='version_cache identifier id'>version_cache</span> <span class='User constant id'>User</span>
        <span class='dot token'>.</span>

        <span class='def identifier id'>def</span> <span class='version_cache_model_id identifier id'>version_cache_model_id</span>
                <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:user_id</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>
</pre>
<p>
end
</p>
<ul>
<li>version_cache_key_part

</li>
</ul>
<p>
This can be used if we want to cache multiple versions of the same
page.&#8230;this function should return a string that determines which
version is this page for example in a controller that uses version or time
caching for its show action, assume that the show action shows 2 versions
to 2 types of users
</p>
<p>
class WelcomeController &lt; ApplicationController
</p>
<pre class="code">
  <span class='dot token'>.</span>
  <span class='dot token'>.</span>
        <span class='time_cache identifier id'>time_cache</span> <span class='symbol val'>:index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:expiry</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>20</span><span class='rbrace token'>}</span>
        <span class='dot token'>.</span>
        <span class='dot token'>.</span>
        <span class='def identifier id'>def</span> <span class='version_cache_key_part identifier id'>version_cache_key_part</span>
          <span class='current_user identifier id'>current_user</span><span class='dot token'>.</span><span class='type_1? fid id'>type_1?</span> <span class='integer val'>? </span><span class='string val'>&quot;one&quot;</span> <span class='colon op'>:</span> <span class='string val'>&quot;two&quot;</span>
        <span class='end end kw'>end</span>
</pre>
<p>
end
</p>
<p>
Copyright &#169; 2008 humanzz (Ahmed Sobhi), released under the MIT license
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>