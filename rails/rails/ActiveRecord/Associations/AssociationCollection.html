<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: ActiveRecord::Associations::AssociationCollection</title>
  </head>
  <body>
    <div id="content">
      <div class="section class ActiveRecord_Associations_AssociationCollection">
  <h1 class="title">Class: ActiveRecord::Associations::AssociationCollection</h1>
  <div class="section inheritance">
  <ul>
  <li><a href='../../Object.html' title='Object'>Object</a></li><ul><li><a href='AssociationProxy.html' title='ActiveRecord::Associations::AssociationProxy'>ActiveRecord::Associations::AssociationProxy</a></li><ul><li>ActiveRecord::Associations::AssociationCollection</li>
  </ul></ul></ul>
</div><div class="section docstring">
  <p>
AssociationCollection is an abstract class that provides common stuff to
ease the implementation of association proxies that represent collections.
See the class hierarchy in AssociationProxy.
</p>
<p>
You need to be careful with assumptions regarding the target: The proxy
does not fetch records from the database until it needs them, but new ones
created with <tt>build</tt> are added to the target. So, the target may be
non-empty and still lack children waiting to be read from the database. If
you look directly to the database you cannot assume that&#8217;s the entire
collection because new records may have beed added to the target, etc.
</p>
<p>
If you need to work on all current children, new and existing records,
<tt>load_target</tt> and the <tt>loaded</tt> flag are your friends.
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(owner, reflection)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


19
20
21
22</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 19</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='owner identifier id'>owner</span><span class='comma token'>,</span> <span class='reflection identifier id'>reflection</span><span class='rparen token'>)</span>
  <span class='super super kw'>super</span>
  <span class='construct_sql identifier id'>construct_sql</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div><div class="section methodmissing">
  <h1>Dynamic Method Handling</h1>

  <p class="note">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>

  <div id="method_missing-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>protected</span>
    <span class='return_types'></span>
    <span class='name'>method_missing</span><span class='args'>(method, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 365</span>

<span class='def def kw'>def</span> <span class='method_missing identifier id'>method_missing</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='notop op'>!</span><span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
      <span class='super super kw'>super</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='super super kw'>super</span>
    <span class='end end kw'>end</span>
  <span class='elsif elsif kw'>elsif</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='scopes identifier id'>scopes</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='rparen token'>)</span>
    <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='scopes identifier id'>scopes</span><span class='lbrack token'>[</span><span class='method identifier id'>method</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>          
    <span class='with_scope identifier id'>with_scope</span><span class='lparen token'>(</span><span class='construct_scope identifier id'>construct_scope</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
        <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
      <span class='else else kw'>else</span>
        <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#%3C%3C-instance_method' title='#&lt;&lt;'>#&lt;&lt;</a></span><span class='args'>(*records)</span>
        <span class='block'></span>
        
          <span class='alias'>#push</span>
        
      </th>
      <td class="docstring">
        <p>
Add <tt>records</tt> to this association.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#any%3F-instance_method' title='#any?'>#any?</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build-instance_method' title='#build'>#build</a></span><span class='args'>(attributes = {}, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#clear-instance_method' title='#clear'>#clear</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Removes all records from this association.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#count-instance_method' title='#count'>#count</a></span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Count all records using SQL.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#create-instance_method' title='#create'>#create</a></span><span class='args'>(attrs = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#create%21-instance_method' title='#create!'>#create!</a></span><span class='args'>(attrs = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#delete-instance_method' title='#delete'>#delete</a></span><span class='args'>(*records)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Removes <tt>records</tt> from this association calling
<tt>before_remove</tt> and <tt>after_remove</tt> callbacks.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#delete_all-instance_method' title='#delete_all'>#delete_all</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Remove all records from this association.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#destroy-instance_method' title='#destroy'>#destroy</a></span><span class='args'>(*records)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Destroy <tt>records</tt> and remove them from this association calling
<tt>before_remove</tt> and <tt>after_remove</tt> callbacks.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#destroy_all-instance_method' title='#destroy_all'>#destroy_all</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Destory all the records from this association.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#empty%3F-instance_method' title='#empty?'>#empty?</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Equivalent to &lt;tt&gt;collection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find-instance_method' title='#find'>#find</a></span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#first-instance_method' title='#first'>#first</a></span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches the first one using SQL if possible.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#include%3F-instance_method' title='#include?'>#include?</a></span><span class='args'>(record)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#last-instance_method' title='#last'>#last</a></span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches the last one using SQL if possible.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#length-instance_method' title='#length'>#length</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the size of the collection calling <tt>size</tt> on the target.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#proxy_respond_to%3F-instance_method' title='#proxy_respond_to?'>#proxy_respond_to?</a></span><span class='args'>(method, include_private = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#replace-instance_method' title='#replace'>#replace</a></span><span class='args'>(other_array)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Replace this collection with <tt>other_array</tt> This will perform a diff
and delete/add only records that have changed.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#reset-instance_method' title='#reset'>#reset</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#size-instance_method' title='#size'>#size</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the size of the collection by executing a SELECT COUNT(*) query if
the collection hasn&#8217;t been loaded, and calling &lt;tt&gt;collection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#sum-instance_method' title='#sum'>#sum</a></span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Calculate sum using SQL, not Enumerable.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#to_ary-instance_method' title='#to_ary'>#to_ary</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#uniq-instance_method' title='#uniq'>#uniq</a></span><span class='args'>(collection = self)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h1>Public Instance Methods Inherited from <a href='AssociationProxy.html' title='ActiveRecord::Associations::AssociationProxy'>ActiveRecord::Associations::AssociationProxy</a></h1>
    <p><span class='name'><a href='AssociationProxy.html#%3D%3D%3D-instance_method' title='==='>===</a></span>, <span class='name'><a href='AssociationProxy.html#aliased_table_name-instance_method' title='aliased_table_name'>aliased_table_name</a></span>, <span class='name'><a href='AssociationProxy.html#conditions-instance_method' title='conditions'>conditions</a></span>, <span class='name'><a href='AssociationProxy.html#inspect-instance_method' title='inspect'>inspect</a></span>, <span class='name'><a href='AssociationProxy.html#loaded-instance_method' title='loaded'>loaded</a></span>, <span class='name'><a href='AssociationProxy.html#loaded%3F-instance_method' title='loaded?'>loaded?</a></span>, <span class='name'><a href='AssociationProxy.html#proxy_owner-instance_method' title='proxy_owner'>proxy_owner</a></span>, <span class='name'><a href='AssociationProxy.html#proxy_reflection-instance_method' title='proxy_reflection'>proxy_reflection</a></span>, <span class='name'><a href='AssociationProxy.html#proxy_target-instance_method' title='proxy_target'>proxy_target</a></span>, <span class='name'><a href='AssociationProxy.html#reload-instance_method' title='reload'>reload</a></span>, <span class='name'><a href='AssociationProxy.html#respond_to%3F-instance_method' title='respond_to?'>respond_to?</a></span>, <span class='name'><a href='AssociationProxy.html#send-instance_method' title='send'>send</a></span>, <span class='name'><a href='AssociationProxy.html#target-instance_method' title='target'>target</a></span></p>
  </div>
  
  <div>
    <h1>Public Instance Methods Inherited from <a href='../../Object.html' title='Object'>Object</a></h1>
    <p><span class='name'><a href='../../Object.html#blank%3F-instance_method' title='blank?'>blank?</a></span>, <span class='name'><a href='../../Object.html#duplicable%3F-instance_method' title='duplicable?'>duplicable?</a></span>, <span class='name'><a href='../../Object.html#present%3F-instance_method' title='present?'>present?</a></span>, <span class='name'><a href='../../Object.html#to_param-instance_method' title='to_param'>to_param</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>&lt;&lt;</h3>
</div><div id="%3C%3C-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'><<</span><span class='args'>(*records)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="push-instance_method">push</tt>
  
</p>
</div><div class="section docstring">
  <p>
Add <tt>records</tt> to this association. Returns <tt>self</tt> so method
calls may be chained. Since &lt;&lt; flattens its argument list and inserts
each record, <tt>push</tt> and <tt>concat</tt> behave identically.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


111
112
113
114
115
116
117
118
119
120
121
122
123
124
125</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 111</span>

<span class='def def kw'>def</span> <span class='lshft op'>&lt;&lt;</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='records identifier id'>records</span><span class='rparen token'>)</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='load_target identifier id'>load_target</span> <span class='if if_mod kw'>if</span> <span class='@owner ivar id'>@owner</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span>

  <span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
    <span class='flatten_deeper identifier id'>flatten_deeper</span><span class='lparen token'>(</span><span class='records identifier id'>records</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
      <span class='raise_on_type_mismatch identifier id'>raise_on_type_mismatch</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span>
      <span class='add_record_to_target_with_callbacks identifier id'>add_record_to_target_with_callbacks</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
        <span class='result identifier id'>result</span> <span class='opasgn op'>&amp;&amp;=</span> <span class='insert_record identifier id'>insert_record</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='@owner ivar id'>@owner</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='result identifier id'>result</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>any?</h3>
</div><div id="any%3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>any?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


297
298
299
300
301
302
303</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 297</span>

<span class='def def kw'>def</span> <span class='any? fid id'>any?</span>
  <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='method_missing identifier id'>method_missing</span><span class='lparen token'>(</span><span class='symbol val'>:any?</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='notop op'>!</span><span class='empty? fid id'>empty?</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build</h3>
</div><div id="build-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build</span><span class='args'>(attributes = {}, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


98
99
100
101
102
103
104
105
106
107</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 98</span>

<span class='def def kw'>def</span> <span class='build identifier id'>build</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span> <span class='build identifier id'>build</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='build_record identifier id'>build_record</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
      <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
      <span class='set_belongs_to_association_for identifier id'>set_belongs_to_association_for</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>clear</h3>
</div><div id="clear-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>clear</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Removes all records from this association. Returns <tt>self</tt> so method
calls may be chained.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


219
220
221
222
223
224
225
226
227
228
229</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 219</span>

<span class='def def kw'>def</span> <span class='clear identifier id'>clear</span>
  <span class='return return kw'>return</span> <span class='self self kw'>self</span> <span class='if if_mod kw'>if</span> <span class='length identifier id'>length</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span> <span class='comment val'># forces load_target if it hasn't happened already</span>

  <span class='if if kw'>if</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='dependent identifier id'>dependent</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='dependent identifier id'>dependent</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='colon op'>:</span><span class='destroy identifier id'>destroy</span>
    <span class='destroy_all identifier id'>destroy_all</span>
  <span class='else else kw'>else</span>          
    <span class='delete_all identifier id'>delete_all</span>
  <span class='end end kw'>end</span>

  <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>count</h3>
</div><div id="count-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>count</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Count all records using SQL. If the +:counter_sql+ option is set for the
association, it will be used for the query. If no +:counter_sql+ was
supplied, but +:finder_sql+ was set, the descendant&#8217;s
<tt>construct_sql</tt> method will have set :counter_sql automatically.
Otherwise, construct options and pass them with scope to the target
class&#8217;s <tt>count</tt>.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 167</span>

<span class='def def kw'>def</span> <span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='counter_sql identifier id'>counter_sql</span><span class='rbrack token'>]</span>
    <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='count_by_sql identifier id'>count_by_sql</span><span class='lparen token'>(</span><span class='@counter_sql ivar id'>@counter_sql</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='column_name identifier id'>column_name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:construct_count_options_from_args</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='uniq identifier id'>uniq</span><span class='rbrack token'>]</span>
      <span class='comment val'># This is needed because 'SELECT count(DISTINCT *)..' is not valid SQL.</span>
      <span class='column_name identifier id'>column_name</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{@reflection.quoted_table_name}.#{@reflection.klass.primary_key}&quot;</span> <span class='if if_mod kw'>if</span> <span class='column_name identifier id'>column_name</span> <span class='eq op'>==</span> <span class='symbol val'>:all</span>
      <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='symbol val'>:distinct</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:with_scope</span><span class='comma token'>,</span> <span class='construct_scope identifier id'>construct_scope</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='column_name identifier id'>column_name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>

    <span class='limit identifier id'>limit</span>  <span class='assign token'>=</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span>
    <span class='offset identifier id'>offset</span> <span class='assign token'>=</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:offset</span><span class='rbrack token'>]</span>

    <span class='if if kw'>if</span> <span class='limit identifier id'>limit</span> <span class='orop op'>||</span> <span class='offset identifier id'>offset</span>
      <span class='lbrack token'>[</span> <span class='lbrack token'>[</span><span class='value identifier id'>value</span> <span class='minus op'>-</span> <span class='offset identifier id'>offset</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='max identifier id'>max</span><span class='comma token'>,</span> <span class='limit identifier id'>limit</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='min identifier id'>min</span>
    <span class='else else kw'>else</span>
      <span class='value identifier id'>value</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create</h3>
</div><div id="create-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create</span><span class='args'>(attrs = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


240
241
242
243
244
245
246
247
248
249</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 240</span>

<span class='def def kw'>def</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='create_record identifier id'>create_record</span><span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
      <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
      <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create!</h3>
</div><div id="create%21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create!</span><span class='args'>(attrs = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


251
252
253
254
255
256</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 251</span>

<span class='def def kw'>def</span> <span class='create! fid id'>create!</span><span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='create_record identifier id'>create_record</span><span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
    <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>delete</h3>
</div><div id="delete-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>delete</span><span class='args'>(*records)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Removes <tt>records</tt> from this association calling
<tt>before_remove</tt> and <tt>after_remove</tt> callbacks.
</p>
<p>
This method is abstract in the sense that <tt>delete_records</tt> has to be
provided by descendants. Note this method does not imply the records are
actually removed from the database, that depends precisely on
<tt>delete_records</tt>. They are in any case removed from the collection.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


198
199
200
201
202
203</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 198</span>

<span class='def def kw'>def</span> <span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='records identifier id'>records</span><span class='rparen token'>)</span>
  <span class='remove_records identifier id'>remove_records</span><span class='lparen token'>(</span><span class='records identifier id'>records</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='records identifier id'>records</span><span class='comma token'>,</span> <span class='old_records identifier id'>old_records</span><span class='bitor op'>|</span>
    <span class='delete_records identifier id'>delete_records</span><span class='lparen token'>(</span><span class='old_records identifier id'>old_records</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='old_records identifier id'>old_records</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
    <span class='records identifier id'>records</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>delete_all</h3>
</div><div id="delete_all-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>delete_all</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Remove all records from this association
</p>
<p>
See delete for more info.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


148
149
150
151
152</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 148</span>

<span class='def def kw'>def</span> <span class='delete_all identifier id'>delete_all</span>
  <span class='load_target identifier id'>load_target</span>
  <span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='@target ivar id'>@target</span><span class='rparen token'>)</span>
  <span class='reset_target! fid id'>reset_target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>destroy</h3>
</div><div id="destroy-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>destroy</span><span class='args'>(*records)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Destroy <tt>records</tt> and remove them from this association calling
<tt>before_remove</tt> and <tt>after_remove</tt> callbacks.
</p>
<p>
Note that this method will <em>always</em> remove records from the database
ignoring the +:dependent+ option.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


210
211
212
213
214
215
216</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 210</span>

<span class='def def kw'>def</span> <span class='destroy identifier id'>destroy</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='records identifier id'>records</span><span class='rparen token'>)</span>
  <span class='remove_records identifier id'>remove_records</span><span class='lparen token'>(</span><span class='records identifier id'>records</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='records identifier id'>records</span><span class='comma token'>,</span> <span class='old_records identifier id'>old_records</span><span class='bitor op'>|</span>
    <span class='old_records identifier id'>old_records</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='load_target identifier id'>load_target</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>destroy_all</h3>
</div><div id="destroy_all-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>destroy_all</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Destory all the records from this association.
</p>
<p>
See destroy for more info.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


234
235
236
237
238</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 234</span>

<span class='def def kw'>def</span> <span class='destroy_all identifier id'>destroy_all</span>
  <span class='load_target identifier id'>load_target</span>
  <span class='destroy identifier id'>destroy</span><span class='lparen token'>(</span><span class='@target ivar id'>@target</span><span class='rparen token'>)</span>
  <span class='reset_target! fid id'>reset_target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>empty?</h3>
</div><div id="empty%3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>empty?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Equivalent to <tt>collection.size.zero?</tt>. If the collection has not
been already loaded and you are going to fetch the records anyway it is
better to check <tt>collection.length.zero?</tt>.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


293
294
295</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 293</span>

<span class='def def kw'>def</span> <span class='empty? fid id'>empty?</span>
  <span class='size identifier id'>size</span><span class='dot token'>.</span><span class='zero? fid id'>zero?</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find</h3>
</div><div id="find-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 24</span>

<span class='def def kw'>def</span> <span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span>

  <span class='comment val'># If using a custom finder_sql, scan the entire collection.</span>
  <span class='if if kw'>if</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='finder_sql identifier id'>finder_sql</span><span class='rbrack token'>]</span>
    <span class='expects_array identifier id'>expects_array</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='ids identifier id'>ids</span>           <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='arg identifier id'>arg</span><span class='bitor op'>|</span> <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='rbrace token'>}</span>

    <span class='if if kw'>if</span> <span class='ids identifier id'>ids</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
      <span class='id identifier id'>id</span> <span class='assign token'>=</span> <span class='ids identifier id'>ids</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='record identifier id'>record</span> <span class='assign token'>=</span> <span class='load_target identifier id'>load_target</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span> <span class='id identifier id'>id</span> <span class='eq op'>==</span> <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='id identifier id'>id</span> <span class='rbrace token'>}</span>
      <span class='expects_array identifier id'>expects_array</span> <span class='integer val'>? </span><span class='lbrack token'>[</span> <span class='record identifier id'>record</span> <span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='record identifier id'>record</span>
    <span class='else else kw'>else</span>
      <span class='load_target identifier id'>load_target</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span> <span class='ids identifier id'>ids</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='r identifier id'>r</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='conditions identifier id'>conditions</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{@finder_sql}&quot;</span>
    <span class='if if kw'>if</span> <span class='sanitized_conditions identifier id'>sanitized_conditions</span> <span class='assign token'>=</span> <span class='sanitize_sql identifier id'>sanitize_sql</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='conditions identifier id'>conditions</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='conditions identifier id'>conditions</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot; AND (#{sanitized_conditions})&quot;</span>
    <span class='end end kw'>end</span>
    
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:conditions</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='conditions identifier id'>conditions</span>

    <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='order identifier id'>order</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='order identifier id'>order</span><span class='rbrack token'>]</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{options[:order]}, #{@reflection.options[:order]}&quot;</span>
    <span class='elsif elsif kw'>elsif</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
    
    <span class='comment val'># Build options specific to association</span>
    <span class='construct_find_options! fid id'>construct_find_options!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
    
    <span class='merge_options_from_reflection! fid id'>merge_options_from_reflection!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
    
    <span class='comment val'># Pass through args exactly as we received them.</span>
    <span class='args identifier id'>args</span> <span class='lshft op'>&lt;&lt;</span> <span class='options identifier id'>options</span>
    <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>first</h3>
</div><div id="first-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>first</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches the first one using SQL if possible.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


65
66
67
68
69
70
71
72</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 65</span>

<span class='def def kw'>def</span> <span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='fetch_first_or_last_using_find? fid id'>fetch_first_or_last_using_find?</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    <span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:first</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='load_target identifier id'>load_target</span> <span class='unless unless_mod kw'>unless</span> <span class='loaded? fid id'>loaded?</span>
    <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>include?</h3>
</div><div id="include%3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>include?</span><span class='args'>(record)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


331
332
333
334
335
336</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 331</span>

<span class='def def kw'>def</span> <span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='rparen token'>)</span>
  <span class='load_target identifier id'>load_target</span> <span class='if if_mod kw'>if</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:finder_sql</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='loaded? fid id'>loaded?</span>
  <span class='return return kw'>return</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='loaded? fid id'>loaded?</span>
  <span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>last</h3>
</div><div id="last-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>last</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches the last one using SQL if possible.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


75
76
77
78
79
80
81
82</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 75</span>

<span class='def def kw'>def</span> <span class='last identifier id'>last</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='fetch_first_or_last_using_find? fid id'>fetch_first_or_last_using_find?</span><span class='lparen token'>(</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    <span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:last</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='load_target identifier id'>load_target</span> <span class='unless unless_mod kw'>unless</span> <span class='loaded? fid id'>loaded?</span>
    <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>length</h3>
</div><div id="length-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>length</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the size of the collection calling <tt>size</tt> on the target.
</p>
<p>
If the collection has been already loaded <tt>length</tt> and <tt>size</tt>
are equivalent. If not and you are going to need the records anyway this
method will take one less query. Otherwise <tt>size</tt> is more efficient.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


286
287
288</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 286</span>

<span class='def def kw'>def</span> <span class='length identifier id'>length</span>
  <span class='load_target identifier id'>load_target</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>proxy_respond_to?</h3>
</div><div id="proxy_respond_to%3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>proxy_respond_to?</span><span class='args'>(method, include_private = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


338
339
340</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 338</span>

<span class='def def kw'>def</span> <span class='proxy_respond_to? fid id'>proxy_respond_to?</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='include_private identifier id'>include_private</span> <span class='assign token'>=</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='super super kw'>super</span> <span class='orop op'>||</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='method identifier id'>method</span><span class='comma token'>,</span> <span class='include_private identifier id'>include_private</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>replace</h3>
</div><div id="replace-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>replace</span><span class='args'>(other_array)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Replace this collection with <tt>other_array</tt> This will perform a diff
and delete/add only records that have changed.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


318
319
320
321
322
323
324
325
326
327
328
329</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 318</span>

<span class='def def kw'>def</span> <span class='replace identifier id'>replace</span><span class='lparen token'>(</span><span class='other_array identifier id'>other_array</span><span class='rparen token'>)</span>
  <span class='other_array identifier id'>other_array</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='val identifier id'>val</span><span class='bitor op'>|</span> <span class='raise_on_type_mismatch identifier id'>raise_on_type_mismatch</span><span class='lparen token'>(</span><span class='val identifier id'>val</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>

  <span class='load_target identifier id'>load_target</span>
  <span class='other identifier id'>other</span>   <span class='assign token'>=</span> <span class='other_array identifier id'>other_array</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='integer val'>100</span> <span class='question op'>?</span> <span class='other_array identifier id'>other_array</span> <span class='colon op'>:</span> <span class='other_array identifier id'>other_array</span><span class='dot token'>.</span><span class='to_set identifier id'>to_set</span>
  <span class='current identifier id'>current</span> <span class='assign token'>=</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='integer val'>100</span> <span class='question op'>?</span> <span class='@target ivar id'>@target</span> <span class='colon op'>:</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='to_set identifier id'>to_set</span>

  <span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
    <span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='other identifier id'>other</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='v identifier id'>v</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='concat identifier id'>concat</span><span class='lparen token'>(</span><span class='other_array identifier id'>other_array</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='current identifier id'>current</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='v identifier id'>v</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reset</h3>
</div><div id="reset-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reset</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


93
94
95
96</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 93</span>

<span class='def def kw'>def</span> <span class='reset identifier id'>reset</span>
  <span class='reset_target! fid id'>reset_target!</span>
  <span class='@loaded ivar id'>@loaded</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>size</h3>
</div><div id="size-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>size</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the size of the collection by executing a SELECT COUNT(*) query if
the collection hasn&#8217;t been loaded, and calling
<tt>collection.size</tt> if it has.
</p>
<p>
If the collection has been already loaded <tt>size</tt> and <tt>length</tt>
are equivalent. If not and you are going to need the records anyway
<tt>length</tt> will take one less query. Otherwise <tt>size</tt> is more
efficient.
</p>
<p>
This method is abstract in the sense that it relies on
<tt>count_records</tt>, which is a method descendants have to provide.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


268
269
270
271
272
273
274
275
276
277
278
279</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 268</span>

<span class='def def kw'>def</span> <span class='size identifier id'>size</span>
  <span class='if if kw'>if</span> <span class='@owner ivar id'>@owner</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='loaded? fid id'>loaded?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='uniq identifier id'>uniq</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
  <span class='elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='loaded? fid id'>loaded?</span> <span class='andop op'>&amp;&amp;</span> <span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:group</span><span class='rbrack token'>]</span>
    <span class='load_target identifier id'>load_target</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
  <span class='elsif elsif kw'>elsif</span> <span class='notop op'>!</span><span class='loaded? fid id'>loaded?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@reflection ivar id'>@reflection</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:uniq</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='unsaved_records identifier id'>unsaved_records</span> <span class='assign token'>=</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span> <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span> <span class='rbrace token'>}</span>
    <span class='unsaved_records identifier id'>unsaved_records</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='plus op'>+</span> <span class='count_records identifier id'>count_records</span>
  <span class='else else kw'>else</span>
    <span class='count_records identifier id'>count_records</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sum</h3>
</div><div id="sum-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sum</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Calculate sum using SQL, not Enumerable
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


155
156
157
158
159
160
161</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 155</span>

<span class='def def kw'>def</span> <span class='sum identifier id'>sum</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='calculate identifier id'>calculate</span><span class='lparen token'>(</span><span class='symbol val'>:sum</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='block_args identifier id'>block_args</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='calculate identifier id'>calculate</span><span class='lparen token'>(</span><span class='symbol val'>:sum</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>to_ary</h3>
</div><div id="to_ary-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>to_ary</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


84
85
86
87
88
89
90
91</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 84</span>

<span class='def def kw'>def</span> <span class='to_ary identifier id'>to_ary</span>
  <span class='load_target identifier id'>load_target</span>
  <span class='if if kw'>if</span> <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='@target ivar id'>@target</span><span class='dot token'>.</span><span class='to_ary identifier id'>to_ary</span>
  <span class='else else kw'>else</span>
    <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='@target ivar id'>@target</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>uniq</h3>
</div><div id="uniq-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>uniq</span><span class='args'>(collection = self)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


305
306
307
308
309
310
311
312
313
314</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'activerecord/lib/active_record/associations/association_collection.rb', line 305</span>

<span class='def def kw'>def</span> <span class='uniq identifier id'>uniq</span><span class='lparen token'>(</span><span class='collection identifier id'>collection</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='rparen token'>)</span>
  <span class='seen identifier id'>seen</span> <span class='assign token'>=</span> <span class='Set constant id'>Set</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='collection identifier id'>collection</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='kept identifier id'>kept</span><span class='comma token'>,</span> <span class='record identifier id'>record</span><span class='bitor op'>|</span>
    <span class='unless unless kw'>unless</span> <span class='seen identifier id'>seen</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='record identifier id'>record</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='rparen token'>)</span>
      <span class='kept identifier id'>kept</span> <span class='lshft op'>&lt;&lt;</span> <span class='record identifier id'>record</span>
      <span class='seen identifier id'>seen</span> <span class='lshft op'>&lt;&lt;</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='id identifier id'>id</span>
    <span class='end end kw'>end</span>
    <span class='kept identifier id'>kept</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>