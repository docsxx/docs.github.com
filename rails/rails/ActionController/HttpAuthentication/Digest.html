<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: ActionController::HttpAuthentication::Digest</title>
  </head>
  <body>
    <div id="content">
      <div class="section module ActionController_HttpAuthentication_Digest">
  <h1 class="title">Module: ActionController::HttpAuthentication::Digest</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#authenticate-instance_method' title='#authenticate'>#authenticate</a></span><span class='args'>(controller, realm, &amp;password_procedure)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns false on a valid response, true otherwise.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#authentication_header-instance_method' title='#authentication_header'>#authentication_header</a></span><span class='args'>(controller, realm)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#authentication_request-instance_method' title='#authentication_request'>#authentication_request</a></span><span class='args'>(controller, realm, message = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#authorization-instance_method' title='#authorization'>#authorization</a></span><span class='args'>(request)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#decode_credentials-instance_method' title='#decode_credentials'>#decode_credentials</a></span><span class='args'>(header)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#decode_credentials_header-instance_method' title='#decode_credentials_header'>#decode_credentials_header</a></span><span class='args'>(request)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#encode_credentials-instance_method' title='#encode_credentials'>#encode_credentials</a></span><span class='args'>(http_method, credentials, password, password_is_ha1)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#expected_response-instance_method' title='#expected_response'>#expected_response</a></span><span class='args'>(http_method, uri, credentials, password, password_is_ha1=true)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the expected response for a request of <tt>http_method</tt> to
<tt>uri</tt> with the decoded <tt>credentials</tt> and the expected
<tt>password</tt> Optional parameter +password_is_ha1+ is set to
<tt>true</tt> by default, since best practice is to store ha1 digest
instead of a plain-text password.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#ha1-instance_method' title='#ha1'>#ha1</a></span><span class='args'>(credentials, password)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#nonce-instance_method' title='#nonce'>#nonce</a></span><span class='args'>(time = Time.now)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Uses an MD5 digest based on time to generate a value to be used only once.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#opaque-instance_method' title='#opaque'>#opaque</a></span><span class='args'>()</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Opaque based on random generation - but changing each request?.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#secret_key-instance_method' title='#secret_key'>#secret_key</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Set in /initializers/session_store.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#validate_digest_response-instance_method' title='#validate_digest_response'>#validate_digest_response</a></span><span class='args'>(request, realm, &amp;password_procedure)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Raises error unless the request credentials response value matches the
expected value.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#validate_nonce-instance_method' title='#validate_nonce'>#validate_nonce</a></span><span class='args'>(request, value, seconds_to_timeout=5*60)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Might want a shorter timeout depending on whether the request is a PUT or
POST, and if client is browser or web service.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>authenticate</h3>
</div><div id="authenticate-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authenticate</span><span class='args'>(controller, realm, &amp;password_procedure)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns false on a valid response, true otherwise
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


175
176
177</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 175</span>

<span class='def def kw'>def</span> <span class='authenticate identifier id'>authenticate</span><span class='lparen token'>(</span><span class='controller identifier id'>controller</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='password_procedure identifier id'>password_procedure</span><span class='rparen token'>)</span>
  <span class='authorization identifier id'>authorization</span><span class='lparen token'>(</span><span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='request identifier id'>request</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='validate_digest_response identifier id'>validate_digest_response</span><span class='lparen token'>(</span><span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='password_procedure identifier id'>password_procedure</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>authentication_header</h3>
</div><div id="authentication_header-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authentication_header</span><span class='args'>(controller, realm)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


233
234
235</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 233</span>

<span class='def def kw'>def</span> <span class='authentication_header identifier id'>authentication_header</span><span class='lparen token'>(</span><span class='controller identifier id'>controller</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='rparen token'>)</span>
  <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='headers identifier id'>headers</span><span class='lbrack token'>[</span><span class='string val'>&quot;WWW-Authenticate&quot;</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>%(Digest realm=&quot;#{realm}&quot;, qop=&quot;auth&quot;, algorithm=MD5, nonce=&quot;#{nonce}&quot;, opaque=&quot;#{opaque}&quot;)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>authentication_request</h3>
</div><div id="authentication_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authentication_request</span><span class='args'>(controller, realm, message = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


237
238
239
240
241</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 237</span>

<span class='def def kw'>def</span> <span class='authentication_request identifier id'>authentication_request</span><span class='lparen token'>(</span><span class='controller identifier id'>controller</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='message identifier id'>message</span> <span class='opasgn op'>||=</span> <span class='string val'>&quot;HTTP Digest: Access denied.\n&quot;</span>
  <span class='authentication_header identifier id'>authentication_header</span><span class='lparen token'>(</span><span class='controller identifier id'>controller</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='rparen token'>)</span>
  <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='__send__ identifier id'>__send__</span> <span class='symbol val'>:render</span><span class='comma token'>,</span> <span class='symbol val'>:text</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:unauthorized</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>authorization</h3>
</div><div id="authorization-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authorization</span><span class='args'>(request)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


179
180
181
182
183
184</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 179</span>

<span class='def def kw'>def</span> <span class='authorization identifier id'>authorization</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'HTTP_AUTHORIZATION'</span><span class='rbrack token'>]</span>   <span class='orop op'>||</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'X-HTTP_AUTHORIZATION'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'X_HTTP_AUTHORIZATION'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'REDIRECT_X_HTTP_AUTHORIZATION'</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>decode_credentials</h3>
</div><div id="decode_credentials-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>decode_credentials</span><span class='args'>(header)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


225
226
227
228
229
230
231</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 225</span>

<span class='def def kw'>def</span> <span class='decode_credentials identifier id'>decode_credentials</span><span class='lparen token'>(</span><span class='header identifier id'>header</span><span class='rparen token'>)</span>
  <span class='header identifier id'>header</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/^Digest\s+/</span><span class='comma token'>,</span><span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>','</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='hash identifier id'>hash</span><span class='comma token'>,</span> <span class='pair identifier id'>pair</span><span class='bitor op'>|</span>
    <span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='pair identifier id'>pair</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>'='</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
    <span class='hash identifier id'>hash</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/^&quot;|&quot;$/</span><span class='comma token'>,</span><span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/'/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>
    <span class='hash identifier id'>hash</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>decode_credentials_header</h3>
</div><div id="decode_credentials_header-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>decode_credentials_header</span><span class='args'>(request)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


221
222
223</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 221</span>

<span class='def def kw'>def</span> <span class='decode_credentials_header identifier id'>decode_credentials_header</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='decode_credentials identifier id'>decode_credentials</span><span class='lparen token'>(</span><span class='authorization identifier id'>authorization</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>encode_credentials</h3>
</div><div id="encode_credentials-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>encode_credentials</span><span class='args'>(http_method, credentials, password, password_is_ha1)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


216
217
218
219</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 216</span>

<span class='def def kw'>def</span> <span class='encode_credentials identifier id'>encode_credentials</span><span class='lparen token'>(</span><span class='http_method identifier id'>http_method</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='comma token'>,</span> <span class='password_is_ha1 identifier id'>password_is_ha1</span><span class='rparen token'>)</span>
  <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:response</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='expected_response identifier id'>expected_response</span><span class='lparen token'>(</span><span class='http_method identifier id'>http_method</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:uri</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='comma token'>,</span> <span class='password_is_ha1 identifier id'>password_is_ha1</span><span class='rparen token'>)</span>
  <span class='string val'>&quot;Digest &quot;</span> <span class='plus op'>+</span> <span class='credentials identifier id'>credentials</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='x identifier id'>x</span><span class='bitor op'>|</span> <span class='x identifier id'>x</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{v[0]}='#{v[1]}'&quot;</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>', '</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>expected_response</h3>
</div><div id="expected_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>expected_response</span><span class='args'>(http_method, uri, credentials, password, password_is_ha1=true)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the expected response for a request of <tt>http_method</tt> to
<tt>uri</tt> with the decoded <tt>credentials</tt> and the expected
<tt>password</tt> Optional parameter +password_is_ha1+ is set to
<tt>true</tt> by default, since best practice is to store ha1 digest
instead of a plain-text password.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


206
207
208
209
210</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 206</span>

<span class='def def kw'>def</span> <span class='expected_response identifier id'>expected_response</span><span class='lparen token'>(</span><span class='http_method identifier id'>http_method</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='comma token'>,</span> <span class='password_is_ha1 identifier id'>password_is_ha1</span><span class='assign token'>=</span><span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='ha1 identifier id'>ha1</span> <span class='assign token'>=</span> <span class='password_is_ha1 identifier id'>password_is_ha1</span> <span class='integer val'>? </span><span class='password identifier id'>password</span> <span class='colon op'>:</span> <span class='ha1 identifier id'>ha1</span><span class='lparen token'>(</span><span class='credentials identifier id'>credentials</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='rparen token'>)</span>
  <span class='ha2 identifier id'>ha2</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='http_method identifier id'>http_method</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='upcase identifier id'>upcase</span><span class='comma token'>,</span> <span class='uri identifier id'>uri</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='colon3 op'>::</span><span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='ha1 identifier id'>ha1</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:nonce</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:nc</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:cnonce</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:qop</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='ha2 identifier id'>ha2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ha1</h3>
</div><div id="ha1-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ha1</span><span class='args'>(credentials, password)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


212
213
214</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 212</span>

<span class='def def kw'>def</span> <span class='ha1 identifier id'>ha1</span><span class='lparen token'>(</span><span class='credentials identifier id'>credentials</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='rparen token'>)</span>
  <span class='colon3 op'>::</span><span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:realm</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>':'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>nonce</h3>
</div><div id="nonce-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>nonce</span><span class='args'>(time = Time.now)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Uses an MD5 digest based on time to generate a value to be used only once.
</p>
<p>
A server-specified data string which should be uniquely generated each time
a 401 response is made. It is recommended that this string be base64 or
hexadecimal data. Specifically, since the string is passed in the header
lines as a quoted string, the double-quote character is not allowed.
</p>
<p>
The contents of the nonce are implementation dependent. The quality of the
implementation depends on a good choice. A nonce might, for example, be
constructed as the base 64 encoding of
</p>
<h1>&gt; time-stamp H(time-stamp &quot;:&quot; ETag &quot;:&quot; private-key)</h1>
<p>
where time-stamp is a server-generated time or other non-repeating value,
ETag is the value of the HTTP ETag header associated with the requested
entity, and private-key is data known only to the server. With a nonce of
this form a server would recalculate the hash portion after receiving the
client authentication header and reject the request if it did not match the
nonce from that header or if the time-stamp value is not recent enough. In
this way the server can limit the time of the nonce&#8217;s validity. The
inclusion of the ETag prevents a replay request for an updated version of
the resource. (Note: including the IP address of the client in the nonce
would appear to offer the server the ability to limit the reuse of the
nonce to the same client that originally got it. However, that would break
proxy farms, where requests from a single user often go through different
proxies in the farm. Also, IP address spoofing is not that hard.)
</p>
<p>
An implementation might choose not to accept a previously used nonce or a
previously used digest, in order to protect against a replay attack. Or, an
implementation might choose to use one-time nonces or digests for POST or
PUT requests and a time-stamp for GET requests. For more details on the
issues involved see Section 4 of this document.
</p>
<p>
The nonce is opaque to the client. Composed of Time, and hash of Time with
secret key from the Rails session secret generated upon creation of
project. Ensures the time cannot be modifed by client.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


275
276
277
278
279
280</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 275</span>

<span class='def def kw'>def</span> <span class='nonce identifier id'>nonce</span><span class='lparen token'>(</span><span class='time identifier id'>time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
  <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='time identifier id'>time</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='hashed identifier id'>hashed</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='t identifier id'>t</span><span class='comma token'>,</span> <span class='secret_key identifier id'>secret_key</span><span class='rbrack token'>]</span>
  <span class='digest identifier id'>digest</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='hashed identifier id'>hashed</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='Base64 constant id'>Base64</span><span class='dot token'>.</span><span class='encode64 identifier id'>encode64</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{t}:#{digest}&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='string val'>&quot;\n&quot;</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>opaque</h3>
</div><div id="opaque-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>opaque</span><span class='args'>()</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Opaque based on random generation - but changing each request?
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


293
294
295</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 293</span>

<span class='def def kw'>def</span> <span class='opaque identifier id'>opaque</span><span class='lparen token'>(</span><span class='rparen token'>)</span>
  <span class='colon3 op'>::</span><span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='secret_key identifier id'>secret_key</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>secret_key</h3>
</div><div id="secret_key-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>secret_key</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Set in /initializers/session_store.rb, and loaded even if sessions are not
in use.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


298
299
300</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 298</span>

<span class='def def kw'>def</span> <span class='secret_key identifier id'>secret_key</span>
  <span class='ActionController constant id'>ActionController</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='session_options identifier id'>session_options</span><span class='lbrack token'>[</span><span class='symbol val'>:secret</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validate_digest_response</h3>
</div><div id="validate_digest_response-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validate_digest_response</span><span class='args'>(request, realm, &amp;password_procedure)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Raises error unless the request credentials response value matches the
expected value. First try the password as a ha1 digest password. If this
fails, then try it as a plain text password.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


189
190
191
192
193
194
195
196
197
198
199
200
201</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 189</span>

<span class='def def kw'>def</span> <span class='validate_digest_response identifier id'>validate_digest_response</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='realm identifier id'>realm</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='password_procedure identifier id'>password_procedure</span><span class='rparen token'>)</span>
  <span class='credentials identifier id'>credentials</span> <span class='assign token'>=</span> <span class='decode_credentials_header identifier id'>decode_credentials_header</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='valid_nonce identifier id'>valid_nonce</span> <span class='assign token'>=</span> <span class='validate_nonce identifier id'>validate_nonce</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:nonce</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='valid_nonce identifier id'>valid_nonce</span> <span class='andop op'>&amp;&amp;</span> <span class='realm identifier id'>realm</span> <span class='eq op'>==</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='realm identifier id'>realm</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='opaque identifier id'>opaque</span> <span class='eq op'>==</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='opaque identifier id'>opaque</span><span class='rbrack token'>]</span>
    <span class='password identifier id'>password</span> <span class='assign token'>=</span> <span class='password_procedure identifier id'>password_procedure</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:username</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

   <span class='lbrack token'>[</span><span class='true true kw'>true</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='password_is_ha1 identifier id'>password_is_ha1</span><span class='bitor op'>|</span>
     <span class='expected identifier id'>expected</span> <span class='assign token'>=</span> <span class='expected_response identifier id'>expected_response</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'REQUEST_METHOD'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'REQUEST_URI'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='credentials identifier id'>credentials</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='comma token'>,</span> <span class='password_is_ha1 identifier id'>password_is_ha1</span><span class='rparen token'>)</span>
     <span class='expected identifier id'>expected</span> <span class='eq op'>==</span> <span class='credentials identifier id'>credentials</span><span class='lbrack token'>[</span><span class='symbol val'>:response</span><span class='rbrack token'>]</span>
   <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validate_nonce</h3>
</div><div id="validate_nonce-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validate_nonce</span><span class='args'>(request, value, seconds_to_timeout=5*60)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Might want a shorter timeout depending on whether the request is a PUT or
POST, and if client is browser or web service. Can be much shorter if the
Stale directive is implemented. This would allow a user to use new nonce
without prompting user again for their username and password.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


287
288
289
290</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/base/http_authentication.rb', line 287</span>

<span class='def def kw'>def</span> <span class='validate_nonce identifier id'>validate_nonce</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='comma token'>,</span> <span class='seconds_to_timeout identifier id'>seconds_to_timeout</span><span class='assign token'>=</span><span class='integer val'>5</span><span class='mult op'>*</span><span class='integer val'>60</span><span class='rparen token'>)</span>
  <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='Base64 constant id'>Base64</span><span class='dot token'>.</span><span class='decode64 identifier id'>decode64</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;:&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='nonce identifier id'>nonce</span><span class='lparen token'>(</span><span class='t identifier id'>t</span><span class='rparen token'>)</span> <span class='eq op'>==</span> <span class='value identifier id'>value</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='t identifier id'>t</span> <span class='minus op'>-</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='abs identifier id'>abs</span> <span class='leq op'>&lt;=</span> <span class='seconds_to_timeout identifier id'>seconds_to_timeout</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>