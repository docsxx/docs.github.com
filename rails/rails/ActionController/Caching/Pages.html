<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: ActionController::Caching::Pages</title>
  </head>
  <body>
    <div id="content">
      <div class="section module ActionController_Caching_Pages">
  <h1 class="title">Module: ActionController::Caching::Pages</h1>
  <div class="section docstring">
  <p>
Page caching is an approach to caching where the entire action output of is
stored as a HTML file that the web server can serve without going through
Action Pack. This is the fastest way to cache your content as opposed to
going dynamically through the process of generating the content.
Unfortunately, this incredible speed-up is only available to stateless
pages where all visitors are treated the same. Content management systems
&#8212; including weblogs and wikis &#8212; have many pages that are a
great fit for this approach, but account-based systems where people log in
and manipulate their own data are often less likely candidates.
</p>
<p>
Specifying which actions to cache is done through the <tt>caches_page</tt>
class method:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='WeblogController constant id'>WeblogController</span> <span class='lt op'>&lt;</span> <span class='ActionController constant id'>ActionController</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='caches_page identifier id'>caches_page</span> <span class='symbol val'>:show</span><span class='comma token'>,</span> <span class='symbol val'>:new</span>
  <span class='end end kw'>end</span>
</pre>
<p>
This will generate cache files such as <tt>weblog/show/5.html</tt> and
<tt>weblog/new.html</tt>, which match the URLs used to trigger the dynamic
generation. This is how the web server is able pick up a cache file when it
exists and otherwise let the request pass on to Action Pack to generate it.
</p>
<p>
Expiration of the cache is handled by deleting the cached file, which
results in a lazy regeneration approach where the cache is not restored
before another hit is made against it. The API for doing so mimics the
options from <tt>url_for</tt> and friends:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='WeblogController constant id'>WeblogController</span> <span class='lt op'>&lt;</span> <span class='ActionController constant id'>ActionController</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='def def kw'>def</span> <span class='update identifier id'>update</span>
      <span class='List constant id'>List</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:list</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:list</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='expire_page identifier id'>expire_page</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;show&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:list</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span>
      <span class='redirect_to identifier id'>redirect_to</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;show&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:list</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Additionally, you can expire caches using Sweepers that act on changes in
the model to determine when a cache is supposed to be expired.
</p>

</div><div class="section constants">
  
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <h1>Public Class Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#included-class_method' title='included'>included</a></span><span class='args'>(base)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#cache_page-instance_method' title='#cache_page'>#cache_page</a></span><span class='args'>(content = nil, options = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Manually cache the <tt>content</tt> in the key determined by
<tt>options</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#expire_page-instance_method' title='#expire_page'>#expire_page</a></span><span class='args'>(options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Expires the page that was cached with the <tt>options</tt> as a key.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails class public">
  <h1>Public Class Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>included</h3>
</div><div id="included-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>included</span><span class='args'>(base)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/caching/pages.rb', line 37</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='included identifier id'>included</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span> <span class='comment val'>#:nodoc:</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span><span class='lparen token'>(</span><span class='ClassMethods constant id'>ClassMethods</span><span class='rparen token'>)</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='class_eval identifier id'>class_eval</span> <span class='do do kw'>do</span>
    <span class='@@page_cache_directory ivar id'>@@page_cache_directory</span> <span class='assign token'>=</span> <span class='defined? defined kw'>defined?</span><span class='lparen token'>(</span><span class='Rails constant id'>Rails</span><span class='dot token'>.</span><span class='public_path identifier id'>public_path</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='Rails constant id'>Rails</span><span class='dot token'>.</span><span class='public_path identifier id'>public_path</span> <span class='colon op'>:</span> <span class='string val'>&quot;&quot;</span>
    <span class='comment val'>##</span>
    <span class='comment val'># :singleton-method:</span>
    <span class='comment val'># The cache directory should be the document root for the web server and is set using &lt;tt&gt;Base.page_cache_directory = &quot;/document/root&quot;&lt;/tt&gt;.</span>
    <span class='comment val'># For Rails, this directory has already been set to Rails.public_path (which is usually set to &lt;tt&gt;RAILS_ROOT + &quot;/public&quot;&lt;/tt&gt;). Changing</span>
    <span class='comment val'># this setting can be useful to avoid naming conflicts with files in &lt;tt&gt;public/&lt;/tt&gt;, but doing so will likely require configuring your</span>
    <span class='comment val'># web server to look in the new location for cached files.</span>
    <span class='cattr_accessor identifier id'>cattr_accessor</span> <span class='symbol val'>:page_cache_directory</span>

    <span class='@@page_cache_extension ivar id'>@@page_cache_extension</span> <span class='assign token'>=</span> <span class='string val'>'.html'</span>
    <span class='comment val'>##</span>
    <span class='comment val'># :singleton-method:</span>
    <span class='comment val'># Most Rails requests do not have an extension, such as &lt;tt&gt;/weblog/new&lt;/tt&gt;. In these cases, the page caching mechanism will add one in</span>
    <span class='comment val'># order to make it easy for the cached files to be picked up properly by the web server. By default, this cache extension is &lt;tt&gt;.html&lt;/tt&gt;.</span>
    <span class='comment val'># If you want something else, like &lt;tt&gt;.php&lt;/tt&gt; or &lt;tt&gt;.shtml&lt;/tt&gt;, just set Base.page_cache_extension. In cases where a request already has an</span>
    <span class='comment val'># extension, such as &lt;tt&gt;.xml&lt;/tt&gt; or &lt;tt&gt;.rss&lt;/tt&gt;, page caching will not add an extension. This allows it to work well with RESTful apps.</span>
    <span class='cattr_accessor identifier id'>cattr_accessor</span> <span class='symbol val'>:page_cache_extension</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div><div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>cache_page</h3>
</div><div id="cache_page-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cache_page</span><span class='args'>(content = nil, options = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Manually cache the <tt>content</tt> in the key determined by
<tt>options</tt>. If no content is provided, the contents of response.body
is used If no options are provided, the requested url is used. Example:
</p>
<pre class="code">
  <span class='cache_page identifier id'>cache_page</span> <span class='string val'>&quot;I'm the cached content&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;lists&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;show&quot;</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/caching/pages.rb', line 131</span>

<span class='def def kw'>def</span> <span class='cache_page identifier id'>cache_page</span><span class='lparen token'>(</span><span class='content identifier id'>content</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='perform_caching identifier id'>perform_caching</span> <span class='andop op'>&amp;&amp;</span> <span class='caching_allowed identifier id'>caching_allowed</span>

  <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='options identifier id'>options</span>
    <span class='when when kw'>when</span> <span class='Hash constant id'>Hash</span>
      <span class='url_for identifier id'>url_for</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:only_path</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:skip_relative_url_root</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:format</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:format</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span>
      <span class='options identifier id'>options</span>
    <span class='else else kw'>else</span>
      <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
  <span class='end end kw'>end</span>

  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='cache_page identifier id'>cache_page</span><span class='lparen token'>(</span><span class='content identifier id'>content</span> <span class='orop op'>||</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='body identifier id'>body</span><span class='comma token'>,</span> <span class='path identifier id'>path</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>expire_page</h3>
</div><div id="expire_page-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>expire_page</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Expires the page that was cached with the <tt>options</tt> as a key.
Example:
</p>
<pre class="code">
  <span class='expire_page identifier id'>expire_page</span> <span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;lists&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;show&quot;</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


112
113
114
115
116
117
118
119
120
121
122
123
124
125
126</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'actionpack/lib/action_controller/caching/pages.rb', line 112</span>

<span class='def def kw'>def</span> <span class='expire_page identifier id'>expire_page</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='perform_caching identifier id'>perform_caching</span>

  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='action identifier id'>action</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:action</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='action identifier id'>action</span><span class='bitor op'>|</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='expire_page identifier id'>expire_page</span><span class='lparen token'>(</span><span class='url_for identifier id'>url_for</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:only_path</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:skip_relative_url_root</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='action identifier id'>action</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='expire_page identifier id'>expire_page</span><span class='lparen token'>(</span><span class='url_for identifier id'>url_for</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:only_path</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:skip_relative_url_root</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='expire_page identifier id'>expire_page</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>