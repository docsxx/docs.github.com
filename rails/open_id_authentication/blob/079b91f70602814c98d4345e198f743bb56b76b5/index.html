<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>rails's open_id_authentication - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/rails/commits/open_id_authentication/master" rel="alternate" title="Recent Commits to open_id_authentication:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("rails", "open_id_authentication", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='rails/open_id_authentication/blob/079b91f70602814c98d4345e198f743bb56b76b5' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='rails/open_id_authentication/blob/079b91f70602814c98d4345e198f743bb56b76b5' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("rails", "open_id_authentication", "079b91f70602814c98d4345e198f743bb56b76b5", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/rails/open_id_authentication/tree/">Source</a></li>
            <li class=""><a href="http://github.com/rails/open_id_authentication/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/rails/open_id_authentication/network">Network</a></li>            
            <li class=""><a href="http://github.com/rails/open_id_authentication/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/rails/open_id_authentication">Wiki</a></li>
            <li class=""><a href="http://github.com/rails/open_id_authentication/graphs">Graphs</a></li>                    
            <li class="active"><a href="/rails/open_id_authentication">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/rails">rails</a> / <b><a href="http://github.com/rails/open_id_authentication/tree">open_id_authentication</a></b>        
                <a id="namespaces_button" rel="rails/open_id_authentication/blob/079b91f70602814c98d4345e198f743bb56b76b5" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="rails/open_id_authentication/blob/079b91f70602814c98d4345e198f743bb56b76b5" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
OpenIdAuthentication
</p>
<h6>==============</h6>
<p>
Provides a thin wrapper around the excellent ruby-openid gem from JanRan.
Be sure to install that first:
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='ruby identifier id'>ruby</span><span class='minus op'>-</span><span class='openid identifier id'>openid</span>
</pre>
<p>
To understand what OpenID is about and how it works, it helps to read the
documentation for lib/openid/consumer.rb from that gem.
</p>
<p>
The specification used is
http://openid.net/specs/openid-authentication-2_0.html.
</p>
<p>
Prerequisites
</p>
<h6>=======</h6>
<p>
OpenID authentication uses the session, so be sure that you haven&#8217;t
turned that off. It also relies on a number of database tables to store the
authentication keys. So you&#8217;ll have to run the migration to create
these before you get started:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='open_id_authentication identifier id'>open_id_authentication</span><span class='symbol val'>:db</span><span class='symbol val'>:create</span>
</pre>
<p>
Or, use the included generators to install or upgrade:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='open_id_authentication_tables identifier id'>open_id_authentication_tables</span> <span class='MigrationName constant id'>MigrationName</span>
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='upgrade_open_id_authentication_tables identifier id'>upgrade_open_id_authentication_tables</span> <span class='MigrationName constant id'>MigrationName</span>
</pre>
<p>
Alternatively, you can use the file-based store, which just relies on on
tmp/openids being present in RAILS_ROOT. But be aware that this store only
works if you have a single application server. And it&#8217;s not safe to
use across NFS. It&#8217;s recommended that you use the database store if
at all possible. To use the file-based store, you&#8217;ll also have to add
this line to your config/environment.rb:
</p>
<pre class="code">
  <span class='OpenIdAuthentication constant id'>OpenIdAuthentication</span><span class='dot token'>.</span><span class='store identifier id'>store</span> <span class='assign token'>=</span> <span class='symbol val'>:file</span>
</pre>
<p>
This particular plugin also relies on the fact that the authentication
action allows for both POST and GET operations. If you&#8217;re using
RESTful authentication, you&#8217;ll need to explicitly allow for this in
your routes.rb.
</p>
<p>
The plugin also expects to find a root_url method that points to the home
page of your site. You can accomplish this by using a root route in
config/routes.rb:
</p>
<pre class="code">
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='root identifier id'>root</span> <span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'articles'</span>
</pre>
<p>
This plugin relies on Rails Edge revision 6317 or newer.
</p>
<p>
Example
</p>
<h6>=</h6>
<p>
This example is just to meant to demonstrate how you could use OpenID
authentication. You might well want to add salted hash logins instead of
plain text passwords and other requirements on top of this. Treat it as a
starting point, not a destination.
</p>
<p>
Note that the User model referenced in the simple example below has an
&#8216;identity_url&#8217; attribute. You will want to add the same or
similar field to whatever model you are using for authentication.
</p>
<p>
Also of note is the following code block used in the example below:
</p>
<pre class="code">
  <span class='authenticate_with_open_id identifier id'>authenticate_with_open_id</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='identity_url identifier id'>identity_url</span><span class='bitor op'>|</span>
    <span class='dot3 op'>...</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In the above code block, &#8216;identity_url&#8217; will need to match
user.identity_url exactly. &#8216;identity_url&#8217; will be a string in
the form of &#8216;http://example.com&#8217; - If you are storing just
&#8216;example.com&#8217; with your user, the lookup will fail.
</p>
<p>
There is a handy method in this plugin called &#8216;normalize_url&#8217;
that will help with validating OpenID URLs.
</p>
<pre class="code">
  <span class='OpenIdAuthentication constant id'>OpenIdAuthentication</span><span class='dot token'>.</span><span class='normalize_url identifier id'>normalize_url</span><span class='lparen token'>(</span><span class='user identifier id'>user</span><span class='dot token'>.</span><span class='identity_url identifier id'>identity_url</span><span class='rparen token'>)</span>
</pre>
<p>
The above will return a standardized version of the OpenID URL - the above
called with &#8216;example.com&#8217; will return
&#8216;http://example.com/&#8217; It will also raise an InvalidOpenId
exception if the URL is determined to not be valid. Use the above code in
your User model and validate OpenID URLs before saving them.
</p>
<p>
config/routes.rb
</p>
<pre class="code">
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='root identifier id'>root</span> <span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'articles'</span>
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='resource identifier id'>resource</span> <span class='symbol val'>:session</span>
</pre>
<p>
app/views/sessions/new.erb
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>% form_tag(session_url) </span><span class='do do kw'>do</span> <span class='string val'>%&gt;
    &lt;p&gt;</span>
      <span class='lt op'>&lt;</span><span class='label identifier id'>label</span> <span class='for for kw'>for</span><span class='assign token'>=</span><span class='string val'>&quot;name&quot;</span><span class='gt op'>&gt;</span><span class='Username constant id'>Username</span><span class='colon op'>:</span><span class='lt op'>&lt;</span><span class='regexp val'>/label&gt;
      &lt;%= text_field_tag &quot;name&quot; %&gt;
    &lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='label identifier id'>label</span> <span class='for for kw'>for</span><span class='assign token'>=</span><span class='string val'>&quot;password&quot;</span><span class='gt op'>&gt;</span><span class='Password constant id'>Password</span><span class='colon op'>:</span><span class='lt op'>&lt;</span><span class='regexp val'>/label&gt;
      &lt;%= password_field_tag %&gt;
    &lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
      <span class='dot3 op'>...</span><span class='or or kw'>or</span> <span class='use identifier id'>use</span><span class='colon op'>:</span>
    <span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;

    &lt;p&gt;
      &lt;label for=&quot;openid_identifier&quot;&gt;OpenID:&lt;/</span><span class='label identifier id'>label</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='string val'>%= text_field_tag &quot;openid_identifier&quot; %&gt;
    &lt;/p&gt;

    &lt;p&gt;
      &lt;%=</span> <span class='submit_tag identifier id'>submit_tag</span> <span class='string val'>'Sign in'</span><span class='comma token'>,</span> <span class='symbol val'>:disable_with</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Signing in&amp;hellip;&quot;</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;
  &lt;% end %&gt;
</span></pre>
<p>
app/controllers/sessions_controller.rb
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='SessionsController constant id'>SessionsController</span> <span class='lt op'>&lt;</span> <span class='ApplicationController constant id'>ApplicationController</span>
    <span class='def def kw'>def</span> <span class='create identifier id'>create</span>
      <span class='if if kw'>if</span> <span class='using_open_id? fid id'>using_open_id?</span>
        <span class='open_id_authentication identifier id'>open_id_authentication</span>
      <span class='else else kw'>else</span>
        <span class='password_authentication identifier id'>password_authentication</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='protected identifier id'>protected</span>
      <span class='def def kw'>def</span> <span class='password_authentication identifier id'>password_authentication</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='@current_user ivar id'>@current_user</span> <span class='assign token'>=</span> <span class='@account ivar id'>@account</span><span class='dot token'>.</span><span class='users identifier id'>users</span><span class='dot token'>.</span><span class='authenticate identifier id'>authenticate</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
          <span class='successful_login identifier id'>successful_login</span>
        <span class='else else kw'>else</span>
          <span class='failed_login identifier id'>failed_login</span> <span class='string val'>&quot;Sorry, that username/password doesn't work&quot;</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='def def kw'>def</span> <span class='open_id_authentication identifier id'>open_id_authentication</span>
        <span class='authenticate_with_open_id identifier id'>authenticate_with_open_id</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='identity_url identifier id'>identity_url</span><span class='bitor op'>|</span>
          <span class='if if kw'>if</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='successful? fid id'>successful?</span>
            <span class='if if kw'>if</span> <span class='@current_user ivar id'>@current_user</span> <span class='assign token'>=</span> <span class='@account ivar id'>@account</span><span class='dot token'>.</span><span class='users identifier id'>users</span><span class='dot token'>.</span><span class='find_by_identity_url identifier id'>find_by_identity_url</span><span class='lparen token'>(</span><span class='identity_url identifier id'>identity_url</span><span class='rparen token'>)</span>
              <span class='successful_login identifier id'>successful_login</span>
            <span class='else else kw'>else</span>
              <span class='failed_login identifier id'>failed_login</span> <span class='dstring node'>&quot;Sorry, no user by that identity URL exists (#{identity_url})&quot;</span>
            <span class='end end kw'>end</span>
          <span class='else else kw'>else</span>
            <span class='failed_login identifier id'>failed_login</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

    <span class='private identifier id'>private</span>
      <span class='def def kw'>def</span> <span class='successful_login identifier id'>successful_login</span>
        <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:user_id</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='@current_user ivar id'>@current_user</span><span class='dot token'>.</span><span class='id identifier id'>id</span>
        <span class='redirect_to identifier id'>redirect_to</span><span class='lparen token'>(</span><span class='root_url identifier id'>root_url</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='def def kw'>def</span> <span class='failed_login identifier id'>failed_login</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
        <span class='flash identifier id'>flash</span><span class='lbrack token'>[</span><span class='symbol val'>:error</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='message identifier id'>message</span>
        <span class='redirect_to identifier id'>redirect_to</span><span class='lparen token'>(</span><span class='new_session_url identifier id'>new_session_url</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
If you&#8217;re fine with the result messages above and don&#8217;t need
individual logic on a per-failure basis, you can collapse the case into a
mere boolean:
</p>
<pre class="code">
    <span class='def def kw'>def</span> <span class='open_id_authentication identifier id'>open_id_authentication</span>
      <span class='authenticate_with_open_id identifier id'>authenticate_with_open_id</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='identity_url identifier id'>identity_url</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='successful? fid id'>successful?</span> <span class='andop op'>&amp;&amp;</span> <span class='@current_user ivar id'>@current_user</span> <span class='assign token'>=</span> <span class='@account ivar id'>@account</span><span class='dot token'>.</span><span class='users identifier id'>users</span><span class='dot token'>.</span><span class='find_by_identity_url identifier id'>find_by_identity_url</span><span class='lparen token'>(</span><span class='identity_url identifier id'>identity_url</span><span class='rparen token'>)</span>
          <span class='successful_login identifier id'>successful_login</span>
        <span class='else else kw'>else</span>
          <span class='failed_login identifier id'>failed_login</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='dot token'>.</span><span class='message identifier id'>message</span> <span class='orop op'>||</span> <span class='dstring node'>&quot;Sorry, no user by that identity URL exists (#{identity_url})&quot;</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
</pre>
<p>
Simple Registration OpenID Extension
</p>
<h6>==============================</h6>
<p>
Some OpenID Providers support this lightweight profile exchange protocol.
See more: http://www.openidenabled.com/openid/simple-registration-extension
</p>
<p>
You can support it in your app by changing #open_id_authentication
</p>
<pre class="code">
      <span class='def def kw'>def</span> <span class='open_id_authentication identifier id'>open_id_authentication</span><span class='lparen token'>(</span><span class='identity_url identifier id'>identity_url</span><span class='rparen token'>)</span>
        <span class='comment val'># Pass optional :required and :optional keys to specify what sreg fields you want.</span>
        <span class='comment val'># Be sure to yield registration, a third argument in the #authenticate_with_open_id block.</span>
        <span class='authenticate_with_open_id identifier id'>authenticate_with_open_id</span><span class='lparen token'>(</span><span class='identity_url identifier id'>identity_url</span><span class='comma token'>,</span>
            <span class='symbol val'>:required</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:nickname</span><span class='comma token'>,</span> <span class='symbol val'>:email</span> <span class='rbrack token'>]</span><span class='comma token'>,</span>
            <span class='symbol val'>:optional</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:fullname</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='identity_url identifier id'>identity_url</span><span class='comma token'>,</span> <span class='registration identifier id'>registration</span><span class='bitor op'>|</span>
          <span class='case case kw'>case</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='status identifier id'>status</span>
          <span class='when when kw'>when</span> <span class='symbol val'>:missing</span>
            <span class='failed_login identifier id'>failed_login</span> <span class='string val'>&quot;Sorry, the OpenID server couldn't be found&quot;</span>
          <span class='when when kw'>when</span> <span class='symbol val'>:invalid</span>
            <span class='failed_login identifier id'>failed_login</span> <span class='string val'>&quot;Sorry, but this does not appear to be a valid OpenID&quot;</span>
          <span class='when when kw'>when</span> <span class='symbol val'>:canceled</span>
            <span class='failed_login identifier id'>failed_login</span> <span class='string val'>&quot;OpenID verification was canceled&quot;</span>
          <span class='when when kw'>when</span> <span class='symbol val'>:failed</span>
            <span class='failed_login identifier id'>failed_login</span> <span class='string val'>&quot;Sorry, the OpenID verification failed&quot;</span>
          <span class='when when kw'>when</span> <span class='symbol val'>:successful</span>
            <span class='if if kw'>if</span> <span class='@current_user ivar id'>@current_user</span> <span class='assign token'>=</span> <span class='@account ivar id'>@account</span><span class='dot token'>.</span><span class='users identifier id'>users</span><span class='dot token'>.</span><span class='find_by_identity_url identifier id'>find_by_identity_url</span><span class='lparen token'>(</span><span class='identity_url identifier id'>identity_url</span><span class='rparen token'>)</span>
              <span class='assign_registration_attributes! fid id'>assign_registration_attributes!</span><span class='lparen token'>(</span><span class='registration identifier id'>registration</span><span class='rparen token'>)</span>

              <span class='if if kw'>if</span> <span class='current_user identifier id'>current_user</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
                <span class='successful_login identifier id'>successful_login</span>
              <span class='else else kw'>else</span>
                <span class='failed_login identifier id'>failed_login</span> <span class='string val'>&quot;Your OpenID profile registration failed: &quot;</span> <span class='plus op'>+</span>
                  <span class='@current_user ivar id'>@current_user</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='full_messages identifier id'>full_messages</span><span class='dot token'>.</span><span class='to_sentence identifier id'>to_sentence</span>
              <span class='end end kw'>end</span>
            <span class='else else kw'>else</span>
              <span class='failed_login identifier id'>failed_login</span> <span class='string val'>&quot;Sorry, no user by that identity URL exists&quot;</span>
            <span class='end end kw'>end</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># registration is a hash containing the valid sreg keys given above</span>
      <span class='comment val'># use this to map them to fields of your user model</span>
      <span class='def def kw'>def</span> <span class='assign_registration_attributes! fid id'>assign_registration_attributes!</span><span class='lparen token'>(</span><span class='registration identifier id'>registration</span><span class='rparen token'>)</span>
        <span class='model_to_registration_mapping identifier id'>model_to_registration_mapping</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='model_attribute identifier id'>model_attribute</span><span class='comma token'>,</span> <span class='registration_attribute identifier id'>registration_attribute</span><span class='bitor op'>|</span>
          <span class='unless unless kw'>unless</span> <span class='registration identifier id'>registration</span><span class='lbrack token'>[</span><span class='registration_attribute identifier id'>registration_attribute</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
            <span class='@current_user ivar id'>@current_user</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{model_attribute}=&quot;</span><span class='comma token'>,</span> <span class='registration identifier id'>registration</span><span class='lbrack token'>[</span><span class='registration_attribute identifier id'>registration_attribute</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>

      <span class='def def kw'>def</span> <span class='model_to_registration_mapping identifier id'>model_to_registration_mapping</span>
        <span class='lbrace token'>{</span> <span class='symbol val'>:login</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'nickname'</span><span class='comma token'>,</span> <span class='symbol val'>:email</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'email'</span><span class='comma token'>,</span> <span class='symbol val'>:display_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'fullname'</span> <span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>
</pre>
<p>
Attribute Exchange OpenID Extension
</p>
<h6>=============================</h6>
<p>
Some OpenID providers also support the OpenID AX (attribute exchange)
protocol for exchanging identity information between endpoints. See more:
http://openid.net/specs/openid-attribute-exchange-1_0.html
</p>
<p>
Accessing AX data is very similar to the Simple Registration process,
described above &#8212; just add the URI identifier for the AX field to
your :optional or :required parameters. For example:
</p>
<pre class="code">
        <span class='authenticate_with_open_id identifier id'>authenticate_with_open_id</span><span class='lparen token'>(</span><span class='identity_url identifier id'>identity_url</span><span class='comma token'>,</span>
            <span class='symbol val'>:required</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:email</span><span class='comma token'>,</span> <span class='string val'>'http://schema.openid.net/birthDate'</span> <span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='identity_url identifier id'>identity_url</span><span class='comma token'>,</span> <span class='registration identifier id'>registration</span><span class='bitor op'>|</span>
</pre>
<p>
This would provide the sreg data for :email, and the AX data for
&#8216;http://schema.openid.net/birthDate&#8217;
</p>
<p>
Copyright &#169; 2007 David Heinemeier Hansson, released under the MIT
license
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>