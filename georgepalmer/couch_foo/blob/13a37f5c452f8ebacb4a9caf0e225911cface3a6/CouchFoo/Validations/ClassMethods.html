<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>georgepalmer's couch_foo - Module: CouchFoo::Validations::ClassMethods - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/georgepalmer/commits/couch_foo/master" rel="alternate" title="Recent Commits to couch_foo:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("georgepalmer", "couch_foo", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("georgepalmer", "couch_foo", "13a37f5c452f8ebacb4a9caf0e225911cface3a6", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/georgepalmer/couch_foo/tree/">Source</a></li>
            <li class=""><a href="http://github.com/georgepalmer/couch_foo/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/georgepalmer/couch_foo/network">Network</a></li>            
            <li class=""><a href="http://github.com/georgepalmer/couch_foo/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/georgepalmer/couch_foo">Wiki</a></li>
            <li class=""><a href="http://github.com/georgepalmer/couch_foo/graphs">Graphs</a></li>                    
            <li class="active"><a href="/georgepalmer/couch_foo">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/georgepalmer">georgepalmer</a> / <b><a href="http://github.com/georgepalmer/couch_foo/tree">couch_foo</a></b>        
                <a id="namespaces_button" rel="georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module CouchFoo_Validations_ClassMethods">
  <h1>Module: CouchFoo::Validations::ClassMethods</h1>
  <div class="section docstring">
  <p>
All of the following validations are defined in the class scope of the
model that you&#8217;re interested in validating. They offer a more
declarative way of specifying when the model is valid and when it is not.
It is recommended to use these over the low-level calls to
<tt>validate</tt> and <tt>validate_on_create</tt> when possible.
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="ALL_NUMERICALITY_CHECKS-constant">ALL_NUMERICALITY_CHECKS</dt>
      <dd>{ :greater_than =&gt; '&gt;', :greater_than_or_equal_to =&gt; '&gt;=',
:equal_to =&gt; '==', :less_than =&gt; '&lt;', :less_than_or_equal_to =&gt; '&lt;=',
:odd =&gt; 'odd?', :even =&gt; 'even?' }.freeze</dd>
    
      <dt id="ALL_RANGE_OPTIONS-constant">ALL_RANGE_OPTIONS</dt>
      <dd>[ :is, :within, :in, :minimum, :maximum ].freeze</dd>
    
      <dt id="DEFAULT_VALIDATION_OPTIONS-constant">DEFAULT_VALIDATION_OPTIONS</dt>
      <dd>{
  :on =&gt; :save,
  :allow_nil =&gt; false,
  :allow_blank =&gt; false,
  :message =&gt; nil
}.freeze</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create-21-instance_method">#create!</span><span class='args'>(attributes = nil, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates an object just like Base.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_acceptance_of-instance_method">#validates_acceptance_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Encapsulates the pattern of wanting to validate the acceptance of a terms
of service check box (or similar agreement).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_associated-instance_method">#validates_associated</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Validates whether the associated object or objects are all valid
themselves.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_confirmation_of-instance_method">#validates_confirmation_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Encapsulates the pattern of wanting to validate a password or email address
field with a confirmation.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_each-instance_method">#validates_each</span><span class='args'>(*attrs)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds a validation method or block to the class.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_exclusion_of-instance_method">#validates_exclusion_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Validates that the value of the specified attribute is not in a particular
enumerable object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_format_of-instance_method">#validates_format_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Validates whether the value of the specified attribute is of the correct
form by matching it against the regular expression provided.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_inclusion_of-instance_method">#validates_inclusion_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Validates whether the value of the specified attribute is available in a
particular enumerable object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_length_of-instance_method">#validates_length_of</span><span class='args'>(*attrs)</span>
        <span class='block'></span>
        
          <span class='alias'>#validates_size_of</span>
        
      </th>
      <td class="docstring">
        <p>
Validates that the specified attribute matches the length restrictions
supplied.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_numericality_of-instance_method">#validates_numericality_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Validates whether the value of the specified attribute is numeric by trying
to convert it to a float with Kernel.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_presence_of-instance_method">#validates_presence_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Validates that the specified attributes are not blank (as defined by
Object#blank?).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validates_uniqueness_of-instance_method">#validates_uniqueness_of</span><span class='args'>(*attr_names)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Validates whether the value of the specified attributes are unique across
the system.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>create!</h3>
</div><div id="create-21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create!</span><span class='args'>(attributes = nil, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates an object just like Base.create but calls save! instead of save so
an exception is raised if the record is invalid.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 842</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L842">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">842
843
844
845
846
847
848
849
850
851</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create! fid id'>create!</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span> <span class='create! fid id'>create!</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='object identifier id'>object</span> <span class='assign token'>=</span> <span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span><span class='rparen token'>)</span>
    <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='object identifier id'>object</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='object identifier id'>object</span><span class='dot token'>.</span><span class='save! fid id'>save!</span>
    <span class='object identifier id'>object</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_acceptance_of</h3>
</div><div id="validates_acceptance_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_acceptance_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Encapsulates the pattern of wanting to validate the acceptance of a terms
of service check box (or similar agreement). Example:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_acceptance_of identifier id'>validates_acceptance_of</span> <span class='symbol val'>:terms_of_service</span>
    <span class='validates_acceptance_of identifier id'>validates_acceptance_of</span> <span class='symbol val'>:eula</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;must be abided&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
If the database property does not exist, the <tt>terms_of_service</tt>
attribute is entirely virtual. This check is performed only if
<tt>terms_of_service</tt> is not <tt>nil</tt> and by default on save.
</p>
<p>
Configuration options:
</p>
<ul>
<li><tt>:message</tt> - A custom error message (default is: &quot;must be
accepted&quot;).

</li>
<li><tt>:on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>:allow_nil</tt> - Skip validation if attribute is <tt>nil</tt> (default
is true).

</li>
<li><tt>:accept</tt> - Specifies value that is considered accepted. The default
value is a string &quot;1&quot;, which makes it easy to relate to an HTML
checkbox. This should be set to <tt>true</tt> if you are validating a
database property, since the attribute is typecast from &quot;1&quot; to
<tt>true</tt> before validation.

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 435</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L435">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">435
436
437
438
439
440
441
442
443
444
445</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_acceptance_of identifier id'>validates_acceptance_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:accepted</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span><span class='comma token'>,</span> <span class='symbol val'>:allow_nil</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:accept</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;1&quot;</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='names identifier id'>names</span> <span class='assign token'>=</span> <span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='reject identifier id'>reject</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='bitor op'>|</span> <span class='property_names identifier id'>property_names</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='attr_accessor identifier id'>attr_accessor</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='names identifier id'>names</span><span class='rparen token'>)</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span><span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='value identifier id'>value</span> <span class='eq op'>==</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:accept</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_associated</h3>
</div><div id="validates_associated-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_associated</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Validates whether the associated object or objects are all valid
themselves. Works with any kind of association.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Book constant id'>Book</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:pages</span>
    <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:library</span>

    <span class='validates_associated identifier id'>validates_associated</span> <span class='symbol val'>:pages</span><span class='comma token'>,</span> <span class='symbol val'>:library</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Warning: If, after the above definition, you then wrote:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Page constant id'>Page</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:book</span>

    <span class='validates_associated identifier id'>validates_associated</span> <span class='symbol val'>:book</span>
  <span class='end end kw'>end</span>
</pre>
<p>
this would specify a circular dependency and cause infinite recursion.
</p>
<p>
NOTE: This validation will not fail if the association hasn&#8217;t been
assigned. If you want to ensure that the association is both present and
guaranteed to be valid, you also need to use
<tt>validates_presence_of</tt>.
</p>
<p>
Configuration options:
</p>
<ul>
<li><tt>:message</tt> - A custom error message (default is: &quot;is
invalid&quot;)

</li>
<li><tt>:on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 760</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L760">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">760
761
762
763
764
765
766
767
768</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_associated identifier id'>validates_associated</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:invalid</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span>
      <span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='value identifier id'>value</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span><span class='value identifier id'>value</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='true true kw'>true</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='v identifier id'>v</span><span class='comma token'>,</span> <span class='r identifier id'>r</span><span class='bitor op'>|</span> <span class='lparen token'>(</span><span class='r identifier id'>r</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='orop op'>||</span> <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='valid? fid id'>valid?</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='v identifier id'>v</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_confirmation_of</h3>
</div><div id="validates_confirmation_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_confirmation_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Encapsulates the pattern of wanting to validate a password or email address
field with a confirmation. Example:
</p>
<pre class="code">
  <span class='Model constant id'>Model</span><span class='colon op'>:</span>
    <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='validates_confirmation_of identifier id'>validates_confirmation_of</span> <span class='symbol val'>:user_name</span><span class='comma token'>,</span> <span class='symbol val'>:password</span>
      <span class='validates_confirmation_of identifier id'>validates_confirmation_of</span> <span class='symbol val'>:email_address</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;should match confirmation&quot;</span>
    <span class='end end kw'>end</span>

  <span class='View constant id'>View</span><span class='colon op'>:</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= password_field &quot;person&quot;, &quot;password&quot; %&gt;
    &lt;%=</span> <span class='password_field identifier id'>password_field</span> <span class='string val'>&quot;person&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;password_confirmation&quot;</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
</pre>
<p>
The added <tt>password_confirmation</tt> attribute is virtual; it exists
only as an in-memory attribute for validating the password. To achieve
this, the validation adds accessors to the model for the confirmation
attribute. NOTE: This check is performed only if
<tt>password_confirmation</tt> is not <tt>nil</tt>, and by default only on
save. To require confirmation, make sure to add a presence check for the
confirmation attribute:
</p>
<pre class="code">
  <span class='validates_presence_of identifier id'>validates_presence_of</span> <span class='symbol val'>:password_confirmation</span><span class='comma token'>,</span> <span class='symbol val'>:if</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:password_changed?</span>
</pre>
<p>
Configuration options:
</p>
<ul>
<li><tt>:message</tt> - A custom error message (default is: &quot;doesn&#8217;t
match confirmation&quot;).

</li>
<li><tt>:on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 396</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L396">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">396
397
398
399
400
401
402
403
404
405</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_confirmation_of identifier id'>validates_confirmation_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:confirmation</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='attr_accessor identifier id'>attr_accessor</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{n}_confirmation&quot;</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{attr_name}_confirmation&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='value identifier id'>value</span> <span class='eq op'>==</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{attr_name}_confirmation&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_each</h3>
</div><div id="validates_each-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_each</span><span class='args'>(*attrs)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds a validation method or block to the class. This is useful when
overriding the <tt>validate</tt> instance method becomes too unwieldly and
you&#8217;re looking for more descriptive declaration of your validations.
</p>
<p>
This can be done with a symbol pointing to a method:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Comment constant id'>Comment</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validate identifier id'>validate</span> <span class='symbol val'>:must_be_friends</span>

    <span class='def def kw'>def</span> <span class='must_be_friends identifier id'>must_be_friends</span>
      <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add_to_base identifier id'>add_to_base</span><span class='lparen token'>(</span><span class='string val'>&quot;Must be friends to leave a comment&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='commenter identifier id'>commenter</span><span class='dot token'>.</span><span class='friend_of? fid id'>friend_of?</span><span class='lparen token'>(</span><span class='commentee identifier id'>commentee</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Or with a block which is passed the current record to be validated:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Comment constant id'>Comment</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validate identifier id'>validate</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='comment identifier id'>comment</span><span class='bitor op'>|</span>
      <span class='comment identifier id'>comment</span><span class='dot token'>.</span><span class='must_be_friends identifier id'>must_be_friends</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='must_be_friends identifier id'>must_be_friends</span>
      <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add_to_base identifier id'>add_to_base</span><span class='lparen token'>(</span><span class='string val'>&quot;Must be friends to leave a comment&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='commenter identifier id'>commenter</span><span class='dot token'>.</span><span class='friend_of? fid id'>friend_of?</span><span class='lparen token'>(</span><span class='commentee identifier id'>commentee</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
This usage applies to <tt>validate_on_create</tt> and
<tt>validate_on_update</tt> as well. Validates each attribute against a
block.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_each identifier id'>validates_each</span> <span class='symbol val'>:first_name</span><span class='comma token'>,</span> <span class='symbol val'>:last_name</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
      <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='string val'>'starts with z.'</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='integer val'>?z</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Options:
</p>
<ul>
<li><tt>:on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>:allow_nil</tt> - Skip validation if attribute is <tt>nil</tt>.

</li>
<li><tt>:allow_blank</tt> - Skip validation if attribute is blank.

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 350</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L350">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">350
351
352
353
354
355
356
357
358
359
360
361
362</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attrs identifier id'>attrs</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='dot token'>.</span><span class='symbolize_keys identifier id'>symbolize_keys</span>
  <span class='attrs identifier id'>attrs</span>   <span class='assign token'>=</span> <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span>

  <span class='comment val'># Declare the validation.</span>
  <span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='validation_method identifier id'>validation_method</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:on</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='symbol val'>:save</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
    <span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='attr identifier id'>attr</span><span class='bitor op'>|</span>
      <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='rparen token'>)</span>
      <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='andop op'>&amp;&amp;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:allow_nil</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='andop op'>&amp;&amp;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:allow_blank</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='yield yield kw'>yield</span> <span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='value identifier id'>value</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_exclusion_of</h3>
</div><div id="validates_exclusion_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_exclusion_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Validates that the value of the specified attribute is not in a particular
enumerable object.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_exclusion_of identifier id'>validates_exclusion_of</span> <span class='symbol val'>:username</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>%w( admin superuser )</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;You don't belong here&quot;</span>
    <span class='validates_exclusion_of identifier id'>validates_exclusion_of</span> <span class='symbol val'>:age</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>30</span><span class='dot2 op'>..</span><span class='integer val'>60</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;This site is only for under 30 and over 60&quot;</span>
    <span class='validates_exclusion_of identifier id'>validates_exclusion_of</span> <span class='symbol val'>:format</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>%w( mov avi )</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;extension %s is not allowed&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Configuration options:
</p>
<ul>
<li><tt>:in</tt> - An enumerable object of items that the value shouldn&#8217;t
be part of.

</li>
<li><tt>:message</tt> - Specifies a custom error message (default is: &quot;is
reserved&quot;).

</li>
<li><tt>:allow_nil</tt> - If set to true, skips this validation if the
attribute is <tt>nil</tt> (default is <tt>false</tt>).

</li>
<li><tt>:allow_blank</tt> - If set to true, skips this validation if the
attribute is blank (default is <tt>false</tt>).

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 716</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L716">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">716
717
718
719
720
721
722
723
724
725
726
727</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_exclusion_of identifier id'>validates_exclusion_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:exclusion</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='enum identifier id'>enum</span> <span class='assign token'>=</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:in</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:within</span><span class='rbrack token'>]</span>

  <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;An object with the method include? is required must be supplied as the :in option of the configuration hash&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='string val'>&quot;include?&quot;</span><span class='rparen token'>)</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='mod op'>%</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_format_of</h3>
</div><div id="validates_format_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_format_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Validates whether the value of the specified attribute is of the correct
form by matching it against the regular expression provided.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_format_of identifier id'>validates_format_of</span> <span class='symbol val'>:email</span><span class='comma token'>,</span> <span class='symbol val'>:with</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='regexp val'>/\A([^@\s]&lt;tt&gt;)@((?:[-a-z0-9]&lt;/</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span>\<span class='dot token'>.</span><span class='rparen token'>)</span><span class='plus op'>+</span><span class='lbrack token'>[</span><span class='a identifier id'>a</span><span class='minus op'>-</span><span class='z identifier id'>z</span><span class='rbrack token'>]</span><span class='lbrace token'>{</span><span class='integer val'>2</span><span class='comma token'>,</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>\<span class='Z constant id'>Z</span><span class='div op'>/</span><span class='i identifier id'>i</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:create</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Note: use <tt>\A</tt> and <tt>\Z</tt> to match the start and end of the
string, <tt>^</tt> and <tt>$</tt> match the start/end of a line.
</p>
<p>
A regular expression must be provided or else an exception will be raised.
</p>
<p>
Configuration options:
</p>
<ul>
<li><tt>:message</tt> - A custom error message (default is: &quot;is
invalid&quot;).

</li>
<li><tt>:allow_nil</tt> - If set to true, skips this validation if the
attribute is <tt>nil</tt> (default is <tt>false</tt>).

</li>
<li><tt>:allow_blank</tt> - If set to true, skips this validation if the
attribute is blank (default is <tt>false</tt>).

</li>
<li><tt>:with</tt> - The regular expression used to validate the format with
(note: must be supplied!).

</li>
<li><tt>:on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 654</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L654">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">654
655
656
657
658
659
660
661
662
663</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_format_of identifier id'>validates_format_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:invalid</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span><span class='comma token'>,</span> <span class='symbol val'>:with</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;A regular expression must be supplied as the :with option of the configuration hash&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:with</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Regexp constant id'>Regexp</span><span class='rparen token'>)</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='mod op'>%</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:with</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_inclusion_of</h3>
</div><div id="validates_inclusion_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_inclusion_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Validates whether the value of the specified attribute is available in a
particular enumerable object.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_inclusion_of identifier id'>validates_inclusion_of</span> <span class='symbol val'>:gender</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>%w( m f )</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;woah! what are you then!??!!&quot;</span>
    <span class='validates_inclusion_of identifier id'>validates_inclusion_of</span> <span class='symbol val'>:age</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='dot2 op'>..</span><span class='integer val'>99</span>
    <span class='validates_inclusion_of identifier id'>validates_inclusion_of</span> <span class='symbol val'>:format</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>%w( jpg gif png )</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;extension %s is not included in the list&quot;</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Configuration options:
</p>
<ul>
<li><tt>:in</tt> - An enumerable object of available items.

</li>
<li><tt>:message</tt> - Specifies a custom error message (default is: &quot;is
not included in the list&quot;).

</li>
<li><tt>:allow_nil</tt> - If set to true, skips this validation if the
attribute is <tt>nil</tt> (default is <tt>false</tt>).

</li>
<li><tt>:allow_blank</tt> - If set to true, skips this validation if the
attribute is blank (default is <tt>false</tt>).

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 684</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L684">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">684
685
686
687
688
689
690
691
692
693
694
695</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_inclusion_of identifier id'>validates_inclusion_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:inclusion</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='enum identifier id'>enum</span> <span class='assign token'>=</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:in</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:within</span><span class='rbrack token'>]</span>

  <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;An object with the method include? is required must be supplied as the :in option of the configuration hash&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='string val'>&quot;include?&quot;</span><span class='rparen token'>)</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='mod op'>%</span> <span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='enum identifier id'>enum</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_length_of</h3>
</div><div id="validates_length_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_length_of</span><span class='args'>(*attrs)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="validates_size_of-instance_method">validates_size_of</tt>
  
</p>
</div><div class="section docstring">
  <p>
Validates that the specified attribute matches the length restrictions
supplied. Only one option can be used at a time:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:first_name</span><span class='comma token'>,</span> <span class='symbol val'>:maximum=</span><span class='gt op'>&gt;</span><span class='integer val'>30</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:last_name</span><span class='comma token'>,</span> <span class='symbol val'>:maximum=</span><span class='gt op'>&gt;</span><span class='integer val'>30</span><span class='comma token'>,</span> <span class='symbol val'>:message=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;less than %d if you don't mind&quot;</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:fax</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>7</span><span class='dot2 op'>..</span><span class='integer val'>32</span><span class='comma token'>,</span> <span class='symbol val'>:allow_nil</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:phone</span><span class='comma token'>,</span> <span class='symbol val'>:in</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>7</span><span class='dot2 op'>..</span><span class='integer val'>32</span><span class='comma token'>,</span> <span class='symbol val'>:allow_blank</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:user_name</span><span class='comma token'>,</span> <span class='symbol val'>:within</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>6</span><span class='dot2 op'>..</span><span class='integer val'>20</span><span class='comma token'>,</span> <span class='symbol val'>:too_long</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;pick a shorter name&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:too_short</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;pick a longer name&quot;</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:fav_bra_size</span><span class='comma token'>,</span> <span class='symbol val'>:minimum</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='comma token'>,</span> <span class='symbol val'>:too_short</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;please enter at least %d character&quot;</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:smurf_leader</span><span class='comma token'>,</span> <span class='symbol val'>:is</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>4</span><span class='comma token'>,</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;papa is spelled with %d characters... don't play me.&quot;</span>
    <span class='validates_length_of identifier id'>validates_length_of</span> <span class='symbol val'>:essay</span><span class='comma token'>,</span> <span class='symbol val'>:minimum</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>100</span><span class='comma token'>,</span> <span class='symbol val'>:too_short</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Your essay must be at least %d words.&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:tokenizer</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='str identifier id'>str</span><span class='bitor op'>|</span> <span class='str identifier id'>str</span><span class='dot token'>.</span><span class='scan identifier id'>scan</span><span class='lparen token'>(</span><span class='regexp val'>/\w+/</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Configuration options:
</p>
<ul>
<li><tt>:minimum</tt> - The minimum size of the attribute.

</li>
<li><tt>:maximum</tt> - The maximum size of the attribute.

</li>
<li><tt>:is</tt> - The exact size of the attribute.

</li>
<li><tt>:within</tt> - A range specifying the minimum and maximum size of the
attribute.

</li>
<li><tt>:in</tt> - A synonym(or alias) for <tt>:within</tt>.

</li>
<li><tt>:allow_nil</tt> - Attribute may be <tt>nil</tt>; skip validation.

</li>
<li><tt>:allow_blank</tt> - Attribute may be blank; skip validation.

</li>
<li><tt>:too_long</tt> - The error message if the attribute goes over the
maximum (default is: &quot;is too long (maximum is %d characters)&quot;).

</li>
<li><tt>:too_short</tt> - The error message if the attribute goes under the
minimum (default is: &quot;is too short (min is %d characters)&quot;).

</li>
<li><tt>:wrong_length</tt> - The error message if using the <tt>:is</tt> method
and the attribute is the wrong size (default is: &quot;is the wrong length
(should be %d characters)&quot;).

</li>
<li><tt>:message</tt> - The error message to use for a <tt>:minimum</tt>,
<tt>:maximum</tt>, or <tt>:is</tt> violation. An alias of the appropriate
<tt>too_long</tt>/<tt>too_short</tt>/<tt>wrong_length</tt> message.

</li>
<li><tt>:on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
<li><tt>:tokenizer</tt> - Specifies how to split up the attribute string. (e.g.
<tt>:tokenizer =&gt; lambda <tt>str.scan(/\w+/)</tt></tt> to count words as
in above example.) Defaults to <tt>lambda{ |value| value.split(//) }</tt>
which counts individual characters.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 515</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L515">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_length_of identifier id'>validates_length_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attrs identifier id'>attrs</span><span class='rparen token'>)</span>
  <span class='comment val'># Merge given options with defaults.</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:too_long</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:too_long</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:too_short</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:too_short</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:wrong_length</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:wrong_length</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:tokenizer</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='value identifier id'>value</span><span class='bitor op'>|</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='regexp val'>//</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='DEFAULT_VALIDATION_OPTIONS constant id'>DEFAULT_VALIDATION_OPTIONS</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='dot token'>.</span><span class='symbolize_keys identifier id'>symbolize_keys</span><span class='rparen token'>)</span>

  <span class='comment val'># Ensure that one and only one range option is specified.</span>
  <span class='range_options identifier id'>range_options</span> <span class='assign token'>=</span> <span class='ALL_RANGE_OPTIONS constant id'>ALL_RANGE_OPTIONS</span> <span class='bitand op'>&amp;</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span>
  <span class='case case kw'>case</span> <span class='range_options identifier id'>range_options</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
    <span class='when when kw'>when</span> <span class='integer val'>0</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'Range unspecified.  Specify the :within, :maximum, :minimum, or :is option.'</span>
    <span class='when when kw'>when</span> <span class='integer val'>1</span>
      <span class='comment val'># Valid number of options; do nothing.</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'Too many range options specified.  Choose only one.'</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Get range option and value.</span>
  <span class='option identifier id'>option</span> <span class='assign token'>=</span> <span class='range_options identifier id'>range_options</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='option_value identifier id'>option_value</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='range_options identifier id'>range_options</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rbrack token'>]</span>

  <span class='case case kw'>case</span> <span class='option identifier id'>option</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:within</span><span class='comma token'>,</span> <span class='symbol val'>:in</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;:#{option} must be a Range&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='option_value identifier id'>option_value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Range constant id'>Range</span><span class='rparen token'>)</span>

      <span class='too_short identifier id'>too_short</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:too_short</span><span class='rbrack token'>]</span> <span class='mod op'>%</span> <span class='option_value identifier id'>option_value</span><span class='dot token'>.</span><span class='begin identifier id'>begin</span>
      <span class='too_long identifier id'>too_long</span>  <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:too_long</span><span class='rbrack token'>]</span>  <span class='mod op'>%</span> <span class='option_value identifier id'>option_value</span><span class='dot token'>.</span><span class='end identifier id'>end</span>

      <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:tokenizer</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='lt op'>&lt;</span> <span class='option_value identifier id'>option_value</span><span class='dot token'>.</span><span class='begin identifier id'>begin</span>
          <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='too_short identifier id'>too_short</span><span class='rparen token'>)</span>
        <span class='elsif elsif kw'>elsif</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='option_value identifier id'>option_value</span><span class='dot token'>.</span><span class='end identifier id'>end</span>
          <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='too_long identifier id'>too_long</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:is</span><span class='comma token'>,</span> <span class='symbol val'>:minimum</span><span class='comma token'>,</span> <span class='symbol val'>:maximum</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;:#{option} must be a nonnegative Integer&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='option_value identifier id'>option_value</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Integer constant id'>Integer</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='option_value identifier id'>option_value</span> <span class='geq op'>&gt;=</span> <span class='integer val'>0</span>

      <span class='comment val'># Declare different validations per option.</span>
      <span class='validity_checks identifier id'>validity_checks</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:is</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;==&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:minimum</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;&gt;=&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:maximum</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;&lt;=&quot;</span> <span class='rbrace token'>}</span>
      <span class='message_options identifier id'>message_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:is</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:wrong_length</span><span class='comma token'>,</span> <span class='symbol val'>:minimum</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:too_short</span><span class='comma token'>,</span> <span class='symbol val'>:maximum</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:too_long</span> <span class='rbrace token'>}</span>

      <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='message_options identifier id'>message_options</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='mod op'>%</span> <span class='option_value identifier id'>option_value</span>

      <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attrs identifier id'>attrs</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
        <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:tokenizer</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
        <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='message identifier id'>message</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='notop op'>!</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='and and kw'>and</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='dot token'>.</span><span class='method identifier id'>method</span><span class='lparen token'>(</span><span class='validity_checks identifier id'>validity_checks</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='option_value identifier id'>option_value</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_numericality_of</h3>
</div><div id="validates_numericality_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_numericality_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Validates whether the value of the specified attribute is numeric by trying
to convert it to a float with Kernel.Float (if <tt>only_integer</tt> is
false) or applying it to the regular expression <tt>/\A[<tt>\-]?\d</tt>\Z/</tt>
(if <tt>only_integer</tt> is set to true).
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_numericality_of identifier id'>validates_numericality_of</span> <span class='symbol val'>:value</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:create</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Configuration options:
</p>
<ul>
<li><tt>:message</tt> - A custom error message (default is: &quot;is not a
number&quot;).

</li>
<li><tt>:on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>:only_integer</tt> - Specifies whether the value has to be an integer,
e.g. an integral value (default is <tt>false</tt>).

</li>
<li><tt>:allow_nil</tt> - Skip validation if attribute is <tt>nil</tt> (default
is <tt>false</tt>). Notice that for fixnum and float properties empty
strings are converted to <tt>nil</tt>.

</li>
<li><tt>:greater_than</tt> - Specifies the value must be greater than the
supplied value.

</li>
<li><tt>:greater_than_or_equal_to</tt> - Specifies the value must be greater
than or equal the supplied value.

</li>
<li><tt>:equal_to</tt> - Specifies the value must be equal to the supplied
value.

</li>
<li><tt>:less_than</tt> - Specifies the value must be less than the supplied
value.

</li>
<li><tt>:less_than_or_equal_to</tt> - Specifies the value must be less than or
equal the supplied value.

</li>
<li><tt>:odd</tt> - Specifies the value must be an odd number.

</li>
<li><tt>:even</tt> - Specifies the value must be an even number.

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 796</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L796">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">796
797
798
799
800
801
802
803
804
805
806
807
808
809
810
811
812
813
814
815
816
817
818
819
820
821
822
823
824
825
826
827
828
829
830
831
832
833
834
835
836
837
838</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_numericality_of identifier id'>validates_numericality_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span><span class='comma token'>,</span> <span class='symbol val'>:only_integer</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='symbol val'>:allow_nil</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>


  <span class='numericality_options identifier id'>numericality_options</span> <span class='assign token'>=</span> <span class='ALL_NUMERICALITY_CHECKS constant id'>ALL_NUMERICALITY_CHECKS</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span> <span class='bitand op'>&amp;</span> <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span>

  <span class='lparen token'>(</span><span class='numericality_options identifier id'>numericality_options</span> <span class='minus op'>-</span> <span class='lbrack token'>[</span> <span class='symbol val'>:odd</span><span class='comma token'>,</span> <span class='symbol val'>:even</span> <span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='option identifier id'>option</span><span class='bitor op'>|</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;:#{option} must be a number&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span><span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='raw_value identifier id'>raw_value</span> <span class='assign token'>=</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{attr_name}_before_type_cast&quot;</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='value identifier id'>value</span>

    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:allow_nil</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='raw_value identifier id'>raw_value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

    <span class='if if kw'>if</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:only_integer</span><span class='rbrack token'>]</span>
      <span class='unless unless kw'>unless</span> <span class='raw_value identifier id'>raw_value</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/\A[+-]?\d+\Z/</span>
        <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:not_a_number</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='next next kw'>next</span>
      <span class='end end kw'>end</span>
      <span class='raw_value identifier id'>raw_value</span> <span class='assign token'>=</span> <span class='raw_value identifier id'>raw_value</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
    <span class='else else kw'>else</span>
     <span class='begin begin kw'>begin</span>
        <span class='raw_value identifier id'>raw_value</span> <span class='assign token'>=</span> <span class='Kernel constant id'>Kernel</span><span class='dot token'>.</span><span class='Float constant id'>Float</span><span class='lparen token'>(</span><span class='raw_value identifier id'>raw_value</span><span class='rparen token'>)</span>
      <span class='rescue rescue kw'>rescue</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='TypeError constant id'>TypeError</span>
        <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:not_a_number</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='next next kw'>next</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='numericality_options identifier id'>numericality_options</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='option identifier id'>option</span><span class='bitor op'>|</span>
      <span class='case case kw'>case</span> <span class='option identifier id'>option</span>
        <span class='when when kw'>when</span> <span class='symbol val'>:odd</span><span class='comma token'>,</span> <span class='symbol val'>:even</span>
          <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='raw_value identifier id'>raw_value</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='dot token'>.</span><span class='method identifier id'>method</span><span class='lparen token'>(</span><span class='ALL_NUMERICALITY_CHECKS constant id'>ALL_NUMERICALITY_CHECKS</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='rbrack token'>]</span>
        <span class='else else kw'>else</span>
          <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span>
          <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='message identifier id'>message</span> <span class='mod op'>%</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span>
          <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='message identifier id'>message</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='raw_value identifier id'>raw_value</span><span class='dot token'>.</span><span class='method identifier id'>method</span><span class='lparen token'>(</span><span class='ALL_NUMERICALITY_CHECKS constant id'>ALL_NUMERICALITY_CHECKS</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='option identifier id'>option</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_presence_of</h3>
</div><div id="validates_presence_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_presence_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Validates that the specified attributes are not blank (as defined by
Object#blank?). Happens by default on save. Example:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_presence_of identifier id'>validates_presence_of</span> <span class='symbol val'>:first_name</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The first_name attribute must be in the object and it cannot be blank.
</p>
<p>
If you want to validate the presence of a boolean field (where the real
values are true and false), you will want to use validates_inclusion_of
:field_name, :in =&gt; [true, false] This is due to the way Object#blank?
handles boolean values. false.blank? # =&gt; true
</p>
<p>
Configuration options:
</p>
<ul>
<li><tt>message</tt> - A custom error message (default is: &quot;can&#8217;t be
blank&quot;).

</li>
<li><tt>on</tt> - Specifies when this validation is active (default is
<tt>:save</tt>, other options <tt>:create</tt>, <tt>:update</tt>).

</li>
<li><tt>if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. :if =&gt; :allow_validation, or :if =&gt;
Proc.new { |user| user.signup_step &gt; 2 }). The method, proc or string
should return or evaluate to a true or false value.

</li>
<li><tt>unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. :unless =&gt; :skip_validation, or
:unless =&gt; Proc.new { |user| user.signup_step &lt;= 2 }). The method,
proc or string should return or evaluate to a true or false value.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 469</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L469">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">469
470
471
472
473
474
475
476
477
478</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_presence_of identifier id'>validates_presence_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:blank</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:save</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='comment val'># can't use validates_each here, because it cannot cope with nonexistent attributes,</span>
  <span class='comment val'># while errors.add_on_empty can</span>
  <span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='validation_method identifier id'>validation_method</span><span class='lparen token'>(</span><span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:on</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
    <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add_on_blank identifier id'>add_on_blank</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validates_uniqueness_of</h3>
</div><div id="validates_uniqueness_of-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validates_uniqueness_of</span><span class='args'>(*attr_names)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Validates whether the value of the specified attributes are unique across
the system. Useful for making sure that only one user can be named
&quot;davidhh&quot;.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_uniqueness_of identifier id'>validates_uniqueness_of</span> <span class='symbol val'>:user_name</span><span class='comma token'>,</span> <span class='symbol val'>:scope</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:account_id</span>
  <span class='end end kw'>end</span>
</pre>
<p>
It can also validate whether the value of the specified attributes are
unique based on multiple scope parameters. For example, making sure that a
teacher can only be on the schedule once per semester for a particular
class.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='TeacherSchedule constant id'>TeacherSchedule</span> <span class='lt op'>&lt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='validates_uniqueness_of identifier id'>validates_uniqueness_of</span> <span class='symbol val'>:teacher_id</span><span class='comma token'>,</span> <span class='symbol val'>:scope</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:semester_id</span><span class='comma token'>,</span> <span class='symbol val'>:class_id</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
</pre>
<p>
When the record is created, a check is performed to make sure that no
record exists in the database with the given value for the specified
attribute (that maps to a property). When the record is updated, the same
check is made but disregarding the record itself.
</p>
<p>
Because this check is performed outside the database there is still a
chance that duplicate values will be inserted in two parallel transactions.
To guarantee against this you should create a unique index on the field.
See <tt>add_index</tt> for more information.
</p>
<p>
Configuration options:
</p>
<ul>
<li><tt>:message</tt> - Specifies a custom error message (default is: &quot;has
already been taken&quot;).

</li>
<li><tt>:scope</tt> - One or more properties by which to limit the scope of the
uniqueness constraint, specified like conditions, eg :scope =&gt; <tt>=&amp;gt; &amp;quot;article&amp;quot;</tt>

</li>
<li><tt>:allow_nil</tt> - If set to true, skips this validation if the
attribute is <tt>nil</tt> (default is <tt>false</tt>).

</li>
<li><tt>:allow_blank</tt> - If set to true, skips this validation if the
attribute is blank (default is <tt>false</tt>).

</li>
<li><tt>:if</tt> - Specifies a method, proc or string to call to determine if
the validation should occur (e.g. <tt>:if =&gt; :allow_validation</tt>, or
<tt>:if =&gt; Proc.new { |user| user.signup_step &gt; 2 }</tt>). The
method, proc or string should return or evaluate to a true or false value.

</li>
<li><tt>:unless</tt> - Specifies a method, proc or string to call to determine
if the validation should not occur (e.g. <tt>:unless =&gt;
:skip_validation</tt>, or <tt>:unless =&gt; Proc.new { |user|
user.signup_step &lt;= 2 }</tt>). The method, proc or string should return
or evaluate to a true or false value.

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/couch_foo/validations.rb', line 605</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/georgepalmer/couch_foo/blob/13a37f5c452f8ebacb4a9caf0e225911cface3a6/lib/couch_foo/validations.rb#L605">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validates_uniqueness_of identifier id'>validates_uniqueness_of</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attr_names identifier id'>attr_names</span><span class='rparen token'>)</span>
  <span class='configuration identifier id'>configuration</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='CouchFoo constant id'>CouchFoo</span><span class='colon2 op'>::</span><span class='Errors constant id'>Errors</span><span class='dot token'>.</span><span class='default_error_messages identifier id'>default_error_messages</span><span class='lbrack token'>[</span><span class='symbol val'>:taken</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:case_sensitive</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span>
  <span class='configuration identifier id'>configuration</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='dot token'>.</span><span class='extract_options! fid id'>extract_options!</span><span class='rparen token'>)</span>

  <span class='validates_each identifier id'>validates_each</span><span class='lparen token'>(</span><span class='attr_names identifier id'>attr_names</span><span class='comma token'>,</span><span class='configuration identifier id'>configuration</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='comma token'>,</span> <span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span><span class='bitor op'>|</span>
    <span class='comment val'># The check for an existing value should be run from a class that</span>
    <span class='comment val'># isn't abstract. This means working down from the current class</span>
    <span class='comment val'># (self), to the first non-abstract class. Since classes don't know</span>
    <span class='comment val'># their subclasses, we have to build the hierarchy between self and</span>
    <span class='comment val'># the record's class.</span>
    <span class='class_hierarchy identifier id'>class_hierarchy</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='record identifier id'>record</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='rbrack token'>]</span>
    <span class='while while kw'>while</span> <span class='class_hierarchy identifier id'>class_hierarchy</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='neq op'>!=</span> <span class='self self kw'>self</span>
      <span class='class_hierarchy identifier id'>class_hierarchy</span><span class='dot token'>.</span><span class='insert identifier id'>insert</span><span class='lparen token'>(</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='class_hierarchy identifier id'>class_hierarchy</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='superclass identifier id'>superclass</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Now we can work our way down the tree to the first non-abstract class</span>
    <span class='finder_class identifier id'>finder_class</span> <span class='assign token'>=</span> <span class='class_hierarchy identifier id'>class_hierarchy</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='klass identifier id'>klass</span><span class='bitor op'>|</span> <span class='notop op'>!</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='abstract_class? fid id'>abstract_class?</span> <span class='rbrace token'>}</span>
    
    <span class='scope identifier id'>scope</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:scope</span><span class='rbrack token'>]</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:scope</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:scope</span><span class='rbrack token'>]</span> 
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='finder_class identifier id'>finder_class</span><span class='dot token'>.</span><span class='find_view identifier id'>find_view</span><span class='lparen token'>(</span><span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='attr_name identifier id'>attr_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='value identifier id'>value</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='scope identifier id'>scope</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='result identifier id'>result</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='andop op'>&amp;&amp;</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:_id</span><span class='rparen token'>)</span> <span class='neq op'>!=</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:_id</span><span class='rparen token'>)</span>
      <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='attr_name identifier id'>attr_name</span><span class='comma token'>,</span> <span class='configuration identifier id'>configuration</span><span class='lbrack token'>[</span><span class='symbol val'>:message</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>