<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: ActiveMerchant::Billing::PayJunctionGateway</title>
  </head>
  <body>
    <div id="content">
      <div class="section class ActiveMerchant_Billing_PayJunctionGateway">
  <h1 class="title">Class: ActiveMerchant::Billing::PayJunctionGateway</h1>
  <div class="section inheritance">
  <ul>
  <li><a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></li><ul><li>ActiveMerchant::Billing::PayJunctionGateway</li>
  </ul></ul>
</div><div class="section docstring">
  <p>
PayJunction Gateway
</p>
<p>
This gateway accepts the following arguments:
</p>
<pre class="code">
  <span class='symbol val'>:login</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='your identifier id'>your</span> <span class='PayJunction constant id'>PayJunction</span> <span class='username identifier id'>username</span>
  <span class='symbol val'>:password</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='your identifier id'>your</span> <span class='PayJunction constant id'>PayJunction</span> <span class='pass identifier id'>pass</span>
</pre>
<p>
Example use:
</p>
<pre class="code">
  <span class='gateway identifier id'>gateway</span> <span class='assign token'>=</span> <span class='ActiveMerchant constant id'>ActiveMerchant</span><span class='colon2 op'>::</span><span class='Billing constant id'>Billing</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='gateway identifier id'>gateway</span><span class='lparen token'>(</span><span class='symbol val'>:pay_junction</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
              <span class='symbol val'>:login</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;my_account&quot;</span><span class='comma token'>,</span>
              <span class='symbol val'>:password</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;my_pass&quot;</span>
           <span class='rparen token'>)</span>

  <span class='comment val'># set up credit card obj as in main ActiveMerchant example</span>
  <span class='creditcard identifier id'>creditcard</span> <span class='assign token'>=</span> <span class='ActiveMerchant constant id'>ActiveMerchant</span><span class='colon2 op'>::</span><span class='Billing constant id'>Billing</span><span class='colon2 op'>::</span><span class='CreditCard constant id'>CreditCard</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
    <span class='symbol val'>:type</span>       <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'visa'</span><span class='comma token'>,</span>
    <span class='symbol val'>:number</span>     <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'4242424242424242'</span><span class='comma token'>,</span>
    <span class='symbol val'>:month</span>      <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>8</span><span class='comma token'>,</span>
    <span class='symbol val'>:year</span>       <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2009</span><span class='comma token'>,</span>
    <span class='symbol val'>:first_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Bob'</span><span class='comma token'>,</span>
    <span class='symbol val'>:last_name</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Bobsen'</span>
  <span class='rparen token'>)</span>

  <span class='comment val'># optionally specify address if using AVS</span>
  <span class='address identifier id'>address</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:address1</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'101 Test Ave'</span><span class='comma token'>,</span> <span class='symbol val'>:city</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Test'</span><span class='comma token'>,</span> <span class='symbol val'>:state</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'TS'</span><span class='comma token'>,</span>
              <span class='symbol val'>:zip</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'10101'</span><span class='comma token'>,</span> <span class='symbol val'>:country</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'US'</span> <span class='rbrace token'>}</span>

  <span class='comment val'># run request</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='gateway identifier id'>gateway</span><span class='dot token'>.</span><span class='purchase identifier id'>purchase</span><span class='lparen token'>(</span><span class='integer val'>1000</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='symbol val'>:address</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='address identifier id'>address</span><span class='rparen token'>)</span> <span class='comment val'># charge 10 dollars</span>
</pre>
<p>
1) Check whether the transaction was successful
</p>
<pre class="code">
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='success? fid id'>success?</span>
</pre>
<p>
2) Retrieve the message returned by PayJunction
</p>
<pre class="code">
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
</pre>
<p>
3) Retrieve the unique transaction ID returned by PayJunction
</p>
<pre class="code">
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='authorization identifier id'>authorization</span>
</pre>
<p>
This gateway supports &quot;instant&quot; transactions. These transactions
allow you to execute an operation on a previously run card without card
information provided you have the transaction id from a previous
transaction with the same card. All functions that take a credit card
object for this gateway can take a transaction id string instead.
</p>
<p>
Test Transactions
</p>
<p>
See the source for initialize() for test account information. Note that
PayJunction does not allow test transactions on your account, so if the
gateway is running in :test mode your transaction will be run against
PayJunction&#8217;s global test account and will not show up in your
account.
</p>
<p>
Transactions ran on this account go through a test processor, so there is
no need to void or otherwise cancel transactions. However, for further
safety, please use the special card numbers 4433221111223344 or
4444333322221111 and keep transaction amounts below $4.00 when testing.
</p>
<p>
Also note, transactions ran for an amount between $0.00 and $1.99 will
likely result in denial. To demonstrate approvals, use amounts between
$2.00 and $4.00.
</p>
<p>
Test transactions can be checked by logging into PayJunction Web Login with
username &#8216;pj-cm-01&#8217; and password &#8216;pj-cm-01p&#8217;
</p>
<p>
Usage Details
</p>
<p>
Below is a map of values accepted by PayJunction and how you should submit
each to ActiveMerchant
</p>
<p>
PayJunction Field ActiveMerchant Use
</p>
<p>
dc_logon provide as :login value to gateway instantation dc_password
provide as :password value to gateway instantiation
</p>
<p>
dc_name will be retrieved from credit_card.name dc_first_name :first_name
on CreditCard object instantation dc_last_name :last_name on CreditCard
object instantation dc_number :number on CreditCard object instantation
dc_expiration_month :month on CreditCard object instantation
dc_expiration_year :year on CreditCard object instantation
dc_verification_number :verification_value on CC object instantation
</p>
<p>
dc_transaction_amount include as argument to method for your transaction
type dc_transaction_type do nothing, set by your transaction type
dc_version do nothing, always &quot;1.2&quot;
</p>
<p>
dc_transaction_id submit as a string in place of CreditCard obj for
</p>
<pre class="code">
                        <span class='string val'>&quot;instant&quot;</span> <span class='transactions identifier id'>transactions</span><span class='dot token'>.</span>
</pre>
<p>
dc_invoice :order_id in options for transaction method dc_notes
:description in options for transaction method
</p>
<p>
See example use above for address AVS fields See #recurring for periodic
transaction fields
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h1>Constants</h1>
  <dl>
    
      <dt id="API_VERSION-constant">API_VERSION</dt>
      <dd>'1.2'</dd>
    
      <dt id="DECLINE_CODES-constant">DECLINE_CODES</dt>
      <dd>{        &quot;AE&quot;  =&gt; 'Address verification failed because address did not match.',        'ZE'  =&gt; 'Address verification failed because zip did not match.',        'XE'  =&gt; 'Address verification failed because zip and address did not match.',        'YE'  =&gt; 'Address verification failed because zip and address did not match.',        'OE'  =&gt; 'Address verification failed because address or zip did not match.',        'UE'  =&gt; 'Address verification failed because cardholder address unavailable.',        'RE'  =&gt; 'Address verification failed because address verification system is not working.',        'SE'  =&gt; 'Address verification failed because address verification system is unavailable.',        'EE'  =&gt; 'Address verification failed because transaction is not a mail or phone order.',        'GE'  =&gt; 'Address verification failed because international support is unavailable.',        'CE'  =&gt; 'Declined because CVV2/CVC2 code did not match.',        '04'  =&gt; 'Declined. Pick up card.',        '07'  =&gt; 'Declined. Pick up card (Special Condition).',        '41'  =&gt; 'Declined. Pick up card (Lost).',        '43'  =&gt; 'Declined. Pick up card (Stolen).',        '13'  =&gt; 'Declined because of the amount is invalid.',        '14'  =&gt; 'Declined because the card number is invalid.',        '80'  =&gt; 'Declined because of an invalid date.',        '05'  =&gt; 'Declined. Do not honor.',        '51'  =&gt; 'Declined because of insufficient funds.',        'N4'  =&gt; 'Declined because the amount exceeds issuer withdrawal limit.',        '61'  =&gt; 'Declined because the amount exceeds withdrawal limit.',        '62'  =&gt; 'Declined because of an invalid service code (restricted).',        '65'  =&gt; 'Declined because the card activity limit exceeded.',        '93'  =&gt; 'Declined because there a violation (the transaction could not be completed).',        '06'  =&gt; 'Declined because address verification failed.',        '54'  =&gt; 'Declined because the card has expired.',        '15'  =&gt; 'Declined because there is no such issuer.',        '96'  =&gt; 'Declined because of a system error.',        'N7'  =&gt; 'Declined because of a CVV2/CVC2 mismatch.',        'M4'  =&gt; 'Declined.',         &quot;FE&quot;  =&gt; &quot;There was a format error with your Trinity Gateway Service (API) request.&quot;,        &quot;LE&quot;  =&gt; &quot;Could not log you in (problem with dc_logon and/or dc_password).&quot;,        'NL'  =&gt; 'Aborted because of a system error, please try again later. ',        'AB'  =&gt; 'Aborted because of an upstream system error, please try again later.'      }</dd>
    
      <dt id="FAILURE_MESSAGE-constant">FAILURE_MESSAGE</dt>
      <dd>'The transaction was declined.'</dd>
    
      <dt id="SUCCESS_CODES-constant">SUCCESS_CODES</dt>
      <dd>[&quot;00&quot;, &quot;85&quot;]</dd>
    
      <dt id="SUCCESS_MESSAGE-constant">SUCCESS_MESSAGE</dt>
      <dd>'The transaction was approved.'</dd>
    
      <dt id="TEST_LOGIN-constant">TEST_LOGIN</dt>
      <dd>'pj-ql-01'</dd>
    
      <dt id="TEST_PASSWORD-constant">TEST_PASSWORD</dt>
      <dd>'pj-ql-01p'</dd>
    
  </dl>
</div>
<div class="inherited">
  
  <div>
    <h1>Constants Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#DEBIT_CARDS-constant' title='DEBIT_CARDS'>DEBIT_CARDS</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


158
159
160
161
162</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 158</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='symbol val'>:login</span><span class='comma token'>,</span> <span class='symbol val'>:password</span><span class='rparen token'>)</span>
  <span class='@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span>
  <span class='super super kw'>super</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <div class="inherited">
  
  <div>
    <h1>Public Class Methods Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#card_brand-class_method' title='card_brand'>card_brand</a></span>, <span class='name'><a href='Gateway.html#inherited-class_method' title='inherited'>inherited</a></span>, <span class='name'><a href='Gateway.html#supports%3F-class_method' title='supports?'>supports?</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#authorize-instance_method' title='#authorize'>#authorize</a></span><span class='args'>(money, payment_source, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The first half of the preauth(authorize)/postauth(capture) model.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#capture-instance_method' title='#capture'>#capture</a></span><span class='args'>(money, authorization, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The second half of the preauth(authorize)/postauth(capture) model.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#credit-instance_method' title='#credit'>#credit</a></span><span class='args'>(money, authorization, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return money to a card that was previously billed.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#purchase-instance_method' title='#purchase'>#purchase</a></span><span class='args'>(money, payment_source, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
A simple sale, capturing funds immediately.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#recurring-instance_method' title='#recurring'>#recurring</a></span><span class='args'>(money, payment_source, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Set up a sale that will be made on a regular basis for the same amount (ex.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#test%3F-instance_method' title='#test?'>#test?</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#void-instance_method' title='#void'>#void</a></span><span class='args'>(money, authorization, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Cancel a transaction that has been charged but has not yet made it through
the batch process.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h1>Public Instance Methods Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#amount-instance_method' title='amount'>amount</a></span>, <span class='name'><a href='Gateway.html#card_brand-instance_method' title='card_brand'>card_brand</a></span>, <span class='name'><a href='Gateway.html#currency-instance_method' title='currency'>currency</a></span>, <span class='name'><a href='Gateway.html#name-instance_method' title='name'>name</a></span>, <span class='name'><a href='Gateway.html#requires_start_date_or_issue_number%3F-instance_method' title='requires_start_date_or_issue_number?'>requires_start_date_or_issue_number?</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>authorize</h3>
</div><div id="authorize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authorize</span><span class='args'>(money, payment_source, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The first half of the preauth(authorize)/postauth(capture) model. Checks to
make sure funds are available for a transaction, and returns a
transaction_id that can be used later to postauthorize (capture) the funds.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


167
168
169
170
171
172
173
174
175
176</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 167</span>

<span class='def def kw'>def</span> <span class='authorize identifier id'>authorize</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='payment_source identifier id'>payment_source</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='parameters identifier id'>parameters</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:transaction_amount</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span>                                                             
  
  <span class='add_payment_source identifier id'>add_payment_source</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='payment_source identifier id'>payment_source</span><span class='rparen token'>)</span>
  <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_optional_fields identifier id'>add_optional_fields</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='string val'>'AUTHORIZATION'</span><span class='comma token'>,</span> <span class='parameters identifier id'>parameters</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>capture</h3>
</div><div id="capture-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>capture</span><span class='args'>(money, authorization, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The second half of the preauth(authorize)/postauth(capture) model. Retrieve
funds that have been previously authorized with <em>authorization</em>
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


193
194
195
196
197
198
199
200
201</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 193</span>

<span class='def def kw'>def</span> <span class='capture identifier id'>capture</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='parameters identifier id'>parameters</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:transaction_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span>
    <span class='symbol val'>:posture</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'capture'</span>
  <span class='rbrace token'>}</span>
  
  <span class='add_optional_fields identifier id'>add_optional_fields</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>                                          
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='string val'>'update'</span><span class='comma token'>,</span> <span class='parameters identifier id'>parameters</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>credit</h3>
</div><div id="credit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>credit</span><span class='args'>(money, authorization, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return money to a card that was previously billed. <em>authorization</em>
should be the transaction id of the transaction we are returning.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


205
206
207
208
209
210
211
212</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 205</span>

<span class='def def kw'>def</span> <span class='credit identifier id'>credit</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>  
  <span class='parameters identifier id'>parameters</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:transaction_amount</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='symbol val'>:transaction_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='authorization identifier id'>authorization</span>
  <span class='rbrace token'>}</span>
                                            
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='string val'>'CREDIT'</span><span class='comma token'>,</span> <span class='parameters identifier id'>parameters</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>purchase</h3>
</div><div id="purchase-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>purchase</span><span class='args'>(money, payment_source, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
A simple sale, capturing funds immediately. Execute authorization and
capture in a single step.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


180
181
182
183
184
185
186
187
188
189</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 180</span>

<span class='def def kw'>def</span> <span class='purchase identifier id'>purchase</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='payment_source identifier id'>payment_source</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>        
  <span class='parameters identifier id'>parameters</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:transaction_amount</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='comma token'>,</span>
  <span class='rbrace token'>}</span>                                                             
  
  <span class='add_payment_source identifier id'>add_payment_source</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='payment_source identifier id'>payment_source</span><span class='rparen token'>)</span>
  <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_optional_fields identifier id'>add_optional_fields</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='string val'>'AUTHORIZATION_CAPTURE'</span><span class='comma token'>,</span> <span class='parameters identifier id'>parameters</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>recurring</h3>
</div><div id="recurring-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>recurring</span><span class='args'>(money, payment_source, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Set up a sale that will be made on a regular basis for the same amount (ex.
$20 a month for 12 months)
</p>
<p>
The parameter :periodicity should be specified as either :monthly, :weekly,
or :daily The parameter :payments should be the number of payments to be
made
</p>
<pre class="code">
  <span class='gateway identifier id'>gateway</span><span class='dot token'>.</span><span class='recurring identifier id'>recurring</span><span class='lparen token'>(</span><span class='string val'>'2000'</span><span class='comma token'>,</span> <span class='creditcard identifier id'>creditcard</span><span class='comma token'>,</span> <span class='symbol val'>:periodicity</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:monthly</span><span class='comma token'>,</span> <span class='symbol val'>:payments</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>12</span><span class='rparen token'>)</span>
</pre>
<p>
The optional parameter :starting_at takes a date or time argument or a
string in YYYYMMDD format and can be used to specify when the first charge
will be made. If omitted the first charge will be immediate.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 237</span>

<span class='def def kw'>def</span> <span class='recurring identifier id'>recurring</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='payment_source identifier id'>payment_source</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>        
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='lbrack token'>[</span><span class='symbol val'>:periodicity</span><span class='comma token'>,</span> <span class='symbol val'>:monthly</span><span class='comma token'>,</span> <span class='symbol val'>:weekly</span><span class='comma token'>,</span> <span class='symbol val'>:daily</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:payments</span><span class='rparen token'>)</span>

  <span class='periodic_type identifier id'>periodic_type</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:periodicity</span><span class='rbrack token'>]</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:monthly</span>
    <span class='string val'>'month'</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:weekly</span>
    <span class='string val'>'week'</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:daily</span>
    <span class='string val'>'day'</span>
  <span class='end end kw'>end</span>
  
  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='starting_at identifier id'>starting_at</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='start_date identifier id'>start_date</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='dot token'>.</span><span class='strftime identifier id'>strftime</span><span class='lparen token'>(</span><span class='string val'>'%Y-%m-%d'</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:starting_at</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='sa identifier id'>sa</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:starting_at</span><span class='rbrack token'>]</span>
    <span class='start_date identifier id'>start_date</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{sa[0..3]}-#{sa[4..5]}-#{sa[6..7]}&quot;</span>
  <span class='else else kw'>else</span>
    <span class='start_date identifier id'>start_date</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:starting_at</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='strftime identifier id'>strftime</span><span class='lparen token'>(</span><span class='string val'>'%Y-%m-%d'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='parameters identifier id'>parameters</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:transaction_amount</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='symbol val'>:schedule_periodic_type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='periodic_type identifier id'>periodic_type</span><span class='comma token'>,</span>
    <span class='symbol val'>:schedule_create</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'true'</span><span class='comma token'>,</span>
    <span class='symbol val'>:schedule_limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:payments</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:payments</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='integer val'>1</span><span class='comma token'>,</span>
    <span class='symbol val'>:schedule_periodic_number</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='comma token'>,</span>
    <span class='symbol val'>:schedule_start</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='start_date identifier id'>start_date</span>
  <span class='rbrace token'>}</span>
  
  <span class='add_payment_source identifier id'>add_payment_source</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='payment_source identifier id'>payment_source</span><span class='rparen token'>)</span>
  <span class='add_optional_fields identifier id'>add_optional_fields</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='add_address identifier id'>add_address</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>                                   
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='string val'>'AUTHORIZATION_CAPTURE'</span><span class='comma token'>,</span> <span class='parameters identifier id'>parameters</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>test?</h3>
</div><div id="test%3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>test?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


273
274
275</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 273</span>

<span class='def def kw'>def</span> <span class='test? fid id'>test?</span>
  <span class='test_login? fid id'>test_login?</span> <span class='orop op'>||</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:test</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='super super kw'>super</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>void</h3>
</div><div id="void-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>void</span><span class='args'>(money, authorization, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Cancel a transaction that has been charged but has not yet made it through
the batch process.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


216
217
218
219
220
221
222
223
224</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/pay_junction.rb', line 216</span>

<span class='def def kw'>def</span> <span class='void identifier id'>void</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='parameters identifier id'>parameters</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:transaction_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span>
    <span class='symbol val'>:posture</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'void'</span>
  <span class='rbrace token'>}</span>
  
  <span class='add_optional_fields identifier id'>add_optional_fields</span><span class='lparen token'>(</span><span class='parameters identifier id'>parameters</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>                                          
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='string val'>'update'</span><span class='comma token'>,</span> <span class='parameters identifier id'>parameters</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>