<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: ActiveMerchant::Billing::DataCashGateway</title>
  </head>
  <body>
    <div id="content">
      <div class="section class ActiveMerchant_Billing_DataCashGateway">
  <h1 class="title">Class: ActiveMerchant::Billing::DataCashGateway</h1>
  <div class="section inheritance">
  <ul>
  <li><a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></li><ul><li>ActiveMerchant::Billing::DataCashGateway</li>
  </ul></ul>
</div><div class="section constants">
  <div class="thisclass">
  <h1>Constants</h1>
  <dl>
    
      <dt id="AUTH_TYPE-constant">AUTH_TYPE</dt>
      <dd>'auth'</dd>
    
      <dt id="CANCEL_TYPE-constant">CANCEL_TYPE</dt>
      <dd>'cancel'</dd>
    
      <dt id="DATACASH_SUCCESS-constant">DATACASH_SUCCESS</dt>
      <dd>'1'</dd>
    
      <dt id="FULFILL_TYPE-constant">FULFILL_TYPE</dt>
      <dd>'fulfill'</dd>
    
      <dt id="LIVE_URL-constant">LIVE_URL</dt>
      <dd>'https://mars.transaction.datacash.com/Transaction'</dd>
    
      <dt id="POLICY_ACCEPT-constant">POLICY_ACCEPT</dt>
      <dd>'accept'</dd>
    
      <dt id="POLICY_REJECT-constant">POLICY_REJECT</dt>
      <dd>'reject'</dd>
    
      <dt id="PRE_TYPE-constant">PRE_TYPE</dt>
      <dd>'pre'</dd>
    
      <dt id="REFUND_TYPE-constant">REFUND_TYPE</dt>
      <dd>'refund'</dd>
    
      <dt id="TEST_URL-constant">TEST_URL</dt>
      <dd>'https://testserver.datacash.com/Transaction'</dd>
    
      <dt id="TRANSACTION_REFUND_TYPE-constant">TRANSACTION_REFUND_TYPE</dt>
      <dd>'txn_refund'</dd>
    
  </dl>
</div>
<div class="inherited">
  
  <div>
    <h1>Constants Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#DEBIT_CARDS-constant' title='DEBIT_CARDS'>DEBIT_CARDS</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates a new DataCashGateway
</p>
<p>
The gateway requires that a valid login and password be passed in the
<tt>options</tt> hash.
</p>
<h4>Options</h4>
<ul>
<li><tt>:login</tt> &#8212; The Datacash account login.

</li>
<li><tt>:password</tt> &#8212; The Datacash account password.

</li>
<li><tt>:test =&gt; true or false</tt> &#8212; Use the test or live Datacash
url.

</li>
</ul>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


52
53
54
55
56</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 52</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='symbol val'>:login</span><span class='comma token'>,</span> <span class='symbol val'>:password</span><span class='rparen token'>)</span>
  <span class='@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span>
  <span class='super super kw'>super</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <div class="inherited">
  
  <div>
    <h1>Public Class Methods Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#card_brand-class_method' title='card_brand'>card_brand</a></span>, <span class='name'><a href='Gateway.html#inherited-class_method' title='inherited'>inherited</a></span>, <span class='name'><a href='Gateway.html#supports%3F-class_method' title='supports?'>supports?</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_authentication-instance_method' title='#add_authentication'>#add_authentication</a></span><span class='args'>(xml)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds the authentication element to the passed builder xml doc.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#add_credit_card-instance_method' title='#add_credit_card'>#add_credit_card</a></span><span class='args'>(xml, credit_card, address)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Add credit_card detals to the passed XML Builder doc.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#authorize-instance_method' title='#authorize'>#authorize</a></span><span class='args'>(money, authorization_or_credit_card, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Performs an authorization, which reserves the funds on the customer&#8217;s
credit card, but does not charge the card.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_purchase_or_authorization_request_with_continuous_authority_reference_request-instance_method' title='#build_purchase_or_authorization_request_with_continuous_authority_reference_request'>#build_purchase_or_authorization_request_with_continuous_authority_reference_request</a></span><span class='args'>(type, money, authorization, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create the xml document for an &#8216;auth&#8217; or &#8216;pre&#8217;
transaction with continuous authorization.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_purchase_or_authorization_request_with_credit_card_request-instance_method' title='#build_purchase_or_authorization_request_with_credit_card_request'>#build_purchase_or_authorization_request_with_credit_card_request</a></span><span class='args'>(type, money, credit_card, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create the xml document for an &#8216;auth&#8217; or &#8216;pre&#8217;
transaction with a credit card.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_refund_request-instance_method' title='#build_refund_request'>#build_refund_request</a></span><span class='args'>(money, credit_card, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create the xml document for a full or partial refund with.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_transaction_refund_request-instance_method' title='#build_transaction_refund_request'>#build_transaction_refund_request</a></span><span class='args'>(money, reference)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create the xml document for a full or partial refund transaction with.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_void_or_capture_request-instance_method' title='#build_void_or_capture_request'>#build_void_or_capture_request</a></span><span class='args'>(type, money, authorization, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create the xml document for a &#8216;cancel&#8217; or &#8216;fulfill&#8217;
transaction.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#capture-instance_method' title='#capture'>#capture</a></span><span class='args'>(money, authorization, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Captures the funds from an authorized transaction.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#commit-instance_method' title='#commit'>#commit</a></span><span class='args'>(request)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Send the passed data to DataCash for processing.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#credit-instance_method' title='#credit'>#credit</a></span><span class='args'>(money, reference_or_credit_card, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Refund to a card.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#format_date-instance_method' title='#format_date'>#format_date</a></span><span class='args'>(month, year)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns a date string in the format Datacash expects.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#format_reference_number-instance_method' title='#format_reference_number'>#format_reference_number</a></span><span class='args'>(number)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#parse-instance_method' title='#parse'>#parse</a></span><span class='args'>(body)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Parse the datacash response and create a Response object.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#parse_element-instance_method' title='#parse_element'>#parse_element</a></span><span class='args'>(response, node)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Parse an xml element.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#purchase-instance_method' title='#purchase'>#purchase</a></span><span class='args'>(money, authorization_or_credit_card, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Perform a purchase, which is essentially an authorization and capture in a
single operation.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#test%3F-instance_method' title='#test?'>#test?</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Is the gateway running in test mode?.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#void-instance_method' title='#void'>#void</a></span><span class='args'>(authorization, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Void a previous transaction.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h1>Public Instance Methods Inherited from <a href='Gateway.html' title='ActiveMerchant::Billing::Gateway'>ActiveMerchant::Billing::Gateway</a></h1>
    <p><span class='name'><a href='Gateway.html#amount-instance_method' title='amount'>amount</a></span>, <span class='name'><a href='Gateway.html#card_brand-instance_method' title='card_brand'>card_brand</a></span>, <span class='name'><a href='Gateway.html#currency-instance_method' title='currency'>currency</a></span>, <span class='name'><a href='Gateway.html#name-instance_method' title='name'>name</a></span>, <span class='name'><a href='Gateway.html#requires_start_date_or_issue_number%3F-instance_method' title='requires_start_date_or_issue_number?'>requires_start_date_or_issue_number?</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>add_authentication</h3>
</div><div id="add_authentication-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_authentication</span><span class='args'>(xml)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds the authentication element to the passed builder xml doc
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='xml identifier id'>xml</span><span class='colon op'>:</span> <span class='Builder constant id'>Builder</span> <span class='document identifier id'>document</span> <span class='that identifier id'>that</span> <span class='is identifier id'>is</span> <span class='being identifier id'>being</span> <span class='built identifier id'>built</span> <span class='up identifier id'>up</span>
</pre>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='none identifier id'>none</span><span class='colon op'>:</span> <span class='The constant id'>The</span> <span class='results identifier id'>results</span> <span class='is identifier id'>is</span> <span class='stored identifier id'>stored</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='passed identifier id'>passed</span> <span class='xml identifier id'>xml</span> <span class='document identifier id'>document</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


448
449
450
451
452
453</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 448</span>

<span class='def def kw'>def</span> <span class='add_authentication identifier id'>add_authentication</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Authentication</span> <span class='do do kw'>do</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:client</span><span class='comma token'>,</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:login</span><span class='rbrack token'>]</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:password</span><span class='comma token'>,</span> <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>add_credit_card</h3>
</div><div id="add_credit_card-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>add_credit_card</span><span class='args'>(xml, credit_card, address)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Add credit_card detals to the passed XML Builder doc
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='xml identifier id'>xml</span><span class='colon op'>:</span> <span class='Builder constant id'>Builder</span> <span class='document identifier id'>document</span> <span class='that identifier id'>that</span> <span class='is identifier id'>is</span> <span class='being identifier id'>being</span> <span class='built identifier id'>built</span> <span class='up identifier id'>up</span>
  <span class='minus op'>-</span><span class='credit_card identifier id'>credit_card</span><span class='colon op'>:</span> <span class='ActiveMerchant constant id'>ActiveMerchant</span><span class='colon2 op'>::</span><span class='Billing constant id'>Billing</span><span class='colon2 op'>::</span><span class='CreditCard constant id'>CreditCard</span> <span class='object identifier id'>object</span>
  <span class='minus op'>-</span><span class='billing_address identifier id'>billing_address</span><span class='colon op'>:</span> <span class='Hash constant id'>Hash</span> <span class='containing identifier id'>containing</span> <span class='all identifier id'>all</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='billing identifier id'>billing</span> <span class='address identifier id'>address</span> <span class='details identifier id'>details</span>
</pre>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='none identifier id'>none</span><span class='colon op'>:</span> <span class='The constant id'>The</span> <span class='results identifier id'>results</span> <span class='is identifier id'>is</span> <span class='stored identifier id'>stored</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='passed identifier id'>passed</span> <span class='xml identifier id'>xml</span> <span class='document identifier id'>document</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 465</span>

<span class='def def kw'>def</span> <span class='add_credit_card identifier id'>add_credit_card</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='rparen token'>)</span>
  
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Card</span> <span class='do do kw'>do</span>

    <span class='comment val'># DataCash calls the CC number 'pan'</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:pan</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='number identifier id'>number</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:expirydate</span><span class='comma token'>,</span> <span class='format_date identifier id'>format_date</span><span class='lparen token'>(</span><span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='month identifier id'>month</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='year identifier id'>year</span><span class='rparen token'>)</span>

    <span class='comment val'># optional values - for Solo etc</span>
    <span class='if if kw'>if</span> <span class='lbrack token'>[</span> <span class='string val'>'switch'</span><span class='comma token'>,</span> <span class='string val'>'solo'</span> <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='card_brand identifier id'>card_brand</span><span class='lparen token'>(</span><span class='credit_card identifier id'>credit_card</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
      
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:issuenumber</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='issue_number identifier id'>issue_number</span> <span class='unless unless_mod kw'>unless</span> <span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='issue_number identifier id'>issue_number</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>

      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='start_month identifier id'>start_month</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='start_year identifier id'>start_year</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:startdate</span><span class='comma token'>,</span> <span class='format_date identifier id'>format_date</span><span class='lparen token'>(</span><span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='start_month identifier id'>start_month</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='start_year identifier id'>start_year</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Cv2Avs</span> <span class='do do kw'>do</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:cv2</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='verification_value identifier id'>verification_value</span> <span class='if if_mod kw'>if</span> <span class='credit_card identifier id'>credit_card</span><span class='dot token'>.</span><span class='verification_value? fid id'>verification_value?</span>
      <span class='if if kw'>if</span> <span class='address identifier id'>address</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:street_address1</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address1</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:street_address2</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address2</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:street_address3</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address3</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address3</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:street_address4</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address4</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:address4</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:postcode</span><span class='comma token'>,</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:zip</span><span class='rbrack token'>]</span> <span class='unless unless_mod kw'>unless</span> <span class='address identifier id'>address</span><span class='lbrack token'>[</span><span class='symbol val'>:zip</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># The ExtendedPolicy defines what to do when the passed data </span>
      <span class='comment val'># matches, or not...</span>
      <span class='comment val'># </span>
      <span class='comment val'># All of the following elements MUST be present for the</span>
      <span class='comment val'># xml to be valid (or can drop the ExtendedPolicy and use</span>
      <span class='comment val'># a predefined one</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:ExtendedPolicy</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:cv2_policy</span><span class='comma token'>,</span> 
        <span class='symbol val'>:notprovided</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>   <span class='POLICY_REJECT constant id'>POLICY_REJECT</span><span class='comma token'>,</span>
        <span class='symbol val'>:notchecked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='POLICY_REJECT constant id'>POLICY_REJECT</span><span class='comma token'>,</span>
        <span class='symbol val'>:matched</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>       <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span><span class='comma token'>,</span>
        <span class='symbol val'>:notmatched</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='POLICY_REJECT constant id'>POLICY_REJECT</span><span class='comma token'>,</span>
        <span class='symbol val'>:partialmatch</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='POLICY_REJECT constant id'>POLICY_REJECT</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:postcode_policy</span><span class='comma token'>,</span>
        <span class='symbol val'>:notprovided</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>   <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span><span class='comma token'>,</span>
        <span class='symbol val'>:notchecked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span><span class='comma token'>,</span>
        <span class='symbol val'>:matched</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>       <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span><span class='comma token'>,</span>
        <span class='symbol val'>:notmatched</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='POLICY_REJECT constant id'>POLICY_REJECT</span><span class='comma token'>,</span>
        <span class='symbol val'>:partialmatch</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:address_policy</span><span class='comma token'>,</span> 
        <span class='symbol val'>:notprovided</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>   <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span><span class='comma token'>,</span>
        <span class='symbol val'>:notchecked</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span><span class='comma token'>,</span>
        <span class='symbol val'>:matched</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>       <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span><span class='comma token'>,</span>
        <span class='symbol val'>:notmatched</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>    <span class='POLICY_REJECT constant id'>POLICY_REJECT</span><span class='comma token'>,</span>
        <span class='symbol val'>:partialmatch</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='POLICY_ACCEPT constant id'>POLICY_ACCEPT</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>authorize</h3>
</div><div id="authorize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authorize</span><span class='args'>(money, authorization_or_credit_card, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Performs an authorization, which reserves the funds on the customer&#8217;s
credit card, but does not charge the card.
</p>
<h4>Parameters</h4>
<ul>
<li><tt>money</tt> The amount to be authorized. Either an Integer value in
cents or a Money object.

</li>
<li><tt>authorization_or_credit_card</tt>:: The continuous authority reference
or CreditCard details for the transaction.

</li>
<li><tt>options</tt> A hash of optional parameters.

<ul>
<li><tt>:order_id</tt> A unique reference for this order (corresponds to
merchantreference in datacash documentation)

</li>
<li><tt>:set_up_continuous_authority</tt>::

<pre class="code">
 <span class='Set constant id'>Set</span> <span class='to identifier id'>to</span> <span class='true true kw'>true</span> <span class='to identifier id'>to</span> <span class='set identifier id'>set</span> <span class='up identifier id'>up</span> <span class='a identifier id'>a</span> <span class='recurring identifier id'>recurring</span> <span class='historic identifier id'>historic</span> <span class='transaction identifier id'>transaction</span> <span class='account identifier id'>account</span> <span class='be identifier id'>be</span> <span class='set identifier id'>set</span> <span class='up identifier id'>up</span><span class='dot token'>.</span>
 <span class='Only constant id'>Only</span> <span class='supported identifier id'>supported</span> <span class='for for kw'>for</span> <span class='colon op'>:</span><span class='visa identifier id'>visa</span><span class='comma token'>,</span> <span class='symbol val'>:master</span> <span class='and and kw'>and</span> <span class='symbol val'>:american_express</span> <span class='card identifier id'>card</span> <span class='types identifier id'>types</span>
 <span class='See constant id'>See</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.datacash.com/s</span><span class='ervices identifier id'>ervices</span><span class='div op'>/</span><span class='recurring identifier id'>recurring</span><span class='div op'>/</span><span class='historic identifier id'>historic</span><span class='dot token'>.</span><span class='php identifier id'>php</span> <span class='for for kw'>for</span> <span class='more identifier id'>more</span> <span class='details identifier id'>details</span> <span class='of identifier id'>of</span> <span class='historic identifier id'>historic</span> <span class='transactions identifier id'>transactions</span><span class='dot token'>.</span>
</pre>
</li>
<li><tt>:address</tt>:: billing address for card

</li>
</ul>
</li>
</ul>
<p>
The continuous authority reference will be available in
response#params[&#8216;ca_referece&#8217;] if you have requested one
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


100
101
102
103
104
105
106
107
108
109
110</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 100</span>

<span class='def def kw'>def</span> <span class='authorize identifier id'>authorize</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='symbol val'>:order_id</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='build_purchase_or_authorization_request_with_continuous_authority_reference_request identifier id'>build_purchase_or_authorization_request_with_continuous_authority_reference_request</span><span class='lparen token'>(</span><span class='AUTH_TYPE constant id'>AUTH_TYPE</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='build_purchase_or_authorization_request_with_credit_card_request identifier id'>build_purchase_or_authorization_request_with_credit_card_request</span><span class='lparen token'>(</span><span class='PRE_TYPE constant id'>PRE_TYPE</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_purchase_or_authorization_request_with_continuous_authority_reference_request</h3>
</div><div id="build_purchase_or_authorization_request_with_continuous_authority_reference_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_purchase_or_authorization_request_with_continuous_authority_reference_request</span><span class='args'>(type, money, authorization, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create the xml document for an &#8216;auth&#8217; or &#8216;pre&#8217;
transaction with continuous authorization
</p>
<p>
Final XML should look like:
</p>
<p>
&lt;Request&gt;
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='Transaction constant id'>Transaction</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='ContAuthTxn constant id'>ContAuthTxn</span> <span class='type identifier id'>type</span><span class='assign token'>=</span><span class='string val'>&quot;historic&quot;</span> <span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='TxnDetails constant id'>TxnDetails</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='merchantreference identifier id'>merchantreference</span><span class='gt op'>&gt;</span><span class='integer val'>3851231</span><span class='lt op'>&lt;</span><span class='regexp val'>/merchantreference&gt;
      &lt;capturemethod&gt;cont_auth&lt;/</span><span class='capturemethod identifier id'>capturemethod</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='amount identifier id'>amount</span> <span class='currency identifier id'>currency</span><span class='assign token'>=</span><span class='string val'>&quot;GBP&quot;</span><span class='gt op'>&gt;</span><span class='float val'>18.50</span><span class='lt op'>&lt;</span><span class='regexp val'>/amount&gt;
    &lt;/</span><span class='TxnDetails constant id'>TxnDetails</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='HistoricTxn constant id'>HistoricTxn</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='reference identifier id'>reference</span><span class='gt op'>&gt;</span><span class='integer val'>4500200040925092</span><span class='lt op'>&lt;</span><span class='regexp val'>/reference&gt;
      &lt;method&gt;auth&lt;/</span><span class='method identifier id'>method</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='regexp val'>/HistoricTxn&gt;
  &lt;/</span><span class='Transaction constant id'>Transaction</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='Authentication constant id'>Authentication</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='client identifier id'>client</span><span class='gt op'>&gt;</span><span class='integer val'>99000001</span><span class='lt op'>&lt;</span><span class='regexp val'>/client&gt;
    &lt;password&gt;mypasswd&lt;/</span><span class='password identifier id'>password</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/Authentication&gt;
</span></pre>
<p>
&lt;/Request&gt;
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='type identifier id'>type</span> <span class='must identifier id'>must</span> <span class='be identifier id'>be</span> <span class='string val'>'auth'</span> <span class='or or kw'>or</span> <span class='string val'>'pre'</span>
  <span class='minus op'>-</span><span class='money identifier id'>money</span> <span class='minus op'>-</span> <span class='A constant id'>A</span> <span class='money identifier id'>money</span> <span class='object identifier id'>object</span> <span class='with identifier id'>with</span> <span class='the identifier id'>the</span> <span class='price identifier id'>price</span> <span class='and and kw'>and</span> <span class='currency identifier id'>currency</span>
  <span class='minus op'>-</span><span class='authorization identifier id'>authorization</span> <span class='minus op'>-</span> <span class='The constant id'>The</span> <span class='authorization identifier id'>authorization</span> <span class='containing identifier id'>containing</span> <span class='a identifier id'>a</span> <span class='continuous identifier id'>continuous</span> <span class='authority identifier id'>authority</span> <span class='reference identifier id'>reference</span> <span class='previously identifier id'>previously</span> <span class='set identifier id'>set</span> <span class='up identifier id'>up</span> <span class='on identifier id'>on</span> <span class='a identifier id'>a</span> <span class='credit identifier id'>credit</span> <span class='card identifier id'>card</span>
  <span class='minus op'>-</span><span class='options identifier id'>options</span><span class='colon op'>:</span>
    <span class='symbol val'>:order_id</span> <span class='is identifier id'>is</span> <span class='the identifier id'>the</span> <span class='merchant identifier id'>merchant</span> <span class='reference identifier id'>reference</span> <span class='number identifier id'>number</span>
</pre>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='xml identifier id'>xml</span><span class='colon op'>:</span> <span class='Builder constant id'>Builder</span> <span class='document identifier id'>document</span> <span class='containing identifier id'>containing</span> <span class='the identifier id'>the</span> <span class='markup identifier id'>markup</span>
</pre>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 332</span>

<span class='def def kw'>def</span> <span class='build_purchase_or_authorization_request_with_continuous_authority_reference_request identifier id'>build_purchase_or_authorization_request_with_continuous_authority_reference_request</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='reference identifier id'>reference</span><span class='comma token'>,</span> <span class='auth_code identifier id'>auth_code</span><span class='comma token'>,</span> <span class='ca_reference identifier id'>ca_reference</span> <span class='assign token'>=</span> <span class='authorization identifier id'>authorization</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>';'</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;The continuous authority reference is required for continuous authority transactions&quot;</span> <span class='if if_mod kw'>if</span> <span class='ca_reference identifier id'>ca_reference</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>

  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='instruct! fid id'>instruct!</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Request</span> <span class='do do kw'>do</span>
    <span class='add_authentication identifier id'>add_authentication</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Transaction</span> <span class='do do kw'>do</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:ContAuthTxn</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'historic'</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:HistoricTxn</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:reference</span><span class='comma token'>,</span> <span class='ca_reference identifier id'>ca_reference</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:method</span><span class='comma token'>,</span> <span class='type identifier id'>type</span>
      <span class='end end kw'>end</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:TxnDetails</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:merchantreference</span><span class='comma token'>,</span> <span class='format_reference_number identifier id'>format_reference_number</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:amount</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:currency</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:currency</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='currency identifier id'>currency</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:capturemethod</span><span class='comma token'>,</span> <span class='string val'>'cont_auth'</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_purchase_or_authorization_request_with_credit_card_request</h3>
</div><div id="build_purchase_or_authorization_request_with_credit_card_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_purchase_or_authorization_request_with_credit_card_request</span><span class='args'>(type, money, credit_card, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create the xml document for an &#8216;auth&#8217; or &#8216;pre&#8217;
transaction with a credit card
</p>
<p>
Final XML should look like:
</p>
<p>
&lt;Request&gt;
</p>
<pre class="code">
 <span class='lt op'>&lt;</span><span class='Authentication constant id'>Authentication</span><span class='gt op'>&gt;</span>
   <span class='lt op'>&lt;</span><span class='client identifier id'>client</span><span class='gt op'>&gt;</span><span class='integer val'>99000000</span><span class='lt op'>&lt;</span><span class='regexp val'>/client&gt;
   &lt;password&gt;*******&lt;/</span><span class='password identifier id'>password</span><span class='gt op'>&gt;</span>
 <span class='lt op'>&lt;</span><span class='regexp val'>/Authentication&gt;
 &lt;Transaction&gt;
   &lt;TxnDetails&gt;
     &lt;merchantreference&gt;123456&lt;/</span><span class='merchantreference identifier id'>merchantreference</span><span class='gt op'>&gt;</span>
     <span class='lt op'>&lt;</span><span class='amount identifier id'>amount</span> <span class='currency identifier id'>currency</span><span class='assign token'>=</span><span class='string val'>&quot;EUR&quot;</span><span class='gt op'>&gt;</span><span class='float val'>10.00</span><span class='lt op'>&lt;</span><span class='regexp val'>/amount&gt;
   &lt;/</span><span class='TxnDetails constant id'>TxnDetails</span><span class='gt op'>&gt;</span>
   <span class='lt op'>&lt;</span><span class='CardTxn constant id'>CardTxn</span><span class='gt op'>&gt;</span>
     <span class='lt op'>&lt;</span><span class='Card constant id'>Card</span><span class='gt op'>&gt;</span>
       <span class='lt op'>&lt;</span><span class='pan identifier id'>pan</span><span class='gt op'>&gt;</span><span class='integer val'>4444</span><span class='pow op'>**</span><span class='pow op'>**</span><span class='pow op'>**</span><span class='pow op'>**</span><span class='integer val'>1111</span><span class='lt op'>&lt;</span><span class='regexp val'>/pan&gt;
       &lt;expirydate&gt;03/</span><span class='integer val'>04</span><span class='lt op'>&lt;</span><span class='regexp val'>/expirydate&gt;
       &lt;Cv2Avs&gt;
         &lt;street_address1&gt;Flat 7&lt;/s</span><span class='treet_address1 identifier id'>treet_address1</span><span class='gt op'>&gt;</span>
         <span class='lt op'>&lt;</span><span class='street_address2 identifier id'>street_address2</span><span class='gt op'>&gt;</span><span class='integer val'>89</span> <span class='Jumble constant id'>Jumble</span>
              <span class='Street constant id'>Street</span><span class='lt op'>&lt;</span><span class='regexp val'>/street_address2&gt;
         &lt;street_address3&gt;Mytown&lt;/s</span><span class='treet_address3 identifier id'>treet_address3</span><span class='gt op'>&gt;</span>
         <span class='lt op'>&lt;</span><span class='postcode identifier id'>postcode</span><span class='gt op'>&gt;</span><span class='AV12FR constant id'>AV12FR</span><span class='lt op'>&lt;</span><span class='regexp val'>/postcode&gt;
         &lt;cv2&gt;123&lt;/</span><span class='cv2 identifier id'>cv2</span><span class='gt op'>&gt;</span>
          <span class='lt op'>&lt;</span><span class='ExtendedPolicy constant id'>ExtendedPolicy</span><span class='gt op'>&gt;</span>
            <span class='lt op'>&lt;</span><span class='cv2_policy identifier id'>cv2_policy</span> <span class='notprovided identifier id'>notprovided</span><span class='assign token'>=</span><span class='string val'>&quot;reject&quot;</span>
                         <span class='notchecked identifier id'>notchecked</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span>
                         <span class='matched identifier id'>matched</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span>
                         <span class='notmatched identifier id'>notmatched</span><span class='assign token'>=</span><span class='string val'>&quot;reject&quot;</span>
                         <span class='partialmatch identifier id'>partialmatch</span><span class='assign token'>=</span><span class='string val'>&quot;reject&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
            <span class='lt op'>&lt;</span><span class='postcode_policy identifier id'>postcode_policy</span> <span class='notprovided identifier id'>notprovided</span><span class='assign token'>=</span><span class='string val'>&quot;reject&quot;</span>
                         <span class='notchecked identifier id'>notchecked</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span>
                         <span class='matched identifier id'>matched</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span>
                         <span class='notmatched identifier id'>notmatched</span><span class='assign token'>=</span><span class='string val'>&quot;reject&quot;</span>
                         <span class='partialmatch identifier id'>partialmatch</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
            <span class='lt op'>&lt;</span><span class='address_policy identifier id'>address_policy</span> <span class='notprovided identifier id'>notprovided</span><span class='assign token'>=</span><span class='string val'>&quot;reject&quot;</span>
                         <span class='notchecked identifier id'>notchecked</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span>
                         <span class='matched identifier id'>matched</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span>
                         <span class='notmatched identifier id'>notmatched</span><span class='assign token'>=</span><span class='string val'>&quot;reject&quot;</span>
                         <span class='partialmatch identifier id'>partialmatch</span><span class='assign token'>=</span><span class='string val'>&quot;accept&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
          <span class='lt op'>&lt;</span><span class='regexp val'>/ExtendedPolicy&gt;
       &lt;/</span><span class='Cv2Avs constant id'>Cv2Avs</span><span class='gt op'>&gt;</span>
     <span class='lt op'>&lt;</span><span class='regexp val'>/Card&gt;
     &lt;method&gt;auth&lt;/</span><span class='method identifier id'>method</span><span class='gt op'>&gt;</span>
   <span class='lt op'>&lt;</span><span class='regexp val'>/CardTxn&gt;
 &lt;/</span><span class='Transaction constant id'>Transaction</span><span class='gt op'>&gt;</span>
</pre>
<p>
&lt;/Request&gt;
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='type identifier id'>type</span> <span class='must identifier id'>must</span> <span class='be identifier id'>be</span> <span class='string val'>'auth'</span> <span class='or or kw'>or</span> <span class='string val'>'pre'</span>
  <span class='minus op'>-</span><span class='money identifier id'>money</span> <span class='minus op'>-</span> <span class='A constant id'>A</span> <span class='money identifier id'>money</span> <span class='object identifier id'>object</span> <span class='with identifier id'>with</span> <span class='the identifier id'>the</span> <span class='price identifier id'>price</span> <span class='and and kw'>and</span> <span class='currency identifier id'>currency</span>
  <span class='minus op'>-</span><span class='credit_card identifier id'>credit_card</span> <span class='minus op'>-</span> <span class='The constant id'>The</span> <span class='credit_card identifier id'>credit_card</span> <span class='details identifier id'>details</span> <span class='to identifier id'>to</span> <span class='use identifier id'>use</span>
  <span class='minus op'>-</span><span class='options identifier id'>options</span><span class='colon op'>:</span>
    <span class='symbol val'>:order_id</span> <span class='is identifier id'>is</span> <span class='the identifier id'>the</span> <span class='merchant identifier id'>merchant</span> <span class='reference identifier id'>reference</span> <span class='number identifier id'>number</span>
    <span class='symbol val'>:billing_address</span> <span class='is identifier id'>is</span> <span class='the identifier id'>the</span> <span class='billing identifier id'>billing</span> <span class='address identifier id'>address</span> <span class='for for kw'>for</span> <span class='the identifier id'>the</span> <span class='cc identifier id'>cc</span>
    <span class='symbol val'>:address</span> <span class='is identifier id'>is</span> <span class='the identifier id'>the</span> <span class='delivery identifier id'>delivery</span> <span class='address identifier id'>address</span>
</pre>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='xml identifier id'>xml</span><span class='colon op'>:</span> <span class='Builder constant id'>Builder</span> <span class='document identifier id'>document</span> <span class='containing identifier id'>containing</span> <span class='the identifier id'>the</span> <span class='markup identifier id'>markup</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 275</span>

<span class='def def kw'>def</span> <span class='build_purchase_or_authorization_request_with_credit_card_request identifier id'>build_purchase_or_authorization_request_with_credit_card_request</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='instruct! fid id'>instruct!</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Request</span> <span class='do do kw'>do</span>
    <span class='add_authentication identifier id'>add_authentication</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
    
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Transaction</span> <span class='do do kw'>do</span>
      <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='set_up_continuous_authority identifier id'>set_up_continuous_authority</span><span class='rbrack token'>]</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:ContAuthTxn</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'setup'</span>
      <span class='end end kw'>end</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:CardTxn</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:method</span><span class='comma token'>,</span> <span class='type identifier id'>type</span>
        <span class='add_credit_card identifier id'>add_credit_card</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:billing_address</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:TxnDetails</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:merchantreference</span><span class='comma token'>,</span> <span class='format_reference_number identifier id'>format_reference_number</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:amount</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:currency</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:currency</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='currency identifier id'>currency</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_refund_request</h3>
</div><div id="build_refund_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_refund_request</span><span class='args'>(money, credit_card, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create the xml document for a full or partial refund with
</p>
<p>
Final XML should look like:
</p>
<p>
&lt;Request&gt;
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='Authentication constant id'>Authentication</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='client identifier id'>client</span><span class='gt op'>&gt;</span><span class='integer val'>99000001</span><span class='lt op'>&lt;</span><span class='regexp val'>/client&gt;
    &lt;password&gt;*****&lt;/</span><span class='password identifier id'>password</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/Authentication&gt;
  &lt;Transaction&gt;
    &lt;CardTxn&gt;
      &lt;Card&gt;
        &lt;pan&gt;633300*********1&lt;/</span><span class='pan identifier id'>pan</span><span class='gt op'>&gt;</span>
        <span class='lt op'>&lt;</span><span class='expirydate identifier id'>expirydate</span><span class='gt op'>&gt;</span><span class='integer val'>04</span><span class='div op'>/</span><span class='integer val'>06</span><span class='lt op'>&lt;</span><span class='regexp val'>/expirydate&gt;
        &lt;startdate&gt;01/</span><span class='integer val'>04</span><span class='lt op'>&lt;</span><span class='regexp val'>/startdate&gt;
      &lt;/</span><span class='Card constant id'>Card</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='method identifier id'>method</span><span class='gt op'>&gt;</span><span class='refund identifier id'>refund</span><span class='lt op'>&lt;</span><span class='regexp val'>/method&gt;
    &lt;/</span><span class='CardTxn constant id'>CardTxn</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='TxnDetails constant id'>TxnDetails</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='merchantreference identifier id'>merchantreference</span><span class='gt op'>&gt;</span><span class='integer val'>1000001</span><span class='lt op'>&lt;</span><span class='regexp val'>/merchantreference&gt;
      &lt;amount currency=&quot;GBP&quot;&gt;95.99&lt;/</span><span class='amount identifier id'>amount</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='regexp val'>/TxnDetails&gt;
  &lt;/</span><span class='Transaction constant id'>Transaction</span><span class='gt op'>&gt;</span>
</pre>
<p>
&lt;/Request&gt;
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 420</span>

<span class='def def kw'>def</span> <span class='build_refund_request identifier id'>build_refund_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='instruct! fid id'>instruct!</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Request</span> <span class='do do kw'>do</span>
    <span class='add_authentication identifier id'>add_authentication</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Transaction</span> <span class='do do kw'>do</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:CardTxn</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:method</span><span class='comma token'>,</span> <span class='REFUND_TYPE constant id'>REFUND_TYPE</span>
        <span class='add_credit_card identifier id'>add_credit_card</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='credit_card identifier id'>credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:billing_address</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:TxnDetails</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:merchantreference</span><span class='comma token'>,</span> <span class='format_reference_number identifier id'>format_reference_number</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:amount</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_transaction_refund_request</h3>
</div><div id="build_transaction_refund_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_transaction_refund_request</span><span class='args'>(money, reference)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create the xml document for a full or partial refund transaction with
</p>
<p>
Final XML should look like:
</p>
<p>
&lt;Request&gt;
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='Authentication constant id'>Authentication</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='client identifier id'>client</span><span class='gt op'>&gt;</span><span class='integer val'>99000001</span><span class='lt op'>&lt;</span><span class='regexp val'>/client&gt;
    &lt;password&gt;*******&lt;/</span><span class='password identifier id'>password</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/Authentication&gt;
  &lt;Transaction&gt;
    &lt;HistoricTxn&gt;
      &lt;method&gt;txn_refund&lt;/</span><span class='method identifier id'>method</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='reference identifier id'>reference</span><span class='gt op'>&gt;</span><span class='integer val'>12345678</span><span class='lt op'>&lt;</span><span class='regexp val'>/reference&gt;
    &lt;/</span><span class='HistoricTxn constant id'>HistoricTxn</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='TxnDetails constant id'>TxnDetails</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='amount identifier id'>amount</span><span class='gt op'>&gt;</span><span class='float val'>10.00</span><span class='lt op'>&lt;</span><span class='regexp val'>/amount&gt;
    &lt;/</span><span class='TxnDetails constant id'>TxnDetails</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/Transaction&gt;
</span></pre>
<p>
&lt;/Request&gt;
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 376</span>

<span class='def def kw'>def</span> <span class='build_transaction_refund_request identifier id'>build_transaction_refund_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='reference identifier id'>reference</span><span class='rparen token'>)</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='instruct! fid id'>instruct!</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Request</span> <span class='do do kw'>do</span>
    <span class='add_authentication identifier id'>add_authentication</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Transaction</span> <span class='do do kw'>do</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:HistoricTxn</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:reference</span><span class='comma token'>,</span> <span class='reference identifier id'>reference</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:method</span><span class='comma token'>,</span> <span class='TRANSACTION_REFUND_TYPE constant id'>TRANSACTION_REFUND_TYPE</span>
      <span class='end end kw'>end</span>
      <span class='unless unless kw'>unless</span> <span class='money identifier id'>money</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:TxnDetails</span> <span class='do do kw'>do</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:amount</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_void_or_capture_request</h3>
</div><div id="build_void_or_capture_request-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_void_or_capture_request</span><span class='args'>(type, money, authorization, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create the xml document for a &#8216;cancel&#8217; or &#8216;fulfill&#8217;
transaction.
</p>
<p>
Final XML should look like: &lt;Request&gt;
</p>
<pre class="code">
 <span class='lt op'>&lt;</span><span class='Authentication constant id'>Authentication</span><span class='gt op'>&gt;</span>
   <span class='lt op'>&lt;</span><span class='client identifier id'>client</span><span class='gt op'>&gt;</span><span class='integer val'>99000001</span><span class='lt op'>&lt;</span><span class='regexp val'>/client&gt;
   &lt;password&gt;******&lt;/</span><span class='password identifier id'>password</span><span class='gt op'>&gt;</span>
 <span class='lt op'>&lt;</span><span class='regexp val'>/Authentication&gt;
 &lt;Transaction&gt;
   &lt;TxnDetails&gt;
     &lt;amount&gt;25.00&lt;/</span><span class='amount identifier id'>amount</span><span class='gt op'>&gt;</span>
   <span class='lt op'>&lt;</span><span class='regexp val'>/TxnDetails&gt;
   &lt;HistoricTxn&gt;
     &lt;reference&gt;4900200000000001&lt;/</span><span class='reference identifier id'>reference</span><span class='gt op'>&gt;</span>
     <span class='lt op'>&lt;</span><span class='authcode identifier id'>authcode</span><span class='gt op'>&gt;</span><span class='A6 constant id'>A6</span><span class='lt op'>&lt;</span><span class='regexp val'>/authcode&gt;
     &lt;method&gt;fulfill&lt;/</span><span class='method identifier id'>method</span><span class='gt op'>&gt;</span>
   <span class='lt op'>&lt;</span><span class='regexp val'>/HistoricTxn&gt;
 &lt;/</span><span class='Transaction constant id'>Transaction</span><span class='gt op'>&gt;</span>
</pre>
<p>
&lt;/Request&gt;
</p>
<p>
Parameters:
</p>
<ul>
<li><tt>type</tt> must be FULFILL_TYPE or CANCEL_TYPE

</li>
<li><tt>money</tt> - optional - Money object or value in cents

</li>
<li><tt>authorization</tt> - the Datacash authorization from a previous
succesful authorize transaction

</li>
<li><tt>options</tt>

<ul>
<li><tt>order_id</tt> - A unique reference for the transaction

</li>
</ul>
</li>
</ul>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='Builder constant id'>Builder</span> <span class='xml identifier id'>xml</span> <span class='document identifier id'>document</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 188</span>

<span class='def def kw'>def</span> <span class='build_void_or_capture_request identifier id'>build_void_or_capture_request</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='reference identifier id'>reference</span><span class='comma token'>,</span> <span class='auth_code identifier id'>auth_code</span><span class='comma token'>,</span> <span class='ca_reference identifier id'>ca_reference</span> <span class='assign token'>=</span> <span class='authorization identifier id'>authorization</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>';'</span><span class='rparen token'>)</span>

  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='Builder constant id'>Builder</span><span class='colon2 op'>::</span><span class='XmlMarkup constant id'>XmlMarkup</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:indent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='instruct! fid id'>instruct!</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Request</span> <span class='do do kw'>do</span>
    <span class='add_authentication identifier id'>add_authentication</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='rparen token'>)</span>
    
    <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:Transaction</span> <span class='do do kw'>do</span>
      <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:HistoricTxn</span> <span class='do do kw'>do</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:reference</span><span class='comma token'>,</span> <span class='reference identifier id'>reference</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:authcode</span><span class='comma token'>,</span> <span class='auth_code identifier id'>auth_code</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:method</span><span class='comma token'>,</span> <span class='type identifier id'>type</span>
      <span class='end end kw'>end</span>
      
      <span class='if if kw'>if</span> <span class='money identifier id'>money</span>
        <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:TxnDetails</span> <span class='do do kw'>do</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:merchantreference</span><span class='comma token'>,</span> <span class='format_reference_number identifier id'>format_reference_number</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:order_id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
          <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='tag! fid id'>tag!</span> <span class='symbol val'>:amount</span><span class='comma token'>,</span> <span class='amount identifier id'>amount</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:currency</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:currency</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='currency identifier id'>currency</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='xml identifier id'>xml</span><span class='dot token'>.</span><span class='target! fid id'>target!</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>capture</h3>
</div><div id="capture-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>capture</span><span class='args'>(money, authorization, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Captures the funds from an authorized transaction.
</p>
<h4>Parameters</h4>
<ul>
<li><tt>money</tt> &#8212; The amount to be captured. Either an Integer value
in cents or a Money object.

</li>
<li><tt>authorization</tt> &#8212; The authorization returned from the previous
authorize request.

</li>
</ul>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


118
119
120</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 118</span>

<span class='def def kw'>def</span> <span class='capture identifier id'>capture</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='build_void_or_capture_request identifier id'>build_void_or_capture_request</span><span class='lparen token'>(</span><span class='FULFILL_TYPE constant id'>FULFILL_TYPE</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>                    
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>commit</h3>
</div><div id="commit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>commit</span><span class='args'>(request)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Send the passed data to DataCash for processing
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='request identifier id'>request</span><span class='colon op'>:</span> <span class='The constant id'>The</span> <span class='XML constant id'>XML</span> <span class='data identifier id'>data</span> <span class='that identifier id'>that</span> <span class='is identifier id'>is</span> <span class='to identifier id'>to</span> <span class='be identifier id'>be</span> <span class='sent identifier id'>sent</span> <span class='to identifier id'>to</span> <span class='Datacash constant id'>Datacash</span>
</pre>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span> <span class='ActiveMerchant constant id'>ActiveMerchant</span><span class='colon2 op'>::</span><span class='Billing constant id'>Billing</span><span class='colon2 op'>::</span><span class='Response constant id'>Response</span> <span class='object identifier id'>object</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


531
532
533
534
535
536
537
538</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 531</span>

<span class='def def kw'>def</span> <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='ssl_post identifier id'>ssl_post</span><span class='lparen token'>(</span><span class='test? fid id'>test?</span> <span class='integer val'>? </span><span class='TEST_URL constant id'>TEST_URL</span> <span class='colon op'>:</span> <span class='LIVE_URL constant id'>LIVE_URL</span><span class='comma token'>,</span> <span class='request identifier id'>request</span><span class='rparen token'>)</span><span class='rparen token'>)</span>      

  <span class='Response constant id'>Response</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:status</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='DATACASH_SUCCESS constant id'>DATACASH_SUCCESS</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='symbol val'>:reason</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='comma token'>,</span>
    <span class='symbol val'>:test</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='test? fid id'>test?</span><span class='comma token'>,</span>
    <span class='symbol val'>:authorization</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{response[:datacash_reference]};#{response[:authcode]};#{response[:ca_reference]}&quot;</span>
  <span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>credit</h3>
</div><div id="credit-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>credit</span><span class='args'>(money, reference_or_credit_card, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Refund to a card
</p>
<h4>Parameters</h4>
<ul>
<li><tt>money</tt> The amount to be refunded. Either an Integer value in cents
or a Money object. Set to nil for a full refund on existing transaction.

</li>
<li><tt>reference_or_credit_card</tt> The credit card you want to refund OR the
datacash_reference for the existing transaction you are refunding

</li>
<li><tt>options</tt> Are ignored when refunding via reference to an existing
transaction, otherwise

<ul>
<li><tt>:order_id</tt> A unique reference for this order (corresponds to
merchantreference in datacash documentation)

</li>
<li><tt>:address</tt>:: billing address for card

</li>
</ul>
</li>
</ul>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


142
143
144
145
146
147
148
149
150</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 142</span>

<span class='def def kw'>def</span> <span class='credit identifier id'>credit</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='reference_or_credit_card identifier id'>reference_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='reference_or_credit_card identifier id'>reference_or_credit_card</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='build_transaction_refund_request identifier id'>build_transaction_refund_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='reference_or_credit_card identifier id'>reference_or_credit_card</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='build_refund_request identifier id'>build_refund_request</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='reference_or_credit_card identifier id'>reference_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>format_date</h3>
</div><div id="format_date-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>format_date</span><span class='args'>(month, year)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns a date string in the format Datacash expects
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='month identifier id'>month</span><span class='colon op'>:</span> <span class='integer identifier id'>integer</span><span class='comma token'>,</span> <span class='the identifier id'>the</span> <span class='month identifier id'>month</span>
  <span class='minus op'>-</span><span class='year identifier id'>year</span><span class='colon op'>:</span> <span class='integer identifier id'>integer</span><span class='comma token'>,</span> <span class='the identifier id'>the</span> <span class='year identifier id'>year</span>
</pre>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='String constant id'>String</span><span class='colon op'>:</span> <span class='date identifier id'>date</span> <span class='in in kw'>in</span> <span class='MM constant id'>MM</span><span class='div op'>/</span><span class='YY constant id'>YY</span> <span class='format identifier id'>format</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


549
550
551</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 549</span>

<span class='def def kw'>def</span> <span class='format_date identifier id'>format_date</span><span class='lparen token'>(</span><span class='month identifier id'>month</span><span class='comma token'>,</span> <span class='year identifier id'>year</span><span class='rparen token'>)</span>
  <span class='dstring node'>&quot;#{format(month,:two_digits)}/#{format(year, :two_digits)}&quot;</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>format_reference_number</h3>
</div><div id="format_reference_number-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>format_reference_number</span><span class='args'>(number)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


590
591
592</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 590</span>

<span class='def def kw'>def</span> <span class='format_reference_number identifier id'>format_reference_number</span><span class='lparen token'>(</span><span class='number identifier id'>number</span><span class='rparen token'>)</span>
  <span class='number identifier id'>number</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/[^A-Za-z0-9]/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rjust identifier id'>rjust</span><span class='lparen token'>(</span><span class='integer val'>6</span><span class='comma token'>,</span> <span class='string val'>&quot;0&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='integer val'>30</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>parse</h3>
</div><div id="parse-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>parse</span><span class='args'>(body)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Parse the datacash response and create a Response object
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='body identifier id'>body</span><span class='colon op'>:</span> <span class='The constant id'>The</span> <span class='XML constant id'>XML</span> <span class='returned identifier id'>returned</span> <span class='from identifier id'>from</span> <span class='Datacash constant id'>Datacash</span>
</pre>
<p>
Returns:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='hash identifier id'>hash</span> <span class='with identifier id'>with</span> <span class='all identifier id'>all</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='values identifier id'>values</span> <span class='returned identifier id'>returned</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='Datacash constant id'>Datacash</span> <span class='XML constant id'>XML</span> <span class='response identifier id'>response</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


561
562
563
564
565
566
567
568
569
570
571
572</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 561</span>

<span class='def def kw'>def</span> <span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='body identifier id'>body</span><span class='rparen token'>)</span>

  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='xml identifier id'>xml</span> <span class='assign token'>=</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='body identifier id'>body</span><span class='rparen token'>)</span>
  <span class='root identifier id'>root</span> <span class='assign token'>=</span> <span class='REXML constant id'>REXML</span><span class='colon2 op'>::</span><span class='XPath constant id'>XPath</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='xml identifier id'>xml</span><span class='comma token'>,</span> <span class='string val'>&quot;//Response&quot;</span><span class='rparen token'>)</span>

  <span class='root identifier id'>root</span><span class='dot token'>.</span><span class='elements identifier id'>elements</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='node identifier id'>node</span><span class='bitor op'>|</span>
    <span class='parse_element identifier id'>parse_element</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='comma token'>,</span> <span class='node identifier id'>node</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='response identifier id'>response</span>
<span class='end end kw'>end</span>     
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>parse_element</h3>
</div><div id="parse_element-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>parse_element</span><span class='args'>(response, node)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Parse an xml element
</p>
<p>
Parameters:
</p>
<pre class="code">
  <span class='minus op'>-</span><span class='response identifier id'>response</span><span class='colon op'>:</span> <span class='The constant id'>The</span> <span class='hash identifier id'>hash</span> <span class='that identifier id'>that</span> <span class='the identifier id'>the</span> <span class='values identifier id'>values</span> <span class='are identifier id'>are</span> <span class='being identifier id'>being</span> <span class='returned identifier id'>returned</span> <span class='in in kw'>in</span>
  <span class='minus op'>-</span><span class='node identifier id'>node</span><span class='colon op'>:</span> <span class='The constant id'>The</span> <span class='node identifier id'>node</span> <span class='that identifier id'>that</span> <span class='is identifier id'>is</span> <span class='currently identifier id'>currently</span> <span class='being identifier id'>being</span> <span class='read identifier id'>read</span>
</pre>
<p>
Returns:
</p>
<ul>
<li>none (results are stored in the passed hash)

</li>
</ul>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


582
583
584
585
586
587
588</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 582</span>

<span class='def def kw'>def</span> <span class='parse_element identifier id'>parse_element</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='comma token'>,</span> <span class='node identifier id'>node</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='has_elements? fid id'>has_elements?</span>
    <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='elements identifier id'>elements</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='e identifier id'>e</span><span class='bitor op'>|</span> <span class='parse_element identifier id'>parse_element</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='node identifier id'>node</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='underscore identifier id'>underscore</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='node identifier id'>node</span><span class='dot token'>.</span><span class='text identifier id'>text</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>purchase</h3>
</div><div id="purchase-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>purchase</span><span class='args'>(money, authorization_or_credit_card, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Perform a purchase, which is essentially an authorization and capture in a
single operation.
</p>
<h4>Parameters</h4>
<ul>
<li><tt>money</tt> The amount to be authorized. Either an Integer value in
cents or a Money object.

</li>
<li><tt>authorization_or_credit_card</tt>:: The continuous authority reference
or CreditCard details for the transaction.

</li>
<li><tt>options</tt> A hash of optional parameters.

<ul>
<li><tt>:order_id</tt> A unique reference for this order (corresponds to
merchantreference in datacash documentation)

</li>
<li><tt>:set_up_continuous_authority</tt>

<pre class="code">
 <span class='Set constant id'>Set</span> <span class='to identifier id'>to</span> <span class='true true kw'>true</span> <span class='to identifier id'>to</span> <span class='set identifier id'>set</span> <span class='up identifier id'>up</span> <span class='a identifier id'>a</span> <span class='recurring identifier id'>recurring</span> <span class='historic identifier id'>historic</span> <span class='transaction identifier id'>transaction</span> <span class='account identifier id'>account</span> <span class='be identifier id'>be</span> <span class='set identifier id'>set</span> <span class='up identifier id'>up</span><span class='dot token'>.</span>
 <span class='Only constant id'>Only</span> <span class='supported identifier id'>supported</span> <span class='for for kw'>for</span> <span class='colon op'>:</span><span class='visa identifier id'>visa</span><span class='comma token'>,</span> <span class='symbol val'>:master</span> <span class='and and kw'>and</span> <span class='symbol val'>:american_express</span> <span class='card identifier id'>card</span> <span class='types identifier id'>types</span>
 <span class='See constant id'>See</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.datacash.com/s</span><span class='ervices identifier id'>ervices</span><span class='div op'>/</span><span class='recurring identifier id'>recurring</span><span class='div op'>/</span><span class='historic identifier id'>historic</span><span class='dot token'>.</span><span class='php identifier id'>php</span> <span class='for for kw'>for</span> <span class='more identifier id'>more</span> <span class='details identifier id'>details</span> <span class='of identifier id'>of</span> <span class='historic identifier id'>historic</span> <span class='transactions identifier id'>transactions</span><span class='dot token'>.</span>
</pre>
</li>
<li><tt>:address</tt>:: billing address for card

</li>
</ul>
</li>
</ul>
<p>
The continuous authority reference will be available in
response#params[&#8216;ca_referece&#8217;] if you have requested one
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


72
73
74
75
76
77
78
79
80
81
82</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 72</span>

<span class='def def kw'>def</span> <span class='purchase identifier id'>purchase</span><span class='lparen token'>(</span><span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='requires! fid id'>requires!</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='symbol val'>:order_id</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='build_purchase_or_authorization_request_with_continuous_authority_reference_request identifier id'>build_purchase_or_authorization_request_with_continuous_authority_reference_request</span><span class='lparen token'>(</span><span class='AUTH_TYPE constant id'>AUTH_TYPE</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='build_purchase_or_authorization_request_with_credit_card_request identifier id'>build_purchase_or_authorization_request_with_credit_card_request</span><span class='lparen token'>(</span><span class='AUTH_TYPE constant id'>AUTH_TYPE</span><span class='comma token'>,</span> <span class='money identifier id'>money</span><span class='comma token'>,</span> <span class='authorization_or_credit_card identifier id'>authorization_or_credit_card</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>test?</h3>
</div><div id="test%3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>test?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Is the gateway running in test mode?
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


153
154
155</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 153</span>

<span class='def def kw'>def</span> <span class='test? fid id'>test?</span>
  <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:test</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='super super kw'>super</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>void</h3>
</div><div id="void-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>void</span><span class='args'>(authorization, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Void a previous transaction
</p>
<h4>Parameters</h4>
<ul>
<li><tt>authorization</tt> - The authorization returned from the previous
authorize request.

</li>
</ul>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


127
128
129
130
131</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_merchant/billing/gateways/data_cash.rb', line 127</span>

<span class='def def kw'>def</span> <span class='void identifier id'>void</span><span class='lparen token'>(</span><span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='build_void_or_capture_request identifier id'>build_void_or_capture_request</span><span class='lparen token'>(</span><span class='CANCEL_TYPE constant id'>CANCEL_TYPE</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='authorization identifier id'>authorization</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>

  <span class='commit identifier id'>commit</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>