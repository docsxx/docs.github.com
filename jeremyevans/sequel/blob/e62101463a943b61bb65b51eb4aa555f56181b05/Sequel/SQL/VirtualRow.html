<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jeremyevans's sequel - Class: Sequel::SQL::VirtualRow - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jeremyevans/commits/sequel/master" rel="alternate" title="Recent Commits to sequel:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jeremyevans", "sequel", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jeremyevans/sequel/blob/e62101463a943b61bb65b51eb4aa555f56181b05' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jeremyevans/sequel/blob/e62101463a943b61bb65b51eb4aa555f56181b05' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jeremyevans", "sequel", "e62101463a943b61bb65b51eb4aa555f56181b05", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jeremyevans/sequel/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jeremyevans/sequel/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jeremyevans/sequel/network">Network</a></li>            
            <li class=""><a href="http://github.com/jeremyevans/sequel/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jeremyevans/sequel">Wiki</a></li>
            <li class=""><a href="http://github.com/jeremyevans/sequel/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jeremyevans/sequel">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jeremyevans">jeremyevans</a> / <b><a href="http://github.com/jeremyevans/sequel/tree">sequel</a></b>        
                <a id="namespaces_button" rel="jeremyevans/sequel/blob/e62101463a943b61bb65b51eb4aa555f56181b05" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jeremyevans/sequel/blob/e62101463a943b61bb65b51eb4aa555f56181b05" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Sequel_SQL_VirtualRow">
  <h1>Class: Sequel::SQL::VirtualRow</h1>
  <div class="section inheritance">
  <ul>
  <li>BasicObject</li><ul><li>Sequel::SQL::VirtualRow</li>
  </ul></ul>
</div><div class="section docstring">
  <p>
The purpose of this class is to allow the easy creation of SQL identifiers
and functions without relying on methods defined on Symbol. This is useful
if another library defines the methods defined by Sequel, or if you are
running on ruby 1.9.
</p>
<p>
An instance of this class is yielded to the block supplied to filter,
order, and select. If the block doesn&#8217;t take an argument, the block
is instance_evaled in the context of a new instance of this class.
</p>
<p>
VirtualRow uses method_missing to return Identifiers, QualifiedIdentifiers,
Functions, or WindowFunctions, depending on how it is called. If a block is
not given, creates one of the following objects:
</p>
<ul>
<li>Function - returned if any arguments are supplied, using the method name as
the function name, and the arguments as the function arguments.

</li>
<li>QualifiedIdentifier - returned if the method name contains __, with the
table being the part before __, and the column being the part after.

</li>
<li>Identifier - returned otherwise, using the method name.

</li>
</ul>
<p>
If a block is given, it returns either a Function or WindowFunction,
depending on the first argument to the method. Note that the block is
currently not called by the code, though this may change in a future
version. If the first argument is:
</p>
<ul>
<li>no arguments given - uses a Function with no arguments.

</li>
<li>:* - uses a Function with a literal wildcard argument (*), mostly useful
for COUNT.

</li>
<li>:distinct - uses a Function that prepends DISTINCT to the rest of the
arguments, mostly useful for aggregate functions.

</li>
<li>:over - uses a WindowFunction. If a second argument is provided, it should
be a hash of options which are passed to Window (e.g. :window, :partition,
:order, :frame). The arguments to the function itself should be specified
as :*=&gt;true for a wildcard, or via the :args option.

</li>
</ul>
<p>
Examples:
</p>
<pre class="code">
  <span class='ds identifier id'>ds</span> <span class='assign token'>=</span> <span class='DB constant id'>DB</span><span class='lbrack token'>[</span><span class='symbol val'>:t</span><span class='rbrack token'>]</span>
  <span class='comment val'># Argument yielded to block</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span> <span class='r identifier id'>r</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='lt op'>&lt;</span> <span class='integer val'>2</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT * FROM t WHERE (name &lt; 2)</span>
  <span class='comment val'># Block without argument (instance_eval)</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span><span class='lbrace token'>{</span><span class='name identifier id'>name</span> <span class='lt op'>&lt;</span> <span class='integer val'>2</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT * FROM t WHERE (name &lt; 2)</span>
  <span class='comment val'># Qualified identifiers</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span><span class='lbrace token'>{</span><span class='table__column identifier id'>table__column</span> <span class='plus op'>+</span> <span class='integer val'>1</span> <span class='lt op'>&lt;</span> <span class='integer val'>2</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT * FROM t WHERE ((table.column + 1) &lt; 2)</span>
  <span class='comment val'># Functions</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='filter identifier id'>filter</span><span class='lbrace token'>{</span><span class='is_active identifier id'>is_active</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='string val'>'arg2'</span><span class='rparen token'>)</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT * FROM t WHERE is_active(1, 'arg2')</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='version identifier id'>version</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT version() FROM t</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='symbol val'>:*</span><span class='rparen token'>)</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT count(*) FROM t</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='symbol val'>:distinct</span><span class='comma token'>,</span> <span class='col1 identifier id'>col1</span><span class='rparen token'>)</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT count(DISTINCT col1) FROM t</span>
  <span class='comment val'># Window Functions</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='rank identifier id'>rank</span><span class='lparen token'>(</span><span class='symbol val'>:over</span><span class='rparen token'>)</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT rank() OVER () FROM t</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='symbol val'>:over</span><span class='comma token'>,</span> <span class='symbol val'>:*=</span><span class='gt op'>&gt;</span><span class='true true kw'>true</span><span class='rparen token'>)</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT count(*) OVER () FROM t</span>
  <span class='ds identifier id'>ds</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lbrace token'>{</span><span class='sum identifier id'>sum</span><span class='lparen token'>(</span><span class='symbol val'>:over</span><span class='comma token'>,</span> <span class='symbol val'>:args=</span><span class='gt op'>&gt;</span><span class='col1 identifier id'>col1</span><span class='comma token'>,</span> <span class='symbol val'>:partition=</span><span class='gt op'>&gt;</span><span class='col2 identifier id'>col2</span><span class='comma token'>,</span> <span class='symbol val'>:order=</span><span class='gt op'>&gt;</span><span class='col3 identifier id'>col3</span><span class='rparen token'>)</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rbrace token'>}</span> <span class='comment val'># SELECT sum(col1) OVER (PARTITION BY col2 ORDER BY col3) FROM t</span>
</pre>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="COMMA_SEPARATOR-constant">COMMA_SEPARATOR</dt>
      <dd>LiteralString.new(', ').freeze</dd>
    
      <dt id="DOUBLE_UNDERSCORE-constant">DOUBLE_UNDERSCORE</dt>
      <dd>'__'.freeze</dd>
    
      <dt id="QUESTION_MARK-constant">QUESTION_MARK</dt>
      <dd>LiteralString.new('?').freeze</dd>
    
      <dt id="WILDCARD-constant">WILDCARD</dt>
      <dd>LiteralString.new('*').freeze</dd>
    
  </dl>
</div>

</div><div class="section methodmissing">
  <h2>Dynamic Method Handling</h2>

  <p class="note">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>

  <div id="method_missing-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>method_missing</span><span class='args'>(m, *args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return Identifiers, QualifiedIdentifiers, Functions, or WindowFunctions,
depending on arguments and whether a block is provided. Does not currently
call the block. See the class level documentation.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/sequel/sql.rb', line 855</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jeremyevans/sequel/blob/e62101463a943b61bb65b51eb4aa555f56181b05/lib/sequel/sql.rb#L855">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">855
856
857
858
859
860
861
862
863
864
865
866
867
868
869
870
871
872
873
874
875
876
877
878
879</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='method_missing identifier id'>method_missing</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='block identifier id'>block</span>
    <span class='if if kw'>if</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='Function constant id'>Function</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='case case kw'>case</span> <span class='arg identifier id'>arg</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:*</span>
        <span class='Function constant id'>Function</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='WILDCARD constant id'>WILDCARD</span><span class='rparen token'>)</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:distinct</span>
        <span class='Function constant id'>Function</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='PlaceholderLiteralString constant id'>PlaceholderLiteralString</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;DISTINCT #{args.map{QUESTION_MARK}.join(COMMA_SEPARATOR)}&quot;</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='when when kw'>when</span> <span class='symbol val'>:over</span>
        <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
        <span class='fun_args identifier id'>fun_args</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Kernel constant id'>Kernel</span><span class='dot token'>.</span><span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:*</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='WILDCARD constant id'>WILDCARD</span> <span class='colon op'>:</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:args</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
        <span class='WindowFunction constant id'>WindowFunction</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='Function constant id'>Function</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='fun_args identifier id'>fun_args</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='Window constant id'>Window</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='else else kw'>else</span>
        <span class='raise identifier id'>raise</span> <span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='string val'>'unsupported VirtualRow method argument used with block'</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='elsif elsif kw'>elsif</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='table identifier id'>table</span><span class='comma token'>,</span> <span class='column identifier id'>column</span> <span class='assign token'>=</span> <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='DOUBLE_UNDERSCORE constant id'>DOUBLE_UNDERSCORE</span><span class='comma token'>,</span> <span class='integer val'>2</span><span class='rparen token'>)</span>
    <span class='column identifier id'>column</span> <span class='integer val'>? </span><span class='QualifiedIdentifier constant id'>QualifiedIdentifier</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='table identifier id'>table</span><span class='comma token'>,</span> <span class='column identifier id'>column</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='Identifier constant id'>Identifier</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='Function constant id'>Function</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>
</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>