<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: Sequel::ConnectionPool</title>
  </head>
  <body>
    <div id="content">
      <div class="section class Sequel_ConnectionPool">
  <h1 class="title">Class: Sequel::ConnectionPool</h1>
  <div class="section docstring">
  <p>
A ConnectionPool manages access to database connections by keeping multiple
connections and giving threads exclusive access to each connection.
</p>

</div><div class="section attributes">
  <h1>Attributes</h1>

  
    <div class="instance">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">connection_proc</td>
          <td class="readwrite">
            [<span id='connection_proc-instance_method'>R</span><span id='connection_proc%3D-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The proc used to create a new database connection.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">disconnection_proc</td>
          <td class="readwrite">
            [<span id='disconnection_proc-instance_method'>R</span><span id='disconnection_proc%3D-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The proc used to disconnect a database connection.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">max_size</td>
          <td class="readwrite">
            [<span id='max_size-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The maximum number of connections.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">mutex</td>
          <td class="readwrite">
            [<span id='mutex-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The mutex that protects access to the other internal vairables.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(opts = {}, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Constructs a new pool with a maximum size. If a block is supplied, it is
used to create new connections as they are needed.
</p>
<pre class="code">
  <span class='pool identifier id'>pool</span> <span class='assign token'>=</span> <span class='ConnectionPool constant id'>ConnectionPool</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:max_connections=</span><span class='gt op'>&gt;</span><span class='integer val'>10</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='MyConnection constant id'>MyConnection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
</pre>
<p>
The connection creation proc can be changed at any time by assigning a Proc
to pool#connection_proc.
</p>
<pre class="code">
  <span class='pool identifier id'>pool</span> <span class='assign token'>=</span> <span class='ConnectionPool constant id'>ConnectionPool</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:max_connections=</span><span class='gt op'>&gt;</span><span class='integer val'>10</span><span class='rparen token'>)</span>
  <span class='pool identifier id'>pool</span><span class='dot token'>.</span><span class='connection_proc identifier id'>connection_proc</span> <span class='assign token'>=</span> <span class='proc identifier id'>proc</span> <span class='lbrace token'>{</span><span class='MyConnection constant id'>MyConnection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
</pre>
<p>
The connection pool takes the following options:
</p>
<ul>
<li>:disconnection_proc - The proc called when removing connections from the
pool.

</li>
<li>:max_connections - The maximum number of connections the connection pool
will open (default 4)

</li>
<li>:pool_convert_exceptions - Whether to convert non-StandardError based
exceptions to RuntimeError exceptions (default true)

</li>
<li>:pool_sleep_time - The amount of time to sleep before attempting to acquire
a connection again (default 0.001)

</li>
<li>:pool_timeout - The amount of seconds to wait to acquire a connection
before raising a PoolTimeoutError (default 5)

</li>
<li>:servers - A hash of servers to use. Keys should be symbols. If not
present, will use a single :default server. The server name symbol will be
passed to the connection_proc.

</li>
</ul>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/sequel/connection_pool.rb', line 43</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='@max_size ivar id'>@max_size</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:max_connections</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>4</span>
  <span class='@mutex ivar id'>@mutex</span> <span class='assign token'>=</span> <span class='Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='@connection_proc ivar id'>@connection_proc</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>
  <span class='@disconnection_proc ivar id'>@disconnection_proc</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:disconnection_proc</span><span class='rbrack token'>]</span>
  <span class='@servers ivar id'>@servers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span>
  <span class='@servers ivar id'>@servers</span> <span class='opasgn op'>+=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:servers</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span> <span class='minus op'>-</span> <span class='@servers ivar id'>@servers</span> <span class='if if_mod kw'>if</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:servers</span><span class='rbrack token'>]</span> 
  <span class='@available_connections ivar id'>@available_connections</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
  <span class='@allocated ivar id'>@allocated</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
  <span class='@created_count ivar id'>@created_count</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='symbol val'>:default</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
  <span class='@servers ivar id'>@servers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='s identifier id'>s</span><span class='bitor op'>|</span>
    <span class='@available_connections ivar id'>@available_connections</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='@allocated ivar id'>@allocated</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@created_count ivar id'>@created_count</span><span class='lbrack token'>[</span><span class='s identifier id'>s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
  <span class='end end kw'>end</span>
  <span class='@timeout ivar id'>@timeout</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:pool_timeout</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>5</span>
  <span class='@sleep_time ivar id'>@sleep_time</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:pool_sleep_time</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='integer val'>0</span><span class='integer val'>.001</span>
  <span class='@convert_exceptions ivar id'>@convert_exceptions</span> <span class='assign token'>=</span> <span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='symbol val'>:pool_convert_exceptions</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='opts identifier id'>opts</span><span class='lbrack token'>[</span><span class='symbol val'>:pool_convert_exceptions</span><span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#allocated-instance_method' title='#allocated'>#allocated</a></span><span class='args'>(server=:default)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
A hash of connections currently being used for the given server, key is the
Thread, value is the connection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#available_connections-instance_method' title='#available_connections'>#available_connections</a></span><span class='args'>(server=:default)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
An array of connections opened but not currently used, for the given
server.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#created_count-instance_method' title='#created_count'>#created_count</a></span><span class='args'>(server=:default)</span>
        <span class='block'></span>
        
          <span class='alias'>#size</span>
        
      </th>
      <td class="docstring">
        <p>
The total number of connections opened for the given server, should be
equal to available_connections.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#disconnect-instance_method' title='#disconnect'>#disconnect</a></span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Removes all connection currently available on all servers, optionally
yielding each connection to the given block.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#hold-instance_method' title='#hold'>#hold</a></span><span class='args'>(server=:default)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Chooses the first available connection to the given server, or if none are
available, creates a new connection.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>allocated</h3>
</div><div id="allocated-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>allocated</span><span class='args'>(server=:default)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
A hash of connections currently being used for the given server, key is the
Thread, value is the connection.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


65
66
67</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/sequel/connection_pool.rb', line 65</span>

<span class='def def kw'>def</span> <span class='allocated identifier id'>allocated</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='assign token'>=</span><span class='symbol val'>:default</span><span class='rparen token'>)</span>
  <span class='@allocated ivar id'>@allocated</span><span class='lbrack token'>[</span><span class='server identifier id'>server</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>available_connections</h3>
</div><div id="available_connections-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>available_connections</span><span class='args'>(server=:default)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
An array of connections opened but not currently used, for the given
server.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


71
72
73</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/sequel/connection_pool.rb', line 71</span>

<span class='def def kw'>def</span> <span class='available_connections identifier id'>available_connections</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='assign token'>=</span><span class='symbol val'>:default</span><span class='rparen token'>)</span>
  <span class='@available_connections ivar id'>@available_connections</span><span class='lbrack token'>[</span><span class='server identifier id'>server</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>created_count</h3>
</div><div id="created_count-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>created_count</span><span class='args'>(server=:default)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="size-instance_method">size</tt>
  
</p>
</div><div class="section docstring">
  <p>
The total number of connections opened for the given server, should be
equal to available_connections.length + allocated.length
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


77
78
79</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/sequel/connection_pool.rb', line 77</span>

<span class='def def kw'>def</span> <span class='created_count identifier id'>created_count</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='assign token'>=</span><span class='symbol val'>:default</span><span class='rparen token'>)</span>
  <span class='@created_count ivar id'>@created_count</span><span class='lbrack token'>[</span><span class='server identifier id'>server</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>disconnect</h3>
</div><div id="disconnect-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>disconnect</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Removes all connection currently available on all servers, optionally
yielding each connection to the given block. This method has the effect of
disconnecting from the database, assuming that no connections are currently
being used. Once a connection is requested using #hold, the connection pool
creates new connections to the database.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


129
130
131
132
133
134
135
136
137
138</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/sequel/connection_pool.rb', line 129</span>

<span class='def def kw'>def</span> <span class='disconnect identifier id'>disconnect</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='block identifier id'>block</span> <span class='opasgn op'>||=</span> <span class='@disconnection_proc ivar id'>@disconnection_proc</span>
  <span class='@mutex ivar id'>@mutex</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='do do kw'>do</span>
    <span class='@available_connections ivar id'>@available_connections</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='conns identifier id'>conns</span><span class='bitor op'>|</span>
      <span class='conns identifier id'>conns</span><span class='dot token'>.</span><span class='each identifier id'>each</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span><span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='block identifier id'>block</span>
      <span class='conns identifier id'>conns</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
      <span class='set_created_count identifier id'>set_created_count</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='comma token'>,</span> <span class='allocated identifier id'>allocated</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>hold</h3>
</div><div id="hold-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>hold</span><span class='args'>(server=:default)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Chooses the first available connection to the given server, or if none are
available, creates a new connection. Passes the connection to the supplied
block:
</p>
<pre class="code">
  <span class='pool identifier id'>pool</span><span class='dot token'>.</span><span class='hold identifier id'>hold</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='conn identifier id'>conn</span><span class='bitor op'>|</span> <span class='conn identifier id'>conn</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='string val'>'DROP TABLE posts'</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
</pre>
<p>
Pool#hold is re-entrant, meaning it can be called recursively in the same
thread without blocking.
</p>
<p>
If no connection is immediately available and the pool is already using the
maximum number of connections, Pool#hold will block until a connection is
available or the timeout expires. If the timeout expires before a
connection can be acquired, a Sequel::PoolTimeout is raised.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/sequel/connection_pool.rb', line 96</span>

<span class='def def kw'>def</span> <span class='hold identifier id'>hold</span><span class='lparen token'>(</span><span class='server identifier id'>server</span><span class='assign token'>=</span><span class='symbol val'>:default</span><span class='rparen token'>)</span>
  <span class='begin begin kw'>begin</span>
    <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span>
    <span class='time identifier id'>time</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='timeout identifier id'>timeout</span> <span class='assign token'>=</span> <span class='time identifier id'>time</span> <span class='plus op'>+</span> <span class='@timeout ivar id'>@timeout</span>
    <span class='sleep_time identifier id'>sleep_time</span> <span class='assign token'>=</span> <span class='@sleep_time ivar id'>@sleep_time</span>
    <span class='if if kw'>if</span> <span class='conn identifier id'>conn</span> <span class='assign token'>=</span> <span class='owned_connection identifier id'>owned_connection</span><span class='lparen token'>(</span><span class='t identifier id'>t</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='conn identifier id'>conn</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='until until kw'>until</span> <span class='conn identifier id'>conn</span> <span class='assign token'>=</span> <span class='acquire identifier id'>acquire</span><span class='lparen token'>(</span><span class='t identifier id'>t</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='colon3 op'>::</span><span class='Sequel constant id'>Sequel</span><span class='colon2 op'>::</span><span class='PoolTimeout constant id'>PoolTimeout</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='gt op'>&gt;</span> <span class='timeout identifier id'>timeout</span>
      <span class='sleep identifier id'>sleep</span> <span class='sleep_time identifier id'>sleep_time</span>
    <span class='end end kw'>end</span>
    <span class='begin begin kw'>begin</span>
      <span class='yield yield kw'>yield</span> <span class='conn identifier id'>conn</span>
    <span class='rescue rescue kw'>rescue</span> <span class='Sequel constant id'>Sequel</span><span class='colon2 op'>::</span><span class='DatabaseDisconnectError constant id'>DatabaseDisconnectError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dde identifier id'>dde</span>
      <span class='remove identifier id'>remove</span><span class='lparen token'>(</span><span class='t identifier id'>t</span><span class='comma token'>,</span> <span class='conn identifier id'>conn</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span>
    <span class='ensure ensure kw'>ensure</span>
      <span class='release identifier id'>release</span><span class='lparen token'>(</span><span class='t identifier id'>t</span><span class='comma token'>,</span> <span class='conn identifier id'>conn</span><span class='comma token'>,</span> <span class='server identifier id'>server</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='dde identifier id'>dde</span>
    <span class='end end kw'>end</span>
  <span class='rescue rescue kw'>rescue</span> <span class='StandardError constant id'>StandardError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='raise identifier id'>raise</span> <span class='e identifier id'>e</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='@convert_exceptions ivar id'>@convert_exceptions</span> <span class='question op'>?</span> <span class='RuntimeError constant id'>RuntimeError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='e identifier id'>e</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>