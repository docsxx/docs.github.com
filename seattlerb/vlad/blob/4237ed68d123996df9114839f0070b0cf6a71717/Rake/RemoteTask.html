<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>seattlerb's vlad - Class: Rake::RemoteTask - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/seattlerb/commits/vlad/master" rel="alternate" title="Recent Commits to vlad:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("seattlerb", "vlad", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("seattlerb", "vlad", "4237ed68d123996df9114839f0070b0cf6a71717", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/seattlerb/vlad/tree/">Source</a></li>
            <li class=""><a href="http://github.com/seattlerb/vlad/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/seattlerb/vlad/network">Network</a></li>            
            <li class=""><a href="http://github.com/seattlerb/vlad/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/seattlerb/vlad">Wiki</a></li>
            <li class=""><a href="http://github.com/seattlerb/vlad/graphs">Graphs</a></li>                    
            <li class="active"><a href="/seattlerb/vlad">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/seattlerb">seattlerb</a> / <b><a href="http://github.com/seattlerb/vlad/tree">vlad</a></b>        
                <a id="namespaces_button" rel="seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Rake_RemoteTask">
  <h1>Class: Rake::RemoteTask</h1>
  <div class="section inheritance">
  <ul>
  <li>Rake::Task</li><ul><li>Rake::RemoteTask</li>
  </ul></ul>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p>Open4</p>
</div><div class="section docstring">
  <p>
Rake::RemoteTask is a subclass of Rake::Task that adds remote_actions that
execute in parallel on multiple hosts via ssh.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">options</td>
          <td class="readwrite">
            [<span id='options-instance_method'>R</span><span id='options=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Options for execution of this task.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">remote_actions</td>
          <td class="readwrite">
            [<span id='remote_actions-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
An Array of Actions this host will perform during execution.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">target_host</td>
          <td class="readwrite">
            [<span id='target_host-instance_method'>R</span><span id='target_host=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The host this task is running on during execution.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(task_name, app)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create a new task named <tt>task_name</tt> attached to Rake::Application
<tt>app</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 52</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L52">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">52
53
54
55
56
57</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='task_name identifier id'>task_name</span><span class='comma token'>,</span> <span class='app identifier id'>app</span><span class='rparen token'>)</span>
  <span class='super super kw'>super</span>

  <span class='@remote_actions ivar id'>@remote_actions</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@happy ivar id'>@happy</span> <span class='assign token'>=</span> <span class='false false kw'>false</span> <span class='comment val'># used for deprecation warnings on get/put/rsync</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#all_hosts-class_method">all_hosts</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns an Array with every host configured.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#current_roles-class_method">current_roles</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#default_env-class_method">default_env</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The default environment values.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#env-class_method">env</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The vlad environment.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch-class_method">fetch</span><span class='args'>(name, default = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches environment variable <tt>name</tt> from the environment using
default <tt>default</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#host-class_method">host</span><span class='args'>(host_name, *roles)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Add host <tt>host_name</tt> that belongs to <tt>roles</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#hosts_for-class_method">hosts_for</span><span class='args'>(*roles)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns an Array of all hosts in <tt>roles</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#mandatory-class_method">mandatory</span><span class='args'>(name, desc)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#per_thread-class_method">per_thread</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#protect_env-class_method">protect_env</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Ensures exclusive access to <tt>name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#remote_task-class_method">remote_task</span><span class='args'>(name, *args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds a remote task named <tt>name</tt> with options <tt>options</tt> that
will execute <tt>block</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reserved_name-3F-class_method">reserved_name?</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Ensures <tt>name</tt> does not conflict with an existing method.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reset-class_method">reset</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Resets vlad, restoring all roles, tasks and environment variables to the
defaults.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#role-class_method">role</span><span class='args'>(role_name, host = nil, args = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds role <tt>role_name</tt> with <tt>host</tt> and <tt>args</tt> for that
host.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#roles-class_method">roles</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The configured roles.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set-class_method">set</span><span class='args'>(name, value = nil, &amp;default_block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Set environment variable <tt>name</tt> to <tt>value</tt> or
<tt>default_block</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_defaults-class_method">set_defaults</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets all the default values.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#set_path-class_method">set_path</span><span class='args'>(name, subdir)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#simple_set-class_method">simple_set</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#task-class_method">task</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The Rake::RemoteTask executing in this Thread.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#tasks-class_method">tasks</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The configured Rake::RemoteTasks.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#defined_target_hosts-3F-instance_method">#defined_target_hosts?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Similar to target_hosts, but returns true if user defined any hosts, even
an empty list.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#enhance-instance_method">#enhance</span><span class='args'>(deps = nil, &amp;block)</span>
        <span class='block'></span>
        
          <span class='alias'>#original_enhance</span>
        
      </th>
      <td class="docstring">
        <p>
Add remote action <tt>block</tt> to this task with dependencies
<tt>deps</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#execute-instance_method">#execute</span><span class='args'>(args = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Execute this action.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get-instance_method">#get</span><span class='args'>(local_dir, *files)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Pull <tt>files</tt> from the remote <tt>host</tt> using rsync to
<tt>local_dir</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#put-instance_method">#put</span><span class='args'>(remote_path, base_name = File.basename(remote_path))</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Copy a (usually generated) file to <tt>remote_path</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#rsync-instance_method">#rsync</span><span class='args'>(*args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Execute rsync with <tt>args</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run-instance_method">#run</span><span class='args'>(command)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Use ssh to execute <tt>command</tt> on target_host.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#sudo-instance_method">#sudo</span><span class='args'>(command)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Execute <tt>command</tt> under sudo using run.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#target_hosts-instance_method">#target_hosts</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
The hosts this task will execute on.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>all_hosts</h3>
</div><div id="all_hosts-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>all_hosts</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns an Array with every host configured.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 205</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L205">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">205
206
207</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='all_hosts identifier id'>all_hosts</span>
  <span class='hosts_for identifier id'>hosts_for</span><span class='lparen token'>(</span><span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>current_roles</h3>
</div><div id="current_roles-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>current_roles</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 45</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L45">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">45
46
47</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='current_roles identifier id'>current_roles</span>
  <span class='@@current_roles ivar id'>@@current_roles</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>default_env</h3>
</div><div id="default_env-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>default_env</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The default environment values. Used for resetting (mostly for tests).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 213</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L213">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">213
214
215</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='default_env identifier id'>default_env</span>
  <span class='@@default_env ivar id'>@@default_env</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>env</h3>
</div><div id="env-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>env</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The vlad environment.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 224</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L224">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">224
225
226</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='env identifier id'>env</span>
  <span class='@@env ivar id'>@@env</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch</h3>
</div><div id="fetch-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch</span><span class='args'>(name, default = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches environment variable <tt>name</tt> from the environment using
default <tt>default</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 232</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L232">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='default identifier id'>default</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='if if_mod kw'>if</span> <span class='Symbol constant id'>Symbol</span> <span class='eqq op'>===</span> <span class='name identifier id'>name</span>
  <span class='if if kw'>if</span> <span class='@@env ivar id'>@@env</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='name identifier id'>name</span> <span class='then then kw'>then</span>
    <span class='protect_env identifier id'>protect_env</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
      <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='if if_mod kw'>if</span> <span class='Proc constant id'>Proc</span> <span class='eqq op'>===</span> <span class='v identifier id'>v</span> <span class='unless unless_mod kw'>unless</span> <span class='per_thread identifier id'>per_thread</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
      <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='if if_mod kw'>if</span> <span class='Proc constant id'>Proc</span> <span class='eqq op'>===</span> <span class='v identifier id'>v</span>
      <span class='v identifier id'>v</span>
    <span class='end end kw'>end</span>
  <span class='elsif elsif kw'>elsif</span> <span class='default identifier id'>default</span> <span class='orop op'>||</span> <span class='default identifier id'>default</span> <span class='eq op'>==</span> <span class='false false kw'>false</span>
    <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='default identifier id'>default</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='FetchError constant id'>FetchError</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>host</h3>
</div><div id="host-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>host</span><span class='args'>(host_name, *roles)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Add host <tt>host_name</tt> that belongs to <tt>roles</tt>. Extra arguments
may be specified for the host as a hash as the last argument.
</p>
<p>
host is the inversion of role:
</p>
<pre class="code">
  <span class='host identifier id'>host</span> <span class='string val'>'db1.example.com'</span><span class='comma token'>,</span> <span class='symbol val'>:db</span><span class='comma token'>,</span> <span class='symbol val'>:master_db</span>
</pre>
<p>
Is equivalent to:
</p>
<pre class="code">
  <span class='role identifier id'>role</span> <span class='symbol val'>:db</span><span class='comma token'>,</span> <span class='string val'>'db1.example.com'</span>
  <span class='role identifier id'>role</span> <span class='symbol val'>:master_db</span><span class='comma token'>,</span> <span class='string val'>'db1.example.com'</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 261</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L261">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">261
262
263
264
265
266
267</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='host identifier id'>host</span> <span class='host_name identifier id'>host_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='roles identifier id'>roles</span>
  <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span> <span class='eqq op'>===</span> <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='last identifier id'>last</span> <span class='integer val'>? </span><span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='role_name identifier id'>role_name</span><span class='bitor op'>|</span>
    <span class='role identifier id'>role</span> <span class='role_name identifier id'>role_name</span><span class='comma token'>,</span> <span class='host_name identifier id'>host_name</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>hosts_for</h3>
</div><div id="hosts_for-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>hosts_for</span><span class='args'>(*roles)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns an Array of all hosts in <tt>roles</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 272</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L272">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">272
273
274
275
276</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='hosts_for identifier id'>hosts_for</span> <span class='mult op'>*</span><span class='roles identifier id'>roles</span>
  <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='roles identifier id'>roles</span><span class='lbrack token'>[</span><span class='r identifier id'>r</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span>
  <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>mandatory</h3>
</div><div id="mandatory-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>mandatory</span><span class='args'>(name, desc)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 278</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L278">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">278
279
280
281
282
283</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mandatory identifier id'>mandatory</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='desc identifier id'>desc</span> 
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span>
          <span class='dstring node'>&quot;Please specify the #{desc} via the #{name.inspect} variable&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>per_thread</h3>
</div><div id="per_thread-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>per_thread</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 217</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L217">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">217
218
219</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='per_thread identifier id'>per_thread</span>
  <span class='@@per_thread ivar id'>@@per_thread</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>protect_env</h3>
</div><div id="protect_env-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>protect_env</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Ensures exclusive access to <tt>name</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 288</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L288">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">288
289
290
291
292</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='protect_env identifier id'>protect_env</span> <span class='name identifier id'>name</span> 
  <span class='@@env_locks ivar id'>@@env_locks</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='do do kw'>do</span>
    <span class='yield yield kw'>yield</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>remote_task</h3>
</div><div id="remote_task-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>remote_task</span><span class='args'>(name, *args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds a remote task named <tt>name</tt> with options <tt>options</tt> that
will execute <tt>block</tt>.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 298</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L298">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">298
299
300
301
302
303
304
305</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='remote_task identifier id'>remote_task</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Hash constant id'>Hash</span> <span class='eqq op'>===</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='define_task identifier id'>define_task</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span> <span class='opasgn op'>|=</span> <span class='@@current_roles ivar id'>@@current_roles</span>
  <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span>
  <span class='t identifier id'>t</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reserved_name?</h3>
</div><div id="reserved_name-3F-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reserved_name?</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Ensures <tt>name</tt> does not conflict with an existing method.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 310</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L310">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">310
311
312</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reserved_name? fid id'>reserved_name?</span> <span class='name identifier id'>name</span> 
  <span class='notop op'>!</span><span class='@@env ivar id'>@@env</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reset</h3>
</div><div id="reset-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reset</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Resets vlad, restoring all roles, tasks and environment variables to the
defaults.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 318</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L318">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span>
  <span class='@@def_role_hash ivar id'>@@def_role_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>                <span class='comment val'># official default role value</span>
  <span class='@@env ivar id'>@@env</span>           <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@@tasks ivar id'>@@tasks</span>         <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@@roles ivar id'>@@roles</span>         <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='@@def_role_hash ivar id'>@@def_role_hash</span> <span class='rbrace token'>}</span>
  <span class='@@env_locks ivar id'>@@env_locks</span>     <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='rbrace token'>}</span>

  <span class='@@default_env ivar id'>@@default_env</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='case case kw'>case</span> <span class='v identifier id'>v</span>
    <span class='when when kw'>when</span> <span class='Symbol constant id'>Symbol</span><span class='comma token'>,</span> <span class='Fixnum constant id'>Fixnum</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>42</span> <span class='then then kw'>then</span> <span class='comment val'># ummmm... yeah. bite me.</span>
      <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span>
    <span class='else else kw'>else</span>
      <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>role</h3>
</div><div id="role-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>role</span><span class='args'>(role_name, host = nil, args = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds role <tt>role_name</tt> with <tt>host</tt> and <tt>args</tt> for that
host. TODO: merge: Declare a role and assign a remote host to it.
Equivalent to the <tt>host</tt> method; provided for capistrano
compatibility.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 341</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L341">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='role identifier id'>role</span> <span class='role_name identifier id'>role_name</span><span class='comma token'>,</span> <span class='host identifier id'>host</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span> <span class='then then kw'>then</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'host not allowed with block'</span> <span class='unless unless_mod kw'>unless</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

    <span class='begin begin kw'>begin</span>
      <span class='current_roles identifier id'>current_roles</span> <span class='lshft op'>&lt;&lt;</span> <span class='role_name identifier id'>role_name</span>
      <span class='yield yield kw'>yield</span>
    <span class='ensure ensure kw'>ensure</span>
      <span class='current_roles identifier id'>current_roles</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='role_name identifier id'>role_name</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'host required'</span> <span class='if if_mod kw'>if</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

    <span class='lbrack token'>[</span><span class='mult op'>*</span><span class='host identifier id'>host</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='hst identifier id'>hst</span><span class='bitor op'>|</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;invalid host: #{hst}&quot;</span> <span class='if if_mod kw'>if</span> <span class='hst identifier id'>hst</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='hst identifier id'>hst</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='end end kw'>end</span>
    <span class='@@roles ivar id'>@@roles</span><span class='lbrack token'>[</span><span class='role_name identifier id'>role_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='@@def_role_hash ivar id'>@@def_role_hash</span><span class='dot token'>.</span><span class='eql? fid id'>eql?</span> <span class='@@roles ivar id'>@@roles</span><span class='lbrack token'>[</span><span class='role_name identifier id'>role_name</span><span class='rbrack token'>]</span>
    <span class='@@roles ivar id'>@@roles</span><span class='lbrack token'>[</span><span class='role_name identifier id'>role_name</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='host identifier id'>host</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>roles</h3>
</div><div id="roles-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>roles</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The configured roles.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 365</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L365">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">365
366
367
368
369</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='roles identifier id'>roles</span>
  <span class='host identifier id'>host</span> <span class='domain identifier id'>domain</span><span class='comma token'>,</span> <span class='symbol val'>:app</span><span class='comma token'>,</span> <span class='symbol val'>:web</span><span class='comma token'>,</span> <span class='symbol val'>:db</span> <span class='if if_mod kw'>if</span> <span class='@@roles ivar id'>@@roles</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='@@roles ivar id'>@@roles</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set</h3>
</div><div id="set-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set</span><span class='args'>(name, value = nil, &amp;default_block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Set environment variable <tt>name</tt> to <tt>value</tt> or
<tt>default_block</tt>.
</p>
<p>
If <tt>default_block</tt> is defined, the block will be executed the first
time the variable is fetched, and the value will be used for every
subsequent fetch.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 378</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L378">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set identifier id'>set</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='default_block identifier id'>default_block</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;cannot provide both a value and a block&quot;</span> <span class='if if_mod kw'>if</span>
    <span class='value identifier id'>value</span> <span class='and and kw'>and</span> <span class='default_block identifier id'>default_block</span> <span class='unless unless_mod kw'>unless</span>
    <span class='value identifier id'>value</span> <span class='eq op'>==</span> <span class='symbol val'>:per_thread</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;cannot set reserved name: '#{name}'&quot;</span> <span class='if if_mod kw'>if</span>
    <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='reserved_name? fid id'>reserved_name?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='$TESTING gvar id'>$TESTING</span>

  <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>

  <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='per_thread identifier id'>per_thread</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span>
    <span class='default_block identifier id'>default_block</span> <span class='andop op'>&amp;&amp;</span> <span class='value identifier id'>value</span> <span class='eq op'>==</span> <span class='symbol val'>:per_thread</span>

  <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='default_env identifier id'>default_env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span>
    <span class='default_block identifier id'>default_block</span> <span class='orop op'>||</span> <span class='value identifier id'>value</span>

  <span class='Object constant id'>Object</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='symbol val'>:define_method</span><span class='comma token'>,</span> <span class='name identifier id'>name</span> <span class='do do kw'>do</span>
    <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span> <span class='name identifier id'>name</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_defaults</h3>
</div><div id="set_defaults-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_defaults</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets all the default values. Should only be called once. Use reset if you
need to restore values.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 402</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L402">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_defaults identifier id'>set_defaults</span>
  <span class='@@default_env ivar id'>@@default_env</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@@per_thread ivar id'>@@per_thread</span>  <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span>

  <span class='mandatory identifier id'>mandatory</span> <span class='symbol val'>:repository</span><span class='comma token'>,</span> <span class='string val'>&quot;repository path&quot;</span>
  <span class='mandatory identifier id'>mandatory</span> <span class='symbol val'>:deploy_to</span><span class='comma token'>,</span>  <span class='string val'>&quot;deploy path&quot;</span>
  <span class='mandatory identifier id'>mandatory</span> <span class='symbol val'>:domain</span><span class='comma token'>,</span>     <span class='string val'>&quot;server domain&quot;</span>

  <span class='simple_set identifier id'>simple_set</span><span class='lparen token'>(</span><span class='symbol val'>:deploy_timestamped</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
             <span class='symbol val'>:deploy_via</span><span class='comma token'>,</span>         <span class='symbol val'>:export</span><span class='comma token'>,</span>
             <span class='symbol val'>:keep_releases</span><span class='comma token'>,</span>      <span class='integer val'>5</span><span class='comma token'>,</span>
             <span class='symbol val'>:migrate_args</span><span class='comma token'>,</span>       <span class='string val'>&quot;&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:migrate_target</span><span class='comma token'>,</span>     <span class='symbol val'>:latest</span><span class='comma token'>,</span>
             <span class='symbol val'>:rails_env</span><span class='comma token'>,</span>          <span class='string val'>&quot;production&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:rake_cmd</span><span class='comma token'>,</span>           <span class='string val'>&quot;rake&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:revision</span><span class='comma token'>,</span>           <span class='string val'>&quot;head&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:rsync_cmd</span><span class='comma token'>,</span>          <span class='string val'>&quot;rsync&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:rsync_flags</span><span class='comma token'>,</span>        <span class='lbrack token'>[</span><span class='string val'>'-azP'</span><span class='comma token'>,</span> <span class='string val'>'--delete'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
             <span class='symbol val'>:ssh_cmd</span><span class='comma token'>,</span>            <span class='string val'>&quot;ssh&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:ssh_flags</span><span class='comma token'>,</span>          <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
             <span class='symbol val'>:sudo_cmd</span><span class='comma token'>,</span>           <span class='string val'>&quot;sudo&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:sudo_flags</span><span class='comma token'>,</span>         <span class='lbrack token'>[</span><span class='string val'>'-p Password:'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
             <span class='symbol val'>:sudo_prompt</span><span class='comma token'>,</span>        <span class='regexp val'>/^Password:/</span><span class='comma token'>,</span>
             <span class='symbol val'>:umask</span><span class='comma token'>,</span>              <span class='string val'>'02'</span><span class='rparen token'>)</span>

  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:current_release</span><span class='rparen token'>)</span>    <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='releases_path identifier id'>releases_path</span><span class='comma token'>,</span> <span class='releases identifier id'>releases</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:latest_release</span><span class='rparen token'>)</span>     <span class='lbrace token'>{</span> <span class='deploy_timestamped identifier id'>deploy_timestamped</span> <span class='question op'>?</span><span class='release_path identifier id'>release_path</span><span class='colon op'>:</span> <span class='current_release identifier id'>current_release</span> <span class='rbrace token'>}</span>
  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:previous_release</span><span class='rparen token'>)</span>   <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='releases_path identifier id'>releases_path</span><span class='comma token'>,</span> <span class='releases identifier id'>releases</span><span class='lbrack token'>[</span><span class='integer val'>-2</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:release_name</span><span class='rparen token'>)</span>       <span class='lbrace token'>{</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='dot token'>.</span><span class='utc identifier id'>utc</span><span class='dot token'>.</span><span class='strftime identifier id'>strftime</span><span class='lparen token'>(</span><span class='string val'>&quot;%Y%m%d%H%M%S&quot;</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:release_path</span><span class='rparen token'>)</span>       <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='releases_path identifier id'>releases_path</span><span class='comma token'>,</span> <span class='release_name identifier id'>release_name</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:releases</span><span class='rparen token'>)</span>           <span class='lbrace token'>{</span> <span class='task identifier id'>task</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lparen token'>(</span><span class='dstring node'>&quot;ls -x #{releases_path}&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='rbrace token'>}</span>

  <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:current_path</span><span class='comma token'>,</span>  <span class='string val'>&quot;current&quot;</span>
  <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:releases_path</span><span class='comma token'>,</span> <span class='string val'>&quot;releases&quot;</span>
  <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:scm_path</span><span class='comma token'>,</span>      <span class='string val'>&quot;scm&quot;</span>
  <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:shared_path</span><span class='comma token'>,</span>   <span class='string val'>&quot;shared&quot;</span>

  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:sudo_password</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='state identifier id'>state</span> <span class='assign token'>=</span> <span class='xstring val'>`stty -g`</span>

    <span class='raise identifier id'>raise</span> <span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='string val'>&quot;stty(1) not found&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='$? gvar id'>$?</span><span class='dot token'>.</span><span class='success? fid id'>success?</span>

    <span class='begin begin kw'>begin</span>
      <span class='system identifier id'>system</span> <span class='string val'>&quot;stty -echo&quot;</span>
      <span class='$stdout gvar id'>$stdout</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='string val'>&quot;sudo password: &quot;</span>
      <span class='$stdout gvar id'>$stdout</span><span class='dot token'>.</span><span class='flush identifier id'>flush</span>
      <span class='sudo_password identifier id'>sudo_password</span> <span class='assign token'>=</span> <span class='$stdin gvar id'>$stdin</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
      <span class='$stdout gvar id'>$stdout</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span>
    <span class='ensure ensure kw'>ensure</span>
      <span class='system identifier id'>system</span> <span class='dstring node'>&quot;stty #{state}&quot;</span>
    <span class='end end kw'>end</span>
    <span class='sudo_password identifier id'>sudo_password</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>set_path</h3>
</div><div id="set_path-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>set_path</span><span class='args'>(name, subdir)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 458</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L458">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">458
459
460</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_path identifier id'>set_path</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='subdir identifier id'>subdir</span><span class='rparen token'>)</span> <span class='comment val'># :nodoc:</span>
  <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='deploy_to identifier id'>deploy_to</span><span class='comma token'>,</span> <span class='subdir identifier id'>subdir</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>simple_set</h3>
</div><div id="simple_set-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>simple_set</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 462</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L462">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">462
463
464
465
466
467</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='simple_set identifier id'>simple_set</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span> <span class='comment val'># :nodoc:</span>
  <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='lbrack token'>[</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rbrack token'>]</span>
  <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span>
    <span class='set identifier id'>set</span> <span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>task</h3>
</div><div id="task-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>task</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The Rake::RemoteTask executing in this Thread.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 472</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L472">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">472
473
474</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='task identifier id'>task</span>
  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:task</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>tasks</h3>
</div><div id="tasks-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>tasks</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The configured Rake::RemoteTasks.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 479</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L479">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">479
480
481</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='tasks identifier id'>tasks</span>
  <span class='@@tasks ivar id'>@@tasks</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>defined_target_hosts?</h3>
</div><div id="defined_target_hosts-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>defined_target_hosts?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Similar to target_hosts, but returns true if user defined any hosts, even
an empty list.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 517</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L517">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">517
518
519
520
521
522
523
524
525
526</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='defined_target_hosts? fid id'>defined_target_hosts?</span>
  <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;HOSTS&quot;</span><span class='rbrack token'>]</span>
  <span class='roles identifier id'>roles</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span>
  <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
  <span class='comment val'># borrowed from hosts_for:</span>
  <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='unless unless_mod kw'>unless</span> <span class='@@def_role_hash ivar id'>@@def_role_hash</span><span class='dot token'>.</span><span class='eql? fid id'>eql?</span> <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='roles identifier id'>roles</span><span class='lbrack token'>[</span><span class='r identifier id'>r</span><span class='rbrack token'>]</span> 
  <span class='rbrace token'>}</span>
  <span class='return return kw'>return</span> <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>enhance</h3>
</div><div id="enhance-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>enhance</span><span class='args'>(deps = nil, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="original_enhance-instance_method">original_enhance</tt>
  
</p>
</div><div class="section docstring">
  <p>
Add remote action <tt>block</tt> to this task with dependencies
<tt>deps</tt>. See Rake::Task#enhance.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 68</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L68">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">68
69
70
71
72</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='enhance identifier id'>enhance</span><span class='lparen token'>(</span><span class='deps identifier id'>deps</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='original_enhance identifier id'>original_enhance</span><span class='lparen token'>(</span><span class='deps identifier id'>deps</span><span class='rparen token'>)</span> <span class='comment val'># can't use super because block passed regardless.</span>
  <span class='@remote_actions ivar id'>@remote_actions</span> <span class='lshft op'>&lt;&lt;</span> <span class='Action constant id'>Action</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
  <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>execute</h3>
</div><div id="execute-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>execute</span><span class='args'>(args = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Execute this action. Local actions will be performed first, then remote
actions will be performed in parallel on each host configured for this
RemoteTask.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a title="Vlad::ConfigurationError" href="../Vlad/ConfigurationError.html">Vlad::ConfigurationError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 79</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L79">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">79
80
81
82
83
84
85
86
87</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span>
        <span class='dstring node'>&quot;No target hosts specified on task #{self.name} for roles #{options[:roles].inspect}&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span>
    <span class='notop op'>!</span> <span class='defined_target_hosts? fid id'>defined_target_hosts?</span>

  <span class='super super kw'>super</span> <span class='args identifier id'>args</span>

  <span class='@remote_actions ivar id'>@remote_actions</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='act identifier id'>act</span><span class='bitor op'>|</span> <span class='act identifier id'>act</span><span class='dot token'>.</span><span class='execute identifier id'>execute</span><span class='lparen token'>(</span><span class='target_hosts identifier id'>target_hosts</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get</h3>
</div><div id="get-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get</span><span class='args'>(local_dir, *files)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Pull <tt>files</tt> from the remote <tt>host</tt> using rsync to
<tt>local_dir</tt>. TODO: what if role has multiple hosts &amp; the files
overlap? subdirs?
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 93</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L93">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">93
94
95
96
97
98</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='get identifier id'>get</span> <span class='local_dir identifier id'>local_dir</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='files identifier id'>files</span>
  <span class='@happy ivar id'>@happy</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='host identifier id'>host</span> <span class='assign token'>=</span> <span class='target_host identifier id'>target_host</span>
  <span class='rsync identifier id'>rsync</span> <span class='files identifier id'>files</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{host}:#{f}&quot;</span> <span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='local_dir identifier id'>local_dir</span>
  <span class='@happy ivar id'>@happy</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>put</h3>
</div><div id="put-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>put</span><span class='args'>(remote_path, base_name = File.basename(remote_path))</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Copy a (usually generated) file to <tt>remote_path</tt>. Contents of block
are copied to <tt>remote_path</tt> and you may specify an optional
base_name for the tempfile (aids in debugging).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 105</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L105">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">105
106
107
108
109
110
111
112
113
114</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='put identifier id'>put</span> <span class='remote_path identifier id'>remote_path</span><span class='comma token'>,</span> <span class='base_name identifier id'>base_name</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='basename identifier id'>basename</span><span class='lparen token'>(</span><span class='remote_path identifier id'>remote_path</span><span class='rparen token'>)</span>
  <span class='require identifier id'>require</span> <span class='string val'>'tempfile'</span>
  <span class='Tempfile constant id'>Tempfile</span><span class='dot token'>.</span><span class='open identifier id'>open</span> <span class='base_name identifier id'>base_name</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fp identifier id'>fp</span><span class='bitor op'>|</span>
    <span class='fp identifier id'>fp</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='yield yield kw'>yield</span>
    <span class='fp identifier id'>fp</span><span class='dot token'>.</span><span class='flush identifier id'>flush</span>
    <span class='@happy ivar id'>@happy</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='rsync identifier id'>rsync</span> <span class='fp identifier id'>fp</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{target_host}:#{remote_path}&quot;</span>
    <span class='@happy ivar id'>@happy</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>rsync</h3>
</div><div id="rsync-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>rsync</span><span class='args'>(*args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Execute rsync with <tt>args</tt>. Tacks on pre-specified <tt>rsync_cmd</tt>
and <tt>rsync_flags</tt>.
</p>
<p>
Favor #get and #put for most tasks. Old-style direct use where the
target_host was implicit is now deprecated.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a title="Vlad::CommandFailedError" href="../Vlad/CommandFailedError.html">Vlad::CommandFailedError</a></tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 123</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L123">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">123
124
125
126
127
128
129
130
131
132
133
134
135
136
137</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='rsync identifier id'>rsync</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='unless unless kw'>unless</span> <span class='@happy ivar id'>@happy</span> <span class='orop op'>||</span> <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/:/</span> <span class='then then kw'>then</span>
    <span class='warn identifier id'>warn</span> <span class='string val'>&quot;rsync deprecation: pass target_host:remote_path explicitly&quot;</span>
    <span class='args identifier id'>args</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{target_host}:#{args[-1]}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='cmd identifier id'>cmd</span>    <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rsync_cmd identifier id'>rsync_cmd</span><span class='comma token'>,</span> <span class='rsync_flags identifier id'>rsync_flags</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span>
  <span class='cmdstr identifier id'>cmdstr</span> <span class='assign token'>=</span> <span class='cmd identifier id'>cmd</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='string val'>' '</span>

  <span class='warn identifier id'>warn</span> <span class='cmdstr identifier id'>cmdstr</span> <span class='if if_mod kw'>if</span> <span class='$TRACE gvar id'>$TRACE</span>

  <span class='success identifier id'>success</span> <span class='assign token'>=</span> <span class='system identifier id'>system</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='cmd identifier id'>cmd</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span> <span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='CommandFailedError constant id'>CommandFailedError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;execution failed: #{cmdstr}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='success identifier id'>success</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run</h3>
</div><div id="run-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run</span><span class='args'>(command)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Use ssh to execute <tt>command</tt> on target_host. If <tt>command</tt>
uses sudo, the sudo password will be prompted for then saved for subsequent
sudo commands.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 143</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L143">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='run identifier id'>run</span> <span class='command identifier id'>command</span>
    <span class='cmd identifier id'>cmd</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='ssh_cmd identifier id'>ssh_cmd</span><span class='comma token'>,</span> <span class='ssh_flags identifier id'>ssh_flags</span><span class='comma token'>,</span> <span class='target_host identifier id'>target_host</span><span class='comma token'>,</span> <span class='command identifier id'>command</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>

    <span class='trace identifier id'>trace</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='ssh_cmd identifier id'>ssh_cmd</span><span class='comma token'>,</span> <span class='ssh_flags identifier id'>ssh_flags</span><span class='comma token'>,</span> <span class='target_host identifier id'>target_host</span><span class='comma token'>,</span> <span class='dstring node'>&quot;'#{command}'&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' '</span><span class='rparen token'>)</span>
    <span class='warn identifier id'>warn</span> <span class='trace identifier id'>trace</span> <span class='if if_mod kw'>if</span> <span class='$TRACE gvar id'>$TRACE</span>

    <span class='pid identifier id'>pid</span><span class='comma token'>,</span> <span class='inn identifier id'>inn</span><span class='comma token'>,</span> <span class='out identifier id'>out</span><span class='comma token'>,</span> <span class='err identifier id'>err</span> <span class='assign token'>=</span> <span class='popen4 identifier id'>popen4</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='cmd identifier id'>cmd</span><span class='rparen token'>)</span>

    <span class='inn identifier id'>inn</span><span class='dot token'>.</span><span class='sync identifier id'>sync</span>   <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='streams identifier id'>streams</span>    <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='out identifier id'>out</span><span class='comma token'>,</span> <span class='err identifier id'>err</span><span class='rbrack token'>]</span>
    <span class='out_stream identifier id'>out_stream</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
      <span class='out identifier id'>out</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='$stdout gvar id'>$stdout</span><span class='comma token'>,</span>
      <span class='err identifier id'>err</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='$stderr gvar id'>$stderr</span><span class='comma token'>,</span>
    <span class='rbrace token'>}</span>

    <span class='comment val'># Handle process termination ourselves</span>
    <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='start identifier id'>start</span> <span class='do do kw'>do</span>
      <span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='Process constant id'>Process</span><span class='dot token'>.</span><span class='waitpid2 identifier id'>waitpid2</span><span class='lparen token'>(</span><span class='pid identifier id'>pid</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
    <span class='end end kw'>end</span>

    <span class='until until kw'>until</span> <span class='streams identifier id'>streams</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='do do kw'>do</span>
      <span class='comment val'># don't busy loop</span>
      <span class='selected identifier id'>selected</span><span class='comma token'>,</span> <span class='assign token'>=</span> <span class='select identifier id'>select</span> <span class='streams identifier id'>streams</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.1</span>

      <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='selected identifier id'>selected</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='selected identifier id'>selected</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

      <span class='selected identifier id'>selected</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='stream identifier id'>stream</span><span class='bitor op'>|</span>
        <span class='if if kw'>if</span> <span class='stream identifier id'>stream</span><span class='dot token'>.</span><span class='eof? fid id'>eof?</span> <span class='then then kw'>then</span>
          <span class='streams identifier id'>streams</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='stream identifier id'>stream</span> <span class='if if_mod kw'>if</span> <span class='status identifier id'>status</span> <span class='comment val'># we've quit, so no more writing</span>
          <span class='next next kw'>next</span>
        <span class='end end kw'>end</span>

        <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='stream identifier id'>stream</span><span class='dot token'>.</span><span class='readpartial identifier id'>readpartial</span><span class='lparen token'>(</span><span class='integer val'>1024</span><span class='rparen token'>)</span>
        <span class='out_stream identifier id'>out_stream</span><span class='lbrack token'>[</span><span class='stream identifier id'>stream</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='data identifier id'>data</span>

        <span class='if if kw'>if</span> <span class='stream identifier id'>stream</span> <span class='eq op'>==</span> <span class='err identifier id'>err</span> <span class='and and kw'>and</span> <span class='data identifier id'>data</span> <span class='match op'>=~</span> <span class='sudo_prompt identifier id'>sudo_prompt</span> <span class='then then kw'>then</span>
          <span class='inn identifier id'>inn</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='sudo_password identifier id'>sudo_password</span>
          <span class='data identifier id'>data</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;\n&quot;</span>
          <span class='$stderr gvar id'>$stderr</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='string val'>&quot;\n&quot;</span>
        <span class='end end kw'>end</span>

        <span class='result identifier id'>result</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='unless unless kw'>unless</span> <span class='status identifier id'>status</span><span class='dot token'>.</span><span class='success? fid id'>success?</span> <span class='then then kw'>then</span>
      <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='CommandFailedError constant id'>CommandFailedError</span><span class='comma token'>,</span>
            <span class='dstring node'>&quot;execution failed with status #{status.exitstatus}: #{cmd.join ' '}&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
  <span class='ensure ensure kw'>ensure</span>
    <span class='inn identifier id'>inn</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span>
    <span class='out identifier id'>out</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span>
    <span class='err identifier id'>err</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Returns an Array with every host configured.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='all_hosts identifier id'>all_hosts</span>
    <span class='hosts_for identifier id'>hosts_for</span><span class='lparen token'>(</span><span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># The default environment values. Used for resetting (mostly for</span>
  <span class='comment val'># tests).</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='default_env identifier id'>default_env</span>
    <span class='@@default_env ivar id'>@@default_env</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='per_thread identifier id'>per_thread</span>
    <span class='@@per_thread ivar id'>@@per_thread</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># The vlad environment.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='env identifier id'>env</span>
    <span class='@@env ivar id'>@@env</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Fetches environment variable +name+ from the environment using</span>
  <span class='comment val'># default +default+.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='default identifier id'>default</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='if if_mod kw'>if</span> <span class='Symbol constant id'>Symbol</span> <span class='eqq op'>===</span> <span class='name identifier id'>name</span>
    <span class='if if kw'>if</span> <span class='@@env ivar id'>@@env</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span> <span class='name identifier id'>name</span> <span class='then then kw'>then</span>
      <span class='protect_env identifier id'>protect_env</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
        <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
        <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='if if_mod kw'>if</span> <span class='Proc constant id'>Proc</span> <span class='eqq op'>===</span> <span class='v identifier id'>v</span> <span class='unless unless_mod kw'>unless</span> <span class='per_thread identifier id'>per_thread</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
        <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='if if_mod kw'>if</span> <span class='Proc constant id'>Proc</span> <span class='eqq op'>===</span> <span class='v identifier id'>v</span>
        <span class='v identifier id'>v</span>
      <span class='end end kw'>end</span>
    <span class='elsif elsif kw'>elsif</span> <span class='default identifier id'>default</span> <span class='orop op'>||</span> <span class='default identifier id'>default</span> <span class='eq op'>==</span> <span class='false false kw'>false</span>
      <span class='v identifier id'>v</span> <span class='assign token'>=</span> <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='default identifier id'>default</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='FetchError constant id'>FetchError</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Add host +host_name+ that belongs to +roles+. Extra arguments may</span>
  <span class='comment val'># be specified for the host as a hash as the last argument.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># host is the inversion of role:</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   host 'db1.example.com', :db, :master_db</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Is equivalent to:</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   role :db, 'db1.example.com'</span>
  <span class='comment val'>#   role :master_db, 'db1.example.com'</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='host identifier id'>host</span> <span class='host_name identifier id'>host_name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='roles identifier id'>roles</span>
    <span class='opts identifier id'>opts</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span> <span class='eqq op'>===</span> <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='last identifier id'>last</span> <span class='integer val'>? </span><span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

    <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='role_name identifier id'>role_name</span><span class='bitor op'>|</span>
      <span class='role identifier id'>role</span> <span class='role_name identifier id'>role_name</span><span class='comma token'>,</span> <span class='host_name identifier id'>host_name</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Returns an Array of all hosts in +roles+.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='hosts_for identifier id'>hosts_for</span> <span class='mult op'>*</span><span class='roles identifier id'>roles</span>
    <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='roles identifier id'>roles</span><span class='lbrack token'>[</span><span class='r identifier id'>r</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span>
    <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='mandatory identifier id'>mandatory</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='desc identifier id'>desc</span> <span class='comment val'># :nodoc:</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='raise identifier id'>raise</span><span class='lparen token'>(</span><span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='ConfigurationError constant id'>ConfigurationError</span><span class='comma token'>,</span>
            <span class='dstring node'>&quot;Please specify the #{desc} via the #{name.inspect} variable&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Ensures exclusive access to +name+.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='protect_env identifier id'>protect_env</span> <span class='name identifier id'>name</span> <span class='comment val'># :nodoc:</span>
    <span class='@@env_locks ivar id'>@@env_locks</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='do do kw'>do</span>
      <span class='yield yield kw'>yield</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Adds a remote task named +name+ with options +options+ that will</span>
  <span class='comment val'># execute +block+.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='remote_task identifier id'>remote_task</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
    <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Hash constant id'>Hash</span> <span class='eqq op'>===</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='pop identifier id'>pop</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='define_task identifier id'>define_task</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span> <span class='opasgn op'>|=</span> <span class='@@current_roles ivar id'>@@current_roles</span>
    <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span>
    <span class='t identifier id'>t</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Ensures +name+ does not conflict with an existing method.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reserved_name? fid id'>reserved_name?</span> <span class='name identifier id'>name</span> <span class='comment val'># :nodoc:</span>
    <span class='notop op'>!</span><span class='@@env ivar id'>@@env</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Resets vlad, restoring all roles, tasks and environment variables</span>
  <span class='comment val'># to the defaults.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span>
    <span class='@@def_role_hash ivar id'>@@def_role_hash</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>                <span class='comment val'># official default role value</span>
    <span class='@@env ivar id'>@@env</span>           <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@@tasks ivar id'>@@tasks</span>         <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@@roles ivar id'>@@roles</span>         <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='@@def_role_hash ivar id'>@@def_role_hash</span> <span class='rbrace token'>}</span>
    <span class='@@env_locks ivar id'>@@env_locks</span>     <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Mutex constant id'>Mutex</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='rbrace token'>}</span>

    <span class='@@default_env ivar id'>@@default_env</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span>
      <span class='case case kw'>case</span> <span class='v identifier id'>v</span>
      <span class='when when kw'>when</span> <span class='Symbol constant id'>Symbol</span><span class='comma token'>,</span> <span class='Fixnum constant id'>Fixnum</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='integer val'>42</span> <span class='then then kw'>then</span> <span class='comment val'># ummmm... yeah. bite me.</span>
        <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span>
      <span class='else else kw'>else</span>
        <span class='@@env ivar id'>@@env</span><span class='lbrack token'>[</span><span class='k identifier id'>k</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='v identifier id'>v</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Adds role +role_name+ with +host+ and +args+ for that host.</span>
  <span class='comment val'># TODO: merge:</span>
  <span class='comment val'># Declare a role and assign a remote host to it. Equivalent to the</span>
  <span class='comment val'># &lt;tt&gt;host&lt;/tt&gt; method; provided for capistrano compatibility.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='role identifier id'>role</span> <span class='role_name identifier id'>role_name</span><span class='comma token'>,</span> <span class='host identifier id'>host</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='if if kw'>if</span> <span class='block_given? fid id'>block_given?</span> <span class='then then kw'>then</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'host not allowed with block'</span> <span class='unless unless_mod kw'>unless</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

      <span class='begin begin kw'>begin</span>
        <span class='current_roles identifier id'>current_roles</span> <span class='lshft op'>&lt;&lt;</span> <span class='role_name identifier id'>role_name</span>
        <span class='yield yield kw'>yield</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='current_roles identifier id'>current_roles</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='role_name identifier id'>role_name</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'host required'</span> <span class='if if_mod kw'>if</span> <span class='host identifier id'>host</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>

      <span class='lbrack token'>[</span><span class='mult op'>*</span><span class='host identifier id'>host</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='hst identifier id'>hst</span><span class='bitor op'>|</span>
        <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;invalid host: #{hst}&quot;</span> <span class='if if_mod kw'>if</span> <span class='hst identifier id'>hst</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='hst identifier id'>hst</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='end end kw'>end</span>
      <span class='@@roles ivar id'>@@roles</span><span class='lbrack token'>[</span><span class='role_name identifier id'>role_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='if if_mod kw'>if</span> <span class='@@def_role_hash ivar id'>@@def_role_hash</span><span class='dot token'>.</span><span class='eql? fid id'>eql?</span> <span class='@@roles ivar id'>@@roles</span><span class='lbrack token'>[</span><span class='role_name identifier id'>role_name</span><span class='rbrack token'>]</span>
      <span class='@@roles ivar id'>@@roles</span><span class='lbrack token'>[</span><span class='role_name identifier id'>role_name</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='host identifier id'>host</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># The configured roles.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='roles identifier id'>roles</span>
    <span class='host identifier id'>host</span> <span class='domain identifier id'>domain</span><span class='comma token'>,</span> <span class='symbol val'>:app</span><span class='comma token'>,</span> <span class='symbol val'>:web</span><span class='comma token'>,</span> <span class='symbol val'>:db</span> <span class='if if_mod kw'>if</span> <span class='@@roles ivar id'>@@roles</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

    <span class='@@roles ivar id'>@@roles</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Set environment variable +name+ to +value+ or +default_block+.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># If +default_block+ is defined, the block will be executed the</span>
  <span class='comment val'># first time the variable is fetched, and the value will be used for</span>
  <span class='comment val'># every subsequent fetch.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set identifier id'>set</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='default_block identifier id'>default_block</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>&quot;cannot provide both a value and a block&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='value identifier id'>value</span> <span class='and and kw'>and</span> <span class='default_block identifier id'>default_block</span> <span class='unless unless_mod kw'>unless</span>
      <span class='value identifier id'>value</span> <span class='eq op'>==</span> <span class='symbol val'>:per_thread</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;cannot set reserved name: '#{name}'&quot;</span> <span class='if if_mod kw'>if</span>
      <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='reserved_name? fid id'>reserved_name?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='$TESTING gvar id'>$TESTING</span>

    <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>

    <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='per_thread identifier id'>per_thread</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span>
      <span class='default_block identifier id'>default_block</span> <span class='andop op'>&amp;&amp;</span> <span class='value identifier id'>value</span> <span class='eq op'>==</span> <span class='symbol val'>:per_thread</span>

    <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='default_env identifier id'>default_env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span>
      <span class='default_block identifier id'>default_block</span> <span class='orop op'>||</span> <span class='value identifier id'>value</span>

    <span class='Object constant id'>Object</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='symbol val'>:define_method</span><span class='comma token'>,</span> <span class='name identifier id'>name</span> <span class='do do kw'>do</span>
      <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='fetch identifier id'>fetch</span> <span class='name identifier id'>name</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Sets all the default values. Should only be called once. Use reset</span>
  <span class='comment val'># if you need to restore values.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_defaults identifier id'>set_defaults</span>
    <span class='@@default_env ivar id'>@@default_env</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='@@per_thread ivar id'>@@per_thread</span>  <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span>

    <span class='mandatory identifier id'>mandatory</span> <span class='symbol val'>:repository</span><span class='comma token'>,</span> <span class='string val'>&quot;repository path&quot;</span>
    <span class='mandatory identifier id'>mandatory</span> <span class='symbol val'>:deploy_to</span><span class='comma token'>,</span>  <span class='string val'>&quot;deploy path&quot;</span>
    <span class='mandatory identifier id'>mandatory</span> <span class='symbol val'>:domain</span><span class='comma token'>,</span>     <span class='string val'>&quot;server domain&quot;</span>

    <span class='simple_set identifier id'>simple_set</span><span class='lparen token'>(</span><span class='symbol val'>:deploy_timestamped</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
               <span class='symbol val'>:deploy_via</span><span class='comma token'>,</span>         <span class='symbol val'>:export</span><span class='comma token'>,</span>
               <span class='symbol val'>:keep_releases</span><span class='comma token'>,</span>      <span class='integer val'>5</span><span class='comma token'>,</span>
               <span class='symbol val'>:migrate_args</span><span class='comma token'>,</span>       <span class='string val'>&quot;&quot;</span><span class='comma token'>,</span>
               <span class='symbol val'>:migrate_target</span><span class='comma token'>,</span>     <span class='symbol val'>:latest</span><span class='comma token'>,</span>
               <span class='symbol val'>:rails_env</span><span class='comma token'>,</span>          <span class='string val'>&quot;production&quot;</span><span class='comma token'>,</span>
               <span class='symbol val'>:rake_cmd</span><span class='comma token'>,</span>           <span class='string val'>&quot;rake&quot;</span><span class='comma token'>,</span>
               <span class='symbol val'>:revision</span><span class='comma token'>,</span>           <span class='string val'>&quot;head&quot;</span><span class='comma token'>,</span>
               <span class='symbol val'>:rsync_cmd</span><span class='comma token'>,</span>          <span class='string val'>&quot;rsync&quot;</span><span class='comma token'>,</span>
               <span class='symbol val'>:rsync_flags</span><span class='comma token'>,</span>        <span class='lbrack token'>[</span><span class='string val'>'-azP'</span><span class='comma token'>,</span> <span class='string val'>'--delete'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
               <span class='symbol val'>:ssh_cmd</span><span class='comma token'>,</span>            <span class='string val'>&quot;ssh&quot;</span><span class='comma token'>,</span>
               <span class='symbol val'>:ssh_flags</span><span class='comma token'>,</span>          <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
               <span class='symbol val'>:sudo_cmd</span><span class='comma token'>,</span>           <span class='string val'>&quot;sudo&quot;</span><span class='comma token'>,</span>
               <span class='symbol val'>:sudo_flags</span><span class='comma token'>,</span>         <span class='lbrack token'>[</span><span class='string val'>'-p Password:'</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
               <span class='symbol val'>:sudo_prompt</span><span class='comma token'>,</span>        <span class='regexp val'>/^Password:/</span><span class='comma token'>,</span>
               <span class='symbol val'>:umask</span><span class='comma token'>,</span>              <span class='string val'>'02'</span><span class='rparen token'>)</span>

    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:current_release</span><span class='rparen token'>)</span>    <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='releases_path identifier id'>releases_path</span><span class='comma token'>,</span> <span class='releases identifier id'>releases</span><span class='lbrack token'>[</span><span class='integer val'>-1</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:latest_release</span><span class='rparen token'>)</span>     <span class='lbrace token'>{</span> <span class='deploy_timestamped identifier id'>deploy_timestamped</span> <span class='question op'>?</span><span class='release_path identifier id'>release_path</span><span class='colon op'>:</span> <span class='current_release identifier id'>current_release</span> <span class='rbrace token'>}</span>
    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:previous_release</span><span class='rparen token'>)</span>   <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='releases_path identifier id'>releases_path</span><span class='comma token'>,</span> <span class='releases identifier id'>releases</span><span class='lbrack token'>[</span><span class='integer val'>-2</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:release_name</span><span class='rparen token'>)</span>       <span class='lbrace token'>{</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='dot token'>.</span><span class='utc identifier id'>utc</span><span class='dot token'>.</span><span class='strftime identifier id'>strftime</span><span class='lparen token'>(</span><span class='string val'>&quot;%Y%m%d%H%M%S&quot;</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:release_path</span><span class='rparen token'>)</span>       <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='releases_path identifier id'>releases_path</span><span class='comma token'>,</span> <span class='release_name identifier id'>release_name</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:releases</span><span class='rparen token'>)</span>           <span class='lbrace token'>{</span> <span class='task identifier id'>task</span><span class='dot token'>.</span><span class='run identifier id'>run</span><span class='lparen token'>(</span><span class='dstring node'>&quot;ls -x #{releases_path}&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span> <span class='rbrace token'>}</span>

    <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:current_path</span><span class='comma token'>,</span>  <span class='string val'>&quot;current&quot;</span>
    <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:releases_path</span><span class='comma token'>,</span> <span class='string val'>&quot;releases&quot;</span>
    <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:scm_path</span><span class='comma token'>,</span>      <span class='string val'>&quot;scm&quot;</span>
    <span class='set_path identifier id'>set_path</span> <span class='symbol val'>:shared_path</span><span class='comma token'>,</span>   <span class='string val'>&quot;shared&quot;</span>

    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='symbol val'>:sudo_password</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='state identifier id'>state</span> <span class='assign token'>=</span> <span class='xstring val'>`stty -g`</span>

      <span class='raise identifier id'>raise</span> <span class='Vlad constant id'>Vlad</span><span class='colon2 op'>::</span><span class='Error constant id'>Error</span><span class='comma token'>,</span> <span class='string val'>&quot;stty(1) not found&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='$? gvar id'>$?</span><span class='dot token'>.</span><span class='success? fid id'>success?</span>

      <span class='begin begin kw'>begin</span>
        <span class='system identifier id'>system</span> <span class='string val'>&quot;stty -echo&quot;</span>
        <span class='$stdout gvar id'>$stdout</span><span class='dot token'>.</span><span class='print identifier id'>print</span> <span class='string val'>&quot;sudo password: &quot;</span>
        <span class='$stdout gvar id'>$stdout</span><span class='dot token'>.</span><span class='flush identifier id'>flush</span>
        <span class='sudo_password identifier id'>sudo_password</span> <span class='assign token'>=</span> <span class='$stdin gvar id'>$stdin</span><span class='dot token'>.</span><span class='gets identifier id'>gets</span>
        <span class='$stdout gvar id'>$stdout</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span>
      <span class='ensure ensure kw'>ensure</span>
        <span class='system identifier id'>system</span> <span class='dstring node'>&quot;stty #{state}&quot;</span>
      <span class='end end kw'>end</span>
      <span class='sudo_password identifier id'>sudo_password</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='set_path identifier id'>set_path</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='subdir identifier id'>subdir</span><span class='rparen token'>)</span> <span class='comment val'># :nodoc:</span>
    <span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='deploy_to identifier id'>deploy_to</span><span class='comma token'>,</span> <span class='subdir identifier id'>subdir</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='simple_set identifier id'>simple_set</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span> <span class='comment val'># :nodoc:</span>
    <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='lbrack token'>[</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rbrack token'>]</span>
    <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='bitor op'>|</span>
      <span class='set identifier id'>set</span> <span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># The Rake::RemoteTask executing in this Thread.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='task identifier id'>task</span>
    <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:task</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># The configured Rake::RemoteTasks.</span>

  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='tasks identifier id'>tasks</span>
    <span class='@@tasks ivar id'>@@tasks</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Execute +command+ under sudo using run.</span>

  <span class='def def kw'>def</span> <span class='sudo identifier id'>sudo</span> <span class='command identifier id'>command</span>
    <span class='run identifier id'>run</span> <span class='lbrack token'>[</span><span class='sudo_cmd identifier id'>sudo_cmd</span><span class='comma token'>,</span> <span class='sudo_flags identifier id'>sudo_flags</span><span class='comma token'>,</span> <span class='command identifier id'>command</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># The hosts this task will execute on. The hosts are determined from</span>
  <span class='comment val'># the role this task belongs to.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># The target hosts may be overridden by providing a comma-separated</span>
  <span class='comment val'># list of commands to the HOSTS environment variable:</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   rake my_task HOSTS=app1.example.com,app2.example.com</span>

  <span class='def def kw'>def</span> <span class='target_hosts identifier id'>target_hosts</span>
    <span class='if if kw'>if</span> <span class='hosts identifier id'>hosts</span> <span class='assign token'>=</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;HOSTS&quot;</span><span class='rbrack token'>]</span> <span class='then then kw'>then</span>
      <span class='hosts identifier id'>hosts</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;,&quot;</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='roles identifier id'>roles</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span>

      <span class='if if kw'>if</span> <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='then then kw'>then</span>
        <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='all_hosts identifier id'>all_hosts</span>
      <span class='else else kw'>else</span>
        <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='hosts_for identifier id'>hosts_for</span> <span class='roles identifier id'>roles</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Similar to target_hosts, but returns true if user defined any hosts, even</span>
  <span class='comment val'># an empty list.</span>

  <span class='def def kw'>def</span> <span class='defined_target_hosts? fid id'>defined_target_hosts?</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;HOSTS&quot;</span><span class='rbrack token'>]</span>
    <span class='roles identifier id'>roles</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span>
    <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='if if_mod kw'>if</span> <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='comment val'># borrowed from hosts_for:</span>
    <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='r identifier id'>r</span><span class='bitor op'>|</span>
      <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='unless unless_mod kw'>unless</span> <span class='@@def_role_hash ivar id'>@@def_role_hash</span><span class='dot token'>.</span><span class='eql? fid id'>eql?</span> <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='roles identifier id'>roles</span><span class='lbrack token'>[</span><span class='r identifier id'>r</span><span class='rbrack token'>]</span> 
    <span class='rbrace token'>}</span>
    <span class='return return kw'>return</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>##</span>
  <span class='comment val'># Action is used to run a task's remote_actions in parallel on each</span>
  <span class='comment val'># of its hosts. Actions are created automatically in</span>
  <span class='comment val'># Rake::RemoteTask#enhance.</span>

  <span class='class class kw'>class</span> <span class='Action constant id'>Action</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The task this action is attached to.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:task</span>

    <span class='comment val'>##</span>
    <span class='comment val'># The block this action will execute.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:block</span>

    <span class='comment val'>##</span>
    <span class='comment val'># An Array of threads, one for each host this action executes on.</span>

    <span class='attr_reader identifier id'>attr_reader</span> <span class='symbol val'>:workers</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Creates a new Action that will run +block+ for +task+.</span>

    <span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='task identifier id'>task</span><span class='comma token'>,</span> <span class='block identifier id'>block</span>
      <span class='@task ivar id'>@task</span>  <span class='assign token'>=</span> <span class='task identifier id'>task</span>
      <span class='@block ivar id'>@block</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>
      <span class='@workers ivar id'>@workers</span> <span class='assign token'>=</span> <span class='ThreadGroup constant id'>ThreadGroup</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='eq op'>==</span> <span class='other identifier id'>other</span> <span class='comment val'># :nodoc:</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='Action constant id'>Action</span> <span class='eqq op'>===</span> <span class='other identifier id'>other</span>
      <span class='block identifier id'>block</span> <span class='eq op'>==</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='block identifier id'>block</span> <span class='andop op'>&amp;&amp;</span> <span class='task identifier id'>task</span> <span class='eq op'>==</span> <span class='other identifier id'>other</span><span class='dot token'>.</span><span class='task identifier id'>task</span>
    <span class='end end kw'>end</span>

    <span class='comment val'>##</span>
    <span class='comment val'># Execute this action on +hosts+ in parallel. Returns when block</span>
    <span class='comment val'># has completed for each host.</span>

    <span class='def def kw'>def</span> <span class='execute identifier id'>execute</span> <span class='hosts identifier id'>hosts</span><span class='comma token'>,</span> <span class='task identifier id'>task</span><span class='comma token'>,</span> <span class='args identifier id'>args</span>
      <span class='hosts identifier id'>hosts</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='host identifier id'>host</span><span class='bitor op'>|</span>
        <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='task identifier id'>task</span><span class='dot token'>.</span><span class='clone identifier id'>clone</span>
        <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='target_host identifier id'>target_host</span> <span class='assign token'>=</span> <span class='host identifier id'>host</span>
        <span class='thread identifier id'>thread</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='t identifier id'>t</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='task identifier id'>task</span><span class='bitor op'>|</span>
          <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:task</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='task identifier id'>task</span>
          <span class='case case kw'>case</span> <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='arity identifier id'>arity</span>
          <span class='when when kw'>when</span> <span class='integer val'>1</span>
            <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='task identifier id'>task</span>
          <span class='else else kw'>else</span>
            <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span> <span class='task identifier id'>task</span><span class='comma token'>,</span> <span class='args identifier id'>args</span>
          <span class='end end kw'>end</span>
          <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span><span class='lbrack token'>[</span><span class='symbol val'>:task</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='end end kw'>end</span>
        <span class='@workers ivar id'>@workers</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='thread identifier id'>thread</span>
      <span class='end end kw'>end</span>
      <span class='@workers ivar id'>@workers</span><span class='dot token'>.</span><span class='list identifier id'>list</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='thr identifier id'>thr</span><span class='bitor op'>|</span> <span class='thr identifier id'>thr</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sudo</h3>
</div><div id="sudo-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sudo</span><span class='args'>(command)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Execute <tt>command</tt> under sudo using run.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 486</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L486">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">486
487
488</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='sudo identifier id'>sudo</span> <span class='command identifier id'>command</span>
  <span class='run identifier id'>run</span> <span class='lbrack token'>[</span><span class='sudo_cmd identifier id'>sudo_cmd</span><span class='comma token'>,</span> <span class='sudo_flags identifier id'>sudo_flags</span><span class='comma token'>,</span> <span class='command identifier id'>command</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span><span class='dot token'>.</span><span class='compact identifier id'>compact</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot; &quot;</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>target_hosts</h3>
</div><div id="target_hosts-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>target_hosts</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The hosts this task will execute on. The hosts are determined from the role
this task belongs to.
</p>
<p>
The target hosts may be overridden by providing a comma-separated list of
commands to the HOSTS environment variable:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='my_task identifier id'>my_task</span> <span class='HOSTS constant id'>HOSTS</span><span class='assign token'>=</span><span class='app1 identifier id'>app1</span><span class='dot token'>.</span><span class='example identifier id'>example</span><span class='dot token'>.</span><span class='com identifier id'>com</span><span class='comma token'>,</span><span class='app2 identifier id'>app2</span><span class='dot token'>.</span><span class='example identifier id'>example</span><span class='dot token'>.</span><span class='com identifier id'>com</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/rake_remote_task.rb', line 499</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/seattlerb/vlad/blob/4237ed68d123996df9114839f0070b0cf6a71717/lib/rake_remote_task.rb#L499">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">499
500
501
502
503
504
505
506
507
508
509
510
511</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='target_hosts identifier id'>target_hosts</span>
  <span class='if if kw'>if</span> <span class='hosts identifier id'>hosts</span> <span class='assign token'>=</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;HOSTS&quot;</span><span class='rbrack token'>]</span> <span class='then then kw'>then</span>
    <span class='hosts identifier id'>hosts</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span><span class='dot token'>.</span><span class='gsub identifier id'>gsub</span><span class='lparen token'>(</span><span class='regexp val'>/\s+/</span><span class='comma token'>,</span> <span class='string val'>''</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>&quot;,&quot;</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='roles identifier id'>roles</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:roles</span><span class='rbrack token'>]</span>

    <span class='if if kw'>if</span> <span class='roles identifier id'>roles</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='then then kw'>then</span>
      <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='all_hosts identifier id'>all_hosts</span>
    <span class='else else kw'>else</span>
      <span class='Rake constant id'>Rake</span><span class='colon2 op'>::</span><span class='RemoteTask constant id'>RemoteTask</span><span class='dot token'>.</span><span class='hosts_for identifier id'>hosts_for</span> <span class='roles identifier id'>roles</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>