<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <p>
h1. Globalize2
</p>
<p>
Globalize2 is the successor of Globalize for Rails.
</p>
<p>
It is compatible with and builds on the new &quot;I18n api in Ruby on
Rails&quot;:http://rails-i18n.org. and adds model translations as well as a
bunch of other useful features, such as Locale fallbacks (RFC4647
compliant) and automatic loading of Locale data from defined directory/file
locations.
</p>
<p>
Globalize2 is much more lightweight and modular than its predecessor was.
Content translations in Globalize2 use default ActiveRecord features and do
not limit any functionality any more.
</p>
<p>
All features and tools in Globalize2 are implemented in the most
unobstrusive and loosely-coupled way possible, so you can pick whatever
features or tools you need for your application and combine them with other
tools from other libraries or plugins.
</p>
<p>
h2. Requirements
</p>
<p>
Rails 2.2 (currently Rails edge)
</p>
<p>
h2. Installation
</p>
<p>
To install Globalize2 with its default setup just use:
</p>
<p>
&lt;pre&gt;<tt> script/plugin install
git://github.com/joshmh/globalize2.git </tt>&lt;/pre&gt;
</p>
<p>
This will:
</p>
<ul>
<li>activate model translations

</li>
<li>set I18n.load_path to an instance of Globalize::LoadPath

</li>
<li>set I18n.backend to an instance of Globalize::Backend::Static

</li>
</ul>
<p>
h2. Configuration
</p>
<p>
You might want to add additional configuration to an initializer, e.g.
config/initializers/globalize.rb
</p>
<p>
h2. Model translations
</p>
<p>
Model translations (or content translations) allow you to translate your
models&#8217; attribute values. E.g.
</p>
<p>
&lt;pre&gt;&lt;code&gt; class Post &lt; ActiveRecord::Base
</p>
<pre class="code">
  <span class='translates identifier id'>translates</span> <span class='symbol val'>:title</span><span class='comma token'>,</span> <span class='symbol val'>:text</span>
</pre>
<p>
end &lt;/code&gt;&lt;/pre&gt;
</p>
<p>
Allows you to values for the attributes :title and :text per locale:
</p>
<p>
&lt;pre&gt;&lt;code&gt; I18n.locale = :en post.title # Globalize2 rocks!
</p>
<p>
I18n.locale = :he post.title # גלובאלייז2 שולט!
&lt;/code&gt;&lt;/pre&gt;
</p>
<p>
In order to make this work, you&#8217;ll need to add the appropriate
translation tables. Globalize2 comes with a handy helper method to help you
do this. It&#8217;s called @create_translation_table!@. Here&#8217;s an
example:
</p>
<p>
&lt;pre&gt;&lt;code&gt; class CreatePosts &lt; ActiveRecord::Migration
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='up identifier id'>up</span>
    <span class='create_table identifier id'>create_table</span> <span class='symbol val'>:posts</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='timestamps identifier id'>timestamps</span>
    <span class='end end kw'>end</span>
    <span class='Post constant id'>Post</span><span class='dot token'>.</span><span class='create_translation_table! fid id'>create_translation_table!</span> <span class='symbol val'>:title</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:string</span><span class='comma token'>,</span> <span class='symbol val'>:text</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:text</span>
  <span class='end end kw'>end</span>
  <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='down identifier id'>down</span>
    <span class='drop_table identifier id'>drop_table</span> <span class='symbol val'>:posts</span>
    <span class='Post constant id'>Post</span><span class='dot token'>.</span><span class='drop_translation_table! fid id'>drop_translation_table!</span>
  <span class='end end kw'>end</span>
</pre>
<p>
end &lt;/code&gt;&lt;/pre&gt;
</p>
<p>
Note that the ActiveRecord model @Post@ must already exist and have a
@translates@ directive listing the translated fields.
</p>
<p>
h2. Globalize::Backend::Static
</p>
<p>
Globalize2 ships with a Static backend that builds on the Simple backend
from the I18n library (which is shipped with Rails) and adds the following
features:
</p>
<ul>
<li>It uses locale fallbacks when looking up translation data.

</li>
<li>It returns an instance of Globalize::Translation::Static instead of a plain
Ruby String as a translation.

</li>
<li>It allows to hook in custom pluralization logic as lambdas.

</li>
</ul>
<p>
h2. Custom pluralization logic
</p>
<p>
The Simple backend has its pluralization algorithm baked in hardcoded. This
algorithm is only suitable for English and other languages that have the
same pluralization rules. It is not suitable for, e.g., Czech though.
</p>
<p>
To add custom pluralization logic to Globalize&#8217; Static backend you
can do something like this:
</p>
<p>
&lt;pre&gt;&lt;code&gt; @backend.add_pluralizer :cz, lambda{|c|
</p>
<pre class="code">
  <span class='c identifier id'>c</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='symbol val'>:one</span> <span class='colon op'>:</span> <span class='lparen token'>(</span><span class='float val'>2</span><span class='dot2 op'>..</span><span class='integer val'>4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='c identifier id'>c</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='symbol val'>:few</span> <span class='colon op'>:</span> <span class='symbol val'>:other</span>
</pre>
<p>
} &lt;/code&gt;&lt;/pre&gt;
</p>
<p>
h2. Locale Fallbacks
</p>
<p>
Globalize2 ships with a Locale fallback tool which extends the I18n module
to hold a fallbacks instance which is set to an instance of
Globalize::Locale::Fallbacks by default but can be swapped with a different
implementation.
</p>
<p>
Globalize2 fallbacks will compute a number of other locales for a given
locale. For example:
</p>
<p>
&lt;pre&gt;<tt> I18n.fallbacks[:&quot;es-MX&quot;] # =&gt;
[:&quot;es-MX&quot;, :es, :&quot;en-US&quot;, :en] </tt>&lt;/pre&gt;
</p>
<p>
Globalize2 fallbacks always fall back to
</p>
<ul>
<li>all parents of a given locale (e.g. :es for :&quot;es-MX&quot;),

</li>
<li>then to the fallbacks&#8217; default locales and all of their parents and

</li>
<li>finally to the :root locale.

</li>
</ul>
<p>
The default locales are set to [:&quot;en-US&quot;] by default but can be
set to something else. The root locale is a concept borrowed from
&quot;CLDR&quot;:http://unicode.org and makes sense for storing common
locale data which works as a last default fallback (e.g. &quot;ltr&quot;
for bidi directions).
</p>
<p>
One can additionally add any number of additional fallback locales
manually. These will be added before the default locales to the fallback
chain. For example:
</p>
<p>
&lt;pre&gt;&lt;code&gt; fb = I18n.fallbacks
</p>
<p>
fb.map :ca =&gt; :&quot;es-ES&quot; fb[:ca] # =&gt; [:ca,
:&quot;es-ES&quot;, :es, :&quot;en-US&quot;, :en]
</p>
<p>
fb.map :&quot;ar-PS&quot; =&gt; :&quot;he-IL&quot; fb[:&quot;ar-PS&quot;] #
=&gt; [:&quot;ar-PS&quot;, :ar, :&quot;he-IL&quot;, :he,
:&quot;en-US&quot;, :en] fb[:&quot;ar-EG&quot;] # =&gt;
[:&quot;ar-EG&quot;, :ar, :&quot;en-US&quot;, :en]
</p>
<p>
fb.map :sms =&gt; [:&quot;se-FI&quot;, :&quot;fi-FI&quot;] fb[:sms] # =&gt;
[:sms, :&quot;se-FI&quot;, :se, :&quot;fi-FI&quot;, :fi,
:&quot;en-US&quot;, :en] &lt;/code&gt;&lt;/pre&gt;
</p>
<p>
h2. Globalize::LoadPath
</p>
<p>
Globalize2 replaces the plain Ruby array that is set to I18n.load_path by
default through an instance of Globalize::LoadPath.
</p>
<p>
This object can be populated with both paths to files and directories. If a
path to a directory is added to it it will look up all locale data files
present in that directory enforcing the following convention:
</p>
<p>
&lt;pre&gt;&lt;code&gt; I18n.load_path &lt;&lt;
&quot;#{RAILS_ROOT}/lib/locales&quot;
</p>
<p>
# will load all the following files if present: lib/locales/all.yml
lib/locales/fr.yml lib/locales/fr/*.yaml lib/locales/ru.yml
lib/locales/ru/*.yaml &#8230; &lt;/code&gt;&lt;/pre&gt;
</p>
<p>
One can also specify which locales are used. By default this is set to
&quot;*&quot; meaning that files for all locales are added. To define that
only files for the locale :es are added one can specify:
</p>
<p>
&lt;pre&gt;<tt> I18n.load_path.locales = [:es] </tt>&lt;/pre&gt;
</p>
<p>
One can also specify which file extensions are used. By default this is set
to [&#8216;rb&#8217;, &#8216;yml&#8217;] so plain Ruby and YAML files are
added if found. To define that only *.sql files are added one can specify:
</p>
<p>
&lt;pre&gt;<tt> I18n.load_path.extensions = [&#8216;sql&#8217;]
</tt>&lt;/pre&gt;
</p>
<p>
Note that Globalize::LoadPath &quot;expands&quot; a directory to its
contained file paths immediately when you add it to the load_path. Thus, if
you change the locales or extensions settings in the middle of your
application the change won&#8217;t be applied to already added file paths.
</p>
<p>
h2. Globalize::Translation classes
</p>
<p>
Globalize2&#8217;s Static backend as well as Globalize2 model translations
return instances of Globalize::Translation classes (instead of plain Ruby
Strings). These are simple and lightweight value objects that carry some
additional meta data about the translation and how it was looked up.
</p>
<p>
Model translations return instances of Globalize::Translation::Attribute,
the Static backend returns instances of Globalize::Translation::Static.
</p>
<p>
For example:
</p>
<p>
&lt;pre&gt;&lt;code&gt; I18n.locale = :de
</p>
<p>
# Translation::Attribute title = Post.first.title # assuming that no
translation can be found: title.locale # =&gt; :en title.requested_locale #
=&gt; :de title.fallback? # =&gt; true
</p>
<p>
# Translation::Static rails = I18n.t :rails # assuming that no translation
can be found: rails.locale # =&gt; :en rails.requested_locale # =&gt; :de
rails.fallback? # =&gt; true rails.options # returns the options passed to
#t rails.plural_key # returns the plural_key (e.g. :one, :other)
rails.original # returns the original translation with no values
</p>
<pre class="code">
                          <span class='comment val'># interpolated to it (e.g. &quot;Hi {{name}}!&quot;)</span>
</pre>
<p>
&lt;/code&gt;&lt;/pre&gt;
</p>
<p>
h2. Missing Translations Log Handler
</p>
<p>
A simple exception handler that behaves like the default exception handler
but additionally logs missing translations to a given log.
</p>
<p>
Useful for identifying missing translations during testing.
</p>
<p>
E.g.
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'globalize/i18n/missing_translations_log_handler
  I18n.missing_translations_logger = RAILS_DEFAULT_LOGGER
  I18n.exception_handler = :missing_translations_log_handler
</span></pre>
<p>
To set up a different log file:
</p>
<pre class="code">
  <span class='logger identifier id'>logger</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{RAILS_ROOT}/log/missing_translations.log&quot;</span><span class='rparen token'>)</span>
  <span class='I18n constant id'>I18n</span><span class='dot token'>.</span><span class='missing_translations_logger identifier id'>missing_translations_logger</span> <span class='assign token'>=</span> <span class='logger identifier id'>logger</span>
</pre>

      </div>
    </div>
  </body>
</html>