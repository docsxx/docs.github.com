<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: Spec::Mocks</title>
  </head>
  <body>
    <div id="content">
      <div class="section module Spec_Mocks">
  <h1 class="title">Module: Spec::Mocks</h1>
  <div class="section docstring">
  <h2>Mocks and Stubs</h2>
<p>
RSpec will create Mock Objects and Stubs for you at runtime, or attach
stub/mock behaviour to any of your real objects (Partial Mock/Stub).
Because the underlying implementation for mocks and stubs is the same, you
can intermingle mock and stub behaviour in either dynamically generated
mocks or your pre-existing classes. There is a semantic difference in how
they are created, however, which can help clarify the role it is playing
within a given spec.
</p>
<h2>Mock Objects</h2>
<p>
Mocks are objects that allow you to set and verify expectations that they
will receive specific messages during run time. They are very useful for
specifying how the subject of the spec interacts with its collaborators.
This approach is widely known as &quot;interaction testing&quot;.
</p>
<p>
Mocks are also very powerful as a design tool. As you are driving the
implementation of a given class, Mocks provide an anonymous collaborator
that can change in behaviour as quickly as you can write an expectation in
your spec. This flexibility allows you to design the interface of a
collaborator that often does not yet exist. As the shape of the class being
specified becomes more clear, so do the requirements for its collaborators
- often leading to the discovery of new types that are needed in your
system.
</p>
<p>
Read Endo-Testing[http://www.mockobjects.com/files/endotesting.pdf] for a
much more in depth description of this process.
</p>
<h2>Stubs</h2>
<p>
Stubs are objects that allow you to set &quot;stub&quot; responses to
messages. As Martin Fowler points out on his site,
mocks_arent_stubs[http://www.martinfowler.com/articles/mocksArentStubs.html].
Paraphrasing Fowler&#8217;s paraphrasing of Gerard Meszaros: Stubs provide
canned responses to messages they might receive in a test, while mocks
allow you to specify and, subsquently, verify that certain messages should
be received during the execution of a test.
</p>
<h2>Partial Mocks/Stubs</h2>
<p>
RSpec also supports partial mocking/stubbing, allowing you to add stub/mock
behaviour to instances of your existing classes. This is generally
something to be avoided, because changes to the class can have ripple
effects on seemingly unrelated specs. When specs fail due to these ripple
effects, the fact that some methods are being mocked can make it difficult
to understand why a failure is occurring.
</p>
<p>
That said, partials do allow you to expect and verify interactions with
class methods such as +#find+ and +#create+ on Ruby on Rails model classes.
</p>
<h2>Further Reading</h2>
<p>
There are many different viewpoints about the meaning of mocks and stubs.
If you are interested in learning more, here is some recommended reading:
</p>
<ul>
<li>Mock Objects: http://www.mockobjects.com/

</li>
<li>Endo-Testing: http://www.mockobjects.com/files/endotesting.pdf

</li>
<li>Mock Roles, Not Objects:
http://www.mockobjects.com/files/mockrolesnotobjects.pdf

</li>
<li>Test Double Patterns:
http://xunitpatterns.com/Test%20Double%20Patterns.html

</li>
<li>Mocks aren&#8217;t stubs:
http://www.martinfowler.com/articles/mocksArentStubs.html

</li>
</ul>
<h2>Creating a Mock</h2>
<p>
You can create a mock in any specification (or setup) using:
</p>
<pre class="code">
  <span class='mock identifier id'>mock</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
</pre>
<p>
The optional <tt>options</tt> argument is a <tt>Hash</tt>. Currently the
only supported option is +:null_object+. Setting this to true instructs the
mock to ignore any messages it hasn’t been told to expect – and quietly
return itself. For example:
</p>
<pre class="code">
  <span class='mock identifier id'>mock</span><span class='lparen token'>(</span><span class='string val'>&quot;person&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:null_object</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
</pre>
<h2>Creating a Stub</h2>
<p>
You can create a stub in any specification (or setup) using:
</p>
<pre class="code">
  <span class='stub identifier id'>stub</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='stub_methods_and_values_hash identifier id'>stub_methods_and_values_hash</span><span class='rparen token'>)</span>
</pre>
<p>
For example, if you wanted to create an object that always returns
&quot;More?!?!?!&quot; to &quot;please_sir_may_i_have_some_more&quot; you
would do this:
</p>
<pre class="code">
  <span class='stub identifier id'>stub</span><span class='lparen token'>(</span><span class='string val'>&quot;Mr Sykes&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:please_sir_may_i_have_some_more</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;More?!?!?!&quot;</span><span class='rparen token'>)</span>
</pre>
<h2>Creating a Partial Mock</h2>
<p>
You don&#8217;t really &quot;create&quot; a partial mock, you simply add
method stubs and/or mock expectations to existing classes and objects:
</p>
<pre class="code">
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:find</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='id identifier id'>id</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_return identifier id'>and_return</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='stub! fid id'>stub!</span><span class='lparen token'>(</span><span class='symbol val'>:to_i</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_return identifier id'>and_return</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span>
  <span class='etc identifier id'>etc</span> <span class='dot3 op'>...</span>
</pre>
<h2>Expecting Messages</h2>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_not_receive identifier id'>should_not_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span>
</pre>
<h2>Expecting Arguments</h2>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_not_receive identifier id'>should_not_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
</pre>
<h2>Argument Matchers</h2>
<p>
Arguments that are passed to #with are compared with actual arguments
received using == by default. In cases in which you want to specify things
about the arguments rather than the arguments themselves, you can use any
of RSpec&#8217;s Expression Matchers. They don&#8217;t all make syntactic
sense (they were primarily designed for use with Spec::Expectations), but
you are free to create your own custom Spec::Matchers.
</p>
<p>
Spec::Mocks does provide one additional Matcher method named #ducktype.
</p>
<p>
In addition, Spec::Mocks adds some keyword Symbols that you can use to
specify certain kinds of arguments:
</p>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='no_args identifier id'>no_args</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='any_args identifier id'>any_args</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='kind_of identifier id'>kind_of</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;b&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#2nd argument can any kind of Numeric</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='boolean identifier id'>boolean</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;b&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#2nd argument can true or false</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='regexp val'>/abc/</span><span class='comma token'>,</span> <span class='string val'>&quot;b&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#2nd argument can be any String matching the submitted Regexp</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='anything identifier id'>anything</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;b&quot;</span><span class='rparen token'>)</span> <span class='comment val'>#2nd argument can be anything at all</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span> <span class='ducktype identifier id'>ducktype</span><span class='lparen token'>(</span><span class='symbol val'>:abs</span><span class='comma token'>,</span> <span class='symbol val'>:div</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='string val'>&quot;b&quot;</span><span class='rparen token'>)</span>
                           <span class='comment val'>#2nd argument can be object that responds to #abs and #div</span>
</pre>
<h2>Receive Counts</h2>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='once identifier id'>once</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='twice identifier id'>twice</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='exactly identifier id'>exactly</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='times identifier id'>times</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='at_least identifier id'>at_least</span><span class='lparen token'>(</span><span class='symbol val'>:once</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='at_least identifier id'>at_least</span><span class='lparen token'>(</span><span class='symbol val'>:twice</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='at_least identifier id'>at_least</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='times identifier id'>times</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='at_most identifier id'>at_most</span><span class='lparen token'>(</span><span class='symbol val'>:once</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='at_most identifier id'>at_most</span><span class='lparen token'>(</span><span class='symbol val'>:twice</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='at_most identifier id'>at_most</span><span class='lparen token'>(</span><span class='n identifier id'>n</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='times identifier id'>times</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='any_number_of_times identifier id'>any_number_of_times</span>
</pre>
<h2>Ordering</h2>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ordered identifier id'>ordered</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:other_sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='ordered identifier id'>ordered</span>
    <span class='comment val'>#This will fail if the messages are received out of order</span>
</pre>
<h2>Setting Reponses</h2>
<p>
Whether you are setting a mock expectation or a simple stub, you can tell
the object precisely how to respond:
</p>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_return identifier id'>and_return</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='exactly identifier id'>exactly</span><span class='lparen token'>(</span><span class='integer val'>3</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='times identifier id'>times</span><span class='dot token'>.</span><span class='and_return identifier id'>and_return</span><span class='lparen token'>(</span><span class='value1 identifier id'>value1</span><span class='comma token'>,</span> <span class='value2 identifier id'>value2</span><span class='comma token'>,</span> <span class='value3 identifier id'>value3</span><span class='rparen token'>)</span>
    <span class='comment val'># returns value1 the first time, value2 the second, etc</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_return identifier id'>and_return</span> <span class='lbrace token'>{</span> <span class='dot3 op'>...</span> <span class='rbrace token'>}</span> <span class='comment val'>#returns value returned by the block</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_raise identifier id'>and_raise</span><span class='lparen token'>(</span><span class='error identifier id'>error</span><span class='rparen token'>)</span>
    <span class='comment val'>#error can be an instantiated object or a class</span>
    <span class='comment val'>#if it is a class, it must be instantiable with no args</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_throw identifier id'>and_throw</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_yield identifier id'>and_yield</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='comma token'>,</span><span class='to identifier id'>to</span><span class='comma token'>,</span><span class='yield yield kw'>yield</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_yield identifier id'>and_yield</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='comma token'>,</span><span class='to identifier id'>to</span><span class='comma token'>,</span><span class='yield yield kw'>yield</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_yield identifier id'>and_yield</span><span class='lparen token'>(</span><span class='some identifier id'>some</span><span class='comma token'>,</span><span class='other identifier id'>other</span><span class='comma token'>,</span><span class='values identifier id'>values</span><span class='comma token'>,</span><span class='this identifier id'>this</span><span class='comma token'>,</span><span class='time identifier id'>time</span><span class='rparen token'>)</span>
    <span class='comment val'># for methods that yield to a block multiple times</span>
</pre>
<p>
Any of these responses can be applied to a stub as well, but stubs do not
support any qualifiers about the message received (i.e. you can&#8217;t
specify arguments or receive counts):
</p>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='stub! fid id'>stub!</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_return identifier id'>and_return</span><span class='lparen token'>(</span><span class='value identifier id'>value</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='stub! fid id'>stub!</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_return identifier id'>and_return</span><span class='lparen token'>(</span><span class='value1 identifier id'>value1</span><span class='comma token'>,</span> <span class='value2 identifier id'>value2</span><span class='comma token'>,</span> <span class='value3 identifier id'>value3</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='stub! fid id'>stub!</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_raise identifier id'>and_raise</span><span class='lparen token'>(</span><span class='error identifier id'>error</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='stub! fid id'>stub!</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_throw identifier id'>and_throw</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='stub! fid id'>stub!</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_yield identifier id'>and_yield</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='comma token'>,</span><span class='to identifier id'>to</span><span class='comma token'>,</span><span class='yield yield kw'>yield</span><span class='rparen token'>)</span>
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='stub! fid id'>stub!</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_yield identifier id'>and_yield</span><span class='lparen token'>(</span><span class='values identifier id'>values</span><span class='comma token'>,</span><span class='to identifier id'>to</span><span class='comma token'>,</span><span class='yield yield kw'>yield</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='and_yield identifier id'>and_yield</span><span class='lparen token'>(</span><span class='some identifier id'>some</span><span class='comma token'>,</span><span class='other identifier id'>other</span><span class='comma token'>,</span><span class='values identifier id'>values</span><span class='comma token'>,</span><span class='this identifier id'>this</span><span class='comma token'>,</span><span class='time identifier id'>time</span><span class='rparen token'>)</span>
</pre>
<h2>Arbitrary Handling</h2>
<p>
Once in a while you&#8217;ll find that the available expectations
don&#8217;t solve the particular problem you are trying to solve. Imagine
that you expect the message to come with an Array argument that has a
specific length, but you don&#8217;t care what is in it. You could do this:
</p>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:sym</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='arg identifier id'>arg</span><span class='bitor op'>|</span>
    <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='should identifier id'>should</span> <span class='be_an_istance_of identifier id'>be_an_istance_of</span><span class='lparen token'>(</span><span class='Array constant id'>Array</span><span class='rparen token'>)</span>
    <span class='arg identifier id'>arg</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='dot token'>.</span><span class='should identifier id'>should</span> <span class='eq op'>==</span> <span class='integer val'>7</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Note that this would fail if the number of arguments received was different
from the number of block arguments (in this case 1).
</p>
<h2>Combining Expectation Details</h2>
<p>
Combining the message name with specific arguments, receive counts and
responses you can get quite a bit of detail in your expectations:
</p>
<pre class="code">
  <span class='my_mock identifier id'>my_mock</span><span class='dot token'>.</span><span class='should_receive identifier id'>should_receive</span><span class='lparen token'>(</span><span class='symbol val'>:&lt;&lt;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='with identifier id'>with</span><span class='lparen token'>(</span><span class='string val'>&quot;illegal value&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='once identifier id'>once</span><span class='dot token'>.</span><span class='and_raise identifier id'>and_raise</span><span class='lparen token'>(</span><span class='ArgumentError constant id'>ArgumentError</span><span class='rparen token'>)</span>
</pre>

</div><div class="section constants">
  
</div>
</div>
    </div>
  </body>
</html>