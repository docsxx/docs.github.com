<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>rgrove's thoth - Module: Thoth - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/rgrove/commits/thoth/master" rel="alternate" title="Recent Commits to thoth:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("rgrove", "thoth", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("rgrove", "thoth", "a768e6ee0025b734dcfc9f041242517aa548b51e", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/rgrove/thoth/tree/">Source</a></li>
            <li class=""><a href="http://github.com/rgrove/thoth/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/rgrove/thoth/network">Network</a></li>            
            <li class=""><a href="http://github.com/rgrove/thoth/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/rgrove/thoth">Wiki</a></li>
            <li class=""><a href="http://github.com/rgrove/thoth/graphs">Graphs</a></li>                    
            <li class="active"><a href="/rgrove/thoth">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/rgrove">rgrove</a> / <b><a href="http://github.com/rgrove/thoth/tree">thoth</a></b>        
                <a id="namespaces_button" rel="rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Thoth">
  <h1>Module: Thoth</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p>Innate::Traited</p>
</div><div class="section docstring">
  <p>
&#8212; Copyright &#169; 2009 Ryan Grove &lt;ryan@wonko.com&gt; All rights
reserved.
</p>
<p>
Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:
</p>
<pre class="code">
  <span class='mult op'>*</span> <span class='Redistributions constant id'>Redistributions</span> <span class='of identifier id'>of</span> <span class='source identifier id'>source</span> <span class='code identifier id'>code</span> <span class='must identifier id'>must</span> <span class='retain identifier id'>retain</span> <span class='the identifier id'>the</span> <span class='above identifier id'>above</span> <span class='copyright identifier id'>copyright</span> <span class='notice identifier id'>notice</span><span class='comma token'>,</span>
    <span class='this identifier id'>this</span> <span class='list identifier id'>list</span> <span class='of identifier id'>of</span> <span class='conditions identifier id'>conditions</span> <span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='following identifier id'>following</span> <span class='disclaimer identifier id'>disclaimer</span><span class='dot token'>.</span>
  <span class='mult op'>*</span> <span class='Redistributions constant id'>Redistributions</span> <span class='in in kw'>in</span> <span class='binary identifier id'>binary</span> <span class='form identifier id'>form</span> <span class='must identifier id'>must</span> <span class='reproduce identifier id'>reproduce</span> <span class='the identifier id'>the</span> <span class='above identifier id'>above</span> <span class='copyright identifier id'>copyright</span> <span class='notice identifier id'>notice</span><span class='comma token'>,</span>
    <span class='this identifier id'>this</span> <span class='list identifier id'>list</span> <span class='of identifier id'>of</span> <span class='conditions identifier id'>conditions</span> <span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='following identifier id'>following</span> <span class='disclaimer identifier id'>disclaimer</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='documentation identifier id'>documentation</span>
    <span class='and and kw'>and</span><span class='regexp val'>/or other materials provided with the distribution.
  * Neither the name of this project nor the names of its contributors may be
    used to endorse or promote products derived from this software without
    specific prior written permission.
</span></pre>
<p>
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
&quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS;
OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,
WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR
OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF
ADVISED OF THE POSSIBILITY OF SUCH DAMAGE. ++
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Class Attributes</h2>
      <table>
      
        <tr>
          <th class="name">db</td>
          <td class="readwrite">
            [<span id='db-class_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>db</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="APP_AUTHOR-constant">APP_AUTHOR</dt>
      <dd>'Ryan Grove'</dd>
    
      <dt id="APP_COPYRIGHT-constant">APP_COPYRIGHT</dt>
      <dd>'Copyright (c) 2009 Ryan Grove &lt;ryan@wonko.com&gt;. All ' &lt;&lt;                  'rights reserved.'</dd>
    
      <dt id="APP_EMAIL-constant">APP_EMAIL</dt>
      <dd>'ryan@wonko.com'</dd>
    
      <dt id="APP_NAME-constant">APP_NAME</dt>
      <dd>'Thoth'</dd>
    
      <dt id="APP_URL-constant">APP_URL</dt>
      <dd>'http://thothblog.org/'</dd>
    
      <dt id="APP_VERSION-constant">APP_VERSION</dt>
      <dd>'0.3.0'</dd>
    
      <dt id="HOME_DIR-constant">HOME_DIR</dt>
      <dd>ENV['THOTH_HOME'] || File.expand_path('.') unless const_defined?(:HOME_DIR)</dd>
    
      <dt id="LIB_DIR-constant">LIB_DIR</dt>
      <dd>File.join(File.dirname(File.expand_path(__FILE__)), 'thoth')</dd>
    
      <dt id="PUBLIC_DIR-constant">PUBLIC_DIR</dt>
      <dd>File.join(LIB_DIR, 'public') unless const_defined?(:PUBLIC_DIR)</dd>
    
      <dt id="VIEW_DIR-constant">VIEW_DIR</dt>
      <dd>File.join(LIB_DIR, 'view') unless const_defined?(:VIEW_DIR)</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create-class_method">create</span><span class='args'>(path)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Creates a new Thoth home directory with a sample config file at the
specified path.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#init_thoth-class_method">init_thoth</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Opens a connection to the Thoth database and loads helpers, controllers,
models and plugins.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#open_db-class_method">open_db</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Opens a Sequel database connection to the Thoth database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#restart-class_method">restart</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Restarts the running Thoth daemon (if any).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run-class_method">run</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Runs Thoth.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#setup-class_method">setup</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Initializes Ramaze.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#start-class_method">start</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Starts Thoth as a daemon.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stop-class_method">stop</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Stops the running Thoth daemon (if any).
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>create</h3>
</div><div id="create-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create</span><span class='args'>(path)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Creates a new Thoth home directory with a sample config file at the
specified path.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 112</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L112">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='rparen token'>)</span>
  <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='expand_path identifier id'>expand_path</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;specified path already exists: #{path}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'log'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'media'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'plugin'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'public'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'view'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'tmp'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='cp identifier id'>cp</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='LIB_DIR constant id'>LIB_DIR</span><span class='comma token'>,</span> <span class='string val'>'..'</span><span class='comma token'>,</span> <span class='string val'>'proto'</span><span class='comma token'>,</span> <span class='string val'>'config.ru'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'config.ru'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='cp identifier id'>cp</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='LIB_DIR constant id'>LIB_DIR</span><span class='comma token'>,</span> <span class='string val'>'..'</span><span class='comma token'>,</span> <span class='string val'>'proto'</span><span class='comma token'>,</span> <span class='string val'>'thoth.conf.sample'</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'thoth.conf'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0750</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'log'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0750</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'media'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0750</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'plugin'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0755</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'public'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0750</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'view'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0750</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'tmp'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0640</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'config.ru'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0640</span><span class='comma token'>,</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='path identifier id'>path</span><span class='comma token'>,</span> <span class='string val'>'thoth.conf'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>init_thoth</h3>
</div><div id="init_thoth-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>init_thoth</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Opens a connection to the Thoth database and loads helpers, controllers,
models and plugins.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 142</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L142">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='init_thoth identifier id'>init_thoth</span>
  <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:ip</span><span class='rbrack token'>]</span>   <span class='opasgn op'>||=</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'address'</span><span class='rbrack token'>]</span>
  <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'port'</span><span class='rbrack token'>]</span>

  <span class='open_db identifier id'>open_db</span>

  <span class='comment val'># Ensure that the database schema is up to date.</span>
  <span class='unless unless kw'>unless</span> <span class='Sequel constant id'>Sequel</span><span class='colon2 op'>::</span><span class='Migrator constant id'>Migrator</span><span class='dot token'>.</span><span class='get_current_migration_version identifier id'>get_current_migration_version</span><span class='lparen token'>(</span><span class='@db ivar id'>@db</span><span class='rparen token'>)</span> <span class='eq op'>==</span>
      <span class='Sequel constant id'>Sequel</span><span class='colon2 op'>::</span><span class='Migrator constant id'>Migrator</span><span class='dot token'>.</span><span class='latest_migration_version identifier id'>latest_migration_version</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='LIB_DIR constant id'>LIB_DIR</span><span class='comma token'>,</span> <span class='string val'>'migrate'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='mode identifier id'>mode</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='colon op'>:</span><span class='production identifier id'>production</span>
      <span class='raise identifier id'>raise</span> <span class='SchemaError constant id'>SchemaError</span><span class='comma token'>,</span> <span class='string val'>&quot;Database schema is missing or out of date. &quot;</span> <span class='lshft op'>&lt;&lt;</span>
          <span class='string val'>&quot;Please run `thoth --migrate`.&quot;</span>
    <span class='else else kw'>else</span>
      <span class='raise identifier id'>raise</span> <span class='SchemaError constant id'>SchemaError</span><span class='comma token'>,</span> <span class='string val'>&quot;Database schema is missing or out of date. &quot;</span> <span class='lshft op'>&lt;&lt;</span>
          <span class='string val'>&quot;Please run `thoth --devel --migrate`.&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># If caching is disabled, replace the default cache store with a no-op</span>
  <span class='comment val'># API.</span>
  <span class='if if kw'>if</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'enable_cache'</span><span class='rbrack token'>]</span>
    <span class='comment val'># Cache templates once read to prevent unnecessary disk thrashing.</span>
    <span class='Innate constant id'>Innate</span><span class='colon2 op'>::</span><span class='View constant id'>View</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='read_cache identifier id'>read_cache</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>

    <span class='if if kw'>if</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'memcache'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'enabled'</span><span class='rbrack token'>]</span>
      <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Cache constant id'>Cache</span><span class='colon2 op'>::</span><span class='MemCache constant id'>MemCache</span><span class='colon2 op'>::</span><span class='OPTIONS constant id'>OPTIONS</span><span class='lbrack token'>[</span><span class='symbol val'>:servers</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'memcache'</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>'servers'</span><span class='rbrack token'>]</span>
      <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Cache constant id'>Cache</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='default identifier id'>default</span> <span class='assign token'>=</span> <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Cache constant id'>Cache</span><span class='colon2 op'>::</span><span class='MemCache constant id'>MemCache</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='require identifier id'>require</span> <span class='string val'>'thoth/cache'</span>
    <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Cache constant id'>Cache</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='default identifier id'>default</span> <span class='assign token'>=</span> <span class='Thoth constant id'>Thoth</span><span class='colon2 op'>::</span><span class='Cache constant id'>Cache</span><span class='colon2 op'>::</span><span class='Noop constant id'>Noop</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Create a cache for plugins to use.</span>
  <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Cache constant id'>Cache</span><span class='dot token'>.</span><span class='add identifier id'>add</span><span class='lparen token'>(</span><span class='symbol val'>:plugin</span><span class='rparen token'>)</span>

  <span class='comment val'># Tell Innate where to find Thoth's helpers.</span>
  <span class='Innate constant id'>Innate</span><span class='colon2 op'>::</span><span class='HelpersHelper constant id'>HelpersHelper</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='paths identifier id'>paths</span> <span class='lshft op'>&lt;&lt;</span> <span class='LIB_DIR constant id'>LIB_DIR</span>
  <span class='Innate constant id'>Innate</span><span class='colon2 op'>::</span><span class='HelpersHelper constant id'>HelpersHelper</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='namespaces identifier id'>namespaces</span> <span class='lshft op'>&lt;&lt;</span> <span class='Thoth constant id'>Thoth</span><span class='colon2 op'>::</span><span class='Helper constant id'>Helper</span>

  <span class='comment val'># Load Thoth controllers.</span>
  <span class='require identifier id'>require</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='LIB_DIR constant id'>LIB_DIR</span><span class='comma token'>,</span> <span class='string val'>'controller'</span><span class='rparen token'>)</span>

  <span class='comment val'># Load Thoth models.</span>
  <span class='require identifier id'>require</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='LIB_DIR constant id'>LIB_DIR</span><span class='comma token'>,</span> <span class='string val'>'helper/wiki'</span><span class='rparen token'>)</span>
  <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='acquire identifier id'>acquire</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='LIB_DIR constant id'>LIB_DIR</span><span class='comma token'>,</span> <span class='string val'>'model'</span><span class='comma token'>,</span> <span class='string val'>'*'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='comment val'># Load startup plugins.</span>
  <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='plugins identifier id'>plugins</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='plugin identifier id'>plugin</span><span class='bitor op'>|</span> <span class='Plugin constant id'>Plugin</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='plugin identifier id'>plugin</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>

  <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Thoth home: #{HOME_DIR}&quot;</span>
  <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Thoth lib : #{LIB_DIR}&quot;</span>
  <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Running in #{trait[:mode] == :production ? 'live' : 'dev'} mode&quot;</span>

  <span class='Ramaze constant id'>Ramaze</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='setup identifier id'>setup</span> <span class='lshft op'>&lt;&lt;</span> <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>open_db</h3>
</div><div id="open_db-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>open_db</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Opens a Sequel database connection to the Thoth database.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 201</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L201">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='open_db identifier id'>open_db</span>
  <span class='if if kw'>if</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='db identifier id'>db</span> <span class='match op'>=~</span> <span class='regexp val'>/^sqlite:\/{3}(.+)$/</span>
    <span class='dir identifier id'>dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='$1 nth_ref id'>$1</span><span class='rparen token'>)</span>
    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='Sequel constant id'>Sequel</span><span class='dot token'>.</span><span class='datetime_class identifier id'>datetime_class</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span>

  <span class='@db ivar id'>@db</span> <span class='assign token'>=</span> <span class='Sequel constant id'>Sequel</span><span class='dot token'>.</span><span class='connect identifier id'>connect</span><span class='lparen token'>(</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='db identifier id'>db</span><span class='rparen token'>)</span>
  <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='test_connection identifier id'>test_connection</span>

  <span class='if if kw'>if</span> <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='sql_log identifier id'>sql_log</span><span class='rbrack token'>]</span>
    <span class='require identifier id'>require</span> <span class='string val'>'logger'</span>
    <span class='@db ivar id'>@db</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:sql_log</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

<span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='error identifier id'>error</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Unable to connect to database: #{e}&quot;</span><span class='rparen token'>)</span>
  <span class='exit identifier id'>exit</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>restart</h3>
</div><div id="restart-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>restart</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Restarts the running Thoth daemon (if any).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 223</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L223">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">223
224
225
226
227</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='restart identifier id'>restart</span>
  <span class='stop identifier id'>stop</span>
  <span class='sleep identifier id'>sleep</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='start identifier id'>start</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run</h3>
</div><div id="run-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Runs Thoth.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 230</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L230">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">230
231
232
233
234
235
236
237
238
239
240
241
242
243
244</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='run identifier id'>run</span>
  <span class='init_thoth identifier id'>init_thoth</span>

  <span class='begin begin kw'>begin</span>
    <span class='Ramaze constant id'>Ramaze</span><span class='dot token'>.</span><span class='start identifier id'>start</span><span class='lparen token'>(</span>
      <span class='symbol val'>:adapter</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:adapter</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='symbol val'>:host</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:ip</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='symbol val'>:port</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:port</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
      <span class='symbol val'>:root</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='LIB_DIR constant id'>LIB_DIR</span>
    <span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='LoadError constant id'>LoadError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ex identifier id'>ex</span>
    <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='error identifier id'>error</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Unable to start Ramaze due to LoadError: #{ex}&quot;</span><span class='rparen token'>)</span>
    <span class='exit identifier id'>exit</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>setup</h3>
</div><div id="setup-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>setup</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Initializes Ramaze.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 247</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L247">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='setup identifier id'>setup</span>
  <span class='Ramaze constant id'>Ramaze</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span>
    <span class='symbol val'>:mode</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:mode</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='symbol val'>:production</span> <span class='question op'>?</span> <span class='symbol val'>:live</span> <span class='colon op'>:</span> <span class='symbol val'>:dev</span><span class='comma token'>,</span>
    <span class='symbol val'>:roots</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='HOME_DIR constant id'>HOME_DIR</span><span class='comma token'>,</span> <span class='LIB_DIR constant id'>LIB_DIR</span><span class='rbrack token'>]</span>
  <span class='rparen token'>)</span>

  <span class='case case kw'>case</span> <span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:mode</span><span class='rbrack token'>]</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:devel</span>
    <span class='Ramaze constant id'>Ramaze</span><span class='dot token'>.</span><span class='middleware! fid id'>middleware!</span><span class='lparen token'>(</span><span class='symbol val'>:dev</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Lint constant id'>Lint</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='CommonLogger constant id'>CommonLogger</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Reloader constant id'>Reloader</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ShowStatus constant id'>ShowStatus</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='RouteExceptions constant id'>RouteExceptions</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ShowExceptions constant id'>ShowExceptions</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Head constant id'>Head</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ETag constant id'>ETag</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ConditionalGet constant id'>ConditionalGet</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ContentLength constant id'>ContentLength</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Thoth constant id'>Thoth</span><span class='colon2 op'>::</span><span class='Minify constant id'>Minify</span> <span class='if if_mod kw'>if</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'enable_minify'</span><span class='rbrack token'>]</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='AppMap constant id'>AppMap</span>
    <span class='end end kw'>end</span>

  <span class='when when kw'>when</span> <span class='symbol val'>:production</span>
    <span class='Ramaze constant id'>Ramaze</span><span class='dot token'>.</span><span class='middleware! fid id'>middleware!</span><span class='lparen token'>(</span><span class='symbol val'>:live</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='CommonLogger constant id'>CommonLogger</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='RouteExceptions constant id'>RouteExceptions</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Head constant id'>Head</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ETag constant id'>ETag</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ConditionalGet constant id'>ConditionalGet</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='ContentLength constant id'>ContentLength</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='use identifier id'>use</span> <span class='Thoth constant id'>Thoth</span><span class='colon2 op'>::</span><span class='Minify constant id'>Minify</span> <span class='if if_mod kw'>if</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'enable_minify'</span><span class='rbrack token'>]</span>
      <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='run identifier id'>run</span> <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='AppMap constant id'>AppMap</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Ensure that exceptions result in an HTTP 500 response.</span>
    <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='RouteExceptions constant id'>RouteExceptions</span><span class='dot token'>.</span><span class='route identifier id'>route</span><span class='lparen token'>(</span><span class='Exception constant id'>Exception</span><span class='comma token'>,</span> <span class='string val'>'/error_500'</span><span class='rparen token'>)</span>

    <span class='comment val'># Log all errors to the error log file if one is configured.</span>
    <span class='if if kw'>if</span> <span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'error_log'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
      <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='loggers identifier id'>loggers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='else else kw'>else</span>
      <span class='log_dir identifier id'>log_dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='dirname identifier id'>dirname</span><span class='lparen token'>(</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'error_log'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

      <span class='unless unless kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span><span class='lparen token'>(</span><span class='log_dir identifier id'>log_dir</span><span class='rparen token'>)</span>
        <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span><span class='lparen token'>(</span><span class='log_dir identifier id'>log_dir</span><span class='rparen token'>)</span>
        <span class='File constant id'>File</span><span class='dot token'>.</span><span class='chmod identifier id'>chmod</span><span class='lparen token'>(</span><span class='integer val'>0750</span><span class='comma token'>,</span> <span class='log_dir identifier id'>log_dir</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>

      <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='loggers identifier id'>loggers</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='server identifier id'>server</span><span class='lbrack token'>[</span><span class='string val'>'error_log'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrack token'>]</span>
      <span class='Ramaze constant id'>Ramaze</span><span class='colon2 op'>::</span><span class='Log constant id'>Log</span><span class='dot token'>.</span><span class='level identifier id'>level</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='colon2 op'>::</span><span class='Severity constant id'>Severity</span><span class='colon2 op'>::</span><span class='ERROR constant id'>ERROR</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start</h3>
</div><div id="start-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Starts Thoth as a daemon.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 303</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L303">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='start identifier id'>start</span>
  <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='file? fid id'>file?</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='pidfile identifier id'>pidfile</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='pid identifier id'>pid</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:pidfile</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
    <span class='abort identifier id'>abort</span><span class='lparen token'>(</span><span class='dstring node'>&quot;thoth already running? (pid=#{pid})&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Starting thoth.&quot;</span>

  <span class='fork identifier id'>fork</span> <span class='do do kw'>do</span>
    <span class='Process constant id'>Process</span><span class='dot token'>.</span><span class='setsid identifier id'>setsid</span>
    <span class='exit identifier id'>exit</span> <span class='if if_mod kw'>if</span> <span class='fork identifier id'>fork</span>

    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:pidfile</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='string val'>'w'</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='file identifier id'>file</span><span class='bitor op'>|</span> <span class='file identifier id'>file</span> <span class='lshft op'>&lt;&lt;</span> <span class='Process constant id'>Process</span><span class='dot token'>.</span><span class='pid identifier id'>pid</span><span class='rbrace token'>}</span>
    <span class='at_exit identifier id'>at_exit</span> <span class='lbrace token'>{</span><span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rm identifier id'>rm</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:pidfile</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:pidfile</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>

    <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='chdir identifier id'>chdir</span><span class='lparen token'>(</span><span class='HOME_DIR constant id'>HOME_DIR</span><span class='rparen token'>)</span>
    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='umask identifier id'>umask</span><span class='lparen token'>(</span><span class='integer val'>0000</span><span class='rparen token'>)</span>

    <span class='STDIN constant id'>STDIN</span><span class='dot token'>.</span><span class='reopen identifier id'>reopen</span><span class='lparen token'>(</span><span class='string val'>'/dev/null'</span><span class='rparen token'>)</span>
    <span class='STDOUT constant id'>STDOUT</span><span class='dot token'>.</span><span class='reopen identifier id'>reopen</span><span class='lparen token'>(</span><span class='string val'>'/dev/null'</span><span class='comma token'>,</span> <span class='string val'>'a'</span><span class='rparen token'>)</span>
    <span class='STDERR constant id'>STDERR</span><span class='dot token'>.</span><span class='reopen identifier id'>reopen</span><span class='lparen token'>(</span><span class='STDOUT constant id'>STDOUT</span><span class='rparen token'>)</span>

    <span class='run identifier id'>run</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stop</h3>
</div><div id="stop-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stop</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Stops the running Thoth daemon (if any).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/thoth.rb', line 330</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/rgrove/thoth/blob/a768e6ee0025b734dcfc9f041242517aa548b51e/lib/thoth.rb#L330">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">330
331
332
333
334
335
336
337
338
339
340</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='stop identifier id'>stop</span>
  <span class='unless unless kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='file? fid id'>file?</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='pidfile identifier id'>pidfile</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='abort identifier id'>abort</span><span class='lparen token'>(</span><span class='dstring node'>&quot;thoth not running? (check #{trait[:pidfile]}).&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='puts identifier id'>puts</span> <span class='string val'>&quot;Stopping thoth.&quot;</span>

  <span class='pid identifier id'>pid</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:pidfile</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='integer val'>20</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='strip identifier id'>strip</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='rm identifier id'>rm</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:pidfile</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='trait identifier id'>trait</span><span class='lbrack token'>[</span><span class='symbol val'>:pidfile</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='pid identifier id'>pid</span> <span class='andop op'>&amp;&amp;</span> <span class='Process constant id'>Process</span><span class='dot token'>.</span><span class='kill identifier id'>kill</span><span class='lparen token'>(</span><span class='string val'>'TERM'</span><span class='comma token'>,</span> <span class='pid identifier id'>pid</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>