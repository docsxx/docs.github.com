<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>porras's persistize - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/porras/commits/persistize/master" rel="alternate" title="Recent Commits to persistize:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("porras", "persistize", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='porras/persistize/blob/94b86d246be852536889961db24ed67857127261' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='porras/persistize/blob/94b86d246be852536889961db24ed67857127261' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("porras", "persistize", "94b86d246be852536889961db24ed67857127261", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/porras/persistize/tree/">Source</a></li>
            <li class=""><a href="http://github.com/porras/persistize/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/porras/persistize/network">Network</a></li>            
            <li class=""><a href="http://github.com/porras/persistize/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/porras/persistize">Wiki</a></li>
            <li class=""><a href="http://github.com/porras/persistize/graphs">Graphs</a></li>                    
            <li class="active"><a href="/porras/persistize">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/porras">porras</a> / <b><a href="http://github.com/porras/persistize/tree">persistize</a></b>        
                <a id="namespaces_button" rel="porras/persistize/blob/94b86d246be852536889961db24ed67857127261" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="porras/persistize/blob/94b86d246be852536889961db24ed67857127261" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Persistize</h1>

<p>Just like <code>memoize</code> but stores the value as an attribute in the database. You need to create the field in the database with the name of the method. The field gets updated each time the record is saved:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>

  <span class='def def kw'>def</span> <span class='full_name identifier id'>full_name</span>
    <span class='dstring node'>&quot;#{first_name} #{last_name}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='persistize identifier id'>persistize</span> <span class='symbol val'>:full_name</span>

<span class='end end kw'>end</span>

<span class='dot3 op'>...</span>

<span class='Person constant id'>Person</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:first_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Jimi'</span><span class='comma token'>,</span> <span class='symbol val'>:last_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Hendrix'</span><span class='rparen token'>)</span>
<span class='Person constant id'>Person</span><span class='dot token'>.</span><span class='find_by_full_name identifier id'>find_by_full_name</span><span class='lparen token'>(</span><span class='string val'>'Jimi Hendrix'</span><span class='rparen token'>)</span> <span class='comment val'># #&lt;Person id:1, first_name:&quot;Jimi&quot;, last_name:&quot;Hendrix&quot;, full_name:&quot;Jimi Hendrix&quot; ...&gt;</span>
</pre>

<h2>Dependency</h2>

<p>Some times you want to update the field not when the record is changed, but when some other associated records are. For example:</p>

<pre class="code"><span class='class class kw'>class</span> <span class='Project constant id'>Project</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:tasks</span>

  <span class='def def kw'>def</span> <span class='completed? fid id'>completed?</span>
    <span class='tasks identifier id'>tasks</span><span class='dot token'>.</span><span class='any? fid id'>any?</span> <span class='andop op'>&amp;&amp;</span> <span class='tasks identifier id'>tasks</span><span class='dot token'>.</span><span class='all? fid id'>all?</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:completed?</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='persistize identifier id'>persistize</span> <span class='symbol val'>:completed?</span><span class='comma token'>,</span> <span class='symbol val'>:depending_on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:tasks</span>

  <span class='named_scope identifier id'>named_scope</span> <span class='symbol val'>:completed</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:completed</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span>

<span class='end end kw'>end</span>

<span class='class class kw'>class</span> <span class='Task constant id'>Task</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
  <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:project</span>
<span class='end end kw'>end</span>

<span class='dot3 op'>...</span>

<span class='project identifier id'>project</span> <span class='assign token'>=</span> <span class='Project constant id'>Project</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Rails'</span><span class='rparen token'>)</span>
<span class='task identifier id'>task</span> <span class='assign token'>=</span> <span class='project identifier id'>project</span><span class='dot token'>.</span><span class='tasks identifier id'>tasks</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Make it scale'</span><span class='comma token'>,</span> <span class='symbol val'>:completed</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>    
<span class='Project constant id'>Project</span><span class='dot token'>.</span><span class='completed identifier id'>completed</span>  <span class='comment val'># []</span>

<span class='task identifier id'>task</span><span class='dot token'>.</span><span class='update_attributes identifier id'>update_attributes</span><span class='lparen token'>(</span><span class='symbol val'>:completed</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
<span class='Project constant id'>Project</span><span class='dot token'>.</span><span class='completed identifier id'>completed</span>  <span class='comment val'># [#&lt;Project id:1, name:&quot;Rails&quot;, completed:true ...&gt;]</span>
</pre>

<p>You can add more than one dependency using an array:</p>

<pre class="code"><span class='persistize identifier id'>persistize</span> <span class='symbol val'>:summary</span><span class='comma token'>,</span> <span class='symbol val'>:depending_on</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span> <span class='symbol val'>:projects</span><span class='comma token'>,</span> <span class='symbol val'>:people</span><span class='comma token'>,</span> <span class='symbol val'>:tasks</span> <span class='rbrack token'>]</span>
</pre>

<p>These examples are just some of the possible applications of this pattern, your imagination is the limit =;-) If you can find a better example, please send it to us.</p>

<h2>To-do</h2>

<ul>
<li>More kinds of dependencies (<code>belongs_to</code>, <code>has_one</code>, <code>has_many :through</code>)</li>
<li>Making cache optional (cache can cause records to be inconsistent if changed and not saved so it would be nice to be able to deactivate it)</li>
</ul>

<p>Copyright (c) 2008 Luismi Cavallé &amp; Sergio Gil, released under the MIT license</p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>