<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <p>
h1. Ajaxful Rating
</p>
<p>
Provides a simple way to add rating functionality to your application.
</p>
<p>
h2. Repository
</p>
<p>
Find it at
&quot;github.com/edgarjs/ajaxful-rating&quot;:http://github.com/edgarjs/ajaxful-rating
</p>
<p>
h2. Demo
</p>
<p>
You can find a demo working app for this plugin at
&quot;http://github.com/edgarjs/ajaxful-rating_demo_app&quot;:http://github.com/edgarjs/ajaxful-rating_demo_app
Just migrate and run&#8230;
</p>
<p>
*******************************************************************
</p>
<p>
h2. Instructions
</p>
<p>
h3. Install
</p>
<p>
To install the plugin:
</p>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/e</span><span class='dgarjs identifier id'>dgarjs</span><span class='div op'>/</span><span class='ajaxful identifier id'>ajaxful</span><span class='minus op'>-</span><span class='rating identifier id'>rating</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<p>
h3. Generate
</p>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='ajaxful_rating identifier id'>ajaxful_rating</span> <span class='UserModelName constant id'>UserModelName</span>
</pre>
<p>
The generator takes one argument: UserModelName, which is the name of your
<b>current</b> user model. This is necessary to link both the rate and user
models.
</p>
<p>
Also this generator copies the necesary images, styles, etc.
</p>
<p>
Example: _I suppose you have generated already an authenticated
model&#8230;_
</p>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='authenticated identifier id'>authenticated</span> <span class='user identifier id'>user</span> <span class='sessions identifier id'>sessions</span>

  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='ajaxful_rating identifier id'>ajaxful_rating</span> <span class='user identifier id'>user</span>
</pre>
<p>
So this call will create a Rate model and will link it to your User model.
</p>
<p>
h3. Prepare
</p>
<p>
To let a model be rateable just add @ajaxful_rateable@. You can pass a hash
of options to customise this call:
</p>
<ul>
<li>@:stars@ Max number of stars that can be submitted.

</li>
<li>@:allow_update@ Set to true if you want users to be able to update their
votes.

</li>
<li>@:cache_column@ Name of the column for storing the cached rating average.

</li>
<li>@:dimensions@ Array of dimensions. Allows to rate the model on various
specs,

</li>
</ul>
<p>
like for example: a car could be rated for its speed, beauty or price.
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='class class kw'>class</span> <span class='Car constant id'>Car</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='ajaxful_rateable identifier id'>ajaxful_rateable</span> <span class='symbol val'>:stars</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='symbol val'>:dimensions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:speed</span><span class='comma token'>,</span> <span class='symbol val'>:beauty</span><span class='comma token'>,</span> <span class='symbol val'>:price</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
Then you need to add a call @ajaxful_rater@ in the user model. This
includes a simple line so you can add it _by your own_ as well (@has_many
:rates@).
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='ajaxful_rater identifier id'>ajaxful_rater</span>
  <span class='end end kw'>end</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
Finally, as a mere recomendation to make it even easier, modify your routes
to map a rate action:
</p>
<pre class="code">
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:cars</span><span class='comma token'>,</span> <span class='symbol val'>:member</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:rate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:post</span><span class='rbrace token'>}</span>
</pre>
<p>
h3. Use it
</p>
<p>
To add the star links you need to call the helper method @ratings_for@. It
tries to call @current_user@ method as the rater instance. You can pass
@:static@ as the second param to display only the static stars (not
clickables). And also you can pass the dimension you want to show the
ratings for.
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='comment val'># show.html.erb</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= ratings_for @article %&gt;

  # To display static stars:
  &lt;%=</span> <span class='ratings_for identifier id'>ratings_for</span> <span class='@article ivar id'>@article</span><span class='comma token'>,</span> <span class='symbol val'>:static</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

  <span class='comment val'># To display the ratings for a dimension:</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= ratings_for @article, :dimension =</span><span class='gt op'>&gt;</span> <span class='symbol val'>:speed</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
Or you can specify a custom user instance by passing it as parameter.
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= ratings_for @article, @user %&gt;
  &lt;/code&gt;&lt;/pre&gt;
</span></pre>
<p>
There&#8217;s a condition here, if you didn&#8217;t add the route @rate@ to
your resource (as shown above) or you named it different, you&#8217;ll need
to pass the url to the correct action in your controller:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= ratings_for @article, :remote_options =</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:url</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='your_rate_path identifier id'>your_rate_path</span><span class='lparen token'>(</span><span class='@article ivar id'>@article</span><span class='rparen token'>)</span><span class='rbrace token'>}</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
*To display the stars properly you need to add a call in the head of your
layout, which will generate the required CSS style for the list. Also
don&#8217;t forget to include the javascripts.*
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
    <span class='comment val'># within the head tags of your layout...</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= javascript_include_tag :defaults %&gt;
    &lt;%=</span> <span class='ajaxful_rating_style identifier id'>ajaxful_rating_style</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
When a user submits a rating it will call the action in your controller,
for example (if you added the @rate@ route):
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='def def kw'>def</span> <span class='rate identifier id'>rate</span>
    <span class='@article ivar id'>@article</span> <span class='assign token'>=</span> <span class='Article constant id'>Article</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='@article ivar id'>@article</span><span class='dot token'>.</span><span class='rate identifier id'>rate</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:stars</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='current_user identifier id'>current_user</span><span class='comma token'>,</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:dimension</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='id identifier id'>id</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;ajaxful-rating-#{!params[:dimension].blank? ? &quot;#{params[:dimension]}-&quot; : ''}article-#{@article.id}&quot;</span>
    <span class='render identifier id'>render</span> <span class='symbol val'>:update</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='page identifier id'>page</span><span class='bitor op'>|</span>
      <span class='page identifier id'>page</span><span class='dot token'>.</span><span class='replace_html identifier id'>replace_html</span> <span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='ratings_for identifier id'>ratings_for</span><span class='lparen token'>(</span><span class='@article ivar id'>@article</span><span class='comma token'>,</span> <span class='symbol val'>:wrap</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='symbol val'>:dimension</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:dimension</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='page identifier id'>page</span><span class='dot token'>.</span><span class='visual_effect identifier id'>visual_effect</span> <span class='symbol val'>:highlight</span><span class='comma token'>,</span> <span class='id identifier id'>id</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
There are some more options for this helper, please see the rdoc for
details.
</p>
<p>
h3. Dimensions
</p>
<p>
From now on you can pass an optional parameter to the @rates@ method for
your rateable object to retrieve the corresponding rates for the dimension
you want.
</p>
<p>
For example, you defined these dimensions:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='class class kw'>class</span> <span class='Car constant id'>Car</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='ajaxful_rateable identifier id'>ajaxful_rateable</span> <span class='symbol val'>:dimensions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:speed</span><span class='comma token'>,</span> <span class='symbol val'>:beauty</span><span class='comma token'>,</span> <span class='symbol val'>:price</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
And hence you can call @car.rates(:price)@ for the price rates or
@car.rates(:speed)@ for the speed ratings and so on.
</p>
<p>
h3. Namespaces
</p>
<p>
If you use the plugin inside a namespace you’ll need to specify the
rating url which should points to a controller inside a namespace. Your
files should be like these:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='routes identifier id'>routes</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span><span class='colon op'>:</span>
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span> <span class='symbol val'>:admin</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='admin identifier id'>admin</span><span class='bitor op'>|</span>
    <span class='admin identifier id'>admin</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:articles</span><span class='comma token'>,</span> <span class='symbol val'>:member</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:rate</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:post</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='views identifier id'>views</span><span class='div op'>/</span><span class='admin identifier id'>admin</span><span class='div op'>/</span><span class='articles identifier id'>articles</span><span class='div op'>/</span><span class='show identifier id'>show</span><span class='dot token'>.</span><span class='html identifier id'>html</span><span class='dot token'>.</span><span class='erb identifier id'>erb</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= ratings_for @article, :remote_options =</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:url</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='rate_admin_article_path identifier id'>rate_admin_article_path</span><span class='lparen token'>(</span><span class='@article ivar id'>@article</span><span class='rparen token'>)</span><span class='rbrace token'>}</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
h3. Cache
</p>
<p>
To cache the model&#8217;s rating average add a column named
@rating_average@ to your model table:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='class class kw'>class</span> <span class='AddRatingAverageToArticles constant id'>AddRatingAverageToArticles</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Migration constant id'>Migration</span>
    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='up identifier id'>up</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:articles</span><span class='comma token'>,</span> <span class='symbol val'>:rating_average</span><span class='comma token'>,</span> <span class='symbol val'>:decimal</span><span class='comma token'>,</span> <span class='symbol val'>:default</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='down identifier id'>down</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:articles</span><span class='comma token'>,</span> <span class='symbol val'>:rating_average</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
If you want to customise the name of the cache column just pass it in the
options hash:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='class class kw'>class</span> <span class='Article constant id'>Article</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='ajaxful_rateable identifier id'>ajaxful_rateable</span> <span class='symbol val'>:cache_column</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:my_cached_rating</span>
  <span class='end end kw'>end</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
To use caching with dimensions, make sure you have a cache column defined
for each dimension you want cached. So if you want to cache the @spelling@
dimension, you’ll need to have a column called @rating_average_spelling@
on the articles table. If you use a custom cache column name, follow the
pattern @cache_column_name_dimension_name@ to add cache columns for
dimensions.
</p>
<p>
h2. About backwards compatibility
</p>
<p>
*Version 2.0 of the plugin works only from Rails 2.2 and on. It uses the
module @I18n@ which is new in rails 2.2. Please note that you can use it in
past versions as long as you <em>customise</em> the source code.*
</p>
<p>
I decided to jump directly to version 2.0 because there are many important
changes. You can always checkout the version 1.0 from the repository
though.
</p>
<p>
h2. Feedback
</p>
<p>
If you find bugs please open a ticket at
&quot;http://edgarjs.lighthouseapp.com/projects/21005-ajaxful-rating&quot;:http://edgarjs.lighthouseapp.com/projects/21005-ajaxful-rating
</p>
<p>
I&#8217;ll really appreciate your feedback, please contact me at
edgar.js[at]gmail.com
</p>
<p>
h2. Credits
</p>
<p>
The helper&#8217;s style is from
&quot;komodomedia&quot;:http://www.komodomedia.com/blog/2007/01/css-star-rating-redux/
with author&#8217;s permission.
</p>
<p>
If you need the psd files of the stars you can grab them
&quot;here&quot;:http://files.mimbles.net/zips/ajaxful_rating_stars.zip
</p>
<p>
Thanks to &quot;bborn&quot;:http://github.com/bborn for the dimensions base
implementation.
</p>
<p>
h2. License
</p>
<p>
This code is released under Creative Commons Attribution-Share Alike 3.0
license.
</p>
<p>
!http://i.creativecommons.org/l/by-sa/3.0/88x31.png!:http://creativecommons.org/licenses/by-sa/3.0/
</p>

      </div>
    </div>
  </body>
</html>