<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <p>
h1. YouTube Model
</p>
<p>
This plugin allows you to interact with the new YouTube API (yes, that
means uploading is now featured) through a simple ActiveResource model.
</p>
<p>
h2. Patch for Rails 2.1.1
</p>
<p>
There was a change in Rails 2.1.1 that causes a **406 Not Acceptable HTTP
error**. There is a patch to solve this though.
</p>
<p>
Just apply the patch to your frozen copy of rails:
</p>
<pre class="code">
  <span class='curl identifier id'>curl</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/rails.lighthouseapp.com/</span><span class='attachments identifier id'>attachments</span><span class='div op'>/</span><span class='integer val'>46685</span><span class='div op'>/</span><span class='http_accept_header identifier id'>http_accept_header</span><span class='dot token'>.</span><span class='diff identifier id'>diff</span> <span class='bitor op'>|</span> <span class='git identifier id'>git</span> <span class='am identifier id'>am</span>
</pre>
<p>
See details
&quot;here&quot;:http://groups.google.com/group/rubyonrails-core/browse_thread/thread/38a853b997202b3
</p>
<p>
**Note about wikis and docs**
</p>
<p>
Currently, the wikis are empty. So I&#8217;d appreciate if you want to
contribute with wikis documentation; just drop me a line at
edgar.js[at]gmail.com.
</p>
<p>
But, it doesn&#8217;t mean there isn&#8217;t enough documentation. The full
plugin is <em>rdoced</em> so you just can @rake rdoc@ and check the
details.
</p>
<p>
*********************************************************************
</p>
<p>
h2. Repository
</p>
<p>
Find it at
&quot;http://github.com/edgarjs/youtube-model&quot;:http://github.com/edgarjs/youtube-model
</p>
<p>
h2. Documentation
</p>
<p>
h3. Installing
</p>
<p>
Simply as:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/e</span><span class='dgarjs identifier id'>dgarjs</span><span class='div op'>/</span><span class='youtube identifier id'>youtube</span><span class='minus op'>-</span><span class='model identifier id'>model</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<p>
h3. Generating the system
</p>
<p>
The plugin includes a generator to create a model based on ActiveResource
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='youtube_model identifier id'>youtube_model</span> <span class='lt op'>&lt;</span><span class='ModelName constant id'>ModelName</span><span class='gt op'>&gt;</span>
</pre>
<p>
This generator will create four files:
</p>
<ul>
<li>An ActiveResource based model under app/models directory.

</li>
<li>A yaml configuration file under config directory.

</li>
<li>An initializer that loads the configuration file, under config/initializers
directory.

</li>
</ul>
<p>
And that&#8217;s all, but be sure to check the configuration file to set up
your Developer and Client Keys. You can get these keys at the &quot;YouTube
APIs and Tools&quot;:http://code.google.com/apis/youtube/dashboard/ page.
</p>
<p>
h3. Listing videos
</p>
<p>
Let&#8217;s say you generated a model named YouTube. So now you can use
that model very similar to an ActiveRecord model.
</p>
<p>
To search for videos passing a simple query use the method @find@
</p>
<pre class="code">
  <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='string val'>'rails conference 2008'</span><span class='rparen token'>)</span>
</pre>
<p>
To get the videos uploaded by a user you can use the method @uploaded_by@
passing the username
</p>
<pre class="code">
  <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='uploaded_by identifier id'>uploaded_by</span><span class='lparen token'>(</span><span class='string val'>'envyads'</span><span class='rparen token'>)</span>
</pre>
<p>
And so on. To see the full list of available methods see the
&quot;Wikis&quot;:http://github.com/edgarjs/youtube-model/wikis
</p>
<p>
All methods will return an instance of @Entry@. The @Entry@ object
encapsulates information about a video, playlist, suscription, contact or
other entity. This class is parsed from the @&lt;entry&gt;@ tag of the xml
response, wich is the root tag in all YouTube data API requests. (To see
more about the structure of the xml response go to the &quot;YouTube
API&quot;:http://code.google.com/apis/youtube/developers_guide_protocol.html#Understanding_Video_Entries
</p>
<p>
The returned model instance has a main mehod: *<b>videos</b>*, wich is more
than an alias for @entry@.
</p>
<p>
*<b>Example</b>*
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='comment val'># VideosController</span>
  <span class='def def kw'>def</span> <span class='index identifier id'>index</span>
    <span class='@youtube ivar id'>@youtube</span> <span class='assign token'>=</span> <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='string val'>'ruby on rails'</span><span class='comma token'>,</span> <span class='symbol val'>:max_results</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>5</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='show identifier id'>show</span>
    <span class='@video ivar id'>@video</span> <span class='assign token'>=</span> <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='find_by_id identifier id'>find_by_id</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># app/views/videos/index.html.erb</span>
  <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='string val'>%= image_tag @youtube.logo %&gt;&lt;/p&gt;
  &lt;h1&gt;&lt;%=</span> <span class='@youtube ivar id'>@youtube</span><span class='dot token'>.</span><span class='title identifier id'>title</span> <span class='string val'>%&gt;&lt;/h1&gt;</span>
  <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='dstring node'>%= &quot;Displaying #{@youtube.startIndex} - #{@youtube.itemsPerPage} of #{@youtube.totalResults}&quot; %&gt;&lt;/p&gt;
  &lt;p&gt;&lt;%=</span> <span class='link_to identifier id'>link_to</span> <span class='string val'>'Upload'</span><span class='comma token'>,</span> <span class='youtube_auth_url identifier id'>youtube_auth_url</span><span class='lparen token'>(</span><span class='new_video_url identifier id'>new_video_url</span><span class='rparen token'>)</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;
  &lt;%- for video in @youtube.videos -%&gt;
    &lt;strong&gt;&lt;%= video.title %&gt;&lt;/s</span><span class='trong identifier id'>trong</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='small identifier id'>small</span><span class='gt op'>&gt;</span><span class='in in kw'>in</span> <span class='lt op'>&lt;</span><span class='string val'>%= video.group.category %&gt;&lt;/small&gt;
    by &lt;%=</span> <span class='link_to identifier id'>link_to</span> <span class='video identifier id'>video</span><span class='dot token'>.</span><span class='author identifier id'>author</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='dstring node'>&quot;http://youtube.com/#{video.author.name}&quot;</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
    &lt;%= simple_format truncate(video.content, :length =&gt; 100) %&gt;
    &lt;%= link_to image_tag(video.group.thumbnail.first.url, :alt =&gt; video.title), video_path(video.id) %&gt;&lt;br /</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='small identifier id'>small</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='string val'>%= link_to 'Watch on youtube', video.link.first.href %&gt;&lt;/small&gt;
    &lt;p&gt;&amp;nbsp;&lt;/p&gt;
  &lt;%- end -%&gt;

  # app/views/videos/show.html.erb
  &lt;h1&gt;&lt;%=</span> <span class='@video ivar id'>@video</span><span class='dot token'>.</span><span class='title identifier id'>title</span> <span class='string val'>%&gt;&lt;/h1&gt;</span>
  <span class='lt op'>&lt;</span><span class='em identifier id'>em</span><span class='gt op'>&gt;</span><span class='by identifier id'>by</span> <span class='lt op'>&lt;</span><span class='dstring node'>%= link_to @video.author.name, &quot;http://youtube.com/#{@video.author.name}&quot; %&gt;&lt;/em&gt;
  &lt;p&gt;&lt;%=</span> <span class='youtube_embed identifier id'>youtube_embed</span> <span class='@video ivar id'>@video</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;
  &lt;%= link_to 'Back', videos_path %&gt;
  &lt;/</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/pre&gt;
</span></pre>
<p>
As you can see, the @youtube_embed@ method is used to display a video.
</p>
<p>
h3. Uploading videos
</p>
<p>
As seen in the @index@ example above, there is a helper named
@youtube_auth_url@ wich generates an url to the YouTube authentication
page. Pass another url as param to wich be redirected after authentication.
This helper method takes the session and secure options from the
configuration file. See the details of this options at the &quot;YouTube
API&quot;:http://code.google.com/apis/youtube/developers_guide_protocol.html#AuthSub_Authentication
</p>
<p>
Upload process has two steps: # Meta-info for the video. # File choose.
</p>
<p>
So basically we have two actions in our controller to upload a video.
Here&#8217;s a quick code example:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='code identifier id'>code</span><span class='gt op'>&gt;</span>
  <span class='comment val'># routes.rb</span>
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:videos</span><span class='comma token'>,</span> <span class='symbol val'>:new</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:upload</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:post</span><span class='rbrace token'>}</span>

  <span class='comment val'># VideosController</span>
  <span class='def def kw'>def</span> <span class='new identifier id'>new</span>
    <span class='@categories ivar id'>@categories</span> <span class='opasgn op'>||=</span> <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='categories_collection identifier id'>categories_collection</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='upload identifier id'>upload</span>
    <span class='@upload_info ivar id'>@upload_info</span> <span class='assign token'>=</span> <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='get_upload_url identifier id'>get_upload_url</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:video</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># app/views/videos/new.html.erb</span>
  <span class='lt op'>&lt;</span><span class='string val'>% form_for </span><span class='string val'>'video'</span><span class='comma token'>,</span> <span class='symbol val'>:url</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='upload_new_video_path identifier id'>upload_new_video_path</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='string val'>%&gt;
    &lt;%= f.hidden_field :auth_sub, :value =&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:token</span><span class='rbrack token'>]</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='string val'>%= f.label :title %&gt;&lt;br /&gt;
    &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='text_field identifier id'>text_field</span> <span class='symbol val'>:title</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;

    &lt;p&gt;&lt;%= f.label :description %&gt;&lt;br /</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= f.text_area :description, :rows =</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;

    &lt;p&gt;&lt;%= f.label :category %&gt;&lt;br /</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= f.select :category, @categories %&gt;&lt;/p&gt;

    &lt;p&gt;&lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='label identifier id'>label</span> <span class='symbol val'>:keywords</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
    &lt;%= f.text_field :keywords %&gt;&lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='string val'>%= f.submit 'Continue to Step 2' %&gt;&lt;/p&gt;
  &lt;% end %&gt;

  # app/views/videos/upload.html.erb
  &lt;% form_tag @upload_info[:url], :multipart =</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='do do kw'>do</span> <span class='string val'>%&gt;
    &lt;%= hidden_field_tag :token, @upload_info[:token] %&gt;</span>
    <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='string val'>%= label_tag :file %&gt;&lt;br /&gt;
    &lt;%=</span> <span class='file_field_tag identifier id'>file_field_tag</span> <span class='symbol val'>:file</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;
    &lt;p&gt;&lt;%= submit_tag 'Upload video' %&gt;&lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;&lt;/</span><span class='pre identifier id'>pre</span><span class='gt op'>&gt;</span>
</pre>
<p>
Pay special attention to the routes file, I&#8217;ve added a new route
called @:upload@ so I can use it in the first step to set the form post url
by calling @upload_new_video_path@. Also don&#8217;t forget to set
@:multipart =&gt; true@ in the second step.
</p>
<p>
Very easy isn&#8217;t it? Yep, that is all.
</p>
<p>
And for a more specific speech&#8230; the class method @get_upload_url@
receives a hash containing the meta-info of the first step, and returns a
hash with the upload url and token.
</p>
<p>
For extra information don&#8217;t forget to read the
&quot;wikis&quot;:http://github.com/edgarjs/youtube-model/wikis or if you
wanna go further just generate the rdoc for the plugin, it will be uber
helpful.
</p>
<p>
h2. Feedback
</p>
<p>
I&#8217;ll really appreciate your feedback, please contact me at
edgar.js[at]gmail.com
</p>
<p>
h3. Special Thanks
</p>
<p>
I&#8217;d like to thank Tal Pink for the nice contribution to the plugin.
It was the motivation for finish up this first version! :) Thank you very
much.
</p>
<p>
h2. License
</p>
<p>
This code is released under Creative Commons Attribution-Share Alike 3.0
license.
</p>
<p>
!http://i.creativecommons.org/l/by-sa/3.0/88x31.png!:http://creativecommons.org/licenses/by-sa/3.0/
</p>

      </div>
    </div>
  </body>
</html>