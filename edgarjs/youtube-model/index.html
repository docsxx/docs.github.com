<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>edgarjs's youtube-model - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/edgarjs/commits/youtube-model/master" rel="alternate" title="Recent Commits to youtube-model:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>
    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/edgarjs/youtube-model/tree/">Source</a></li>
            <li class=""><a href="http://github.com/edgarjs/youtube-model/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/edgarjs/youtube-model/network">Network</a></li>            
            <li class=""><a href="http://github.com/edgarjs/youtube-model/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/edgarjs/youtube-model">Wiki</a></li>
            <li class=""><a href="http://github.com/edgarjs/youtube-model/graphs">Graphs</a></li>                    
            <li class="active"><a href="/edgarjs/youtube-model">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/edgarjs">edgarjs</a> / <b><a href="http://github.com/edgarjs/youtube-model/tree">youtube-model</a></b>        
                <a id="namespaces_button" rel="edgarjs/youtube-model" href="#">
                  <img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/>
                </a>
                <a id="methods_button" rel="edgarjs/youtube-model" href="#">
                  <img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/>
                </a>

                <script type="text/javascript">          
                $('#namespaces_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/namespaces/";
                  $.gitbox(url);
                  return false;
                });

                $('#methods_button').click(function(){
                  var url="/"+$(this).attr('rel')+"/methods/";
                  $.gitbox(url);
                  return false;
                });
                </script>
                
              </div>
            </div>
          </div>
                                        
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>YouTube Model</h1>


	<p>This plugin allows you to interact with the new YouTube <span class="caps">API</span> (yes, that means uploading is now featured)
through a simple ActiveResource model.</p>


	<h2>Patch for Rails 2.1.1</h2>


	<p>There was a change in Rails 2.1.1 that causes a <b>406 Not Acceptable <span class="caps">HTTP</span> error</b>. There is a patch
to solve this though.</p>


	<p>Just apply the patch to your frozen copy of rails:</p>


	<pre class="code"><span class='curl identifier id'>curl</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/rails.lighthouseapp.com/</span><span class='attachments identifier id'>attachments</span><span class='div op'>/</span><span class='integer val'>46685</span><span class='div op'>/</span><span class='http_accept_header identifier id'>http_accept_header</span><span class='dot token'>.</span><span class='diff identifier id'>diff</span> <span class='bitor op'>|</span> <span class='git identifier id'>git</span> <span class='am identifier id'>am</span>
</pre>


	<p>See details <a href="http://groups.google.com/group/rubyonrails-core/browse_thread/thread/38a853b997202b3">here</a></p>


	<p><b>Note about wikis and docs</b></p>


	<p>Currently, the wikis are empty. So I&#8217;d appreciate if you want to contribute with wikis documentation; just drop me
a line at edgar.js[at]gmail.com.</p>


	<p>But, it doesn&#8217;t mean there isn&#8217;t enough documentation. The full plugin is <em>rdoced</em> so you just can <code>rake rdoc</code> and
check the details.</p>


<hr />


	<h2>Repository</h2>


	<p>Find it at <a href="http://github.com/edgarjs/youtube-model">http://github.com/edgarjs/youtube-model</a></p>


	<h2>Documentation</h2>


	<h3>Installing</h3>


	<p>Simply as:</p>


	<pre class="code"><span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/e</span><span class='dgarjs identifier id'>dgarjs</span><span class='div op'>/</span><span class='youtube identifier id'>youtube</span><span class='minus op'>-</span><span class='model identifier id'>model</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>


	<h3>Generating the system</h3>


	<p>The plugin includes a generator to create a model based on ActiveResource</p>


	<pre class="code"><span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='youtube_model identifier id'>youtube_model</span> <span class='lt op'>&lt;</span><span class='ModelName constant id'>ModelName</span><span class='gt op'>&gt;</span>
</pre>


This generator will create four files:
	<ul>
	<li>An ActiveResource based model under app/models directory.</li>
		<li>A yaml configuration file under config directory.</li>
		<li>An initializer that loads the configuration file, under config/initializers directory.</li>
	</ul>


	<p>And that&#8217;s all, but be sure to check the configuration file to set up your Developer and Client Keys.
You can get these keys at the <a href="http://code.google.com/apis/youtube/dashboard/">YouTube APIs and Tools</a> page.</p>


	<h3>Listing videos</h3>


	<p>Let&#8217;s say you generated a model named YouTube. So now you can use that model very similar
to an ActiveRecord model.</p>


	<p>To search for videos passing a simple query use the method <code>find</code></p>


	<pre class="code"><span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='string val'>'rails conference 2008'</span><span class='rparen token'>)</span>
</pre>


	<p>To get the videos uploaded by a user you can use the method <code>uploaded_by</code> passing the username</p>


	<pre class="code"><span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='uploaded_by identifier id'>uploaded_by</span><span class='lparen token'>(</span><span class='string val'>'envyads'</span><span class='rparen token'>)</span>
</pre>


	<p>And so on. To see the full list of available methods see the <a href="http://rdoc.info/projects/edgarjs/youtube-model">rdoc</a></p>


	<p>All methods will return an instance of <code>Entry</code>. The <code>Entry</code> object encapsulates information about a video, playlist,
suscription, contact or other entity. This class is parsed from the <code>&lt;entry&gt;</code> tag of the xml response, wich is the root
tag in all YouTube data <span class="caps">API</span> requests. (To see more about the structure of the xml response go
to the <a href="http://code.google.com/apis/youtube/developers_guide_protocol.html#Understanding_Video_Entries">YouTube <span class="caps">API</span></a></p>


	<p>The returned model instance has a main mehod: <b>videos</b>, wich is more than an alias for <code>entry</code>.</p>


	<p><b>Example</b>

<pre class="code">
  <span class='comment val'>#VideosController</span>
  <span class='def def kw'>def</span> <span class='index identifier id'>index</span>
    <span class='@youtube ivar id'>@youtube</span> <span class='assign token'>=</span> <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='string val'>'ruby on rails'</span><span class='comma token'>,</span> <span class='symbol val'>:max_results</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>5</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='show identifier id'>show</span>
    <span class='@video ivar id'>@video</span> <span class='assign token'>=</span> <span class='YouTube constant id'>YouTube</span><span class='dot token'>.</span><span class='find_by_id identifier id'>find_by_id</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:id</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>#app/views/videos/index.html.erb</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= image_tag @youtube.logo %&gt;

  &lt;h1&gt;&lt;%=</span> <span class='@youtube ivar id'>@youtube</span><span class='dot token'>.</span><span class='title identifier id'>title</span> <span class='string val'>%&gt;&lt;/h1&gt;</span>
  <span class='lt op'>&lt;</span><span class='dstring node'>%= &quot;Displaying #{@youtube.startIndex} - #{@youtube.itemsPerPage} of #{@youtube.totalResults}&quot; %&gt;

  &lt;%=</span> <span class='link_to identifier id'>link_to</span> <span class='string val'>'Upload'</span><span class='comma token'>,</span> <span class='youtube_auth_url identifier id'>youtube_auth_url</span><span class='lparen token'>(</span><span class='new_video_url identifier id'>new_video_url</span><span class='rparen token'>)</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>% for </span><span class='video identifier id'>video</span> <span class='in in kw'>in</span> <span class='@youtube ivar id'>@youtube</span><span class='dot token'>.</span><span class='videos identifier id'>videos</span> <span class='string val'>%&gt;
    &lt;h3&gt;</span><span class='lt op'>&lt;</span><span class='string val'>%= video.title %&gt;&lt;/h3&gt; in &lt;%=</span> <span class='video identifier id'>video</span><span class='dot token'>.</span><span class='group identifier id'>group</span><span class='dot token'>.</span><span class='category identifier id'>category</span> <span class='dstring node'>%&gt;
    by &lt;%= link_to video.author.name, &quot;http://youtube.com/#{video.author.name}&quot; %&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= simple_format truncate(video.content, :length =</span><span class='gt op'>&gt;</span> <span class='integer val'>100</span><span class='rparen token'>)</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= link_to image_tag(video.group.thumbnail.first.url, :alt =</span><span class='gt op'>&gt;</span> <span class='video identifier id'>video</span><span class='dot token'>.</span><span class='title identifier id'>title</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='video_path identifier id'>video_path</span><span class='lparen token'>(</span><span class='video identifier id'>video</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='rparen token'>)</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= link_to 'Watch on youtube', video.link.first.href %&gt;
  &lt;% end %&gt;

  #app/views/videos/show.html.erb
  &lt;h1&gt;&lt;%=</span> <span class='@video ivar id'>@video</span><span class='dot token'>.</span><span class='title identifier id'>title</span> <span class='string val'>%&gt;&lt;/h1&gt;</span>
  <span class='by identifier id'>by</span> <span class='lt op'>&lt;</span><span class='dstring node'>%= link_to @video.author.name, &quot;http://youtube.com/#{@video.author.name}&quot; %&gt;
  &lt;%=</span> <span class='youtube_embed identifier id'>youtube_embed</span> <span class='@video ivar id'>@video</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= link_to 'Back', videos_path %&gt;
  
</span></pre></p>


	<p>As you can see, the <code>youtube_embed</code> method is used to display a video.</p>


	<h3>Uploading videos</h3>


	<p>As seen in the <code>index</code> example above, there is a helper named <code>youtube_auth_url</code> wich generates an url to the
YouTube authentication page. Pass another url as param to wich be redirected after authentication.
This helper method takes the session and secure options from the configuration file. See the details of this options
at the <a href="http://code.google.com/apis/youtube/developers_guide_protocol.html#AuthSub_Authentication">YouTube <span class="caps">API</span></a></p>


Upload process has two steps:
	<ol>
	<li>Meta-info for the video.</li>
		<li>File choose.</li>
	</ol>


	<p>So basically we have two actions in our controller to upload a video. Here&#8217;s a quick code example:</p>


<pre class="code">
  <span class='comment val'>#routes.rb</span>
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:videos</span><span class='comma token'>,</span> <span class='symbol val'>:new</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='geq op'>&gt;=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='symbol val'>:post</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;

  #VideosController
  def new
    @categories ||= YouTube.categories_collection
  end

  def upload
    @upload_info = YouTube.get_upload_url(params[:video])
  end

  #app/</span><span class='views identifier id'>views</span><span class='div op'>/</span><span class='videos identifier id'>videos</span><span class='div op'>/</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='html identifier id'>html</span><span class='dot token'>.</span><span class='erb identifier id'>erb</span>
  <span class='lt op'>&lt;</span><span class='string val'>% form_for </span><span class='string val'>'video'</span><span class='comma token'>,</span> <span class='symbol val'>:url</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='upload_new_video_path identifier id'>upload_new_video_path</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='string val'>%&gt;
    &lt;%= f.hidden_field :auth_sub, :value =&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:token</span><span class='rbrack token'>]</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= f.label :title %&gt;
    &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='text_field identifier id'>text_field</span> <span class='symbol val'>:title</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= f.label :description %&gt;
    &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='text_area identifier id'>text_area</span> <span class='symbol val'>:description</span><span class='comma token'>,</span> <span class='symbol val'>:rows</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= f.label :category %&gt;
    &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='symbol val'>:category</span><span class='comma token'>,</span> <span class='@categories ivar id'>@categories</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= f.label :keywords %&gt;
    &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='text_field identifier id'>text_field</span> <span class='symbol val'>:keywords</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= f.submit 'Continue to Step 2' %&gt;
  &lt;% end %&gt;

  #app/views/videos/upload.html.erb
  &lt;% form_tag @upload_info[:url], :multipart =</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='do do kw'>do</span> <span class='string val'>%&gt;
    &lt;%= hidden_field_tag :token, @upload_info[:token] %&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= label_tag :file %&gt;
    &lt;%=</span> <span class='file_field_tag identifier id'>file_field_tag</span> <span class='symbol val'>:file</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>

    <span class='lt op'>&lt;</span><span class='string val'>%= submit_tag 'Upload video' %&gt;
  &lt;% end %&gt;
  
</span></pre>

	<p>Pay special attention to the routes file, I&#8217;ve added a new route called <code>:upload</code> so I can use it
in the first step to set the form post url by calling <code>upload_new_video_path</code>.
Also don&#8217;t forget to set <code>:multipart =&gt; true</code> in the second step.</p>


	<p>Very easy isn&#8217;t it? Yep, that is all.</p>


	<p>And for a more specific speech&#8230; the class method <code>get_upload_url</code> receives a hash containing
the meta-info of the first step, and returns a hash with the upload url and token.</p>


	<p>For extra information don&#8217;t forget to read the <a href="http://github.com/edgarjs/youtube-model/wikis">wikis</a>
or if you wanna go further just generate the rdoc for the plugin, it will be uber helpful.</p>


	<h2>Feedback</h2>


	<p>I&#8217;ll really appreciate your feedback, please contact me at edgar.js[at]gmail.com</p>


	<h3>Special Thanks</h3>


	<p>I&#8217;d like to thank Tal Pink for the nice contribution to the plugin. It was the motivation for finish up this first version! :) Thank you very much.</p>


	<h2>License</h2>


	<p>This code is released under Creative Commons Attribution-Share Alike 3.0 license.</p>


	<p><a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" alt="" /></a></p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>