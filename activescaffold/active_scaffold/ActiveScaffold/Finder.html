<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: ActiveScaffold::Finder</title>
  </head>
  <body>
    <div id="content">
      <div class="section module ActiveScaffold_Finder">
  <h1 class="title">Module: ActiveScaffold::Finder</h1>
  <div class="section attributes">
  <h1>Attributes</h1>

  
    <div class="instance">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">active_scaffold_conditions</td>
          <td class="readwrite">
            [R<span id='active_scaffold_conditions%3D-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>active_scaffold_conditions</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">active_scaffold_habtm_joins</td>
          <td class="readwrite">
            [R<span id='active_scaffold_habtm_joins%3D-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>active_scaffold_habtm_joins</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">active_scaffold_joins</td>
          <td class="readwrite">
            [R<span id='active_scaffold_joins%3D-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Sets the attribute <tt>active_scaffold_joins</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h1>Constants</h1>
  <dl>
    
      <dt id="NumericComparators-constant">NumericComparators</dt>
      <dd>[      '=',      '&gt;=',      '&lt;=',      '&gt;',      '&lt;',      '!=',      'BETWEEN'    ]</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <h1>Public Class Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#included-class_method' title='included'>included</a></span><span class='args'>(klass)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#active_scaffold_conditions-instance_method' title='#active_scaffold_conditions'>#active_scaffold_conditions</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#active_scaffold_habtm_joins-instance_method' title='#active_scaffold_habtm_joins'>#active_scaffold_habtm_joins</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#active_scaffold_joins-instance_method' title='#active_scaffold_joins'>#active_scaffold_joins</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#all_conditions-instance_method' title='#all_conditions'>#all_conditions</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#build_order_clause-instance_method' title='#build_order_clause'>#build_order_clause</a></span><span class='args'>(sorting)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
accepts a DataStructure::Sorting object and builds an order-by clause TODO:
this should reside on the model, not the controller.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_if_allowed-instance_method' title='#find_if_allowed'>#find_if_allowed</a></span><span class='args'>(id, action, klass = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns a single record (the given id) but only if it&#8217;s allowed for
the specified action.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_page-instance_method' title='#find_page'>#find_page</a></span><span class='args'>(options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns a Paginator::Page (not from ActiveRecord::Paginator) for the given
parameters options may include:
</p>
<ul>
<li>:sorting - a Sorting DataStructure (basically an array of hashes of field
=&gt; direction, e.

</li>
</ul>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#joins_for_finder-instance_method' title='#joins_for_finder'>#joins_for_finder</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#merge_conditions-instance_method' title='#merge_conditions'>#merge_conditions</a></span><span class='args'>(*conditions)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO: this should reside on the model, not the controller.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#sort_collection_by_column-instance_method' title='#sort_collection_by_column'>#sort_collection_by_column</a></span><span class='args'>(collection, column, order)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
TODO: this should reside on the column, not the controller.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails class public">
  <h1>Public Class Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>included</h3>
</div><div id="included-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>included</span><span class='args'>(klass)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


99
100
101</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 99</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='included identifier id'>included</span><span class='lparen token'>(</span><span class='klass identifier id'>klass</span><span class='rparen token'>)</span>
  <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span> <span class='ClassMethods constant id'>ClassMethods</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div><div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>active_scaffold_conditions</h3>
</div><div id="active_scaffold_conditions-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>active_scaffold_conditions</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


106
107
108</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 106</span>

<span class='def def kw'>def</span> <span class='active_scaffold_conditions identifier id'>active_scaffold_conditions</span>
  <span class='@active_scaffold_conditions ivar id'>@active_scaffold_conditions</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>active_scaffold_habtm_joins</h3>
</div><div id="active_scaffold_habtm_joins-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>active_scaffold_habtm_joins</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


116
117
118</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 116</span>

<span class='def def kw'>def</span> <span class='active_scaffold_habtm_joins identifier id'>active_scaffold_habtm_joins</span>
  <span class='@active_scaffold_habtm_joins ivar id'>@active_scaffold_habtm_joins</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>active_scaffold_joins</h3>
</div><div id="active_scaffold_joins-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>active_scaffold_joins</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


111
112
113</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 111</span>

<span class='def def kw'>def</span> <span class='active_scaffold_joins identifier id'>active_scaffold_joins</span>
  <span class='@active_scaffold_joins ivar id'>@active_scaffold_joins</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>all_conditions</h3>
</div><div id="all_conditions-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>all_conditions</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


120
121
122
123
124
125
126
127
128</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 120</span>

<span class='def def kw'>def</span> <span class='all_conditions identifier id'>all_conditions</span>
  <span class='merge_conditions identifier id'>merge_conditions</span><span class='lparen token'>(</span>
    <span class='active_scaffold_conditions identifier id'>active_scaffold_conditions</span><span class='comma token'>,</span>                   <span class='comment val'># from the search modules</span>
    <span class='conditions_for_collection identifier id'>conditions_for_collection</span><span class='comma token'>,</span>                    <span class='comment val'># from the dev</span>
    <span class='conditions_from_params identifier id'>conditions_from_params</span><span class='comma token'>,</span>                       <span class='comment val'># from the parameters (e.g. /users/list?first_name=Fred)</span>
    <span class='conditions_from_constraints identifier id'>conditions_from_constraints</span><span class='comma token'>,</span>                  <span class='comment val'># from any constraints (embedded scaffolds)</span>
    <span class='active_scaffold_session_storage identifier id'>active_scaffold_session_storage</span><span class='lbrack token'>[</span><span class='symbol val'>:conditions</span><span class='rbrack token'>]</span> <span class='comment val'># embedding conditions (weaker constraints)</span>
  <span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_order_clause</h3>
</div><div id="build_order_clause-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_order_clause</span><span class='args'>(sorting)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
accepts a DataStructure::Sorting object and builds an order-by clause TODO:
this should reside on the model, not the controller
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 203</span>

<span class='def def kw'>def</span> <span class='build_order_clause identifier id'>build_order_clause</span><span class='lparen token'>(</span><span class='sorting identifier id'>sorting</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='sorting identifier id'>sorting</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='sorting identifier id'>sorting</span><span class='dot token'>.</span><span class='sorts_by_method? fid id'>sorts_by_method?</span>

  <span class='comment val'># unless the sorting is by method, create the sql string</span>
  <span class='order identifier id'>order</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='sorting identifier id'>sorting</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='clause identifier id'>clause</span><span class='bitor op'>|</span>
    <span class='sort_column identifier id'>sort_column</span><span class='comma token'>,</span> <span class='sort_direction identifier id'>sort_direction</span> <span class='assign token'>=</span> <span class='clause identifier id'>clause</span>
    <span class='sql identifier id'>sql</span> <span class='assign token'>=</span> <span class='sort_column identifier id'>sort_column</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='lbrack token'>[</span><span class='symbol val'>:sql</span><span class='rbrack token'>]</span>
    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='sql identifier id'>sql</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='or or kw'>or</span> <span class='sql identifier id'>sql</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

    <span class='order identifier id'>order</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{sql} #{sort_direction}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='order identifier id'>order</span> <span class='assign token'>=</span> <span class='order identifier id'>order</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>', '</span><span class='rparen token'>)</span>
  <span class='order identifier id'>order</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span> <span class='if if_mod kw'>if</span> <span class='order identifier id'>order</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>

  <span class='order identifier id'>order</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_if_allowed</h3>
</div><div id="find_if_allowed-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_if_allowed</span><span class='args'>(id, action, klass = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns a single record (the given id) but only if it&#8217;s allowed for
the specified action. accomplishes this by checking
model.#{action}_authorized? TODO: this should reside on the model, not the
controller
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt><a href='RecordNotAllowed.html' title='ActiveScaffold::RecordNotAllowed'>ActiveScaffold::RecordNotAllowed</a></tt>]</span>
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


133
134
135
136
137
138</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 133</span>

<span class='def def kw'>def</span> <span class='find_if_allowed identifier id'>find_if_allowed</span><span class='lparen token'>(</span><span class='id identifier id'>id</span><span class='comma token'>,</span> <span class='action identifier id'>action</span><span class='comma token'>,</span> <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='klass identifier id'>klass</span> <span class='opasgn op'>||=</span> <span class='active_scaffold_config identifier id'>active_scaffold_config</span><span class='dot token'>.</span><span class='model identifier id'>model</span>
  <span class='record identifier id'>record</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='id identifier id'>id</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='ActiveScaffold constant id'>ActiveScaffold</span><span class='colon2 op'>::</span><span class='RecordNotAllowed constant id'>RecordNotAllowed</span> <span class='unless unless_mod kw'>unless</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='authorized_for? fid id'>authorized_for?</span><span class='lparen token'>(</span><span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='action identifier id'>action</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='record identifier id'>record</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_page</h3>
</div><div id="find_page-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_page</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns a Paginator::Page (not from ActiveRecord::Paginator) for the given
parameters options may include:
</p>
<ul>
<li>:sorting - a Sorting DataStructure (basically an array of hashes of field
=&gt; direction, e.g. [{:field1 =&gt; &#8216;asc&#8217;}, {:field2 =&gt;
&#8216;desc&#8217;}]). please note that multi-column sorting has some
limitations: if any column in a multi-field sort uses method-based sorting,
it will be ignored. method sorting only works for single-column sorting.

</li>
<li>:per_page

</li>
<li>:page

</li>
</ul>
<p>
TODO: this should reside on the model, not the controller
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 146</span>

<span class='def def kw'>def</span> <span class='find_page identifier id'>find_page</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='assert_valid_keys identifier id'>assert_valid_keys</span> <span class='symbol val'>:sorting</span><span class='comma token'>,</span> <span class='symbol val'>:per_page</span><span class='comma token'>,</span> <span class='symbol val'>:page</span><span class='comma token'>,</span> <span class='symbol val'>:count_includes</span>

  <span class='full_includes identifier id'>full_includes</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='active_scaffold_joins identifier id'>active_scaffold_joins</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='active_scaffold_joins identifier id'>active_scaffold_joins</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='integer val'>999999999</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='integer val'>1</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:count_includes</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='full_includes identifier id'>full_includes</span>

  <span class='klass identifier id'>klass</span> <span class='assign token'>=</span> <span class='active_scaffold_config identifier id'>active_scaffold_config</span><span class='dot token'>.</span><span class='model identifier id'>model</span>

  <span class='comment val'># create a general-use options array that's compatible with Rails finders</span>
  <span class='finder_options identifier id'>finder_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='build_order_clause identifier id'>build_order_clause</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:sorting</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                     <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='all_conditions identifier id'>all_conditions</span><span class='comma token'>,</span>
                     <span class='symbol val'>:joins</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='joins_for_finder identifier id'>joins_for_finder</span><span class='comma token'>,</span>
                     <span class='symbol val'>:include</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:count_includes</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
                     
  <span class='finder_options identifier id'>finder_options</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span> <span class='custom_finder_options identifier id'>custom_finder_options</span>

  <span class='comment val'># NOTE: we must use :include in the count query, because some conditions may reference other tables</span>
  <span class='count identifier id'>count</span> <span class='assign token'>=</span> <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='finder_options identifier id'>finder_options</span><span class='dot token'>.</span><span class='reject identifier id'>reject</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='comma token'>,</span><span class='v identifier id'>v</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span> <span class='k identifier id'>k</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>

  <span class='finder_options identifier id'>finder_options</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span> <span class='symbol val'>:include</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='full_includes identifier id'>full_includes</span>

  <span class='comment val'># we build the paginator differently for method- and sql-based sorting</span>
  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='sorting identifier id'>sorting</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='colon op'>:</span><span class='sorting identifier id'>sorting</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='sorts_by_method? fid id'>sorts_by_method?</span>
    <span class='pager identifier id'>pager</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Paginator constant id'>Paginator</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='count identifier id'>count</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='offset identifier id'>offset</span><span class='comma token'>,</span> <span class='per_page identifier id'>per_page</span><span class='bitor op'>|</span>
      <span class='sorted_collection identifier id'>sorted_collection</span> <span class='assign token'>=</span> <span class='sort_collection_by_column identifier id'>sort_collection_by_column</span><span class='lparen token'>(</span><span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='finder_options identifier id'>finder_options</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:sorting</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
      <span class='sorted_collection identifier id'>sorted_collection</span><span class='dot token'>.</span><span class='slice identifier id'>slice</span><span class='lparen token'>(</span><span class='offset identifier id'>offset</span><span class='comma token'>,</span> <span class='per_page identifier id'>per_page</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='pager identifier id'>pager</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Paginator constant id'>Paginator</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='count identifier id'>count</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='offset identifier id'>offset</span><span class='comma token'>,</span> <span class='per_page identifier id'>per_page</span><span class='bitor op'>|</span>
      <span class='klass identifier id'>klass</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='finder_options identifier id'>finder_options</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:offset</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='offset identifier id'>offset</span><span class='comma token'>,</span> <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='per_page identifier id'>per_page</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='pager identifier id'>pager</span><span class='dot token'>.</span><span class='page identifier id'>page</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>joins_for_finder</h3>
</div><div id="joins_for_finder-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>joins_for_finder</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


184
185
186
187
188
189
190
191
192
193</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 184</span>

<span class='def def kw'>def</span> <span class='joins_for_finder identifier id'>joins_for_finder</span>
  <span class='case case kw'>case</span> <span class='joins_for_collection identifier id'>joins_for_collection</span>
    <span class='when when kw'>when</span> <span class='String constant id'>String</span>
      <span class='lbrack token'>[</span> <span class='joins_for_collection identifier id'>joins_for_collection</span> <span class='rbrack token'>]</span>
    <span class='when when kw'>when</span> <span class='Array constant id'>Array</span>
      <span class='joins_for_collection identifier id'>joins_for_collection</span>
    <span class='else else kw'>else</span>
      <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span> <span class='plus op'>+</span> <span class='active_scaffold_habtm_joins identifier id'>active_scaffold_habtm_joins</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>merge_conditions</h3>
</div><div id="merge_conditions-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>merge_conditions</span><span class='args'>(*conditions)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO: this should reside on the model, not the controller
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


196
197
198
199</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 196</span>

<span class='def def kw'>def</span> <span class='merge_conditions identifier id'>merge_conditions</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='conditions identifier id'>conditions</span><span class='rparen token'>)</span>
  <span class='c identifier id'>c</span> <span class='assign token'>=</span> <span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='find_all identifier id'>find_all</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='not not kw'>not</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span> <span class='and and kw'>and</span> <span class='not not kw'>not</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='rbrace token'>}</span>
  <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='active_scaffold_config identifier id'>active_scaffold_config</span><span class='dot token'>.</span><span class='model identifier id'>model</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='symbol val'>:sanitize_sql</span><span class='comma token'>,</span> <span class='c identifier id'>c</span><span class='rparen token'>)</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' AND '</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sort_collection_by_column</h3>
</div><div id="sort_collection_by_column-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sort_collection_by_column</span><span class='args'>(collection, column, order)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
TODO: this should reside on the column, not the controller
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


223
224
225
226
227
228
229
230
231
232</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/active_scaffold/finder.rb', line 223</span>

<span class='def def kw'>def</span> <span class='sort_collection_by_column identifier id'>sort_collection_by_column</span><span class='lparen token'>(</span><span class='collection identifier id'>collection</span><span class='comma token'>,</span> <span class='column identifier id'>column</span><span class='comma token'>,</span> <span class='order identifier id'>order</span><span class='rparen token'>)</span>
  <span class='sorter identifier id'>sorter</span> <span class='assign token'>=</span> <span class='column identifier id'>column</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='lbrack token'>[</span><span class='symbol val'>:method</span><span class='rbrack token'>]</span>
  <span class='collection identifier id'>collection</span> <span class='assign token'>=</span> <span class='collection identifier id'>collection</span><span class='dot token'>.</span><span class='sort_by identifier id'>sort_by</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='sorter identifier id'>sorter</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span> <span class='Proc constant id'>Proc</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='instance_eval identifier id'>instance_eval</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='sorter identifier id'>sorter</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='instance_eval identifier id'>instance_eval</span><span class='lparen token'>(</span><span class='sorter identifier id'>sorter</span><span class='rparen token'>)</span>
    <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='string val'>''</span> <span class='if if_mod kw'>if</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='value identifier id'>value</span>
  <span class='rbrace token'>}</span>
  <span class='collection identifier id'>collection</span><span class='dot token'>.</span><span class='reverse! fid id'>reverse!</span> <span class='if if_mod kw'>if</span> <span class='order identifier id'>order</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='eq op'>==</span> <span class='string val'>'desc'</span>
  <span class='collection identifier id'>collection</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>