<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>josevalim's inherited_resources - Module: InheritedResources::PolymorphicHelpers - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/josevalim/commits/inherited_resources/master" rel="alternate" title="Recent Commits to inherited_resources:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("josevalim", "inherited_resources", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='josevalim/inherited_resources/blob/bebcda491ae61994610cf2bcc746c9a1d4bdc6d0' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='josevalim/inherited_resources/blob/bebcda491ae61994610cf2bcc746c9a1d4bdc6d0' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("josevalim", "inherited_resources", "bebcda491ae61994610cf2bcc746c9a1d4bdc6d0", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/josevalim/inherited_resources/tree/">Source</a></li>
            <li class=""><a href="http://github.com/josevalim/inherited_resources/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/josevalim/inherited_resources/network">Network</a></li>            
            <li class=""><a href="http://github.com/josevalim/inherited_resources/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/josevalim/inherited_resources">Wiki</a></li>
            <li class=""><a href="http://github.com/josevalim/inherited_resources/graphs">Graphs</a></li>                    
            <li class="active"><a href="/josevalim/inherited_resources">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/josevalim">josevalim</a> / <b><a href="http://github.com/josevalim/inherited_resources/tree">inherited_resources</a></b>        
                <a id="namespaces_button" rel="josevalim/inherited_resources/blob/bebcda491ae61994610cf2bcc746c9a1d4bdc6d0" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="josevalim/inherited_resources/blob/bebcda491ae61994610cf2bcc746c9a1d4bdc6d0" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module InheritedResources_PolymorphicHelpers">
  <h1>Module: InheritedResources::PolymorphicHelpers</h1>
  <div class="section docstring">
  <h1>polymorphic associations</h1>
<p>
In some cases you have a resource that belongs to two different resources
but not at the same time. For example, let&#8217;s suppose you have File,
Message and Task as resources and they are all commentable.
</p>
<p>
Polymorphic associations allows you to create just one controller that will
deal with each case.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Comment constant id'>Comment</span> <span class='lt op'>&lt;</span> <span class='InheritedResources constant id'>InheritedResources</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:file</span><span class='comma token'>,</span> <span class='symbol val'>:message</span><span class='comma token'>,</span> <span class='symbol val'>:task</span><span class='comma token'>,</span> <span class='symbol val'>:polymorphic</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Your routes should be something like:
</p>
<pre class="code">
  <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:files</span><span class='comma token'>,</span>    <span class='symbol val'>:has_many</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='comment val'>#=&gt; /files/13/comments</span>
  <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:tasks</span><span class='comma token'>,</span>    <span class='symbol val'>:has_many</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='comment val'>#=&gt; /tasks/17/comments</span>
  <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:messages</span><span class='comma token'>,</span> <span class='symbol val'>:has_many</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='comment val'>#=&gt; /messages/11/comments</span>
</pre>
<p>
When using polymorphic associations, you get some free helpers:
</p>
<pre class="code">
  <span class='parent? fid id'>parent?</span>         <span class='comment val'>#=&gt; true</span>
  <span class='parent_type identifier id'>parent_type</span>     <span class='comment val'>#=&gt; :task</span>
  <span class='parent_class identifier id'>parent_class</span>    <span class='comment val'>#=&gt; Task</span>
  <span class='parent identifier id'>parent</span>          <span class='comment val'>#=&gt; @task</span>
</pre>
<p>
This polymorphic controllers thing is a great idea by James Golick and he
built it in resource_controller. Here is just a re-implementation.
</p>
<h1>optional polymorphic associations</h1>
<p>
Let&#8217;s take another break from ProjectsController. Let&#8217;s suppose
we are building a store, which sell products.
</p>
<p>
On the website, we can show all products, but also products scoped to
categories, brands, users. In this case case, the association is optional,
and we deal with it in the following way:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='ProductsController constant id'>ProductsController</span> <span class='lt op'>&lt;</span> <span class='InheritedResources constant id'>InheritedResources</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:category</span><span class='comma token'>,</span> <span class='symbol val'>:brand</span><span class='comma token'>,</span> <span class='symbol val'>:user</span><span class='comma token'>,</span> <span class='symbol val'>:polymorphic</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:optional</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
</pre>
<p>
This will handle all those urls properly:
</p>
<pre class="code">
  <span class='regexp val'>/products/</span><span class='integer val'>1</span>
  <span class='regexp val'>/categories/</span><span class='integer val'>2</span><span class='div op'>/</span><span class='products identifier id'>products</span><span class='div op'>/</span><span class='integer val'>5</span>
  <span class='regexp val'>/brands/</span><span class='integer val'>10</span><span class='div op'>/</span><span class='products identifier id'>products</span><span class='div op'>/</span><span class='integer val'>3</span>
  <span class='regexp val'>/user/</span><span class='integer val'>13</span><span class='div op'>/</span><span class='products identifier id'>products</span><span class='div op'>/</span><span class='integer val'>11</span>
</pre>
<h1>nested polymorphic associations</h1>
<p>
You can have polymorphic associations with nested resources. Let&#8217;s
suppose that our File, Task and Message resources in the previous example
belongs to a project.
</p>
<p>
This way we can have:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='CommentsController constant id'>CommentsController</span> <span class='lt op'>&lt;</span> <span class='InheritedResources constant id'>InheritedResources</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:project</span> <span class='lbrace token'>{</span>
      <span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:file</span><span class='comma token'>,</span> <span class='symbol val'>:message</span><span class='comma token'>,</span> <span class='symbol val'>:task</span><span class='comma token'>,</span> <span class='symbol val'>:polymorphic</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Or:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='CommentsController constant id'>CommentsController</span> <span class='lt op'>&lt;</span> <span class='InheritedResources constant id'>InheritedResources</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='nested_belongs_to identifier id'>nested_belongs_to</span> <span class='symbol val'>:project</span>
    <span class='nested_belongs_to identifier id'>nested_belongs_to</span> <span class='symbol val'>:file</span><span class='comma token'>,</span> <span class='symbol val'>:message</span><span class='comma token'>,</span> <span class='symbol val'>:task</span><span class='comma token'>,</span> <span class='symbol val'>:polymorphic</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Choose the syntax that makes more sense to you. :)
</p>
<p>
Finally your routes should be something like:
</p>
<pre class="code">
  <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:projects</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='m identifier id'>m</span><span class='bitor op'>|</span>
    <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:files</span><span class='comma token'>,</span>    <span class='symbol val'>:has_many</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='comment val'>#=&gt; /projects/1/files/13/comments</span>
    <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:tasks</span><span class='comma token'>,</span>    <span class='symbol val'>:has_many</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='comment val'>#=&gt; /projects/1/tasks/17/comments</span>
    <span class='m identifier id'>m</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:messages</span><span class='comma token'>,</span> <span class='symbol val'>:has_many</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:comments</span> <span class='comment val'>#=&gt; /projects/1/messages/11/comments</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The helpers work in the same way as above.
</p>

</div><div class="section constants">
  
</div>
</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>