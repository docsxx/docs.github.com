<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>sandal's prawn - Module: Prawn::Images - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/sandal/commits/prawn/master" rel="alternate" title="Recent Commits to prawn:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("sandal", "prawn", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("sandal", "prawn", "656ef4d88bf30cec3ebbbcdcc133cee27ef9948c", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/sandal/prawn/tree/">Source</a></li>
            <li class=""><a href="http://github.com/sandal/prawn/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/sandal/prawn/network">Network</a></li>            
            <li class=""><a href="http://github.com/sandal/prawn/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/sandal/prawn">Wiki</a></li>
            <li class=""><a href="http://github.com/sandal/prawn/graphs">Graphs</a></li>                    
            <li class="active"><a href="/sandal/prawn">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/sandal">sandal</a> / <b><a href="http://github.com/sandal/prawn/tree">prawn</a></b>        
                <a id="namespaces_button" rel="sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Prawn_Images">
  <h1>Module: Prawn::Images</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_jpg_object-instance_method">#build_jpg_object</span><span class='args'>(data, jpg)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_png_object-instance_method">#build_png_object</span><span class='args'>(data, png)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#calc_image_dimensions-instance_method">#calc_image_dimensions</span><span class='args'>(info, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#detect_image_format-instance_method">#detect_image_format</span><span class='args'>(content)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image-instance_method">#image</span><span class='args'>(file, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Add the image at filename to the current page.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_position-instance_method">#image_position</span><span class='args'>(w, h, options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_registry-instance_method">#image_registry</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#next_image_id-instance_method">#next_image_id</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>build_jpg_object</h3>
</div><div id="build_jpg_object-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_jpg_object</span><span class='args'>(data, jpg)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 143</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L143">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_jpg_object identifier id'>build_jpg_object</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='jpg identifier id'>jpg</span><span class='rparen token'>)</span> 
  <span class='color_space identifier id'>color_space</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='jpg identifier id'>jpg</span><span class='dot token'>.</span><span class='channels identifier id'>channels</span>
  <span class='when when kw'>when</span> <span class='integer val'>1</span>
    <span class='symbol val'>:DeviceGray</span>
  <span class='when when kw'>when</span> <span class='integer val'>3</span>
    <span class='symbol val'>:DeviceRGB</span>
  <span class='when when kw'>when</span> <span class='integer val'>4</span>
    <span class='symbol val'>:DeviceCMYK</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='string val'>'JPG uses an unsupported number of channels'</span>
  <span class='end end kw'>end</span>
  <span class='obj identifier id'>obj</span> <span class='assign token'>=</span> <span class='ref identifier id'>ref</span><span class='lparen token'>(</span><span class='symbol val'>:Type</span>       <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:XObject</span><span class='comma token'>,</span>
      <span class='symbol val'>:Subtype</span>          <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:Image</span><span class='comma token'>,</span>
      <span class='symbol val'>:Filter</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:DCTDecode</span><span class='comma token'>,</span>
      <span class='symbol val'>:ColorSpace</span>       <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='color_space identifier id'>color_space</span><span class='comma token'>,</span>
      <span class='symbol val'>:BitsPerComponent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='jpg identifier id'>jpg</span><span class='dot token'>.</span><span class='bits identifier id'>bits</span><span class='comma token'>,</span>
      <span class='symbol val'>:Width</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='jpg identifier id'>jpg</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span>
      <span class='symbol val'>:Height</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='jpg identifier id'>jpg</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='comma token'>,</span>
      <span class='symbol val'>:Length</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='data identifier id'>data</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='rparen token'>)</span> 

  <span class='comment val'># add extra decode params for CMYK images. By swapping the</span>
  <span class='comment val'># min and max values from the default, we invert the colours. See</span>
  <span class='comment val'># section 4.8.4 of the spec.</span>
  <span class='if if kw'>if</span> <span class='color_space identifier id'>color_space</span> <span class='eq op'>==</span> <span class='symbol val'>:DeviceCMYK</span>
    <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='symbol val'>:Decode</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0</span><span class='comma token'>,</span> <span class='float val'>1.0</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.0</span> <span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='obj identifier id'>obj</span> <span class='lshft op'>&lt;&lt;</span> <span class='data identifier id'>data</span>
  <span class='return return kw'>return</span> <span class='obj identifier id'>obj</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_png_object</h3>
</div><div id="build_png_object-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_png_object</span><span class='args'>(data, png)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 174</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L174">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_png_object identifier id'>build_png_object</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='comma token'>,</span> <span class='png identifier id'>png</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='compression_method identifier id'>compression_method</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
    <span class='raise identifier id'>raise</span> <span class='Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='UnsupportedImageType constant id'>UnsupportedImageType</span><span class='comma token'>,</span> <span class='string val'>'PNG uses an unsupported compression method'</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='filter_method identifier id'>filter_method</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
    <span class='raise identifier id'>raise</span> <span class='Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='UnsupportedImageType constant id'>UnsupportedImageType</span><span class='comma token'>,</span> <span class='string val'>'PNG uses an unsupported filter method'</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='interlace_method identifier id'>interlace_method</span> <span class='neq op'>!=</span> <span class='integer val'>0</span>
    <span class='raise identifier id'>raise</span> <span class='Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='UnsupportedImageType constant id'>UnsupportedImageType</span><span class='comma token'>,</span> <span class='string val'>'PNG uses unsupported interlace method'</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># some PNG types store the colour and alpha channel data together,</span>
  <span class='comment val'># which the PDF spec doesn't like, so split it out.</span>
  <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='split_alpha_channel! fid id'>split_alpha_channel!</span>

  <span class='case case kw'>case</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='colors identifier id'>colors</span>
  <span class='when when kw'>when</span> <span class='integer val'>1</span>
    <span class='color identifier id'>color</span> <span class='assign token'>=</span> <span class='symbol val'>:DeviceGray</span>
  <span class='when when kw'>when</span> <span class='integer val'>3</span>
    <span class='color identifier id'>color</span> <span class='assign token'>=</span> <span class='symbol val'>:DeviceRGB</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='UnsupportedImageType constant id'>UnsupportedImageType</span><span class='comma token'>,</span> <span class='dstring node'>&quot;PNG uses an unsupported number of colors (#{png.colors})&quot;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># build the image dict</span>
  <span class='obj identifier id'>obj</span> <span class='assign token'>=</span> <span class='ref identifier id'>ref</span><span class='lparen token'>(</span><span class='symbol val'>:Type</span>             <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:XObject</span><span class='comma token'>,</span>
            <span class='symbol val'>:Subtype</span>          <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:Image</span><span class='comma token'>,</span>
            <span class='symbol val'>:Height</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='comma token'>,</span>
            <span class='symbol val'>:Width</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span>
            <span class='symbol val'>:BitsPerComponent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='bits identifier id'>bits</span><span class='comma token'>,</span>
            <span class='symbol val'>:Length</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='img_data identifier id'>img_data</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>
            <span class='symbol val'>:Filter</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:FlateDecode</span>
           <span class='rparen token'>)</span>

  <span class='unless unless kw'>unless</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='alpha_channel identifier id'>alpha_channel</span>
    <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='symbol val'>:DecodeParms</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:Predictor</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>15</span><span class='comma token'>,</span>
                              <span class='symbol val'>:Colors</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='colors identifier id'>colors</span><span class='comma token'>,</span>
                              <span class='symbol val'>:BitsPerComponent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='bits identifier id'>bits</span><span class='comma token'>,</span>
                              <span class='symbol val'>:Columns</span>   <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># append the actual image data to the object as a stream</span>
  <span class='obj identifier id'>obj</span> <span class='lshft op'>&lt;&lt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='img_data identifier id'>img_data</span>
  
  <span class='comment val'># sort out the colours of the image</span>
  <span class='if if kw'>if</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='palette identifier id'>palette</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='symbol val'>:ColorSpace</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='color identifier id'>color</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># embed the colour palette in the PDF as a object stream</span>
    <span class='palette_obj identifier id'>palette_obj</span> <span class='assign token'>=</span> <span class='ref identifier id'>ref</span><span class='lparen token'>(</span><span class='symbol val'>:Length</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='palette identifier id'>palette</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='rparen token'>)</span>
    <span class='palette_obj identifier id'>palette_obj</span> <span class='lshft op'>&lt;&lt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='palette identifier id'>palette</span>

    <span class='comment val'># build the color space array for the image</span>
    <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='symbol val'>:ColorSpace</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='symbol val'>:Indexed</span><span class='comma token'>,</span> 
                             <span class='symbol val'>:DeviceRGB</span><span class='comma token'>,</span>
                             <span class='lparen token'>(</span><span class='png identifier id'>png</span><span class='dot token'>.</span><span class='palette identifier id'>palette</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='div op'>/</span> <span class='integer val'>3</span><span class='rparen token'>)</span> <span class='minus op'>-</span><span class='integer val'>1</span><span class='comma token'>,</span>
                             <span class='palette_obj identifier id'>palette_obj</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># *************************************</span>
  <span class='comment val'># add transparency data if necessary</span>
  <span class='comment val'># *************************************</span>

  <span class='comment val'># For PNG color types 0, 2 and 3, the transparency data is stored in</span>
  <span class='comment val'># a dedicated PNG chunk, and is exposed via the transparency attribute</span>
  <span class='comment val'># of the PNG class.</span>
  <span class='if if kw'>if</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='transparency identifier id'>transparency</span><span class='lbrack token'>[</span><span class='symbol val'>:grayscale</span><span class='rbrack token'>]</span>
    <span class='comment val'># Use Color Key Masking (spec section 4.8.5)</span>
    <span class='comment val'># - An array with N elements, where N is two times the number of color</span>
    <span class='comment val'>#   components.</span>
    <span class='val identifier id'>val</span> <span class='assign token'>=</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='transparency identifier id'>transparency</span><span class='lbrack token'>[</span><span class='symbol val'>:grayscale</span><span class='rbrack token'>]</span>
    <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='symbol val'>:Mask</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='comma token'>,</span> <span class='val identifier id'>val</span><span class='rbrack token'>]</span>
  <span class='elsif elsif kw'>elsif</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='transparency identifier id'>transparency</span><span class='lbrack token'>[</span><span class='symbol val'>:rgb</span><span class='rbrack token'>]</span>
    <span class='comment val'># Use Color Key Masking (spec section 4.8.5)</span>
    <span class='comment val'># - An array with N elements, where N is two times the number of color</span>
    <span class='comment val'>#   components.</span>
    <span class='rgb identifier id'>rgb</span> <span class='assign token'>=</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='transparency identifier id'>transparency</span><span class='lbrack token'>[</span><span class='symbol val'>:rgb</span><span class='rbrack token'>]</span>
    <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='symbol val'>:Mask</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='rgb identifier id'>rgb</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='val identifier id'>val</span><span class='bitor op'>|</span> <span class='lbrack token'>[</span><span class='val identifier id'>val</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='flatten identifier id'>flatten</span>
  <span class='elsif elsif kw'>elsif</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='transparency identifier id'>transparency</span><span class='lbrack token'>[</span><span class='symbol val'>:indexed</span><span class='rbrack token'>]</span>
    <span class='comment val'># TODO: broken. I was attempting to us Color Key Masking, but I think</span>
    <span class='comment val'>#       we need to construct an SMask i think. Maybe do it inside</span>
    <span class='comment val'>#       the PNG class, and store it in alpha_channel</span>
    <span class='comment val'>#obj.data[:Mask] = png.transparency[:indexed]</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># For PNG color types 4 and 6, the transparency data is stored as a alpha</span>
  <span class='comment val'># channel mixed in with the main image data. The PNG class seperates</span>
  <span class='comment val'># it out for us and makes it available via the alpha_channel attribute</span>
  <span class='if if kw'>if</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='alpha_channel identifier id'>alpha_channel</span>
    <span class='smask_obj identifier id'>smask_obj</span> <span class='assign token'>=</span> <span class='ref identifier id'>ref</span><span class='lparen token'>(</span><span class='symbol val'>:Type</span>             <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:XObject</span><span class='comma token'>,</span>
                    <span class='symbol val'>:Subtype</span>          <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:Image</span><span class='comma token'>,</span>
                    <span class='symbol val'>:Height</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='comma token'>,</span>
                    <span class='symbol val'>:Width</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span>
                    <span class='symbol val'>:BitsPerComponent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='bits identifier id'>bits</span><span class='comma token'>,</span>
                    <span class='symbol val'>:Length</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='alpha_channel identifier id'>alpha_channel</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span>
                    <span class='symbol val'>:Filter</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:FlateDecode</span><span class='comma token'>,</span>
                    <span class='symbol val'>:ColorSpace</span>       <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:DeviceGray</span><span class='comma token'>,</span>
                    <span class='symbol val'>:Decode</span>           <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rbrack token'>]</span>
                   <span class='rparen token'>)</span>
    <span class='smask_obj identifier id'>smask_obj</span> <span class='lshft op'>&lt;&lt;</span> <span class='png identifier id'>png</span><span class='dot token'>.</span><span class='alpha_channel identifier id'>alpha_channel</span>
    <span class='obj identifier id'>obj</span><span class='dot token'>.</span><span class='data identifier id'>data</span><span class='lbrack token'>[</span><span class='symbol val'>:SMask</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='smask_obj identifier id'>smask_obj</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='obj identifier id'>obj</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>calc_image_dimensions</h3>
</div><div id="calc_image_dimensions-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>calc_image_dimensions</span><span class='args'>(info, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 283</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L283">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='calc_image_dimensions identifier id'>calc_image_dimensions</span><span class='lparen token'>(</span><span class='info identifier id'>info</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:width</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='width identifier id'>width</span>
  <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:height</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='height identifier id'>height</span>

  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:width</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:height</span><span class='rbrack token'>]</span>
    <span class='wp identifier id'>wp</span> <span class='assign token'>=</span> <span class='w identifier id'>w</span> <span class='div op'>/</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> 
    <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='mult op'>*</span> <span class='wp identifier id'>wp</span>
    <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='mult op'>*</span> <span class='wp identifier id'>wp</span>
  <span class='elsif elsif kw'>elsif</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:height</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:width</span><span class='rbrack token'>]</span>         
    <span class='hp identifier id'>hp</span> <span class='assign token'>=</span> <span class='h identifier id'>h</span> <span class='div op'>/</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
    <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='mult op'>*</span> <span class='hp identifier id'>hp</span>
    <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='mult op'>*</span> <span class='hp identifier id'>hp</span>   
  <span class='elsif elsif kw'>elsif</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:scale</span><span class='rbrack token'>]</span> 
    <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='mult op'>*</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:scale</span><span class='rbrack token'>]</span>
    <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='mult op'>*</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:scale</span><span class='rbrack token'>]</span>
  <span class='elsif elsif kw'>elsif</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:fit</span><span class='rbrack token'>]</span> 
    <span class='bw identifier id'>bw</span><span class='comma token'>,</span> <span class='bh identifier id'>bh</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:fit</span><span class='rbrack token'>]</span>
    <span class='bp identifier id'>bp</span> <span class='assign token'>=</span> <span class='bw identifier id'>bw</span> <span class='div op'>/</span> <span class='bh identifier id'>bh</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
    <span class='ip identifier id'>ip</span> <span class='assign token'>=</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='div op'>/</span> <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span>
    <span class='if if kw'>if</span> <span class='ip identifier id'>ip</span> <span class='gt op'>&gt;</span> <span class='bp identifier id'>bp</span>
      <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='bw identifier id'>bw</span>
      <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='bw identifier id'>bw</span> <span class='div op'>/</span> <span class='ip identifier id'>ip</span>
    <span class='else else kw'>else</span>
      <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='bh identifier id'>bh</span>
      <span class='w identifier id'>w</span> <span class='assign token'>=</span> <span class='bh identifier id'>bh</span> <span class='mult op'>*</span> <span class='ip identifier id'>ip</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='scaled_width identifier id'>scaled_width</span> <span class='assign token'>=</span> <span class='w identifier id'>w</span>
  <span class='info identifier id'>info</span><span class='dot token'>.</span><span class='scaled_height identifier id'>scaled_height</span> <span class='assign token'>=</span> <span class='h identifier id'>h</span>
  <span class='lbrack token'>[</span><span class='w identifier id'>w</span><span class='comma token'>,</span><span class='h identifier id'>h</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>detect_image_format</h3>
</div><div id="detect_image_format-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>detect_image_format</span><span class='args'>(content)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 315</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L315">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">315
316
317
318
319
320
321
322
323
324
325</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='detect_image_format identifier id'>detect_image_format</span><span class='lparen token'>(</span><span class='content identifier id'>content</span><span class='rparen token'>)</span>
  <span class='top identifier id'>top</span> <span class='assign token'>=</span> <span class='content identifier id'>content</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span><span class='integer val'>128</span><span class='rbrack token'>]</span>                       

  <span class='if if kw'>if</span> <span class='top identifier id'>top</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>3</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;\xff\xd8\xff&quot;</span>
    <span class='return return kw'>return</span> <span class='symbol val'>:jpg</span>
  <span class='elsif elsif kw'>elsif</span> <span class='top identifier id'>top</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>8</span><span class='rbrack token'>]</span>  <span class='eq op'>==</span> <span class='string val'>&quot;\x89PNG\x0d\x0a\x1a\x0a&quot;</span>
    <span class='return return kw'>return</span> <span class='symbol val'>:png</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='Errors constant id'>Errors</span><span class='colon2 op'>::</span><span class='UnsupportedImageType constant id'>UnsupportedImageType</span><span class='comma token'>,</span> <span class='string val'>&quot;image file is an unrecognised format&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image</h3>
</div><div id="image-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image</span><span class='args'>(file, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Add the image at filename to the current page. Currently only JPG and PNG
files are supported.
</p>
<p>
Arguments:
</p>
<table>
<tr><td valign="top"><tt>file</tt>:</td><td>path to file or an object that responds to #read

</td></tr>
</table>
<p>
Options:
</p>
<table>
<tr><td valign="top"><tt>:at</tt>:</td><td>an array [x,y] with the location of the top left corner of the image.

</td></tr>
<tr><td valign="top"><tt>:position</tt>:</td><td>One of (:left, :center, :right) or an x-offset

</td></tr>
<tr><td valign="top"><tt>:vposition</tt>:</td><td>One of (:top, :center, :center) or an y-offset

</td></tr>
<tr><td valign="top"><tt>:height</tt>:</td><td>the height of the image [actual height of the image]

</td></tr>
<tr><td valign="top"><tt>:width</tt>:</td><td>the width of the image [actual width of the image]

</td></tr>
<tr><td valign="top"><tt>:scale</tt>:</td><td>scale the dimensions of the image proportionally

</td></tr>
<tr><td valign="top"><tt>:fit</tt>:</td><td>scale the dimensions of the image proportionally to fit inside
[width,height]

</td></tr>
</table>
<pre class="code">
  <span class='Prawn constant id'>Prawn</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='dot token'>.</span><span class='generate identifier id'>generate</span><span class='lparen token'>(</span><span class='string val'>&quot;image2.pdf&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:page_layout</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:landscape</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='pigs identifier id'>pigs</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{Prawn::BASEDIR}/data/images/pigs.jpg&quot;</span>
    <span class='image identifier id'>image</span> <span class='pigs identifier id'>pigs</span><span class='comma token'>,</span> <span class='symbol val'>:at</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>50</span><span class='comma token'>,</span><span class='integer val'>450</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:width</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>450</span>

    <span class='dice identifier id'>dice</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{Prawn::BASEDIR}/data/images/dice.png&quot;</span>
    <span class='image identifier id'>image</span> <span class='dice identifier id'>dice</span><span class='comma token'>,</span> <span class='symbol val'>:at</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='integer val'>50</span><span class='comma token'>,</span> <span class='integer val'>450</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:scale</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>0</span><span class='integer val'>.75</span>
  <span class='end end kw'>end</span>
</pre>
<p>
If only one of :width / :height are provided, the image will be scaled
proportionally. When both are provided, the image will be stretched to fit
the dimensions without maintaining the aspect ratio.
</p>
<p>
If :at is provided, the image will be place in the current page but the
text position will not be changed.
</p>
<p>
If instead of an explicit filename, an object with a read method is passed
as <tt>file</tt>, you can embed images from IO objects and things that act
like them (including Tempfiles and open-uri objects).
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>&quot;open-uri&quot;</span>

  <span class='Prawn constant id'>Prawn</span><span class='colon2 op'>::</span><span class='Document constant id'>Document</span><span class='dot token'>.</span><span class='generate identifier id'>generate</span><span class='lparen token'>(</span><span class='string val'>&quot;remote_images.pdf&quot;</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='image identifier id'>image</span> <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>&quot;http://prawn.majesticseacreature.com/media/prawn_logo.png&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<p>
This method returns an image info object which can be used to check the
dimensions of an image object if needed. (See also: Prawn::Images::PNG ,
Prawn::Images::JPG)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 58</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L58">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image identifier id'>image</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>     
  <span class='Prawn constant id'>Prawn</span><span class='dot token'>.</span><span class='verify_options identifier id'>verify_options</span> <span class='lbrack token'>[</span><span class='symbol val'>:at</span><span class='comma token'>,</span> <span class='symbol val'>:position</span><span class='comma token'>,</span> <span class='symbol val'>:vposition</span><span class='comma token'>,</span> <span class='symbol val'>:height</span><span class='comma token'>,</span> <span class='symbol val'>:width</span><span class='comma token'>,</span> <span class='symbol val'>:scale</span><span class='comma token'>,</span> <span class='symbol val'>:fit</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span>
  
  <span class='if if kw'>if</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:read</span><span class='rparen token'>)</span>
    <span class='image_content identifier id'>image_content</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='read identifier id'>read</span>
  <span class='else else kw'>else</span>      
    <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{file} not found&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='file? fid id'>file?</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>  
    <span class='image_content identifier id'>image_content</span> <span class='assign token'>=</span>  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='binread identifier id'>binread</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='image_sha1 identifier id'>image_sha1</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='SHA1 constant id'>SHA1</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='image_content identifier id'>image_content</span><span class='rparen token'>)</span>

  <span class='comment val'># register the fact that the current page uses images</span>
  <span class='proc_set identifier id'>proc_set</span> <span class='symbol val'>:ImageC</span>

  <span class='comment val'># if this image has already been embedded, just reuse it</span>
  <span class='if if kw'>if</span> <span class='image_registry identifier id'>image_registry</span><span class='lbrack token'>[</span><span class='image_sha1 identifier id'>image_sha1</span><span class='rbrack token'>]</span>
    <span class='info identifier id'>info</span> <span class='assign token'>=</span> <span class='image_registry identifier id'>image_registry</span><span class='lbrack token'>[</span><span class='image_sha1 identifier id'>image_sha1</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:info</span><span class='rbrack token'>]</span>
    <span class='image_obj identifier id'>image_obj</span> <span class='assign token'>=</span> <span class='image_registry identifier id'>image_registry</span><span class='lbrack token'>[</span><span class='image_sha1 identifier id'>image_sha1</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:obj</span><span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># build the image object and embed the raw data</span>
    <span class='image_obj identifier id'>image_obj</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='detect_image_format identifier id'>detect_image_format</span><span class='lparen token'>(</span><span class='image_content identifier id'>image_content</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:jpg</span> <span class='then then kw'>then</span>
      <span class='info identifier id'>info</span> <span class='assign token'>=</span> <span class='Prawn constant id'>Prawn</span><span class='colon2 op'>::</span><span class='Images constant id'>Images</span><span class='colon2 op'>::</span><span class='JPG constant id'>JPG</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='image_content identifier id'>image_content</span><span class='rparen token'>)</span>
      <span class='build_jpg_object identifier id'>build_jpg_object</span><span class='lparen token'>(</span><span class='image_content identifier id'>image_content</span><span class='comma token'>,</span> <span class='info identifier id'>info</span><span class='rparen token'>)</span>
    <span class='when when kw'>when</span> <span class='symbol val'>:png</span> <span class='then then kw'>then</span>
      <span class='info identifier id'>info</span> <span class='assign token'>=</span> <span class='Prawn constant id'>Prawn</span><span class='colon2 op'>::</span><span class='Images constant id'>Images</span><span class='colon2 op'>::</span><span class='PNG constant id'>PNG</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='image_content identifier id'>image_content</span><span class='rparen token'>)</span>
      <span class='build_png_object identifier id'>build_png_object</span><span class='lparen token'>(</span><span class='image_content identifier id'>image_content</span><span class='comma token'>,</span> <span class='info identifier id'>info</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
    <span class='image_registry identifier id'>image_registry</span><span class='lbrack token'>[</span><span class='image_sha1 identifier id'>image_sha1</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:obj</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='image_obj identifier id'>image_obj</span><span class='comma token'>,</span> <span class='symbol val'>:info</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='info identifier id'>info</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># find where the image will be placed and how big it will be  </span>
  <span class='w identifier id'>w</span><span class='comma token'>,</span><span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='calc_image_dimensions identifier id'>calc_image_dimensions</span><span class='lparen token'>(</span><span class='info identifier id'>info</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:at</span><span class='rbrack token'>]</span>     
    <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='translate identifier id'>translate</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:at</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> 
  <span class='else else kw'>else</span>                  
    <span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='image_position identifier id'>image_position</span><span class='lparen token'>(</span><span class='w identifier id'>w</span><span class='comma token'>,</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='options identifier id'>options</span><span class='rparen token'>)</span> 
    <span class='move_text_position identifier id'>move_text_position</span> <span class='h identifier id'>h</span>   
  <span class='end end kw'>end</span>

  <span class='comment val'># add a reference to the image object to the current page</span>
  <span class='comment val'># resource list and give it a label</span>
  <span class='label identifier id'>label</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;I#{next_image_id}&quot;</span>
  <span class='page_xobjects identifier id'>page_xobjects</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span> <span class='label identifier id'>label</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='image_obj identifier id'>image_obj</span> <span class='rparen token'>)</span>

  <span class='comment val'># add the image to the current page</span>
  <span class='instruct identifier id'>instruct</span> <span class='assign token'>=</span> <span class='string val'>&quot;\nq\n%.3f 0 0 %.3f %.3f %.3f cm\n/%s Do\nQ&quot;</span>
  <span class='add_content identifier id'>add_content</span> <span class='instruct identifier id'>instruct</span> <span class='mod op'>%</span> <span class='lbrack token'>[</span> <span class='w identifier id'>w</span><span class='comma token'>,</span> <span class='h identifier id'>h</span><span class='comma token'>,</span> <span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='minus op'>-</span> <span class='h identifier id'>h</span><span class='comma token'>,</span> <span class='label identifier id'>label</span> <span class='rbrack token'>]</span>
  
  <span class='return return kw'>return</span> <span class='info identifier id'>info</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_position</h3>
</div><div id="image_position-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_position</span><span class='args'>(w, h, options)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 114</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L114">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_position identifier id'>image_position</span><span class='lparen token'>(</span><span class='w identifier id'>w</span><span class='comma token'>,</span><span class='h identifier id'>h</span><span class='comma token'>,</span><span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:position</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:left</span>
  
  <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:position</span><span class='rbrack token'>]</span> 
  <span class='when when kw'>when</span> <span class='symbol val'>:left</span>
    <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_left identifier id'>absolute_left</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:center</span>
    <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_left identifier id'>absolute_left</span> <span class='plus op'>+</span> <span class='lparen token'>(</span><span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='minus op'>-</span> <span class='w identifier id'>w</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='float val'>2.0</span> 
  <span class='when when kw'>when</span> <span class='symbol val'>:right</span>
    <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_right identifier id'>absolute_right</span> <span class='minus op'>-</span> <span class='w identifier id'>w</span>
  <span class='when when kw'>when</span> <span class='Numeric constant id'>Numeric</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:position</span><span class='rbrack token'>]</span> <span class='plus op'>+</span> <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_left identifier id'>absolute_left</span>
  <span class='end end kw'>end</span>

  <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:vposition</span><span class='rbrack token'>]</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:top</span>
    <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_top identifier id'>absolute_top</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:center</span>
    <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_top identifier id'>absolute_top</span> <span class='minus op'>-</span> <span class='lparen token'>(</span><span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='minus op'>-</span> <span class='h identifier id'>h</span><span class='rparen token'>)</span> <span class='div op'>/</span> <span class='float val'>2.0</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:bottom</span>
    <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_bottom identifier id'>absolute_bottom</span> <span class='plus op'>+</span> <span class='h identifier id'>h</span>
  <span class='when when kw'>when</span> <span class='Numeric constant id'>Numeric</span>
    <span class='bounds identifier id'>bounds</span><span class='dot token'>.</span><span class='absolute_top identifier id'>absolute_top</span> <span class='minus op'>-</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:vposition</span><span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='y identifier id'>y</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='lbrack token'>[</span><span class='x identifier id'>x</span><span class='comma token'>,</span><span class='y identifier id'>y</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_registry</h3>
</div><div id="image_registry-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_registry</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 327</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L327">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">327
328
329</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_registry identifier id'>image_registry</span>
  <span class='@image_registry ivar id'>@image_registry</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>next_image_id</h3>
</div><div id="next_image_id-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>next_image_id</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/prawn/images.rb', line 331</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/sandal/prawn/blob/656ef4d88bf30cec3ebbbcdcc133cee27ef9948c/lib/prawn/images.rb#L331">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">331
332
333
334</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='next_image_id identifier id'>next_image_id</span>
  <span class='@image_counter ivar id'>@image_counter</span> <span class='opasgn op'>||=</span> <span class='integer val'>0</span>
  <span class='@image_counter ivar id'>@image_counter</span> <span class='opasgn op'>+=</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>