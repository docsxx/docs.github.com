<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: WillPaginate::NamedScope::ClassMethods</title>
  </head>
  <body>
    <div id="content">
      <div class="section module WillPaginate_NamedScope_ClassMethods">
  <h1 class="title">Module: WillPaginate::NamedScope::ClassMethods</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#named_scope-instance_method' title='#named_scope'>#named_scope</a></span><span class='args'>(name, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds a class method for retrieving and querying objects.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#scopes-instance_method' title='#scopes'>#scopes</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>named_scope</h3>
</div><div id="named_scope-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>named_scope</span><span class='args'>(name, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds a class method for retrieving and querying objects. A scope represents
a narrowing of a database query, such as <tt>:conditions =&gt; <tt>=&amp;gt; :red</tt>, :select =&gt; &#8216;shirts.*&#8217;, :include =&gt;
:washing_instructions</tt>.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Shirt constant id'>Shirt</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='named_scope identifier id'>named_scope</span> <span class='symbol val'>:red</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:color</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'red'</span><span class='rbrace token'>}</span>
    <span class='named_scope identifier id'>named_scope</span> <span class='symbol val'>:dry_clean_only</span><span class='comma token'>,</span> <span class='symbol val'>:joins</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:washing_instructions</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>'washing_instructions.dry_clean_only = ?'</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The above calls to <tt>named_scope</tt> define class methods
<tt>Shirt.red</tt> and <tt>Shirt.dry_clean_only</tt>. <tt>Shirt.red</tt>,
in effect, represents the query <tt>Shirt.find(:all, :conditions =&gt;
{:color =&gt; &#8216;red&#8217;})</tt>.
</p>
<p>
Unlike Shirt.find(&#8230;), however, the object returned by
<tt>Shirt.red</tt> is not an Array; it resembles the association object
constructed by a <tt>has_many</tt> declaration. For instance, you can
invoke <tt>Shirt.red.find(:first)</tt>, <tt>Shirt.red.count</tt>,
<tt>Shirt.red.find(:all, :conditions =&gt; {:size =&gt;
&#8216;small&#8217;})</tt>. Also, just as with the association objects,
name scopes acts like an Array, implementing Enumerable;
<tt>Shirt.red.each(&amp;block)</tt>, <tt>Shirt.red.first</tt>, and
<tt>Shirt.red.inject(memo, &amp;block)</tt> all behave as if Shirt.red
really were an Array.
</p>
<p>
These named scopes are composable. For instance,
<tt>Shirt.red.dry_clean_only</tt> will produce all shirts that are both red
and dry clean only. Nested finds and calculations also work with these
compositions: <tt>Shirt.red.dry_clean_only.count</tt> returns the number of
garments for which these criteria obtain. Similarly with
<tt>Shirt.red.dry_clean_only.average(:thread_count)</tt>.
</p>
<p>
All scopes are available as class methods on the ActiveRecord::Base
descendent upon which the scopes were defined. But they are also available
to <tt>has_many</tt> associations. If,
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Person constant id'>Person</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:shirts</span>
  <span class='end end kw'>end</span>
</pre>
<p>
then <tt>elton.shirts.red.dry_clean_only</tt> will return all of
Elton&#8217;s red, dry clean only shirts.
</p>
<p>
Named scopes can also be procedural.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Shirt constant id'>Shirt</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='named_scope identifier id'>named_scope</span> <span class='symbol val'>:colored</span><span class='comma token'>,</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='color identifier id'>color</span><span class='bitor op'>|</span>
      <span class='lbrace token'>{</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:color</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='color identifier id'>color</span> <span class='rbrace token'>}</span> <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In this example, <tt>Shirt.colored(&#8216;puce&#8217;)</tt> finds all puce
shirts.
</p>
<p>
Named scopes can also have extensions, just as with <tt>has_many</tt>
declarations:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Shirt constant id'>Shirt</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='named_scope identifier id'>named_scope</span> <span class='symbol val'>:red</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='symbol val'>:color</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'red'</span><span class='rbrace token'>}</span> <span class='do do kw'>do</span>
      <span class='def def kw'>def</span> <span class='dom_id identifier id'>dom_id</span>
        <span class='string val'>'red_shirts'</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
For testing complex named scopes, you can examine the scoping options using
the <tt>proxy_options</tt> method on the proxy itself.
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Shirt constant id'>Shirt</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='named_scope identifier id'>named_scope</span> <span class='symbol val'>:colored</span><span class='comma token'>,</span> <span class='lambda identifier id'>lambda</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='color identifier id'>color</span><span class='bitor op'>|</span>
      <span class='lbrace token'>{</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:color</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='color identifier id'>color</span> <span class='rbrace token'>}</span> <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='expected_options identifier id'>expected_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:colored</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'red'</span> <span class='rbrace token'>}</span> <span class='rbrace token'>}</span>
  <span class='assert_equal identifier id'>assert_equal</span> <span class='expected_options identifier id'>expected_options</span><span class='comma token'>,</span> <span class='Shirt constant id'>Shirt</span><span class='dot token'>.</span><span class='colored identifier id'>colored</span><span class='lparen token'>(</span><span class='string val'>'red'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='proxy_options identifier id'>proxy_options</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


86
87
88
89
90
91
92
93
94
95</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/will_paginate/named_scope.rb', line 86</span>

<span class='def def kw'>def</span> <span class='named_scope identifier id'>named_scope</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
<span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
<span class='scopes identifier id'>scopes</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lambda identifier id'>lambda</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='parent_scope identifier id'>parent_scope</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='bitor op'>|</span>
  <span class='Scope constant id'>Scope</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='parent_scope identifier id'>parent_scope</span><span class='comma token'>,</span> <span class='case case kw'>case</span> <span class='options identifier id'>options</span>
    <span class='when when kw'>when</span> <span class='Hash constant id'>Hash</span>
      <span class='options identifier id'>options</span>
    <span class='when when kw'>when</span> <span class='Proc constant id'>Proc</span>
      <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='mult op'>*</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='a identifier id'>a</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>scopes</h3>
</div><div id="scopes-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>scopes</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


19
20
21</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/will_paginate/named_scope.rb', line 19</span>

<span class='def def kw'>def</span> <span class='scopes identifier id'>scopes</span>
  <span class='read_inheritable_attribute identifier id'>read_inheritable_attribute</span><span class='lparen token'>(</span><span class='symbol val'>:scopes</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='write_inheritable_attribute identifier id'>write_inheritable_attribute</span><span class='lparen token'>(</span><span class='symbol val'>:scopes</span><span class='comma token'>,</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>