<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>bartt's image_bundle - Module: ImageBundleHelper - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/bartt/commits/image_bundle/master" rel="alternate" title="Recent Commits to image_bundle:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("bartt", "image_bundle", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='bartt/image_bundle/blob/35037b8baaa0a878a4bc9baf6ce683e2a43d9440' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='bartt/image_bundle/blob/35037b8baaa0a878a4bc9baf6ce683e2a43d9440' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("bartt", "image_bundle", "35037b8baaa0a878a4bc9baf6ce683e2a43d9440", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/bartt/image_bundle/tree/">Source</a></li>
            <li class=""><a href="http://github.com/bartt/image_bundle/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/bartt/image_bundle/network">Network</a></li>            
            <li class=""><a href="http://github.com/bartt/image_bundle/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/bartt/image_bundle">Wiki</a></li>
            <li class=""><a href="http://github.com/bartt/image_bundle/graphs">Graphs</a></li>                    
            <li class="active"><a href="/bartt/image_bundle">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/bartt">bartt</a> / <b><a href="http://github.com/bartt/image_bundle/tree">image_bundle</a></b>        
                <a id="namespaces_button" rel="bartt/image_bundle/blob/35037b8baaa0a878a4bc9baf6ce683e2a43d9440" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="bartt/image_bundle/blob/35037b8baaa0a878a4bc9baf6ce683e2a43d9440" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module ImageBundleHelper">
  <h1>Module: ImageBundleHelper</h1>
  <div class="section docstring">
  <p>
ImageBundleHelper adds view helper <tt>image_bundle</tt>. A helper which
bundles individual &lt;strong&gt;local images&lt;/strong&gt; into a single
CSS sprite thereby reducing the number of HTTP requests needed to render
the page.
</p>
<p>
{Yahoo&#8217;s Exceptional Performance
team}[http://developer.yahoo.com/performance/] found that the number of
HTTP requests has the biggest impact on page rendering speed. You can
inspect your site&#8217;s performance with the excellent Firefox add-on
<tt>YSlow</tt>[http://developer.yahoo.com/yslow/].
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="SPRITE_BASE_DIR-constant">SPRITE_BASE_DIR</dt>
      <dd>ENV['IMAGE_BUNDLE_SPRITE_BASE_DIR'] || 'sprites' if !defined?(SPRITE_BASE_DIR)</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_bundle-instance_method">#image_bundle</span><span class='args'>(css_class = nil, sprite_type = :png, content_target = :head, replacement_image = '/images/clear.gif', *args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <h3><tt>image_bundle</tt> takes 4 optional parameters:.</h3>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>image_bundle</h3>
</div><div id="image_bundle-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_bundle</span><span class='args'>(css_class = nil, sprite_type = :png, content_target = :head, replacement_image = '/images/clear.gif', *args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <h3><tt>image_bundle</tt> takes 4 optional parameters:</h3>
<table>
<tr><td valign="top"><tt>css_class</tt>:</td><td>When provided <tt>css_class</tt> restricts the bundling of images to
<tt>&lt;img&gt;</tt> tags of class <tt>css_class</tt>.

</td></tr>
<tr><td valign="top"><tt>sprite_type</tt>:</td><td>By default <tt>image_bundle</tt> generates a PNG master image. Set
sprite_type to the image type you&#8217;d like to use instead. E.g. GIF or
JPEG. Any type supported by <tt>ImageMagick</tt>[http://www.imagemagick.org/] can
be generated. All images being bundled will be converted to
<tt>sprite_type</tt>.

</td></tr>
<tr><td valign="top"><tt>content_target</tt>:</td><td>By default <tt>image_bundle</tt> produces content for <tt>:head</tt> using
<tt>content_for</tt>. Provide a different target if you prefer a different
name. Can be anything that can be converted to a symbol.

</td></tr>
<tr><td valign="top"><tt>replacement_image</tt>:</td><td>By default <tt>image_bundle</tt> replaces the <tt>src</tt> of bundled
images with <tt>/images/clear.gif</tt>. A 1x1 transparant image is included
with the <tt>image_bundle</tt> plugin. You&#8217;ll find it in the
<tt>images</tt> directory of the plugin. Provide <tt>replacement_image</tt>
if you prefer to use an image of different name.

</td></tr>
</table>
<h3><tt>image_bundle</tt> does 4 things:</h3>
<ol>
<li>It creates a master image of all bundled images, if it doesn&#8217;t
already exist.

</li>
<li>It rewrites the <tt>&lt;img&gt;</tt> tags of all images included in the
bundle to use <tt>replacement_image</tt> instead.

</li>
<li>Each included <tt>&lt;img&gt;</tt> gets a new class <em>added</em> to the
image&#8217;s <tt>class</tt> attribute. The new class name is unique to the
image&#8217;s size and content.

</li>
<li><tt>image_bundle</tt> creates matching CSS rules to display the portion of
the master image equivalent to the <tt>&lt;img&gt;</tt> tags&#8217;
original image. The CSS rules are collected in <tt>content_target</tt> and
can be used later with <tt>yield</tt>.

</li>
</ol>
<h3><tt>image_bundle</tt> uses 1 environment variable:</h3>
<p>
By default <tt>image_bundle</tt> creates sprites in a directory called
<tt>sprites</tt>. <tt>image_bundle</tt> doesn&#8217;t use <tt>images</tt>
in order to eliminate the potential of overwriting your images. Create
<tt>sprites</tt> in your <tt>public</tt> directory before using
<tt>image_bundle</tt>.
</p>
<p>
If you prefer to use a different directory set
<tt>ENV[&#8216;IMAGE_BUNDLE_SPRITE_BASE_DIR&#8217;]</tt> in your Rails
environment. IMAGE_BUNDLE_SPRITE_BASE_DIR is relative to your
</p>
<h1>public= directory.</h1>
<h3>Example usages</h3>
<p>
Instruct your controller to user <tt>image_bundle</tt>:
</p>
<pre class="code">
  <span class='helper identifier id'>helper</span><span class='colon op'>:</span> <span class='image_bundle identifier id'>image_bundle</span>
</pre>
<p>
Bundle all images included within <tt>image_bundle</tt>&#8217;s block.
</p>
<p>
&lt;% image_bundle do %&gt;
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='image_bundle identifier id'>image_bundle</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; can wrap any kind of content: HTML, JS, etc.&lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/images/auflag.gif&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/br&gt;
  &lt;p&gt;Bundled images don't need to be adjacent to one another either.&lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/images/nlflag.gif&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='regexp val'>/br&gt;
  &lt;img src=&quot;/i</span><span class='mages identifier id'>mages</span><span class='div op'>/</span><span class='frflag identifier id'>frflag</span><span class='dot token'>.</span><span class='gif identifier id'>gif</span><span class='string val'>&quot;/&gt;&lt;/br&gt;
</span></pre>
<p>
&lt;% end %&gt;
</p>
<p>
Bundle only images of class <tt>:bundle</tt>. <tt>image_bundle</tt> scales
resized images accordingly. It calculates the 2nd dimension if only one
dimension is given. Bundled images don&#8217;t have to be of the same size
either.
</p>
<p>
&lt;% image_bundle(:bundle) do %&gt;
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
    <span class='Some constant id'>Some</span> <span class='static identifier id'>static</span> <span class='text identifier id'>text</span> <span class='with identifier id'>with</span> <span class='lt op'>&lt;</span><span class='strong identifier id'>strong</span><span class='gt op'>&gt;</span><span class='HTML constant id'>HTML</span><span class='lt op'>&lt;</span><span class='regexp val'>/strong&gt; &lt;em&gt;markup&lt;/e</span><span class='m identifier id'>m</span><span class='gt op'>&gt;</span><span class='dot token'>.</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='Plus constant id'>Plus</span> <span class='a identifier id'>a</span> <span class='dynamic identifier id'>dynamic</span> <span class='date identifier id'>date</span><span class='colon op'>:</span> <span class='lt op'>&lt;</span><span class='string val'>%= Time.now %&gt;&lt;br/&gt;
    And an 16x16 &lt;img alt=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>&quot;bundle&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span> <span class='height identifier id'>height</span><span class='assign token'>=</span><span class='string val'>&quot;16&quot;</span> <span class='width identifier id'>width</span><span class='assign token'>=</span><span class='string val'>&quot;16&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='A constant id'>A</span> <span class='integer val'>6</span><span class='x? fid id'>x?</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>&quot;bundle&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span> <span class='height identifier id'>height</span><span class='assign token'>=</span><span class='string val'>&quot;6&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='A constant id'>A</span> <span class='question op'>?</span><span class='x6 identifier id'>x6</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>&quot;bundle&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span> <span class='width identifier id'>width</span><span class='assign token'>=</span><span class='string val'>&quot;6&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='An constant id'>An</span> <span class='question op'>?</span><span class='x? fid id'>x?</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>&quot;bundle&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/images/rails.png&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='A constant id'>A</span> <span class='integer val'>6</span><span class='x16 identifier id'>x16</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span> <span class='height identifier id'>height</span><span class='assign token'>=</span><span class='string val'>&quot;6&quot;</span> <span class='width identifier id'>width</span><span class='assign token'>=</span><span class='string val'>&quot;16&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span> <span class='not not kw'>not</span> <span class='of identifier id'>of</span> <span class='class class kw'>class</span> <span class='bundle identifier id'>bundle</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='My constant id'>My</span> <span class='integer val'>160</span><span class='x16 identifier id'>x16</span> <span class='multi identifier id'>multi</span> <span class='line identifier id'>line</span> <span class='example identifier id'>example</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>&quot;bundle&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span>
    <span class='height identifier id'>height</span><span class='assign token'>=</span><span class='string val'>&quot;160&quot;</span>
    <span class='width identifier id'>width</span><span class='assign token'>=</span><span class='string val'>&quot;16&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='Single constant id'>Single</span> <span class='quote identifier id'>quote</span> <span class='question op'>?</span><span class='x? fid id'>x?</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>'bundle'</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='Class constant id'>Class</span> <span class='string val'>'some bundle'</span> <span class='question op'>?</span><span class='x? fid id'>x?</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>'some bundle'</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='Src constant id'>Src</span> <span class='before identifier id'>before</span> <span class='class class kw'>class</span> <span class='integer val'>?x</span><span class='integer val'>160</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>'bundle'</span> <span class='width identifier id'>width</span><span class='assign token'>=</span><span class='string val'>&quot;160&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='Src constant id'>Src</span> <span class='before identifier id'>before</span> <span class='class class kw'>class</span> <span class='string val'>'some bundle'</span> <span class='question op'>?</span><span class='x? fid id'>x?</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>'some bundle'</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='Src constant id'>Src</span> <span class='assign token'>=</span> <span class='and and kw'>and</span> <span class='id identifier id'>id</span> <span class='question op'>?</span><span class='x? fid id'>x?</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/favicon.ico&quot;</span> <span class='id identifier id'>id</span><span class='assign token'>=</span><span class='string val'>&quot;bla&quot;</span> <span class='class class kw'>class</span> <span class='assign token'>=</span> <span class='string val'>'some bundle'</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
    <span class='Casper constant id'>Casper</span> <span class='question op'>?</span><span class='x? fid id'>x?</span> <span class='lt op'>&lt;</span><span class='img identifier id'>img</span> <span class='alt identifier id'>alt</span><span class='assign token'>=</span><span class='string val'>&quot;favicon&quot;</span> <span class='class class kw'>class</span><span class='assign token'>=</span><span class='string val'>&quot;bundle&quot;</span> <span class='src identifier id'>src</span><span class='assign token'>=</span><span class='string val'>&quot;/images/casper-1st-birthday.jpg&quot;</span><span class='div op'>/</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span><span class='div op'>/</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;
  &lt;p&gt;
    Some additional text.
  &lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
</pre>
<p>
&lt;% end %&gt;
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/image_bundle_helper.rb', line 121</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/bartt/image_bundle/blob/35037b8baaa0a878a4bc9baf6ce683e2a43d9440/lib/image_bundle_helper.rb#L121">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_bundle identifier id'>image_bundle</span><span class='lparen token'>(</span><span class='css_class identifier id'>css_class</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='sprite_type identifier id'>sprite_type</span> <span class='assign token'>=</span> <span class='symbol val'>:png</span><span class='comma token'>,</span> <span class='content_target identifier id'>content_target</span> <span class='assign token'>=</span> <span class='symbol val'>:head</span><span class='comma token'>,</span> <span class='replacement_image identifier id'>replacement_image</span> <span class='assign token'>=</span> <span class='string val'>'/images/clear.gif'</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='comment val'># Bind buffer to the ERB output buffer of the templates.</span>
    <span class='buffer identifier id'>buffer</span> <span class='assign token'>=</span> <span class='@output_buffer ivar id'>@output_buffer</span>

    <span class='comment val'># Mark the current position in the buffer</span>
    <span class='pos identifier id'>pos</span> <span class='assign token'>=</span> <span class='buffer identifier id'>buffer</span><span class='dot token'>.</span><span class='length identifier id'>length</span>

    <span class='comment val'># Render the block contained within the image_bundle tag. The</span>
    <span class='comment val'># rendered output is appended to buffer.</span>
    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>

    <span class='comment val'># Extract the output produced by the block.</span>
    <span class='block_output identifier id'>block_output</span> <span class='assign token'>=</span> <span class='buffer identifier id'>buffer</span><span class='lbrack token'>[</span><span class='pos identifier id'>pos</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
    <span class='buffer identifier id'>buffer</span><span class='lbrack token'>[</span><span class='pos identifier id'>pos</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>''</span>

    <span class='comment val'># Replace the img tags in the output with links to clear.gif and</span>
    <span class='comment val'># styling to use the master image created from the individual</span>
    <span class='comment val'># images.</span>
    <span class='images identifier id'>images</span> <span class='assign token'>=</span> <span class='Hash constant id'>Hash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='re identifier id'>re</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='css_class identifier id'>css_class</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='regexp val'>/(&lt;img\s*)([^&gt;]*?)(\s*\/?&gt;)/i</span><span class='m identifier id'>m</span> <span class='colon op'>:</span> <span class='dregexp node'>/(&lt;img\s*)([^&gt;]*?class\s*=\s*[&quot;']?[^&quot;']*?#{css_class}[^&quot;']*?[&quot;']?[^&gt;]*?)(\s*\/?&gt;)/i</span><span class='m identifier id'>m</span>
    <span class='block_rewrite identifier id'>block_rewrite</span> <span class='assign token'>=</span> <span class='string val'>''</span>
    <span class='while while kw'>while</span> <span class='pos identifier id'>pos</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='block_output identifier id'>block_output</span> <span class='match op'>=~</span> <span class='re identifier id'>re</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>

      <span class='comment val'># Store match data for later reference.</span>
      <span class='img_match identifier id'>img_match</span> <span class='assign token'>=</span> <span class='$~ gvar id'>$~</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
      <span class='img_tag identifier id'>img_tag</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span>
      <span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='$2 nth_ref id'>$2</span>
      <span class='img_closing_tag identifier id'>img_closing_tag</span> <span class='assign token'>=</span> <span class='$3 nth_ref id'>$3</span>

      <span class='comment val'># Remember where to continue searching from in the next</span>
      <span class='comment val'># iteration.</span>
      <span class='continue_pos identifier id'>continue_pos</span> <span class='assign token'>=</span> <span class='pos identifier id'>pos</span><span class='plus op'>+</span><span class='img_match identifier id'>img_match</span><span class='dot token'>.</span><span class='length identifier id'>length</span>

      <span class='comment val'># Write out the content before the start of the tag</span>
      <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='block_output identifier id'>block_output</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='dot2 op'>..</span><span class='pos identifier id'>pos</span><span class='minus op'>-</span><span class='integer val'>1</span><span class='rbrack token'>]</span>
      <span class='if if kw'>if</span> <span class='img_match identifier id'>img_match</span> <span class='match op'>=~</span> <span class='regexp val'>/src\=[&quot;']?https?:\/\//i</span> <span class='then then kw'>then</span>
        <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='img_match identifier id'>img_match</span>
      <span class='else else kw'>else</span>

        <span class='comment val'># Write out the opening portion of the image tag (&lt;img).</span>
        <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='img_tag identifier id'>img_tag</span>

        <span class='comment val'># Process all attributes of the img tag.</span>
        <span class='height_given identifier id'>height_given</span> <span class='assign token'>=</span> <span class='width_given identifier id'>width_given</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
        <span class='classes identifier id'>classes</span> <span class='assign token'>=</span> <span class='string val'>''</span>
        <span class='ping identifier id'>ping</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='ImageBundleHelper constant id'>ImageBundleHelper</span><span class='colon2 op'>::</span><span class='Image constant id'>Image</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
        <span class='while while kw'>while</span> <span class='pos identifier id'>pos</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='attributes identifier id'>attributes</span> <span class='match op'>=~</span> <span class='regexp val'>/([^ =]+?)\s*=\s*((&quot;?([^&quot;=]*?)&quot;)|('?([^'=]*?)'))/i</span><span class='m identifier id'>m</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
          <span class='attribute identifier id'>attribute</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span>
          <span class='value identifier id'>value</span> <span class='assign token'>=</span> <span class='$4 nth_ref id'>$4</span> <span class='orop op'>||</span> <span class='$6 nth_ref id'>$6</span>
          <span class='attr_continue_pos identifier id'>attr_continue_pos</span> <span class='assign token'>=</span> <span class='pos identifier id'>pos</span><span class='plus op'>+</span><span class='$~ gvar id'>$~</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
          <span class='case case kw'>case</span> <span class='attribute identifier id'>attribute</span>
          <span class='when when kw'>when</span> <span class='string val'>'src'</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span>
            <span class='comment val'># Read only the image's meta data not its image content.</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{RAILS_ROOT}/public#{ping.path}&quot;</span>
            <span class='image identifier id'>image</span> <span class='assign token'>=</span> <span class='colon3 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Image constant id'>Image</span><span class='dot token'>.</span><span class='ping identifier id'>ping</span><span class='lparen token'>(</span><span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='file identifier id'>file</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='assign token'>=</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='rows identifier id'>rows</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='assign token'>=</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='columns identifier id'>columns</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='assign token'>=</span> <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='filesize identifier id'>filesize</span>
            <span class='comment val'># Return all the memory associated with the image to the</span>
            <span class='comment val'># system.</span>
            <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='destroy! fid id'>destroy!</span>
            <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{attribute}=\&quot;#{replacement_image}\&quot; &quot;</span>
          <span class='when when kw'>when</span> <span class='string val'>'height'</span>
            <span class='height_given identifier id'>height_given</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='when when kw'>when</span> <span class='string val'>'width'</span>
            <span class='width_given identifier id'>width_given</span> <span class='assign token'>=</span> <span class='value identifier id'>value</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
          <span class='when when kw'>when</span> <span class='string val'>'class'</span>

            <span class='comment val'># Prepend a space for later concatenation with bndl class.</span>
            <span class='classes identifier id'>classes</span> <span class='assign token'>=</span> <span class='dstring node'>&quot; #{value}&quot;</span>
          <span class='else else kw'>else</span>

            <span class='comment val'># Pass through all other attributes</span>
            <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;#{attribute}=\&quot;#{value}\&quot; &quot;</span>
          <span class='end end kw'>end</span>
          <span class='attributes identifier id'>attributes</span> <span class='assign token'>=</span> <span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='attr_continue_pos identifier id'>attr_continue_pos</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
        <span class='end end kw'>end</span>

        <span class='comment val'># Calculate the height and width of the image based on the</span>
        <span class='comment val'># specified height/width and the source file's height and</span>
        <span class='comment val'># width. Scaling needs to happen when the sprite is created</span>
        <span class='if if kw'>if</span> <span class='height_given identifier id'>height_given</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span> <span class='then then kw'>then</span>
          <span class='if if kw'>if</span> <span class='width_given identifier id'>width_given</span> <span class='neq op'>!=</span> <span class='nil nil kw'>nil</span> <span class='then then kw'>then</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='width_given identifier id'>width_given</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='div op'>/</span> <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='assign token'>=</span> <span class='width_given identifier id'>width_given</span>
          <span class='end end kw'>end</span>
        <span class='else else kw'>else</span>
          <span class='if if kw'>if</span> <span class='width_given identifier id'>width_given</span> <span class='eq op'>==</span> <span class='nil nil kw'>nil</span> <span class='then then kw'>then</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='mult op'>*</span> <span class='lparen token'>(</span><span class='height_given identifier id'>height_given</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span> <span class='div op'>/</span> <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='assign token'>=</span> <span class='height_given identifier id'>height_given</span>
          <span class='else else kw'>else</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='width identifier id'>width</span> <span class='assign token'>=</span> <span class='width_given identifier id'>width_given</span>
            <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='height identifier id'>height</span> <span class='assign token'>=</span> <span class='height_given identifier id'>height_given</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>

        <span class='comment val'># Only add unique images and height/width combinations to the hash.</span>
        <span class='key identifier id'>key</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;bndl#{::Digest::MD5.hexdigest(&quot;#{ping.path}:#{ping.size}#{ping.height}:#{ping.width}&quot;).hash}&quot;</span>
        <span class='images identifier id'>images</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='ping identifier id'>ping</span>
        <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;class =\&quot;#{key}#{classes}\&quot; &quot;</span>
        <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;height=\&quot;#{ping.height}\&quot; &quot;</span>
        <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;width=\&quot;#{ping.width}\&quot; &quot;</span>
        <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='img_closing_tag identifier id'>img_closing_tag</span>
      <span class='end end kw'>end</span>
      <span class='block_output identifier id'>block_output</span> <span class='assign token'>=</span> <span class='block_output identifier id'>block_output</span><span class='lbrack token'>[</span><span class='continue_pos identifier id'>continue_pos</span><span class='dot2 op'>..</span><span class='integer val'>-1</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Create a sprite when there are source files and if it doesn't</span>
    <span class='comment val'># already exists.</span>
    <span class='if if kw'>if</span> <span class='images identifier id'>images</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='then then kw'>then</span>
      <span class='sprite_path identifier id'>sprite_path</span> <span class='assign token'>=</span> <span class='string val'>'/'</span> <span class='plus op'>+</span> <span class='SPRITE_BASE_DIR constant id'>SPRITE_BASE_DIR</span> <span class='plus op'>+</span> <span class='string val'>'/'</span> <span class='plus op'>+</span> <span class='colon3 op'>::</span><span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='images identifier id'>images</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='concat_names identifier id'>concat_names</span><span class='comma token'>,</span> <span class='key identifier id'>key</span><span class='bitor op'>|</span> <span class='concat_names identifier id'>concat_names</span> <span class='plus op'>+</span> <span class='string val'>'|'</span> <span class='plus op'>+</span> <span class='key identifier id'>key</span> <span class='end end kw'>end</span><span class='rparen token'>)</span> <span class='plus op'>+</span> <span class='dstring node'>&quot;.#{sprite_type}&quot;</span>
      <span class='sprite_file identifier id'>sprite_file</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{RAILS_ROOT}/public/#{sprite_path}&quot;</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='sprite_file identifier id'>sprite_file</span><span class='rparen token'>)</span> <span class='then then kw'>then</span>

        <span class='comment val'># Stack scaled source images left to right.</span>
        <span class='sprite identifier id'>sprite</span> <span class='assign token'>=</span> <span class='images identifier id'>images</span><span class='dot token'>.</span><span class='values identifier id'>values</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='colon3 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='ImageList constant id'>ImageList</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='image_list identifier id'>image_list</span><span class='comma token'>,</span> <span class='ping identifier id'>ping</span><span class='bitor op'>|</span>
          <span class='image_list identifier id'>image_list</span> <span class='lshft op'>&lt;&lt;</span> <span class='colon3 op'>::</span><span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='ImageList constant id'>ImageList</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='file identifier id'>file</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='scale identifier id'>scale</span><span class='lparen token'>(</span><span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='width identifier id'>width</span><span class='comma token'>,</span> <span class='ping identifier id'>ping</span><span class='dot token'>.</span><span class='height identifier id'>height</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span><span class='dot token'>.</span><span class='append identifier id'>append</span><span class='lparen token'>(</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
        <span class='sprite identifier id'>sprite</span><span class='dot token'>.</span><span class='write identifier id'>write</span><span class='lparen token'>(</span><span class='sprite_file identifier id'>sprite_file</span><span class='rparen token'>)</span>
        <span class='comment val'># Return all the memory associated with the image to the</span>
        <span class='comment val'># system.</span>
        <span class='sprite identifier id'>sprite</span><span class='dot token'>.</span><span class='destroy! fid id'>destroy!</span>
      <span class='end end kw'>end</span>

      <span class='comment val'># Construct style tag to be included in the header.</span>
      <span class='current_y identifier id'>current_y</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
      <span class='bundle_styles identifier id'>bundle_styles</span> <span class='assign token'>=</span> <span class='string val'>&quot;\n&lt;style type=\&quot;text/css\&quot;&gt;\n&quot;</span>
      <span class='bundle_styles identifier id'>bundle_styles</span> <span class='lshft op'>&lt;&lt;</span> <span class='images identifier id'>images</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='inject identifier id'>inject</span><span class='lparen token'>(</span><span class='string val'>''</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='styles identifier id'>styles</span><span class='comma token'>,</span> <span class='key identifier id'>key</span><span class='bitor op'>|</span>
        <span class='images identifier id'>images</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='x_pos identifier id'>x_pos</span> <span class='assign token'>=</span> <span class='current_y identifier id'>current_y</span>
        <span class='current_y identifier id'>current_y</span> <span class='opasgn op'>+=</span> <span class='images identifier id'>images</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='width identifier id'>width</span>
        <span class='styles identifier id'>styles</span> <span class='plus op'>+</span> <span class='dstring node'>&quot;.#{key} {\n   background-image:url(#{sprite_path});\n background-position: -#{images[key].x_pos}px 0px;\n}\n&quot;</span>
      <span class='end end kw'>end</span>
      <span class='bundle_styles identifier id'>bundle_styles</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot;&lt;/style&gt;\n&quot;</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># Write the remaining block output that follows the last img tag.</span>
    <span class='block_rewrite identifier id'>block_rewrite</span> <span class='lshft op'>&lt;&lt;</span> <span class='block_output identifier id'>block_output</span>
    <span class='buffer identifier id'>buffer</span> <span class='lshft op'>&lt;&lt;</span> <span class='block_rewrite identifier id'>block_rewrite</span> <span class='if if_mod kw'>if</span> <span class='block_rewrite identifier id'>block_rewrite</span>
    <span class='content_for identifier id'>content_for</span> <span class='content_target identifier id'>content_target</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='comma token'>,</span> <span class='bundle_styles identifier id'>bundle_styles</span> <span class='opasgn op'>||=</span> <span class='string val'>''</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>