<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>Squeegy's fleximage - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/Squeegy/commits/fleximage/master" rel="alternate" title="Recent Commits to fleximage:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("Squeegy", "fleximage", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("Squeegy", "fleximage", "730de771a17cdfda1f1ad6cb29d548f34691c637", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/Squeegy/fleximage/tree/">Source</a></li>
            <li class=""><a href="http://github.com/Squeegy/fleximage/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/Squeegy/fleximage/network">Network</a></li>            
            <li class=""><a href="http://github.com/Squeegy/fleximage/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/Squeegy/fleximage">Wiki</a></li>
            <li class=""><a href="http://github.com/Squeegy/fleximage/graphs">Graphs</a></li>                    
            <li class="active"><a href="/Squeegy/fleximage">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/Squeegy">Squeegy</a> / <b><a href="http://github.com/Squeegy/fleximage/tree">fleximage</a></b>        
                <a id="namespaces_button" rel="Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h2>Installation</h2>
<p>
Using git:
</p>
<pre class="code">
  <span class='git identifier id'>git</span> <span class='submodule identifier id'>submodule</span> <span class='add identifier id'>add</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='moser identifier id'>moser</span><span class='div op'>/</span><span class='fleximage_i18n identifier id'>fleximage_i18n</span><span class='dot token'>.</span><span class='git identifier id'>git</span> <span class='vendor identifier id'>vendor</span><span class='div op'>/</span><span class='plugins identifier id'>plugins</span><span class='div op'>/</span><span class='fleximage_i18n identifier id'>fleximage_i18n</span>
</pre>
<p>
or using:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='moser identifier id'>moser</span><span class='div op'>/</span><span class='fleximage_i18n identifier id'>fleximage_i18n</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<h1>Fleximage</h1>
<h2>Overview</h2>
<p>
Fleximage is a Rails plugin that tries to make image uploading and
rendering super easy.
</p>
<p>
There are 2 pieces involved in making Rails image handling easy.
</p>
<h3>1. Image Uploads</h3>
<p>
In this post Rails 2, resource-driven world, Fleximage believes that images
should belong directly to a record. So you simply tell your model class to
act as Fleximage, and your model effortlessly gains the ability to handle
file uploads.
</p>
<ul>
<li>Your model gains the ability to interface directly with a
<tt>file_field</tt> form, allowing uploads with zero extra controller or
model code.

</li>
<li>Accept uploads from a web address, pulling in the image from the internet
and saving it locally.

</li>
<li>Image presence validation with customizable form field error messages.

</li>
<li>Image format validation that will not allow the file to be uploaded unless
RMagick can parse it into useable image data.

</li>
<li>Image pre-processing to keep uploaded images under a certain size, or other
on-upload image processing tasks.

</li>
</ul>
<h3>2. Image Rendering</h3>
<p>
The other half of the problem comes from the need to send the uploaded
images back to the web browser. Most of the time, you need to display the
image in different sizes or formats in different places on your site. For
example, a product image in a store may need a square thumbnail image, a
medium image for its focus page, and a large image for an &quot;enlarge
this photo&quot; popup.
</p>
<p>
Fleximage uses a simple templating engine that allows you to re-render
images exactly how you need them. Using the same &quot;master image,&quot;
many images can be rendered from the same source. You can even go beyond
resizing; there is support for image overlays, text drawing, drop shadows,
borders and more. The rendering engine is flexible and extensible to
whatever your dynamic image needs are.
</p>
<ul>
<li>Renderer implemented as template engine, which fits in perfectly with Rails
2 RESTful style format-sensitive views.

</li>
<li>Does not need to have everything resized on upload allowing your site
layout the change later on, and all images will re-render themselves just
right with your new rendering templates.

</li>
<li>Support for special effects like text, image or logo overlays, borders and
shadows.

</li>
<li>Extensible by adding image operator classes which allow for reusable
snippets of direct RMagick code.

</li>
<li>Requires absolutely zero controller code.

</li>
</ul>
<h1>Getting Started</h1>
<h2>1. Installing the plugin</h2>
<p>
If running on rails edge:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='Squeegy constant id'>Squeegy</span><span class='div op'>/</span><span class='fleximage identifier id'>fleximage</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<p>
Otherwise, you have to do a manual install since Rails does not yet support
git. Download this file:
</p>
<p>
http://github.com/Squeegy/fleximage/tarball/master
</p>
<p>
Unzip, and place the root <tt>fleximage</tt> folder in your
<tt>railsapproot/vendor/plugins</tt> directory.
</p>
<h2>2. Activating your model</h2>
<p>
You need to let your model know it should be Fleximage-friendly. Lets say
you have a model for photos.
</p>
<pre class="code">
  <span class='comment val'># app/models/photo.rb</span>
  <span class='class class kw'>class</span> <span class='Photo constant id'>Photo</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='acts_as_fleximage identifier id'>acts_as_fleximage</span> <span class='symbol val'>:image_directory</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'public/images/uploaded_photos'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The :<tt>image_directory</tt> option tells the plugin where to store your
master images. This value is relative to your application root, and
doesn&#8217;t need to be in your public directory if you don&#8217;t want
it to be. This is where the source images will be that all your templates
start with.
</p>
<p>
There are many other options for your model. Refer to the
<tt>Fleximage::Model::ClassMethods</tt> class in the <tt>rdoc</tt> for more
information on these.
</p>
<h2>3. The upload form</h2>
<p>
Your users need a way to upload their images into your site. Here is how we
might render a form to create a photo record.
</p>
<pre class="code">
  <span class='comment val'># app/views/photos/new.html.erb</span>

  <span class='lt op'>&lt;</span><span class='string val'>% form_for </span><span class='@photo ivar id'>@photo</span><span class='comma token'>,</span> <span class='symbol val'>:html</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:multipart</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='string val'>%&gt;
    &lt;p&gt;</span>
      <span class='lt op'>&lt;</span><span class='b identifier id'>b</span><span class='gt op'>&gt;</span><span class='Name constant id'>Name</span><span class='lt op'>&lt;</span><span class='regexp val'>/b&gt;&lt;br /</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='string val'>%= f.text_field :name %&gt;
    &lt;/p&gt;

    &lt;p&gt;
      &lt;b&gt;Author&lt;/b&gt;&lt;br /&gt;
      &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='text_field identifier id'>text_field</span> <span class='symbol val'>:author</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;

    &lt;p&gt;
      &lt;b&gt;Upload Image&lt;/</span><span class='b identifier id'>b</span><span class='gt op'>&gt;</span><span class='lt op'>&lt;</span><span class='br identifier id'>br</span> <span class='regexp val'>/&gt;
      &lt;%= f.file_field :image_file %&gt;&lt;br /</span><span class='gt op'>&gt;</span>
      <span class='or or kw'>or</span> <span class='URL constant id'>URL</span><span class='colon op'>:</span> <span class='lt op'>&lt;</span><span class='string val'>%= f.text_field :image_file_url %&gt;
    &lt;/p&gt;

    &lt;p&gt;
      &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='submit identifier id'>submit</span> <span class='string val'>&quot;Create&quot;</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;
  &lt;% end %&gt;
</span></pre>
<p>
<b>NOTE</b>: The &quot;:html =&gt; { :multipart =&gt; true }&quot; is
<b>VERY</b> <b>IMPORTANT</b>. Without this snippet your browser will not
send binary data to the server. If things aren&#8217;t working, check to
make sure you have this in your form declaration.
</p>
<p>
The relevant bit of our form code is:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='b identifier id'>b</span><span class='gt op'>&gt;</span><span class='Upload constant id'>Upload</span> <span class='Image constant id'>Image</span><span class='lt op'>&lt;</span><span class='regexp val'>/b&gt;&lt;br /</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= f.file_field :image_file %&gt;&lt;br /&gt;
    or URL: &lt;%=</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='text_field identifier id'>text_field</span> <span class='symbol val'>:image_file_url</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='regexp val'>/p&gt;
</span></pre>
<p>
First there is a file upload field, mapping the the &quot;image_file&quot;
attribute of our model. When the user browses to a local file and uploads
it, the model is waiting to accept an uploaded file on this attribute and
will automatically open it and save it to disk for you.
</p>
<p>
Right along side the upload field is a simple text field, which maps to the
&quot;image_file_url&quot; property. Your model also listens for assignment
to this attribute to automatically fetch the contents of a URL and save it
locally as the master image.
</p>
<p>
You can have just one of these fields, or both. The model will know how to
do the right thing either way.
</p>
<p>
When the user submits the form, all you have to do is assign the form
contents to your object in standard Rails fashion, and the image is
uploaded and saved for you. Creating a new photo may look like this in your
controller:
</p>
<pre class="code">
  <span class='comment val'># app/controllers/photos_controller.rb</span>
  <span class='def def kw'>def</span> <span class='create identifier id'>create</span>
    <span class='@photo ivar id'>@photo</span> <span class='assign token'>=</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:photo</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='@photo ivar id'>@photo</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
      <span class='redirect_to identifier id'>redirect_to</span> <span class='photo_url identifier id'>photo_url</span><span class='lparen token'>(</span><span class='@photo ivar id'>@photo</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='flash identifier id'>flash</span><span class='lbrack token'>[</span><span class='symbol val'>:notice</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'Your photo did not pass validation!'</span>
      <span class='render identifier id'>render</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'new'</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<h2>4. Linking to the generated images</h2>
<p>
Rails 2 has amazing support for format driven responses. Given a photo
object, by default it would have an HTML view that describes information
about that photo. With Fleximage, the JPG or (GIF or PNG) view can be the
image data itself.
</p>
<p>
A photo HTML view may look like this:
</p>
<pre class="code">
  <span class='comment val'># app/views/photos/show.html.erb</span>
  <span class='comment val'># http://mysite.com/photos/123</span>

  <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='string val'>%= image_tag formatted_photo_path(@photo, :jpg) %&gt;
  &lt;/p&gt;
  &lt;p&gt;
    &lt;b&gt;Name:&lt;/b&gt;
    &lt;%=</span><span class='h identifier id'>h</span> <span class='@photo ivar id'>@photo</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='string val'>%&gt;
  &lt;/p&gt;</span>
  <span class='lt op'>&lt;</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
    <span class='lt op'>&lt;</span><span class='b identifier id'>b</span><span class='gt op'>&gt;</span><span class='Author constant id'>Author</span><span class='symbol val'>:&lt;</span><span class='regexp val'>/b&gt;
    &lt;%=h @photo.author %&gt;
  &lt;/</span><span class='p identifier id'>p</span><span class='gt op'>&gt;</span>
</pre>
<p>
That image tag uses a Rails route as its <tt>src</tt>. In this case, that
route corresponds to the <tt>.jpg</tt> format of the <tt>photo</tt>
resource, which would give us a URL like:
</p>
<pre class="code">
  <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/mysite.com/</span><span class='photos identifier id'>photos</span><span class='div op'>/</span><span class='float val'>123</span><span class='dot token'>.</span><span class='jpg identifier id'>jpg</span>
</pre>
<p>
This is the URL where the image will be.
</p>
<h2>5. Rendering the image</h2>
<p>
Now it&#8217;s time to actually create a template to render the image. This
happens through a special view with a .<tt>flexi</tt> extension. This view
template will pull out the master image for you, and send it to the browser
as binary data after your processing of it done.
</p>
<p>
The filename of the template should look like this:
<tt>action_name.jpg.flexi</tt>, where <tt>action_name</tt> is the
controller action that will render this view. The <tt>jpg</tt> tells the
controller to render this view when the <tt>jpg</tt> format is asked for.
The <tt>flexi</tt> tells Rails to render this view with the Fleximage
template engine, rather than <tt>erb</tt>, <tt>builder</tt> or other
template types.
</p>
<p>
The syntax of the view is pure ruby, but to process the image the view
needs to call <tt>operate</tt> on the instance of your model.
</p>
<p>
Here is the view to render a photo record at 320x240:
</p>
<pre class="code">
  <span class='comment val'># app/views/photos/show.jpg.flexi</span>
  <span class='comment val'># http://mysite.com/photos/123.jpg</span>
  <span class='@photo ivar id'>@photo</span><span class='dot token'>.</span><span class='operate identifier id'>operate</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='image identifier id'>image</span><span class='bitor op'>|</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='resize identifier id'>resize</span> <span class='string val'>'320x240'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Calling <tt>@photo.operate { |image| .. }</tt> prepares the model object
for image processing and provides a ruby object that will allow you to
perform image transformations. This example just resizes the image to
320x240, however many other operators are included.
</p>
<p>
Here is a .<tt>flexi</tt> template that will do much more:
</p>
<pre class="code">
  <span class='comment val'># app/views/show.jpg.flexi</span>
  <span class='@photo ivar id'>@photo</span><span class='dot token'>.</span><span class='operate identifier id'>operate</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='image identifier id'>image</span><span class='bitor op'>|</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='resize identifier id'>resize</span> <span class='string val'>'640x480'</span><span class='comma token'>,</span> <span class='symbol val'>:crop</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='image_overlay identifier id'>image_overlay</span> <span class='string val'>'public/images/logo.png'</span><span class='comma token'>,</span>
      <span class='symbol val'>:alignment</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:bottom_right</span><span class='comma token'>,</span>
      <span class='symbol val'>:offset</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'20x20'</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='border identifier id'>border</span> <span class='symbol val'>:size</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='symbol val'>:color</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'green'</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='text identifier id'>text</span> <span class='string val'>'I like Cheese'</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='unsharp_mask identifier id'>unsharp_mask</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='shadow identifier id'>shadow</span>
  <span class='end end kw'>end</span>
</pre>
<p>
This template will:
</p>
<ul>
<li>Resize the image to exactly 640x480, cropping off any extra.

</li>
<li>Add a logo 20 pixels form the lower right corner

</li>
<li>Add a green 10 pixel border

</li>
<li>Write &quot;I like Cheese&quot; in the upper left corder

</li>
<li>Sharpen the image

</li>
<li>Add a black drop shadow on a white background

</li>
</ul>
<p>
For more information on image operators, open up
<tt>vendor/plugins/fleximage/rdoc/index.html</tt> in your installed plugin
and check out the full for details about each operator:
</p>
<ul>
<li>Fleximage::Operator::Border

</li>
<li>Fleximage::Operator::Crop

</li>
<li>Fleximage::Operator::ImageOverlay

</li>
<li>Fleximage::Operator::Resize

</li>
<li>Fleximage::Operator::Shadow

</li>
<li>Fleximage::Operator::Text

</li>
<li>Fleximage::Operator::Trim

</li>
<li>Fleximage::Operator::UnsharpMask

</li>
</ul>
<h1>Other Useful Information</h1>
<h2>Image output format</h2>
<p>
You don&#8217;t want to render JPGs? That&#8217;s fine. Just link to the
format you want (:<tt>jpg</tt>, :<tt>gif</tt> or :<tt>png</tt>) and declare
the your template name to match and the image will be rendered properly.
For instance, this will render a <tt>gif</tt>.
</p>
<pre class="code">
  <span class='comment val'># app/views/photos/show.html.erb</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= image_tag photo_path(@photo, :gif) %&gt;

  # app/views/photos/show.gif.flexi
  @photo.operate do |image|
    @photo.resize '150x150', :crop =</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The Fleximage template engine will automatically detect the format that is
being asked for, and render the right type of image.
</p>
<h2>Converting/Upgrading your master image store</h2>
<p>
Are you upgrading your live app to the new file store creation date based
format? Did you start out with PNG image storage, and later realize you
need to store with the more space economic JPG instead? Not problem,
Fleximage provides some rake tasks to help you out.
</p>
<p>
Each conversion rake task requires that you tell it the class for which
that you are changing the file store. For example, if you want to change to
the new creation date based storage structure, for the class
<tt>Photo</tt>, you can run a rake task like this:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='fleximage identifier id'>fleximage</span><span class='symbol val'>:convert</span><span class='symbol val'>:to_nested</span> <span class='FLEXIMAGE_CLASS constant id'>FLEXIMAGE_CLASS</span><span class='assign token'>=</span><span class='Photo constant id'>Photo</span>
</pre>
<p>
Or if you want to run this on your production database
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='fleximage identifier id'>fleximage</span><span class='symbol val'>:convert</span><span class='symbol val'>:to_nested</span> <span class='FLEXIMAGE_CLASS constant id'>FLEXIMAGE_CLASS</span><span class='assign token'>=</span><span class='Photo constant id'>Photo</span> <span class='RAILS_ENV constant id'>RAILS_ENV</span><span class='assign token'>=</span><span class='production identifier id'>production</span>
</pre>
<p>
<b>IMPORTANT</b>: These tasks manipulate the source files that make up your
images. I take no responsibility if these rake tasks delete all your
images. <b>It is highly advised you back up you master image directory
before running any of these tasks on your production site.</b>
</p>
<p>
Here are all the conversion tasks:
</p>
<ul>
<li>fleximage:convert:to_nested : Converts your master image store from the
flat based path/to/images/123.png format to the creation date based format
path/to/images/2008/11/12/123.png based format. Use this task if you are
upgrading from an older version of Fleximage.

</li>
<li>fleximage:convert:to_flat : Converts your master image store from the
creation date based path/to/images/2008/11/12/123.png format to the flat
format path/to/images/123.png format. Note this will leave the date based
directories in place, but they will be empty and can be easily manually
deleted.

</li>
<li>fleximage:convert:to_jpg : Converts all your stored master images from PNG
format to JPG format. This will compress your previously lossless master
images.

</li>
<li>fleximage:convert:to_png : Converts all your stored master images from JPG
format to PNG format.

</li>
</ul>
<p>
After you run any of these tasks, make sure to update your model&#8217;s
class accessors <tt>use_creation_date_based_directories</tt> and
<tt>image_storage_format</tt> to reflect the state of your image store.
Otherwise, the plugin will not find you master images for rendering.
</p>
<hr size="4"></hr><p>
Copyright &#169; 2008 Alex Wayne beautifulpixel.com, released under the MIT
license. Special Thanks to Chris Vannoy for intelligent code review,
suggestions and contributions to making this plugin awesome.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>