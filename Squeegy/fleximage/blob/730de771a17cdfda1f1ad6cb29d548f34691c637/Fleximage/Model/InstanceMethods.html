<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>Squeegy's fleximage - Module: Fleximage::Model::InstanceMethods - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/Squeegy/commits/fleximage/master" rel="alternate" title="Recent Commits to fleximage:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("Squeegy", "fleximage", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("Squeegy", "fleximage", "730de771a17cdfda1f1ad6cb29d548f34691c637", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/Squeegy/fleximage/tree/">Source</a></li>
            <li class=""><a href="http://github.com/Squeegy/fleximage/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/Squeegy/fleximage/network">Network</a></li>            
            <li class=""><a href="http://github.com/Squeegy/fleximage/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/Squeegy/fleximage">Wiki</a></li>
            <li class=""><a href="http://github.com/Squeegy/fleximage/graphs">Graphs</a></li>                    
            <li class="active"><a href="/Squeegy/fleximage">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/Squeegy">Squeegy</a> / <b><a href="http://github.com/Squeegy/fleximage/tree">fleximage</a></b>        
                <a id="namespaces_button" rel="Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Fleximage_Model_InstanceMethods">
  <h1>Module: Fleximage::Model::InstanceMethods</h1>
  <div class="section docstring">
  <p>
Provides methods that every model instance that acts_as_fleximage needs.
</p>

</div><div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#delete_image_file-instance_method">#delete_image_file</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Delete the image file for this record.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#directory_path-instance_method">#directory_path</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the path to the master image file for this record.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#file_path-instance_method">#file_path</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the path to the master image file for this record.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#has_image-3F-instance_method">#has_image?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return true if this record has an image.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#has_saved_image-3F-instance_method">#has_saved_image?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_file-3D-instance_method">#image_file=</span><span class='args'>(file)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets the image file for this record to an uploaded file.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_file_base64-3D-instance_method">#image_file_base64=</span><span class='args'>(data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Set the image for this record by reading in a file as a base64 encoded
string.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_file_string-3D-instance_method">#image_file_string=</span><span class='args'>(data)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Set the image for this record by reading in file data as a string.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_file_temp-3D-instance_method">#image_file_temp=</span><span class='args'>(file_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets the uploaded image to the name of a file in RAILS_ROOT/tmp that was
just uploaded.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_file_url-instance_method">#image_file_url</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return the @image_file_url that was previously assigned.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#image_file_url-3D-instance_method">#image_file_url=</span><span class='args'>(file_url)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Assign the image via a URL, which will make the plugin go and fetch the
image at the provided URL.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#load_image-instance_method">#load_image</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Load the image from disk/DB, or return the cached and potentially processed
output image.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#operate-instance_method">#operate</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Call from a .
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#output_image-instance_method">#output_image</span><span class='args'>(options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Convert the current output image to a jpg, and return it in binary form.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#validate_image-instance_method">#validate_image</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Execute image presence and validity validations.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>delete_image_file</h3>
</div><div id="delete_image_file-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>delete_image_file</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Delete the image file for this record. This is automatically ran after this
record gets destroyed, but you can call it manually if you want to remove
the image from the record.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 477</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L477">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">477
478
479
480
481
482
483
484
485
486
487
488
489</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='delete_image_file identifier id'>delete_image_file</span>
  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='has_store? fid id'>has_store?</span>
  
  <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='db_store? fid id'>db_store?</span>
    <span class='update_attribute identifier id'>update_attribute</span> <span class='symbol val'>:image_file_data</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span> <span class='unless unless_mod kw'>unless</span> <span class='frozen? fid id'>frozen?</span>
  <span class='else else kw'>else</span>
    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='clear_magic_attributes identifier id'>clear_magic_attributes</span>
  
  <span class='self self kw'>self</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>directory_path</h3>
</div><div id="directory_path-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>directory_path</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the path to the master image file for this record.
</p>
<pre class="code">
  <span class='@some_image ivar id'>@some_image</span><span class='dot token'>.</span><span class='directory_path identifier id'>directory_path</span> <span class='comment val'>#=&gt; /var/www/myapp/uploaded_images</span>
</pre>
<p>
If this model has a created_at field, it will use a directory structure
based on the creation date, to prevent hitting the OS imposed limit on the
number files in a directory.
</p>
<pre class="code">
  <span class='@some_image ivar id'>@some_image</span><span class='dot token'>.</span><span class='directory_path identifier id'>directory_path</span> <span class='comment val'>#=&gt; /var/www/myapp/uploaded_images/2008/3/30</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 247</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L247">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">247
248
249
250
251
252
253
254
255
256
257
258
259
260</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='directory_path identifier id'>directory_path</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>'No image directory was defined, cannot generate path'</span> <span class='unless unless_mod kw'>unless</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='image_directory identifier id'>image_directory</span>
  
  <span class='comment val'># base directory</span>
  <span class='directory identifier id'>directory</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{RAILS_ROOT}/#{self.class.image_directory}&quot;</span>
  
  <span class='comment val'># specific creation date based directory suffix.</span>
  <span class='creation identifier id'>creation</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='lbrack token'>[</span><span class='symbol val'>:created_at</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='self self kw'>self</span><span class='lbrack token'>[</span><span class='symbol val'>:created_on</span><span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='use_creation_date_based_directories identifier id'>use_creation_date_based_directories</span> <span class='andop op'>&amp;&amp;</span> <span class='creation identifier id'>creation</span> 
    <span class='dstring node'>&quot;#{directory}/#{creation.year}/#{creation.month}/#{creation.day}&quot;</span>
  <span class='else else kw'>else</span>
    <span class='directory identifier id'>directory</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>file_path</h3>
</div><div id="file_path-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>file_path</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the path to the master image file for this record.
</p>
<pre class="code">
  <span class='@some_image ivar id'>@some_image</span><span class='dot token'>.</span><span class='file_path identifier id'>file_path</span> <span class='comment val'>#=&gt; /var/www/myapp/uploaded_images/123.png</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 265</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L265">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">265
266
267</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='file_path identifier id'>file_path</span>
  <span class='dstring node'>&quot;#{directory_path}/#{id}.#{self.class.image_storage_format}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>has_image?</h3>
</div><div id="has_image-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>has_image?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return true if this record has an image.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 401</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L401">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">401
402
403</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='has_image? fid id'>has_image?</span>
  <span class='@uploaded_image ivar id'>@uploaded_image</span> <span class='orop op'>||</span> <span class='@output_image ivar id'>@output_image</span> <span class='orop op'>||</span> <span class='has_saved_image? fid id'>has_saved_image?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>has_saved_image?</h3>
</div><div id="has_saved_image-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>has_saved_image?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 405</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L405">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">405
406
407</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='has_saved_image? fid id'>has_saved_image?</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='db_store? fid id'>db_store?</span> <span class='integer val'>? </span><span class='notop op'>!</span><span class='notop op'>!</span><span class='image_file_data identifier id'>image_file_data</span> <span class='colon op'>:</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_file=</h3>
</div><div id="image_file-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_file=</span><span class='args'>(file)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets the image file for this record to an uploaded file. This can be called
directly, or passively like from an ActiveRecord mass assignment.
</p>
<p>
Rails will automatically call this method for you, in most of the
situations you would expect it to.
</p>
<pre class="code">
  <span class='comment val'># via mass assignment, the most common form you'll probably use</span>
  <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:photo</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:photo</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='comment val'># via explicit assignment hash</span>
  <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:image_file</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:photo</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:image_file</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:image_file</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:photo</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:image_file</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>

  <span class='comment val'># Direct Assignment, usually not needed</span>
  <span class='photo identifier id'>photo</span> <span class='assign token'>=</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='photo identifier id'>photo</span><span class='dot token'>.</span><span class='image_file identifier id'>image_file</span> <span class='assign token'>=</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:photo</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:image_file</span><span class='rbrack token'>]</span>

  <span class='comment val'># via an association proxy</span>
  <span class='p identifier id'>p</span> <span class='assign token'>=</span> <span class='Product constant id'>Product</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='images identifier id'>images</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:photo</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 291</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L291">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_file= identifier id'>image_file=</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='image_file_exists identifier id'>image_file_exists</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
    
    <span class='comment val'># Create RMagick Image object from uploaded file</span>
    <span class='if if kw'>if</span> <span class='file identifier id'>file</span><span class='dot token'>.</span><span class='path identifier id'>path</span>
      <span class='@uploaded_image ivar id'>@uploaded_image</span> <span class='assign token'>=</span> <span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Image constant id'>Image</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='dot token'>.</span><span class='path identifier id'>path</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='else else kw'>else</span>
      <span class='@uploaded_image ivar id'>@uploaded_image</span> <span class='assign token'>=</span> <span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Image constant id'>Image</span><span class='dot token'>.</span><span class='from_blob identifier id'>from_blob</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='end end kw'>end</span>
    
    <span class='comment val'># Sanitize image data</span>
    <span class='@uploaded_image ivar id'>@uploaded_image</span><span class='dot token'>.</span><span class='colorspace identifier id'>colorspace</span>  <span class='assign token'>=</span> <span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='RGBColorspace constant id'>RGBColorspace</span>
    <span class='@uploaded_image ivar id'>@uploaded_image</span><span class='dot token'>.</span><span class='density identifier id'>density</span>     <span class='assign token'>=</span> <span class='string val'>'72'</span>
    
    <span class='comment val'># Save meta data to database</span>
    <span class='set_magic_attributes identifier id'>set_magic_attributes</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span>
    
    <span class='comment val'># Success, make sure everything is valid</span>
    <span class='@invalid_image ivar id'>@invalid_image</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='save_temp_image identifier id'>save_temp_image</span><span class='lparen token'>(</span><span class='file identifier id'>file</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='@dont_save_temp ivar id'>@dont_save_temp</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='ImageMagickError constant id'>ImageMagickError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='error_strings identifier id'>error_strings</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span>
    <span class='string val'>'Improper image header'</span><span class='comma token'>,</span>
    <span class='string val'>'no decode delegate for this image format'</span><span class='comma token'>,</span>
    <span class='string val'>'UnableToOpenBlob'</span>
  <span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='dregexp node'>/#{error_strings.join('|')}/</span>
    <span class='@invalid_image ivar id'>@invalid_image</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='e identifier id'>e</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_file_base64=</h3>
</div><div id="image_file_base64-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_file_base64=</span><span class='args'>(data)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Set the image for this record by reading in a file as a base64 encoded
string.
</p>
<pre class="code">
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='Base64 constant id'>Base64</span><span class='dot token'>.</span><span class='encode64 identifier id'>encode64</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='string val'>'my_image_file.jpg'</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='photo identifier id'>photo</span> <span class='assign token'>=</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='integer val'>123</span><span class='rparen token'>)</span>
  <span class='photo identifier id'>photo</span><span class='dot token'>.</span><span class='image_file_base64 identifier id'>image_file_base64</span> <span class='assign token'>=</span> <span class='data identifier id'>data</span>
  <span class='photo identifier id'>photo</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 372</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L372">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">372
373
374</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_file_base64= identifier id'>image_file_base64=</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='image_file_string identifier id'>image_file_string</span> <span class='assign token'>=</span> <span class='Base64 constant id'>Base64</span><span class='dot token'>.</span><span class='decode64 identifier id'>decode64</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_file_string=</h3>
</div><div id="image_file_string-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_file_string=</span><span class='args'>(data)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Set the image for this record by reading in file data as a string.
</p>
<pre class="code">
  <span class='data identifier id'>data</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='string val'>'my_image_file.jpg'</span><span class='rparen token'>)</span>
  <span class='photo identifier id'>photo</span> <span class='assign token'>=</span> <span class='Photo constant id'>Photo</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='integer val'>123</span><span class='rparen token'>)</span>
  <span class='photo identifier id'>photo</span><span class='dot token'>.</span><span class='image_file_string identifier id'>image_file_string</span> <span class='assign token'>=</span> <span class='data identifier id'>data</span>
  <span class='photo identifier id'>photo</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 362</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L362">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">362
363
364</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_file_string= identifier id'>image_file_string=</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='image_file identifier id'>image_file</span> <span class='assign token'>=</span> <span class='StringIO constant id'>StringIO</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='data identifier id'>data</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_file_temp=</h3>
</div><div id="image_file_temp-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_file_temp=</span><span class='args'>(file_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets the uploaded image to the name of a file in RAILS_ROOT/tmp that was
just uploaded. Use as a hidden field in your forms to keep an uploaded
image when validation fails and the form needs to be redisplayed
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 379</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L379">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">379
380
381
382
383
384
385
386
387
388
389
390
391
392</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_file_temp= identifier id'>image_file_temp=</span><span class='lparen token'>(</span><span class='file_name identifier id'>file_name</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='@uploaded_image ivar id'>@uploaded_image</span> <span class='andop op'>&amp;&amp;</span> <span class='file_name identifier id'>file_name</span> <span class='andop op'>&amp;&amp;</span> <span class='file_name identifier id'>file_name</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
    <span class='@image_file_temp ivar id'>@image_file_temp</span> <span class='assign token'>=</span> <span class='file_name identifier id'>file_name</span>
    <span class='file_path identifier id'>file_path</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{RAILS_ROOT}/tmp/fleximage/#{file_name}&quot;</span>
    
    <span class='@dont_save_temp ivar id'>@dont_save_temp</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
    <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='rparen token'>)</span>
      <span class='File constant id'>File</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='comma token'>,</span> <span class='string val'>'rb'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
        <span class='self self kw'>self</span><span class='dot token'>.</span><span class='image_file identifier id'>image_file</span> <span class='assign token'>=</span> <span class='f identifier id'>f</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
    <span class='@dont_save_temp ivar id'>@dont_save_temp</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_file_url</h3>
</div><div id="image_file_url-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_file_url</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return the @image_file_url that was previously assigned. This is not saved
in the database, and only exists to make forms happy.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 396</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L396">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">396
397
398</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_file_url identifier id'>image_file_url</span>
  <span class='@image_file_url ivar id'>@image_file_url</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>image_file_url=</h3>
</div><div id="image_file_url-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>image_file_url=</span><span class='args'>(file_url)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Assign the image via a URL, which will make the plugin go and fetch the
image at the provided URL. The image will be stored locally as a master
image for that record from then on. This is intended to be used along side
the image upload to allow people the choice to upload from their local
machine, or pull from the internet.
</p>
<pre class="code">
  <span class='@photo ivar id'>@photo</span><span class='dot token'>.</span><span class='image_file_url identifier id'>image_file_url</span> <span class='assign token'>=</span> <span class='string val'>'http://foo.com/bar.jpg'</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 332</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L332">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='image_file_url= identifier id'>image_file_url=</span><span class='lparen token'>(</span><span class='file_url identifier id'>file_url</span><span class='rparen token'>)</span>
  <span class='@image_file_url ivar id'>@image_file_url</span> <span class='assign token'>=</span> <span class='file_url identifier id'>file_url</span>
  <span class='if if kw'>if</span> <span class='file_url identifier id'>file_url</span> <span class='match op'>=~</span> <span class='regexp val'>%r{^(https?|ftp)://}</span>
    <span class='file identifier id'>file</span> <span class='assign token'>=</span> <span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='file_url identifier id'>file_url</span><span class='rparen token'>)</span>
    
    <span class='comment val'># Force a URL based file to have an original_filename</span>
    <span class='eval identifier id'>eval</span> <span class='string val'>&quot;def file.original_filename\n\&quot;\#{file_url}\&quot;\nend\n&quot;</span>
    
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='image_file identifier id'>image_file</span> <span class='assign token'>=</span> <span class='file identifier id'>file</span>
    
  <span class='elsif elsif kw'>elsif</span> <span class='file_url identifier id'>file_url</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='comment val'># Nothing to process, move along</span>
    
  <span class='else else kw'>else</span>
    <span class='comment val'># invalid URL, raise invalid image validation error</span>
    <span class='@invalid_image ivar id'>@invalid_image</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>load_image</h3>
</div><div id="load_image-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>load_image</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Load the image from disk/DB, or return the cached and potentially processed
output image.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 428</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L428">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='load_image identifier id'>load_image</span> 
  <span class='@output_image ivar id'>@output_image</span> <span class='opasgn op'>||=</span> <span class='@uploaded_image ivar id'>@uploaded_image</span>
  
  <span class='comment val'># Return the current image if we have loaded it already</span>
  <span class='return return kw'>return</span> <span class='@output_image ivar id'>@output_image</span> <span class='if if_mod kw'>if</span> <span class='@output_image ivar id'>@output_image</span>
  
  <span class='comment val'># Load the image from disk</span>
  <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='has_store? fid id'>has_store?</span>
    <span class='if if kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='db_store? fid id'>db_store?</span>
      <span class='if if kw'>if</span> <span class='image_file_data identifier id'>image_file_data</span> <span class='andop op'>&amp;&amp;</span> <span class='image_file_data identifier id'>image_file_data</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
        <span class='comment val'># Load the image from the database column</span>
        <span class='@output_image ivar id'>@output_image</span> <span class='assign token'>=</span> <span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Image constant id'>Image</span><span class='dot token'>.</span><span class='from_blob identifier id'>from_blob</span><span class='lparen token'>(</span><span class='image_file_data identifier id'>image_file_data</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
      <span class='else else kw'>else</span>
        <span class='master_image_not_found identifier id'>master_image_not_found</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># Load the image from the disk</span>
      <span class='@output_image ivar id'>@output_image</span> <span class='assign token'>=</span> <span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='Image constant id'>Image</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='file_path identifier id'>file_path</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='master_image_not_found identifier id'>master_image_not_found</span>
  <span class='end end kw'>end</span>
  
<span class='rescue rescue kw'>rescue</span> <span class='Magick constant id'>Magick</span><span class='colon2 op'>::</span><span class='ImageMagickError constant id'>ImageMagickError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='if if kw'>if</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/unable to open (file|image)/</span>
    <span class='master_image_not_found identifier id'>master_image_not_found</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='e identifier id'>e</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>operate</h3>
</div><div id="operate-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>operate</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Call from a .flexi view template. This enables the rendering of operators
so that you can transform your image. This is the method that is the
foundation of .flexi views. Every view should consist of image manipulation
code inside a block passed to this method.
</p>
<pre class="code">
  <span class='comment val'># app/views/photos/thumb.jpg.flexi</span>
  <span class='@photo ivar id'>@photo</span><span class='dot token'>.</span><span class='operate identifier id'>operate</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='image identifier id'>image</span><span class='bitor op'>|</span>
    <span class='image identifier id'>image</span><span class='dot token'>.</span><span class='resize identifier id'>resize</span> <span class='string val'>'320x240'</span>
  <span class='end end kw'>end</span>
</pre>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 418</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L418">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">418
419
420
421
422
423
424</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='operate identifier id'>operate</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='returning identifier id'>returning</span> <span class='self self kw'>self</span> <span class='do do kw'>do</span>
    <span class='proxy identifier id'>proxy</span> <span class='assign token'>=</span> <span class='ImageProxy constant id'>ImageProxy</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='load_image identifier id'>load_image</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rparen token'>)</span>
    <span class='block identifier id'>block</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='proxy identifier id'>proxy</span><span class='rparen token'>)</span>
    <span class='@output_image ivar id'>@output_image</span> <span class='assign token'>=</span> <span class='proxy identifier id'>proxy</span><span class='dot token'>.</span><span class='image identifier id'>image</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>output_image</h3>
</div><div id="output_image-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>output_image</span><span class='args'>(options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Convert the current output image to a jpg, and return it in binary form.
options support a :format key that can be :jpg, :gif or :png
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 461</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L461">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">461
462
463
464
465
466
467
468
469
470
471
472
473</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='output_image identifier id'>output_image</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='comment val'>#:nodoc:</span>
  <span class='format identifier id'>format</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:format</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='symbol val'>:jpg</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='dot token'>.</span><span class='upcase identifier id'>upcase</span>
  <span class='@output_image ivar id'>@output_image</span><span class='dot token'>.</span><span class='format identifier id'>format</span> <span class='assign token'>=</span> <span class='format identifier id'>format</span>
  <span class='@output_image ivar id'>@output_image</span><span class='dot token'>.</span><span class='strip! fid id'>strip!</span>
  <span class='if if kw'>if</span> <span class='format identifier id'>format</span> <span class='assign token'>=</span> <span class='string val'>'JPG'</span>
    <span class='quality identifier id'>quality</span> <span class='assign token'>=</span> <span class='@jpg_compression_quality ivar id'>@jpg_compression_quality</span> <span class='orop op'>||</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='output_image_jpg_quality identifier id'>output_image_jpg_quality</span>
    <span class='@output_image ivar id'>@output_image</span><span class='dot token'>.</span><span class='to_blob identifier id'>to_blob</span> <span class='lbrace token'>{</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='quality identifier id'>quality</span> <span class='assign token'>=</span> <span class='quality identifier id'>quality</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='@output_image ivar id'>@output_image</span><span class='dot token'>.</span><span class='to_blob identifier id'>to_blob</span>
  <span class='end end kw'>end</span>
<span class='ensure ensure kw'>ensure</span>
  <span class='GC constant id'>GC</span><span class='dot token'>.</span><span class='start identifier id'>start</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>validate_image</h3>
</div><div id="validate_image-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>validate_image</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Execute image presence and validity validations.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/fleximage/model.rb', line 492</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/Squeegy/fleximage/blob/730de771a17cdfda1f1ad6cb29d548f34691c637/lib/fleximage/model.rb#L492">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='validate_image identifier id'>validate_image</span> 
  <span class='field_name identifier id'>field_name</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='@image_file_url ivar id'>@image_file_url</span> <span class='andop op'>&amp;&amp;</span> <span class='@image_file_url ivar id'>@image_file_url</span><span class='dot token'>.</span><span class='any? fid id'>any?</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='symbol val'>:image_file_url</span> <span class='colon op'>:</span> <span class='symbol val'>:image_file</span>
  
  <span class='comment val'># Could not read the file as an image</span>
  <span class='if if kw'>if</span> <span class='@invalid_image ivar id'>@invalid_image</span>
    <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='field_name identifier id'>field_name</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='invalid_image_message identifier id'>invalid_image_message</span>
  
  <span class='comment val'># no image uploaded and one is required</span>
  <span class='elsif elsif kw'>elsif</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='require_image identifier id'>require_image</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='has_image? fid id'>has_image?</span>
    <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='field_name identifier id'>field_name</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='missing_image_message identifier id'>missing_image_message</span>
  
  <span class='comment val'># Image does not meet minimum size</span>
  <span class='elsif elsif kw'>elsif</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='validates_image_size identifier id'>validates_image_size</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@uploaded_image ivar id'>@uploaded_image</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='x identifier id'>x</span><span class='comma token'>,</span> <span class='y identifier id'>y</span> <span class='assign token'>=</span> <span class='Fleximage constant id'>Fleximage</span><span class='colon2 op'>::</span><span class='Operator constant id'>Operator</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='size_to_xy identifier id'>size_to_xy</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='validates_image_size identifier id'>validates_image_size</span><span class='rparen token'>)</span>
    
    <span class='if if kw'>if</span> <span class='@uploaded_image ivar id'>@uploaded_image</span><span class='dot token'>.</span><span class='columns identifier id'>columns</span> <span class='lt op'>&lt;</span> <span class='x identifier id'>x</span> <span class='orop op'>||</span> <span class='@uploaded_image ivar id'>@uploaded_image</span><span class='dot token'>.</span><span class='rows identifier id'>rows</span> <span class='lt op'>&lt;</span> <span class='y identifier id'>y</span>
      <span class='errors identifier id'>errors</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='field_name identifier id'>field_name</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='image_too_small_message identifier id'>image_too_small_message</span>
    <span class='end end kw'>end</span>
    
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>