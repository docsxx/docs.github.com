<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Module: Flagging::ClassMethods</title>
  </head>
  <body>
    <div id="content">
      <div class="section module Flagging_ClassMethods">
  <h1 class="title">Module: Flagging::ClassMethods</h1>
  <div class="section constants">
  
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_all_non_pending-instance_method' title='#find_all_non_pending'>#find_all_non_pending</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_all_public_non_pending-instance_method' title='#find_all_public_non_pending'>#find_all_public_non_pending</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_disputed-instance_method' title='#find_disputed'>#find_disputed</a></span><span class='args'>(basket_id)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_flagged-instance_method' title='#find_flagged'>#find_flagged</a></span><span class='args'>(basket_id)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#find_non_pending-instance_method' title='#find_non_pending'>#find_non_pending</a></span><span class='args'>(type = :all, conditions_string = String.new)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>find_all_non_pending</h3>
</div><div id="find_all_non_pending-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_all_non_pending</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


343
344
345</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/flagging.rb', line 343</span>

<span class='def def kw'>def</span> <span class='find_all_non_pending identifier id'>find_all_non_pending</span>
  <span class='find_non_pending identifier id'>find_non_pending</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_all_public_non_pending</h3>
</div><div id="find_all_public_non_pending-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_all_public_non_pending</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


339
340
341</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/flagging.rb', line 339</span>

<span class='def def kw'>def</span> <span class='find_all_public_non_pending identifier id'>find_all_public_non_pending</span>
  <span class='find_non_pending identifier id'>find_non_pending</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='PUBLIC_CONDITIONS constant id'>PUBLIC_CONDITIONS</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_disputed</h3>
</div><div id="find_disputed-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_disputed</span><span class='args'>(basket_id)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


327
328
329</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/flagging.rb', line 327</span>

<span class='def def kw'>def</span> <span class='find_disputed identifier id'>find_disputed</span><span class='lparen token'>(</span><span class='basket_id identifier id'>basket_id</span><span class='rparen token'>)</span>
  <span class='find_flagged identifier id'>find_flagged</span><span class='lparen token'>(</span><span class='basket_id identifier id'>basket_id</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='select identifier id'>select</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:disputed_version?</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_flagged</h3>
</div><div id="find_flagged-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_flagged</span><span class='args'>(basket_id)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/flagging.rb', line 292</span>

<span class='def def kw'>def</span> <span class='find_flagged identifier id'>find_flagged</span><span class='lparen token'>(</span><span class='basket_id identifier id'>basket_id</span><span class='rparen token'>)</span>
  <span class='not_applicable_tags identifier id'>not_applicable_tags</span> <span class='assign token'>=</span> <span class='Tag constant id'>Tag</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span>
                                 <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;name in (?)&quot;</span><span class='comma token'>,</span>
                                                 <span class='lbrack token'>[</span><span class='REVIEWED_FLAG constant id'>REVIEWED_FLAG</span><span class='comma token'>,</span> <span class='BLANK_FLAG constant id'>BLANK_FLAG</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='table_name identifier id'>table_name</span> <span class='assign token'>=</span> <span class='base_class identifier id'>base_class</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='tableize identifier id'>tableize</span>
  <span class='versions_table_name identifier id'>versions_table_name</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='versioned_table_name identifier id'>versioned_table_name</span>
  <span class='class_fk identifier id'>class_fk</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='versioned_foreign_key identifier id'>versioned_foreign_key</span>
  <span class='full_version_class_name identifier id'>full_version_class_name</span> <span class='assign token'>=</span> <span class='base_class identifier id'>base_class</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='plus op'>+</span> <span class='string val'>'::'</span> <span class='plus op'>+</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='versioned_class_name identifier id'>versioned_class_name</span>

  <span class='select identifier id'>select</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{table_name}.id as id, #{versions_table_name}.title as title, #{versions_table_name}.description as description, #{versions_table_name}.version as version, #{versions_table_name}.id as version_id, #{versions_table_name}.basket_id, #{table_name}.basket_id, taggings.created_at, taggings.message, tags.name AS flag, taggings.created_at as flagged_at, taggings.message&quot;</span>
  <span class='select identifier id'>select</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;, #{versions_table_name}.private as private&quot;</span> <span class='if if_mod kw'>if</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='columns identifier id'>columns</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='c identifier id'>c</span><span class='dot token'>.</span><span class='name identifier id'>name</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;private&quot;</span><span class='rparen token'>)</span>
  
  <span class='joins identifier id'>joins</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;JOIN #{table_name} ON #{table_name}.id = #{versions_table_name}.#{class_fk} AND #{table_name}.basket_id = #{versions_table_name}.basket_id &quot;</span>
  <span class='joins identifier id'>joins</span> <span class='opasgn op'>+=</span> <span class='dstring node'>&quot;JOIN taggings ON taggings.taggable_id = #{versions_table_name}.id AND taggings.taggable_type = '#{full_version_class_name}' AND taggings.context = \&quot;flags\&quot;&quot;</span>
  <span class='joins identifier id'>joins</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot;JOIN tags ON tags.id = taggings.tag_id&quot;</span>

  <span class='find_options identifier id'>find_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:select</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='select identifier id'>select</span><span class='comma token'>,</span>
    <span class='symbol val'>:joins</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='joins identifier id'>joins</span><span class='comma token'>,</span>
    <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'flagged_at DESC'</span><span class='comma token'>,</span>
    <span class='symbol val'>:from</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='versions_table_name identifier id'>versions_table_name</span> <span class='rbrace token'>}</span>
  
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='not_applicable_tags identifier id'>not_applicable_tags</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
    <span class='find_options identifier id'>find_options</span><span class='lbrack token'>[</span><span class='symbol val'>:conditions</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='string val'>&quot;tags.id NOT IN (:not_applicable_tags)&quot;</span><span class='comma token'>,</span>
                                 <span class='lbrace token'>{</span> <span class='symbol val'>:not_applicable_tags</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='not_applicable_tags identifier id'>not_applicable_tags</span> <span class='rbrace token'>}</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Don't automatically load belongs_to conditions, i.e. documents.basket_id = parent_id</span>
  <span class='comment val'># This causes the query to only return one result per item, but we want all versions</span>
  <span class='comment val'># that match, not just the first.</span>
  <span class='with_exclusive_scope identifier id'>with_exclusive_scope</span><span class='lparen token'>(</span><span class='symbol val'>:find</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='dstring node'>&quot;#{versions_table_name}.basket_id = ?&quot;</span><span class='comma token'>,</span> <span class='basket_id identifier id'>basket_id</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
    <span class='find_by_sql identifier id'>find_by_sql</span><span class='lparen token'>(</span><span class='construct_finder_sql identifier id'>construct_finder_sql</span><span class='lparen token'>(</span><span class='find_options identifier id'>find_options</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_non_pending</h3>
</div><div id="find_non_pending-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_non_pending</span><span class='args'>(type = :all, conditions_string = String.new)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


331
332
333
334
335
336
337</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/flagging.rb', line 331</span>

<span class='def def kw'>def</span> <span class='find_non_pending identifier id'>find_non_pending</span><span class='lparen token'>(</span><span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='conditions_string identifier id'>conditions_string</span> <span class='assign token'>=</span> <span class='String constant id'>String</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='conditions_string identifier id'>conditions_string</span><span class='dot token'>.</span><span class='blank? fid id'>blank?</span>
    <span class='conditions_string identifier id'>conditions_string</span> <span class='assign token'>=</span> <span class='string val'>&quot;title != :pending_title&quot;</span>
    <span class='conditions_string identifier id'>conditions_string</span> <span class='opasgn op'>+=</span> <span class='string val'>&quot; or description is not null&quot;</span> <span class='if if_mod kw'>if</span> <span class='name identifier id'>name</span> <span class='neq op'>!=</span> <span class='string val'>'Comment'</span>
  <span class='end end kw'>end</span>
  <span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='conditions_string identifier id'>conditions_string</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='symbol val'>:pending_title</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='BLANK_TITLE constant id'>BLANK_TITLE</span> <span class='rbrace token'>}</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>