<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>nkallen's cache-money - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/nkallen/commits/cache-money/master" rel="alternate" title="Recent Commits to cache-money:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("nkallen", "cache-money", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='nkallen/cache-money/blob/a65333a921b36e280d4449017c7fb11cf1847ee2' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='nkallen/cache-money/blob/a65333a921b36e280d4449017c7fb11cf1847ee2' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("nkallen", "cache-money", "a65333a921b36e280d4449017c7fb11cf1847ee2", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/nkallen/cache-money/tree/">Source</a></li>
            <li class=""><a href="http://github.com/nkallen/cache-money/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/nkallen/cache-money/network">Network</a></li>            
            <li class=""><a href="http://github.com/nkallen/cache-money/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/nkallen/cache-money">Wiki</a></li>
            <li class=""><a href="http://github.com/nkallen/cache-money/graphs">Graphs</a></li>                    
            <li class="active"><a href="/nkallen/cache-money">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/nkallen">nkallen</a> / <b><a href="http://github.com/nkallen/cache-money/tree">cache-money</a></b>        
                <a id="namespaces_button" rel="nkallen/cache-money/blob/a65333a921b36e280d4449017c7fb11cf1847ee2" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="nkallen/cache-money/blob/a65333a921b36e280d4449017c7fb11cf1847ee2" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
## What is Cache Money ##
</p>
<p>
Cache Money is a write-through and read-through caching library for
ActiveRecord.
</p>
<p>
Read-Through: Queries like `User.find(:all, :conditions =&gt; &#8230;)`
will first look in Memcached and then look in the database for the results
of that query. If there is a cache miss, it will populate the cache.
</p>
<p>
Write-Through: As objects are created, updated, and deleted, all of the
caches are <b>automatically</b> kept up-to-date and coherent.
</p>
<p>
## Howto ## ### What kinds of queries are supported? ###
</p>
<p>
Many styles of ActiveRecord usage are supported:
</p>
<pre class="code">
 <span class='mult op'>*</span> <span class='xstring val'>`User.find`</span>
 <span class='mult op'>*</span> <span class='xstring val'>`User.find_by_id`</span>
 <span class='mult op'>*</span> <span class='xstring val'>`User.find(:conditions =&gt; {:id =&gt; ...})`</span>
 <span class='mult op'>*</span> <span class='xstring val'>`User.find(:conditions =&gt; ['id = ?', ...])`</span>
 <span class='mult op'>*</span> <span class='xstring val'>`User.find(:conditions =&gt; 'id = ...')`</span>
 <span class='mult op'>*</span> <span class='xstring val'>`User.find(:conditions =&gt; 'users.id = ...')`</span>
</pre>
<p>
As you can see, the `find_by_`, `find_all_by`, hash, array, and string
forms are all supported.
</p>
<p>
Queries with joins/includes are unsupported at this time. In general, any
query involving just equality (=) and conjunction (AND) is supported by
`Cache Money`. Disjunction (OR) and inequality (!=, &lt;=, etc.) are not
typically materialized in a hash table style index and are unsupported at
this time.
</p>
<p>
Queries with limits and offsets are supported. In general, however, if you
are running queries with limits and offsets you are dealing with large
datasets. It&#8217;s more performant to place a limit on the size of the
`Cache Money` index like so:
</p>
<pre class="code">
    <span class='DirectMessage constant id'>DirectMessage</span><span class='dot token'>.</span><span class='index identifier id'>index</span> <span class='symbol val'>:user_id</span><span class='comma token'>,</span> <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1000</span>
</pre>
<p>
In this example, only queries whose limit and offset are less than 1000
will use the cache.
</p>
<p>
### Multiple indices are supported ###
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='index identifier id'>index</span> <span class='symbol val'>:screen_name</span>
      <span class='index identifier id'>index</span> <span class='symbol val'>:email</span>
    <span class='end end kw'>end</span>
</pre>
<p>
#### `with_scope` support ####
</p>
<p>
`with_scope` and the like (`named_scope`, `has_many`, `belongs_to`, etc.)
are fully supported. For example, `user.devices.find(1)` will first look in
the cache if there is an index like this:
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='Device constant id'>Device</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
     <span class='index identifier id'>index</span> <span class='lbrack token'>[</span><span class='symbol val'>:user_id</span><span class='comma token'>,</span> <span class='symbol val'>:id</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
</pre>
<p>
### Ordered indices ###
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='Message constant id'>Message</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='index identifier id'>index</span> <span class='symbol val'>:sender_id</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:desc</span>
    <span class='end end kw'>end</span>
</pre>
<p>
The order declaration will ensure that the index is kept in the correctly
sorted order. Only queries with order clauses compatible with the ordering
in the index will use the cache:
</p>
<pre class="code">
 <span class='mult op'>*</span> <span class='xstring val'>`Message.find(:all, :conditions =&gt; {:sender_id =&gt; ...}, :order =&gt; 'id DESC')`</span><span class='dot token'>.</span>
</pre>
<p>
Order clauses can be specified in many formats (&quot;`messages`.id
DESC&quot;, &quot;`messages`.`id` DESC&quot;, and so forth), but ordering
MUST be on the primary key column.
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='Message constant id'>Message</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='index identifier id'>index</span> <span class='symbol val'>:sender_id</span><span class='comma token'>,</span> <span class='symbol val'>:order</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:asc</span>
    <span class='end end kw'>end</span>
</pre>
<p>
will support queries like:
</p>
<pre class="code">
 <span class='mult op'>*</span> <span class='xstring val'>`Message.find(:all, :conditions =&gt; {:sender_id =&gt; ...}, :order =&gt; 'id ASC')`</span>
 <span class='mult op'>*</span> <span class='xstring val'>`Message.find(:all, :conditions =&gt; {:sender_id =&gt; ...})`</span>
</pre>
<p>
Note that ascending order is implicit in index declarations (i.e., not
specifying an order is the same as ascending). This is also true of queries
(order is not nondeterministic as in MySQL).
</p>
<p>
### Window indices ###
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='Message constant id'>Message</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='index identifier id'>index</span> <span class='symbol val'>:sender_id</span><span class='comma token'>,</span> <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>500</span><span class='comma token'>,</span> <span class='symbol val'>:buffer</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>100</span>
    <span class='end end kw'>end</span>
</pre>
<p>
With a limit attribute, indices will only store limit + buffer in the
cache. As new objects are created the index will be truncated, and as
objects are destroyed, the cache will be refreshed if it has fewer than the
limit of items. The buffer is how many &quot;extra&quot; items to keep
around in case of deletes.
</p>
<p>
It is particularly in conjunction with window indices that the `:order`
attribute is useful.
</p>
<p>
### Calculations ###
</p>
<p>
`Message.count(:all, :conditions =&gt; <tt>=&amp;gt; &amp;#8230;</tt>)` will
use the cache rather than the database. This happens for &quot;free&quot;
&#8212; no additional declarations are necessary.
</p>
<p>
### Version Numbers ###
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='version identifier id'>version</span> <span class='integer val'>7</span>
      <span class='index identifier id'>index</span> <span class='dot3 op'>...</span>
    <span class='end end kw'>end</span>
</pre>
<p>
You can increment the version number as you migrate your schema. Be careful
how you deploy changes like this as during deployment independent mongrels
may be using different versions of your code. Indices can be corrupted if
you do not plan accordingly.
</p>
<p>
### Transactions ###
</p>
<p>
Because of the parallel requests writing to the same indices, race
conditions are possible. We have created a pessimistic
&quot;transactional&quot; memcache client to handle the locking issues.
</p>
<p>
The memcache client library has been enhanced to simulate transactions.
</p>
<pre class="code">
    <span class='$cache gvar id'>$cache</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
      <span class='$cache gvar id'>$cache</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='key1 identifier id'>key1</span><span class='comma token'>,</span> <span class='value1 identifier id'>value1</span><span class='rparen token'>)</span>
      <span class='$cache gvar id'>$cache</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='key2 identifier id'>key2</span><span class='comma token'>,</span> <span class='value2 identifier id'>value2</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
</pre>
<p>
The writes to the cache are buffered until the transaction is committed.
Reads within the transaction read from the buffer. The writes are performed
as if atomically, by acquiring locks, performing writes, and finally
releasing locks. Special attention has been paid to ensure that deadlocks
cannot occur and that the critical region (the duration of lock ownership)
is as small as possible.
</p>
<p>
Writes are not truly atomic as reads do not pay attention to locks.
Therefore, it is possible to peak inside a partially committed transaction.
This is a performance compromise, since acquiring a lock for a read was
deemed too expensive. Again, the critical region is as small as possible,
reducing the frequency of such &quot;peeks&quot;.
</p>
<p>
#### Rollbacks ####
</p>
<pre class="code">
    <span class='$cache gvar id'>$cache</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
      <span class='$cache gvar id'>$cache</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='k identifier id'>k</span><span class='comma token'>,</span> <span class='v identifier id'>v</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span>
    <span class='end end kw'>end</span>
</pre>
<p>
Because transactions buffer writes, an exception in a transaction ensures
that the writes are cleanly rolled-back (i.e., never committed to
memcache). Database transactions are wrapped in memcache transactions,
ensuring a database rollback also rolls back cache transactions.
</p>
<p>
Nested transactions are fully supported, with partial rollback and
(apparent) partial commitment (this is simulated with nested buffers).
</p>
<p>
### Mocks ###
</p>
<p>
For your unit tests, it is faster to use a Memcached mock than the real
deal. Just place this in your initializer for your test environment:
</p>
<pre class="code">
    <span class='$memcache gvar id'>$memcache</span> <span class='assign token'>=</span> <span class='Cash constant id'>Cash</span><span class='colon2 op'>::</span><span class='Mock constant id'>Mock</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
</pre>
<p>
### Locks ###
</p>
<p>
In most cases locks are unnecessary; the transactional Memcached client
will take care locks for you automatically and guarantees that no deadlocks
can occur. But for very complex distributed transactions, shared locks are
necessary.
</p>
<pre class="code">
    <span class='$lock gvar id'>$lock</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span><span class='lparen token'>(</span><span class='string val'>'lock_name'</span><span class='rparen token'>)</span> <span class='do do kw'>do</span>
      <span class='$memcache gvar id'>$memcache</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='string val'>&quot;key&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;value&quot;</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
</pre>
<p>
### Local Cache ###
</p>
<p>
Sometimes your code will request the same cache key twice in one request.
You can avoid a round trip to the Memcached server by using a local,
per-request cache. Add this to your initializer:
</p>
<pre class="code">
  <span class='$local gvar id'>$local</span> <span class='assign token'>=</span> <span class='Cash constant id'>Cash</span><span class='colon2 op'>::</span><span class='Local constant id'>Local</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='$memcache gvar id'>$memcache</span><span class='rparen token'>)</span>
  <span class='$cache gvar id'>$cache</span> <span class='assign token'>=</span> <span class='Cash constant id'>Cash</span><span class='colon2 op'>::</span><span class='Transactional constant id'>Transactional</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='$local gvar id'>$local</span><span class='comma token'>,</span> <span class='$lock gvar id'>$lock</span><span class='rparen token'>)</span>
</pre>
<p>
## Installation ##
</p>
<p>
#### Step 0: Install MemCached
</p>
<p>
#### Step 1: Get the GEM ####
</p>
<pre class="code">
    <span class='string val'>% gem </span><span class='sources identifier id'>sources</span> <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
    % sudo gem install nkallen-cache-money
</span></pre>
<p>
#### Step 2: Configure MemCached.
</p>
<p>
Place a YAML file in `config/memcached.yml` with contents like:
</p>
<pre class="code">
    <span class='test identifier id'>test</span><span class='colon op'>:</span>
      <span class='ttl identifier id'>ttl</span><span class='colon op'>:</span> <span class='integer val'>604800</span>
      <span class='namespace identifier id'>namespace</span><span class='colon op'>:</span> <span class='dot3 op'>...</span>
      <span class='sessions identifier id'>sessions</span><span class='colon op'>:</span> <span class='false false kw'>false</span>
      <span class='debug identifier id'>debug</span><span class='colon op'>:</span> <span class='false false kw'>false</span>
      <span class='servers identifier id'>servers</span><span class='colon op'>:</span> <span class='localhost identifier id'>localhost</span><span class='symbol val'>:11211</span>

    <span class='development identifier id'>development</span><span class='colon op'>:</span>
       <span class='dot3 op'>...</span><span class='dot token'>.</span>
</pre>
<p>
#### Step 3: `config/initializers/cache_money.rb` ####
</p>
<p>
Place this in `config/initializers/cache_money.rb`
</p>
<pre class="code">
    <span class='require identifier id'>require</span> <span class='string val'>'cache_money'</span>

    <span class='config identifier id'>config</span> <span class='assign token'>=</span> <span class='YAML constant id'>YAML</span><span class='dot token'>.</span><span class='load identifier id'>load</span><span class='lparen token'>(</span><span class='IO constant id'>IO</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='RAILS_ROOT constant id'>RAILS_ROOT</span><span class='comma token'>,</span> <span class='string val'>&quot;config&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;memcached.yml&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='RAILS_ENV constant id'>RAILS_ENV</span><span class='rbrack token'>]</span>
    <span class='$memcache gvar id'>$memcache</span> <span class='assign token'>=</span> <span class='MemCache constant id'>MemCache</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='config identifier id'>config</span><span class='rparen token'>)</span>
    <span class='$memcache gvar id'>$memcache</span><span class='dot token'>.</span><span class='servers identifier id'>servers</span> <span class='assign token'>=</span> <span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='string val'>'servers'</span><span class='rbrack token'>]</span>

    <span class='$local gvar id'>$local</span> <span class='assign token'>=</span> <span class='Cash constant id'>Cash</span><span class='colon2 op'>::</span><span class='Local constant id'>Local</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='$memcache gvar id'>$memcache</span><span class='rparen token'>)</span>
    <span class='$lock gvar id'>$lock</span> <span class='assign token'>=</span> <span class='Cash constant id'>Cash</span><span class='colon2 op'>::</span><span class='Lock constant id'>Lock</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='$memcache gvar id'>$memcache</span><span class='rparen token'>)</span>
    <span class='$cache gvar id'>$cache</span> <span class='assign token'>=</span> <span class='Cash constant id'>Cash</span><span class='colon2 op'>::</span><span class='Transactional constant id'>Transactional</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='$local gvar id'>$local</span><span class='comma token'>,</span> <span class='$lock gvar id'>$lock</span><span class='rparen token'>)</span>

    <span class='class class kw'>class</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='is_cached identifier id'>is_cached</span> <span class='symbol val'>:repository</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='$cache gvar id'>$cache</span>
    <span class='end end kw'>end</span>
</pre>
<p>
#### Step 2: Add indices to your ActiveRecord models ####
</p>
<p>
Queries like `User.find(1)` will use the cache automatically. For more
complex queries you must add indices on the attributes that you will query
on. For example, a query like `User.find(:all, :conditions =&gt; <tt>=&amp;gt; &amp;#8216;bob&amp;#8217;</tt>)` will require an index like:
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='index identifier id'>index</span> <span class='symbol val'>:name</span>
    <span class='end end kw'>end</span>
</pre>
<p>
For queries on multiple attributes, combination indexes are necessary. For
example, `User.find(:all, :conditions =&gt; {:name =&gt; &#8216;bob&#8217;,
:age =&gt; 26})`
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='index identifier id'>index</span> <span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='comma token'>,</span> <span class='symbol val'>:age</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
</pre>
<p>
## Version ##
</p>
<p>
WARNING: This is currently a RELEASE CANDIDATE. A version of this code is
in production use at Twitter but the extraction and refactoring process may
have introduced bugs and/or performance problems. There are no known major
defects at this point, but still.
</p>
<p>
## Acknowledgments ##
</p>
<p>
Thanks to
</p>
<pre class="code">
 <span class='mult op'>*</span> <span class='Twitter constant id'>Twitter</span> <span class='for for kw'>for</span> <span class='commissioning identifier id'>commissioning</span> <span class='the identifier id'>the</span> <span class='development identifier id'>development</span> <span class='of identifier id'>of</span> <span class='this identifier id'>this</span> <span class='library identifier id'>library</span> <span class='and and kw'>and</span> <span class='supporting identifier id'>supporting</span> <span class='the identifier id'>the</span> <span class='effort identifier id'>effort</span> <span class='to identifier id'>to</span> <span class='open identifier id'>open</span><span class='minus op'>-</span><span class='source identifier id'>source</span> <span class='it identifier id'>it</span><span class='dot token'>.</span>
 <span class='mult op'>*</span> <span class='Sam constant id'>Sam</span> <span class='Luckenbill constant id'>Luckenbill</span> <span class='for for kw'>for</span> <span class='pairing identifier id'>pairing</span> <span class='with identifier id'>with</span> <span class='me identifier id'>me</span> <span class='on identifier id'>on</span> <span class='most identifier id'>most</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='hard identifier id'>hard</span> <span class='stuff identifier id'>stuff</span><span class='dot token'>.</span>
 <span class='mult op'>*</span> <span class='Matthew constant id'>Matthew</span> <span class='and and kw'>and</span> <span class='Chris constant id'>Chris</span> <span class='for for kw'>for</span> <span class='pairing identifier id'>pairing</span> <span class='a identifier id'>a</span> <span class='few identifier id'>few</span> <span class='days identifier id'>days</span><span class='comma token'>,</span> <span class='offering identifier id'>offering</span> <span class='useful identifier id'>useful</span> <span class='feedback identifier id'>feedback</span> <span class='on identifier id'>on</span> <span class='the identifier id'>the</span> <span class='readability identifier id'>readability</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='code identifier id'>code</span><span class='comma token'>,</span> <span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='initial identifier id'>initial</span> <span class='implementation identifier id'>implementation</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='Memcached constant id'>Memcached</span> <span class='mock identifier id'>mock</span><span class='dot token'>.</span>
 <span class='mult op'>*</span> <span class='Evan constant id'>Evan</span> <span class='Weaver constant id'>Weaver</span> <span class='for for kw'>for</span> <span class='helping identifier id'>helping</span> <span class='to identifier id'>to</span> <span class='reason identifier id'>reason</span><span class='minus op'>-</span><span class='through identifier id'>through</span> <span class='software identifier id'>software</span> <span class='and and kw'>and</span> <span class='testing identifier id'>testing</span> <span class='strategies identifier id'>strategies</span> <span class='to identifier id'>to</span> <span class='deal identifier id'>deal</span> <span class='with identifier id'>with</span> <span class='replication identifier id'>replication</span> <span class='lag identifier id'>lag</span><span class='comma token'>,</span> <span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='initial identifier id'>initial</span> <span class='implementation identifier id'>implementation</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='Memcached constant id'>Memcached</span> <span class='lock identifier id'>lock</span><span class='dot token'>.</span>
</pre>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>