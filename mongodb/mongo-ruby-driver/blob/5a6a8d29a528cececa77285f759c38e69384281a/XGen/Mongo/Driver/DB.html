<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>mongodb's mongo-ruby-driver - Class: XGen::Mongo::Driver::DB - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/mongodb/commits/mongo-ruby-driver/master" rel="alternate" title="Recent Commits to mongo-ruby-driver:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("mongodb", "mongo-ruby-driver", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("mongodb", "mongo-ruby-driver", "5a6a8d29a528cececa77285f759c38e69384281a", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/tree/">Source</a></li>
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/network">Network</a></li>            
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/mongodb/mongo-ruby-driver">Wiki</a></li>
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/graphs">Graphs</a></li>                    
            <li class="active"><a href="/mongodb/mongo-ruby-driver">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/mongodb">mongodb</a> / <b><a href="http://github.com/mongodb/mongo-ruby-driver/tree">mongo-ruby-driver</a></b>        
                <a id="namespaces_button" rel="mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class XGen_Mongo_Driver_DB">
  <h1>Class: XGen::Mongo::Driver::DB</h1>
  <div class="section docstring">
  <p>
A Mongo database.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">host</td>
          <td class="readwrite">
            [<span id='host-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Host to which we are currently connected.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">name</td>
          <td class="readwrite">
            [<span id='name-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The name of the database.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">nodes</td>
          <td class="readwrite">
            [<span id='nodes-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
An array of [host, port] pairs.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">pk_factory</td>
          <td class="readwrite">
            [<span id='pk_factory-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
A primary key factory object (or <tt>nil</tt>).
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">port</td>
          <td class="readwrite">
            [<span id='port-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Port to which we are currently connected.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">socket</td>
          <td class="readwrite">
            [<span id='socket-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The database&#8217;s socket.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">strict</td>
          <td class="readwrite">
            [R<span id='strict=-instance_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Strict mode enforces collection existence checks.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="SYSTEM_COMMAND_COLLECTION-constant">SYSTEM_COMMAND_COLLECTION</dt>
      <dd>&quot;$cmd&quot;</dd>
    
      <dt id="SYSTEM_INDEX_COLLECTION-constant">SYSTEM_INDEX_COLLECTION</dt>
      <dd>&quot;system.indexes&quot;</dd>
    
      <dt id="SYSTEM_NAMESPACE_COLLECTION-constant">SYSTEM_NAMESPACE_COLLECTION</dt>
      <dd>&quot;system.namespaces&quot;</dd>
    
      <dt id="SYSTEM_PROFILE_COLLECTION-constant">SYSTEM_PROFILE_COLLECTION</dt>
      <dd>&quot;system.profile&quot;</dd>
    
      <dt id="SYSTEM_USER_COLLECTION-constant">SYSTEM_USER_COLLECTION</dt>
      <dd>&quot;system.users&quot;</dd>
    
  </dl>
</div>

</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(db_name, nodes, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Instances of DB are normally obtained by calling Mongo#db.
</p>
<table>
<tr><td valign="top">db_name :</td><td>The database name

</td></tr>
<tr><td valign="top">nodes :</td><td>An array of [host, port] pairs. See Mongo#new, which offers a more flexible
way of defining nodes.

</td></tr>
<tr><td valign="top">options :</td><td>A hash of options.

</td></tr>
</table>
<p>
Options:
</p>
<table>
<tr><td valign="top">:strict :</td><td>If true, collections must exist to be accessed and must not exist to be
created. See #collection and #create_collection.

</td></tr>
<tr><td valign="top">:pk :</td><td>A primary key factory object that must respond to :create_pk, which should
take a hash and return a hash which merges the original hash with any
primary key fields the factory wishes to inject. (NOTE: if the object
already has a primary key, the factory should not inject a new key; this
means that the object is being used in a repsert but it already exists.)
The idea here is that when ever a record is inserted, the :pk
object&#8217;s <tt>create_pk</tt> method will be called and the new hash
returned will be inserted.

</td></tr>
<tr><td valign="top">:slave_ok :</td><td>Only used if <tt>nodes</tt> contains only one host/port. If false, when
connecting to that host/port we check to see if the server is the master.
If it is not, an error is thrown.

</td></tr>
<tr><td valign="top">:auto_reconnect :</td><td>If the connection gets closed (for example, we have a server pair and saw
the &quot;not master&quot; error, which closes the connection), then
automatically try to reconnect to the master or to the single server we
have been given. Defaults to <tt>false</tt>.

</td></tr>
</table>
<p>
When a DB object first connects to a pair, it will find the master instance
and connect to that one. On socket error or if we recieve a &quot;not
master&quot; error, we again find the master of the pair.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 116</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L116">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">116
117
118
119
120
121
122
123
124
125
126
127</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='db_name identifier id'>db_name</span><span class='comma token'>,</span> <span class='nodes identifier id'>nodes</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Invalid DB name \&quot;#{db_name}\&quot; (must be non-nil, non-zero-length, and can not contain \&quot;.\&quot;)&quot;</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='db_name identifier id'>db_name</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='db_name identifier id'>db_name</span> <span class='andop op'>&amp;&amp;</span> <span class='db_name identifier id'>db_name</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span> <span class='andop op'>&amp;&amp;</span> <span class='db_name identifier id'>db_name</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='string val'>&quot;.&quot;</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='@nodes ivar id'>@nodes</span> <span class='assign token'>=</span> <span class='db_name identifier id'>db_name</span><span class='comma token'>,</span> <span class='nodes identifier id'>nodes</span>
  <span class='@strict ivar id'>@strict</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:strict</span><span class='rbrack token'>]</span>
  <span class='@pk_factory ivar id'>@pk_factory</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:pk</span><span class='rbrack token'>]</span>
  <span class='@slave_ok ivar id'>@slave_ok</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:slave_ok</span><span class='rbrack token'>]</span> <span class='andop op'>&amp;&amp;</span> <span class='@nodes ivar id'>@nodes</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='comment val'># only OK if one node</span>
  <span class='@auto_reconnect ivar id'>@auto_reconnect</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:auto_reconnect</span><span class='rbrack token'>]</span>
  <span class='@semaphore ivar id'>@semaphore</span> <span class='assign token'>=</span> <span class='Object constant id'>Object</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span> <span class='Mutex_m constant id'>Mutex_m</span>
  <span class='@socket ivar id'>@socket</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='connect_to_master identifier id'>connect_to_master</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#admin-instance_method">#admin</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#authenticate-instance_method">#authenticate</span><span class='args'>(username, password)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if <tt>username</tt> has <tt>password</tt> in
<tt>SYSTEM_USER_COLLECTION</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#auto_reconnect-3F-instance_method">#auto_reconnect?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#close-instance_method">#close</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Close the connection to the database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#collection-instance_method">#collection</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return a collection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#collection_names-instance_method">#collection_names</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns an array of collection names.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#collections_info-instance_method">#collections_info</span><span class='args'>(coll_name = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns a cursor over query result hashes.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connect_to_master-instance_method">#connect_to_master</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#connected-3F-instance_method">#connected?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#count-instance_method">#count</span><span class='args'>(collection_name, selector = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return the number of records in <tt>collection_name</tt> that match
<tt>selector</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_collection-instance_method">#create_collection</span><span class='args'>(name, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create a collection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_index-instance_method">#create_index</span><span class='args'>(collection_name, field_or_spec, unique = false)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Create a new index on <tt>collection_name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#db_command-instance_method">#db_command</span><span class='args'>(selector)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
DB commands need to be ordered, so selector must be an OrderedHash (or a
Hash with only one element).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#dereference-instance_method">#dereference</span><span class='args'>(dbref)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Dereference a DBRef, getting the document it points to.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_collection-instance_method">#drop_collection</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Drop collection <tt>name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#drop_index-instance_method">#drop_index</span><span class='args'>(collection_name, name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Drop index <tt>name</tt> from <tt>collection_name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#error-instance_method">#error</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the error message from the most recently executed database
operation for this connection, or <tt>nil</tt> if there was no error.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#error-3F-instance_method">#error?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns <tt>true</tt> if an error was caused by the most recently executed
database operation.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#eval-instance_method">#eval</span><span class='args'>(code, *args)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Evaluate a JavaScript expression on MongoDB.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#full_coll_name-instance_method">#full_coll_name</span><span class='args'>(collection_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#index_information-instance_method">#index_information</span><span class='args'>(collection_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Get information on the indexes for the collection <tt>collection_name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#insert_into_db-instance_method">#insert_into_db</span><span class='args'>(collection_name, objects)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Insert <tt>objects</tt> into <tt>collection_name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#logout-instance_method">#logout</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Deauthorizes use for this database for this connection.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#master-instance_method">#master</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns a string of the form &quot;host:port&quot; that points to the
master database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#master-3F-instance_method">#master?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if this database is a master (or is not paired with any other
database), false if it is a slave.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ok-3F-instance_method">#ok?</span><span class='args'>(doc)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Return <tt>true</tt> if <tt>doc</tt> contains an &#8216;ok&#8217; field
with the value 1.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#pk_factory-3D-instance_method">#pk_factory=</span><span class='args'>(pk_factory)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#previous_error-instance_method">#previous_error</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Get the most recent error to have occured on this database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#query-instance_method">#query</span><span class='args'>(collection, query)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns a Cursor over the query results.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#receive_full-instance_method">#receive_full</span><span class='args'>(length)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#remove_from_db-instance_method">#remove_from_db</span><span class='args'>(collection_name, selector)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Remove the records that match <tt>selector</tt> from
<tt>collection_name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#replace_in_db-instance_method">#replace_in_db</span><span class='args'>(collection_name, selector, obj)</span>
        <span class='block'></span>
        
          <span class='alias'>#modify_in_db</span>
        
      </th>
      <td class="docstring">
        <p>
Update records in <tt>collection_name</tt> that match <tt>selector</tt> by
applying <tt>obj</tt> as an update.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#repsert_in_db-instance_method">#repsert_in_db</span><span class='args'>(collection_name, selector, obj)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Update records in <tt>collection_name</tt> that match <tt>selector</tt> by
applying <tt>obj</tt> as an update.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reset_error_history-instance_method">#reset_error_history</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Reset the error history of this database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_message-instance_method">#send_message</span><span class='args'>(msg)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Send a MsgMessage to the database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_query_message-instance_method">#send_query_message</span><span class='args'>(query_message)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Used by a Cursor to lazily send the query to the database.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#send_to_db-instance_method">#send_to_db</span><span class='args'>(message)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#slave_ok-3F-instance_method">#slave_ok?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#strict-3F-instance_method">#strict?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the value of the <tt>strict</tt> flag.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>admin</h3>
</div><div id="admin-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>admin</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 225</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L225">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">225
226
227</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='admin identifier id'>admin</span>
  <span class='Admin constant id'>Admin</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>authenticate</h3>
</div><div id="authenticate-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>authenticate</span><span class='args'>(username, password)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if <tt>username</tt> has <tt>password</tt> in
<tt>SYSTEM_USER_COLLECTION</tt>. <tt>name</tt> is username,
<tt>password</tt> is plaintext password.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 157</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L157">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">157
158
159
160
161
162
163
164
165
166
167
168</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='authenticate identifier id'>authenticate</span><span class='lparen token'>(</span><span class='username identifier id'>username</span><span class='comma token'>,</span> <span class='password identifier id'>password</span><span class='rparen token'>)</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:getnonce</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;error retrieving nonce: #{doc}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='nonce identifier id'>nonce</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'nonce'</span><span class='rbrack token'>]</span>

  <span class='auth identifier id'>auth</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='string val'>'authenticate'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
  <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='string val'>'user'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='username identifier id'>username</span>
  <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='string val'>'nonce'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='nonce identifier id'>nonce</span>
  <span class='auth identifier id'>auth</span><span class='lbrack token'>[</span><span class='string val'>'key'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{nonce}#{username}#{hash_password(username, password)}&quot;</span><span class='rparen token'>)</span>
  <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='auth identifier id'>auth</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>auto_reconnect?</h3>
</div><div id="auto_reconnect-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>auto_reconnect?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 65</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L65">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">65</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='auto_reconnect? fid id'>auto_reconnect?</span><span class='semicolon token'>;</span> <span class='@auto_reconnect ivar id'>@auto_reconnect</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>close</h3>
</div><div id="close-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>close</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Close the connection to the database.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 311</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L311">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">311
312
313
314
315
316
317</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='close identifier id'>close</span>
  <span class='if if kw'>if</span> <span class='@socket ivar id'>@socket</span>
    <span class='s identifier id'>s</span> <span class='assign token'>=</span> <span class='@socket ivar id'>@socket</span>
    <span class='@socket ivar id'>@socket</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='s identifier id'>s</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>collection</h3>
</div><div id="collection-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>collection</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return a collection. If <tt>strict</tt> is false, will return existing or
new collection. If <tt>strict</tt> is true, will raise an error if
collection <tt>name</tt> does not already exists.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 232</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L232">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">232
233
234
235</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='collection identifier id'>collection</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='strict? fid id'>strict?</span> <span class='orop op'>||</span> <span class='collection_names identifier id'>collection_names</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Collection #{name} doesn't exist. Currently in strict mode.&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>collection_names</h3>
</div><div id="collection_names-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>collection_names</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns an array of collection names. Each name is of the form
&quot;database_name.collection_name&quot;.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 178</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L178">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">178
179
180
181
182</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='collection_names identifier id'>collection_names</span>
  <span class='names identifier id'>names</span> <span class='assign token'>=</span> <span class='collections_info identifier id'>collections_info</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='doc identifier id'>doc</span><span class='bitor op'>|</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'name'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>''</span> <span class='rbrace token'>}</span>
  <span class='names identifier id'>names</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='string val'>''</span><span class='rparen token'>)</span>
  <span class='names identifier id'>names</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>collections_info</h3>
</div><div id="collections_info-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>collections_info</span><span class='args'>(coll_name = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns a cursor over query result hashes. Each hash contains a
&#8216;name&#8217; string and optionally an &#8216;options&#8217; hash. If
<tt>coll_name</tt> is specified, an array of length 1 is returned.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 187</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L187">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">187
188
189
190
191</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='collections_info identifier id'>collections_info</span><span class='lparen token'>(</span><span class='coll_name identifier id'>coll_name</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='selector identifier id'>selector</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='selector identifier id'>selector</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='coll_name identifier id'>coll_name</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='coll_name identifier id'>coll_name</span>
  <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='SYSTEM_NAMESPACE_COLLECTION constant id'>SYSTEM_NAMESPACE_COLLECTION</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='Query constant id'>Query</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='selector identifier id'>selector</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>connect_to_master</h3>
</div><div id="connect_to_master-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connect_to_master</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 129</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L129">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='connect_to_master identifier id'>connect_to_master</span>
  <span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='@socket ivar id'>@socket</span>
  <span class='@host ivar id'>@host</span> <span class='assign token'>=</span> <span class='@port ivar id'>@port</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='@nodes ivar id'>@nodes</span><span class='dot token'>.</span><span class='detect identifier id'>detect</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='hp identifier id'>hp</span><span class='bitor op'>|</span>
    <span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span> <span class='assign token'>=</span> <span class='mult op'>*</span><span class='hp identifier id'>hp</span>
    <span class='begin begin kw'>begin</span>
      <span class='@socket ivar id'>@socket</span> <span class='assign token'>=</span> <span class='TCPSocket constant id'>TCPSocket</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@host ivar id'>@host</span><span class='comma token'>,</span> <span class='@port ivar id'>@port</span><span class='rparen token'>)</span>
      <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='setsockopt identifier id'>setsockopt</span><span class='lparen token'>(</span><span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='IPPROTO_TCP constant id'>IPPROTO_TCP</span><span class='comma token'>,</span> <span class='Socket constant id'>Socket</span><span class='colon2 op'>::</span><span class='TCP_NODELAY constant id'>TCP_NODELAY</span><span class='comma token'>,</span> <span class='integer val'>1</span><span class='rparen token'>)</span>

      <span class='comment val'># Check for master. Can't call master? because it uses mutex,</span>
      <span class='comment val'># which may already be in use during this call.</span>
      <span class='semaphore_is_locked identifier id'>semaphore_is_locked</span> <span class='assign token'>=</span> <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='locked? fid id'>locked?</span>
      <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='unlock identifier id'>unlock</span> <span class='if if_mod kw'>if</span> <span class='semaphore_is_locked identifier id'>semaphore_is_locked</span>
      <span class='is_master identifier id'>is_master</span> <span class='assign token'>=</span> <span class='master? fid id'>master?</span>
      <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='lock identifier id'>lock</span> <span class='if if_mod kw'>if</span> <span class='semaphore_is_locked identifier id'>semaphore_is_locked</span>

      <span class='break break kw'>break</span> <span class='if if_mod kw'>if</span> <span class='@slave_ok ivar id'>@slave_ok</span> <span class='orop op'>||</span> <span class='is_master identifier id'>is_master</span>
    <span class='rescue rescue kw'>rescue</span> <span class='SocketError constant id'>SocketError</span><span class='comma token'>,</span> <span class='SystemCallError constant id'>SystemCallError</span><span class='comma token'>,</span> <span class='IOError constant id'>IOError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ex identifier id'>ex</span>
      <span class='close identifier id'>close</span> <span class='if if_mod kw'>if</span> <span class='@socket ivar id'>@socket</span>
    <span class='end end kw'>end</span>
    <span class='@socket ivar id'>@socket</span>
  <span class='rbrace token'>}</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;error: failed to connect to any given host:port&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='@socket ivar id'>@socket</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>connected?</h3>
</div><div id="connected-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>connected?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 319</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L319">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">319
320
321</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='connected? fid id'>connected?</span>
  <span class='@socket ivar id'>@socket</span> <span class='neq op'>!=</span> <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>count</h3>
</div><div id="count-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>count</span><span class='args'>(collection_name, selector = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return the number of records in <tt>collection_name</tt> that match
<tt>selector</tt>. If <tt>selector</tt> is <tt>nil</tt> or an empty hash,
returns the count of all records. Normally called by Collection#count.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 387</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L387">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">387
388
389
390
391
392
393
394
395</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='oh identifier id'>oh</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='collection_name identifier id'>collection_name</span>
  <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:query</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='selector identifier id'>selector</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='oh identifier id'>oh</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'n'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='if if_mod kw'>if</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='integer val'>0</span> <span class='if if_mod kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'errmsg'</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;ns missing&quot;</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error with count command: #{doc.inspect}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_collection</h3>
</div><div id="create_collection-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_collection</span><span class='args'>(name, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create a collection. If <tt>strict</tt> is false, will return existing or
new collection. If <tt>strict</tt> is true, will raise an error if
collection <tt>name</tt> already exists.
</p>
<p>
Options is an optional hash:
</p>
<table>
<tr><td valign="top">:capped :</td><td>Boolean. If not specified, capped is <tt>false</tt>.

</td></tr>
<tr><td valign="top">:size :</td><td>If <tt>capped</tt> is <tt>true</tt>, specifies the maximum number of bytes.
If <tt>false</tt>, specifies the initial extent of the collection.

</td></tr>
<tr><td valign="top">:max :</td><td>Max number of records in a capped collection. Optional.

</td></tr>
</table>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 206</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L206">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_collection identifier id'>create_collection</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='comment val'># First check existence</span>
  <span class='if if kw'>if</span> <span class='collection_names identifier id'>collection_names</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='strict? fid id'>strict?</span>
      <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Collection #{name} already exists. Currently in strict mode.&quot;</span>
    <span class='else else kw'>else</span>
      <span class='return return kw'>return</span> <span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Create new collection</span>
  <span class='oh identifier id'>oh</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:create</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='oh identifier id'>oh</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='options identifier id'>options</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='ok identifier id'>ok</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'ok'</span><span class='rbrack token'>]</span>
  <span class='return return kw'>return</span> <span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='ok identifier id'>ok</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='lparen token'>(</span><span class='ok identifier id'>ok</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>1</span> <span class='orop op'>||</span> <span class='ok identifier id'>ok</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error creating collection: #{doc.inspect}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_index</h3>
</div><div id="create_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_index</span><span class='args'>(collection_name, field_or_spec, unique = false)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Create a new index on <tt>collection_name</tt>. <tt>field_or_spec</tt>
should be either a single field name or a Array of [field name, direction]
pairs. Directions should be specified as XGen::Mongo::ASCENDING or
XGen::Mongo::DESCENDING. Normally called by Collection#create_index. If
<tt>unique</tt> is true the index will enforce a uniqueness constraint.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 449</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L449">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='create_index identifier id'>create_index</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='field_or_spec identifier id'>field_or_spec</span><span class='comma token'>,</span> <span class='unique identifier id'>unique</span><span class='assign token'>=</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
  <span class='field_h identifier id'>field_h</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='if if kw'>if</span> <span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
    <span class='field_h identifier id'>field_h</span><span class='lbrack token'>[</span><span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
  <span class='else else kw'>else</span>
    <span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='field_h identifier id'>field_h</span><span class='lbrack token'>[</span><span class='f identifier id'>f</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='f identifier id'>f</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
  <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='gen_index_name identifier id'>gen_index_name</span><span class='lparen token'>(</span><span class='field_h identifier id'>field_h</span><span class='rparen token'>)</span>
  <span class='sel identifier id'>sel</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='comma token'>,</span>
    <span class='symbol val'>:ns</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='symbol val'>:key</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='field_h identifier id'>field_h</span><span class='comma token'>,</span>
    <span class='symbol val'>:unique</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='unique identifier id'>unique</span>
  <span class='rbrace token'>}</span>
  <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
    <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='InsertMessage constant id'>InsertMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='SYSTEM_INDEX_COLLECTION constant id'>SYSTEM_INDEX_COLLECTION</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='sel identifier id'>sel</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
  <span class='name identifier id'>name</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>db_command</h3>
</div><div id="db_command-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>db_command</span><span class='args'>(selector)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
DB commands need to be ordered, so selector must be an OrderedHash (or a
Hash with only one element). What DB commands really need is that the
&quot;command&quot; key be first.
</p>
<p>
Do not call this. Intended for driver use only.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 510</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L510">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">510
511
512
513
514
515
516
517
518
519
520</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='selector identifier id'>selector</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='selector identifier id'>selector</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='OrderedHash constant id'>OrderedHash</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='selector identifier id'>selector</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='selector identifier id'>selector</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
      <span class='raise identifier id'>raise</span> <span class='string val'>&quot;db_command must be given an OrderedHash when there is more than one key&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='Query constant id'>Query</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='selector identifier id'>selector</span><span class='rparen token'>)</span>
  <span class='q identifier id'>q</span><span class='dot token'>.</span><span class='number_to_return identifier id'>number_to_return</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
  <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='SYSTEM_COMMAND_COLLECTION constant id'>SYSTEM_COMMAND_COLLECTION</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='q identifier id'>q</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='next_object identifier id'>next_object</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>dereference</h3>
</div><div id="dereference-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>dereference</span><span class='args'>(dbref)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Dereference a DBRef, getting the document it points to.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 398</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L398">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">398
399
400</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='dereference identifier id'>dereference</span><span class='lparen token'>(</span><span class='dbref identifier id'>dbref</span><span class='rparen token'>)</span>
  <span class='collection identifier id'>collection</span><span class='lparen token'>(</span><span class='dbref identifier id'>dbref</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='find_first identifier id'>find_first</span><span class='lparen token'>(</span><span class='string val'>&quot;_id&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dbref identifier id'>dbref</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_collection</h3>
</div><div id="drop_collection-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_collection</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Drop collection <tt>name</tt>. Returns <tt>true</tt> on success or if the
collection does not exist, <tt>false</tt> otherwise.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 239</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L239">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">239
240
241
242
243</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_collection identifier id'>drop_collection</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='true true kw'>true</span> <span class='unless unless_mod kw'>unless</span> <span class='collection_names identifier id'>collection_names</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:drop</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>drop_index</h3>
</div><div id="drop_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>drop_index</span><span class='args'>(collection_name, name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Drop index <tt>name</tt> from <tt>collection_name</tt>. Normally called
from Collection#drop_index or Collection#drop_indexes.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 421</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L421">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">421
422
423
424
425
426
427</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='drop_index identifier id'>drop_index</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='oh identifier id'>oh</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:deleteIndexes</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='collection_name identifier id'>collection_name</span>
  <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:index</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='oh identifier id'>oh</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error with drop_index command: #{doc.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>error</h3>
</div><div id="error-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>error</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the error message from the most recently executed database
operation for this connection, or <tt>nil</tt> if there was no error.
</p>
<p>
Note: as of this writing, errors are only detected on the db server for
certain kinds of operations (writes). The plan is to change this so that
all operations will set the error if needed.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 251</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L251">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">251
252
253
254
255</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='error identifier id'>error</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:getlasterror</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;error retrieving last error: #{doc}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'err'</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>error?</h3>
</div><div id="error-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>error?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns <tt>true</tt> if an error was caused by the most recently executed
database operation.
</p>
<p>
Note: as of this writing, errors are only detected on the db server for
certain kinds of operations (writes). The plan is to change this so that
all operations will set the error if needed.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 263</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L263">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">263
264
265</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='error? fid id'>error?</span>
  <span class='error identifier id'>error</span> <span class='neq op'>!=</span> <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>eval</h3>
</div><div id="eval-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>eval</span><span class='args'>(code, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Evaluate a JavaScript expression on MongoDB. <tt>code</tt> should be a
string or Code instance containing a JavaScript expression. Additional
arguments will be passed to that expression when it is run on the server.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 406</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L406">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">406
407
408
409
410
411
412
413
414
415
416
417</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='eval identifier id'>eval</span><span class='lparen token'>(</span><span class='code identifier id'>code</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='code identifier id'>code</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span> <span class='Code constant id'>Code</span>
    <span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='Code constant id'>Code</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='code identifier id'>code</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='oh identifier id'>oh</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:$eval</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='code identifier id'>code</span>
  <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:args</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='oh identifier id'>oh</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'retval'</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error with eval command: #{doc.inspect}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>full_coll_name</h3>
</div><div id="full_coll_name-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>full_coll_name</span><span class='args'>(collection_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 495</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L495">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">495
496
497</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span>
  <span class='dstring node'>&quot;#{@name}.#{collection_name}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>index_information</h3>
</div><div id="index_information-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>index_information</span><span class='args'>(collection_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Get information on the indexes for the collection <tt>collection_name</tt>.
Normally called by Collection#index_information. Returns a hash where the
keys are index names (as returned by Collection#create_index and the values
are lists of [key, direction] pairs specifying the index (as passed to
Collection#create_index).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 434</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L434">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">434
435
436
437
438
439
440
441</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='index_information identifier id'>index_information</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span>
  <span class='sel identifier id'>sel</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:ns</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
  <span class='info identifier id'>info</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='SYSTEM_INDEX_COLLECTION constant id'>SYSTEM_INDEX_COLLECTION</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='Query constant id'>Query</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='sel identifier id'>sel</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='index identifier id'>index</span><span class='bitor op'>|</span>
    <span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='index identifier id'>index</span><span class='lbrack token'>[</span><span class='string val'>'name'</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='lbrack token'>[</span><span class='string val'>'key'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>
  <span class='rbrace token'>}</span>
  <span class='info identifier id'>info</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>insert_into_db</h3>
</div><div id="insert_into_db-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>insert_into_db</span><span class='args'>(collection_name, objects)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Insert <tt>objects</tt> into <tt>collection_name</tt>. Normally called by
Collection#insert. Returns a new array containing <tt>objects</tt>,
possibly modified by @pk_factory.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 472</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L472">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">472
473
474
475
476
477
478
479
480
481
482</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='insert_into_db identifier id'>insert_into_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='objects identifier id'>objects</span><span class='rparen token'>)</span>
  <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
    <span class='if if kw'>if</span> <span class='@pk_factory ivar id'>@pk_factory</span>
      <span class='objects identifier id'>objects</span><span class='dot token'>.</span><span class='collect! fid id'>collect!</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='o identifier id'>o</span><span class='bitor op'>|</span>
        <span class='@pk_factory ivar id'>@pk_factory</span><span class='dot token'>.</span><span class='create_pk identifier id'>create_pk</span><span class='lparen token'>(</span><span class='o identifier id'>o</span><span class='rparen token'>)</span>
      <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='InsertMessage constant id'>InsertMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='objects identifier id'>objects</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='objects identifier id'>objects</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>logout</h3>
</div><div id="logout-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>logout</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Deauthorizes use for this database for this connection.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 171</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L171">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">171
172
173
174</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='logout identifier id'>logout</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:logout</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;error logging out: #{doc.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>master</h3>
</div><div id="master-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>master</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns a string of the form &quot;host:port&quot; that points to the
master database. Works even if this is the master database.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 298</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L298">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">298
299
300
301
302
303
304
305
306
307
308</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='master identifier id'>master</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:ismaster</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='is_master identifier id'>is_master</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'ismaster'</span><span class='rbrack token'>]</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error retrieving master database: #{doc.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='is_master identifier id'>is_master</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='is_master identifier id'>is_master</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span>
  <span class='when when kw'>when</span> <span class='integer val'>1</span>
    <span class='string val'>&quot;#@host:#@port&quot;</span>
  <span class='else else kw'>else</span>
    <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'remote'</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>master?</h3>
</div><div id="master-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>master?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if this database is a master (or is not paired with any other
database), false if it is a slave.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 290</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L290">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">290
291
292
293
294</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='master? fid id'>master?</span>
  <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:ismaster</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='is_master identifier id'>is_master</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'ismaster'</span><span class='rbrack token'>]</span>
  <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='is_master identifier id'>is_master</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='is_master identifier id'>is_master</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ok?</h3>
</div><div id="ok-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ok?</span><span class='args'>(doc)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Return <tt>true</tt> if <tt>doc</tt> contains an &#8216;ok&#8217; field
with the value 1.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 500</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L500">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">500
501
502
503</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='ok identifier id'>ok</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'ok'</span><span class='rbrack token'>]</span>
  <span class='ok identifier id'>ok</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='ok identifier id'>ok</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>pk_factory=</h3>
</div><div id="pk_factory-3D-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>pk_factory=</span><span class='args'>(pk_factory)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 71</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L71">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">71
72
73
74</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='pk_factory= identifier id'>pk_factory=</span><span class='lparen token'>(</span><span class='pk_factory identifier id'>pk_factory</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='string val'>&quot;error: can not change PK factory&quot;</span> <span class='if if_mod kw'>if</span> <span class='@pk_factory ivar id'>@pk_factory</span>
  <span class='@pk_factory ivar id'>@pk_factory</span> <span class='assign token'>=</span> <span class='pk_factory identifier id'>pk_factory</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>previous_error</h3>
</div><div id="previous_error-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>previous_error</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Get the most recent error to have occured on this database
</p>
<p>
Only returns errors that have occured since the last call to
DB#reset_error_history - returns <tt>nil</tt> if there is no such error.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 271</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L271">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">271
272
273
274
275
276
277
278</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='previous_error identifier id'>previous_error</span>
  <span class='error identifier id'>error</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:getpreverror</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='error identifier id'>error</span><span class='lbrack token'>[</span><span class='string val'>&quot;err&quot;</span><span class='rbrack token'>]</span>
    <span class='error identifier id'>error</span>
  <span class='else else kw'>else</span>
    <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>query</h3>
</div><div id="query-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>query</span><span class='args'>(collection, query)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns a Cursor over the query results.
</p>
<p>
Note that the query gets sent lazily; the cursor calls #send_query_message
when needed. If the caller never requests an object from the cursor, the
query never gets sent.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 343</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L343">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">343
344
345</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='collection identifier id'>collection</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='Cursor constant id'>Cursor</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='collection identifier id'>collection</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>receive_full</h3>
</div><div id="receive_full-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>receive_full</span><span class='args'>(length)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 323</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L323">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='receive_full identifier id'>receive_full</span><span class='lparen token'>(</span><span class='length identifier id'>length</span><span class='rparen token'>)</span>
    <span class='message identifier id'>message</span> <span class='assign token'>=</span> <span class='string val'>&quot;&quot;</span>
    <span class='while while kw'>while</span> <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='lt op'>&lt;</span> <span class='length identifier id'>length</span> <span class='do do kw'>do</span>
      <span class='chunk identifier id'>chunk</span> <span class='assign token'>=</span> <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='recv identifier id'>recv</span><span class='lparen token'>(</span><span class='length identifier id'>length</span> <span class='minus op'>-</span> <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='rparen token'>)</span>
      <span class='raise identifier id'>raise</span> <span class='string val'>&quot;connection closed&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='chunk identifier id'>chunk</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>0</span>
      <span class='message identifier id'>message</span> <span class='opasgn op'>+=</span> <span class='chunk identifier id'>chunk</span>
    <span class='end end kw'>end</span>
    <span class='message identifier id'>message</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Send a MsgMessage to the database.</span>
  <span class='def def kw'>def</span> <span class='send_message identifier id'>send_message</span><span class='lparen token'>(</span><span class='msg identifier id'>msg</span><span class='rparen token'>)</span>
    <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='MsgMessage constant id'>MsgMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='msg identifier id'>msg</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Returns a Cursor over the query results.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Note that the query gets sent lazily; the cursor calls</span>
  <span class='comment val'># #send_query_message when needed. If the caller never requests an</span>
  <span class='comment val'># object from the cursor, the query never gets sent.</span>
  <span class='def def kw'>def</span> <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='collection identifier id'>collection</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>
    <span class='Cursor constant id'>Cursor</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='collection identifier id'>collection</span><span class='comma token'>,</span> <span class='query identifier id'>query</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Used by a Cursor to lazily send the query to the database.</span>
  <span class='def def kw'>def</span> <span class='send_query_message identifier id'>send_query_message</span><span class='lparen token'>(</span><span class='query_message identifier id'>query_message</span><span class='rparen token'>)</span>
    <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='query_message identifier id'>query_message</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Remove the records that match +selector+ from +collection_name+.</span>
  <span class='comment val'># Normally called by Collection#remove or Collection#clear.</span>
  <span class='def def kw'>def</span> <span class='remove_from_db identifier id'>remove_from_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='rparen token'>)</span>
    <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='RemoveMessage constant id'>RemoveMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Update records in +collection_name+ that match +selector+ by</span>
  <span class='comment val'># applying +obj+ as an update. Normally called by Collection#replace.</span>
  <span class='def def kw'>def</span> <span class='replace_in_db identifier id'>replace_in_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='rparen token'>)</span>
    <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='UpdateMessage constant id'>UpdateMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Alias for #replace_in_db. Normally called by Collection.modify.</span>
  <span class='alias_method identifier id'>alias_method</span> <span class='symbol val'>:modify_in_db</span><span class='comma token'>,</span> <span class='symbol val'>:replace_in_db</span>

  <span class='comment val'># Update records in +collection_name+ that match +selector+ by</span>
  <span class='comment val'># applying +obj+ as an update. If no match, inserts (???). Normally</span>
  <span class='comment val'># called by Collection#repsert.</span>
  <span class='def def kw'>def</span> <span class='repsert_in_db identifier id'>repsert_in_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='rparen token'>)</span>
    <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='obj identifier id'>obj</span> <span class='assign token'>=</span> <span class='@pk_factory ivar id'>@pk_factory</span><span class='dot token'>.</span><span class='create_pk identifier id'>create_pk</span><span class='lparen token'>(</span><span class='obj identifier id'>obj</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@pk_factory ivar id'>@pk_factory</span>
      <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='UpdateMessage constant id'>UpdateMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='obj identifier id'>obj</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Return the number of records in +collection_name+ that match</span>
  <span class='comment val'># +selector+. If +selector+ is +nil+ or an empty hash, returns the</span>
  <span class='comment val'># count of all records. Normally called by Collection#count.</span>
  <span class='def def kw'>def</span> <span class='count identifier id'>count</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
    <span class='oh identifier id'>oh</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:count</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='collection_name identifier id'>collection_name</span>
    <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:query</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='selector identifier id'>selector</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='oh identifier id'>oh</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'n'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='if if_mod kw'>if</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='integer val'>0</span> <span class='if if_mod kw'>if</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'errmsg'</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;ns missing&quot;</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error with count command: #{doc.inspect}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Dereference a DBRef, getting the document it points to.</span>
  <span class='def def kw'>def</span> <span class='dereference identifier id'>dereference</span><span class='lparen token'>(</span><span class='dbref identifier id'>dbref</span><span class='rparen token'>)</span>
    <span class='collection identifier id'>collection</span><span class='lparen token'>(</span><span class='dbref identifier id'>dbref</span><span class='dot token'>.</span><span class='namespace identifier id'>namespace</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='find_first identifier id'>find_first</span><span class='lparen token'>(</span><span class='string val'>&quot;_id&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dbref identifier id'>dbref</span><span class='dot token'>.</span><span class='object_id identifier id'>object_id</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Evaluate a JavaScript expression on MongoDB.</span>
  <span class='comment val'># +code+ should be a string or Code instance containing a JavaScript</span>
  <span class='comment val'># expression. Additional arguments will be passed to that expression</span>
  <span class='comment val'># when it is run on the server.</span>
  <span class='def def kw'>def</span> <span class='eval identifier id'>eval</span><span class='lparen token'>(</span><span class='code identifier id'>code</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='not not kw'>not</span> <span class='code identifier id'>code</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span> <span class='Code constant id'>Code</span>
      <span class='code identifier id'>code</span> <span class='assign token'>=</span> <span class='Code constant id'>Code</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='code identifier id'>code</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='oh identifier id'>oh</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:$eval</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='code identifier id'>code</span>
    <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:args</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
    <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='oh identifier id'>oh</span><span class='rparen token'>)</span>
    <span class='return return kw'>return</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'retval'</span><span class='rbrack token'>]</span> <span class='if if_mod kw'>if</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error with eval command: #{doc.inspect}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Drop index +name+ from +collection_name+. Normally called from</span>
  <span class='comment val'># Collection#drop_index or Collection#drop_indexes.</span>
  <span class='def def kw'>def</span> <span class='drop_index identifier id'>drop_index</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='oh identifier id'>oh</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:deleteIndexes</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='collection_name identifier id'>collection_name</span>
    <span class='oh identifier id'>oh</span><span class='lbrack token'>[</span><span class='symbol val'>:index</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span>
    <span class='doc identifier id'>doc</span> <span class='assign token'>=</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='oh identifier id'>oh</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Error with drop_index command: #{doc.inspect}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Get information on the indexes for the collection +collection_name+.</span>
  <span class='comment val'># Normally called by Collection#index_information. Returns a hash where</span>
  <span class='comment val'># the keys are index names (as returned by Collection#create_index and</span>
  <span class='comment val'># the values are lists of [key, direction] pairs specifying the index</span>
  <span class='comment val'># (as passed to Collection#create_index).</span>
  <span class='def def kw'>def</span> <span class='index_information identifier id'>index_information</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span>
    <span class='sel identifier id'>sel</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:ns</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span><span class='rbrace token'>}</span>
    <span class='info identifier id'>info</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
    <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='SYSTEM_INDEX_COLLECTION constant id'>SYSTEM_INDEX_COLLECTION</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='Query constant id'>Query</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='sel identifier id'>sel</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='index identifier id'>index</span><span class='bitor op'>|</span>
      <span class='info identifier id'>info</span><span class='lbrack token'>[</span><span class='index identifier id'>index</span><span class='lbrack token'>[</span><span class='string val'>'name'</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='lbrack token'>[</span><span class='string val'>'key'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_a identifier id'>to_a</span>
    <span class='rbrace token'>}</span>
    <span class='info identifier id'>info</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Create a new index on +collection_name+. +field_or_spec+</span>
  <span class='comment val'># should be either a single field name or a Array of [field name,</span>
  <span class='comment val'># direction] pairs. Directions should be specified as</span>
  <span class='comment val'># XGen::Mongo::ASCENDING or XGen::Mongo::DESCENDING. Normally called</span>
  <span class='comment val'># by Collection#create_index. If +unique+ is true the index will</span>
  <span class='comment val'># enforce a uniqueness constraint.</span>
  <span class='def def kw'>def</span> <span class='create_index identifier id'>create_index</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='field_or_spec identifier id'>field_or_spec</span><span class='comma token'>,</span> <span class='unique identifier id'>unique</span><span class='assign token'>=</span><span class='false false kw'>false</span><span class='rparen token'>)</span>
    <span class='field_h identifier id'>field_h</span> <span class='assign token'>=</span> <span class='OrderedHash constant id'>OrderedHash</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='if if kw'>if</span> <span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='String constant id'>String</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span>
      <span class='field_h identifier id'>field_h</span><span class='lbrack token'>[</span><span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='else else kw'>else</span>
      <span class='field_or_spec identifier id'>field_or_spec</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> <span class='field_h identifier id'>field_h</span><span class='lbrack token'>[</span><span class='f identifier id'>f</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='f identifier id'>f</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='gen_index_name identifier id'>gen_index_name</span><span class='lparen token'>(</span><span class='field_h identifier id'>field_h</span><span class='rparen token'>)</span>
    <span class='sel identifier id'>sel</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
      <span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='comma token'>,</span>
      <span class='symbol val'>:ns</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span><span class='comma token'>,</span>
      <span class='symbol val'>:key</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='field_h identifier id'>field_h</span><span class='comma token'>,</span>
      <span class='symbol val'>:unique</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='unique identifier id'>unique</span>
    <span class='rbrace token'>}</span>
    <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='InsertMessage constant id'>InsertMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='SYSTEM_INDEX_COLLECTION constant id'>SYSTEM_INDEX_COLLECTION</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='sel identifier id'>sel</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
    <span class='name identifier id'>name</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Insert +objects+ into +collection_name+. Normally called by</span>
  <span class='comment val'># Collection#insert. Returns a new array containing +objects+,</span>
  <span class='comment val'># possibly modified by @pk_factory.</span>
  <span class='def def kw'>def</span> <span class='insert_into_db identifier id'>insert_into_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='objects identifier id'>objects</span><span class='rparen token'>)</span>
    <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
      <span class='if if kw'>if</span> <span class='@pk_factory ivar id'>@pk_factory</span>
        <span class='objects identifier id'>objects</span><span class='dot token'>.</span><span class='collect! fid id'>collect!</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='o identifier id'>o</span><span class='bitor op'>|</span>
          <span class='@pk_factory ivar id'>@pk_factory</span><span class='dot token'>.</span><span class='create_pk identifier id'>create_pk</span><span class='lparen token'>(</span><span class='o identifier id'>o</span><span class='rparen token'>)</span>
        <span class='rbrace token'>}</span>
      <span class='end end kw'>end</span>
      <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='InsertMessage constant id'>InsertMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='objects identifier id'>objects</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
      <span class='objects identifier id'>objects</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
    <span class='connect_to_master identifier id'>connect_to_master</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='connected? fid id'>connected?</span> <span class='andop op'>&amp;&amp;</span> <span class='@auto_reconnect ivar id'>@auto_reconnect</span>
    <span class='begin begin kw'>begin</span>
      <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='print identifier id'>print</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='dot token'>.</span><span class='buf identifier id'>buf</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
      <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='flush identifier id'>flush</span>
    <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ex identifier id'>ex</span>
      <span class='close identifier id'>close</span>
      <span class='raise identifier id'>raise</span> <span class='ex identifier id'>ex</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='full_coll_name identifier id'>full_coll_name</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='rparen token'>)</span>
    <span class='dstring node'>&quot;#{@name}.#{collection_name}&quot;</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># Return +true+ if +doc+ contains an 'ok' field with the value 1.</span>
  <span class='def def kw'>def</span> <span class='ok? fid id'>ok?</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
    <span class='ok identifier id'>ok</span> <span class='assign token'>=</span> <span class='doc identifier id'>doc</span><span class='lbrack token'>[</span><span class='string val'>'ok'</span><span class='rbrack token'>]</span>
    <span class='ok identifier id'>ok</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Numeric constant id'>Numeric</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='ok identifier id'>ok</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='eq op'>==</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># DB commands need to be ordered, so selector must be an OrderedHash</span>
  <span class='comment val'># (or a Hash with only one element). What DB commands really need is</span>
  <span class='comment val'># that the &quot;command&quot; key be first.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># Do not call this. Intended for driver use only.</span>
  <span class='def def kw'>def</span> <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='selector identifier id'>selector</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='selector identifier id'>selector</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='OrderedHash constant id'>OrderedHash</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='notop op'>!</span><span class='selector identifier id'>selector</span><span class='dot token'>.</span><span class='kind_of? fid id'>kind_of?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='selector identifier id'>selector</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
        <span class='raise identifier id'>raise</span> <span class='string val'>&quot;db_command must be given an OrderedHash when there is more than one key&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='q identifier id'>q</span> <span class='assign token'>=</span> <span class='Query constant id'>Query</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='selector identifier id'>selector</span><span class='rparen token'>)</span>
    <span class='q identifier id'>q</span><span class='dot token'>.</span><span class='number_to_return identifier id'>number_to_return</span> <span class='assign token'>=</span> <span class='integer val'>1</span>
    <span class='query identifier id'>query</span><span class='lparen token'>(</span><span class='Collection constant id'>Collection</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='comma token'>,</span> <span class='SYSTEM_COMMAND_COLLECTION constant id'>SYSTEM_COMMAND_COLLECTION</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='q identifier id'>q</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='next_object identifier id'>next_object</span>
  <span class='end end kw'>end</span>

  <span class='private identifier id'>private</span>

  <span class='def def kw'>def</span> <span class='hash_password identifier id'>hash_password</span><span class='lparen token'>(</span><span class='username identifier id'>username</span><span class='comma token'>,</span> <span class='plaintext identifier id'>plaintext</span><span class='rparen token'>)</span>
    <span class='Digest constant id'>Digest</span><span class='colon2 op'>::</span><span class='MD5 constant id'>MD5</span><span class='dot token'>.</span><span class='hexdigest identifier id'>hexdigest</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{username}:mongo:#{plaintext}&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='def def kw'>def</span> <span class='gen_index_name identifier id'>gen_index_name</span><span class='lparen token'>(</span><span class='spec identifier id'>spec</span><span class='rparen token'>)</span>
    <span class='temp identifier id'>temp</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
    <span class='spec identifier id'>spec</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='direction identifier id'>direction</span><span class='bitor op'>|</span>
      <span class='temp identifier id'>temp</span> <span class='assign token'>=</span> <span class='temp identifier id'>temp</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{field}_#{direction}&quot;</span><span class='rparen token'>)</span>
    <span class='rbrace token'>}</span>
    <span class='return return kw'>return</span> <span class='temp identifier id'>temp</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;_&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>remove_from_db</h3>
</div><div id="remove_from_db-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>remove_from_db</span><span class='args'>(collection_name, selector)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Remove the records that match <tt>selector</tt> from
<tt>collection_name</tt>. Normally called by Collection#remove or
Collection#clear.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 356</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L356">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">356
357
358
359
360</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='remove_from_db identifier id'>remove_from_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='rparen token'>)</span>
  <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
    <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='RemoveMessage constant id'>RemoveMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>replace_in_db</h3>
</div><div id="replace_in_db-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>replace_in_db</span><span class='args'>(collection_name, selector, obj)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="modify_in_db-instance_method">modify_in_db</tt>
  
</p>
</div><div class="section docstring">
  <p>
Update records in <tt>collection_name</tt> that match <tt>selector</tt> by
applying <tt>obj</tt> as an update. Normally called by Collection#replace.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 364</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L364">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">364
365
366
367
368</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='replace_in_db identifier id'>replace_in_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='rparen token'>)</span>
  <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
    <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='UpdateMessage constant id'>UpdateMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>repsert_in_db</h3>
</div><div id="repsert_in_db-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>repsert_in_db</span><span class='args'>(collection_name, selector, obj)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Update records in <tt>collection_name</tt> that match <tt>selector</tt> by
applying <tt>obj</tt> as an update. If no match, inserts (???). Normally
called by Collection#repsert.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 376</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L376">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">376
377
378
379
380
381
382</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='repsert_in_db identifier id'>repsert_in_db</span><span class='lparen token'>(</span><span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='rparen token'>)</span>
  <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
    <span class='obj identifier id'>obj</span> <span class='assign token'>=</span> <span class='@pk_factory ivar id'>@pk_factory</span><span class='dot token'>.</span><span class='create_pk identifier id'>create_pk</span><span class='lparen token'>(</span><span class='obj identifier id'>obj</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='@pk_factory ivar id'>@pk_factory</span>
    <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='UpdateMessage constant id'>UpdateMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@name ivar id'>@name</span><span class='comma token'>,</span> <span class='collection_name identifier id'>collection_name</span><span class='comma token'>,</span> <span class='selector identifier id'>selector</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='comma token'>,</span> <span class='true true kw'>true</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='obj identifier id'>obj</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reset_error_history</h3>
</div><div id="reset_error_history-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reset_error_history</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Reset the error history of this database
</p>
<p>
Calls to DB#previous_error will only return errors that have occurred since
the most recent call to this method.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 284</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L284">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">284
285
286</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reset_error_history identifier id'>reset_error_history</span>
  <span class='db_command identifier id'>db_command</span><span class='lparen token'>(</span><span class='symbol val'>:reseterror</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_message</h3>
</div><div id="send_message-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_message</span><span class='args'>(msg)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Send a MsgMessage to the database.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 334</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L334">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">334
335
336</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_message identifier id'>send_message</span><span class='lparen token'>(</span><span class='msg identifier id'>msg</span><span class='rparen token'>)</span>
  <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='MsgMessage constant id'>MsgMessage</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='msg identifier id'>msg</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_query_message</h3>
</div><div id="send_query_message-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_query_message</span><span class='args'>(query_message)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Used by a Cursor to lazily send the query to the database.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 348</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L348">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">348
349
350
351
352</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_query_message identifier id'>send_query_message</span><span class='lparen token'>(</span><span class='query_message identifier id'>query_message</span><span class='rparen token'>)</span>
  <span class='@semaphore ivar id'>@semaphore</span><span class='dot token'>.</span><span class='synchronize identifier id'>synchronize</span> <span class='lbrace token'>{</span>
    <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='query_message identifier id'>query_message</span><span class='rparen token'>)</span>
  <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>send_to_db</h3>
</div><div id="send_to_db-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>send_to_db</span><span class='args'>(message)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 484</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L484">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">484
485
486
487
488
489
490
491
492
493</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='send_to_db identifier id'>send_to_db</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='rparen token'>)</span>
  <span class='connect_to_master identifier id'>connect_to_master</span> <span class='if if_mod kw'>if</span> <span class='notop op'>!</span><span class='connected? fid id'>connected?</span> <span class='andop op'>&amp;&amp;</span> <span class='@auto_reconnect ivar id'>@auto_reconnect</span>
  <span class='begin begin kw'>begin</span>
    <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='print identifier id'>print</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='dot token'>.</span><span class='buf identifier id'>buf</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    <span class='@socket ivar id'>@socket</span><span class='dot token'>.</span><span class='flush identifier id'>flush</span>
  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ex identifier id'>ex</span>
    <span class='close identifier id'>close</span>
    <span class='raise identifier id'>raise</span> <span class='ex identifier id'>ex</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>slave_ok?</h3>
</div><div id="slave_ok-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>slave_ok?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 64</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L64">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">64</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='slave_ok? fid id'>slave_ok?</span><span class='semicolon token'>;</span> <span class='@slave_ok ivar id'>@slave_ok</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>strict?</h3>
</div><div id="strict-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>strict?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the value of the <tt>strict</tt> flag.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/mongo/db.rb', line 48</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mongodb/mongo-ruby-driver/blob/5a6a8d29a528cececa77285f759c38e69384281a/lib/mongo/db.rb#L48">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">48</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='strict? fid id'>strict?</span><span class='semicolon token'>;</span> <span class='@strict ivar id'>@strict</span><span class='semicolon token'>;</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>