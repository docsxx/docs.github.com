<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>mongodb's mongo-ruby-driver - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/mongodb/commits/mongo-ruby-driver/master" rel="alternate" title="Recent Commits to mongo-ruby-driver:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("mongodb", "mongo-ruby-driver", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='mongodb/mongo-ruby-driver/blob/dc44751d2fb18a8be1f301ecac24e675d4da2b0e' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='mongodb/mongo-ruby-driver/blob/dc44751d2fb18a8be1f301ecac24e675d4da2b0e' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("mongodb", "mongo-ruby-driver", "dc44751d2fb18a8be1f301ecac24e675d4da2b0e", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/tree/">Source</a></li>
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/network">Network</a></li>            
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/mongodb/mongo-ruby-driver">Wiki</a></li>
            <li class=""><a href="http://github.com/mongodb/mongo-ruby-driver/graphs">Graphs</a></li>                    
            <li class="active"><a href="/mongodb/mongo-ruby-driver">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/mongodb">mongodb</a> / <b><a href="http://github.com/mongodb/mongo-ruby-driver/tree">mongo-ruby-driver</a></b>        
                <a id="namespaces_button" rel="mongodb/mongo-ruby-driver/blob/dc44751d2fb18a8be1f301ecac24e675d4da2b0e" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="mongodb/mongo-ruby-driver/blob/dc44751d2fb18a8be1f301ecac24e675d4da2b0e" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Introduction</h1>
<p>
This is a Ruby driver for the 10gen Mongo DB. For more information about
Mongo, see http://www.mongodb.org.
</p>
<p>
Start by reading the XGen::Mongo::Driver::Mongo and XGen::Mongo::Driver::DB
documentation, then move on to XGen::Mongo::Driver::Collection and
XGen::Mongo::Driver::Cursor.
</p>
<p>
Here is a quick code sample. See the files in the &quot;examples&quot;
subdirectory for many more.
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'mongo'</span>

  <span class='include identifier id'>include</span> <span class='XGen constant id'>XGen</span><span class='colon2 op'>::</span><span class='Mongo constant id'>Mongo</span><span class='colon2 op'>::</span><span class='Driver constant id'>Driver</span>

  <span class='db identifier id'>db</span> <span class='assign token'>=</span> <span class='Mongo constant id'>Mongo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'localhost'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='db identifier id'>db</span><span class='lparen token'>(</span><span class='string val'>'sample-db'</span><span class='rparen token'>)</span>
  <span class='coll identifier id'>coll</span> <span class='assign token'>=</span> <span class='db identifier id'>db</span><span class='dot token'>.</span><span class='collection identifier id'>collection</span><span class='lparen token'>(</span><span class='string val'>'test'</span><span class='rparen token'>)</span>

  <span class='coll identifier id'>coll</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
  <span class='float val'>3</span><span class='dot token'>.</span><span class='times identifier id'>times</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='coll identifier id'>coll</span><span class='dot token'>.</span><span class='insert identifier id'>insert</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='string val'>'a'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='i identifier id'>i</span><span class='plus op'>+</span><span class='integer val'>1</span><span class='rbrace token'>}</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;There are #{coll.count()} records. Here they are:&quot;</span>
  <span class='coll identifier id'>coll</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='doc identifier id'>doc</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span> <span class='rbrace token'>}</span>
</pre>
<p>
This driver also includes an implementation of a GridStore class, a Ruby
interface to Mongo&#8217;s GridFS storage. NOTE: the GridStore code may be
moved to a separate project.
</p>
<h1>Installation</h1>
<p>
Install the &quot;mongo&quot; gem by typing
</p>
<pre class="code">
  $ <span class='gem identifier id'>gem</span> <span class='sources identifier id'>sources</span> <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
  $ sudo gem install mongodb-mongo
</span></pre>
<p>
The first line tells RubyGems to add the GitHub gem repository. You only
need to run this command once.
</p>
<h3>From the GitHub source</h3>
<p>
The source code is available at
http://github.com/mongodb/mongo-ruby-driver. You can either clone the git
repository or download a tarball or zip file. Once you have the source, you
can use it from wherever you downloaded it or you can install it as a gem
from the source by typing
</p>
<pre class="code">
  $ <span class='rake identifier id'>rake</span> <span class='gem identifier id'>gem</span><span class='symbol val'>:install</span>
</pre>
<p>
Note: when you install the gem this way it is called &quot;mongo&quot;, not
&quot;mongodb-mongo&quot;. In either case, you &quot;require
&#8216;mongo&#8217;&quot; in your source code.
</p>
<h3>Optional C Extension</h3>
<p>
There is a separate gem containing optional C extensions that will increase
the performance of the driver. To use the optional extensions just install
the gem by typing
</p>
<pre class="code">
  $ <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='mongodb identifier id'>mongodb</span><span class='minus op'>-</span><span class='mongo_ext identifier id'>mongo_ext</span>
</pre>
<p>
To install from source type this instead
</p>
<pre class="code">
  $ <span class='rake identifier id'>rake</span> <span class='gem identifier id'>gem</span><span class='symbol val'>:install_extensions</span>
</pre>
<p>
That&#8217;s all there is to it!
</p>
<h1>Examples</h1>
<p>
There are many examples in the &quot;examples&quot; subdirectory. Samples
include using the driver and using the GridFS class GridStore. Mongo must
be running for these examples to work, of course.
</p>
<p>
Here&#8217;s how to start mongo and run the &quot;simple.rb&quot; example:
</p>
<pre class="code">
  $ <span class='cd identifier id'>cd</span> <span class='path identifier id'>path</span><span class='div op'>/</span><span class='to identifier id'>to</span><span class='div op'>/</span><span class='mongo identifier id'>mongo</span>
  $ <span class='dot token'>.</span><span class='div op'>/</span><span class='mongod identifier id'>mongod</span> <span class='run identifier id'>run</span>
  <span class='dot3 op'>...</span> <span class='then then kw'>then</span> <span class='in in kw'>in</span> <span class='another identifier id'>another</span> <span class='window identifier id'>window</span> <span class='dot3 op'>...</span>
  $ <span class='cd identifier id'>cd</span> <span class='path identifier id'>path</span><span class='div op'>/</span><span class='to identifier id'>to</span><span class='div op'>/</span><span class='mongo identifier id'>mongo</span><span class='minus op'>-</span><span class='ruby identifier id'>ruby</span><span class='minus op'>-</span><span class='driver identifier id'>driver</span>
  $ <span class='ruby identifier id'>ruby</span> <span class='examples identifier id'>examples</span><span class='div op'>/</span><span class='simple identifier id'>simple</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
See also the test code, especially tests/test_db_api.rb.
</p>
<h1>The Driver</h1>
<p>
Here is some simple example code:
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>        <span class='comment val'># not required for Ruby 1.9</span>
  <span class='require identifier id'>require</span> <span class='string val'>'mongo'</span>

  <span class='include identifier id'>include</span> <span class='XGen constant id'>XGen</span><span class='colon2 op'>::</span><span class='Mongo constant id'>Mongo</span><span class='colon2 op'>::</span><span class='Driver constant id'>Driver</span>
  <span class='db identifier id'>db</span> <span class='assign token'>=</span> <span class='Mongo constant id'>Mongo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='db identifier id'>db</span><span class='lparen token'>(</span><span class='string val'>'my-db-name'</span><span class='rparen token'>)</span>
  <span class='things identifier id'>things</span> <span class='assign token'>=</span> <span class='db identifier id'>db</span><span class='dot token'>.</span><span class='collection identifier id'>collection</span><span class='lparen token'>(</span><span class='string val'>'things'</span><span class='rparen token'>)</span>

  <span class='things identifier id'>things</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
  <span class='things identifier id'>things</span><span class='dot token'>.</span><span class='insert identifier id'>insert</span><span class='lparen token'>(</span><span class='string val'>'a'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>42</span><span class='rparen token'>)</span>
  <span class='things identifier id'>things</span><span class='dot token'>.</span><span class='insert identifier id'>insert</span><span class='lparen token'>(</span><span class='string val'>'a'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>99</span><span class='comma token'>,</span> <span class='string val'>'b'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rparen token'>)</span>
  <span class='puts identifier id'>puts</span> <span class='things identifier id'>things</span><span class='dot token'>.</span><span class='count identifier id'>count</span>                               <span class='comment val'># =&gt; 2</span>
  <span class='puts identifier id'>puts</span> <span class='things identifier id'>things</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='string val'>'a'</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>42</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='next_object identifier id'>next_object</span><span class='dot token'>.</span><span class='inspect identifier id'>inspect</span> <span class='comment val'># &lt;tt&gt;&amp;quot;a&amp;quot;=&amp;gt;42&lt;/tt&gt;</span>
</pre>
<h1>GridStore</h1>
<p>
The GridStore class is a Ruby implementation of Mongo&#8217;s GridFS file
storage system. An instance of GridStore is like an IO object. See the
rdocs for details, and see examples/gridfs.rb for code that uses many of
the GridStore features like metadata, content type, rewind/seek/tell, etc.
</p>
<p>
Note that the GridStore class is not automatically required when you
require &#8216;mongo&#8217;. You need to require
&#8216;mongo/gridfs&#8217;.
</p>
<p>
Example code:
</p>
<pre class="code">
  <span class='GridStore constant id'>GridStore</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='string val'>'filename'</span><span class='comma token'>,</span> <span class='string val'>'w'</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span> <span class='string val'>&quot;Hello, world!&quot;</span>
  <span class='rbrace token'>}</span>
  <span class='GridStore constant id'>GridStore</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='database identifier id'>database</span><span class='comma token'>,</span> <span class='string val'>'filename, '</span><span class='r identifier id'>r</span><span class='string val'>') { |f|
    puts f.read         # =&gt; Hello, world!\n
  }
  GridStore.open(database, '</span><span class='filename identifier id'>filename</span><span class='string val'>', '</span><span class='w identifier id'>w</span><span class='plus op'>+</span><span class='string val'>') { |f|
    f.puts &quot;But wait, there'</span><span class='s identifier id'>s</span> <span class='more! fid id'>more!</span><span class='string val'>&quot;
  }
  GridStore.open(database, 'filename, 'r') { |f|
    puts f.read         # =&gt; Hello, world!\nBut wait, there's more!\n
  }
</span></pre>
<h1>Notes</h1>
<h2>String Encoding</h2>
<p>
The BSON (&quot;Binary JSON&quot;) format used to communicate with Mongo
requires that strings be UTF-8 (http://en.wikipedia.org/wiki/UTF-8).
</p>
<p>
Ruby 1.9 has built-in character encoding support. All strings sent to Mongo
and received from Mongo are converted to UTF-8 when necessary, and strings
read from Mongo will have their character encodings set to UTF-8.
</p>
<p>
When used with Ruby 1.8, the bytes in each string are written to and read
from Mongo as-is. If the string is ASCII all is well, because ASCII is a
subset of UTF-8. If the string is not ASCII then it may not be a
well-formed UTF-8 string.
</p>
<h2>Primary Keys</h2>
<p>
The field _id is a primary key. It is treated specially by the database,
and its use makes many operations more efficient.
</p>
<p>
The value of an _id may be of any type. (Older versions of Mongo required
that they be XGen::Mongo::Driver::ObjectID instances.)
</p>
<p>
The database itself inserts an _id value if none is specified when a record
is inserted.
</p>
<p>
The driver automatically sends the _id field to the database first, which
is how Mongo likes it. You don&#8217;t have to worry about where the _id
field is in your hash record, or worry if you are using an OrderedHash or
not.
</p>
<h3>Primary Key Factories</h3>
<p>
A primary key factory is a class you supply to a DB object that knows how
to generate _id values. Primary key factories are no longer necessary
because Mongo now inserts an _id value for every record that does not
already have one. However, if you want to control _id values or even their
types, using a PK factory lets you do so.
</p>
<p>
You can tell the Ruby Mongo driver how to create primary keys by passing in
the :pk option to the Mongo#db method.
</p>
<pre class="code">
  <span class='include identifier id'>include</span> <span class='XGen constant id'>XGen</span><span class='colon2 op'>::</span><span class='Mongo constant id'>Mongo</span><span class='colon2 op'>::</span><span class='Driver constant id'>Driver</span>
  <span class='db identifier id'>db</span> <span class='assign token'>=</span> <span class='Mongo constant id'>Mongo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='db identifier id'>db</span><span class='lparen token'>(</span><span class='string val'>'dbname'</span><span class='comma token'>,</span> <span class='symbol val'>:pk</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='MyPKFactory constant id'>MyPKFactory</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='rparen token'>)</span>
</pre>
<p>
A primary key factory object must respond to :create_pk, which should take
a hash and return a hash which merges the original hash with any primary
key fields the factory wishes to inject. NOTE: if the object already has a
primary key, the factory should not inject a new key; this means that the
object is being used in a repsert but it already exists. The idea here is
that when ever a record is inserted, the :pk object&#8217;s
<tt>create_pk</tt> method will be called and the new hash returned will be
inserted.
</p>
<p>
Here is a sample primary key factory, taken from the tests:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='TestPKFactory constant id'>TestPKFactory</span>
    <span class='def def kw'>def</span> <span class='create_pk identifier id'>create_pk</span><span class='lparen token'>(</span><span class='row identifier id'>row</span><span class='rparen token'>)</span>
      <span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='string val'>'_id'</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='XGen constant id'>XGen</span><span class='colon2 op'>::</span><span class='Mongo constant id'>Mongo</span><span class='colon2 op'>::</span><span class='Driver constant id'>Driver</span><span class='colon2 op'>::</span><span class='ObjectID constant id'>ObjectID</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
      <span class='row identifier id'>row</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Here&#8217;s a slightly more sophisticated one that handles both symbol and
string keys. This is the PKFactory that comes with the MongoRecord code (an
ActiveRecord-like framework for non-Rails apps) and the AR Mongo adapter
code (for Rails):
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='PKFactory constant id'>PKFactory</span>
    <span class='def def kw'>def</span> <span class='create_pk identifier id'>create_pk</span><span class='lparen token'>(</span><span class='row identifier id'>row</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='row identifier id'>row</span> <span class='if if_mod kw'>if</span> <span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='symbol val'>:_id</span><span class='rbrack token'>]</span>
      <span class='row identifier id'>row</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:_id</span><span class='rparen token'>)</span>      <span class='comment val'># in case it exists but the value is nil</span>
      <span class='row identifier id'>row</span><span class='lbrack token'>[</span><span class='string val'>'_id'</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='XGen constant id'>XGen</span><span class='colon2 op'>::</span><span class='Mongo constant id'>Mongo</span><span class='colon2 op'>::</span><span class='Driver constant id'>Driver</span><span class='colon2 op'>::</span><span class='ObjectID constant id'>ObjectID</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
      <span class='row identifier id'>row</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
A database&#8217;s PK factory object may be set either when a DB object is
created or immediately after you obtain it, but only once. The only reason
it is changeable at all is so that libraries such as MongoRecord that use
this driver can set the PK factory after obtaining the database but before
using it for the first time.
</p>
<h2>The DB Class</h2>
<h3>Primary Key factories</h3>
<p>
See the section on &quot;Primary Keys&quot; above.
</p>
<h3>Strict mode</h3>
<p>
Each database has an optional strict mode. If strict mode is on, then
asking for a collection that does not exist will raise an error, as will
asking to create a collection that already exists. Note that both these
operations are completely harmless; strict mode is a programmer convenience
only.
</p>
<p>
To turn on strict mode, either pass in :strict =&gt; true when obtaining a
DB object or call the :strict= method:
</p>
<pre class="code">
  <span class='db identifier id'>db</span> <span class='assign token'>=</span> <span class='XGen constant id'>XGen</span><span class='colon2 op'>::</span><span class='Mongo constant id'>Mongo</span><span class='colon2 op'>::</span><span class='Driver constant id'>Driver</span><span class='colon2 op'>::</span><span class='Mongo constant id'>Mongo</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='db identifier id'>db</span><span class='lparen token'>(</span><span class='string val'>'dbname'</span><span class='comma token'>,</span> <span class='symbol val'>:strict</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='rparen token'>)</span>
  <span class='comment val'># I'm feeling lax</span>
  <span class='db identifier id'>db</span><span class='dot token'>.</span><span class='strict identifier id'>strict</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
  <span class='comment val'># No, I'm not!</span>
  <span class='db identifier id'>db</span><span class='dot token'>.</span><span class='strict identifier id'>strict</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
</pre>
<p>
The method DB#strict? returns the current value of that flag.
</p>
<h2>Cursors</h2>
<p>
Random cursor fun facts:
</p>
<ul>
<li>Cursors are enumerable.

</li>
<li>The query doesn&#8217;t get run until you actually attempt to retrieve data
from a cursor.

</li>
<li>Cursors have a to_a method.

</li>
</ul>
<h1>Testing</h1>
<p>
If you have the source code, you can run the tests.
</p>
<pre class="code">
  $ <span class='rake identifier id'>rake</span> <span class='test identifier id'>test</span>
</pre>
<p>
The tests assume that the Mongo database is running on the default port.
You can override the default host (localhost) and port
(Mongo::DEFAULT_PORT) by using the environment variables
MONGO_RUBY_DRIVER_HOST and MONGO_RUBY_DRIVER_PORT.
</p>
<p>
The project mongo-qa (http://github.com/mongodb/mongo-qa) contains many
more Mongo driver tests that are language independent. To run thoses tests
as part of the &quot;rake test&quot; task, download the code &quot;next
to&quot; this directory. So, after installing the mongo-qa code you would
have these two directories next to each other:
</p>
<pre class="code">
  $ <span class='ls identifier id'>ls</span>
  <span class='mongo identifier id'>mongo</span><span class='minus op'>-</span><span class='qa identifier id'>qa</span>
  <span class='mongo identifier id'>mongo</span><span class='minus op'>-</span><span class='ruby identifier id'>ruby</span><span class='minus op'>-</span><span class='driver identifier id'>driver</span>
  $ <span class='rake identifier id'>rake</span> <span class='test identifier id'>test</span>
</pre>
<p>
The tests run just fine if the mongo-qa directory is not there.
</p>
<p>
Additionally, the script bin/validate is used by the mongo-qa
project&#8217;s validator script.
</p>
<h1>Documentation</h1>
<p>
This documentation is available online at http://mongo.rubyforge.org. You
can generate the documentation if you have the source by typing
</p>
<pre class="code">
  $ <span class='rake identifier id'>rake</span> <span class='rdoc identifier id'>rdoc</span>
</pre>
<p>
Then open the file html/index.html.
</p>
<h1>Release Notes</h1>
<p>
See the git log comments.
</p>
<h1>To Do</h1>
<ul>
<li>Tests for update and repsert.

</li>
<li>Add a way to specify a collection of databases on startup (a simple array
of IP address/port numbers, perhaps, or a hash or something). The driver
would then find the master and, on each subsequent command, ask that
machine if it is the master before proceeding.

</li>
<li>Introduce optional per-database and per-collection PKInjector.

</li>
<li>More tests.

</li>
</ul>
<h2>Optimizations</h2>
<ul>
<li>Only update message sizes once, not after every write of a value. This will
require an explicit call to update_message_length in each message subclass.

</li>
<li>ensure_index commands should be cached to prevent excessive communication
with the database. (Or, the driver user should be informed that
ensure_index is not a lightweight operation for the particular driver.)

</li>
</ul>
<h1>Credits</h1>
<p>
Adrian Madrid, aemadrid@gmail.com
</p>
<ul>
<li>bin/mongo_console

</li>
<li>examples/benchmarks.rb

</li>
<li>examples/irb.rb

</li>
<li>Modifications to examples/simple.rb

</li>
<li>Found plenty of bugs and missing features.

</li>
<li>Ruby 1.9 support.

</li>
<li>Gem support.

</li>
<li>Many other code suggestions and improvements.

</li>
</ul>
<p>
Aman Gupta, aman@tmm1.net
</p>
<ul>
<li>Collection#save

</li>
</ul>
<h1>License</h1>
<pre class="code">
 <span class='Copyright constant id'>Copyright</span> <span class='integer val'>2008</span><span class='minus op'>-</span><span class='integer val'>2009</span> <span class='integer val'>10</span><span class='gen identifier id'>gen</span> <span class='Inc constant id'>Inc</span><span class='dot token'>.</span>

   <span class='Licensed constant id'>Licensed</span> <span class='under identifier id'>under</span> <span class='the identifier id'>the</span> <span class='Apache constant id'>Apache</span> <span class='License constant id'>License</span><span class='comma token'>,</span> <span class='Version constant id'>Version</span> <span class='float val'>2.0</span> <span class='lparen token'>(</span><span class='the identifier id'>the</span> <span class='string val'>&quot;License&quot;</span><span class='rparen token'>)</span><span class='semicolon token'>;</span>
   <span class='you identifier id'>you</span> <span class='may identifier id'>may</span> <span class='not not kw'>not</span> <span class='use identifier id'>use</span> <span class='this identifier id'>this</span> <span class='file identifier id'>file</span> <span class='except identifier id'>except</span> <span class='in in kw'>in</span> <span class='compliance identifier id'>compliance</span> <span class='with identifier id'>with</span> <span class='the identifier id'>the</span> <span class='License constant id'>License</span><span class='dot token'>.</span>
   <span class='You constant id'>You</span> <span class='may identifier id'>may</span> <span class='obtain identifier id'>obtain</span> <span class='a identifier id'>a</span> <span class='copy identifier id'>copy</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='License constant id'>License</span> <span class='at identifier id'>at</span>

       <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/www.apache.org/</span><span class='licenses identifier id'>licenses</span><span class='div op'>/</span><span class='LICENSE constant id'>LICENSE</span><span class='minus op'>-</span><span class='float val'>2.0</span>

   <span class='Unless constant id'>Unless</span> <span class='required identifier id'>required</span> <span class='by identifier id'>by</span> <span class='applicable identifier id'>applicable</span> <span class='law identifier id'>law</span> <span class='or or kw'>or</span> <span class='agreed identifier id'>agreed</span> <span class='to identifier id'>to</span> <span class='in in kw'>in</span> <span class='writing identifier id'>writing</span><span class='comma token'>,</span> <span class='software identifier id'>software</span>
   <span class='distributed identifier id'>distributed</span> <span class='under identifier id'>under</span> <span class='the identifier id'>the</span> <span class='License constant id'>License</span> <span class='is identifier id'>is</span> <span class='distributed identifier id'>distributed</span> <span class='on identifier id'>on</span> <span class='an identifier id'>an</span> <span class='string val'>&quot;AS IS&quot;</span> <span class='BASIS constant id'>BASIS</span><span class='comma token'>,</span>
   <span class='WITHOUT constant id'>WITHOUT</span> <span class='WARRANTIES constant id'>WARRANTIES</span> <span class='OR constant id'>OR</span> <span class='CONDITIONS constant id'>CONDITIONS</span> <span class='OF constant id'>OF</span> <span class='ANY constant id'>ANY</span> <span class='KIND constant id'>KIND</span><span class='comma token'>,</span> <span class='either identifier id'>either</span> <span class='express identifier id'>express</span> <span class='or or kw'>or</span> <span class='implied identifier id'>implied</span><span class='dot token'>.</span>
   <span class='See constant id'>See</span> <span class='the identifier id'>the</span> <span class='License constant id'>License</span> <span class='for for kw'>for</span> <span class='the identifier id'>the</span> <span class='specific identifier id'>specific</span> <span class='language identifier id'>language</span> <span class='governing identifier id'>governing</span> <span class='permissions identifier id'>permissions</span> <span class='and and kw'>and</span>
   <span class='limitations identifier id'>limitations</span> <span class='under identifier id'>under</span> <span class='the identifier id'>the</span> <span class='License constant id'>License</span><span class='dot token'>.</span>
</pre>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>