<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>alec-c4's oauth-plugin - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/alec-c4/commits/oauth-plugin/master" rel="alternate" title="Recent Commits to oauth-plugin:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("alec-c4", "oauth-plugin", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='alec-c4/oauth-plugin/blob/c3024d174f0c1cda81befe173b520e2f43578ff4' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='alec-c4/oauth-plugin/blob/c3024d174f0c1cda81befe173b520e2f43578ff4' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("alec-c4", "oauth-plugin", "c3024d174f0c1cda81befe173b520e2f43578ff4", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/alec-c4/oauth-plugin/tree/">Source</a></li>
            <li class=""><a href="http://github.com/alec-c4/oauth-plugin/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/alec-c4/oauth-plugin/network">Network</a></li>            
            <li class=""><a href="http://github.com/alec-c4/oauth-plugin/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/alec-c4/oauth-plugin">Wiki</a></li>
            <li class=""><a href="http://github.com/alec-c4/oauth-plugin/graphs">Graphs</a></li>                    
            <li class="active"><a href="/alec-c4/oauth-plugin">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/alec-c4">alec-c4</a> / <b><a href="http://github.com/alec-c4/oauth-plugin/tree">oauth-plugin</a></b>        
                <a id="namespaces_button" rel="alec-c4/oauth-plugin/blob/c3024d174f0c1cda81befe173b520e2f43578ff4" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="alec-c4/oauth-plugin/blob/c3024d174f0c1cda81befe173b520e2f43578ff4" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>OAuth Plugin</h1>
<p>
This is the beginning of a plugin for implementing OAuth Providers in Rails
applications.
</p>
<p>
See the OAuth specs at:
</p>
<p>
http://oauth.net/core/1.0/
</p>
<p>
and the OAuth site at:
</p>
<p>
http://oauth.net
</p>
<h2>Requirements</h2>
<p>
You need to install the oauth gem (0.2.1) which is the core OAuth ruby
library. It will NOT work on any previous version of the gem.
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='oauth identifier id'>oauth</span>
</pre>
<p>
The Generator currently creates code (in particular views) that only work
in Rails 2.
</p>
<p>
It should not be difficult to manually modify the code to work on Rails
1.2.x
</p>
<p>
I think the only real issue is that the views have .html.erb extensions. So
these could theoretically just be renamed to .rhtml.
</p>
<p>
Please let me know if this works and I will see if I can make the generator
conditionally create .rhtml for pre 2.0 versions of RAILS.
</p>
<h2>OAuth Provider generator</h2>
<p>
While it isn&#8217;t very flexible at the moment there is an oauth_provider
generator which you can use like this:
</p>
<p>
./script/generate oauth_provider
</p>
<p>
This generates OAuth and OAuth client controllers as well as the required
models.
</p>
<p>
It requires an authentication framework such as acts_as_authenticated,
restful_authentication or restful_open_id_authentication. It also requires
Rails 2.0.
</p>
<h3>Routes</h3>
<p>
You need to add the following to your routes (config/routes.rb)
</p>
<pre class="code">
        <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='resources identifier id'>resources</span> <span class='symbol val'>:oauth_clients</span>
        <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='authorize identifier id'>authorize</span> <span class='string val'>'/oauth/authorize'</span><span class='comma token'>,</span><span class='symbol val'>:controller=</span><span class='gt op'>&gt;</span><span class='string val'>'oauth'</span><span class='comma token'>,</span><span class='symbol val'>:action=</span><span class='gt op'>&gt;</span><span class='string val'>'authorize'</span>
        <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='request_token identifier id'>request_token</span> <span class='string val'>'/oauth/request_token'</span><span class='comma token'>,</span><span class='symbol val'>:controller=</span><span class='gt op'>&gt;</span><span class='string val'>'oauth'</span><span class='comma token'>,</span><span class='symbol val'>:action=</span><span class='gt op'>&gt;</span><span class='string val'>'request_token'</span>
        <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='access_token identifier id'>access_token</span> <span class='string val'>'/oauth/access_token'</span><span class='comma token'>,</span><span class='symbol val'>:controller=</span><span class='gt op'>&gt;</span><span class='string val'>'oauth'</span><span class='comma token'>,</span><span class='symbol val'>:action=</span><span class='gt op'>&gt;</span><span class='string val'>'access_token'</span>
        <span class='map identifier id'>map</span><span class='dot token'>.</span><span class='test_request identifier id'>test_request</span> <span class='string val'>'/oauth/test_request'</span><span class='comma token'>,</span><span class='symbol val'>:controller=</span><span class='gt op'>&gt;</span><span class='string val'>'oauth'</span><span class='comma token'>,</span><span class='symbol val'>:action=</span><span class='gt op'>&gt;</span><span class='string val'>'test_request'</span>
</pre>
<h3>User Model</h3>
<p>
Add the following lines to your user model:
</p>
<pre class="code">
  <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:client_applications</span>
  <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:tokens</span><span class='comma token'>,</span> <span class='symbol val'>:class_name=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;OauthToken&quot;</span><span class='comma token'>,</span><span class='symbol val'>:order=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;authorized_at desc&quot;</span><span class='comma token'>,</span><span class='symbol val'>:include=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:client_application</span><span class='rbrack token'>]</span>
</pre>
<h3>Migrate database</h3>
<p>
The database is defined in:
</p>
<pre class="code">
        <span class='db identifier id'>db</span><span class='div op'>/</span><span class='migrate identifier id'>migrate</span><span class='div op'>/</span><span class='XXX_create_oauth_tables constant id'>XXX_create_oauth_tables</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
Run them as any other normal migration in rails with:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='db identifier id'>db</span><span class='symbol val'>:migrate</span>
</pre>
<h3>RSpec</h3>
<p>
The generator installs a collection of RSpec (http://rspec.info) specs
instead of normal unit_tests. If you don&#8217;t use RSpec (and really why
aren&#8217;t you?) feel free to remove the spec folder.
</p>
<p>
If you would like to contribute regular unit tests I will accept them with
a smile.
</p>
<h2>Protecting your actions</h2>
<p>
I recommend that you think about what your users would want to provide
access to and limit oauth for those only. For example in a CRUD controller
you may think about if you want to let consumer applications do the create,
update or delete actions. For your application this might make sense, but
for others maybe not.
</p>
<p>
If you want to give oauth access to everything a registered user can do,
just replace the filter you have in your controllers with:
</p>
<pre class="code">
        <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:login_or_oauth_required</span>
</pre>
<p>
If you want to restrict consumers to the index and show methods of your
controller do the following:
</p>
<pre class="code">
        <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:login_required</span><span class='comma token'>,</span><span class='symbol val'>:except=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:show</span><span class='comma token'>,</span><span class='symbol val'>:index</span><span class='rbrack token'>]</span>
        <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:login_or_oauth_required</span><span class='comma token'>,</span><span class='symbol val'>:only=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:show</span><span class='comma token'>,</span><span class='symbol val'>:index</span><span class='rbrack token'>]</span>
</pre>
<p>
If you have an action you only want used via oauth:
</p>
<pre class="code">
        <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:oauth_required</span>
</pre>
<p>
All of these places the tokens user in current_user as you would expect. It
also exposes the following methods:
</p>
<ul>
<li>current_token - for accessing the token used to authorize the current
request

</li>
<li>current_client_application - for accessing information about which consumer
is currently accessing your request

</li>
</ul>
<p>
You could add application specific information to the OauthToken and
ClientApplication model for such things as object level access control,
billing, expiry etc. Be creative and you can create some really cool
applications here.
</p>
<h2>More</h2>
<p>
The Google Code project is http://code.google.com/p/oauth-plugin/
</p>
<p>
The Mailing List for all things OAuth in Ruby is:
</p>
<p>
http://groups.google.com/group/oauth-ruby
</p>
<p>
The Mailing list for everything else OAuth is:
</p>
<p>
http://groups.google.com/group/oauth
</p>
<p>
The OAuth Ruby Gem home page is http://oauth.rubyforge.org
</p>
<p>
Please help documentation, patches and testing.
</p>
<p>
Copyright &#169; 2007-2008 Pelle Braendgaard, released under the MIT
license
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>