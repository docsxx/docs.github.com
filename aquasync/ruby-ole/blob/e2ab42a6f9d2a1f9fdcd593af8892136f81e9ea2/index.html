<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>aquasync's ruby-ole - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/aquasync/commits/ruby-ole/master" rel="alternate" title="Recent Commits to ruby-ole:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("aquasync", "ruby-ole", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='aquasync/ruby-ole/blob/e2ab42a6f9d2a1f9fdcd593af8892136f81e9ea2' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='aquasync/ruby-ole/blob/e2ab42a6f9d2a1f9fdcd593af8892136f81e9ea2' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("aquasync", "ruby-ole", "e2ab42a6f9d2a1f9fdcd593af8892136f81e9ea2", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/aquasync/ruby-ole/tree/">Source</a></li>
            <li class=""><a href="http://github.com/aquasync/ruby-ole/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/aquasync/ruby-ole/network">Network</a></li>            
            <li class=""><a href="http://github.com/aquasync/ruby-ole/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/aquasync/ruby-ole">Wiki</a></li>
            <li class=""><a href="http://github.com/aquasync/ruby-ole/graphs">Graphs</a></li>                    
            <li class="active"><a href="/aquasync/ruby-ole">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/aquasync">aquasync</a> / <b><a href="http://github.com/aquasync/ruby-ole/tree">ruby-ole</a></b>        
                <a id="namespaces_button" rel="aquasync/ruby-ole/blob/e2ab42a6f9d2a1f9fdcd593af8892136f81e9ea2" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="aquasync/ruby-ole/blob/e2ab42a6f9d2a1f9fdcd593af8892136f81e9ea2" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Introduction</h1>
<p>
The ruby-ole library provides a variety of functions primarily for working
with OLE2 structured storage files, such as those produced by Microsoft
Office - eg *.doc, *.msg etc.
</p>
<h1>Example Usage</h1>
<p>
Here are some examples of how to use the library functionality, categorised
roughly by purpose.
</p>
<ol>
<li>Reading and writing files within an OLE container

<p>
The recommended way to manipulate the contents is via the
&quot;file_system&quot; API, whereby you use Ole::Storage instance methods
similar to the regular File and Dir class methods.
</p>
<pre class="code">
  <span class='ole identifier id'>ole</span> <span class='assign token'>=</span> <span class='Ole constant id'>Ole</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>'oleWithDirs.ole'</span><span class='comma token'>,</span> <span class='string val'>'rb+'</span><span class='rparen token'>)</span>
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='dir identifier id'>dir</span><span class='dot token'>.</span><span class='entries identifier id'>entries</span><span class='lparen token'>(</span><span class='string val'>'.'</span><span class='rparen token'>)</span> <span class='comment val'># =&gt; [&quot;.&quot;, &quot;..&quot;, &quot;dir1&quot;, &quot;dir2&quot;, &quot;file1&quot;]</span>
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='file identifier id'>file</span><span class='dot token'>.</span><span class='read identifier id'>read</span><span class='lparen token'>(</span><span class='string val'>'file1'</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='comma token'>,</span> <span class='integer val'>25</span><span class='rbrack token'>]</span> <span class='comment val'># =&gt; &quot;this is the entry 'file1'&quot;</span>
  <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='dir identifier id'>dir</span><span class='dot token'>.</span><span class='mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='string val'>'newdir'</span><span class='rparen token'>)</span>
</pre>
</li>
<li>Accessing OLE meta data

<p>
Some convenience functions are provided for (currently read only) access to
OLE property sets and other sources of meta data.
</p>
<pre class="code">
  <span class='ole identifier id'>ole</span> <span class='assign token'>=</span> <span class='Ole constant id'>Ole</span><span class='colon2 op'>::</span><span class='Storage constant id'>Storage</span><span class='dot token'>.</span><span class='open identifier id'>open</span><span class='lparen token'>(</span><span class='string val'>'test_word_95.doc'</span><span class='rparen token'>)</span>
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='meta_data identifier id'>meta_data</span><span class='dot token'>.</span><span class='file_format identifier id'>file_format</span> <span class='comment val'># =&gt; &quot;MSWordDoc&quot;</span>
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='meta_data identifier id'>meta_data</span><span class='dot token'>.</span><span class='mime_type identifier id'>mime_type</span> <span class='comment val'># =&gt; &quot;application/msword&quot;</span>
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='meta_data identifier id'>meta_data</span><span class='dot token'>.</span><span class='doc_author identifier id'>doc_author</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='comment val'># =&gt; &quot;Charles&quot;</span>
</pre>
</li>
<li>Raw access to underlying OLE internals

<p>
This is probably of little interest to most developers using the library,
but for some use cases you may need to drop down to the lower level API on
which the &quot;file_system&quot; API is constructed, which exposes more of
the format details.
</p>
<p>
<tt>Ole::Storage</tt> files can have multiple files with the same name, or
with a slash in the name, and other things that are probably strictly
invalid. This API is the only way to access those files.
</p>
<p>
You can access the header object directly:
</p>
<pre class="code">
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='num_sbat identifier id'>num_sbat</span> <span class='comment val'># =&gt; 1</span>
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='header identifier id'>header</span><span class='dot token'>.</span><span class='magic identifier id'>magic</span><span class='dot token'>.</span><span class='unpack identifier id'>unpack</span><span class='lparen token'>(</span><span class='string val'>'H*'</span><span class='rparen token'>)</span> <span class='comment val'># =&gt; [&quot;d0cf11e0a1b11ae1&quot;]</span>
</pre>
<p>
You can directly access the array of all Dirent objects, including the
root:
</p>
<pre class="code">
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='dirents identifier id'>dirents</span><span class='dot token'>.</span><span class='length identifier id'>length</span> <span class='comment val'># =&gt; 5</span>
  <span class='puts identifier id'>puts</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='to_tree identifier id'>to_tree</span>
  <span class='comment val'># =&gt;</span>
  <span class='minus op'>-</span> <span class='comment val'>#&lt;Dirent:&quot;Root Entry&quot;&gt;</span>
    <span class='bitor op'>|</span><span class='minus op'>-</span> <span class='comment val'>#&lt;Dirent:&quot;\001Ole&quot; size=20 data=&quot;\001\000\000\002\000...&quot;&gt;</span>
    <span class='bitor op'>|</span><span class='minus op'>-</span> <span class='comment val'>#&lt;Dirent:&quot;\001CompObj&quot; size=98 data=&quot;\001\000\376\377\003...&quot;&gt;</span>
    <span class='bitor op'>|</span><span class='minus op'>-</span> <span class='comment val'>#&lt;Dirent:&quot;WordDocument&quot; size=2574 data=&quot;\334\245e\000-...&quot;&gt;</span>
    \<span class='minus op'>-</span> <span class='comment val'>#&lt;Dirent:&quot;\005SummaryInformation&quot; size=54788 data=&quot;\376\377\000\000\001...&quot;&gt;</span>
</pre>
<p>
You can access (through RangesIO methods, or by using the relevant Dirent
and AllocationTable methods) information like where within the container a
stream is located (these are offset/length pairs):
</p>
<pre class="code">
  <span class='p identifier id'>p</span> <span class='ole identifier id'>ole</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='lbrack token'>[</span><span class='string val'>&quot;\001CompObj&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='open identifier id'>open</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='io identifier id'>io</span><span class='bitor op'>|</span> <span class='io identifier id'>io</span><span class='dot token'>.</span><span class='ranges identifier id'>ranges</span> <span class='rbrace token'>}</span> <span class='comment val'># =&gt; [[0, 64], [64, 34]]</span>
</pre>
</li>
</ol>
<p>
See the documentation for each class for more details.
</p>
<h1>Thanks</h1>
<ul>
<li>The code contained in this project was initially based on chicago&#8217;s
libole (source available at http://prdownloads.sf.net/chicago/ole.tgz).

</li>
<li>It was later augmented with some corrections by inspecting pole, and
(purely for header definitions) gsf.

</li>
<li>The property set parsing code came from the apache java project POIFS.

</li>
<li>The excellent idea for using a pseudo file system style interface by
providing #file and #dir methods which mimic File and Dir, was borrowed
(along with almost unchanged tests!) from Thomas Sondergaard&#8217;s
rubyzip.

</li>
</ul>
<h1>TODO</h1>
<h2>1.2.11</h2>
<ul>
<li>internal api cleanup

</li>
<li>add buffering to rangesio so that performance for small reads and writes
isn&#8217;t so awful. maybe try and remove the bottlenecks of unbuffered
first with more profiling, then implement the buffering on top of that.

</li>
<li>fix mode strings - like truncate when using &#8216;w<tt>&#8217;, supporting
append &#8216;a</tt>&#8217; modes etc. done?

</li>
<li>make ranges io obey readable vs writeable modes.

</li>
<li>more RangesIO completion. ie, doesn&#8217;t support #&lt;&lt; at the
moment.

</li>
<li>maybe some oletool doc.

</li>
<li>make sure `rake test&#8217; runs tests both with $KCODE=&#8217;UTF8&#8217;,
and without, and maybe ensure i don&#8217;t regress on 1.9 and jruby either
now that they&#8217;re fixed.

</li>
</ul>
<h2>1.3.1</h2>
<ul>
<li>case insensitive open mode would be nice

</li>
<li>fix property sets a bit more. see TODO in Ole::Storage::MetaData

</li>
<li>ability to zero out padding and unused blocks

</li>
<li>case insensitive mode for ole/file_system?

</li>
<li>better tests for mbat support.

</li>
<li>further doc cleanup

</li>
<li>add in place testing for jruby and ruby1.9

</li>
</ul>
<h2>Longer term</h2>
<ul>
<li>more benchmarking, profiling, and speed fixes. was thinking vs other ruby
filesystems (eg, vs File/Dir itself, and vs rubyzip), and vs other ole
implementations (maybe perl&#8217;s, and poifs) just to check its in the
ballpark, with no remaining silly bottlenecks.

</li>
<li>supposedly vba does something weird to ole files. test that.

</li>
</ul>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>