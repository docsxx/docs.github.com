<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>mtodd's halcyon - Class: Halcyon::Application - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/mtodd/commits/halcyon/master" rel="alternate" title="Recent Commits to halcyon:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("mtodd", "halcyon", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("mtodd", "halcyon", "c4cb414bf7b05176c844ff589a580aacf82d5748", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/mtodd/halcyon/tree/">Source</a></li>
            <li class=""><a href="http://github.com/mtodd/halcyon/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/mtodd/halcyon/network">Network</a></li>            
            <li class=""><a href="http://github.com/mtodd/halcyon/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/mtodd/halcyon">Wiki</a></li>
            <li class=""><a href="http://github.com/mtodd/halcyon/graphs">Graphs</a></li>                    
            <li class="active"><a href="/mtodd/halcyon">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/mtodd">mtodd</a> / <b><a href="http://github.com/mtodd/halcyon/tree">halcyon</a></b>        
                <a id="namespaces_button" rel="mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Halcyon_Application">
  <h1>Class: Halcyon::Application</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p><a href="Application/Exceptions.html" title="Halcyon::Exceptions">Halcyon::Exceptions</a>, <a href="Application/Hooks.html" title="Halcyon::Application::Hooks">Halcyon::Application::Hooks</a></p>
</div><div class="section docstring">
  <p>
The core of Halcyon on the server side is the Halcyon::Application class
which handles dispatching requests and responding with appropriate messages
to the client (which can be specified).
</p>
<p>
Manages shutting down and starting up hooks, routing, dispatching, etc.
Also restricts the requests to acceptable clients, defaulting to all.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Class Attributes</h2>
      <table>
      
        <tr>
          <th class="name">booted</td>
          <td class="readwrite">
            [<span id='booted-class_method'>R</span><span id='booted=-class_method'>W</span>] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
&#8212; Boot Process ++ Used to keep track of whether the boot process has
been run yet.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="Router-constant">Router</dt>
      <dd>Merb::Router</dd>
    
  </dl>
</div>
<div class="included">
  
  <div>
    <h2>Constants Included from <a href="Application/Exceptions.html" title="Halcyon::Exceptions">Halcyon::Exceptions</a></h2>
    <p><span class='name'><a href="Exceptions.html#HTTP_STATUS_CODES-constant" title="HTTP_STATUS_CODES">HTTP_STATUS_CODES</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Initializes the app:
</p>
<ul>
<li>runs startup hooks

</li>
<li>registers shutdown hooks

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/halcyon/application.rb', line 22</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748/lib/halcyon/application.rb#L22">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='string val'>&quot;Starting up...&quot;</span>
  
  <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='hooks identifier id'>hooks</span><span class='lbrack token'>[</span><span class='symbol val'>:startup</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='hook identifier id'>hook</span><span class='bitor op'>|</span> <span class='hook identifier id'>hook</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  
  <span class='comment val'># clean after ourselves and get prepared to start serving things</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='string val'>&quot;Starting GC.&quot;</span>
  <span class='GC constant id'>GC</span><span class='dot token'>.</span><span class='start identifier id'>start</span>
  
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Started. PID is #{$$}&quot;</span>
  
  <span class='at_exit identifier id'>at_exit</span> <span class='do do kw'>do</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Shutting down #{$$}.&quot;</span>
    <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='hooks identifier id'>hooks</span><span class='lbrack token'>[</span><span class='symbol val'>:shutdown</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='hook identifier id'>hook</span><span class='bitor op'>|</span> <span class='hook identifier id'>hook</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='string val'>&quot;Done.&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#boot-class_method">boot</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Runs through the bootup process.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#route-class_method">route</span><span class='args'>(&amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Defines routes for the application.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#acceptable_request-21-instance_method">#acceptable_request!</span><span class='args'>(env)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
def apply_filters(where, controller, action)
</p>
<pre class="code">
  <span class='self self kw'>self</span><span class='dot token'>.</span>
</pre>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#call-instance_method">#call</span><span class='args'>(env)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Sets up the request and response objects for use in the controllers and
dispatches requests.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#dispatch-instance_method">#dispatch</span><span class='args'>(env)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Dispatches the controller and action according the routed request.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#filter_params_for_log-instance_method">#filter_params_for_log</span><span class='args'>(request, env)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Assemble params for logging.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>boot</h3>
</div><div id="boot-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>boot</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Runs through the bootup process. This involves:
</p>
<ul>
<li>establishing configuration directives

</li>
<li>loading required libraries

</li>
</ul>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/halcyon/application.rb', line 274</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748/lib/halcyon/application.rb#L274">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='boot identifier id'>boot</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span> <span class='opasgn op'>||=</span> <span class='Halcyon constant id'>Halcyon</span><span class='colon2 op'>::</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
  <span class='comment val'># Set application name</span>
  <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='app identifier id'>app</span> <span class='assign token'>=</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:app</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='root identifier id'>root</span><span class='dot token'>.</span><span class='split identifier id'>split</span><span class='lparen token'>(</span><span class='string val'>'/'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='last identifier id'>last</span><span class='dot token'>.</span><span class='camel_case identifier id'>camel_case</span>
  
  <span class='comment val'># Load configuration files (when available)</span>
  <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span><span class='lparen token'>(</span><span class='dstring node'>%w(config app)</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='conf identifier id'>conf</span><span class='bitor op'>|</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='paths identifier id'>paths</span><span class='lbrack token'>[</span><span class='symbol val'>:config</span><span class='rbrack token'>]</span><span class='div op'>/</span><span class='conf identifier id'>conf</span><span class='plus op'>+</span><span class='string val'>'.{yml,yaml}'</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='config_file identifier id'>config_file</span><span class='bitor op'>|</span>
    <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='dot token'>.</span><span class='load_from identifier id'>load_from</span><span class='lparen token'>(</span><span class='config_file identifier id'>config_file</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='config_file identifier id'>config_file</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Run configuration files (when available)</span>
  <span class='comment val'># These are unique in that they are Ruby files that we require so we</span>
  <span class='comment val'># can get rid of YAML config files and use Ruby configuration files.</span>
  <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span><span class='lparen token'>(</span><span class='dstring node'>%w(init config environment)</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='file identifier id'>file</span><span class='bitor op'>|</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='paths identifier id'>paths</span><span class='lbrack token'>[</span><span class='symbol val'>:config</span><span class='rbrack token'>]</span><span class='div op'>/</span><span class='file identifier id'>file</span><span class='plus op'>+</span><span class='string val'>'.rb'</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='config_file identifier id'>config_file</span><span class='bitor op'>|</span>
    <span class='require identifier id'>require</span> <span class='config_file identifier id'>config_file</span> <span class='if if_mod kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='config_file identifier id'>config_file</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Yield to the block to handle boot configuration (and other tasks).</span>
  <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='dot token'>.</span><span class='use identifier id'>use</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
  
  <span class='comment val'># Setup logger</span>
  <span class='if if kw'>if</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span>
    <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:logging</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:logging</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='Halcyon constant id'>Halcyon</span><span class='colon2 op'>::</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='defaults identifier id'>defaults</span><span class='lbrack token'>[</span><span class='symbol val'>:logging</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='lbrace token'>{</span>
      <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span>
      <span class='symbol val'>:logger</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span>
    <span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='Halcyon constant id'>Halcyon</span><span class='colon2 op'>::</span><span class='Logging constant id'>Logging</span><span class='dot token'>.</span><span class='set identifier id'>set</span><span class='lparen token'>(</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:logging</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span> <span class='assign token'>=</span> <span class='Halcyon constant id'>Halcyon</span><span class='colon2 op'>::</span><span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='setup identifier id'>setup</span><span class='lparen token'>(</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:logging</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  
  <span class='comment val'># Run initializers</span>
  <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span><span class='lparen token'>(</span><span class='dstring node'>%w(requires hooks routes *)</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='init identifier id'>init</span><span class='bitor op'>|</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='paths identifier id'>paths</span><span class='lbrack token'>[</span><span class='symbol val'>:init</span><span class='rbrack token'>]</span><span class='div op'>/</span><span class='init identifier id'>init</span><span class='plus op'>+</span><span class='string val'>'.rb'</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='initializer identifier id'>initializer</span><span class='bitor op'>|</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Init: #{File.basename(initializer).chomp('.rb').camel_case}&quot;</span> <span class='if if_mod kw'>if</span>
    <span class='require identifier id'>require</span> <span class='initializer identifier id'>initializer</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span><span class='lparen token'>(</span><span class='string val'>'.rb'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Setup autoloads for Controllers found in Halcyon.root/'app' (by default)</span>
  <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='paths identifier id'>paths</span><span class='lbrack token'>[</span><span class='symbol val'>:controller</span><span class='rbrack token'>]</span><span class='div op'>/</span><span class='string val'>'application.rb'</span><span class='comma token'>,</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='paths identifier id'>paths</span><span class='lbrack token'>[</span><span class='symbol val'>:controller</span><span class='rbrack token'>]</span><span class='div op'>/</span><span class='string val'>'*.rb'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='controller identifier id'>controller</span><span class='bitor op'>|</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Load: #{File.basename(controller).chomp('.rb').camel_case} Controller&quot;</span> <span class='if if_mod kw'>if</span>
    <span class='require identifier id'>require</span> <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span><span class='lparen token'>(</span><span class='string val'>'.rb'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Setup autoloads for Models found in Halcyon.root/'app'/'models' (by default)</span>
  <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span><span class='lparen token'>(</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='paths identifier id'>paths</span><span class='lbrack token'>[</span><span class='symbol val'>:model</span><span class='rbrack token'>]</span><span class='div op'>/</span><span class='string val'>'*.rb'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='model identifier id'>model</span><span class='bitor op'>|</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Load: #{File.basename(model).chomp('.rb').camel_case} Model&quot;</span> <span class='if if_mod kw'>if</span>
    <span class='require identifier id'>require</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='chomp identifier id'>chomp</span><span class='lparen token'>(</span><span class='string val'>'.rb'</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Set to loaded so additional calls to boot are ignored (unless</span>
  <span class='comment val'># forcefully loaded by ignoring this value).</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='booted identifier id'>booted</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>route</h3>
</div><div id="route-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>route</span><span class='args'>(&amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Defines routes for the application.
</p>
<p>
Refer to Halcyon::Application::Router for documentation and resources.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/halcyon/application.rb', line 259</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748/lib/halcyon/application.rb#L259">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">259
260
261</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='route identifier id'>route</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='Router constant id'>Router</span><span class='dot token'>.</span><span class='default_to identifier id'>default_to</span> <span class='Router constant id'>Router</span><span class='dot token'>.</span><span class='prepare identifier id'>prepare</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'application'</span><span class='comma token'>,</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'not_found'</span><span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div><div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>acceptable_request!</h3>
</div><div id="acceptable_request-21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>acceptable_request!</span><span class='args'>(env)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
def apply_filters(where, controller, action)
</p>
<pre class="code">
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Applying #{where.to_s} filters to #{controller.class.to_s}##{action.to_s}&quot;</span>
  <span class='if if kw'>if</span> <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='filters identifier id'>filters</span><span class='lbrack token'>[</span><span class='symbol val'>:all</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='action identifier id'>action</span><span class='rparen token'>)</span>
    <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='filters identifier id'>filters</span><span class='lbrack token'>[</span><span class='symbol val'>:all</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='action identifier id'>action</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='filter identifier id'>filter</span><span class='bitor op'>|</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:apply</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='where identifier id'>where</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='filter identifier id'>filter</span><span class='bitor op'>|</span>
      <span class='if if kw'>if</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:filter_or_block</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Proc constant id'>Proc</span><span class='rparen token'>)</span>
        <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:filter_or_block</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span>
      <span class='else else kw'>else</span>
        <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:filter_or_block</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='filters identifier id'>filters</span><span class='lbrack token'>[</span><span class='symbol val'>:only</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='action identifier id'>action</span><span class='rparen token'>)</span>
    <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='filters identifier id'>filters</span><span class='lbrack token'>[</span><span class='symbol val'>:only</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='action identifier id'>action</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='filter identifier id'>filter</span><span class='bitor op'>|</span> <span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:apply</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='where identifier id'>where</span> <span class='andop op'>&amp;&amp;</span> <span class='filter identifier id'>filter</span><span class='rbrace token'>}</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='filter identifier id'>filter</span><span class='bitor op'>|</span>
      <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:filter_or_block</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='filters identifier id'>filters</span><span class='lbrack token'>[</span><span class='symbol val'>:except</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='lparen token'>(</span><span class='filters_not_for_action identifier id'>filters_not_for_action</span><span class='comma token'>,</span> <span class='filters identifier id'>filters</span><span class='rparen token'>)</span><span class='bitor op'>|</span>
    <span class='unless unless kw'>unless</span> <span class='filters_not_for_action identifier id'>filters_not_for_action</span> <span class='eq op'>==</span> <span class='action identifier id'>action</span>
      <span class='filters identifier id'>filters</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='filter identifier id'>filter</span><span class='bitor op'>|</span>
        <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='filter identifier id'>filter</span><span class='lbrack token'>[</span><span class='symbol val'>:filter_or_block</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
end Filters unacceptable requests depending on the configuration of the
<tt>:allow_from</tt> option.
</p>
<p>
This method is not directly called by the user, instead being called in the
#call method.
</p>
<p>
Acceptable values include:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='symbol val'>:all</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;:: allow every request to go through
  &lt;tt&gt;:halcyon_clients&lt;/</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='colon3 op'>::</span> <span class='only identifier id'>only</span> <span class='allow identifier id'>allow</span> <span class='Halcyon constant id'>Halcyon</span> <span class='clients identifier id'>clients</span>
  <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='symbol val'>:local</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;:: do not allow for requests from an outside host
</span></pre>
<p>
Raises Forbidden
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/halcyon/application.rb', line 227</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748/lib/halcyon/application.rb#L227">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">227
228
229
230
231
232
233
234
235
236
237
238
239
240</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='acceptable_request! fid id'>acceptable_request!</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:allow_from</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:all</span>
    <span class='comment val'># allow every request to go through</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:halcyon_clients</span>
    <span class='comment val'># only allow Halcyon clients</span>
    <span class='raise identifier id'>raise</span> <span class='Forbidden constant id'>Forbidden</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='unless unless_mod kw'>unless</span> <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'USER_AGENT'</span><span class='rbrack token'>]</span> <span class='match op'>=~</span> <span class='regexp val'>/JSON\/1\.1\.\d+ Compatible \(en-US\) Halcyon::Client\(\d+\.\d+\.\d+\)/</span>
  <span class='when when kw'>when</span> <span class='symbol val'>:local</span>
    <span class='comment val'># do not allow for requests from an outside host</span>
    <span class='raise identifier id'>raise</span> <span class='Forbidden constant id'>Forbidden</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='unless unless_mod kw'>unless</span> <span class='lbrack token'>[</span><span class='string val'>'localhost'</span><span class='comma token'>,</span> <span class='string val'>'127.0.0.1'</span><span class='comma token'>,</span> <span class='string val'>'0.0.0.0'</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='member? fid id'>member?</span> <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>&quot;REMOTE_ADDR&quot;</span><span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='warn identifier id'>warn</span> <span class='dstring node'>&quot;Unrecognized allow_from configuration value (#{Halcyon.config[:allow_from].to_s}); use all, halcyon_clients, or local. Allowing all requests.&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>call</h3>
</div><div id="call-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>call</span><span class='args'>(env)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Sets up the request and response objects for use in the controllers and
dispatches requests. Renders response data as JSON for response.
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='env identifier id'>env</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; the request environment details
</span></pre>
<p>
The internal router (which inherits from the Merb router) is sent the
request to pass back the route for the dispatcher to call. This route is
stored in <tt>env[&#8216;halcyon.route&#8217;]</tt> (as per the Rack spec).
</p>
<p>
Configs
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='Halcyon constant id'>Halcyon</span><span class='dot token'>.</span><span class='config identifier id'>config</span><span class='lbrack token'>[</span><span class='symbol val'>:allow_from</span><span class='rbrack token'>]</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; #=&gt; (default) &lt;tt&gt;:all&lt;/</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span>
    <span class='symbol val'>:all</span>              <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='does identifier id'>does</span> <span class='not not kw'>not</span> <span class='restrict identifier id'>restrict</span> <span class='requests identifier id'>requests</span> <span class='from identifier id'>from</span> <span class='any identifier id'>any</span> <span class='User constant id'>User</span><span class='minus op'>-</span><span class='Agent constant id'>Agent</span>
    <span class='symbol val'>:local</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='restricts identifier id'>restricts</span> <span class='requests identifier id'>requests</span> <span class='to identifier id'>to</span> <span class='only identifier id'>only</span> <span class='local identifier id'>local</span> <span class='requests identifier id'>requests</span> <span class='lparen token'>(</span><span class='from identifier id'>from</span>
                         <span class='localhost identifier id'>localhost</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='float val'>.0.0</span><span class='integer val'>.0</span><span class='comma token'>,</span> <span class='float val'>127.0</span><span class='float val'>.0.1</span><span class='rparen token'>)</span>
    <span class='symbol val'>:halcyon_clients</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='restricts identifier id'>restricts</span> <span class='to identifier id'>to</span> <span class='only identifier id'>only</span> <span class='Halcyon constant id'>Halcyon</span> <span class='clients identifier id'>clients</span> <span class='lparen token'>(</span><span class='identified identifier id'>identified</span> <span class='by identifier id'>by</span>
                         <span class='User constant id'>User</span><span class='minus op'>-</span><span class='Agent constant id'>Agent</span><span class='rparen token'>)</span>
</pre>
<p>
Exceptions
</p>
<pre class="code">
  <span class='If constant id'>If</span> <span class='a identifier id'>a</span> <span class='request identifier id'>request</span> <span class='raises identifier id'>raises</span> <span class='an identifier id'>an</span> <span class='exception identifier id'>exception</span> <span class='that identifier id'>that</span> <span class='inherits identifier id'>inherits</span> <span class='from identifier id'>from</span>
  <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='Halcyon constant id'>Halcyon</span><span class='colon2 op'>::</span><span class='Exceptions constant id'>Exceptions</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; (&lt;tt&gt;NotFound&lt;/</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='comma token'>,</span> <span class='etc identifier id'>etc</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='then then kw'>then</span> <span class='the identifier id'>the</span>
  <span class='response identifier id'>response</span> <span class='is identifier id'>is</span> <span class='sent identifier id'>sent</span> <span class='with identifier id'>with</span> <span class='this identifier id'>this</span> <span class='information identifier id'>information</span><span class='dot token'>.</span>
  <span class='If constant id'>If</span> <span class='a identifier id'>a</span> <span class='request identifier id'>request</span> <span class='raises identifier id'>raises</span> <span class='any identifier id'>any</span> <span class='other identifier id'>other</span> <span class='kind identifier id'>kind</span> <span class='of identifier id'>of</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='Exception constant id'>Exception</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;, it is logged
  as an error and a &lt;tt&gt;500 Internal Server Error&lt;/</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span> <span class='is identifier id'>is</span> <span class='returned identifier id'>returned</span><span class='dot token'>.</span>
</pre>
<p>
Returns [Fixnum:status, <tt>=&amp;gt; String:value</tt>,
[String:body].to_json]
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/halcyon/application.rb', line 65</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748/lib/halcyon/application.rb#L65">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='timing identifier id'>timing</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:started</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='rbrace token'>}</span>
  
  <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='Rack constant id'>Rack</span><span class='colon2 op'>::</span><span class='Response constant id'>Response</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  
  <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='string val'>'Content-Type'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>&quot;application/json&quot;</span>
  <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='string val'>'User-Agent'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;JSON/#{JSON::VERSION} Compatible (en-US) Halcyon::Application/#{Halcyon.version}&quot;</span>
  
  <span class='begin begin kw'>begin</span>
    <span class='acceptable_request! fid id'>acceptable_request!</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
    
    <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'halcyon.route'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Router constant id'>Router</span><span class='dot token'>.</span><span class='route identifier id'>route</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='rparen token'>)</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='dispatch identifier id'>dispatch</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Exceptions constant id'>Exceptions</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='status identifier id'>status</span><span class='comma token'>,</span> <span class='symbol val'>:body</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='body identifier id'>body</span><span class='rbrace token'>}</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='message identifier id'>message</span>
  <span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>500</span><span class='comma token'>,</span> <span class='symbol val'>:body</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Internal Server Error'</span><span class='rbrace token'>}</span>
    <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='error identifier id'>error</span> <span class='dstring node'>&quot;#{e.message}\n\t&quot;</span> <span class='lshft op'>&lt;&lt;</span> <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='backtrace identifier id'>backtrace</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;\n\t&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># This handles various sorts of response formats.</span>
  <span class='comment val'># </span>
  <span class='comment val'># The primary format is &lt;tt&gt;{:status =&gt; 200, :body =&gt; ...}&lt;/tt&gt; which</span>
  <span class='comment val'># also supports a &lt;tt&gt;:headers&lt;/tt&gt; entity (also a Hash).</span>
  <span class='comment val'># </span>
  <span class='comment val'># If this format is not followed, we assume they've just returned data so</span>
  <span class='comment val'># we package it up like normal and respond (for the user).</span>
  <span class='comment val'># </span>
  <span class='comment val'># The one exception to the previous rule is if the data is in the</span>
  <span class='comment val'># standard response structure [200, {}, 'OK'] or some such, we construct</span>
  <span class='comment val'># the reply accordingly.</span>
  <span class='comment val'># </span>
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='integer val'>200</span> <span class='comment val'># we assume 200, but when specified get updated appropriately</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='result identifier id'>result</span>
  <span class='when when kw'>when</span> <span class='Hash constant id'>Hash</span>
    <span class='if if kw'>if</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='symbol val'>:status</span><span class='rbrack token'>]</span> <span class='and and kw'>and</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='symbol val'>:body</span><span class='rbrack token'>]</span>
      <span class='comment val'># {:status =&gt; 200, :body =&gt; 'OK'}</span>
      <span class='comment val'># no coercion necessary</span>
      <span class='result identifier id'>result</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># {*}</span>
      <span class='lbrace token'>{</span><span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>200</span><span class='comma token'>,</span> <span class='symbol val'>:body</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='result identifier id'>result</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='when when kw'>when</span> <span class='Array constant id'>Array</span>
    <span class='if if kw'>if</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Integer constant id'>Integer</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span>
      <span class='comment val'># [200, {}, 'OK'] format followed</span>
      <span class='lbrace token'>{</span><span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:headers</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='symbol val'>:body</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='rbrace token'>}</span>
    <span class='else else kw'>else</span>
      <span class='comment val'># [*]</span>
      <span class='lbrace token'>{</span><span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>200</span><span class='comma token'>,</span> <span class='symbol val'>:body</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='result identifier id'>result</span><span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># *</span>
    <span class='lbrace token'>{</span><span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>200</span><span class='comma token'>,</span> <span class='symbol val'>:body</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='result identifier id'>result</span><span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
  <span class='comment val'># set response data</span>
  <span class='headers identifier id'>headers</span> <span class='assign token'>=</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='symbol val'>:headers</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='status identifier id'>status</span> <span class='assign token'>=</span> <span class='result identifier id'>result</span><span class='lbrack token'>[</span><span class='symbol val'>:status</span><span class='rbrack token'>]</span>
  <span class='headers identifier id'>headers</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='lparen token'>(</span><span class='header identifier id'>header</span><span class='comma token'>,</span><span class='val identifier id'>val</span><span class='rparen token'>)</span><span class='bitor op'>|</span> <span class='response identifier id'>response</span><span class='lbrack token'>[</span><span class='header identifier id'>header</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='val identifier id'>val</span> <span class='rbrace token'>}</span>
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='write identifier id'>write</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='to_json identifier id'>to_json</span>
  
  <span class='timing identifier id'>timing</span><span class='lbrack token'>[</span><span class='symbol val'>:finished</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
  <span class='comment val'># the rescue is necessary if for some reason the timing is faster than</span>
  <span class='comment val'># system timing usec. this actually happens on Windows</span>
  <span class='timing identifier id'>timing</span><span class='lbrack token'>[</span><span class='symbol val'>:total</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='timing identifier id'>timing</span><span class='lbrack token'>[</span><span class='symbol val'>:finished</span><span class='rbrack token'>]</span> <span class='minus op'>-</span> <span class='timing identifier id'>timing</span><span class='lbrack token'>[</span><span class='symbol val'>:started</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='float val'>1e4</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='div op'>/</span><span class='float val'>1e4</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='integer val'>0</span><span class='integer val'>.01</span><span class='rparen token'>)</span>
  <span class='timing identifier id'>timing</span><span class='lbrack token'>[</span><span class='symbol val'>:per_sec</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='lparen token'>(</span><span class='float val'>1.0</span><span class='div op'>/</span><span class='lparen token'>(</span><span class='timing identifier id'>timing</span><span class='lbrack token'>[</span><span class='symbol val'>:total</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='mult op'>*</span><span class='float val'>1e2</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='round identifier id'>round</span><span class='dot token'>.</span><span class='to_f identifier id'>to_f</span><span class='div op'>/</span><span class='float val'>1e2</span><span class='rparen token'>)</span>
  
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;[#{response.status}] #{URI.parse(env['REQUEST_URI'] || env['PATH_INFO']).path} (#{timing[:total]}s;#{timing[:per_sec]}req/s)&quot;</span>
  <span class='comment val'># self.logger &lt;&lt; &quot;Session ID: #{self.session.id}\n&quot; # TODO: Implement session</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;Params: #{filter_params_for_log(request, env).inspect}\n\n&quot;</span>
  
  <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='finish identifier id'>finish</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>dispatch</h3>
</div><div id="dispatch-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>dispatch</span><span class='args'>(env)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Dispatches the controller and action according the routed request.
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='env identifier id'>env</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; the request environment details, including &quot;halcyon.route&quot;
</span></pre>
<p>
If no <tt>:controller</tt> is specified, the default <tt>Application</tt>
controller is dispatched to.
</p>
<p>
Once the controller is selected and instantiated, the action is called,
defaulting to <tt>:default</tt> if no action is provided.
</p>
<p>
If the action called is not defined, a <tt>404 Not Found</tt> exception
will be raised. This will be sent to the client as such, or handled by the
Rack application container, such as the Rack Cascade middleware to failover
to another application (such as Merb or Rails).
</p>
<p>
Refer to Halcyon::Application::Router for more details on defining routes
and for where to get further documentation.
</p>
<p>
Returns (String|Array|Hash):body
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>NotFound</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/halcyon/application.rb', line 160</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748/lib/halcyon/application.rb#L160">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='dispatch identifier id'>dispatch</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='route identifier id'>route</span> <span class='assign token'>=</span> <span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'halcyon.route'</span><span class='rbrack token'>]</span>
  <span class='comment val'># make sure that the right controller/action is called based on the route</span>
  <span class='controller identifier id'>controller</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='route identifier id'>route</span><span class='lbrack token'>[</span><span class='symbol val'>:controller</span><span class='rbrack token'>]</span>
  <span class='when when kw'>when</span> <span class='NilClass constant id'>NilClass</span>
    <span class='comment val'># default to the Application controller</span>
    <span class='colon3 op'>::</span><span class='Application constant id'>Application</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='when when kw'>when</span> <span class='String constant id'>String</span>
    <span class='comment val'># pulled from URL, so camelize (from extlib) and symbolize first</span>
    <span class='begin begin kw'>begin</span>
      <span class='Object constant id'>Object</span><span class='dot token'>.</span><span class='full_const_get identifier id'>full_const_get</span><span class='lparen token'>(</span><span class='route identifier id'>route</span><span class='lbrack token'>[</span><span class='symbol val'>:controller</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_const_string identifier id'>to_const_string</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='rparen token'>)</span>
    <span class='rescue rescue kw'>rescue</span> <span class='NameError constant id'>NameError</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
      <span class='raise identifier id'>raise</span> <span class='NotFound constant id'>NotFound</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># Establish the selected action, defaulting to +default+.</span>
  <span class='action identifier id'>action</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='route identifier id'>route</span><span class='lbrack token'>[</span><span class='symbol val'>:action</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>'default'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
  
  <span class='comment val'># Respond correctly that a non-existent action was specified if the</span>
  <span class='comment val'># method does not exist.</span>
  <span class='raise identifier id'>raise</span> <span class='NotFound constant id'>NotFound</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='unless unless_mod kw'>unless</span> <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='methods identifier id'>methods</span><span class='dot token'>.</span><span class='include? fid id'>include?</span><span class='lparen token'>(</span><span class='action identifier id'>action</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  
  <span class='comment val'># if no errors have occured up to this point, the route should be fully</span>
  <span class='comment val'># valid and all exceptions raised should be treated as</span>
  <span class='comment val'># &lt;tt&gt;500 Internal Server Error&lt;/tt&gt;s, which is handled by &lt;tt&gt;call&lt;/tt&gt;.</span>
  <span class='controller identifier id'>controller</span><span class='dot token'>.</span><span class='_dispatch identifier id'>_dispatch</span><span class='lparen token'>(</span><span class='action identifier id'>action</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>filter_params_for_log</h3>
</div><div id="filter_params_for_log-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>filter_params_for_log</span><span class='args'>(request, env)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Assemble params for logging.
</p>
<p>
This method exists to be overridden or method-chained to filter out params
from being logged for applications with sensitive data like passwords.
</p>
<p>
Returns Hash:params_to_log
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/halcyon/application.rb', line 249</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/mtodd/halcyon/blob/c4cb414bf7b05176c844ff589a580aacf82d5748/lib/halcyon/application.rb#L249">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">249
250
251</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='filter_params_for_log identifier id'>filter_params_for_log</span><span class='lparen token'>(</span><span class='request identifier id'>request</span><span class='comma token'>,</span> <span class='env identifier id'>env</span><span class='rparen token'>)</span>
  <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='params identifier id'>params</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='env identifier id'>env</span><span class='lbrack token'>[</span><span class='string val'>'halcyon.route'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> 2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>