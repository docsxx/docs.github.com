<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>browsermedia's browsercms - Module: Cms::Behaviors::DynamicAttributes - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/browsermedia/commits/browsercms/master" rel="alternate" title="Recent Commits to browsercms:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("browsermedia", "browsercms", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='browsermedia/browsercms/blob/b7bd3b89d1760a68ff8af0bffe5676f8684e6009' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='browsermedia/browsercms/blob/b7bd3b89d1760a68ff8af0bffe5676f8684e6009' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("browsermedia", "browsercms", "b7bd3b89d1760a68ff8af0bffe5676f8684e6009", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/browsermedia/browsercms/tree/">Source</a></li>
            <li class=""><a href="http://github.com/browsermedia/browsercms/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/browsermedia/browsercms/network">Network</a></li>            
            <li class=""><a href="http://github.com/browsermedia/browsercms/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/browsermedia/browsercms">Wiki</a></li>
            <li class=""><a href="http://github.com/browsermedia/browsercms/graphs">Graphs</a></li>                    
            <li class="active"><a href="/browsermedia/browsercms">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/browsermedia">browsermedia</a> / <b><a href="http://github.com/browsermedia/browsercms/tree">browsercms</a></b>        
                <a id="namespaces_button" rel="browsermedia/browsercms/blob/b7bd3b89d1760a68ff8af0bffe5676f8684e6009" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="browsermedia/browsercms/blob/b7bd3b89d1760a68ff8af0bffe5676f8684e6009" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module Cms_Behaviors_DynamicAttributes">
  <h1>Module: Cms::Behaviors::DynamicAttributes</h1>
  <div class="section docstring">
  <p>
The DynamicAttributes behavior allows a model to store values for any
attributes. A model that uses DynamicAttributes should have corresponding
&quot;_attributes&quot; table where it stores the values for the dynamic
attributes. This is based on the {Flex Attributes Rails
Plugin}[http://rubyforge.org/projects/flex-attributes].
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='has_dynamic_attributes identifier id'>has_dynamic_attributes</span>
  <span class='end end kw'>end</span>
  <span class='eric identifier id'>eric</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span> <span class='string val'>'eric'</span>
  <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;My AOL instant message name is: #{eric.aim}&quot;</span>
  <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='phone identifier id'>phone</span> <span class='assign token'>=</span> <span class='string val'>'555-123-4567'</span>
  <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
</pre>
<p>
The above example should work even though &quot;aim&quot; and
&quot;phone&quot; are not attributes on the User model.
</p>
<p>
The following options are available on for has_dynamic_attributes to modify
the behavior. Reasonable defaults are provided:
</p>
<table>
<tr><td valign="top">class_name:</td><td>The class for the related model. This defaults to the model name prepended
to &quot;Attribute&quot;. So for a &quot;User&quot; model the class name
would be &quot;UserAttribute&quot;. The class can actually exist (in that
case the model file will be loaded through Rails dependency system) or if
it does not exist a basic model will be dynamically defined for you. This
allows you to implement custom methods on the related class by simply
defining the class manually.

</td></tr>
<tr><td valign="top">table_name:</td><td>The table for the related model. This defaults to the attribute
model&#8217;s table name.

</td></tr>
<tr><td valign="top">relationship_name:</td><td>This is the name of the actual has_many relationship. Most of the type this
relationship will only be used indirectly but it is there if the user wants
more raw access. This defaults to the class name underscored then
pluralized finally turned into a symbol.

</td></tr>
<tr><td valign="top">foreign_key:</td><td>The key in the attribute table to relate back to the model. This defaults
to the model name underscored prepended to &quot;_id&quot;

</td></tr>
<tr><td valign="top">name_field:</td><td>The field which stores the name of the attribute in the related object

</td></tr>
<tr><td valign="top">value_field:</td><td>The field that stores the value in the related object

</td></tr>
<tr><td valign="top">fields:</td><td>A list of fields that are valid dynamic attributes. By default this is
&quot;nil&quot; which means that all field are valid. Use this option if
you want some fields to go to one dynamic attribute model while other
fields will go to another. As an alternative you can override the
#dynamic_attributes method which will return a list of all valid dynamic
attributes. This is useful if you want to read the list of attributes from
another source to keep your code DRY. This method is given a single
argument which is the class for the related model. The following provide an
example:

</td></tr>
</table>
<pre class="code">
 <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
   <span class='has_dynamic_attributes identifier id'>has_dynamic_attributes</span> <span class='symbol val'>:class_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'UserContactInfo'</span>
   <span class='has_dynamic_attributes identifier id'>has_dynamic_attributes</span> <span class='symbol val'>:class_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Preferences'</span>

   <span class='def def kw'>def</span> <span class='dynamic_attributes identifier id'>dynamic_attributes</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='rparen token'>)</span>
     <span class='case case kw'>case</span> <span class='model identifier id'>model</span>
       <span class='when when kw'>when</span> <span class='UserContactInfo constant id'>UserContactInfo</span>
         <span class='dstring node'>%w(email phone aim yahoo msn)</span>
       <span class='when when kw'>when</span> <span class='Preference constant id'>Preference</span>
         <span class='dstring node'>%w(project_search project_order user_search user_order)</span>
       <span class='else else kw'>else</span> <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
     <span class='end end kw'>end</span>
   <span class='end end kw'>end</span>
 <span class='end end kw'>end</span>

 <span class='eric identifier id'>eric</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span> <span class='string val'>'eric'</span>
 <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='email identifier id'>email</span> <span class='assign token'>=</span> <span class='string val'>'eric@example.com'</span> <span class='comment val'># Will save to UserContactInfo model</span>
 <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='project_order identifier id'>project_order</span> <span class='assign token'>=</span> <span class='string val'>'name'</span>     <span class='comment val'># Will save to Preference</span>
 <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='save identifier id'>save</span> <span class='comment val'># Carries out save so now values are in database</span>
</pre>
<p>
Note the else clause in our case statement. Since an empty array is
returned for all other models (perhaps added later) then we can be certain
that only the above dynamic attributes are allowed.
</p>
<p>
If both a :fields option and #dynamic_attributes method is defined the
:fields option take precidence. This allows you to easily define the field
list inline for one model while implementing #dynamic_attributes for
another model and not having #dynamic_attributes need to determine what
model it is answering for. In both cases the list of dynamic attributes can
be a list of string or symbols
</p>
<p>
A final alternative to :fields and #dynamic_attributes is the
#is_dynamic_attribute? method. This method is given two arguments. The
first is the attribute being retrieved/saved the second is the Model we are
testing for. If you override this method then the #dynamic_attributes
method or the :fields option will have no affect. Use of this method is
ideal when you want to retrict the attributes but do so in a algorithmic
way. The following is an example:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='has_dynamic_attributes identifier id'>has_dynamic_attributes</span> <span class='symbol val'>:class_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'UserContactInfo'</span>
    <span class='has_dynamic_attributes identifier id'>has_dynamic_attributes</span> <span class='symbol val'>:class_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Preferences'</span>

    <span class='def def kw'>def</span> <span class='is_dynamic_attribute? fid id'>is_dynamic_attribute?</span><span class='lparen token'>(</span><span class='attr identifier id'>attr</span><span class='comma token'>,</span> <span class='model identifier id'>model</span><span class='rparen token'>)</span>
      <span class='case case kw'>case</span> <span class='attr identifier id'>attr</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
        <span class='when when kw'>when</span> <span class='regexp val'>/^contact_/</span> <span class='then then kw'>then</span> <span class='true true kw'>true</span>
        <span class='when when kw'>when</span> <span class='regexp val'>/^preference_/</span> <span class='then then kw'>then</span> <span class='true true kw'>true</span>
        <span class='else else kw'>else</span>
          <span class='false false kw'>false</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='eric identifier id'>eric</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='find_by_login identifier id'>find_by_login</span> <span class='string val'>'eric'</span>
  <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='contact_phone identifier id'>contact_phone</span> <span class='assign token'>=</span> <span class='string val'>'555-123-4567'</span>
  <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='contact_email identifier id'>contact_email</span> <span class='assign token'>=</span> <span class='string val'>'eric@example.com'</span>
  <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='preference_project_order identifier id'>preference_project_order</span> <span class='assign token'>=</span> <span class='string val'>'name'</span>
  <span class='eric identifier id'>eric</span><span class='dot token'>.</span><span class='some_attribute identifier id'>some_attribute</span> <span class='assign token'>=</span> <span class='string val'>'blah'</span>  <span class='comment val'># If some_attribute is not defined on</span>
                                <span class='comment val'># the model then method not found is thrown</span>
</pre>

</div><div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#included-class_method">included</span><span class='args'>(model_class)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>included</h3>
</div><div id="included-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>included</span><span class='args'>(model_class)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/cms/behaviors/dynamic_attributes.rb', line 116</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/browsermedia/browsercms/blob/b7bd3b89d1760a68ff8af0bffe5676f8684e6009/lib/cms/behaviors/dynamic_attributes.rb#L116">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">116
117
118</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='included identifier id'>included</span><span class='lparen token'>(</span><span class='model_class identifier id'>model_class</span><span class='rparen token'>)</span>
  <span class='model_class identifier id'>model_class</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span><span class='lparen token'>(</span><span class='MacroMethods constant id'>MacroMethods</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>