<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jamis's capistrano - Class: Capistrano::Deploy::SCM::Accurev - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jamis/commits/capistrano/master" rel="alternate" title="Recent Commits to capistrano:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jamis", "capistrano", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jamis", "capistrano", "df0935c4c135207582da343aacdd4cf080fcfed0", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jamis/capistrano/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jamis/capistrano/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jamis/capistrano/network">Network</a></li>            
            <li class=""><a href="http://github.com/jamis/capistrano/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jamis/capistrano">Wiki</a></li>
            <li class=""><a href="http://github.com/jamis/capistrano/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jamis/capistrano">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jamis">jamis</a> / <b><a href="http://github.com/jamis/capistrano/tree">capistrano</a></b>        
                <a id="namespaces_button" rel="jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class Capistrano_Deploy_SCM_Accurev">
  <h1>Class: Capistrano::Deploy::SCM::Accurev</h1>
  <div class="section inheritance">
  <ul>
  <li><a href="Base.html" title="Capistrano::Deploy::SCM::Base">Capistrano::Deploy::SCM::Base</a></li><ul><li>Capistrano::Deploy::SCM::Accurev</li>
  </ul></ul>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p>REXML</p>
</div><div class="section docstring">
  <p>
Accurev bridge for use by Capistrano. This implementation does not
implement all features of a Capistrano SCM module. The ones that are left
out are either exceedingly difficult to implement with Accurev or are
considered bad form.
</p>
<p>
When using this module in a project, the following variables are used:
</p>
<pre class="code">
 <span class='mult op'>*</span> <span class='symbol val'>:repository</span> <span class='minus op'>-</span> <span class='This constant id'>This</span> <span class='should identifier id'>should</span> <span class='match identifier id'>match</span> <span class='the identifier id'>the</span> <span class='depot identifier id'>depot</span> <span class='that identifier id'>that</span> <span class='code identifier id'>code</span> <span class='lives identifier id'>lives</span> <span class='in in kw'>in</span><span class='dot token'>.</span> <span class='If constant id'>If</span> <span class='your identifier id'>your</span> <span class='code identifier id'>code</span>
                 <span class='exists identifier id'>exists</span> <span class='in in kw'>in</span> <span class='a identifier id'>a</span> <span class='subdirectory identifier id'>subdirectory</span><span class='comma token'>,</span> <span class='you identifier id'>you</span> <span class='can identifier id'>can</span> <span class='append identifier id'>append</span> <span class='the identifier id'>the</span> <span class='path identifier id'>path</span> <span class='depot identifier id'>depot</span><span class='dot token'>.</span>
                 <span class='eg identifier id'>eg</span><span class='dot token'>.</span> <span class='foo identifier id'>foo</span><span class='minus op'>-</span><span class='depot identifier id'>depot</span><span class='div op'>/</span><span class='bar_dir identifier id'>bar_dir</span>
 <span class='mult op'>*</span> <span class='symbol val'>:stream</span> <span class='minus op'>-</span> <span class='The constant id'>The</span> <span class='stream identifier id'>stream</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='depot identifier id'>depot</span> <span class='that identifier id'>that</span> <span class='code identifier id'>code</span> <span class='should identifier id'>should</span> <span class='be identifier id'>be</span> <span class='pulled identifier id'>pulled</span> <span class='from identifier id'>from</span><span class='dot token'>.</span> <span class='If constant id'>If</span>
             <span class='left identifier id'>left</span> <span class='blank identifier id'>blank</span><span class='comma token'>,</span> <span class='the identifier id'>the</span> <span class='depot identifier id'>depot</span> <span class='stream identifier id'>stream</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='used identifier id'>used</span>
 <span class='mult op'>*</span> <span class='symbol val'>:revision</span> <span class='minus op'>-</span> <span class='Should constant id'>Should</span> <span class='be identifier id'>be</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='form identifier id'>form</span> <span class='string val'>'stream/transaction'</span><span class='dot token'>.</span>
</pre>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <p class="inherited_msg">
    This class inherits a constructor from <a href="Base.html#initialize-instance_method" title="Capistrano::Deploy::SCM::Base">Capistrano::Deploy::SCM::Base</a>.
  </p>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <div class="inherited">
  
  <div>
    <h2>Public Class Methods Inherited from <a href="Base.html" title="Capistrano::Deploy::SCM::Base">Capistrano::Deploy::SCM::Base</a></h2>
    <p><span class='name'><a href="Base.html#default_command-class_method" title="default_command">default_command</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
  <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#diff-instance_method">#diff</span><span class='args'>(from, to = head)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the command needed to show the diff between what is deployed and
what is pending.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#export-instance_method">#export</span><span class='args'>(revision_id, destination)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Pops a copy of the code for the specified Accurev revision identifier.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#head-instance_method">#head</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Defines pseudo-revision value for the most recent changes to be deployed.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#log-instance_method">#log</span><span class='args'>(from, to = head)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the command needed to show the changes that exist between the two
revisions.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#query_revision-instance_method">#query_revision</span><span class='args'>(revision)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Given an Accurev revision identifier, this method returns an identifier
that can be used for later SCM calls.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
  <div>
    <h2>Public Instance Methods Inherited from <a href="Base.html" title="Capistrano::Deploy::SCM::Base">Capistrano::Deploy::SCM::Base</a></h2>
    <p><span class='name'><a href="Base.html#checkout-instance_method" title="checkout">checkout</a></span>, <span class='name'><a href="Base.html#command-instance_method" title="command">command</a></span>, <span class='name'><a href="Base.html#handle_data-instance_method" title="handle_data">handle_data</a></span>, <span class='name'><a href="Base.html#local-instance_method" title="local">local</a></span>, <span class='name'><a href="Base.html#local%3F-instance_method" title="local?">local?</a></span>, <span class='name'><a href="Base.html#next_revision-instance_method" title="next_revision">next_revision</a></span>, <span class='name'><a href="Base.html#scm-instance_method" title="scm">scm</a></span>, <span class='name'><a href="Base.html#sync-instance_method" title="sync">sync</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>diff</h3>
</div><div id="diff-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>diff</span><span class='args'>(from, to = head)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the command needed to show the diff between what is deployed and
what is pending. Because Accurev can not do this task without creating some
streams, two time basis streams will be created for the purposes of doing
the diff.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/recipes/deploy/scm/accurev.rb', line 95</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0/lib/capistrano/recipes/deploy/scm/accurev.rb#L95">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">95
96
97
98
99
100
101
102
103
104
105
106
107</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='diff identifier id'>diff</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='comma token'>,</span> <span class='to identifier id'>to</span><span class='assign token'>=</span><span class='head identifier id'>head</span><span class='rparen token'>)</span>
  <span class='from identifier id'>from</span> <span class='assign token'>=</span> <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='rparen token'>)</span>
  <span class='to identifier id'>to</span> <span class='assign token'>=</span> <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='to identifier id'>to</span><span class='rparen token'>)</span>

  <span class='from_stream identifier id'>from_stream</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{from.stream}-capistrano-diff-from&quot;</span>
  <span class='to_stream identifier id'>to_stream</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{to.stream}-capistrano-diff-to&quot;</span>

  <span class='lbrack token'>[</span>
    <span class='change_or_create_stream identifier id'>change_or_create_stream</span><span class='lparen token'>(</span><span class='from_stream identifier id'>from_stream</span><span class='comma token'>,</span> <span class='from identifier id'>from</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='change_or_create_stream identifier id'>change_or_create_stream</span><span class='lparen token'>(</span><span class='to_stream identifier id'>to_stream</span><span class='comma token'>,</span> <span class='to identifier id'>to</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='scm identifier id'>scm</span><span class='lparen token'>(</span><span class='symbol val'>:diff</span><span class='comma token'>,</span> <span class='string val'>'-v'</span><span class='comma token'>,</span> <span class='from_stream identifier id'>from_stream</span><span class='comma token'>,</span> <span class='string val'>'-V'</span><span class='comma token'>,</span> <span class='to_stream identifier id'>to_stream</span><span class='comma token'>,</span> <span class='string val'>'-a'</span><span class='rparen token'>)</span>
  <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' &amp;&amp; '</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>export</h3>
</div><div id="export-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>export</span><span class='args'>(revision_id, destination)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Pops a copy of the code for the specified Accurev revision identifier. The
revision identifier is represented as a stream &amp; transaction ID combo.
Accurev can only pop a particular transaction if a stream is created on the
server with a time basis of that transaction id. Therefore, we will create
a stream with the required criteria and pop that.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/recipes/deploy/scm/accurev.rb', line 62</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0/lib/capistrano/recipes/deploy/scm/accurev.rb#L62">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='export identifier id'>export</span><span class='lparen token'>(</span><span class='revision_id identifier id'>revision_id</span><span class='comma token'>,</span> <span class='destination identifier id'>destination</span><span class='rparen token'>)</span>
  <span class='revision identifier id'>revision</span> <span class='assign token'>=</span> <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='revision_id identifier id'>revision_id</span><span class='rparen token'>)</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Exporting #{revision.stream}/#{revision.transaction_id} to #{destination}&quot;</span><span class='rparen token'>)</span>

  <span class='commands identifier id'>commands</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span>
    <span class='change_or_create_stream identifier id'>change_or_create_stream</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{revision.stream}-capistrano-deploy&quot;</span><span class='comma token'>,</span> <span class='revision identifier id'>revision</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='dstring node'>&quot;mkdir -p #{destination}&quot;</span><span class='comma token'>,</span>
    <span class='scm_quiet identifier id'>scm_quiet</span><span class='lparen token'>(</span><span class='symbol val'>:pop</span><span class='comma token'>,</span> <span class='dstring node'>&quot;-Rv #{stream}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;-L #{destination}&quot;</span><span class='comma token'>,</span> <span class='dstring node'>&quot;'/./#{subdir}'&quot;</span><span class='rparen token'>)</span>
  <span class='rbrack token'>]</span>
  <span class='if if kw'>if</span> <span class='subdir identifier id'>subdir</span>
    <span class='commands identifier id'>commands</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span>
      <span class='dstring node'>&quot;mv #{destination}/#{subdir}/* #{destination}&quot;</span><span class='comma token'>,</span>
      <span class='dstring node'>&quot;rm -rf #{File.join(destination, subdir)}&quot;</span>
    <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='commands identifier id'>commands</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' &amp;&amp; '</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>head</h3>
</div><div id="head-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>head</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Defines pseudo-revision value for the most recent changes to be deployed.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/recipes/deploy/scm/accurev.rb', line 25</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0/lib/capistrano/recipes/deploy/scm/accurev.rb#L25">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">25
26
27</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='head identifier id'>head</span>
  <span class='dstring node'>&quot;#{stream}/highest&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>log</h3>
</div><div id="log-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>log</span><span class='args'>(from, to = head)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the command needed to show the changes that exist between the two
revisions.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/recipes/deploy/scm/accurev.rb', line 81</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0/lib/capistrano/recipes/deploy/scm/accurev.rb#L81">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">81
82
83
84
85
86
87
88
89
90</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='log identifier id'>log</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='comma token'>,</span> <span class='to identifier id'>to</span><span class='assign token'>=</span><span class='head identifier id'>head</span><span class='rparen token'>)</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Getting transactions between #{from} and #{to}&quot;</span><span class='rparen token'>)</span>
  <span class='from_rev identifier id'>from_rev</span> <span class='assign token'>=</span> <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='from identifier id'>from</span><span class='rparen token'>)</span>
  <span class='to_rev identifier id'>to_rev</span> <span class='assign token'>=</span> <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='to identifier id'>to</span><span class='rparen token'>)</span>

  <span class='lbrack token'>[</span>
    <span class='scm identifier id'>scm</span><span class='lparen token'>(</span><span class='symbol val'>:hist</span><span class='comma token'>,</span> <span class='string val'>'-s'</span><span class='comma token'>,</span> <span class='from_rev identifier id'>from_rev</span><span class='dot token'>.</span><span class='stream identifier id'>stream</span><span class='comma token'>,</span> <span class='string val'>'-t'</span><span class='comma token'>,</span> <span class='dstring node'>&quot;#{to_rev.transaction_id}-#{from_rev.transaction_id}&quot;</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='dstring node'>&quot;sed -e '/transaction #{from_rev.transaction_id}/ { Q }'&quot;</span>
  <span class='rbrack token'>]</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>' | '</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>query_revision</h3>
</div><div id="query_revision-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>query_revision</span><span class='args'>(revision)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Given an Accurev revision identifier, this method returns an identifier
that can be used for later SCM calls. This returned identifier will not
change as a result of further SCM activity.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/capistrano/recipes/deploy/scm/accurev.rb', line 32</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jamis/capistrano/blob/df0935c4c135207582da343aacdd4cf080fcfed0/lib/capistrano/recipes/deploy/scm/accurev.rb#L32">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='query_revision identifier id'>query_revision</span><span class='lparen token'>(</span><span class='revision identifier id'>revision</span><span class='rparen token'>)</span>
  <span class='internal_revision identifier id'>internal_revision</span> <span class='assign token'>=</span> <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='parse identifier id'>parse</span><span class='lparen token'>(</span><span class='revision identifier id'>revision</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='revision identifier id'>revision</span> <span class='unless unless_mod kw'>unless</span> <span class='internal_revision identifier id'>internal_revision</span><span class='dot token'>.</span><span class='psuedo_revision? fid id'>psuedo_revision?</span>

  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Querying for real revision for #{internal_revision}&quot;</span><span class='rparen token'>)</span>
  <span class='rev_stream identifier id'>rev_stream</span> <span class='assign token'>=</span> <span class='internal_revision identifier id'>internal_revision</span><span class='dot token'>.</span><span class='stream identifier id'>stream</span>

  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Determining what type of stream #{rev_stream} is...&quot;</span><span class='rparen token'>)</span>
  <span class='stream_xml identifier id'>stream_xml</span> <span class='assign token'>=</span> <span class='yield yield kw'>yield</span> <span class='show_streams_for identifier id'>show_streams_for</span><span class='lparen token'>(</span><span class='rev_stream identifier id'>rev_stream</span><span class='rparen token'>)</span>
  <span class='stream_doc identifier id'>stream_doc</span> <span class='assign token'>=</span> <span class='Document constant id'>Document</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='stream_xml identifier id'>stream_xml</span><span class='rparen token'>)</span>
  <span class='type identifier id'>type</span> <span class='assign token'>=</span> <span class='XPath constant id'>XPath</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='stream_doc identifier id'>stream_doc</span><span class='comma token'>,</span> <span class='string val'>'//streams/stream/@type'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='value identifier id'>value</span>

  <span class='case case kw'>case</span> <span class='type identifier id'>type</span>
  <span class='when when kw'>when</span> <span class='string val'>'snapshot'</span>
    <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='rev_stream identifier id'>rev_stream</span><span class='comma token'>,</span> <span class='string val'>'highest'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='else else kw'>else</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span><span class='lparen token'>(</span><span class='dstring node'>&quot;Getting latest transaction id in #{rev_stream}&quot;</span><span class='rparen token'>)</span>
    <span class='comment val'># Doing another yield for a second Accurev call. Hopefully this is ok.</span>
    <span class='hist_xml identifier id'>hist_xml</span> <span class='assign token'>=</span> <span class='yield yield kw'>yield</span> <span class='scm identifier id'>scm</span><span class='lparen token'>(</span><span class='symbol val'>:hist</span><span class='comma token'>,</span> <span class='string val'>'-ftx'</span><span class='comma token'>,</span> <span class='string val'>'-s'</span><span class='comma token'>,</span> <span class='rev_stream identifier id'>rev_stream</span><span class='comma token'>,</span> <span class='string val'>'-t'</span><span class='comma token'>,</span> <span class='string val'>'now.1'</span><span class='rparen token'>)</span>
    <span class='hist_doc identifier id'>hist_doc</span> <span class='assign token'>=</span> <span class='Document constant id'>Document</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='hist_xml identifier id'>hist_xml</span><span class='rparen token'>)</span>
    <span class='transaction_id identifier id'>transaction_id</span> <span class='assign token'>=</span> <span class='XPath constant id'>XPath</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='lparen token'>(</span><span class='hist_doc identifier id'>hist_doc</span><span class='comma token'>,</span> <span class='string val'>'//AcResponse/transaction/@id'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='value identifier id'>value</span>
    <span class='InternalRevision constant id'>InternalRevision</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='stream identifier id'>stream</span><span class='comma token'>,</span> <span class='transaction_id identifier id'>transaction_id</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>