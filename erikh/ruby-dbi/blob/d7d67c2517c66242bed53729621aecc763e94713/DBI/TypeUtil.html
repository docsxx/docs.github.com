<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>erikh's ruby-dbi - Class: DBI::TypeUtil - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/erikh/commits/ruby-dbi/master" rel="alternate" title="Recent Commits to ruby-dbi:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("erikh", "ruby-dbi", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='erikh/ruby-dbi/blob/d7d67c2517c66242bed53729621aecc763e94713' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='erikh/ruby-dbi/blob/d7d67c2517c66242bed53729621aecc763e94713' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("erikh", "ruby-dbi", "d7d67c2517c66242bed53729621aecc763e94713", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/erikh/ruby-dbi/tree/">Source</a></li>
            <li class=""><a href="http://github.com/erikh/ruby-dbi/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/erikh/ruby-dbi/network">Network</a></li>            
            <li class=""><a href="http://github.com/erikh/ruby-dbi/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/erikh/ruby-dbi">Wiki</a></li>
            <li class=""><a href="http://github.com/erikh/ruby-dbi/graphs">Graphs</a></li>                    
            <li class="active"><a href="/erikh/ruby-dbi">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/erikh">erikh</a> / <b><a href="http://github.com/erikh/ruby-dbi/tree">ruby-dbi</a></b>        
                <a id="namespaces_button" rel="erikh/ruby-dbi/blob/d7d67c2517c66242bed53729621aecc763e94713" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="erikh/ruby-dbi/blob/d7d67c2517c66242bed53729621aecc763e94713" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class DBI_TypeUtil">
  <h1>Class: DBI::TypeUtil</h1>
  <div class="section docstring">
  <p>
TypeUtil is a series of utility methods for type management.
</p>

</div><div class="section constants">
  
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#convert-class_method">convert</span><span class='args'>(driver_name, obj)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Convert object for <tt>driver_name</tt>.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#register_conversion-class_method">register_conversion</span><span class='args'>(driver_name, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Register a conversion for a DBD.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#type_name_to_module-class_method">type_name_to_module</span><span class='args'>(type_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Convenience method to match many SQL named types to DBI::Type classes.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>convert</h3>
</div><div id="convert-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>convert</span><span class='args'>(driver_name, obj)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Convert object for <tt>driver_name</tt>. See #register_conversion for a
complete explanation of how type conversion is performed.
</p>
<p>
If the conversion is instructed to cascade, it will go to the special
&quot;default&quot; conversion, which is a pre-defined common case (and
mutable) ruleset for native types. Note that it will use the result from
the first conversion, not what was originally passed. Be sure to leave the
object untouched if that is your intent. E.g., if your DBD converts an
Integer to String and tells it to cascade, the &quot;default&quot;
conversion will get a String and quote it, not an Integer (which has
different rules).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dbi/typeutil.rb', line 48</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/erikh/ruby-dbi/blob/d7d67c2517c66242bed53729621aecc763e94713/lib/dbi/typeutil.rb#L48">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">48
49
50
51
52
53
54
55
56
57
58</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='convert identifier id'>convert</span><span class='lparen token'>(</span><span class='driver_name identifier id'>driver_name</span><span class='comma token'>,</span> <span class='obj identifier id'>obj</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='@@conversions ivar id'>@@conversions</span><span class='lbrack token'>[</span><span class='driver_name identifier id'>driver_name</span><span class='rbrack token'>]</span>
        <span class='newobj identifier id'>newobj</span><span class='comma token'>,</span> <span class='cascade identifier id'>cascade</span> <span class='assign token'>=</span> <span class='@@conversions ivar id'>@@conversions</span><span class='lbrack token'>[</span><span class='driver_name identifier id'>driver_name</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='obj identifier id'>obj</span><span class='rparen token'>)</span>
        <span class='if if kw'>if</span> <span class='cascade identifier id'>cascade</span>
            <span class='return return kw'>return</span> <span class='@@conversions ivar id'>@@conversions</span><span class='lbrack token'>[</span><span class='string val'>&quot;default&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='newobj identifier id'>newobj</span><span class='rparen token'>)</span>
        <span class='end end kw'>end</span>
        <span class='return return kw'>return</span> <span class='newobj identifier id'>newobj</span>
    <span class='end end kw'>end</span>

    <span class='return return kw'>return</span> <span class='@@conversions ivar id'>@@conversions</span><span class='lbrack token'>[</span><span class='string val'>&quot;default&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='obj identifier id'>obj</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>register_conversion</h3>
</div><div id="register_conversion-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>register_conversion</span><span class='args'>(driver_name, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Register a conversion for a DBD. This applies to bound parameters for
outgoing statements; please look at DBI::Type for result sets.
</p>
<p>
Conversions are given a driver_name, which is then used to look up the
conversion to perform on the object. Please see #convert for more
information. Driver names are typically provided by the DBD, but may be
overridden at any stage temporarily by assigning to the
<tt>driver_name</tt> attribute for the various handles.
</p>
<p>
A conversion block is normally a <tt>case</tt> statement that identifies
various native ruby types and converts them to string, but ultimately the
result type is dependent on low-level driver. The resulting object will be
fed to the query as the bound value.
</p>
<p>
The result of the block is two arguments, the first being the result
object, and the second being a <tt>cascade</tt> flag, which if true
instructs #convert to run the result through the <tt>default</tt>
conversion as well and use its result. This is advantageous when you just
need to convert everything to string, and allow <tt>default</tt> to
properly escape it.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dbi/typeutil.rb', line 30</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/erikh/ruby-dbi/blob/d7d67c2517c66242bed53729621aecc763e94713/lib/dbi/typeutil.rb#L30">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">30
31
32
33</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='register_conversion identifier id'>register_conversion</span><span class='lparen token'>(</span><span class='driver_name identifier id'>driver_name</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='raise identifier id'>raise</span> <span class='string val'>&quot;Must provide a block&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='block_given? fid id'>block_given?</span>
    <span class='@@conversions ivar id'>@@conversions</span><span class='lbrack token'>[</span><span class='driver_name identifier id'>driver_name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>type_name_to_module</h3>
</div><div id="type_name_to_module-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>type_name_to_module</span><span class='args'>(type_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Convenience method to match many SQL named types to DBI::Type classes. If
none can be matched, returns DBI::Type::Varchar.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/dbi/typeutil.rb', line 64</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/erikh/ruby-dbi/blob/d7d67c2517c66242bed53729621aecc763e94713/lib/dbi/typeutil.rb#L64">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='type_name_to_module identifier id'>type_name_to_module</span><span class='lparen token'>(</span><span class='type_name identifier id'>type_name</span><span class='rparen token'>)</span>
    <span class='case case kw'>case</span> <span class='type_name identifier id'>type_name</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^int(?:\d+|eger)?$/i</span>
        <span class='DBI constant id'>DBI</span><span class='colon2 op'>::</span><span class='Type constant id'>Type</span><span class='colon2 op'>::</span><span class='Integer constant id'>Integer</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^varchar$/i</span><span class='comma token'>,</span> <span class='regexp val'>/^character varying$/i</span>
        <span class='DBI constant id'>DBI</span><span class='colon2 op'>::</span><span class='Type constant id'>Type</span><span class='colon2 op'>::</span><span class='Varchar constant id'>Varchar</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^(?:float|real)$/i</span>
        <span class='DBI constant id'>DBI</span><span class='colon2 op'>::</span><span class='Type constant id'>Type</span><span class='colon2 op'>::</span><span class='Float constant id'>Float</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^bool(?:ean)?$/i</span><span class='comma token'>,</span> <span class='regexp val'>/^tinyint$/i</span>
        <span class='DBI constant id'>DBI</span><span class='colon2 op'>::</span><span class='Type constant id'>Type</span><span class='colon2 op'>::</span><span class='Boolean constant id'>Boolean</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^time(?:stamp(?:tz)?)?$/i</span>
        <span class='DBI constant id'>DBI</span><span class='colon2 op'>::</span><span class='Type constant id'>Type</span><span class='colon2 op'>::</span><span class='Timestamp constant id'>Timestamp</span>
    <span class='when when kw'>when</span> <span class='regexp val'>/^(?:decimal|numeric)$/i</span>
        <span class='DBI constant id'>DBI</span><span class='colon2 op'>::</span><span class='Type constant id'>Type</span><span class='colon2 op'>::</span><span class='Decimal constant id'>Decimal</span>
    <span class='else else kw'>else</span>
        <span class='DBI constant id'>DBI</span><span class='colon2 op'>::</span><span class='Type constant id'>Type</span><span class='colon2 op'>::</span><span class='Varchar constant id'>Varchar</span>
    <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>