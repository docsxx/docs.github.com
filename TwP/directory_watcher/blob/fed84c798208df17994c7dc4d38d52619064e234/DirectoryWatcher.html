<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>TwP's directory_watcher - Class: DirectoryWatcher - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/TwP/commits/directory_watcher/master" rel="alternate" title="Recent Commits to directory_watcher:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("TwP", "directory_watcher", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='TwP/directory_watcher/blob/fed84c798208df17994c7dc4d38d52619064e234' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='TwP/directory_watcher/blob/fed84c798208df17994c7dc4d38d52619064e234' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("TwP", "directory_watcher", "fed84c798208df17994c7dc4d38d52619064e234", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/TwP/directory_watcher/tree/">Source</a></li>
            <li class=""><a href="http://github.com/TwP/directory_watcher/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/TwP/directory_watcher/network">Network</a></li>            
            <li class=""><a href="http://github.com/TwP/directory_watcher/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/TwP/directory_watcher">Wiki</a></li>
            <li class=""><a href="http://github.com/TwP/directory_watcher/graphs">Graphs</a></li>                    
            <li class="active"><a href="/TwP/directory_watcher">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/TwP">TwP</a> / <b><a href="http://github.com/TwP/directory_watcher/tree">directory_watcher</a></b>        
                <a id="namespaces_button" rel="TwP/directory_watcher/blob/fed84c798208df17994c7dc4d38d52619064e234" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="TwP/directory_watcher/blob/fed84c798208df17994c7dc4d38d52619064e234" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class DirectoryWatcher">
  <h1>Class: DirectoryWatcher</h1>
  <div class="section docstring">
  <h2>Synopsis</h2>
<p>
A class for watching files within a directory and generating events when
those files change.
</p>
<h2>Details</h2>
<p>
A directory watcher is an <tt>Observable</tt> object that sends events to
registered observers when file changes are detected within the directory
being watched.
</p>
<p>
The directory watcher operates by scanning the directory at some interval
and creating a list of the files it finds. File events are detected by
comparing the current file list with the file list from the previous scan
interval. Three types of events are supported &#8212; <b>added</b>,
<b>modified</b>, and <b>removed</b>.
</p>
<p>
An added event is generated when the file appears in the current file list
but not in the previous scan interval file list. A removed event is
generated when the file appears in the previous scan interval file list but
not in the current file list. A modified event is generated when the file
appears in the current and the previous interval file list, but the file
modification time or the file size differs between the two lists.
</p>
<p>
The file events are collected into an array, and all registered observers
receive all file events for each scan interval. It is up to the individual
observers to filter the events they are interested in.
</p>
<h3>File Selection</h3>
<p>
The directory watcher uses glob patterns to select the files to scan. The
default glob pattern will select all regular files in the directory of
interest &#8217;*&#8217;.
</p>
<p>
Here are a few useful glob examples:
</p>
<pre class="code">
    <span class='string val'>'*'</span>               <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='all identifier id'>all</span> <span class='files identifier id'>files</span> <span class='in in kw'>in</span> <span class='the identifier id'>the</span> <span class='current identifier id'>current</span> <span class='directory identifier id'>directory</span>
    <span class='string val'>'**/*'</span>            <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='all identifier id'>all</span> <span class='files identifier id'>files</span> <span class='in in kw'>in</span> <span class='all identifier id'>all</span> <span class='subdirectories identifier id'>subdirectories</span>
    <span class='string val'>'**/*.rb'</span>         <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='all identifier id'>all</span> <span class='ruby identifier id'>ruby</span> <span class='files identifier id'>files</span>
    <span class='string val'>'ext/**/*.{h,c}'</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='all identifier id'>all</span> <span class='C constant id'>C</span> <span class='source identifier id'>source</span> <span class='code identifier id'>code</span> <span class='files identifier id'>files</span>
</pre>
<p>
<b>Note</b>: file events will never be generated for directories. Only
regular files are included in the file scan.
</p>
<h3>Stable Files</h3>
<p>
A fourth file event is supported but not enabled by default &#8212; the
<b>stable</b> event. This event is generated after a file has been added or
modified and then remains unchanged for a certain number of scan intervals.
</p>
<p>
To enable the generation of this event the <tt>stable</tt> count must be
configured. This is the number of scan intervals a file must remain
unchanged (based modification time and file size) before it is considered
stable.
</p>
<p>
To disable this event the <tt>stable</tt> count should be set to
<tt>nil</tt>.
</p>
<h2>Usage</h2>
<p>
Learn by Doing &#8212; here are a few different ways to configure and use a
directory watcher.
</p>
<h3>Basic</h3>
<p>
This basic recipe will watch all files in the current directory and
generate the three default events. We&#8217;ll register an observer that
simply prints the events to standard out.
</p>
<pre class="code">
   <span class='require identifier id'>require</span> <span class='string val'>'directory_watcher'</span>

   <span class='dw identifier id'>dw</span> <span class='assign token'>=</span> <span class='DirectoryWatcher constant id'>DirectoryWatcher</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>'.'</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='add_observer identifier id'>add_observer</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='event identifier id'>event</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='event identifier id'>event</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;}

   dw.start
   gets      # when the user hits &quot;enter&quot; the script will terminate
   dw.stop
</span></pre>
<h3>Suppress Initial &quot;added&quot; Events</h3>
<p>
This little twist will suppress the initial &quot;added&quot; events that
are generated the first time the directory is scanned. This is done by
pre-loading the watcher with files &#8212; i.e. telling the watcher to scan
for files before actually starting the scan loop.
</p>
<pre class="code">
   <span class='require identifier id'>require</span> <span class='string val'>'directory_watcher'</span>

   <span class='dw identifier id'>dw</span> <span class='assign token'>=</span> <span class='DirectoryWatcher constant id'>DirectoryWatcher</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>'.'</span><span class='comma token'>,</span> <span class='symbol val'>:pre_load</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span> <span class='assign token'>=</span> <span class='string val'>'**/*.rb'</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='add_observer identifier id'>add_observer</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='event identifier id'>event</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='event identifier id'>event</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;}

   dw.start
   gets      # when the user hits &quot;enter&quot; the script will terminate
   dw.stop
</span></pre>
<p>
There is one catch with this recipe. The glob pattern must be specified
before the pre-load takes place. The glob pattern can be given as an option
to the constructor:
</p>
<pre class="code">
   <span class='dw identifier id'>dw</span> <span class='assign token'>=</span> <span class='DirectoryWatcher constant id'>DirectoryWatcher</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>'.'</span><span class='comma token'>,</span> <span class='symbol val'>:glob</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'**/*.rb'</span><span class='comma token'>,</span> <span class='symbol val'>:pre_load</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
</pre>
<p>
The other option is to use the reset method:
</p>
<pre class="code">
   <span class='dw identifier id'>dw</span> <span class='assign token'>=</span> <span class='DirectoryWatcher constant id'>DirectoryWatcher</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>'.'</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='glob identifier id'>glob</span> <span class='assign token'>=</span> <span class='string val'>'**/*.rb'</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='reset identifier id'>reset</span> <span class='true true kw'>true</span>     <span class='comment val'># the &lt;tt&gt;true&lt;/tt&gt; flag causes the watcher to pre-load</span>
                     <span class='comment val'># the files</span>
</pre>
<h3>Generate &quot;stable&quot; Events</h3>
<p>
In order to generate stable events, the stable count must be specified. In
this example the interval is set to 5.0 seconds and the stable count is set
to 2. Stable events will only be generated for files after they have remain
unchanged for 10 seconds (5.0 * 2).
</p>
<pre class="code">
   <span class='require identifier id'>require</span> <span class='string val'>'directory_watcher'</span>

   <span class='dw identifier id'>dw</span> <span class='assign token'>=</span> <span class='DirectoryWatcher constant id'>DirectoryWatcher</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>'.'</span><span class='comma token'>,</span> <span class='symbol val'>:glob</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'**/*.rb'</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='interval identifier id'>interval</span> <span class='assign token'>=</span> <span class='float val'>5.0</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='stable identifier id'>stable</span> <span class='assign token'>=</span> <span class='integer val'>2</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='add_observer identifier id'>add_observer</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='event identifier id'>event</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='event identifier id'>event</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;}

   dw.start
   gets      # when the user hits &quot;enter&quot; the script will terminate
   dw.stop
</span></pre>
<h3>Persisting State</h3>
<p>
A directory watcher can be configured to persist its current state to a
file when it is stopped and to load state from that same file when it
starts. Setting the <tt>persist</tt> value to a filename will enable this
feature.
</p>
<pre class="code">
   <span class='require identifier id'>require</span> <span class='string val'>'directory_watcher'</span>

   <span class='dw identifier id'>dw</span> <span class='assign token'>=</span> <span class='DirectoryWatcher constant id'>DirectoryWatcher</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>'.'</span><span class='comma token'>,</span> <span class='symbol val'>:glob</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'**/*.rb'</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='interval identifier id'>interval</span> <span class='assign token'>=</span> <span class='float val'>5.0</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='persist identifier id'>persist</span> <span class='assign token'>=</span> <span class='string val'>&quot;dw_state.yml&quot;</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='add_observer identifier id'>add_observer</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='event identifier id'>event</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='event identifier id'>event</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;}

   dw.start  # loads state from dw_state.yml
   gets      # when the user hits &quot;enter&quot; the script will terminate
   dw.stop   # stores state to dw_state.yml
</span></pre>
<h3>Running Once</h3>
<p>
Instead of using the built in run loop, the directory watcher can be run
one or many times using the <tt>run_once</tt> method. The state of the
directory watcher can be loaded and dumped if so desired.
</p>
<pre class="code">
   <span class='dw identifier id'>dw</span> <span class='assign token'>=</span> <span class='DirectoryWatcher constant id'>DirectoryWatcher</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='string val'>'.'</span><span class='comma token'>,</span> <span class='symbol val'>:glob</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'**/*.rb'</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='persist identifier id'>persist</span> <span class='assign token'>=</span> <span class='string val'>&quot;dw_state.yml&quot;</span>
   <span class='dw identifier id'>dw</span><span class='dot token'>.</span><span class='add_observer identifier id'>add_observer</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='args identifier id'>args</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='event identifier id'>event</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='event identifier id'>event</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;}

   dw.load!       # loads state from dw_state.yml
   dw.run_once
   sleep 5.0
   dw.run_once
   dw.persist!    # stores state to dw_state.yml
</span></pre>
<h2>Contact</h2>
<p>
A lot of discussion happens about Ruby in general on the ruby-talk mailing
list (http://www.ruby-lang.org/en/ml.html), and you can ask any questions
you might have there. I monitor the list, as do many other helpful
Rubyists, and you&#8217;re sure to get a quick answer. Of course,
you&#8217;re also welcome to email me (Tim Pease) directly at the at
tim.pease@gmail.com, and I&#8217;ll do my best to help you out.
</p>
<p>
(the above paragraph was blatantly stolen from Nathaniel Talbott&#8217;s
Test::Unit documentation)
</p>
<h2>Author</h2>
<p>
Tim Pease
</p>

</div><div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="Event-constant">Event</dt>
      <dd>Struct.new(:type, :path) do
def to_s( ) &quot;#{type} '#{path}'&quot; end</dd>
    
      <dt id="VERSION-constant">VERSION</dt>
      <dd>'1.2.0'    </dd>
    
  </dl>
</div>

</div>
</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>