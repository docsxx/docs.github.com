<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>troelskn's handsoap - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/troelskn/commits/handsoap/master" rel="alternate" title="Recent Commits to handsoap:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("troelskn", "handsoap", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='troelskn/handsoap/blob/074bf04d07667a7de60e4f7f9750588399ffbfd8' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='troelskn/handsoap/blob/074bf04d07667a7de60e4f7f9750588399ffbfd8' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("troelskn", "handsoap", "074bf04d07667a7de60e4f7f9750588399ffbfd8", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/troelskn/handsoap/tree/">Source</a></li>
            <li class=""><a href="http://github.com/troelskn/handsoap/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/troelskn/handsoap/network">Network</a></li>            
            <li class=""><a href="http://github.com/troelskn/handsoap/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/troelskn/handsoap">Wiki</a></li>
            <li class=""><a href="http://github.com/troelskn/handsoap/graphs">Graphs</a></li>                    
            <li class="active"><a href="/troelskn/handsoap">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/troelskn">troelskn</a> / <b><a href="http://github.com/troelskn/handsoap/tree">handsoap</a></b>        
                <a id="namespaces_button" rel="troelskn/handsoap/blob/074bf04d07667a7de60e4f7f9750588399ffbfd8" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="troelskn/handsoap/blob/074bf04d07667a7de60e4f7f9750588399ffbfd8" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Handsoap</h1>

<h2>Install</h2>

<pre class="code"><span class='gem identifier id'>gem</span> <span class='sources identifier id'>sources</span> <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
sudo gem install troelskn-handsoap curb nokogiri
</span></pre>

<h2>What</h2>

<p>Handsoap is a library for creating SOAP clients in Ruby.</p>

<p><a href="http://www.vimeo.com/4813848">Watch a tutorial</a>, showing how to use Handsoap. The final application can be found at: <a href="http://github.com/troelskn/handsoap-example/tree/master">http://github.com/troelskn/handsoap-example/tree/master</a></p>

<p>API docs are at <a href="http://rdoc.info/projects/troelskn/handsoap">http://rdoc.info/projects/troelskn/handsoap</a></p>

<p><img src="http://ny-image0.etsy.com/il_430xN.68558416.jpg" alt="Handsoap" /></p>

<h2>Why</h2>

<p>Ruby already has a SOAP-client library, <a href="http://dev.ctor.org/soap4r">soap4r</a>, so why create another one?</p>

<blockquote><p>Let me summarize SOAP4R: it smells like Java code built on a Monday morning by an EJB coder.</p>

<p>-- <a href="http://blog.labnotes.org/2008/01/28/ruby-in-practice-rest-soap-websphere-mq-and-salesforce/">Ruby In Practice: REST, SOAP, WebSphere MQ and SalesForce</a></p></blockquote>

<p>OK, not entirely fair, but soap4r has problems. It's incomplete and buggy. If you try to use it for any real-world services, you quickly run into compatibility issues. You can get around some of them, if you have control over the service, but you may not always be that lucky. In the end, even if you get it working, it has a bulky un-Rubyish feel to it.</p>

<p>Handsoap tries to do better by taking a minimalistic approach. Instead of a full abstraction layer, it is more like a toolbox with which you can write SOAP bindings. You could think of it as a <a href="http://c2.com/cgi/wiki?ForeignFunctionInterface">ffi</a> targeting SOAP.</p>

<p>This means that you generally need to do more manual labor in the cases where soap4r would have automated the mapping. It also means that you need to get your hands dirty with wsdl, xsd and other heavyweight specifications. However, it does give you some tools to help you stay sane.</p>

<p>There are several benefits of using Handsoap:</p>

<ul>
<li>It supports the entire SOAP specification, all versions (because you have to implement it your self).</li>
<li>You actually get a sporting chance to debug and fix protocol level bugs.</li>
<li>It's much faster than soap4r, because it uses fast low-level libraries for xml-parsing and http-communication.</li>
</ul>


<p>To summarise, soap4r takes an optimistic approach, where Handsoap expects things to fail. If soap4r works for you today, it's probably the better choice. If you find your self strugling with it, Handsoap will offer a more smooth ride. It won't magically fix things for you though.</p>

<h2>Handsoap vs. soap4r benchmark</h2>

<p>Benchmarks are always unfair, but my experiments has placed Handsoap at being approximately double as fast as soap4r. I'd love any suggestions for a more precise measure.</p>

<pre class="code">$ <span class='ruby identifier id'>ruby</span> <span class='tests identifier id'>tests</span><span class='div op'>/</span><span class='benchmark_test identifier id'>benchmark_test</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span> <span class='integer val'>1000</span>
<span class='Benchmarking constant id'>Benchmarking</span> <span class='integer val'>1000</span> <span class='calls identifier id'>calls</span> <span class='dot3 op'>...</span>
                <span class='user identifier id'>user</span>     <span class='system identifier id'>system</span>      <span class='total identifier id'>total</span>        <span class='real identifier id'>real</span>
<span class='handsoap identifier id'>handsoap</span>    <span class='integer val'>0</span><span class='integer val'>.750000</span>   <span class='integer val'>0</span><span class='integer val'>.090000</span>   <span class='integer val'>0</span><span class='integer val'>.840000</span> <span class='lparen token'>(</span>  <span class='float val'>1.992437</span><span class='rparen token'>)</span>
<span class='soap4r identifier id'>soap4r</span>      <span class='float val'>2.240000</span>   <span class='integer val'>0</span><span class='integer val'>.140000</span>   <span class='float val'>2.380000</span> <span class='lparen token'>(</span>  <span class='float val'>3.605836</span><span class='rparen token'>)</span>
<span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span><span class='minus op'>-</span>
<span class='Legend constant id'>Legend</span><span class='colon op'>:</span>
<span class='The constant id'>The</span> <span class='user identifier id'>user</span> <span class='CPU constant id'>CPU</span> <span class='time identifier id'>time</span><span class='comma token'>,</span> <span class='system identifier id'>system</span> <span class='CPU constant id'>CPU</span> <span class='time identifier id'>time</span><span class='comma token'>,</span> <span class='the identifier id'>the</span> <span class='sum identifier id'>sum</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='user identifier id'>user</span> <span class='and and kw'>and</span> <span class='system identifier id'>system</span> <span class='CPU constant id'>CPU</span> <span class='times identifier id'>times</span><span class='comma token'>,</span>
<span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='elapsed identifier id'>elapsed</span> <span class='real identifier id'>real</span> <span class='time identifier id'>time</span><span class='dot token'>.</span> <span class='The constant id'>The</span> <span class='unit identifier id'>unit</span> <span class='of identifier id'>of</span> <span class='time identifier id'>time</span> <span class='is identifier id'>is</span> <span class='seconds identifier id'>seconds</span><span class='dot token'>.</span>
</pre>

<h2>SOAP basics</h2>

<p>SOAP is a protocol that is tunneled through XML over HTTP. Apart from using the technology for transportation, it doesn't have much to do with HTTP. Some times, it hasn't even got much to do with XML either.</p>

<p>A SOAP client basically consists of three parts:</p>

<ul>
<li>A http-connectivity layer,</li>
<li>a mechanism for marshalling native data types to XML,</li>
<li>and a mechanism for unmarshalling XML to native data types.</li>
</ul>


<p>The protocol also contains a large and unwieldy specification of how to do the (un)marshalling, which can be used as the basis for automatically mapping to a rich type model. This makes the protocol fitting for .net/Java, but is a huge overhead for a very dynamically typed language such as Ruby. Much of the complexity of clients such as soap4r, is in the parts that tries to use this specification. Handsoap expects you to manually write the code that marshals/unmarshals, thereby bypassing this complexity (or rather - pass it to the programmer)</p>

<p>Handsoap only supports RPC-style SOAP. This seems to be the most common style. It's probably possible to add support for Document-style with little effort, but until I see the need I'm not going there.</p>

<h2>API documnetation</h2>

<p>In addition to this guide, there's autogenerated API documentation available at <a href="http://rdoc.info/projects/troelskn/handsoap">http://rdoc.info/projects/troelskn/handsoap</a></p>

<h2>The toolbox</h2>

<p>The Handsoap toolbox consists of the following components.</p>

<p>Handsoap can use either <a href="http://curb.rubyforge.org/">curb</a> or <a href="http://dev.ctor.org/http-access2">httpclient</a> for HTTP-connectivity. The former is recommended, and default, but for portability you might choose the latter. You usually don't need to interact at the HTTP-level, but if you do (for example, if you have to use SSL), you can.</p>

<p>For parsing XML, Handsoap defaults to use <a href="http://github.com/tenderlove/nokogiri/tree/master">Nokogiri</a>. Handsoap has an abstraction layer, so that you can switch between REXML, Nokogiri and ruby-libxml. Besides providing portability between these parsers, Handsop also gives some helper functions that are meaningful when parsing SOAP envelopes.</p>

<p>There is also a library for generating XML, which you'll use when mapping from Ruby to SOAP. It's quite similar to <a href="http://builder.rubyforge.org/">Builder</a>, but is tailored towards being used for writing SOAP-messages. The name of this library is <code>XmlMason</code> and it is included/part of Handsoap.</p>

<h2>Recommendations</h2>

<h3>Workflow</h3>

<ol>
<li><p>You need a WSDL for the service you want to consume.</p></li>
<li><p>Figure out the url for the endpoint, as well as the protocol version. Put this in a config file.</p>

<ul>
<li>To find the endpoint, look inside the wsdl, for <code>&lt;soap:address location=".."&gt;</code></li>
</ul>
</li>
<li><p>Create a service class. Add endpoints and protocol. Alias needed namespace(s).</p>

<ul>
<li>To find the namespace(s), look in the samples from soapUI. It will be imported as <code>v1</code></li>
<li>Note that you can now use the provided generator to skip this step.</li>
</ul>
</li>
<li><p>Open the wsdl in <a href="http://www.soapui.org/">soapUI</a>.</p></li>
<li><p>In soapUI, find a sample request for the method you want to use. Copy+paste the body-part.</p></li>
<li><p>Create a method in your service class (Use ruby naming convention)</p></li>
<li><p>Write Ruby-code (using XmlMason) to generate a request that is similar to the example from soapUI. (In your copy+paste buffer)</p></li>
<li><p>Write Ruby-code to parse the response (an XML-document) into Ruby data types.</p></li>
<li><p>Write an integration test to verify that your method works as expected. You can use soapUI to <a href="http://www.soapui.org/userguide/mock/getting_started.html">generate a mock-service</a>.</p></li>
</ol>


<p>Repeat point 5..9 for each method that you need to use.
Between each iteration, you should refactor shared code into helper functions.</p>

<h3>Configuration</h3>

<p>If you use Rails, you should put the endpoint in a constant in the environment file. That way, you can have different endpoints for test/development/production/etc.</p>

<p>If you don't use Rails, it's still a good idea to move this information to a config file.</p>

<p>The configuration could look like this:</p>

<pre class="code"><span class='comment val'># wsdl: http://example.org/ws/service?WSDL</span>
<span class='EXAMPLE_SERVICE_ENDPOINT constant id'>EXAMPLE_SERVICE_ENDPOINT</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
  <span class='symbol val'>:uri</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://example.org/ws/service'</span><span class='comma token'>,</span>
  <span class='symbol val'>:version</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>2</span>
<span class='rbrace token'>}</span>
</pre>

<p>If you use Rails, you will need to load the gem from the <code>config/environment.rb</code> file, using:</p>

<pre class="code"><span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>'troelskn-handsoap'</span><span class='comma token'>,</span> <span class='symbol val'>:lib</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'handsoap'</span><span class='comma token'>,</span> <span class='symbol val'>:source</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;http://gems.github.com&quot;</span>
</pre>

<p>If you use the standard development environment of Rails, you may run into troubles with cached classes. Add the following line to the initializer:</p>

<pre class="code"><span class='ActiveSupport constant id'>ActiveSupport</span><span class='colon2 op'>::</span><span class='Dependencies constant id'>Dependencies</span><span class='dot token'>.</span><span class='explicitly_unloadable_constants identifier id'>explicitly_unloadable_constants</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>'Handsoap::Service'</span>
</pre>

<h3>Generator</h3>

<p>From version 0.2.0 Handsoap sports a generator, that creates the service class + an integration test case. This is just a rough starting point for your service - You still have to fill out the actual mappings to/from xml, but at least it saves your some copy-pasting from this guide.</p>

<p>To use the generator, create a Rails project and run the script <code>script/generate handsoap</code>, giving the url of the WSDL.</p>

<h3>Service class</h3>

<p>Put your service in a file under <code>app/models</code>. You should extend <code>Handsoap::Service</code>.</p>

<p>You need to provide the endpoint and the SOAP version (1.1 or 1.2). If in doubt, use version 2.</p>

<p>A service usually has a namespace for describing the message-body (<a href="http://www.ibm.com/developerworks/webservices/library/ws-whichwsdl/#N1011F">RPC/Litteral style</a>). You should set this in the <code>on_create_document</code> handler. Likewise, the response returned <em>from</em> the server will contain elements that typically are defined in a single namespace relevant to the service. You can register this in the handler <code>on_response_document</code>.</p>

<p>A typical service looks like the following:</p>

<pre class="code"><span class='comment val'># -*- coding: utf-8 -*-</span>
<span class='require identifier id'>require</span> <span class='string val'>'handsoap'</span>

<span class='class class kw'>class</span> <span class='Example constant id'>Example</span><span class='colon2 op'>::</span><span class='FooService constant id'>FooService</span> <span class='lt op'>&lt;</span> <span class='Handsoap constant id'>Handsoap</span><span class='colon2 op'>::</span><span class='Service constant id'>Service</span>
  <span class='endpoint identifier id'>endpoint</span> <span class='EXAMPLE_SERVICE_ENDPOINT constant id'>EXAMPLE_SERVICE_ENDPOINT</span>
  <span class='def def kw'>def</span> <span class='on_create_document identifier id'>on_create_document</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
    <span class='comment val'># register namespaces for the request</span>
    <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='alias identifier id'>alias</span> <span class='string val'>'tns'</span><span class='comma token'>,</span> <span class='string val'>&quot;http://example.org/ws/spec&quot;</span>
  <span class='end end kw'>end</span>
  <span class='def def kw'>def</span> <span class='on_response_document identifier id'>on_response_document</span><span class='lparen token'>(</span><span class='doc identifier id'>doc</span><span class='rparen token'>)</span>
    <span class='comment val'># register namespaces for the response</span>
    <span class='doc identifier id'>doc</span><span class='dot token'>.</span><span class='add_namespace identifier id'>add_namespace</span> <span class='string val'>'ns'</span><span class='comma token'>,</span> <span class='string val'>'http://example.org/ws/spec'</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># public methods</span>
  <span class='comment val'># todo</span>

  <span class='private identifier id'>private</span>
  <span class='comment val'># helpers</span>
  <span class='comment val'># todo</span>
<span class='end end kw'>end</span>
</pre>

<p>The above would go in the file <code>app/models/example/foo_service.rb</code></p>

<h3>Integration tests</h3>

<p>Since you're writing mappings manually, it's a good idea to write tests that verify that the service works. If you use standard Rails with <code>Test::Unit</code>, you should put these in an integration-test.</p>

<p>For the sample service above, you would create a file in <code>test/integration/example/foo_service.rb</code>, with the following content:</p>

<pre class="code"><span class='comment val'># -*- coding: utf-8 -*-</span>
<span class='require identifier id'>require</span> <span class='string val'>'test_helper'</span>

<span class='comment val'># Example::FooService.logger = $stdout</span>

<span class='class class kw'>class</span> <span class='Example constant id'>Example</span><span class='colon2 op'>::</span><span class='FooServiceTest constant id'>FooServiceTest</span> <span class='lt op'>&lt;</span> <span class='Test constant id'>Test</span><span class='colon2 op'>::</span><span class='Unit constant id'>Unit</span><span class='colon2 op'>::</span><span class='TestCase constant id'>TestCase</span>
  <span class='def def kw'>def</span> <span class='test_update_icon identifier id'>test_update_icon</span>
    <span class='icon identifier id'>icon</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:href</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://www.example.com/icon.jpg'</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'image/jpeg'</span> <span class='rbrace token'>}</span>
    <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='Example constant id'>Example</span><span class='colon2 op'>::</span><span class='FooService constant id'>FooService</span><span class='dot token'>.</span><span class='update_icon! fid id'>update_icon!</span><span class='lparen token'>(</span><span class='icon identifier id'>icon</span><span class='rparen token'>)</span>
    <span class='assert_equal identifier id'>assert_equal</span> <span class='icon identifier id'>icon</span><span class='dot token'>.</span><span class='type identifier id'>type</span><span class='comma token'>,</span> <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='type identifier id'>type</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>

<p>Note the commented-out line. If you set a logger on the service-class, you can see exactly which XML goes forth and back, which is very useful for debugging.</p>

<h3>Methods</h3>

<p>You should use Ruby naming-conventions for methods names. If the method has side-effects, you should postfix it with an exclamation.
Repeat code inside the invoke-block, should be refactored out to <em>builders</em>, and the response should be parsed with a <em>parser</em>.</p>

<pre class="code"><span class='def def kw'>def</span> <span class='update_icon! fid id'>update_icon!</span><span class='lparen token'>(</span><span class='icon identifier id'>icon</span><span class='rparen token'>)</span>
  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='invoke identifier id'>invoke</span><span class='lparen token'>(</span><span class='string val'>&quot;tns:UpdateIcon&quot;</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='message identifier id'>message</span><span class='bitor op'>|</span>
    <span class='build_icon! fid id'>build_icon!</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='icon identifier id'>icon</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='parse_icon identifier id'>parse_icon</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='div op'>/</span><span class='string val'>&quot;//icon&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='first identifier id'>first</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>

<h3>Helpers</h3>

<p>You'll end up with two kinds of helpers; Ruby->XML transformers (aka. <em>builders</em>) and XML->Ruby transformers (aka. <em>parsers</em>).
It's recommended that you stick to the following style/naming scheme:</p>

<pre class="code"><span class='comment val'># icon -&gt; xml</span>
<span class='def def kw'>def</span> <span class='build_icon! fid id'>build_icon!</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='icon identifier id'>icon</span><span class='rparen token'>)</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='string val'>&quot;icon&quot;</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='set_attr identifier id'>set_attr</span> <span class='string val'>&quot;href&quot;</span><span class='comma token'>,</span> <span class='icon identifier id'>icon</span><span class='lbrack token'>[</span><span class='symbol val'>:href</span><span class='rbrack token'>]</span>
    <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='set_attr identifier id'>set_attr</span> <span class='string val'>&quot;type&quot;</span><span class='comma token'>,</span> <span class='icon identifier id'>icon</span><span class='lbrack token'>[</span><span class='symbol val'>:type</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>

<span class='comment val'># xml -&gt; icon</span>
<span class='def def kw'>def</span> <span class='parse_icon identifier id'>parse_icon</span><span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='rparen token'>)</span>
  <span class='lbrace token'>{</span> <span class='symbol val'>:href</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='div op'>/</span><span class='string val'>&quot;@href&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span> <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='div op'>/</span><span class='string val'>&quot;@type&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>

<p>or, if you prefer, you can use a class to represent entities:</p>

<pre class="code"><span class='comment val'># icon -&gt; xml</span>
<span class='def def kw'>def</span> <span class='build_icon! fid id'>build_icon!</span><span class='lparen token'>(</span><span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='icon identifier id'>icon</span><span class='rparen token'>)</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='add identifier id'>add</span> <span class='string val'>&quot;icon&quot;</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span>
    <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='set_attr identifier id'>set_attr</span> <span class='string val'>&quot;href&quot;</span><span class='comma token'>,</span> <span class='icon identifier id'>icon</span><span class='dot token'>.</span><span class='href identifier id'>href</span>
    <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='set_attr identifier id'>set_attr</span> <span class='string val'>&quot;type&quot;</span><span class='comma token'>,</span> <span class='icon identifier id'>icon</span><span class='dot token'>.</span><span class='type identifier id'>type</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>

<span class='comment val'># xml -&gt; icon</span>
<span class='def def kw'>def</span> <span class='parse_icon identifier id'>parse_icon</span><span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='rparen token'>)</span>
  <span class='Icon constant id'>Icon</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='symbol val'>:href</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='div op'>/</span><span class='string val'>&quot;@href&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='comma token'>,</span>
           <span class='symbol val'>:type</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lparen token'>(</span><span class='node identifier id'>node</span><span class='div op'>/</span><span class='string val'>&quot;@type&quot;</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
<span class='end end kw'>end</span>
</pre>

<h2>License</h2>

<p>Copyright: <a href="http://www.unwire.dk">Unwire A/S</a>, 2009</p>

<p>License: <a href="http://creativecommons.org/licenses/by/2.5/dk/deed.en_GB">Creative Commons Attribution 2.5 Denmark License</a></p>

<hr />

<p>troelskn@gmail.com - April, 2009</p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>