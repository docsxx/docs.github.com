<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>davetron5000's gliffy - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/davetron5000/commits/gliffy/master" rel="alternate" title="Recent Commits to gliffy:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("davetron5000", "gliffy", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='davetron5000/gliffy/blob/66820b6550256b3b6f84ba52cc1aa39a9b2402fd' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='davetron5000/gliffy/blob/66820b6550256b3b6f84ba52cc1aa39a9b2402fd' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("davetron5000", "gliffy", "66820b6550256b3b6f84ba52cc1aa39a9b2402fd", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/davetron5000/gliffy/tree/">Source</a></li>
            <li class=""><a href="http://github.com/davetron5000/gliffy/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/davetron5000/gliffy/network">Network</a></li>            
            <li class=""><a href="http://github.com/davetron5000/gliffy/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/davetron5000/gliffy">Wiki</a></li>
            <li class=""><a href="http://github.com/davetron5000/gliffy/graphs">Graphs</a></li>                    
            <li class="active"><a href="/davetron5000/gliffy">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/davetron5000">davetron5000</a> / <b><a href="http://github.com/davetron5000/gliffy/tree">gliffy</a></b>        
                <a id="namespaces_button" rel="davetron5000/gliffy/blob/66820b6550256b3b6f84ba52cc1aa39a9b2402fd" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="davetron5000/gliffy/blob/66820b6550256b3b6f84ba52cc1aa39a9b2402fd" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
This is the Ruby client library for interacting with
Gliffy[http://www.gliffy.com]. It&#8217;s main function is for you to
integrate Gliffy documents into the workflow of another application.
</p>
<h1>Getting Started</h1>
<pre class="code">
    <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='gliffy identifier id'>gliffy</span>
</pre>
<h1>Overview</h1>
<p>
The main entry point to Gliffy is Gliffy::Handle, which provides high-level
access to most features available from the API. You should instantiate one
of these objects per <em>user session</em>. To create it, you will need to
create and populate an instance of the Credentials class. This class is
constructed almost entirely from static data about your Gliffy account, so
you will probably configure an instance of this globally.
</p>
<p>
This is then used (along with the API root to Gliffy) to create an instance
of Gliffy::Handle. Objects of this class provide access to the features you
will need to integrate Gliffy into your app&#8217;s workflow.
</p>
<h2>Example</h2>
<p>
Suppose you have created a group blog application using Rails and wish to
give Blog authors the ability to use Gliffy diagrams. In
<tt>config/initializers/gliffy.rb</tt> you might configure values for the
Credential object
</p>
<pre class="code">
    <span class='$gliffy_api_key gvar id'>$gliffy_api_key</span> <span class='assign token'>=</span> <span class='string val'>'your-consumer-key-here'</span>
    <span class='$gliffy_secret gvar id'>$gliffy_secret</span> <span class='assign token'>=</span> <span class='string val'>'your-secret-here'</span>
    <span class='$gliffy_app_description gvar id'>$gliffy_app_description</span> <span class='assign token'>=</span> <span class='string val'>'My Awesome Group Blog'</span><span class='comma token'>,</span>
    <span class='$gliffy_account_id gvar id'>$gliffy_account_id</span> <span class='assign token'>=</span> <span class='integer val'>655321</span>
    <span class='$gliffy_root gvar id'>$gliffy_root</span> <span class='assign token'>=</span> <span class='string val'>'www.gliffy.com/api/v1'</span>
    <span class='$gliffy_edit_root gvar id'>$gliffy_edit_root</span> <span class='assign token'>=</span> <span class='string val'>'www.gliffy.com/gliffy'</span>
</pre>
<p>
Then, in your <tt>sessions_controller.rb</tt>:
</p>
<pre class="code">
    <span class='require identifier id'>require</span> <span class='string val'>'gliffy'</span>

    <span class='def def kw'>def</span> <span class='create identifier id'>create</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='current_user identifier id'>current_user</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='authenticate identifier id'>authenticate</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:email</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:password</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='if if kw'>if</span> <span class='logged_in? fid id'>logged_in?</span>
        <span class='comment val'># Whatever you do when they log in successfully</span>
        <span class='comment val'># Then create the credentials object</span>
        <span class='cred identifier id'>cred</span> <span class='assign token'>=</span> <span class='Credentials constant id'>Credentials</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>\
          <span class='$gliffy_api_key gvar id'>$gliffy_api_key</span><span class='comma token'>,</span>
          <span class='$gliffy_secret gvar id'>$gliffy_secret</span><span class='comma token'>,</span>
          <span class='$gliffy_app_description gvar id'>$gliffy_app_description</span><span class='comma token'>,</span>
          <span class='$gliffy_account_id gvar id'>$gliffy_account_id</span><span class='comma token'>,</span>
          <span class='self self kw'>self</span><span class='dot token'>.</span><span class='current_user identifier id'>current_user</span><span class='dot token'>.</span><span class='username identifier id'>username</span><span class='rparen token'>)</span>
        <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:gliffy</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='Gliffy constant id'>Gliffy</span><span class='colon2 op'>::</span><span class='Handle constant id'>Handle</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='$gliffy_root gvar id'>$gliffy_root</span><span class='comma token'>,</span><span class='$gliffy_edit_root gvar id'>$gliffy_edit_root</span><span class='comma token'>,</span><span class='cred identifier id'>cred</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
</pre>
<p>
Now you can use the gliffy handle in a controller or a view. Perhaps
you&#8217;d make an action to create a new document and send the user to
edit it:
</p>
<pre class="code">
    <span class='def def kw'>def</span> <span class='create identifier id'>create</span>
      <span class='new_doc identifier id'>new_doc</span> <span class='assign token'>=</span> <span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:gliffy</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='document_create identifier id'>document_create</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='redirect_to identifier id'>redirect_to</span><span class='lparen token'>(</span><span class='session identifier id'>session</span><span class='lbrack token'>[</span><span class='symbol val'>:gliffy</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='document_edit_link identifier id'>document_edit_link</span><span class='lparen token'>(</span><span class='new_doc identifier id'>new_doc</span><span class='dot token'>.</span><span class='document_id identifier id'>document_id</span><span class='comma token'>,</span>
                  <span class='lbrace token'>{</span><span class='symbol val'>:returnURL</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='url_for identifier id'>url_for</span><span class='lparen token'>(</span><span class='symbol val'>:controller</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'return_from_gliffy'</span><span class='rparen token'>)</span><span class='comma token'>,</span>
                   <span class='symbol val'>:returnButtonText</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Back to My Awesome Blog'</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
</pre>
<h2>Digging Deeper</h2>
<p>
If you wish to bypass the high-level API, you can interact with Gliffy
directly via the Gliffy::Request class, which allows you to make arbitrary
requests against the Gliffy API, but takes care of signing your URLs and
all OAuth things that need to be done:
</p>
<pre class="code">
    <span class='comment val'># Create a Credentials object as normal</span>
    <span class='request identifier id'>request</span> <span class='assign token'>=</span> <span class='Gliffy constant id'>Gliffy</span><span class='colon2 op'>::</span><span class='Request constant id'>Request</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'www.gliffy.com/api/v1'</span><span class='comma token'>,</span><span class='credentials identifier id'>credentials</span><span class='rparen token'>)</span>
    <span class='comment val'># The method name maps directly to Gliffy's &quot;action&quot; parameters</span>
    <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='string val'>'accounts/$account_id/documents/12345'</span><span class='rparen token'>)</span>
</pre>
<p>
You can manipulate the response directly, or attempt to parse it using the
Gliffy::Response object:
</p>
<pre class="code">
    <span class='model identifier id'>model</span> <span class='assign token'>=</span> <span class='Response constant id'>Response</span><span class='dot token'>.</span><span class='from_http_response identifier id'>from_http_response</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='rparen token'>)</span>
</pre>
<h1>Design</h1>
<h2>Domain Objects</h2>
<p>
Instead of creating explicit objects for each domain object in Gliffy, we
always return a Response object, that uses method_missing to implement
accessors for data returned from Gliffy. These implicit accessors should
return typed values and are named accordingly:
</p>
<ul>
<li>If the name in the XSD[http://www.gliffy.com/developer/apidocs/xsddoc/] has
dashes, underscores are used here

</li>
<li>If the item is a boolean, its boolean value is available with a
&quot;?&quot; at the end

</li>
<li>The id field is available as type_id, e.g. document_id

</li>
<li>Date fields are converted to Time objects

</li>
<li>Any field in the response that was not known about in this code will be
available as a String, based on the above rules

</li>
</ul>
<p>
So, if you requested document meta data, you would have the following
accessors available:
</p>
<ul>
<li>document.document_id

</li>
<li>document.is_private?

</li>
<li>document.is_public?

</li>
<li>document.num_versions

</li>
<li>document.mod_date # returns a Time

</li>
<li>document.create_date # returns a Time

</li>
<li>document.published_date # returns a Time

</li>
<li>document.owner # Returns a Response that responds to user accessors

</li>
<li>document.versions # Returns an array of Response objects that act like
versions

</li>
</ul>
<h2>HTTP Layer</h2>
<p>
Request implements the HTTP layer, and is based on HTTParty. Since all
Gliffy URLs have an &quot;action&quot; HTTP param in them, this action is
the method name, followed by the URL on which to perform that action (this
is not a REST action, but specific to Gliffy). You can optionally include
other HTTP params, however those needed for authentication and signing are
taken care of. Request will examine the Credential object used to create
the Request object, sign the request, make the request and return the
result. It will look at the result only enough to determine if it&#8217;s
an error, or a failure. See the RubyDoc for more on how this works.
</p>
<h1>Development</h1>
<h2>Gems</h2>
<p>
You will need:
</p>
<pre class="code">
 <span class='mult op'>*</span> <span class='hanna identifier id'>hanna</span> <span class='integer val'>0</span><span class='float val'>.1.7</span><span class='comma token'>,</span> <span class='available identifier id'>available</span> <span class='via identifier id'>via</span> <span class='xstring val'>`gem install mislav-hanna`</span>
 <span class='mult op'>*</span> <span class='httparty identifier id'>httparty</span> <span class='integer val'>0</span><span class='float val'>.4.2</span> <span class='or or kw'>or</span> <span class='better identifier id'>better</span>
 <span class='mult op'>*</span> <span class='ruby identifier id'>ruby</span><span class='minus op'>-</span><span class='hmac identifier id'>hmac</span> <span class='integer val'>0</span><span class='float val'>.3.2</span> <span class='or or kw'>or</span> <span class='better identifier id'>better</span>
 <span class='mult op'>*</span> <span class='gli identifier id'>gli</span> <span class='integer val'>0</span><span class='float val'>.1.6</span> <span class='or or kw'>or</span> <span class='better identifier id'>better</span>
</pre>
<p>
All of these save for hanna are installed if you installed the gem.
</p>
<h2>Unit Tests</h2>
<p>
Make sure you get at least 100% statement coverage of the code you write
via Unit Tests.
</p>
<p>
Sometimes the test that two nonces shouldn&#8217;t be the same fails. This
occurs, because they are generated in pretty much the same instant AND when
the random number generator generates the same number twice in a row.
Usually if you run tests again, things pass.
</p>
<h2>Integration Tests</h2>
<p>
This code is capable of running integration tests against Gliffy&#8217;s
integration test servers. If you would like to run these tests, you must
contact Gliffy for the information needed. You could technically run
integration tests against your own Gliffy account on their production
server, but this may delete or change your account&#8217;s data and is not
recommended. Once you have the information from Gliffy, create the file
`test/it_cred.rb` as follows:
</p>
<pre class="code">
    <span class='$account_id gvar id'>$account_id</span> <span class='assign token'>=</span> <span class='comment val'># integration tests account id</span>
    <span class='$username gvar id'>$username</span> <span class='assign token'>=</span> <span class='comment val'># integration tests admin user name</span>
    <span class='$oauth_consumer_key gvar id'>$oauth_consumer_key</span> <span class='assign token'>=</span> <span class='comment val'># integration test account consumer key</span>
    <span class='$oauth_consumer_secret gvar id'>$oauth_consumer_secret</span> <span class='assign token'>=</span> <span class='comment val'># integration test account consumer secret</span>
    <span class='$api_root gvar id'>$api_root</span> <span class='assign token'>=</span> <span class='comment val'># integration test server API endpoint</span>
    <span class='$http_auth_username gvar id'>$http_auth_username</span> <span class='assign token'>=</span> <span class='comment val'># integration test server HTTP Auth username</span>
    <span class='$http_auth_password gvar id'>$http_auth_password</span> <span class='assign token'>=</span> <span class='comment val'># integration test server HTTP Auth password</span>
</pre>
<h2>Functional Tests</h2>
<p>
The functional tests perform actual workflows against a Gliffy server and,
as such, are more fragile. If something is wrong in your environment (or
with Gliffy), you could leave the test account in a weird state. As such,
you should create a new account using a test-only API call. This can be
done via
</p>
<pre class="code">
    <span class='rake identifier id'>rake</span> <span class='setup_account identifier id'>setup_account</span>
</pre>
<p>
This requires that it_cred.rb is set up and runs test/setup_account.rb.
This will create the file functest_cred.rb with the necessary information
to access the newly created account. The accounts seem to get reset every
day, so you will not be able to reliably automate this. That being said,
the only way to get 100% coverage is to run these tests.
</p>
<p>
Each functional test assumes the following:
</p>
<ul>
<li>The account name is &#8216;Ruby Client Test Account&#8217;

</li>
<li>The account id is 1000001

</li>
<li>The only user is testuser@gliffy.com

</li>
<li>There are no documents/diagrams

</li>
<li>The only folder is ROOT

</li>
</ul>
<p>
Each test will put data into Gliffy, query it, and remove it, thus leaving
the account in the same state.
</p>
<p>
To fully test the edit launch link, run
</p>
<pre class="code">
    <span class='rake identifier id'>rake</span> <span class='TEST_LINK constant id'>TEST_LINK</span><span class='assign token'>=</span><span class='true true kw'>true</span> <span class='functest identifier id'>functest</span>
</pre>
<p>
This will print out the launch link and pause the testing. Copy/Paste this
into your browser to make sure it works and then come back to the console
and hit return. Do not do this for automated builds.
</p>
<h2>JUnit output</h2>
<p>
I monkeypatched the Ruby unit test classes to output JUnit-style XML when
the tests are run. I believe this file gets overridden with each type of
test, but you only really should care about it for the `test` target. The
file is called `junit_output.xml`.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>