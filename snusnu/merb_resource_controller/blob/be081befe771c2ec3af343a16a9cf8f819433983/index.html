<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>snusnu's merb_resource_controller - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/snusnu/commits/merb_resource_controller/master" rel="alternate" title="Recent Commits to merb_resource_controller:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("snusnu", "merb_resource_controller", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='snusnu/merb_resource_controller/blob/be081befe771c2ec3af343a16a9cf8f819433983' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='snusnu/merb_resource_controller/blob/be081befe771c2ec3af343a16a9cf8f819433983' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("snusnu", "merb_resource_controller", "be081befe771c2ec3af343a16a9cf8f819433983", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/snusnu/merb_resource_controller/tree/">Source</a></li>
            <li class=""><a href="http://github.com/snusnu/merb_resource_controller/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/snusnu/merb_resource_controller/network">Network</a></li>            
            <li class=""><a href="http://github.com/snusnu/merb_resource_controller/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/snusnu/merb_resource_controller">Wiki</a></li>
            <li class=""><a href="http://github.com/snusnu/merb_resource_controller/graphs">Graphs</a></li>                    
            <li class="active"><a href="/snusnu/merb_resource_controller">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/snusnu">snusnu</a> / <b><a href="http://github.com/snusnu/merb_resource_controller/tree">merb_resource_controller</a></b>        
                <a id="namespaces_button" rel="snusnu/merb_resource_controller/blob/be081befe771c2ec3af343a16a9cf8f819433983" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="snusnu/merb_resource_controller/blob/be081befe771c2ec3af343a16a9cf8f819433983" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h2>merb_resource_controller</h2>


	<p>A merb plugin that provides the default <code>CRUD</code> actions for controllers and allows for easy customization
of the generated actions. <code>merb_resource_controller</code> only supports <code>datamapper</code> so far. Implementing support
for <code>active_record</code> would be trivial, but I have no need for it.</p>


	<p>Currently, <code>merb_resource_controller</code> needs an extra specification inside the controller to define the nesting strategy
to use. This shouldn&#8217;t really be necessary, since this information could be provided by the <code>Merb::Router</code>.
I&#8217;m planning to have a look into this soon! With that in place, nested resource_controllers could be <em>3 liners</em> 
that just do what you would expect them to do.</p>


	<p>To get you started with <code>merb_resource_controller</code>, all you have to do is extend it into your controller.
Most probably you will want extend it into the <code>Application</code> controller, which will make the <code>controlling</code>
method available to all your application&#8217;s controllers.</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Application constant id'>Application</span> <span class='lt op'>&lt;</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='Controller constant id'>Controller</span>
  <span class='extend identifier id'>extend</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ResourceController constant id'>ResourceController</span><span class='colon2 op'>::</span><span class='Mixin constant id'>Mixin</span><span class='colon2 op'>::</span><span class='ClassMethods constant id'>ClassMethods</span>
<span class='end end kw'>end</span>
</pre>

	<p>And here is a quick example showing a controller for a standard toplevel resource with all standard <code>CRUD</code> actions.</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Articles constant id'>Articles</span> <span class='lt op'>&lt;</span> <span class='Application constant id'>Application</span>
  <span class='controlling identifier id'>controlling</span> <span class='symbol val'>:articles</span>
<span class='end end kw'>end</span>
</pre>

	<p>If you don&#8217;t want all standard <code>CRUD</code> actions to be generated, give <code>merb_resource_controller</code> the exact list
of actions you want your controller to have.</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Articles constant id'>Articles</span> <span class='lt op'>&lt;</span> <span class='Application constant id'>Application</span>
  <span class='controlling identifier id'>controlling</span> <span class='symbol val'>:articles</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span>
    <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='action identifier id'>action</span> <span class='symbol val'>:create</span>
    <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='action identifier id'>action</span> <span class='symbol val'>:update</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>

	<p>Alternatively, you can also add more than one action at once using the <code>actions</code> method available on the <code>ResourceProxy</code></p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Articles constant id'>Articles</span> <span class='lt op'>&lt;</span> <span class='Application constant id'>Application</span>
  <span class='controlling identifier id'>controlling</span> <span class='symbol val'>:articles</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span>
    <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='actions identifier id'>actions</span> <span class='symbol val'>:create</span><span class='comma token'>,</span> <span class='symbol val'>:update</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>

	<p>If you are using models that are nested inside some <code>module</code> (maybe you&#8217;re developing a <code>slice</code> ?), you need to 
provide the fully qualified class name to the <code>controlling</code> method. Per default, <code>merb_resource_controller</code> assumes 
that you don&#8217;t want to use the fully qualified name to generate your instance variables and association calls.</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Ratings constant id'>Ratings</span> <span class='lt op'>&lt;</span> <span class='Application constant id'>Application</span>
  <span class='controlling identifier id'>controlling</span> <span class='string val'>&quot;Community::Rating&quot;</span> 
<span class='end end kw'>end</span>
</pre>

	<p>This will initialize the instance variable <code>@ratings</code> (or <code>@rating</code> respectively). If this resource is nested below 
another resource (see next section), this also means that the <code>:ratings</code> (or <code>:rating</code> respectively) association will
be used to navigate from the parent resource down to this resource.</p>


	<p>If however, you want to use fully qualified names for your instance variables and association calls, you can explicitly
pass <code>:fully_qualified =&gt; true</code> to the <code>controlling</code> method (<code>false</code> is the default).</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Ratings constant id'>Ratings</span> <span class='lt op'>&lt;</span> <span class='Application constant id'>Application</span>
  <span class='controlling identifier id'>controlling</span> <span class='string val'>&quot;Community::Rating&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:fully_qualified</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre>

	<p>This will initialize the instance variable <code>@community_ratings</code> (or <code>@community_rating</code> respectively). If this resource
is nested below another resource (see next section), this also means that the <code>:community_ratings</code> (or 
<code>:community_rating</code> respectively) association will be used to navigate from the parent resource down to this resource.</p>


	<h2>Nested Resources</h2>


	<p><code>merb_resource_controller</code> will automatically recognize if it is accessed from a toplevel or a nested url, and
will <em>adjust</em> its actions accordingly. It will also initialize all the instance variables
you would expect for your chosen nesting strategy. This means, that when you have an <span class="caps">URL</span> like
<code>/articles/1/comments</code>, you will have an <code>@article</code> variable pointing to <code>Article.get(1)</code> and a <code>@comments</code> variable
pointing to <code>Article.get(1).comments</code>.</p>


	<p>It&#8217;s important to note, that no database operations will be performed more than once!
So in the case of <code>/articles/1/comments/1/ratings</code>, <code>merb_resource_controller</code> will do exactly what you would
expect it to do: It will issue <code>Article.get(1).comments.get(1).ratings</code>, initializing 
<code>@article</code>, <code>@comment</code> and <code>@ratings</code> with the intermediate results on it&#8217;s way down the association chain.</p>


	<p>Speaking of an <em>association chain</em>, it is worth mentioning that it is by no means necessary that your 
underlying models are connected via <em>real datamapper associations</em> (like <code>has n, ...</code> or <code>belongs_to</code>). 
The only requirement is, that the object returned from a call to the nested <em>collection</em> <code>respond_to?(:get)</code> 
(in most cases it will be a <code>DataMapper::Collection</code> anyway).</p>


<pre class="code">
<span class='lt op'>&lt;</span><span class='regexp val'>/code&gt;
class Comments &lt; Application
  controlling :comments do |c|
    c.belongs_to :article
  end
end

  &lt;p&gt;class Ratings &lt; Application
  controlling :ratings do |r|
    r.belongs_to [ :article, :comment ]
  end
end
</span></pre></p>


	<h2>Nested Singleton Resources</h2>


	<p>First of all, singleton resources (currently) must always be nested below at least one parent resource.</p>


	<p>This is mostly because I somehow can&#8217;t really imagine a usecase for a real toplevel singleton resource? I mean, there 
must be  <em>some</em> information on <em>how</em> to load that <em>one</em> resource. Since we&#8217;re mostly dealing with database backends here,
we should probably need some kind of <em>key</em> to identify exactly <em>one</em> dataset, but we don&#8217;t get that <em>key</em> from a resource 
like  <code>/profile</code> (<em>where</em> is the <code>:id</code> param here?). So my guess is, that most of the toplevel singleton resources that
<em>are</em> actually used, really are nested below some kind of resource that&#8217;s stored in the <code>session</code>, most probably the
authenticated <code>user</code> object. If this is the case, it would be perfectly valid, to just <em>really nest</em> those singletons 
below their real parent, and probably add a route alias to keep up the disguise. If you can come up with a usecase
where you have a real toplevel singleton resource that needs <em>no key</em> to be loaded, just don&#8217;t use
<code>merb_resource_controller</code>. Really, it&#8217;s that simple! If however, I&#8217;m completely on the wrong track here, I would be glad
to be informed about it, so that I can fix things up.</p>


	<p>The example code below behaves almost exactly like described in the section on <em>Nested Resources</em> above. The only
two differences are, that 1) <code>no index action</code> will be generated and that 2) the initialized instance variables will be
named <code>@article</code> and <code>@editor</code> if you have a singleton resource nested like <code>/articles/1/editor</code>. Just like you would 
expect, no?</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Editors constant id'>Editors</span> <span class='lt op'>&lt;</span> <span class='Application constant id'>Application</span>

  <span class='controlling identifier id'>controlling</span> <span class='symbol val'>:editor</span><span class='comma token'>,</span> <span class='symbol val'>:singleton</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='e identifier id'>e</span><span class='bitor op'>|</span>
    <span class='e identifier id'>e</span><span class='dot token'>.</span><span class='belongs_to identifier id'>belongs_to</span> <span class='symbol val'>:article</span>
  <span class='end end kw'>end</span>

<span class='end end kw'>end</span>
</pre>

	<h2>DataMapper&#8217;s Identity Map</h2>


	<p>Including <code>Merb::ResourceController::DM::IdentityMapSupport</code> into any of your controller will wrap all actions 
inside a dm repository block in order to be able to use DM&#8217;s identitiy map feature. For more information on that topic,
have a look at <a href="http://datamapper.org/doku.php?id=docs:identity_map">DataMapper&#8217;s Identity Map</a></p>


	<p>Feel free to include this module into <em>single</em> controllers instead of including it into <code>Application</code> controller, which
enables identity maps for <em>every</em> controller action in your app.</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Application constant id'>Application</span> <span class='lt op'>&lt;</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='Controller constant id'>Controller</span>  
  <span class='include identifier id'>include</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ResourceController constant id'>ResourceController</span><span class='colon2 op'>::</span><span class='DM constant id'>DM</span><span class='colon2 op'>::</span><span class='IdentityMapSupport constant id'>IdentityMapSupport</span>
<span class='end end kw'>end</span>
</pre>

	<h2>Action Timeouts</h2>


	<p>Extending <code>Merb::ResourceController::ActionTimeout</code>  into any of your controllers, will give you the <code>set_action_timeout</code>
method. If you specify an action_timeout greater or equal to <code>1</code> and you have the <code>system_timer</code> gem installed, the 
action will timeout after the given amount of seconds. For a more detailed explanation on the topic have a look at
<a href="http://adam.blog.heroku.com/past/2008/6/17/battling_wedged_mongrels_with_a/">Battling Wedged Mongrels with a Request Timeout</a></p>


	<p>Feel free to set action timeouts for <em>single</em> controllers instead of doing so in <code>Application</code> controller, which sets 
the same action timeout for <em>every</em> controller action in your app.</p>


<pre class="code">
<span class='class class kw'>class</span> <span class='Application constant id'>Application</span> <span class='lt op'>&lt;</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='Controller constant id'>Controller</span>
  <span class='extend identifier id'>extend</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ResourceController constant id'>ResourceController</span><span class='colon2 op'>::</span><span class='ActionTimeout constant id'>ActionTimeout</span>  
  <span class='set_action_timeout identifier id'>set_action_timeout</span> <span class='integer val'>1</span>
<span class='end end kw'>end</span>
</pre>

	<h2>Defined Actions</h2>


	<p>All the above controllers will have the following actions defined. Feel free to override them, to customize 
how the controllers behave. Of course you are also free to override all the methods used by these defined actions.</p>


<pre class="code">  
<span class='def def kw'>def</span> <span class='index identifier id'>index</span>
  <span class='set_action_specific_provides identifier id'>set_action_specific_provides</span><span class='lparen token'>(</span><span class='symbol val'>:index</span><span class='rparen token'>)</span>
  <span class='load_resource identifier id'>load_resource</span>
  <span class='display identifier id'>display</span> <span class='requested_resource identifier id'>requested_resource</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='show identifier id'>show</span>
  <span class='set_action_specific_provides identifier id'>set_action_specific_provides</span><span class='lparen token'>(</span><span class='symbol val'>:show</span><span class='rparen token'>)</span>
  <span class='load_resource identifier id'>load_resource</span>
  <span class='raise identifier id'>raise</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ControllerExceptions constant id'>ControllerExceptions</span><span class='colon2 op'>::</span><span class='NotFound constant id'>NotFound</span> <span class='unless unless_mod kw'>unless</span> <span class='requested_resource identifier id'>requested_resource</span>
  <span class='display identifier id'>display</span> <span class='requested_resource identifier id'>requested_resource</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='new identifier id'>new</span>
  <span class='set_action_specific_provides identifier id'>set_action_specific_provides</span><span class='lparen token'>(</span><span class='symbol val'>:new</span><span class='rparen token'>)</span>
  <span class='load_resource identifier id'>load_resource</span>
  <span class='set_member identifier id'>set_member</span><span class='lparen token'>(</span><span class='new_member identifier id'>new_member</span><span class='rparen token'>)</span>
  <span class='display identifier id'>display</span> <span class='member identifier id'>member</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='edit identifier id'>edit</span>
  <span class='set_action_specific_provides identifier id'>set_action_specific_provides</span><span class='lparen token'>(</span><span class='symbol val'>:edit</span><span class='rparen token'>)</span>
  <span class='load_resource identifier id'>load_resource</span>
  <span class='raise identifier id'>raise</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ControllerExceptions constant id'>ControllerExceptions</span><span class='colon2 op'>::</span><span class='NotFound constant id'>NotFound</span> <span class='unless unless_mod kw'>unless</span> <span class='requested_resource identifier id'>requested_resource</span>
  <span class='display identifier id'>display</span> <span class='requested_resource identifier id'>requested_resource</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='create identifier id'>create</span>
  <span class='set_action_specific_provides identifier id'>set_action_specific_provides</span><span class='lparen token'>(</span><span class='symbol val'>:create</span><span class='rparen token'>)</span>
  <span class='load_resource identifier id'>load_resource</span>
  <span class='set_member identifier id'>set_member</span><span class='lparen token'>(</span><span class='new_member identifier id'>new_member</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='member identifier id'>member</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='handle_successful_create identifier id'>handle_successful_create</span>
  <span class='else else kw'>else</span>
    <span class='handle_failed_create identifier id'>handle_failed_create</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='update identifier id'>update</span>
  <span class='set_action_specific_provides identifier id'>set_action_specific_provides</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='rparen token'>)</span>
  <span class='load_resource identifier id'>load_resource</span>
  <span class='raise identifier id'>raise</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ControllerExceptions constant id'>ControllerExceptions</span><span class='colon2 op'>::</span><span class='NotFound constant id'>NotFound</span> <span class='unless unless_mod kw'>unless</span> <span class='requested_resource identifier id'>requested_resource</span>
  <span class='if if kw'>if</span> <span class='requested_resource identifier id'>requested_resource</span><span class='dot token'>.</span><span class='update_attributes identifier id'>update_attributes</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='member_name identifier id'>member_name</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='handle_successful_update identifier id'>handle_successful_update</span>
  <span class='else else kw'>else</span>
    <span class='handle_failed_update identifier id'>handle_failed_update</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='destroy identifier id'>destroy</span>
  <span class='set_action_specific_provides identifier id'>set_action_specific_provides</span><span class='lparen token'>(</span><span class='symbol val'>:destroy</span><span class='rparen token'>)</span>
  <span class='load_resource identifier id'>load_resource</span>
  <span class='raise identifier id'>raise</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ControllerExceptions constant id'>ControllerExceptions</span><span class='colon2 op'>::</span><span class='NotFound constant id'>NotFound</span> <span class='unless unless_mod kw'>unless</span> <span class='requested_resource identifier id'>requested_resource</span>
  <span class='if if kw'>if</span> <span class='requested_resource identifier id'>requested_resource</span><span class='dot token'>.</span><span class='destroy identifier id'>destroy</span>
    <span class='handle_successful_destroy identifier id'>handle_successful_destroy</span>
  <span class='else else kw'>else</span>
    <span class='handle_failed_destroy identifier id'>handle_failed_destroy</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>

	<h2>Additional Methods to override</h2>


	<p>In addition to the actions and the methods they are using, you will probably want to override some other methods that
<code>merb_resource_controller</code> uses to do its thing. Here are some default method implementations you can override to this effect:</p>


	<h3>Customize the create action</h3>


<pre class="code">
<span class='def def kw'>def</span> <span class='handle_successful_create identifier id'>handle_successful_create</span>
  <span class='handle_content_type identifier id'>handle_content_type</span><span class='lparen token'>(</span><span class='symbol val'>:create</span><span class='comma token'>,</span> <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span> <span class='symbol val'>:success</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='handle_failed_create identifier id'>handle_failed_create</span>
  <span class='handle_content_type identifier id'>handle_content_type</span><span class='lparen token'>(</span><span class='symbol val'>:create</span><span class='comma token'>,</span> <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span> <span class='symbol val'>:failure</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='html_response_on_successful_create identifier id'>html_response_on_successful_create</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='flash_messages_for? fid id'>flash_messages_for?</span><span class='lparen token'>(</span><span class='symbol val'>:create</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='successful_create_messages identifier id'>successful_create_messages</span> <span class='rbrace token'>}</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='redirect identifier id'>redirect</span> <span class='redirect_on_successful_create identifier id'>redirect_on_successful_create</span><span class='comma token'>,</span> <span class='options identifier id'>options</span>          
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='html_response_on_failed_create identifier id'>html_response_on_failed_create</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='failed_create_messages identifier id'>failed_create_messages</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='flash_messages_for? fid id'>flash_messages_for?</span><span class='lparen token'>(</span><span class='symbol val'>:create</span><span class='rparen token'>)</span>
  <span class='render identifier id'>render</span> <span class='symbol val'>:new</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>406</span>         
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='xml_response_on_successful_create identifier id'>xml_response_on_successful_create</span>
  <span class='display identifier id'>display</span> <span class='member identifier id'>member</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>201</span><span class='comma token'>,</span> <span class='symbol val'>:location</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='member identifier id'>member</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='xml_response_on_failed_create identifier id'>xml_response_on_failed_create</span>
  <span class='display identifier id'>display</span> <span class='member identifier id'>member</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>422</span>
<span class='end end kw'>end</span>        

<span class='def def kw'>def</span> <span class='json_response_on_successful_create identifier id'>json_response_on_successful_create</span>
  <span class='display identifier id'>display</span> <span class='member identifier id'>member</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>201</span><span class='comma token'>,</span> <span class='symbol val'>:location</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='member identifier id'>member</span><span class='rparen token'>)</span>         
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='json_response_on_failed_create identifier id'>json_response_on_failed_create</span>
  <span class='display identifier id'>display</span> <span class='member identifier id'>member</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>422</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='redirect_on_successful_create identifier id'>redirect_on_successful_create</span>
  <span class='target identifier id'>target</span> <span class='assign token'>=</span> <span class='singleton_controller? fid id'>singleton_controller?</span> <span class='integer val'>? </span><span class='member_name identifier id'>member_name</span> <span class='colon op'>:</span> <span class='member identifier id'>member</span>
  <span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='has_parent? fid id'>has_parent?</span> <span class='integer val'>? </span><span class='parents identifier id'>parents</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span> <span class='target identifier id'>target</span> <span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span> <span class='target identifier id'>target</span> <span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='comment val'># These are available by default (i.e. if all actions are available)</span>
<span class='comment val'># If you specify specific actions inside the block passed to #controlling</span>
<span class='comment val'># you need to pass the :flash option to the ResourceProxy#action like so:</span>
<span class='comment val'># action :create, :flash =&gt; true</span>

<span class='def def kw'>def</span> <span class='successful_create_messages identifier id'>successful_create_messages</span>
  <span class='lbrace token'>{</span> <span class='symbol val'>:notice</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{member.class.name} was successfully created&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='failed_create_messages identifier id'>failed_create_messages</span>
  <span class='lbrace token'>{</span> <span class='symbol val'>:error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;Failed to create new #{member.class.name}&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>

	<h3>Customize the update action</h3>


<code>
<pre class="code">
<span class='def def kw'>def</span> <span class='handle_successful_update identifier id'>handle_successful_update</span>
  <span class='handle_content_type identifier id'>handle_content_type</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='comma token'>,</span> <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span> <span class='symbol val'>:success</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='handle_failed_update identifier id'>handle_failed_update</span>
  <span class='handle_content_type identifier id'>handle_content_type</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='comma token'>,</span> <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span> <span class='symbol val'>:failure</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='html_response_on_successful_update identifier id'>html_response_on_successful_update</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='flash_messages_for? fid id'>flash_messages_for?</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='successful_update_messages identifier id'>successful_update_messages</span> <span class='rbrace token'>}</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='redirect identifier id'>redirect</span> <span class='redirect_on_successful_update identifier id'>redirect_on_successful_update</span><span class='comma token'>,</span> <span class='options identifier id'>options</span>       
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='html_response_on_failed_update identifier id'>html_response_on_failed_update</span>
  <span class='message identifier id'>message</span><span class='dot token'>.</span><span class='merge! fid id'>merge!</span><span class='lparen token'>(</span><span class='failed_update_messages identifier id'>failed_update_messages</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='flash_messages_for? fid id'>flash_messages_for?</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='rparen token'>)</span>
  <span class='display identifier id'>display</span> <span class='requested_resource identifier id'>requested_resource</span><span class='comma token'>,</span> <span class='symbol val'>:edit</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>406</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='xml_response_on_successful_update identifier id'>xml_response_on_successful_update</span>
  <span class='string val'>&quot;&quot;</span> <span class='comment val'># render no content, just 200 (OK) status.</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='xml_response_on_failed_update identifier id'>xml_response_on_failed_update</span>
  <span class='display identifier id'>display</span> <span class='member identifier id'>member</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>422</span>
<span class='end end kw'>end</span>        

<span class='def def kw'>def</span> <span class='json_response_on_successful_update identifier id'>json_response_on_successful_update</span>
  <span class='string val'>&quot;&quot;</span> <span class='comment val'># render no content, just 200 (OK) status.</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='json_response_on_failed_update identifier id'>json_response_on_failed_update</span>
  <span class='display identifier id'>display</span> <span class='member identifier id'>member</span><span class='dot token'>.</span><span class='errors identifier id'>errors</span><span class='comma token'>,</span> <span class='symbol val'>:status</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>422</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='redirect_on_successful_update identifier id'>redirect_on_successful_update</span>
  <span class='target identifier id'>target</span> <span class='assign token'>=</span> <span class='singleton_controller? fid id'>singleton_controller?</span> <span class='integer val'>? </span><span class='member_name identifier id'>member_name</span> <span class='colon op'>:</span> <span class='member identifier id'>member</span>
  <span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='has_parent? fid id'>has_parent?</span> <span class='integer val'>? </span><span class='parents identifier id'>parents</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span> <span class='target identifier id'>target</span> <span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span> <span class='target identifier id'>target</span> <span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='comment val'># These are available by default (i.e. if all actions are available)</span>
<span class='comment val'># If you specify specific actions inside the block passed to #controlling</span>
<span class='comment val'># you need to pass the :flash option to the ResourceProxy#action like so:</span>
<span class='comment val'># action :update, :flash =&gt; true</span>

<span class='def def kw'>def</span> <span class='successful_update_messages identifier id'>successful_update_messages</span>
  <span class='lbrace token'>{</span> <span class='symbol val'>:notice</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{member.class.name} was successfully updated&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='failed_update_messages identifier id'>failed_update_messages</span>
  <span class='lbrace token'>{</span> <span class='symbol val'>:error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;Failed to update #{member.class.name}&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>

	<h3>Customize the destroy action</h3>


<code>
<pre class="code">
<span class='def def kw'>def</span> <span class='handle_successful_destroy identifier id'>handle_successful_destroy</span>
  <span class='handle_content_type identifier id'>handle_content_type</span><span class='lparen token'>(</span><span class='symbol val'>:destroy</span><span class='comma token'>,</span> <span class='content_type identifier id'>content_type</span><span class='comma token'>,</span> <span class='symbol val'>:success</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='handle_failed_destroy identifier id'>handle_failed_destroy</span>
  <span class='raise identifier id'>raise</span> <span class='Merb constant id'>Merb</span><span class='colon2 op'>::</span><span class='ControllerExceptions constant id'>ControllerExceptions</span><span class='colon2 op'>::</span><span class='InternalServerError constant id'>InternalServerError</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='html_response_on_successful_destroy identifier id'>html_response_on_successful_destroy</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='flash_messages_for? fid id'>flash_messages_for?</span><span class='lparen token'>(</span><span class='symbol val'>:destroy</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='lbrace token'>{</span> <span class='symbol val'>:message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='successful_destroy_messages identifier id'>successful_destroy_messages</span> <span class='rbrace token'>}</span> <span class='colon op'>:</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='redirect identifier id'>redirect</span> <span class='redirect_on_successful_destroy identifier id'>redirect_on_successful_destroy</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> 
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='xml_response_on_successful_destroy identifier id'>xml_response_on_successful_destroy</span>
  <span class='string val'>&quot;&quot;</span> <span class='comment val'># render no content, just 200 (OK) status.</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='json_response_on_successful_destroy identifier id'>json_response_on_successful_destroy</span>
  <span class='string val'>&quot;&quot;</span> <span class='comment val'># render no content, just 200 (OK) status.</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='redirect_on_successful_destroy identifier id'>redirect_on_successful_destroy</span>
  <span class='if if kw'>if</span> <span class='singleton_controller? fid id'>singleton_controller?</span>
    <span class='has_parent? fid id'>has_parent?</span> <span class='integer val'>? </span><span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='parent identifier id'>parent</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='string val'>'/'</span>
  <span class='else else kw'>else</span>
    <span class='resource identifier id'>resource</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='lparen token'>(</span><span class='has_parent? fid id'>has_parent?</span> <span class='integer val'>? </span><span class='parents identifier id'>parents</span> <span class='plus op'>+</span> <span class='lbrack token'>[</span> <span class='collection_name identifier id'>collection_name</span> <span class='rbrack token'>]</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span> <span class='collection_name identifier id'>collection_name</span> <span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>

<span class='comment val'># These are available by default (i.e. if all actions are available)</span>
<span class='comment val'># If you specify specific actions inside the block passed to #controlling</span>
<span class='comment val'># you need to pass the :flash option to the ResourceProxy#action like so:</span>
<span class='comment val'># action :destroy, :flash =&gt; true</span>

<span class='def def kw'>def</span> <span class='successful_destroy_messages identifier id'>successful_destroy_messages</span>
  <span class='lbrace token'>{</span> <span class='symbol val'>:notice</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{member.class.name} was successfully destroyed&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>

<span class='def def kw'>def</span> <span class='failed_destroy_messages identifier id'>failed_destroy_messages</span>
  <span class='lbrace token'>{</span> <span class='symbol val'>:error</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;Failed to destroy #{member.class.name}&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre>

	<h2>More Information</h2>


	<p>Have a look at <code>Merb::ResourceController::Actions</code>, <code>Merb::ResourceController::Mixin::InstanceMethods</code> and 
<code>Merb::ResourceController::Mixin::FlashSupport</code> inside <code>lib/merb_resource_controller/actions.rb</code> and 
<code>lib/merb_resource_controller/resource_controller.rb</code> to see what methods will be available inside your controllers.
If you want to see where the <em>real work gets done</em>, have a look at <code>lib/merb_resource_controller/resource_proxy.rb</code></p>


	<p>Of course, you should also have a look at the specs, to get a more concrete idea of how <code>merb_resource_controller</code>
behaves under the given circumstances.</p>


	<h2><span class="caps">TODO</span></h2>


	<ol>
	<li>Infer route nesting strategy from <code>Merb::Router</code></li>
		<li>Support for user stamps (aka created_by and updated_by)</li>
		<li>Support for pagination once an <em>official</em> merb pagination solution exists</li>
	</ol>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>