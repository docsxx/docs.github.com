<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>snusnu's dm-is-commentable - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/snusnu/commits/dm-is-commentable/master" rel="alternate" title="Recent Commits to dm-is-commentable:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("snusnu", "dm-is-commentable", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='snusnu/dm-is-commentable/blob/fbab44fd7fab4949e0fa7ed748659944bf4caf85' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='snusnu/dm-is-commentable/blob/fbab44fd7fab4949e0fa7ed748659944bf4caf85' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("snusnu", "dm-is-commentable", "fbab44fd7fab4949e0fa7ed748659944bf4caf85", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/snusnu/dm-is-commentable/tree/">Source</a></li>
            <li class=""><a href="http://github.com/snusnu/dm-is-commentable/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/snusnu/dm-is-commentable/network">Network</a></li>            
            <li class=""><a href="http://github.com/snusnu/dm-is-commentable/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/snusnu/dm-is-commentable">Wiki</a></li>
            <li class=""><a href="http://github.com/snusnu/dm-is-commentable/graphs">Graphs</a></li>                    
            <li class="active"><a href="/snusnu/dm-is-commentable">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/snusnu">snusnu</a> / <b><a href="http://github.com/snusnu/dm-is-commentable/tree">dm-is-commentable</a></b>        
                <a id="namespaces_button" rel="snusnu/dm-is-commentable/blob/fbab44fd7fab4949e0fa7ed748659944bf4caf85" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="snusnu/dm-is-commentable/blob/fbab44fd7fab4949e0fa7ed748659944bf4caf85" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h2>dm-is-commentable</h2>


	<p>A DataMapper plugin that adds the ability to comment any model. 
It also allows for easy rating of comments by using dm-is-rateable.
For a deeper understanding on how it does it&#8217;s thing, please consult 
the code itself, and of course the specs.</p>


<pre class="code">
<span class='comment val'># DEPENDENCIES (taken from dm-is-commentable.rb)</span>

<span class='comment val'># require 'dm-core'</span>
<span class='comment val'># require 'dm-types'</span>
<span class='comment val'># require 'dm-timestamps'</span>
<span class='comment val'># require 'dm-validations'</span>
<span class='comment val'># require 'dm-aggregates'</span>
<span class='comment val'># require 'dm-is-remixable'</span>
<span class='comment val'># require 'dm-is-rateable' # only for rateable commenting</span>

<span class='class class kw'>class</span> <span class='User constant id'>User</span>
  <span class='include identifier id'>include</span> <span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Resource constant id'>Resource</span>
  <span class='property identifier id'>property</span> <span class='symbol val'>:id</span><span class='comma token'>,</span> <span class='Serial constant id'>Serial</span>
<span class='end end kw'>end</span>

<span class='class class kw'>class</span> <span class='Trip constant id'>Trip</span>

  <span class='include identifier id'>include</span> <span class='DataMapper constant id'>DataMapper</span><span class='colon2 op'>::</span><span class='Resource constant id'>Resource</span>

  <span class='property identifier id'>property</span> <span class='symbol val'>:id</span><span class='comma token'>,</span> <span class='Serial constant id'>Serial</span>

  <span class='comment val'># Customization via properties</span>
  <span class='comment val'>#</span>
  <span class='comment val'># add these properties if you wish to be able to toggle some behaviour.</span>
  <span class='comment val'># dm-is-commentable will recognize these properties and behave accordingly</span>
  <span class='comment val'># you can use any combination of these properties, or all, or none of them</span>
  <span class='comment val'># Currently you MUST name these properties like this, but this will likely</span>
  <span class='comment val'># change in the near future.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># property :commenting_enabled,           Boolean #, :nullable =&gt; false, :default =&gt; true</span>
  <span class='comment val'># property :anonymous_commenting_enabled, Boolean #, :nullable =&gt; false, :default =&gt; true</span>
  <span class='comment val'># property :rateable_commenting_enabled,  Boolean #, :nullable =&gt; false, :default =&gt; true</span>

  <span class='comment val'># Customization via options:</span>
  <span class='comment val'>#</span>
  <span class='comment val'># options = {</span>
  <span class='comment val'>#   # Options for generated remixable</span>
  <span class='comment val'>#   # -------------------------------</span>
  <span class='comment val'>#   # Use :name and :type to name the fk property and give it a type</span>
  <span class='comment val'>#   # Pass all other options on to the 'property' call</span>
  <span class='comment val'>#   :commenter =&gt; { :name =&gt; :user_id, :type =&gt; Integer, :nullable =&gt; false }, </span>
  <span class='comment val'>#   # Use :type to change the type of the comment body property</span>
  <span class='comment val'>#   # Pass all other options on to the 'property' call</span>
  <span class='comment val'>#   :body      =&gt; { :type =&gt; DataMapper::Types::Text, :nullable =&gt; false },</span>
  <span class='comment val'>#   # Set this to true to make all comments rateable (but not togglable)</span>
  <span class='comment val'>#   # If 'property :rateable_commenting_enabled' is defined on this model,</span>
  <span class='comment val'>#   # it will take precedence over the option defined here.</span>
  <span class='comment val'>#   # Alternatively, you can also pass all options supported by dm-is-rateable</span>
  <span class='comment val'>#   :rateable  =&gt; false,</span>
  <span class='comment val'>#   # Options for remixer</span>
  <span class='comment val'>#   # -------------------</span>
  <span class='comment val'>#   # Set the specified alias (Symbol) on the 'comments' association</span>
  <span class='comment val'>#   :as         =&gt; nil,</span>
  <span class='comment val'>#   # class_name to use for the generated remixed model</span>
  <span class='comment val'>#   :class_name =&gt; &quot;#{self}Comment&quot; </span>
  <span class='comment val'># }.merge(options)</span>

  <span class='is identifier id'>is</span> <span class='symbol val'>:commentable</span> <span class='comment val'>#, options</span>

  <span class='comment val'># will define and thus be able to auto_migrate! by using dm-is-remixable:</span>
  <span class='comment val'>#</span>
  <span class='comment val'># class TripComment</span>
  <span class='comment val'>#   include DataMapper::Resource</span>
  <span class='comment val'>#   </span>
  <span class='comment val'>#   property :id, Serial</span>
  <span class='comment val'>#   </span>
  <span class='comment val'>#   property :trip_id, Integer, :nullable =&gt; false</span>
  <span class='comment val'>#   property :user_id, Integer, :nullable =&gt; false</span>
  <span class='comment val'>#   property :body,    Text,    :nullable =&gt; false</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   property :created_at, DateTime</span>
  <span class='comment val'>#   property :updated_at, DateTime</span>
  <span class='comment val'>#</span>
  <span class='comment val'>#   belongs_to :trip</span>
  <span class='comment val'>#   belongs_to :user</span>
  <span class='comment val'># end</span>

<span class='end end kw'>end</span>
</pre>

	<h3>dm-is-remixable</h3>


	<p>The actual reason why I chose <code>dm-is-remixable</code> (over some kind of polymorphic associations) 
is because I actually don’t like polymorphic relationships that much! Call me old fashioned 
but I like my tables with proper referential integrity all setup, and I don’t like 
to store the same 5 strings a million times. Maybe one could refactor <code>STI</code> to use a type_id column instead
of storing the same String over and over, maybe denormalization is fine here too, I don&#8217;t know.
Anyways, this wouldn&#8217;t change the actual problem with referential integrity.</p>


	<p>I also really don’t see any problem with the <em>“pure relational”</em> approach that <code>dm-is-remixable</code> follows. 
You don’t get to see all those boring join models in you <code>app/models</code> directory, still they get stored 
in the repository and everything behaves right.</p>


	<p>I don’t care wether this leads to a few more tables in my repository, because I normally 
don’t have to interact with them using <code>SQL</code>. Even if I was using <code>SQL</code>, 
the table layout would be perfectly clear and queries would be easy to write.</p>


	<p>I also cannot see too many negative impacts on query performance, since the only use case that would really benefit 
from one big table, is a query over some comments of <em><acronym title="or at least some">ALL</acronym></em> commentable types. 
Now this won’t happen very often! At least not in my system … I don’t show different types of comments on one page, 
even if I would, I would <em>“accept”</em> these few more queries.</p>


	<p>The pain I felt with those numerous join models that cluttered my <code>app/models</code> directory
instantly went away with <code>dm-is-remixable</code>. I think it’s a <strong>great plugin</strong> that greatly 
helps narrowing the gap between relational and oop styles!</p>


	<p>That said, a commenting plugin for <code>datamapper</code> that does its thing using <em>polymorphic relations</em> 
would definitely enrich the <em>datamapper ecosystem</em> and thus would be a good thing! People could choose for themselves! 
I’m quite sure though, that I’m not the one to provide it, because I don’t have a use case for it at the moment.</p>


	<h3>polymorphic associations</h3>


	<p>A possible use case where I think that using polymorphic associations in a commenting plugin would make more sense,
would be a commenting system, where an admin user should have the possibilty to turn <em><span class="caps">ANY</span></em> model into a <em>commentable</em>, 
I would go with the polymorphic associations approach here, for 2 reasons:</p>


	<p>1. I don’t like to give the user <code>CREATE/DROP</code> priviliges (necessary for auto_migrate!),
and I don’t like to generate tables dynamically in general.</p>


	<p>2. I wouldn’t want to <em>“prepare”</em> comment tables for every single instance, 
because then even I would have the feeling that there’s too many tables :-)</p>


	<p>Again, this is a usecase I can imagine, but I guess that’s a rather “uncommon” one. 
Nevertheless, a dm commenting plugin that would use polymorphic associations would easily scratch that itch!
Possibly, more pure relational approaches also exist to solve this kind of problem? Think about it if you need it!</p>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>