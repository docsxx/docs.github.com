<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>rkh's chainable - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/rkh/commits/chainable/master" rel="alternate" title="Recent Commits to chainable:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("rkh", "chainable", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='rkh/chainable/blob/517d8014ce3f3e0701fe9b724f7833e1f53caca0' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='rkh/chainable/blob/517d8014ce3f3e0701fe9b724f7833e1f53caca0' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("rkh", "chainable", "517d8014ce3f3e0701fe9b724f7833e1f53caca0", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/rkh/chainable/tree/">Source</a></li>
            <li class=""><a href="http://github.com/rkh/chainable/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/rkh/chainable/network">Network</a></li>            
            <li class=""><a href="http://github.com/rkh/chainable/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/rkh/chainable">Wiki</a></li>
            <li class=""><a href="http://github.com/rkh/chainable/graphs">Graphs</a></li>                    
            <li class="active"><a href="/rkh/chainable">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/rkh">rkh</a> / <b><a href="http://github.com/rkh/chainable/tree">chainable</a></b>        
                <a id="namespaces_button" rel="rkh/chainable/blob/517d8014ce3f3e0701fe9b724f7833e1f53caca0" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="rkh/chainable/blob/517d8014ce3f3e0701fe9b724f7833e1f53caca0" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <p>
<b>A word of warning:</b>
</p>
<p>
This is heavy ruby abuse. It even got the <b>Evil of the Day Award™</b>
from zenspider.
</p>
<p>
Forks are welcome!
</p>
<h2>Thou shalt not use alias_method_chain!</h2>
<ul>
<li>http://yehudakatz.com/2009/03/06/alias_method_chain-in-models

</li>
<li>http://yehudakatz.com/2009/01/18/other-ways-to-wrap-a-method

</li>
<li>http://www.codefluency.com/articles/2009/01/03/wrapping-a-method-in-ruby

</li>
</ul>
<h2>What it does</h2>
<h3>Chaining Methods</h3>
<p>
Chainable is an alternative to alias_method_chain, that uses inheritance,
rather than aliasing. It does the following when &quot;chaining&quot; a
method:
</p>
<ul>
<li>copy the original method to a new model

</li>
<li>include the model

</li>
<li>overwrite the method

</li>
</ul>
<p>
Thus you can use super and keep your method list clean, too! It even
supports a (rather dangerous) auto chaining mode, so you do not have to
explicitly chain a method, but chain a method whenever it would be
overwritten instead.
</p>
<p>
Example:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Foo constant id'>Foo</span>

    <span class='def def kw'>def</span> <span class='foo identifier id'>foo</span>
     <span class='integer val'>10</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># now chain to foo</span>
    <span class='chain_method identifier id'>chain_method</span> <span class='symbol val'>:foo</span> <span class='do do kw'>do</span>
      <span class='super super kw'>super</span> <span class='plus op'>+</span> <span class='integer val'>3</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># or turn on auto chaining</span>
    <span class='auto_chain identifier id'>auto_chain</span> <span class='do do kw'>do</span>

      <span class='def def kw'>def</span> <span class='bar identifier id'>bar</span>
        <span class='integer val'>10</span>
      <span class='end end kw'>end</span>

      <span class='def def kw'>def</span> <span class='bar identifier id'>bar</span>
        <span class='super super kw'>super</span> <span class='plus op'>+</span> <span class='integer val'>1</span>
      <span class='end end kw'>end</span>

      <span class='def def kw'>def</span> <span class='bar identifier id'>bar</span>
        <span class='super super kw'>super</span> <span class='pow op'>**</span> <span class='integer val'>2</span>
      <span class='end end kw'>end</span>

    <span class='end end kw'>end</span>

    <span class='comment val'># or chain multiple methods at once</span>
    <span class='chain_method identifier id'>chain_method</span> <span class='symbol val'>:foo</span><span class='comma token'>,</span> <span class='symbol val'>:bar</span> <span class='do do kw'>do</span>
      <span class='super super kw'>super</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>
    <span class='end end kw'>end</span>

  <span class='end end kw'>end</span>

  <span class='f identifier id'>f</span> <span class='assign token'>=</span> <span class='Foo constant id'>Foo</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='puts identifier id'>puts</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='foo identifier id'>foo</span> <span class='comment val'># =&gt; 13</span>
  <span class='puts identifier id'>puts</span> <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='bar identifier id'>bar</span> <span class='comment val'># =&gt; 121</span>
</pre>
<p>
Of course you can do this with any class (or module):
</p>
<pre class="code">
  <span class='Array constant id'>Array</span><span class='dot token'>.</span><span class='class_eval identifier id'>class_eval</span> <span class='do do kw'>do</span>
    <span class='chain_method identifier id'>chain_method</span> <span class='symbol val'>:each</span>
    <span class='def def kw'>def</span> <span class='each identifier id'>each</span>
      <span class='return return kw'>return</span> <span class='super super kw'>super</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span> <span class='or or kw'>or</span> <span class='RUBY_VERSION constant id'>RUBY_VERSION</span> <span class='geq op'>&gt;=</span> <span class='string val'>&quot;1.8.7&quot;</span>
      <span class='MyStuff constant id'>MyStuff</span><span class='colon2 op'>::</span><span class='Enumerator constant id'>Enumerator</span><span class='dot token'>.</span><span class='new identifier id'>new</span> <span class='self self kw'>self</span><span class='comma token'>,</span> <span class='symbol val'>:each</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Note that there is a speed advantage when using chain_method without a
block and doing a &quot;def&quot;, since chain_method will use
define_method if a block is given, which produces slower methods.
</p>
<h3>Merging Methods</h3>
<p>
But wait, there is more:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Foo constant id'>Foo</span>
    <span class='def def kw'>def</span> <span class='foo identifier id'>foo</span>
      <span class='integer val'>10</span>
    <span class='end end kw'>end</span>
    <span class='merge_method identifier id'>merge_method</span> <span class='symbol val'>:foo</span> <span class='do do kw'>do</span>
      <span class='super super kw'>super</span> <span class='mult op'>*</span> <span class='integer val'>3</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='puts identifier id'>puts</span> <span class='Ruby2Ruby constant id'>Ruby2Ruby</span><span class='dot token'>.</span><span class='translate identifier id'>translate</span> <span class='Foo constant id'>Foo</span><span class='comma token'>,</span> <span class='symbol val'>:foo</span>
</pre>
<p>
The output:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='foo identifier id'>foo</span>
    <span class='lparen token'>(</span><span class='integer val'>10</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='integer val'>3</span>
  <span class='end end kw'>end</span>
</pre>
<p>
<b>Before you yell at me about how insane I am, read on!</b>
</p>
<p>
The library will only allow merging, if it thinks, it is possible:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='Foo constant id'>Foo</span>
    <span class='def def kw'>def</span> <span class='foo identifier id'>foo</span>
      <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='integer val'>10</span>
    <span class='end end kw'>end</span>
    <span class='merge_method identifier id'>merge_method</span> <span class='symbol val'>:foo</span> <span class='do do kw'>do</span>
      <span class='x identifier id'>x</span> <span class='assign token'>=</span> <span class='integer val'>20</span>
      <span class='super super kw'>super</span>
      <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
Will give you:
</p>
<pre class="code">
   <span class='ArgumentError constant id'>ArgumentError</span><span class='colon op'>:</span> <span class='cannot identifier id'>cannot</span> <span class='merge identifier id'>merge</span> <span class='foo identifier id'>foo</span><span class='dot token'>.</span>
</pre>
<p>
Same goes for this one:
</p>
<pre class="code">
   <span class='class class kw'>class</span> <span class='Foo constant id'>Foo</span>
     <span class='def def kw'>def</span> <span class='foo identifier id'>foo</span> <span class='x identifier id'>x</span>
       <span class='puts identifier id'>puts</span> <span class='x identifier id'>x</span>
     <span class='end end kw'>end</span>
     <span class='merge_method identifier id'>merge_method</span> <span class='symbol val'>:foo</span> <span class='do do kw'>do</span>
       <span class='super super kw'>super</span>
     <span class='end end kw'>end</span>
   <span class='end end kw'>end</span>

   <span class='comment val'># =&gt; ArgumentError: cannot merge foo.</span>
</pre>
<p>
But where is the fun in that one? You probably don&#8217;t want your ruby
script throwing such errors at you.
</p>
<p>
Enter &quot;try_merge&quot;:
</p>
<pre class="code">
  <span class='SomeEvilClassWithoutHooks constant id'>SomeEvilClassWithoutHooks</span><span class='dot token'>.</span><span class='class_eval identifier id'>class_eval</span> <span class='do do kw'>do</span>
    <span class='chain_method identifier id'>chain_method</span> <span class='mult op'>*</span><span class='instance_methods identifier id'>instance_methods</span><span class='lparen token'>(</span><span class='false false kw'>false</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='symbol val'>:try_merge</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='do do kw'>do</span>
      <span class='old_value identifier id'>old_value</span> <span class='assign token'>=</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='value identifier id'>value</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
      <span class='super super kw'>super</span><span class='dot token'>.</span><span class='tap identifier id'>tap</span> <span class='lbrace token'>{</span> <span class='observer identifier id'>observer</span><span class='dot token'>.</span><span class='notify identifier id'>notify</span> <span class='if if_mod kw'>if</span> <span class='old_value identifier id'>old_value</span> <span class='neq op'>!=</span> <span class='value identifier id'>value</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
    <span class='attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:observer</span>
  <span class='end end kw'>end</span>

  <span class='some_evil_instance identifier id'>some_evil_instance</span><span class='dot token'>.</span><span class='observer identifier id'>observer</span> <span class='assign token'>=</span> <span class='MyObserver constant id'>MyObserver</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
</pre>
<h2>When to use it?</h2>
<p>
As with alias_method_chain, you should use this as seldom as possible.
Prefer clean inheritance over evil hacks. There actually is only one case
one may use chainable (or alias_method_chain, for that matter): If there is
a class you need to modify that is not part of your own code and the
instances you deal with may already exists when you modify the class. In
case you can modify the class before instance creation, just create another
class inheriting from the first one and overwrite new to return instances
of the latter.
</p>
<h2>Benchmark</h2>
<p>
chain_method tends do produce slightly faster methods than
alias_method_chain:
</p>
<pre class="code">
  $ <span class='rake identifier id'>rake</span> <span class='benchmark identifier id'>benchmark</span>
                                           <span class='user identifier id'>user</span>     <span class='system identifier id'>system</span>      <span class='total identifier id'>total</span>        <span class='real identifier id'>real</span>
  <span class='no identifier id'>no</span> <span class='wrappers identifier id'>wrappers</span>                          <span class='integer val'>0</span><span class='integer val'>.000000</span>   <span class='integer val'>0</span><span class='integer val'>.000000</span>   <span class='integer val'>0</span><span class='integer val'>.000000</span> <span class='lparen token'>(</span>  <span class='integer val'>0</span><span class='integer val'>.004887</span><span class='rparen token'>)</span>
  <span class='merge_method identifier id'>merge_method</span>                         <span class='integer val'>0</span><span class='integer val'>.000000</span>   <span class='integer val'>0</span><span class='integer val'>.000000</span>   <span class='integer val'>0</span><span class='integer val'>.000000</span> <span class='lparen token'>(</span>  <span class='integer val'>0</span><span class='integer val'>.004830</span><span class='rparen token'>)</span>
  <span class='chain_method identifier id'>chain_method</span> <span class='lparen token'>(</span><span class='def def kw'>def</span><span class='rparen token'>)</span>                   <span class='float val'>1.040000</span>   <span class='integer val'>0</span><span class='integer val'>.350000</span>   <span class='float val'>1.390000</span> <span class='lparen token'>(</span>  <span class='float val'>1.392329</span><span class='rparen token'>)</span>
  <span class='chain_method identifier id'>chain_method</span> <span class='lparen token'>(</span><span class='define_method identifier id'>define_method</span><span class='rparen token'>)</span>         <span class='float val'>1.150000</span>   <span class='integer val'>0</span><span class='integer val'>.240000</span>   <span class='float val'>1.390000</span> <span class='lparen token'>(</span>  <span class='float val'>1.396007</span><span class='rparen token'>)</span>
  <span class='alias_method_chain identifier id'>alias_method_chain</span> <span class='lparen token'>(</span><span class='def def kw'>def</span><span class='rparen token'>)</span>             <span class='float val'>1.210000</span>   <span class='integer val'>0</span><span class='integer val'>.260000</span>   <span class='float val'>1.470000</span> <span class='lparen token'>(</span>  <span class='float val'>1.472633</span><span class='rparen token'>)</span>
  <span class='alias_method_chain identifier id'>alias_method_chain</span> <span class='lparen token'>(</span><span class='define_method identifier id'>define_method</span><span class='rparen token'>)</span>   <span class='float val'>3.470000</span>   <span class='integer val'>0</span><span class='integer val'>.590000</span>   <span class='float val'>4.060000</span> <span class='lparen token'>(</span>  <span class='float val'>4.096245</span><span class='rparen token'>)</span>
</pre>
<h2>Installation</h2>
<p>
From RubyForge:
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='chainable identifier id'>chainable</span>
</pre>
<p>
From GitHub:
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='sources identifier id'>sources</span> <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
  gem install rkh-chainable
</span></pre>
<h2>Running test</h2>
<p>
The specs should work with rspec, mspec and bacon.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>