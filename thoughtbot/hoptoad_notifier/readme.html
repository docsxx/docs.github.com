<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <p>
HoptoadNotifier
</p>
<h6>=========</h6>
<p>
This is the notifier plugin for integrating apps with Hoptoad.
</p>
<p>
When an uncaught exception occurs, HoptoadNotifier will POST the relevant
data to the Hoptoad server specified in your environment.
</p>
<p>
INSTALLATION
</p>
<hr size="10"></hr><p>
REMOVE EXCEPTION_NOTIFIER
</p>
<p>
In your ApplicationController, REMOVE this line:
</p>
<pre class="code">
  <span class='include identifier id'>include</span> <span class='ExceptionNotifiable constant id'>ExceptionNotifiable</span>
</pre>
<p>
In your config/environment* files, remove all references to
ExceptionNotifier
</p>
<p>
Remove the vendor/plugins/exception_notifier directory.
</p>
<p>
INSTALL HOPTOAD_NOTIFIER
</p>
<p>
From your project&#8217;s RAILS_ROOT, run:
</p>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/</span><span class='thoughtbot identifier id'>thoughtbot</span><span class='div op'>/</span><span class='hoptoad_notifier identifier id'>hoptoad_notifier</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<p>
CONFIGURATION
</p>
<p>
You should have something like this in config/initializers/hoptoad.rb.
</p>
<pre class="code">
  <span class='HoptoadNotifier constant id'>HoptoadNotifier</span><span class='dot token'>.</span><span class='configure identifier id'>configure</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='config identifier id'>config</span><span class='bitor op'>|</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='api_key identifier id'>api_key</span> <span class='assign token'>=</span> <span class='string val'>'1234567890abcdef'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
(Please note that this configuration should be in a global configuration,
and is <b>not</b> environment-specific. Hoptoad is smart enough to know
what errors are caused by what environments, so your staging errors
don&#8217;t get mixed in with your production errors.)
</p>
<p>
That should be it! Now all exceptions will be logged to Hoptoad where they
can be aggregated, filtered, sorted, analyzed, massaged, and searched. In
previous releases you had to include HoptoadNotifier::Catcher into your
ApplicationController, but the plugin takes care of that now.
</p>
<p>
** NOTE FOR RAILS 1.2.* USERS: ** You will need to copy the
hoptoad_notifier_tasks.rake file into your RAILS_ROOT/lib/tasks directory
in order for the following to work:
</p>
<p>
You can test that hoptoad is working in your production environment by
using this rake task (from RAILS_ROOT):
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='hoptoad identifier id'>hoptoad</span><span class='symbol val'>:test</span>
</pre>
<p>
If everything is configured properly, that task will send a notice to
hoptoad which will be visible immediately.
</p>
<p>
USAGE
</p>
<p>
For the most part, hoptoad works for itself. Once you&#8217;ve included the
notifier in your ApplicationController (which is now done automatically by
the plugin), all errors will be rescued by the #rescue_action_in_public
provided by the plugin.
</p>
<p>
If you want to log arbitrary things which you&#8217;ve rescued yourself
from a controller, you can do something like this:
</p>
<pre class="code">
  <span class='dot3 op'>...</span>
  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ex identifier id'>ex</span>
    <span class='notify_hoptoad identifier id'>notify_hoptoad</span><span class='lparen token'>(</span><span class='ex identifier id'>ex</span><span class='rparen token'>)</span>
    <span class='flash identifier id'>flash</span><span class='lbrack token'>[</span><span class='symbol val'>:failure</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='string val'>'Encryptions could not be rerouted, try again.'</span>
  <span class='end end kw'>end</span>
  <span class='dot3 op'>...</span>
</pre>
<p>
The #notify_hoptoad call will send the notice over to hoptoad for later
analysis.
</p>
<p>
TRACKING DEPLOYMENTS IN HOPTOAD
</p>
<p>
Paying Hoptoad plans support the ability to track deployments of your
application in Hoptoad. By notify Hoptoad of your application deployments,
all errors are resolved when a deploy occurs, so that you&#8217;ll be
notified again about any errors that reoccur after a deployment.
</p>
<p>
Additionally, it&#8217;s possible to review the errors in Hoptoad that
occurred before and after a deploy.
</p>
<p>
When Hoptoad is installed as a plugin this functionality is loaded
automatically (if you have Capistrano version 2.0.0 or greater).
</p>
<p>
When Hoptoad installed as a gem, you need to add
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'hoptoad_notifier/recipes/hoptoad'</span>
</pre>
<p>
to your deploy.rb
</p>
<p>
GOING BEYOND EXCEPTIONS
</p>
<p>
You can also pass a hash to notify_hoptoad method and store whatever you
want, not just an exception. And you can also use it anywhere, not just in
controllers:
</p>
<pre class="code">
  <span class='begin begin kw'>begin</span>
    <span class='params identifier id'>params</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
      <span class='comment val'># params that you pass to a method that can throw an exception</span>
    <span class='rbrace token'>}</span>
    <span class='my_unpredicable_method identifier id'>my_unpredicable_method</span><span class='lparen token'>(</span><span class='params identifier id'>params</span><span class='rparen token'>)</span>
  <span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
    <span class='HoptoadNotifier constant id'>HoptoadNotifier</span><span class='dot token'>.</span><span class='notify identifier id'>notify</span><span class='lparen token'>(</span>
      <span class='symbol val'>:error_class</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Special Error&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:error_message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;Special Error: #{e.message}&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:request</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:params</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='params identifier id'>params</span> <span class='rbrace token'>}</span>
    <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<p>
While in your controllers you use the notify_hoptoad method, anywhere else
in your code, use HoptoadNotifier.notify. Hoptoad will get all the
information about the error itself. As for a hash, these are the keys you
should pass:
</p>
<pre class="code">
  <span class='mult op'>*</span> <span class='symbol val'>:error_class</span> </pre>
<p>
Hoptoad merges the hash you pass with these default options:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='default_notice_options identifier id'>default_notice_options</span>
    <span class='lbrace token'>{</span>
      <span class='symbol val'>:api_key</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='HoptoadNotifier constant id'>HoptoadNotifier</span><span class='dot token'>.</span><span class='api_key identifier id'>api_key</span><span class='comma token'>,</span>
      <span class='symbol val'>:error_message</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Notification'</span><span class='comma token'>,</span>
      <span class='symbol val'>:backtrace</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='caller identifier id'>caller</span><span class='comma token'>,</span>
      <span class='symbol val'>:request</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
      <span class='symbol val'>:session</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
      <span class='symbol val'>:environment</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='ENV constant id'>ENV</span><span class='dot token'>.</span><span class='to_hash identifier id'>to_hash</span>
    <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
You can override any of those parameters.
</p>
<p>
FILTERING
</p>
<p>
You can specify a whitelist of errors, that Hoptoad will not report on. Use
this feature when you are so apathetic to certain errors that you
don&#8217;t want them even logged.
</p>
<p>
This filter will only be applied to automatic notifications, not manual
notifications (when #notify is called directly).
</p>
<p>
Hoptoad ignores the following exceptions by default:
</p>
<pre class="code">
  <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='RecordNotFound constant id'>RecordNotFound</span>
  <span class='ActionController constant id'>ActionController</span><span class='colon2 op'>::</span><span class='RoutingError constant id'>RoutingError</span>
  <span class='ActionController constant id'>ActionController</span><span class='colon2 op'>::</span><span class='InvalidAuthenticityToken constant id'>InvalidAuthenticityToken</span>
  <span class='CGI constant id'>CGI</span><span class='colon2 op'>::</span><span class='Session constant id'>Session</span><span class='colon2 op'>::</span><span class='CookieStore constant id'>CookieStore</span><span class='colon2 op'>::</span><span class='TamperedWithCookie constant id'>TamperedWithCookie</span>
</pre>
<p>
To ignore errors in addition to those, specify their names in your Hoptoad
configuration block.
</p>
<pre class="code">
  <span class='HoptoadNotifier constant id'>HoptoadNotifier</span><span class='dot token'>.</span><span class='configure identifier id'>configure</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='config identifier id'>config</span><span class='bitor op'>|</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='api_key identifier id'>api_key</span>      <span class='assign token'>=</span> <span class='string val'>'1234567890abcdef'</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='ignore identifier id'>ignore</span>       <span class='lshft op'>&lt;&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='IgnoreThisError constant id'>IgnoreThisError</span>
  <span class='end end kw'>end</span>
</pre>
<p>
To ignore <b>only</b> certain errors (and override the defaults), use the
#ignore_only attribute.
</p>
<pre class="code">
  <span class='HoptoadNotifier constant id'>HoptoadNotifier</span><span class='dot token'>.</span><span class='configure identifier id'>configure</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='config identifier id'>config</span><span class='bitor op'>|</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='api_key identifier id'>api_key</span>      <span class='assign token'>=</span> <span class='string val'>'1234567890abcdef'</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='ignore_only identifier id'>ignore_only</span>  <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='IgnoreThisError constant id'>IgnoreThisError</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
</pre>
<p>
To ignore certain user agents, add in the #ignore_user_agent attribute as a
string or regexp:
</p>
<pre class="code">
  <span class='HoptoadNotifier constant id'>HoptoadNotifier</span><span class='dot token'>.</span><span class='configure identifier id'>configure</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='config identifier id'>config</span><span class='bitor op'>|</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='api_key identifier id'>api_key</span>      <span class='assign token'>=</span> <span class='string val'>'1234567890abcdef'</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='ignore_user_agent identifier id'>ignore_user_agent</span>  <span class='lshft op'>&lt;&lt;</span> <span class='regexp val'>/Ignored/</span>
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='ignore_user_agent identifier id'>ignore_user_agent</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>'IgnoredUserAgent'</span>
  <span class='end end kw'>end</span>
</pre>
<p>
TESTING
</p>
<p>
When you run your tests, you might notice that the hoptoad service is
recording notices generated using #notify when you don&#8217;t expect it
to. You can use code like this in your test_helper.rb to redefine that
method so those errors are not reported while running tests.
</p>
<pre class="code">
  <span class='module module kw'>module</span> <span class='HoptoadNotifier constant id'>HoptoadNotifier</span><span class='colon2 op'>::</span><span class='Catcher constant id'>Catcher</span>
    <span class='def def kw'>def</span> <span class='notify identifier id'>notify</span><span class='lparen token'>(</span><span class='thing identifier id'>thing</span><span class='rparen token'>)</span>
      <span class='comment val'># do nothing.</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
THANKS
</p>
<p>
Thanks to Eugene Bolshakov for the excellent write-up on GOING BEYOND
EXCEPTIONS, which we have included above.
</p>

      </div>
    </div>
  </body>
</html>