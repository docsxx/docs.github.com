<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>thoughtbot's paperclip - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/thoughtbot/commits/paperclip/master" rel="alternate" title="Recent Commits to paperclip:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("thoughtbot", "paperclip", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='thoughtbot/paperclip/blob/e430afe437dbae5e4e81cc9c1cacfa3b217ac909' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='thoughtbot/paperclip/blob/e430afe437dbae5e4e81cc9c1cacfa3b217ac909' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("thoughtbot", "paperclip", "e430afe437dbae5e4e81cc9c1cacfa3b217ac909", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/thoughtbot/paperclip/tree/">Source</a></li>
            <li class=""><a href="http://github.com/thoughtbot/paperclip/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/thoughtbot/paperclip/network">Network</a></li>            
            <li class=""><a href="http://github.com/thoughtbot/paperclip/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/thoughtbot/paperclip">Wiki</a></li>
            <li class=""><a href="http://github.com/thoughtbot/paperclip/graphs">Graphs</a></li>                    
            <li class="active"><a href="/thoughtbot/paperclip">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/thoughtbot">thoughtbot</a> / <b><a href="http://github.com/thoughtbot/paperclip/tree">paperclip</a></b>        
                <a id="namespaces_button" rel="thoughtbot/paperclip/blob/e430afe437dbae5e4e81cc9c1cacfa3b217ac909" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="thoughtbot/paperclip/blob/e430afe437dbae5e4e81cc9c1cacfa3b217ac909" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Paperclip</h1>
<p>
Paperclip is intended as an easy file attachment library for ActiveRecord.
The intent behind it was to keep setup as easy as possible and to treat
files as much like other attributes as possible. This means they
aren&#8217;t saved to their final locations on disk, nor are they deleted
if set to nil, until ActiveRecord::Base#save is called. It manages
validations based on size and presence, if required. It can transform its
assigned image into thumbnails if needed, and the prerequisites are as
simple as installing ImageMagick (which, for most modern Unix-based
systems, is as easy as installing the right packages). Attached files are
saved to the filesystem and referenced in the browser by an easily
understandable specification, which has sensible and useful defaults.
</p>
<p>
See the documentation for <tt>has_attached_file</tt> in
Paperclip::ClassMethods for more detailed options.
</p>
<h2>Quick Start</h2>
<p>
In your model:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='User constant id'>User</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='has_attached_file identifier id'>has_attached_file</span> <span class='symbol val'>:avatar</span><span class='comma token'>,</span> <span class='symbol val'>:styles</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:medium</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;300x300&gt;&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:thumb</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;100x100&gt;&quot;</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In your migrations:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='AddAvatarColumnsToUser constant id'>AddAvatarColumnsToUser</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Migration constant id'>Migration</span>
    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='up identifier id'>up</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_file_name</span><span class='comma token'>,</span>    <span class='symbol val'>:string</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_content_type</span><span class='comma token'>,</span> <span class='symbol val'>:string</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_file_size</span><span class='comma token'>,</span>    <span class='symbol val'>:integer</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_updated_at</span><span class='comma token'>,</span>   <span class='symbol val'>:datetime</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='down identifier id'>down</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_file_name</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_content_type</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_file_size</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:users</span><span class='comma token'>,</span> <span class='symbol val'>:avatar_updated_at</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In your edit and new views:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>% form_for </span><span class='symbol val'>:user</span><span class='comma token'>,</span> <span class='@user ivar id'>@user</span><span class='comma token'>,</span> <span class='symbol val'>:url</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='user_path identifier id'>user_path</span><span class='comma token'>,</span> <span class='symbol val'>:html</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:multipart</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='form identifier id'>form</span><span class='bitor op'>|</span> <span class='string val'>%&gt;
    &lt;%= form.file_field :avatar %&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>% end </span><span class='mod op'>%</span><span class='gt op'>&gt;</span>
</pre>
<p>
In your controller:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='create identifier id'>create</span>
    <span class='@user ivar id'>@user</span> <span class='assign token'>=</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:user</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
</pre>
<p>
In your show view:
</p>
<pre class="code">
  <span class='lt op'>&lt;</span><span class='string val'>%= image_tag @user.avatar.url %&gt;
  &lt;%=</span> <span class='image_tag identifier id'>image_tag</span> <span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='avatar identifier id'>avatar</span><span class='dot token'>.</span><span class='url identifier id'>url</span><span class='lparen token'>(</span><span class='symbol val'>:medium</span><span class='rparen token'>)</span> <span class='mod op'>%</span><span class='gt op'>&gt;</span>
  <span class='lt op'>&lt;</span><span class='string val'>%= image_tag @user.avatar.url(:thumb) %&gt;
</span></pre>
<h2>Usage</h2>
<p>
The basics of paperclip are quite simple: Declare that your model has an
attachment with the has_attached_file method, and give it a name. Paperclip
will wrap up up to four attributes (all prefixed with that
attachment&#8217;s name, so you can have multiple attachments per model if
you wish) and give the a friendly front end. The attributes are
&lt;attachment&gt;_file_name, &lt;attachment&gt;_file_size,
&lt;attachment&gt;_content_type, and &lt;attachment&gt;_updated_at. Only
&lt;attachment&gt;_file_name is required for paperclip to operate. More
information about the options to has_attached_file is available in the
documentation of Paperclip::ClassMethods.
</p>
<p>
Attachments can be validated with Paperclip&#8217;s validation methods,
validates_attachment_presence, validates_attachment_content_type, and
validates_attachment_size.
</p>
<h2>Storage</h2>
<p>
The files that are assigned as attachments are, by default, placed in the
directory specified by the :path option to has_attached_file. By default,
this location is
&quot;:rails_root/public/system/:attachment/:id/:style/:filename&quot;.
This location was chosen because on standard Capistrano deployments, the
public/system directory is symlinked to the app&#8217;s shared directory,
meaning it will survive between deployments. For example, using that :path,
you may have a file at
</p>
<pre class="code">
  <span class='regexp val'>/data/</span><span class='myapp identifier id'>myapp</span><span class='div op'>/</span><span class='releases identifier id'>releases</span><span class='div op'>/</span><span class='integer val'>20081229172410</span><span class='div op'>/</span><span class='public identifier id'>public</span><span class='div op'>/</span><span class='system identifier id'>system</span><span class='div op'>/</span><span class='avatars identifier id'>avatars</span><span class='div op'>/</span><span class='integer val'>13</span><span class='div op'>/</span><span class='small identifier id'>small</span><span class='div op'>/</span><span class='my_pic identifier id'>my_pic</span><span class='dot token'>.</span><span class='png identifier id'>png</span>
</pre>
<p>
NOTE: This is a change from previous versions of Paperclip, but is overall
a safer choice for the default file store.
</p>
<p>
You may also choose to store your files using Amazon&#8217;s S3 service.
You can find more information about S3 storage at the description for
Paperclip::Storage::S3.
</p>
<p>
Files on the local filesystem (and in the Rails app&#8217;s public
directory) will be available to the internet at large. If you require
access control, it&#8217;s possible to place your files in a different
location. You will need to change both the :path and :url options in order
to make sure the files are unavailable to the public. Both :path and :url
allow the same set of interpolated variables.
</p>
<h2>Post Processing</h2>
<p>
Paperclip supports an extensible selection of post-processors. When you
define a set of styles for an attachment, by default it is expected that
those &quot;styles&quot; are actually &quot;thumbnails&quot;. However, you
can do much more than just thumbnail images. By defining a subclass of
Paperclip::Processor, you can perform any processing you want on the files
that are attached. Any file in your Rails app&#8217;s
lib/paperclip_processors directory is automatically loaded by paperclip,
allowing you to easily define custom processors. You can specify a
processor with the :processors option to has_attached_file:
</p>
<pre class="code">
  <span class='has_attached_file identifier id'>has_attached_file</span> <span class='symbol val'>:scan</span><span class='comma token'>,</span> <span class='symbol val'>:styles</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:text</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:quality</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:better</span> <span class='rbrace token'>}</span> <span class='rbrace token'>}</span><span class='comma token'>,</span>
                           <span class='symbol val'>:processors</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:ocr</span><span class='rbrack token'>]</span>
</pre>
<p>
This would load the hypothetical class Paperclip::Ocr, which would have the
hash &quot;{ :quality =&gt; :better }&quot; passed to it along with the
uploaded file. For more information about defining processors, see
Paperclip::Processor.
</p>
<p>
The default processor is Paperclip::Thumbnail. For backwards compatability
reasons, you can pass a single geometry string or an array containing a
geometry and a format, which the file will be converted to, like so:
</p>
<pre class="code">
  <span class='has_attached_file identifier id'>has_attached_file</span> <span class='symbol val'>:avatar</span><span class='comma token'>,</span> <span class='symbol val'>:styles</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:thumb</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='string val'>&quot;32x32#&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:png</span><span class='rbrack token'>]</span> <span class='rbrace token'>}</span>
</pre>
<p>
This will convert the &quot;thumb&quot; style to a 32x32 square in png
format, regardless of what was uploaded. If the format is not specified, it
is kept the same (i.e. jpgs will remain jpgs).
</p>
<p>
Multiple processors can be specified, and they will be invoked in the order
they are defined in the :processors array. Each successive processor will
be given the result of the previous processor&#8217;s execution. All
processors will receive the same parameters, which are what you define in
the :styles hash. For example, assuming we had this definition:
</p>
<pre class="code">
  <span class='has_attached_file identifier id'>has_attached_file</span> <span class='symbol val'>:scan</span><span class='comma token'>,</span> <span class='symbol val'>:styles</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:text</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:quality</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:better</span> <span class='rbrace token'>}</span> <span class='rbrace token'>}</span><span class='comma token'>,</span>
                           <span class='symbol val'>:processors</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='symbol val'>:rotator</span><span class='comma token'>,</span> <span class='symbol val'>:ocr</span><span class='rbrack token'>]</span>
</pre>
<p>
then both the :rotator processor and the :ocr processor would receive the
options &quot;{ :quality =&gt; :better }&quot;. This parameter may not mean
anything to one or more or the processors, and they are expected to ignore
it.
</p>
<p>
NOTE: Because processors operate by turning the original attachment into
the styles, no processors will be run if there are no styles defined.
</p>
<h2>Events</h2>
<p>
Before and after the Post Processing step, Paperclip calls back to the
model with a few callbacks, allowing the model to change or cancel the
processing step. The callbacks are &quot;before_post_process&quot; and
&quot;after_post_process&quot; (which are called before and after the
processing of each attachment), and the attachment-specific
&quot;before_&lt;attachment&gt;_post_process&quot; and
&quot;after_&lt;attachment&gt;_post_process&quot;. The callbacks are
intended to be as close to normal ActiveRecord callbacks as possible, so if
you return false (specifically
</p>
<ul>
<li>returning nil is not the same) in a before_ filter, the post processing
step

</li>
</ul>
<p>
will halt. Returning false in an after_ filter will not halt anything, but
you can access the model and the attachment if necessary.
</p>
<p>
NOTE: Post processing will not even <b>start</b> if the attachment is not
valid according to the validations. Your callbacks and processors will
<b>only</b> be called with valid attachments.
</p>
<h2>Contributing</h2>
<p>
If you&#8217;d like to contribute a feature or bugfix: Thanks! To make sure
your fix/feature has a high chance of being included, please read the
following guidelines:
</p>
<ol>
<li>Ask on the mailing list, or post a new GitHub Issue.

</li>
<li>Make sure there are tests! We will not accept any patch that is not tested.
It&#8217;s a rare time when explicit tests aren&#8217;t needed. If you have
questions about writing tests for paperclip, please ask the mailing list.

</li>
</ol>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>