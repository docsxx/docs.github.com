<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="syntax_highlight.css" type="text/css" charset="utf-8" />

    <title>README</title>
  </head>
  <body>
    <div id="content">
      <div class="section docstring readme">
        <h1>factory_girl</h1>
<p>
factory_girl is a fixtures replacement with a straightforward definition
syntax, support for multiple build strategies (saved instances, unsaved
instances, attribute hashes, and stubbed objects), and support for multiple
factories for the same class (user, admin_user, and so on), including
factory inheritence.
</p>
<h2>Download</h2>
<p>
Github: http://github.com/thoughtbot/factory_girl/tree/master
</p>
<p>
Gem:
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='thoughtbot identifier id'>thoughtbot</span><span class='minus op'>-</span><span class='factory_girl identifier id'>factory_girl</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='source identifier id'>source</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
</span></pre>
<p>
Note: if you install factory_girl using the gem from Github, you&#8217;ll
need this in your environment.rb if you want to use Rails 2.1+&#8217;s
dependency manager:
</p>
<pre class="code">
  <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>&quot;thoughtbot-factory_girl&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:lib</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;factory_girl&quot;</span><span class='comma token'>,</span>
             <span class='symbol val'>:source</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;http://gems.github.com&quot;</span>
</pre>
<h2>Defining factories</h2>
<p>
Each factory has a name and a set of attributes. The name is used to guess
the class of the object by default, but it&#8217;s possible to excplicitly
specify it:
</p>
<pre class="code">
  <span class='comment val'># This will guess the User class</span>
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:user</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='u identifier id'>u</span><span class='bitor op'>|</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span> <span class='string val'>'John'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='last_name identifier id'>last_name</span>  <span class='string val'>'Doe'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='admin identifier id'>admin</span> <span class='false false kw'>false</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># This will use the User class (Admin would have been guessed)</span>
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:admin</span><span class='comma token'>,</span> <span class='symbol val'>:class</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='User constant id'>User</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='u identifier id'>u</span><span class='bitor op'>|</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span> <span class='string val'>'Admin'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='last_name identifier id'>last_name</span>  <span class='string val'>'User'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='admin identifier id'>admin</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># The same, but using a string instead of class constant</span>
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:admin</span><span class='comma token'>,</span> <span class='symbol val'>:class</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'user'</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='u identifier id'>u</span><span class='bitor op'>|</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span> <span class='string val'>'Admin'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='last_name identifier id'>last_name</span>  <span class='string val'>'User'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='admin identifier id'>admin</span> <span class='true true kw'>true</span>
  <span class='end end kw'>end</span>
</pre>
<p>
It is highly recommended that you have one factory for each class that
provides the simplest set of attributes necessary to create an instance of
that class. If you&#8217;re creating ActiveRecord objects, that means that
you should only provide attributes that are required through validations
and that do not have defaults. Other factories can be created through
inheritence to cover common scenarios for each class.
</p>
<p>
Factories can either be defined anywhere, but will automatically be loaded
if they are defined in files at the following locations:
</p>
<pre class="code">
  <span class='test identifier id'>test</span><span class='div op'>/</span><span class='factories identifier id'>factories</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
  <span class='spec identifier id'>spec</span><span class='div op'>/</span><span class='factories identifier id'>factories</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
  <span class='test identifier id'>test</span><span class='div op'>/</span><span class='factories identifier id'>factories</span><span class='div op'>/</span><span class='mult op'>*</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
  <span class='spec identifier id'>spec</span><span class='div op'>/</span><span class='factories identifier id'>factories</span><span class='div op'>/</span><span class='mult op'>*</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<h2>Using factories</h2>
<p>
factory_girl supports several different build strategies: build, create,
attributes_for and stub:
</p>
<pre class="code">
  <span class='comment val'># Returns a User instance that's not saved</span>
  <span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='build identifier id'>build</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='rparen token'>)</span>

  <span class='comment val'># Returns a saved User instance</span>
  <span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='rparen token'>)</span>

  <span class='comment val'># Returns a hash of attributes that can be used to build a User instance:</span>
  <span class='attrs identifier id'>attrs</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='attributes_for identifier id'>attributes_for</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='rparen token'>)</span>

  <span class='comment val'># Returns an object with all defined attributes stubbed out:</span>
  <span class='stub identifier id'>stub</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='stub identifier id'>stub</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='rparen token'>)</span>
</pre>
<p>
You can use the Factory method as a shortcut for the default build
strategy:
</p>
<pre class="code">
  <span class='comment val'># Same as Factory.create :user:</span>
  <span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='rparen token'>)</span>
</pre>
<p>
The default strategy can be overriden:
</p>
<pre class="code">
  <span class='comment val'># Now same as Factory.build(:user)</span>
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:user</span><span class='comma token'>,</span> <span class='symbol val'>:default_strategy</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:build</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='u identifier id'>u</span><span class='bitor op'>|</span>
    <span class='dot3 op'>...</span>
  <span class='end end kw'>end</span>

  <span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='rparen token'>)</span>
</pre>
<p>
No matter which startegy is used, it&#8217;s possible to override the
defined attributes by passing a hash:
</p>
<pre class="code">
  <span class='comment val'># Build a User instance and override the first_name property</span>
  <span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='build identifier id'>build</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='comma token'>,</span> <span class='symbol val'>:first_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Joe'</span><span class='rparen token'>)</span>
  <span class='user identifier id'>user</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span>
  <span class='comment val'># =&gt; &quot;Joe&quot;</span>
</pre>
<h2>Lazy Attributes</h2>
<p>
Most factory attributes can be added using static values that are evaluated
when the factory is defined, but some attributes (such as associations and
other attributes that must be dynamically generated) will need values
assigned each time an instance is generated. These &quot;lazy&quot;
attributes can be added by passing a block instead of a parameter:
</p>
<pre class="code">
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:user</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='u identifier id'>u</span><span class='bitor op'>|</span>
    <span class='comment val'># ...</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='activation_code identifier id'>activation_code</span> <span class='lbrace token'>{</span> <span class='User constant id'>User</span><span class='dot token'>.</span><span class='generate_activation_code identifier id'>generate_activation_code</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Dependent Attributes</h2>
<p>
Attributes can be based on the values of other attributes using the proxy
that is yieled to lazy attribute blocks:
</p>
<pre class="code">
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:user</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='u identifier id'>u</span><span class='bitor op'>|</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span> <span class='string val'>'Joe'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='last_name identifier id'>last_name</span>  <span class='string val'>'Blow'</span>
    <span class='u identifier id'>u</span><span class='dot token'>.</span><span class='email identifier id'>email</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;#{a.first_name}.#{a.last_name}@example.com&quot;</span><span class='dot token'>.</span><span class='downcase identifier id'>downcase</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='Factory constant id'>Factory</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='comma token'>,</span> <span class='symbol val'>:last_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Doe'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='email identifier id'>email</span>
  <span class='comment val'># =&gt; &quot;joe.doe@example.com&quot;</span>
</pre>
<h2>Associations</h2>
<p>
Associated instances can be generated by using the association method when
defining a lazy attribute:
</p>
<pre class="code">
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:post</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span>
    <span class='comment val'># ...</span>
    <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='author identifier id'>author</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='author identifier id'>author</span><span class='bitor op'>|</span> <span class='author identifier id'>author</span><span class='dot token'>.</span><span class='association identifier id'>association</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='comma token'>,</span> <span class='symbol val'>:last_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'Writely'</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
The behavior of the association method varies depending on the build
strategy used for the parent object.
</p>
<pre class="code">
  <span class='comment val'># Builds and saves a User and a Post</span>
  <span class='post identifier id'>post</span> <span class='assign token'>=</span> <span class='Factory constant id'>Factory</span><span class='lparen token'>(</span><span class='symbol val'>:post</span><span class='rparen token'>)</span>
  <span class='post identifier id'>post</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span>       <span class='comment val'># =&gt; false</span>
  <span class='post identifier id'>post</span><span class='dot token'>.</span><span class='author identifier id'>author</span><span class='dot token'>.</span><span class='new_record identifier id'>new_record</span> <span class='comment val'># =&gt; false</span>

  <span class='comment val'># Builds and saves a User, and then builds but does not save a Post</span>
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='build identifier id'>build</span><span class='lparen token'>(</span><span class='symbol val'>:post</span><span class='rparen token'>)</span>
  <span class='post identifier id'>post</span><span class='dot token'>.</span><span class='new_record? fid id'>new_record?</span>       <span class='comment val'># =&gt; true</span>
  <span class='post identifier id'>post</span><span class='dot token'>.</span><span class='author identifier id'>author</span><span class='dot token'>.</span><span class='new_record identifier id'>new_record</span> <span class='comment val'># =&gt; false</span>
</pre>
<p>
Because this pattern is so common, a prettier syntax is available for
defining associations:
</p>
<pre class="code">
  <span class='comment val'># The following definitions are equivilent:</span>
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:post</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span>
    <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='author identifier id'>author</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='association identifier id'>association</span><span class='lparen token'>(</span><span class='symbol val'>:user</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:post</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span>
    <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='association identifier id'>association</span> <span class='symbol val'>:author</span><span class='comma token'>,</span> <span class='symbol val'>:factory</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:user</span>
  <span class='end end kw'>end</span>
</pre>
<p>
If the factory name is the same as the association name, the factory name
can be left out.
</p>
<h2>Inheritance</h2>
<p>
You can easily create multiple factories for the same class without
repeating common attributes by using inheritence:
</p>
<pre class="code">
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:post</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span>
    <span class='comment val'># the 'title' attribute is required for all posts</span>
    <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='title identifier id'>title</span> <span class='string val'>'A title'</span>
  <span class='end end kw'>end</span>

  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:approved_post</span><span class='comma token'>,</span> <span class='symbol val'>:parent</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:post</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='p identifier id'>p</span><span class='bitor op'>|</span>
    <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='approved identifier id'>approved</span> <span class='true true kw'>true</span>
    <span class='comment val'># the 'approver' association is required for an approved post</span>
    <span class='p identifier id'>p</span><span class='dot token'>.</span><span class='association identifier id'>association</span> <span class='symbol val'>:approver</span><span class='comma token'>,</span> <span class='symbol val'>:factory</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:user</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Sequences</h2>
<p>
Unique values in a specific format (for example, e-mail addresses) can be
generated using sequences. Sequences are defined by calling
Factory.sequence, and values in a sequence are generated by calling
Factory.next:
</p>
<pre class="code">
  <span class='comment val'># Defines a new sequence</span>
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='sequence identifier id'>sequence</span> <span class='symbol val'>:email</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='n identifier id'>n</span><span class='bitor op'>|</span>
    <span class='dstring node'>&quot;person#{n}@example.com&quot;</span>
  <span class='end end kw'>end</span>

  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='next identifier id'>next</span> <span class='symbol val'>:email</span>
  <span class='comment val'># =&gt; &quot;person1@example.com&quot;</span>

  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='next identifier id'>next</span> <span class='symbol val'>:email</span>
  <span class='comment val'># =&gt; &quot;person2@example.com&quot;</span>
</pre>
<p>
Sequences can be used in lazy attributes:
</p>
<pre class="code">
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:user</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='email identifier id'>email</span> <span class='lbrace token'>{</span> <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='next identifier id'>next</span><span class='lparen token'>(</span><span class='symbol val'>:email</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<p>
And it&#8217;s also possible to define an in-line sequence that is only
used in a particular factory:
</p>
<pre class="code">
  <span class='Factory constant id'>Factory</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='symbol val'>:user</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span>
    <span class='f identifier id'>f</span><span class='dot token'>.</span><span class='sequence identifier id'>sequence</span><span class='lparen token'>(</span><span class='symbol val'>:email</span><span class='rparen token'>)</span> <span class='lbrace token'>{</span><span class='bitor op'>|</span><span class='n identifier id'>n</span><span class='bitor op'>|</span> <span class='dstring node'>&quot;person#{n}@example.com&quot;</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
</pre>
<h2>Alternate Syntaxes</h2>
<p>
Users&#8217; tastes for syntax vary dramatically, but most users are
looking for a common feature set. Because of this, factory_girl supports
&quot;syntax layers&quot; which provide alternate interfaces. See
Factory::Syntax for information about the various layers available.
</p>
<h2>More Information</h2>
<p>
Our blog: http://giantrobots.thoughtbot.com
</p>
<p>
factory_girl rdoc: http://dev.thoughtbot.com/factory_girl
</p>
<p>
Mailing list: http://groups.google.com/group/factory_girl
</p>
<p>
factory_girl tickets:
http://thoughtbot.lighthouseapp.com/projects/14354-factory_girl
</p>
<h2>Contributing</h2>
<p>
Please read the contribution guidelines before submitting patches or pull
requests.
</p>
<h2>Author</h2>
<p>
factory_girl was written by Joe Ferris with contributions from several
authors, including:
</p>
<ul>
<li>Alex Sharp

</li>
<li>Eugene Bolshakov

</li>
<li>Jon Yurek

</li>
<li>Josh Nichols

</li>
<li>Josh Owens

</li>
</ul>
<p>
The syntax layers are derived from software written by the following
authors:
</p>
<ul>
<li>Pete Yandell

</li>
<li>Rick Bradley

</li>
<li>Yossef Mendelssohn

</li>
</ul>
<p>
Thanks to all members of thoughtbot for inspiration, ideas, and funding.
</p>
<p>
Copyright 2008-2009 Joe Ferris and thoughtbot[http://www.thoughtbot.com],
inc.
</p>

      </div>
    </div>
  </body>
</html>