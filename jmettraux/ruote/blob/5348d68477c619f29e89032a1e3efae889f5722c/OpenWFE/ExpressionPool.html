<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jmettraux's ruote - Class: OpenWFE::ExpressionPool - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jmettraux/commits/ruote/master" rel="alternate" title="Recent Commits to ruote:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jmettraux", "ruote", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jmettraux", "ruote", "5348d68477c619f29e89032a1e3efae889f5722c", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jmettraux/ruote/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jmettraux/ruote/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jmettraux/ruote/network">Network</a></li>            
            <li class=""><a href="http://github.com/jmettraux/ruote/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jmettraux/ruote">Wiki</a></li>
            <li class=""><a href="http://github.com/jmettraux/ruote/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jmettraux/ruote">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jmettraux">jmettraux</a> / <b><a href="http://github.com/jmettraux/ruote/tree">ruote</a></b>        
                <a id="namespaces_button" rel="jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class OpenWFE_ExpressionPool">
  <h1>Class: OpenWFE::ExpressionPool</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p><a title="OpenWFE::ServiceMixin" href="ExpressionPool/ServiceMixin.html">OpenWFE::ServiceMixin</a>, <a title="OpenWFE::OwfeServiceLocator" href="ExpressionPool/OwfeServiceLocator.html">OpenWFE::OwfeServiceLocator</a>, <a title="OpenWFE::OwfeObservable" href="ExpressionPool/OwfeObservable.html">OpenWFE::OwfeObservable</a>, <a title="OpenWFE::FeiMixin" href="ExpressionPool/FeiMixin.html">OpenWFE::FeiMixin</a>, <a title="OpenWFE::ExpoolPauseMethods" href="ExpressionPool/ExpoolPauseMethods.html">OpenWFE::ExpoolPauseMethods</a></p>
</div><div class="section docstring">
  <p>
The ExpressionPool stores expressions (pieces of workflow instance).
It&#8217;s the core of the workflow engine. It relies on an expression
storage for actual persistence of the expressions.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">paused_instances</td>
          <td class="readwrite">
            [<span id='paused_instances-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The hash containing the wfid of the process instances currently paused (a
cache).
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(service_name, application_context)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
The constructor for the expression pool.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 64</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L64">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">64
65
66
67
68
69
70
71
72
73
74
75
76
77
78</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='lparen token'>(</span><span class='service_name identifier id'>service_name</span><span class='comma token'>,</span> <span class='application_context identifier id'>application_context</span><span class='rparen token'>)</span>

  <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='rparen token'>)</span>

  <span class='service_init identifier id'>service_init</span> <span class='service_name identifier id'>service_name</span><span class='comma token'>,</span> <span class='application_context identifier id'>application_context</span>

  <span class='@paused_instances ivar id'>@paused_instances</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='@observers ivar id'>@observers</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>

  <span class='@stopped ivar id'>@stopped</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>

  <span class='engine_environment_id identifier id'>engine_environment_id</span>
    <span class='comment val'># makes sure it's called now</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#apply-instance_method">#apply</span><span class='args'>(exp_or_fei, workitem)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Applies a given expression (id or expression).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_raw_expression-instance_method">#build_raw_expression</span><span class='args'>(param, launchitem = nil)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Builds the RawExpression instance at the root of the flow being launched.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cancel-instance_method">#cancel</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Cancels the given expression.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cancel_expression-instance_method">#cancel_expression</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Cancels the given expression and makes sure to resume the flow if the
expression or one of its children were active.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#cancel_process-instance_method">#cancel_process</span><span class='args'>(exp_or_wfid)</span>
        <span class='block'></span>
        
          <span class='alias'>#cancel_flow</span>
        
      </th>
      <td class="docstring">
        <p>
Given any expression of a process, cancels the complete process instance.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#engine_environment_id-instance_method">#engine_environment_id</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the unique engine_environment FlowExpressionId instance.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch-instance_method">#fetch</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches a FlowExpression from the pool.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch_engine_environment-instance_method">#fetch_engine_environment</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns the engine environment (the top level environment).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch_expression-instance_method">#fetch_expression</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches a FlowExpression (returns only the FlowExpression instance).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#fetch_root-instance_method">#fetch_root</span><span class='args'>(wfid)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Fetches the root expression of a process (or a subprocess).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#forget-instance_method">#forget</span><span class='args'>(parent_exp, exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Forgets the given expression (make it an orphan).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#handle_error-instance_method">#handle_error</span><span class='args'>(error, fei, message, workitem)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is called when apply() or reply() failed for an expression.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#is_paused-3F-instance_method">#is_paused?</span><span class='args'>(expression)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Returns true if the process instance to which the expression belongs is
currently paused.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#launch-instance_method">#launch</span><span class='args'>(raw_exp, workitem)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Launches a new process instance.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#launch_subprocess-instance_method">#launch_subprocess</span><span class='args'>(firing_exp, template, forget, workitem, initial_variables)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Launches a subprocess.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reapply-instance_method">#reapply</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Re-applies a given expression.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#remove-instance_method">#remove</span><span class='args'>(exp)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Removes a flow expression from the pool (This method is mainly called from
the pool itself).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reply-instance_method">#reply</span><span class='args'>(exp_or_fei, workitem)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Replies to a given expression.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reply_to_parent-instance_method">#reply_to_parent</span><span class='args'>(exp, workitem, remove = true)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Replies to the parent of the given expression.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reschedule-instance_method">#reschedule</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is called at each expool (engine) [re]start.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stop-instance_method">#stop</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Stops this expression pool (especially its workqueue).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#substitute_and_apply-instance_method">#substitute_and_apply</span><span class='args'>(fexp, template, workitem)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Replaces the flow expression with a raw expression that has the same fei,
same parent and points to the same env.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#tlaunch_child-instance_method">#tlaunch_child</span><span class='args'>(parent_exp, template, sub_id, workitem, opts = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Launches the given template (sexp) as the child of its parent expression.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#tprepare_child-instance_method">#tprepare_child</span><span class='args'>(parent_exp, template, sub_id, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This is the first stage of the tlaunch_child() method.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#update-instance_method">#update</span><span class='args'>(flow_expression)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds or updates a flow expression in this pool.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#wait_for-instance_method">#wait_for</span><span class='args'>(fei_or_wfid)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
If the launch option :wait_for is set to true, this method will be called
to apply the raw_expression.
</p>

        
      </td>
    </tr>
  
</table><div class="included">
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::ServiceMixin" href="ExpressionPool/ServiceMixin.html">OpenWFE::ServiceMixin</a></h2>
    <p><span class='name'><a title="service_init" href="ServiceMixin.html#service_init-instance_method">service_init</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::OwfeServiceLocator" href="ExpressionPool/OwfeServiceLocator.html">OpenWFE::OwfeServiceLocator</a></h2>
    <p><span class='name'><a title="get_def_parser" href="OwfeServiceLocator.html#get_def_parser-instance_method">get_def_parser</a></span>, <span class='name'><a title="get_engine" href="OwfeServiceLocator.html#get_engine-instance_method">get_engine</a></span>, <span class='name'><a title="get_error_journal" href="OwfeServiceLocator.html#get_error_journal-instance_method">get_error_journal</a></span>, <span class='name'><a title="get_expool" href="OwfeServiceLocator.html#get_expool-instance_method">get_expool</a></span>, <span class='name'><a title="get_expression_map" href="OwfeServiceLocator.html#get_expression_map-instance_method">get_expression_map</a></span>, <span class='name'><a title="get_expression_pool" href="OwfeServiceLocator.html#get_expression_pool-instance_method">get_expression_pool</a></span>, <span class='name'><a title="get_expression_storage" href="OwfeServiceLocator.html#get_expression_storage-instance_method">get_expression_storage</a></span>, <span class='name'><a title="get_expression_storages" href="OwfeServiceLocator.html#get_expression_storages-instance_method">get_expression_storages</a></span>, <span class='name'><a title="get_journal" href="OwfeServiceLocator.html#get_journal-instance_method">get_journal</a></span>, <span class='name'><a title="get_participant_map" href="OwfeServiceLocator.html#get_participant_map-instance_method">get_participant_map</a></span>, <span class='name'><a title="get_scheduler" href="OwfeServiceLocator.html#get_scheduler-instance_method">get_scheduler</a></span>, <span class='name'><a title="get_tree_checker" href="OwfeServiceLocator.html#get_tree_checker-instance_method">get_tree_checker</a></span>, <span class='name'><a title="get_wfid_generator" href="OwfeServiceLocator.html#get_wfid_generator-instance_method">get_wfid_generator</a></span>, <span class='name'><a title="get_workqueue" href="OwfeServiceLocator.html#get_workqueue-instance_method">get_workqueue</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::OwfeObservable" href="ExpressionPool/OwfeObservable.html">OpenWFE::OwfeObservable</a></h2>
    <p><span class='name'><a title="add_observer" href="OwfeObservable.html#add_observer-instance_method">add_observer</a></span>, <span class='name'><a title="remove_observer" href="OwfeObservable.html#remove_observer-instance_method">remove_observer</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::ExpoolPauseMethods" href="ExpressionPool/ExpoolPauseMethods.html">OpenWFE::ExpoolPauseMethods</a></h2>
    <p><span class='name'><a title="pause_process" href="ExpoolPauseMethods.html#pause_process-instance_method">pause_process</a></span>, <span class='name'><a title="resume_process" href="ExpoolPauseMethods.html#resume_process-instance_method">resume_process</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>apply</h3>
</div><div id="apply-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>apply</span><span class='args'>(exp_or_fei, workitem)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Applies a given expression (id or expression)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 209</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L209">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">209
210
211
212
213</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='apply identifier id'>apply</span> <span class='lparen token'>(</span><span class='exp_or_fei identifier id'>exp_or_fei</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='get_workqueue identifier id'>get_workqueue</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span>
    <span class='self self kw'>self</span><span class='comma token'>,</span> <span class='symbol val'>:do_apply_reply</span><span class='comma token'>,</span> <span class='symbol val'>:apply</span><span class='comma token'>,</span> <span class='exp_or_fei identifier id'>exp_or_fei</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_raw_expression</h3>
</div><div id="build_raw_expression-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_raw_expression</span><span class='args'>(param, launchitem = nil)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds the RawExpression instance at the root of the flow being launched.
</p>
<p>
The param can be a template or a definition (or a URI).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 558</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L558">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='build_raw_expression identifier id'>build_raw_expression</span> <span class='lparen token'>(</span><span class='param identifier id'>param</span><span class='comma token'>,</span> <span class='launchitem identifier id'>launchitem</span><span class='assign token'>=</span><span class='nil nil kw'>nil</span><span class='rparen token'>)</span>

  <span class='procdef identifier id'>procdef</span> <span class='assign token'>=</span> <span class='get_def_parser identifier id'>get_def_parser</span><span class='dot token'>.</span><span class='determine_rep identifier id'>determine_rep</span><span class='lparen token'>(</span><span class='param identifier id'>param</span><span class='rparen token'>)</span>

  <span class='comment val'># procdef is a nested [ name, attributes, children ] structure now</span>

  <span class='atts identifier id'>atts</span> <span class='assign token'>=</span> <span class='procdef identifier id'>procdef</span><span class='lbrack token'>[</span><span class='integer val'>1</span><span class='rbrack token'>]</span>

  <span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:workflow_instance_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>
      <span class='get_wfid_generator identifier id'>get_wfid_generator</span><span class='dot token'>.</span><span class='generate identifier id'>generate</span><span class='lparen token'>(</span><span class='launchitem identifier id'>launchitem</span><span class='rparen token'>)</span><span class='comma token'>,</span>
    <span class='symbol val'>:workflow_definition_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>
      <span class='atts identifier id'>atts</span><span class='lbrack token'>[</span><span class='string val'>'name'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='procdef identifier id'>procdef</span><span class='lbrack token'>[</span><span class='integer val'>2</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='orop op'>||</span> <span class='string val'>'no-name'</span><span class='comma token'>,</span>
    <span class='symbol val'>:workflow_definition_revision</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>
      <span class='atts identifier id'>atts</span><span class='lbrack token'>[</span><span class='string val'>'revision'</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>'0'</span><span class='comma token'>,</span>
    <span class='symbol val'>:expression_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span>
      <span class='procdef identifier id'>procdef</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
  <span class='rbrace token'>}</span>

  <span class='h identifier id'>h</span><span class='lbrack token'>[</span><span class='symbol val'>:workflow_definition_url</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lparen token'>(</span>
    <span class='launchitem identifier id'>launchitem</span><span class='dot token'>.</span><span class='workflow_definition_url identifier id'>workflow_definition_url</span> <span class='orop op'>||</span> <span class='LaunchItem constant id'>LaunchItem</span><span class='colon2 op'>::</span><span class='FIELD_DEF constant id'>FIELD_DEF</span>
  <span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='launchitem identifier id'>launchitem</span>

  <span class='RawExpression constant id'>RawExpression</span><span class='dot token'>.</span><span class='new_raw identifier id'>new_raw</span><span class='lparen token'>(</span>
    <span class='new_fei identifier id'>new_fei</span><span class='lparen token'>(</span><span class='h identifier id'>h</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='@application_context ivar id'>@application_context</span><span class='comma token'>,</span> <span class='procdef identifier id'>procdef</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cancel</h3>
</div><div id="cancel-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cancel</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Cancels the given expression. The param might be an expression instance or
a FlowExpressionId instance.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 227</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L227">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cancel identifier id'>cancel</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='unless unless kw'>unless</span> <span class='exp identifier id'>exp</span>
    <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;cancel() cannot cancel missing  #{fei.to_debug_s}&quot;</span> <span class='rbrace token'>}</span>
    <span class='return return kw'>return</span> <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>

  <span class='ldebug identifier id'>ldebug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;cancel() for  #{fei.to_debug_s}&quot;</span> <span class='rbrace token'>}</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:cancel</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='wi identifier id'>wi</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='cancel identifier id'>cancel</span>

  <span class='remove identifier id'>remove</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
    <span class='comment val'># will remove owned environment if any</span>

  <span class='wi identifier id'>wi</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cancel_expression</h3>
</div><div id="cancel_expression-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cancel_expression</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Cancels the given expression and makes sure to resume the flow if the
expression or one of its children were active.
</p>
<p>
If the cancelled branch was not active, this method will take care of
removing the cancelled expression from the parent expression.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 255</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L255">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cancel_expression identifier id'>cancel_expression</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;cannot cancel 'missing' expression #{fei.to_short_s}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='exp identifier id'>exp</span>

  <span class='wi identifier id'>wi</span> <span class='assign token'>=</span> <span class='cancel identifier id'>cancel</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='comment val'># (remember that in case of error, no wi can get returned...)</span>

  <span class='if if kw'>if</span> <span class='wi identifier id'>wi</span>

    <span class='reply_to_parent identifier id'>reply_to_parent</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='wi identifier id'>wi</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>

  <span class='elsif elsif kw'>elsif</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span>

    <span class='parent_exp identifier id'>parent_exp</span> <span class='assign token'>=</span> <span class='fetch_expression identifier id'>fetch_expression</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span><span class='rparen token'>)</span>
    <span class='parent_exp identifier id'>parent_exp</span><span class='dot token'>.</span><span class='remove_child identifier id'>remove_child</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='parent_exp identifier id'>parent_exp</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>cancel_process</h3>
</div><div id="cancel_process-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>cancel_process</span><span class='args'>(exp_or_wfid)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="cancel_flow-instance_method">cancel_flow</tt>
  
</p>
</div><div class="section docstring">
  <p>
Given any expression of a process, cancels the complete process instance.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 299</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L299">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">299
300
301
302
303
304
305
306
307
308
309
310
311</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='cancel_process identifier id'>cancel_process</span> <span class='lparen token'>(</span><span class='exp_or_wfid identifier id'>exp_or_wfid</span><span class='rparen token'>)</span>

  <span class='wfid identifier id'>wfid</span> <span class='assign token'>=</span> <span class='extract_wfid identifier id'>extract_wfid</span><span class='lparen token'>(</span><span class='exp_or_wfid identifier id'>exp_or_wfid</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>
    <span class='comment val'># 'true' would have made sure that the parent wfid is used...</span>

  <span class='ldebug identifier id'>ldebug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;cancel_process() '#{wfid}'&quot;</span> <span class='rbrace token'>}</span>

  <span class='root identifier id'>root</span> <span class='assign token'>=</span> <span class='fetch_root identifier id'>fetch_root</span><span class='lparen token'>(</span><span class='wfid identifier id'>wfid</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;no process to cancel '#{wfid}'&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='root identifier id'>root</span>

  <span class='cancel identifier id'>cancel</span><span class='lparen token'>(</span><span class='root identifier id'>root</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>engine_environment_id</h3>
</div><div id="engine_environment_id-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>engine_environment_id</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the unique engine_environment FlowExpressionId instance. There is
only one such environment in an engine, hence this &#8216;singleton&#8217;
method.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 503</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L503">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">503
504
505
506
507
508
509
510</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='engine_environment_id identifier id'>engine_environment_id</span>

  <span class='@eei ivar id'>@eei</span> <span class='opasgn op'>||=</span> <span class='new_fei identifier id'>new_fei</span><span class='lparen token'>(</span>
    <span class='symbol val'>:workflow_definition_url</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ee'</span><span class='comma token'>,</span>
    <span class='symbol val'>:workflow_definition_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'ee'</span><span class='comma token'>,</span>
    <span class='symbol val'>:workflow_instance_id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'0'</span><span class='comma token'>,</span>
    <span class='symbol val'>:expression_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='EN_ENVIRONMENT constant id'>EN_ENVIRONMENT</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch</h3>
</div><div id="fetch-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches a FlowExpression from the pool. Returns a tuple : the
FlowExpression plus its FlowExpressionId.
</p>
<p>
The param &#8216;exp&#8217; may be a FlowExpressionId or a FlowExpression
that has to be reloaded.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 419</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L419">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">419
420
421
422
423
424</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch identifier id'>fetch</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='extract_fei identifier id'>extract_fei</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='lbrack token'>[</span> <span class='get_expression_storage identifier id'>get_expression_storage</span><span class='lbrack token'>[</span><span class='fei identifier id'>fei</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span> <span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch_engine_environment</h3>
</div><div id="fetch_engine_environment-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch_engine_environment</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns the engine environment (the top level environment)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 438</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L438">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">438
439
440
441
442
443
444
445
446
447
448</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch_engine_environment identifier id'>fetch_engine_environment</span>

  <span class='eei identifier id'>eei</span> <span class='assign token'>=</span> <span class='engine_environment_id identifier id'>engine_environment_id</span>
  <span class='ee identifier id'>ee</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='eei identifier id'>eei</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='ee identifier id'>ee</span> <span class='if if_mod kw'>if</span> <span class='ee identifier id'>ee</span>

  <span class='ee identifier id'>ee</span> <span class='assign token'>=</span> <span class='Environment constant id'>Environment</span><span class='dot token'>.</span><span class='new_env identifier id'>new_env</span><span class='lparen token'>(</span><span class='eei identifier id'>eei</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='@application_context ivar id'>@application_context</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='ee identifier id'>ee</span><span class='dot token'>.</span><span class='store_itself identifier id'>store_itself</span>
  <span class='ee identifier id'>ee</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch_expression</h3>
</div><div id="fetch_expression-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch_expression</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches a FlowExpression (returns only the FlowExpression instance)
</p>
<p>
The param &#8216;exp&#8217; may be a FlowExpressionId or a FlowExpression
that has to be reloaded.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 431</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L431">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">431
432
433
434</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch_expression identifier id'>fetch_expression</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>fetch_root</h3>
</div><div id="fetch_root-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>fetch_root</span><span class='args'>(wfid)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Fetches the root expression of a process (or a subprocess).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 452</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L452">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">452
453
454
455</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='fetch_root identifier id'>fetch_root</span> <span class='lparen token'>(</span><span class='wfid identifier id'>wfid</span><span class='rparen token'>)</span>

  <span class='get_expression_storage identifier id'>get_expression_storage</span><span class='dot token'>.</span><span class='fetch_root identifier id'>fetch_root</span><span class='lparen token'>(</span><span class='wfid identifier id'>wfid</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>forget</h3>
</div><div id="forget-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>forget</span><span class='args'>(parent_exp, exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Forgets the given expression (make it an orphan).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 316</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L316">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='forget identifier id'>forget</span> <span class='lparen token'>(</span><span class='parent_exp identifier id'>parent_exp</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='fetch identifier id'>fetch</span> <span class='exp identifier id'>exp</span>

  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='not not kw'>not</span> <span class='exp identifier id'>exp</span>

  <span class='parent_exp identifier id'>parent_exp</span><span class='dot token'>.</span><span class='children identifier id'>children</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='fei identifier id'>fei</span><span class='rparen token'>)</span>

  <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='dup_environment identifier id'>dup_environment</span>
  <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='store_itself identifier id'>store_itself</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:forget</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='ldebug identifier id'>ldebug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;forget() forgot #{fei}&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>handle_error</h3>
</div><div id="handle_error-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>handle_error</span><span class='args'>(error, fei, message, workitem)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is called when apply() or reply() failed for an expression.
There are currently only two &#8216;users&#8217;, the ParticipantExpression
class and the do_process_workelement method of this ExpressionPool class.
</p>
<p>
Error handling is done here, if no handler was found, the error simply
generate a notification (generally caught by an error journal).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 521</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L521">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='handle_error identifier id'>handle_error</span> <span class='lparen token'>(</span><span class='error identifier id'>error</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='extract_fei identifier id'>extract_fei</span><span class='lparen token'>(</span><span class='fei identifier id'>fei</span><span class='rparen token'>)</span> <span class='comment val'># just to be sure</span>

  <span class='if if kw'>if</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='PausedError constant id'>PausedError</span><span class='rparen token'>)</span>
    <span class='lwarn identifier id'>lwarn</span> <span class='do do kw'>do</span>
      <span class='dstring node'>&quot;#{self.service_name} &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;operation :#{message.to_s} on #{fei.to_s} &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;delayed because process '#{fei.wfid}' is in pause&quot;</span>
    <span class='end end kw'>end</span>
  <span class='else else kw'>else</span>
    <span class='lwarn identifier id'>lwarn</span> <span class='do do kw'>do</span>
      <span class='dstring node'>&quot;#{self.service_name} &quot;</span> <span class='plus op'>+</span>
      <span class='dstring node'>&quot;operation :#{message.to_s} on #{fei.to_s} &quot;</span> <span class='plus op'>+</span>
      <span class='string val'>&quot;failed with\n&quot;</span> <span class='plus op'>+</span> <span class='OpenWFE constant id'>OpenWFE</span><span class='colon2 op'>::</span><span class='exception_to_s identifier id'>exception_to_s</span><span class='lparen token'>(</span><span class='error identifier id'>error</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># notify or really handle ?</span>

  <span class='do_handle_error identifier id'>do_handle_error</span><span class='lparen token'>(</span><span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span> <span class='orop op'>||</span>
  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:error</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='message identifier id'>message</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='error identifier id'>error</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>is_paused?</h3>
</div><div id="is_paused-3F-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>is_paused?</span><span class='args'>(expression)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Returns true if the process instance to which the expression belongs is
currently paused.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 548</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L548">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">548
549
550
551</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='is_paused? fid id'>is_paused?</span> <span class='lparen token'>(</span><span class='expression identifier id'>expression</span><span class='rparen token'>)</span>

  <span class='lparen token'>(</span><span class='@paused_instances ivar id'>@paused_instances</span><span class='lbrack token'>[</span><span class='expression identifier id'>expression</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='parent_wfid identifier id'>parent_wfid</span><span class='rbrack token'>]</span> <span class='neq op'>!=</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>launch</h3>
</div><div id="launch-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>launch</span><span class='args'>(raw_exp, workitem)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Launches a new process instance.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 200</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L200">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">200
201
202
203
204
205</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='launch identifier id'>launch</span> <span class='lparen token'>(</span><span class='raw_exp identifier id'>raw_exp</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:launch</span><span class='comma token'>,</span> <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='apply identifier id'>apply</span><span class='lparen token'>(</span><span class='raw_exp identifier id'>raw_exp</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>launch_subprocess</h3>
</div><div id="launch_subprocess-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>launch_subprocess</span><span class='args'>(firing_exp, template, forget, workitem, initial_variables)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Launches a subprocess. The resulting wfid is a subid for the wfid of the
firing expression.
</p>
<p>
(used by the &#8216;subprocess&#8217; expression, the
&#8216;on_cancel&#8217; feature and the ProcessParticipant)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 156</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L156">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='launch_subprocess identifier id'>launch_subprocess</span> <span class='lparen token'>(</span>
  <span class='firing_exp identifier id'>firing_exp</span><span class='comma token'>,</span> <span class='template identifier id'>template</span><span class='comma token'>,</span> <span class='forget identifier id'>forget</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='initial_variables identifier id'>initial_variables</span><span class='rparen token'>)</span>

  <span class='raw_exp identifier id'>raw_exp</span> <span class='assign token'>=</span> <span class='build_raw_expression identifier id'>build_raw_expression</span><span class='lparen token'>(</span><span class='template identifier id'>template</span><span class='rparen token'>)</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span> <span class='assign token'>=</span> <span class='forget identifier id'>forget</span> <span class='integer val'>? </span><span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='firing_exp identifier id'>firing_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='workflow_definition_url identifier id'>workflow_definition_url</span> <span class='assign token'>=</span> <span class='firing_exp identifier id'>firing_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='wfurl identifier id'>wfurl</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='wfid identifier id'>wfid</span> <span class='assign token'>=</span>
    <span class='dstring node'>&quot;#{firing_exp.fei.parent_wfid}.#{firing_exp.get_next_sub_id}&quot;</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='new_environment identifier id'>new_environment</span><span class='lparen token'>(</span><span class='initial_variables identifier id'>initial_variables</span><span class='rparen token'>)</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='store_itself identifier id'>store_itself</span>

  <span class='apply identifier id'>apply</span><span class='lparen token'>(</span><span class='raw_exp identifier id'>raw_exp</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reapply</h3>
</div><div id="reapply-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reapply</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Re-applies a given expression.
</p>
<p>
Note : this expression must be present and have been applied previously.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 280</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L280">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">280
281
282
283
284
285
286
287
288
289
290
291
292
293
294</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reapply identifier id'>reapply</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;cannot re-apply 'missing' expression #{fei.to_short_s}&quot;</span> \
    <span class='unless unless_mod kw'>unless</span> <span class='exp identifier id'>exp</span>

  <span class='wi identifier id'>wi</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='applied_workitem identifier id'>applied_workitem</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span>
  <span class='wi identifier id'>wi</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'__reapplied__'</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>

  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;cannot re-apply expression #{fei.to_short_s}, not applied&quot;</span> \
    <span class='unless unless_mod kw'>unless</span> <span class='exp identifier id'>exp</span>

  <span class='apply identifier id'>apply</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='wi identifier id'>wi</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>remove</h3>
</div><div id="remove-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>remove</span><span class='args'>(exp)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Removes a flow expression from the pool (This method is mainly called from
the pool itself)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 460</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L460">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">460
461
462
463
464
465
466
467
468
469
470
471</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='remove identifier id'>remove</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='_fei identifier id'>_fei</span> <span class='assign token'>=</span> <span class='fetch identifier id'>fetch</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='FlowExpressionId constant id'>FlowExpressionId</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='unless unless_mod kw'>unless</span> <span class='exp identifier id'>exp</span>

  <span class='comment val'>#ldebug { &quot;remove() fe  #{exp.fei.to_debug_s}&quot; }</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:remove</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='rparen token'>)</span>

  <span class='remove_environment identifier id'>remove_environment</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='environment_id identifier id'>environment_id</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='owns_its_environment? fid id'>owns_its_environment?</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reply</h3>
</div><div id="reply-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reply</span><span class='args'>(exp_or_fei, workitem)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Replies to a given expression
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 217</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L217">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">217
218
219
220
221</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reply identifier id'>reply</span> <span class='lparen token'>(</span><span class='exp_or_fei identifier id'>exp_or_fei</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='get_workqueue identifier id'>get_workqueue</span><span class='dot token'>.</span><span class='push identifier id'>push</span><span class='lparen token'>(</span>
    <span class='self self kw'>self</span><span class='comma token'>,</span> <span class='symbol val'>:do_apply_reply</span><span class='comma token'>,</span> <span class='symbol val'>:reply</span><span class='comma token'>,</span> <span class='exp_or_fei identifier id'>exp_or_fei</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reply_to_parent</h3>
</div><div id="reply_to_parent-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reply_to_parent</span><span class='args'>(exp, workitem, remove = true)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Replies to the parent of the given expression.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 335</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L335">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reply_to_parent identifier id'>reply_to_parent</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='remove identifier id'>remove</span><span class='assign token'>=</span><span class='true true kw'>true</span><span class='rparen token'>)</span>

  <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='last_expression_id identifier id'>last_expression_id</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:reply_to_parent</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='remove identifier id'>remove</span>

    <span class='remove identifier id'>remove</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>
      <span class='comment val'>#</span>
      <span class='comment val'># remove the expression itself</span>

    <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='clean_children identifier id'>clean_children</span>
      <span class='comment val'>#</span>
      <span class='comment val'># remove all the children of the expression</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>#</span>
  <span class='comment val'># manage tag, have to remove it so it can get 'redone' or 'undone'</span>
  <span class='comment val'># (preventing abuse)</span>
  <span class='comment val'>#</span>
  <span class='comment val'># do the same for the on_error handler if any</span>

  <span class='tagname identifier id'>tagname</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'tag'</span><span class='rbrack token'>]</span>
  <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='delete_variable identifier id'>delete_variable</span><span class='lparen token'>(</span><span class='tagname identifier id'>tagname</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='tagname identifier id'>tagname</span>
  <span class='comment val'>#exp.delete_variable(tagname) if tagname and not tagname.match(/^\//)</span>

  <span class='on_error identifier id'>on_error</span> <span class='assign token'>=</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'on_error'</span><span class='rbrack token'>]</span> <span class='comment val'>#if exp.attributes</span>
  <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='delete_variable identifier id'>delete_variable</span><span class='lparen token'>(</span><span class='on_error identifier id'>on_error</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='on_error identifier id'>on_error</span>

  <span class='comment val'>#</span>
  <span class='comment val'># has raw_expression been updated ?</span>

  <span class='track_child_raw_representation identifier id'>track_child_raw_representation</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='rparen token'>)</span>

  <span class='comment val'>#</span>
  <span class='comment val'># flow terminated ?</span>

  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='not not kw'>not</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span><span class='rparen token'>)</span> <span class='and and kw'>and</span> <span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='expid identifier id'>expid</span> <span class='eq op'>==</span> <span class='string val'>'0'</span><span class='rparen token'>)</span>

    <span class='ldebug identifier id'>ldebug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;reply_to_parent() process #{exp.fei.wfid} terminated&quot;</span> <span class='rbrace token'>}</span>

    <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:terminate</span><span class='comma token'>,</span> <span class='exp identifier id'>exp</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

    <span class='return return kw'>return</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>#</span>
  <span class='comment val'># else, gone parent ?</span>

  <span class='comment val'>#if (not exp.parent_id) or (exp.parent_id.expname == 'gone')</span>
  <span class='comment val'>#  # this 'gone' is kept for some level of 'backward compatibility'</span>

  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='not not kw'>not</span> <span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span><span class='rparen token'>)</span>

    <span class='ldebug identifier id'>ldebug</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;reply_to_parent() parent is gone for #{exp.fei.to_debug_s}&quot;</span><span class='rbrace token'>}</span>
    <span class='return return kw'>return</span>
  <span class='end end kw'>end</span>

  <span class='comment val'>#</span>
  <span class='comment val'># parent still present, reply to it</span>

  <span class='reply identifier id'>reply</span><span class='lparen token'>(</span><span class='exp identifier id'>exp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reschedule</h3>
</div><div id="reschedule-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reschedule</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is called at each expool (engine) [re]start. It roams through
the previously saved (persisted) expressions to reschedule ones like
&#8216;sleep&#8217; or &#8216;cron&#8217;.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 477</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L477">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reschedule identifier id'>reschedule</span>

  <span class='return return kw'>return</span> <span class='if if_mod kw'>if</span> <span class='@stopped ivar id'>@stopped</span>

  <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='OpenWFE constant id'>OpenWFE</span><span class='colon2 op'>::</span><span class='Timer constant id'>Timer</span><span class='dot token'>.</span><span class='new identifier id'>new</span>

  <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='string val'>'reschedule() initiating...'</span> <span class='rbrace token'>}</span>

  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:include_classes</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Rufus constant id'>Rufus</span><span class='colon2 op'>::</span><span class='Schedulable constant id'>Schedulable</span> <span class='rbrace token'>}</span>

  <span class='get_expression_storage identifier id'>get_expression_storage</span><span class='dot token'>.</span><span class='find_expressions identifier id'>find_expressions</span><span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='fexp identifier id'>fexp</span><span class='bitor op'>|</span>

    <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;reschedule() for  #{fexp.fei.to_s}...&quot;</span> <span class='rbrace token'>}</span>

    <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:reschedule</span><span class='comma token'>,</span> <span class='fexp identifier id'>fexp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='rparen token'>)</span>

    <span class='fexp identifier id'>fexp</span><span class='dot token'>.</span><span class='reschedule identifier id'>reschedule</span><span class='lparen token'>(</span><span class='get_scheduler identifier id'>get_scheduler</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;reschedule() done. (took #{t.duration} ms)&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stop</h3>
</div><div id="stop-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stop</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Stops this expression pool (especially its workqueue).
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 82</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L82">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">82
83
84
85
86
87</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='stop identifier id'>stop</span>

  <span class='@stopped ivar id'>@stopped</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:stop</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>substitute_and_apply</h3>
</div><div id="substitute_and_apply-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>substitute_and_apply</span><span class='args'>(fexp, template, workitem)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Replaces the flow expression with a raw expression that has the same fei,
same parent and points to the same env. The raw_representation will be the
template. Stores and then apply the &quot;cuckoo&quot; expression.
</p>
<p>
Used by &#8216;exp&#8217; and &#8216;eval&#8217; and the do_handle_error
method of the expool.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 184</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L184">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">184
185
186
187
188
189
190
191
192
193
194
195
196</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='substitute_and_apply identifier id'>substitute_and_apply</span> <span class='lparen token'>(</span><span class='fexp identifier id'>fexp</span><span class='comma token'>,</span> <span class='template identifier id'>template</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='re identifier id'>re</span> <span class='assign token'>=</span> <span class='RawExpression constant id'>RawExpression</span><span class='dot token'>.</span><span class='new_raw identifier id'>new_raw</span><span class='lparen token'>(</span>
    <span class='fexp identifier id'>fexp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='comma token'>,</span>
    <span class='fexp identifier id'>fexp</span><span class='dot token'>.</span><span class='parent_id identifier id'>parent_id</span><span class='comma token'>,</span>
    <span class='fexp identifier id'>fexp</span><span class='dot token'>.</span><span class='environment_id identifier id'>environment_id</span><span class='comma token'>,</span>
    <span class='application_context identifier id'>application_context</span><span class='comma token'>,</span>
    <span class='template identifier id'>template</span><span class='rparen token'>)</span>

  <span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='re identifier id'>re</span><span class='rparen token'>)</span>

  <span class='apply identifier id'>apply</span><span class='lparen token'>(</span><span class='re identifier id'>re</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>tlaunch_child</h3>
</div><div id="tlaunch_child-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>tlaunch_child</span><span class='args'>(parent_exp, template, sub_id, workitem, opts = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Launches the given template (sexp) as the child of its parent expression.
</p>
<p>
If the last, register_child, is set to true, this method will take care of
adding the new child to the parent expression.
</p>
<p>
(used by &#8216;cron&#8217; and more)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 139</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L139">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">139
140
141
142
143
144
145
146
147
148</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='tlaunch_child identifier id'>tlaunch_child</span> <span class='lparen token'>(</span><span class='parent_exp identifier id'>parent_exp</span><span class='comma token'>,</span> <span class='template identifier id'>template</span><span class='comma token'>,</span> <span class='sub_id identifier id'>sub_id</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>

  <span class='raw_exp identifier id'>raw_exp</span> <span class='assign token'>=</span> <span class='tprepare_child identifier id'>tprepare_child</span><span class='lparen token'>(</span><span class='parent_exp identifier id'>parent_exp</span><span class='comma token'>,</span> <span class='template identifier id'>template</span><span class='comma token'>,</span> <span class='sub_id identifier id'>sub_id</span><span class='comma token'>,</span> <span class='opts identifier id'>opts</span><span class='rparen token'>)</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:tlaunch_child</span><span class='comma token'>,</span> <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='apply identifier id'>apply</span><span class='lparen token'>(</span><span class='raw_exp identifier id'>raw_exp</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>tprepare_child</h3>
</div><div id="tprepare_child-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>tprepare_child</span><span class='args'>(parent_exp, template, sub_id, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This is the first stage of the tlaunch_child() method.
</p>
<p>
(it&#8217;s used by the concurrent iterator when preparing all its
iteration children)
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 94</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L94">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='tprepare_child identifier id'>tprepare_child</span> <span class='lparen token'>(</span><span class='parent_exp identifier id'>parent_exp</span><span class='comma token'>,</span> <span class='template identifier id'>template</span><span class='comma token'>,</span> <span class='sub_id identifier id'>sub_id</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>

  <span class='return return kw'>return</span> <span class='fetch_expression identifier id'>fetch_expression</span><span class='lparen token'>(</span><span class='template identifier id'>template</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='template identifier id'>template</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='FlowExpressionId constant id'>FlowExpressionId</span><span class='rparen token'>)</span>
    <span class='comment val'># used for &quot;scheduled launches&quot;</span>

  <span class='fei identifier id'>fei</span> <span class='assign token'>=</span> <span class='parent_exp identifier id'>parent_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='expression_id identifier id'>expression_id</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{fei.expid}.#{sub_id}&quot;</span>
  <span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='expression_name identifier id'>expression_name</span> <span class='assign token'>=</span> <span class='template identifier id'>template</span><span class='dot token'>.</span><span class='first identifier id'>first</span>

  <span class='parent_id identifier id'>parent_id</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:orphan</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='nil nil kw'>nil</span> <span class='colon op'>:</span> <span class='parent_exp identifier id'>parent_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span>

  <span class='raw_exp identifier id'>raw_exp</span> <span class='assign token'>=</span> <span class='RawExpression constant id'>RawExpression</span><span class='dot token'>.</span><span class='new_raw identifier id'>new_raw</span><span class='lparen token'>(</span>
    <span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='parent_id identifier id'>parent_id</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span> <span class='@application_context ivar id'>@application_context</span><span class='comma token'>,</span> <span class='template identifier id'>template</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='vars identifier id'>vars</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:variables</span><span class='rbrack token'>]</span>
    <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='new_environment identifier id'>new_environment</span><span class='lparen token'>(</span><span class='vars identifier id'>vars</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='environment_id identifier id'>environment_id</span> <span class='assign token'>=</span> <span class='parent_exp identifier id'>parent_exp</span><span class='dot token'>.</span><span class='environment_id identifier id'>environment_id</span>
  <span class='end end kw'>end</span>

  <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='dup_environment identifier id'>dup_environment</span> <span class='if if_mod kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:dup_environment</span><span class='rbrack token'>]</span>

  <span class='comment val'>#workitem.fei = raw_exp.fei</span>
    <span class='comment val'># done in do_apply...</span>

  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:register_child</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='true true kw'>true</span>

    <span class='lparen token'>(</span><span class='parent_exp identifier id'>parent_exp</span><span class='dot token'>.</span><span class='children identifier id'>children</span> <span class='opasgn op'>||=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='lshft op'>&lt;&lt;</span> <span class='raw_exp identifier id'>raw_exp</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span>

    <span class='update identifier id'>update</span><span class='lparen token'>(</span><span class='raw_exp identifier id'>raw_exp</span><span class='rparen token'>)</span>

    <span class='parent_exp identifier id'>parent_exp</span><span class='dot token'>.</span><span class='store_itself identifier id'>store_itself</span> <span class='unless unless_mod kw'>unless</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:dont_store_parent</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>

  <span class='raw_exp identifier id'>raw_exp</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>update</h3>
</div><div id="update-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>update</span><span class='args'>(flow_expression)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds or updates a flow expression in this pool
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 402</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L402">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">402
403
404
405
406
407
408
409
410
411</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='update identifier id'>update</span> <span class='lparen token'>(</span><span class='flow_expression identifier id'>flow_expression</span><span class='rparen token'>)</span>

  <span class='flow_expression identifier id'>flow_expression</span><span class='dot token'>.</span><span class='updated_at identifier id'>updated_at</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>

  <span class='comment val'>#ldebug { &quot;update() for #{flow_expression.fei.to_debug_s}&quot; }</span>

  <span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span><span class='symbol val'>:update</span><span class='comma token'>,</span> <span class='flow_expression identifier id'>flow_expression</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='flow_expression identifier id'>flow_expression</span><span class='rparen token'>)</span>

  <span class='flow_expression identifier id'>flow_expression</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>wait_for</h3>
</div><div id="wait_for-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>wait_for</span><span class='args'>(fei_or_wfid)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
If the launch option :wait_for is set to true, this method will be called
to apply the raw_expression. It will only return when the launched process
is over, which means it terminated, it had an error or it got cancelled.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  
</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/expool/expressionpool.rb', line 590</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/expool/expressionpool.rb#L590">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='wait_for identifier id'>wait_for</span> <span class='lparen token'>(</span><span class='fei_or_wfid identifier id'>fei_or_wfid</span><span class='rparen token'>)</span>

  <span class='wfid identifier id'>wfid</span> <span class='assign token'>=</span> <span class='extract_wfid identifier id'>extract_wfid</span><span class='lparen token'>(</span><span class='fei_or_wfid identifier id'>fei_or_wfid</span><span class='comma token'>,</span> <span class='false false kw'>false</span><span class='rparen token'>)</span>

  <span class='t identifier id'>t</span> <span class='assign token'>=</span> <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='current identifier id'>current</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>

  <span class='to identifier id'>to</span> <span class='assign token'>=</span> <span class='add_observer identifier id'>add_observer</span><span class='lparen token'>(</span><span class='symbol val'>:terminate</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='fe identifier id'>fe</span><span class='comma token'>,</span> <span class='wi identifier id'>wi</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='fe identifier id'>fe</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='wfid identifier id'>wfid</span> <span class='eq op'>==</span> <span class='wfid identifier id'>wfid</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='symbol val'>:terminate</span><span class='comma token'>,</span> <span class='wi identifier id'>wi</span><span class='comma token'>,</span> <span class='fei_or_wfid identifier id'>fei_or_wfid</span> <span class='rbrack token'>]</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='wakeup identifier id'>wakeup</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='te identifier id'>te</span> <span class='assign token'>=</span> <span class='add_observer identifier id'>add_observer</span><span class='lparen token'>(</span><span class='symbol val'>:error</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='fei identifier id'>fei</span><span class='comma token'>,</span> <span class='m identifier id'>m</span><span class='comma token'>,</span> <span class='i identifier id'>i</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='parent_wfid identifier id'>parent_wfid</span> <span class='eq op'>==</span> <span class='wfid identifier id'>wfid</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='symbol val'>:error</span><span class='comma token'>,</span> <span class='e identifier id'>e</span><span class='comma token'>,</span> <span class='fei_or_wfid identifier id'>fei_or_wfid</span> <span class='rbrack token'>]</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='wakeup identifier id'>wakeup</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='tc identifier id'>tc</span> <span class='assign token'>=</span> <span class='add_observer identifier id'>add_observer</span><span class='lparen token'>(</span><span class='symbol val'>:cancel</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='comma token'>,</span> <span class='fe identifier id'>fe</span><span class='bitor op'>|</span>
    <span class='if if kw'>if</span> <span class='fe identifier id'>fe</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='wfid identifier id'>wfid</span> <span class='eq op'>==</span> <span class='wfid identifier id'>wfid</span> <span class='and and kw'>and</span> <span class='fe identifier id'>fe</span><span class='dot token'>.</span><span class='fei identifier id'>fei</span><span class='dot token'>.</span><span class='expid identifier id'>expid</span> <span class='eq op'>==</span> <span class='string val'>'0'</span>
      <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span> <span class='symbol val'>:cancel</span><span class='comma token'>,</span> <span class='wfid identifier id'>wfid</span><span class='comma token'>,</span> <span class='fei_or_wfid identifier id'>fei_or_wfid</span> <span class='rbrack token'>]</span>
      <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='wakeup identifier id'>wakeup</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='yield yield kw'>yield</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>

  <span class='Thread constant id'>Thread</span><span class='dot token'>.</span><span class='stop identifier id'>stop</span> <span class='unless unless_mod kw'>unless</span> <span class='result identifier id'>result</span>

  <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;wait_for() '#{wfid}' is over&quot;</span> <span class='rbrace token'>}</span>

  <span class='remove_observer identifier id'>remove_observer</span><span class='lparen token'>(</span><span class='to identifier id'>to</span><span class='comma token'>,</span> <span class='symbol val'>:terminate</span><span class='rparen token'>)</span>
  <span class='remove_observer identifier id'>remove_observer</span><span class='lparen token'>(</span><span class='te identifier id'>te</span><span class='comma token'>,</span> <span class='symbol val'>:error</span><span class='rparen token'>)</span>
  <span class='remove_observer identifier id'>remove_observer</span><span class='lparen token'>(</span><span class='tc identifier id'>tc</span><span class='comma token'>,</span> <span class='symbol val'>:cancel</span><span class='rparen token'>)</span>

  <span class='result identifier id'>result</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>