<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jmettraux's ruote - Class: OpenWFE::Engine - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jmettraux/commits/ruote/master" rel="alternate" title="Recent Commits to ruote:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jmettraux", "ruote", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jmettraux", "ruote", "5348d68477c619f29e89032a1e3efae889f5722c", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jmettraux/ruote/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jmettraux/ruote/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jmettraux/ruote/network">Network</a></li>            
            <li class=""><a href="http://github.com/jmettraux/ruote/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jmettraux/ruote">Wiki</a></li>
            <li class=""><a href="http://github.com/jmettraux/ruote/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jmettraux/ruote">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jmettraux">jmettraux</a> / <b><a href="http://github.com/jmettraux/ruote/tree">ruote</a></b>        
                <a id="namespaces_button" rel="jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class OpenWFE_Engine">
  <h1>Class: OpenWFE::Engine</h1>
  <div class="section inheritance">
  <ul>
  <li><a title="OpenWFE::Service" href="Service.html">OpenWFE::Service</a></li><ul><li>OpenWFE::Engine</li>
  </ul></ul>
</div><div class="section mixins">
  <h2>Included Modules</h2>
  <p><a title="OpenWFE::OwfeServiceLocator" href="Engine/OwfeServiceLocator.html">OpenWFE::OwfeServiceLocator</a>, <a title="OpenWFE::FeiMixin" href="Engine/FeiMixin.html">OpenWFE::FeiMixin</a>, <a title="OpenWFE::ExpoolMethods" href="Engine/ExpoolMethods.html">OpenWFE::ExpoolMethods</a>, <a title="OpenWFE::StatusMethods" href="Engine/StatusMethods.html">OpenWFE::StatusMethods</a>, <a title="OpenWFE::LookupMethods" href="Engine/LookupMethods.html">OpenWFE::LookupMethods</a>, <a title="OpenWFE::ListenerMethods" href="Engine/ListenerMethods.html">OpenWFE::ListenerMethods</a>, <a title="OpenWFE::ParticipantMethods" href="Engine/ParticipantMethods.html">OpenWFE::ParticipantMethods</a>, <a title="OpenWFE::UpdateExpMethods" href="Engine/UpdateExpMethods.html">OpenWFE::UpdateExpMethods</a>, <a title="OpenWFE::LaunchMethods" href="Engine/LaunchMethods.html">OpenWFE::LaunchMethods</a></p>
</div><div class="section docstring">
  <p>
The simplest implementation of the OpenWFE workflow engine. No persistence
is used, everything is stored in memory.
</p>

</div><div class="section attributes">
  
    <div class="">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">engine_name</td>
          <td class="readwrite">
            [<span id='engine_name-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
The name of the engine, will be used to &#8216;stamp&#8217; each expression
active in the engine (and thus indirectrly, each workitem).
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(application_context = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Builds an OpenWFEru engine.
</p>
<p>
Accepts an optional initial application_context (containing initialization
params for services for example).
</p>
<p>
The engine itself uses one param :logger, used to define where all the log
output for OpenWFEru should go. By default, this output goes to
logs/ruote.log
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/engine/engine.rb', line 90</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/engine/engine.rb#L90">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='lparen token'>(</span><span class='application_context identifier id'>application_context</span><span class='assign token'>=</span><span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>

  <span class='super super kw'>super</span><span class='lparen token'>(</span><span class='symbol val'>:s_engine</span><span class='comma token'>,</span> <span class='application_context identifier id'>application_context</span><span class='rparen token'>)</span>

  <span class='@engine_name ivar id'>@engine_name</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='application_context identifier id'>application_context</span><span class='lbrack token'>[</span><span class='symbol val'>:engine_name</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='string val'>'engine'</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span>

  <span class='$OWFE_LOG gvar id'>$OWFE_LOG</span> <span class='assign token'>=</span> <span class='application_context identifier id'>application_context</span><span class='lbrack token'>[</span><span class='symbol val'>:logger</span><span class='rbrack token'>]</span>

  <span class='unless unless kw'>unless</span> <span class='$OWFE_LOG gvar id'>$OWFE_LOG</span>
    <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir identifier id'>mkdir</span><span class='lparen token'>(</span><span class='string val'>'logs'</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exist? fid id'>exist?</span><span class='lparen token'>(</span><span class='string val'>'logs'</span><span class='rparen token'>)</span>
    <span class='$OWFE_LOG gvar id'>$OWFE_LOG</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>'logs/ruote.log'</span><span class='comma token'>,</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='integer val'>1024000</span><span class='rparen token'>)</span>
    <span class='$OWFE_LOG gvar id'>$OWFE_LOG</span><span class='dot token'>.</span><span class='level identifier id'>level</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='colon2 op'>::</span><span class='INFO constant id'>INFO</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># build order matters.</span>
  <span class='comment val'>#</span>
  <span class='comment val'># especially for the expstorage which 'observes' the expression</span>
  <span class='comment val'># pool and thus needs to be instantiated after it.</span>

  <span class='build_scheduler identifier id'>build_scheduler</span>
    <span class='comment val'>#</span>
    <span class='comment val'># for delayed or repetitive executions (it's the engine's clock)</span>
    <span class='comment val'># see http://openwferu.rubyforge.org/scheduler.html</span>

  <span class='build_expression_map identifier id'>build_expression_map</span>
    <span class='comment val'>#</span>
    <span class='comment val'># mapping expression names ('sequence', 'if', 'concurrence',</span>
    <span class='comment val'># 'when'...) to their implementations (SequenceExpression,</span>
    <span class='comment val'># IfExpression, ConcurrenceExpression, ...)</span>

  <span class='build_wfid_generator identifier id'>build_wfid_generator</span>
    <span class='comment val'>#</span>
    <span class='comment val'># the workflow instance (process instance) id generator</span>
    <span class='comment val'># making sure each process instance has a unique identifier</span>

  <span class='build_workqueue identifier id'>build_workqueue</span>
    <span class='comment val'>#</span>
    <span class='comment val'># where apply/reply get queued and processed asynchronously</span>
    <span class='comment val'># by a single thread</span>

  <span class='build_expression_pool identifier id'>build_expression_pool</span>
    <span class='comment val'>#</span>
    <span class='comment val'># the core (hairy ball) of the engine</span>

  <span class='build_expression_storage identifier id'>build_expression_storage</span>
    <span class='comment val'>#</span>
    <span class='comment val'># the engine persistence (persisting the expression instances</span>
    <span class='comment val'># that make up process instances)</span>

  <span class='build_participant_map identifier id'>build_participant_map</span>
    <span class='comment val'>#</span>
    <span class='comment val'># building the services that maps participant names to</span>
    <span class='comment val'># participant implementations / instances.</span>

  <span class='build_error_journal identifier id'>build_error_journal</span>
    <span class='comment val'>#</span>
    <span class='comment val'># builds the error journal (keeping track of failures</span>
    <span class='comment val'># in business process executions, and an opportunity to</span>
    <span class='comment val'># fix and replay)</span>

  <span class='build_tree_checker identifier id'>build_tree_checker</span>
    <span class='comment val'>#</span>
    <span class='comment val'># builds the tree checker (the thing that checks incoming external</span>
    <span class='comment val'># ruby code for evil things)</span>

  <span class='build_def_parser identifier id'>build_def_parser</span>
    <span class='comment val'>#</span>
    <span class='comment val'># builds the definition parser (the thing that turns process definitions</span>
    <span class='comment val'># into actual expression trees, ready for execution).</span>

  <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;new() --- engine started --- #{self.object_id}&quot;</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#enable_irb_console-instance_method">#enable_irb_console</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Enabling the console means that hitting CTRL-C on the window / term / dos
box / whatever does run the OpenWFEru engine will open an IRB interactive
console for directly manipulating the engine instance.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#join-instance_method">#join</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Makes the current thread join the engine&#8217;s scheduler thread.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#join_until_idle-instance_method">#join_until_idle</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Calling this method makes the control flow block until the workflow engine
is inactive.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reply-instance_method">#reply</span><span class='args'>(workitem)</span>
        <span class='block'></span>
        
          <span class='alias'>#proceed</span>
        
          <span class='alias'>#oldreply</span>
        
          <span class='alias'>#forward</span>
        
      </th>
      <td class="docstring">
        <p>
This method is used to feed a workitem back to the engine (after it got
sent to a worklist or wherever by a participant).
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#reschedule-instance_method">#reschedule</span><span class='args'></span>
        <span class='block'></span>
        
          <span class='alias'>#reload</span>
        
      </th>
      <td class="docstring">
        <p>
Call this method once the participants for a persisted engine have been
[re]added.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#stop-instance_method">#stop</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
&#8212; Makes sure that hitting CTRL-C will actually kill the engine VM and
not open an IRB console.
</p>

        
      </td>
    </tr>
  
</table><div class="inherited">
  
</div>
<div class="clear"></div><div class="included">
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::OwfeServiceLocator" href="Engine/OwfeServiceLocator.html">OpenWFE::OwfeServiceLocator</a></h2>
    <p><span class='name'><a title="get_def_parser" href="OwfeServiceLocator.html#get_def_parser-instance_method">get_def_parser</a></span>, <span class='name'><a title="get_engine" href="OwfeServiceLocator.html#get_engine-instance_method">get_engine</a></span>, <span class='name'><a title="get_error_journal" href="OwfeServiceLocator.html#get_error_journal-instance_method">get_error_journal</a></span>, <span class='name'><a title="get_expool" href="OwfeServiceLocator.html#get_expool-instance_method">get_expool</a></span>, <span class='name'><a title="get_expression_map" href="OwfeServiceLocator.html#get_expression_map-instance_method">get_expression_map</a></span>, <span class='name'><a title="get_expression_pool" href="OwfeServiceLocator.html#get_expression_pool-instance_method">get_expression_pool</a></span>, <span class='name'><a title="get_expression_storage" href="OwfeServiceLocator.html#get_expression_storage-instance_method">get_expression_storage</a></span>, <span class='name'><a title="get_expression_storages" href="OwfeServiceLocator.html#get_expression_storages-instance_method">get_expression_storages</a></span>, <span class='name'><a title="get_journal" href="OwfeServiceLocator.html#get_journal-instance_method">get_journal</a></span>, <span class='name'><a title="get_participant_map" href="OwfeServiceLocator.html#get_participant_map-instance_method">get_participant_map</a></span>, <span class='name'><a title="get_scheduler" href="OwfeServiceLocator.html#get_scheduler-instance_method">get_scheduler</a></span>, <span class='name'><a title="get_tree_checker" href="OwfeServiceLocator.html#get_tree_checker-instance_method">get_tree_checker</a></span>, <span class='name'><a title="get_wfid_generator" href="OwfeServiceLocator.html#get_wfid_generator-instance_method">get_wfid_generator</a></span>, <span class='name'><a title="get_workqueue" href="OwfeServiceLocator.html#get_workqueue-instance_method">get_workqueue</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::ExpoolMethods" href="Engine/ExpoolMethods.html">OpenWFE::ExpoolMethods</a></h2>
    <p><span class='name'><a title="cancel_expression" href="ExpoolMethods.html#cancel_expression-instance_method">cancel_expression</a></span>, <span class='name'><a title="cancel_process" href="ExpoolMethods.html#cancel_process-instance_method">cancel_process</a></span>, <span class='name'><a title="pause_process" href="ExpoolMethods.html#pause_process-instance_method">pause_process</a></span>, <span class='name'><a title="reapply" href="ExpoolMethods.html#reapply-instance_method">reapply</a></span>, <span class='name'><a title="replay_at_error" href="ExpoolMethods.html#replay_at_error-instance_method">replay_at_error</a></span>, <span class='name'><a title="resume_process" href="ExpoolMethods.html#resume_process-instance_method">resume_process</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::StatusMethods" href="Engine/StatusMethods.html">OpenWFE::StatusMethods</a></h2>
    <p><span class='name'><a title="init_status_cache" href="StatusMethods.html#init_status_cache-instance_method">init_status_cache</a></span>, <span class='name'><a title="is_paused?" href="StatusMethods.html#is_paused%3F-instance_method">is_paused?</a></span>, <span class='name'><a title="process_status" href="StatusMethods.html#process_status-instance_method">process_status</a></span>, <span class='name'><a title="process_statuses" href="StatusMethods.html#process_statuses-instance_method">process_statuses</a></span>, <span class='name'><a title="processes" href="StatusMethods.html#processes-instance_method">processes</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::LookupMethods" href="Engine/LookupMethods.html">OpenWFE::LookupMethods</a></h2>
    <p><span class='name'><a title="get_variables" href="LookupMethods.html#get_variables-instance_method">get_variables</a></span>, <span class='name'><a title="lookup_processes" href="LookupMethods.html#lookup_processes-instance_method">lookup_processes</a></span>, <span class='name'><a title="lookup_variable" href="LookupMethods.html#lookup_variable-instance_method">lookup_variable</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::ListenerMethods" href="Engine/ListenerMethods.html">OpenWFE::ListenerMethods</a></h2>
    <p><span class='name'><a title="register_listener" href="ListenerMethods.html#register_listener-instance_method">register_listener</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::ParticipantMethods" href="Engine/ParticipantMethods.html">OpenWFE::ParticipantMethods</a></h2>
    <p><span class='name'><a title="get_participant" href="ParticipantMethods.html#get_participant-instance_method">get_participant</a></span>, <span class='name'><a title="participants" href="ParticipantMethods.html#participants-instance_method">participants</a></span>, <span class='name'><a title="register_participant" href="ParticipantMethods.html#register_participant-instance_method">register_participant</a></span>, <span class='name'><a title="unregister_participant" href="ParticipantMethods.html#unregister_participant-instance_method">unregister_participant</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::UpdateExpMethods" href="Engine/UpdateExpMethods.html">OpenWFE::UpdateExpMethods</a></h2>
    <p><span class='name'><a title="update_expression" href="UpdateExpMethods.html#update_expression-instance_method">update_expression</a></span>, <span class='name'><a title="update_expression_data" href="UpdateExpMethods.html#update_expression_data-instance_method">update_expression_data</a></span>, <span class='name'><a title="update_expression_tree" href="UpdateExpMethods.html#update_expression_tree-instance_method">update_expression_tree</a></span></p>
  </div>
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::LaunchMethods" href="Engine/LaunchMethods.html">OpenWFE::LaunchMethods</a></h2>
    <p><span class='name'><a title="launch" href="LaunchMethods.html#launch-instance_method">launch</a></span>, <span class='name'><a title="pre_launch_check" href="LaunchMethods.html#pre_launch_check-instance_method">pre_launch_check</a></span>, <span class='name'><a title="wait_for" href="LaunchMethods.html#wait_for-instance_method">wait_for</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>enable_irb_console</h3>
</div><div id="enable_irb_console-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>enable_irb_console</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Enabling the console means that hitting CTRL-C on the window / term / dos
box / whatever does run the OpenWFEru engine will open an IRB interactive
console for directly manipulating the engine instance.
</p>
<p>
Hit CTRL-D to get out of the console.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/engine/engine.rb', line 272</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/engine/engine.rb#L272">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">272
273
274
275</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='enable_irb_console identifier id'>enable_irb_console</span>

  <span class='OpenWFE constant id'>OpenWFE</span><span class='colon2 op'>::</span><span class='trap_int_irb identifier id'>trap_int_irb</span><span class='lparen token'>(</span><span class='binding identifier id'>binding</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>join</h3>
</div><div id="join-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>join</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Makes the current thread join the engine&#8217;s scheduler thread
</p>
<p>
You can thus make an engine standalone with something like :
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'openwfe/engine/engine'</span>

  <span class='the_engine identifier id'>the_engine</span> <span class='assign token'>=</span> <span class='OpenWFE constant id'>OpenWFE</span><span class='colon2 op'>::</span><span class='Engine constant id'>Engine</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='the_engine identifier id'>the_engine</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
</pre>
<p>
And you&#8217;ll have to hit CTRL-C to make it stop.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/engine/engine.rb', line 244</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/engine/engine.rb#L244">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">244
245
246
247</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='join identifier id'>join</span>

  <span class='get_scheduler identifier id'>get_scheduler</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>join_until_idle</h3>
</div><div id="join_until_idle-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>join_until_idle</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Calling this method makes the control flow block until the workflow engine
is inactive.
</p>
<p>
TODO : implement idle_for
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/engine/engine.rb', line 255</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/engine/engine.rb#L255">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">255
256
257
258
259
260
261
262</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='join_until_idle identifier id'>join_until_idle</span>

  <span class='storage identifier id'>storage</span> <span class='assign token'>=</span> <span class='get_expression_storage identifier id'>get_expression_storage</span>

  <span class='while while kw'>while</span> <span class='storage identifier id'>storage</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
    <span class='sleep identifier id'>sleep</span> <span class='integer val'>1</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reply</h3>
</div><div id="reply-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reply</span><span class='args'>(workitem)</span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="proceed-instance_method">proceed</tt>
  
    <tt id="oldreply-instance_method">oldreply</tt>
  
    <tt id="forward-instance_method">forward</tt>
  
</p>
</div><div class="section docstring">
  <p>
This method is used to feed a workitem back to the engine (after it got
sent to a worklist or wherever by a participant). Participant
implementations themselves do call this method usually.
</p>
<p>
This method also accepts LaunchItem instances.
</p>
<p>
Since OpenWFEru 0.9.16, this reply method accepts InFlowWorkitem that
don&#8217;t belong to a process instance (ie whose flow_expression_id is
nil). It will simply notify the participant_map of the reply for the given
participant_name. If there is no participant_name specified for this orphan
workitem, an exception will be raised.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/engine/engine.rb', line 191</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/engine/engine.rb#L191">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reply identifier id'>reply</span> <span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='if if kw'>if</span> <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='InFlowWorkItem constant id'>InFlowWorkItem</span><span class='rparen token'>)</span>

    <span class='if if kw'>if</span> <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='flow_expression_id identifier id'>flow_expression_id</span>
      <span class='comment val'>#</span>
      <span class='comment val'># vanilla case, workitem coming back</span>
      <span class='comment val'># (from listener probably)</span>

      <span class='return return kw'>return</span> <span class='get_expression_pool identifier id'>get_expression_pool</span><span class='dot token'>.</span><span class='reply identifier id'>reply</span><span class='lparen token'>(</span>
        <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='flow_expression_id identifier id'>flow_expression_id</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='if if kw'>if</span> <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='participant_name identifier id'>participant_name</span>
      <span class='comment val'>#</span>
      <span class='comment val'># a workitem that doesn't belong to a process instance</span>
      <span class='comment val'># but bears a participant name.</span>
      <span class='comment val'># Notify, there may be something listening on</span>
      <span class='comment val'># this channel (see the 'listen' expression).</span>

      <span class='return return kw'>return</span> <span class='get_participant_map identifier id'>get_participant_map</span><span class='dot token'>.</span><span class='onotify identifier id'>onotify</span><span class='lparen token'>(</span>
        <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='participant_name identifier id'>participant_name</span><span class='comma token'>,</span> <span class='symbol val'>:reply</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='raise identifier id'>raise</span><span class='lparen token'>(</span>
      <span class='string val'>&quot;InFlowWorkitem doesn't belong to a process instance&quot;</span> <span class='plus op'>+</span>
      <span class='string val'>&quot; nor to a participant&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='get_expression_pool identifier id'>get_expression_pool</span><span class='dot token'>.</span><span class='launch identifier id'>launch</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span> \
    <span class='if if_mod kw'>if</span> <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='LaunchItem constant id'>LaunchItem</span><span class='rparen token'>)</span>
      <span class='comment val'>#</span>
      <span class='comment val'># launchitem coming from listener</span>
      <span class='comment val'># let's attempt to launch a new process instance</span>

  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;engine.reply() cannot handle instances of #{workitem.class}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>reschedule</h3>
</div><div id="reschedule-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>reschedule</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>
<p class="aliases">
  <span class="aka">Also known as:</span>
  
    <tt id="reload-instance_method">reload</tt>
  
</p>
</div><div class="section docstring">
  <p>
Call this method once the participants for a persisted engine have been
[re]added.
</p>
<p>
If this method is called too soon, missing participants will cause
trouble&#8230; Call this method after all the participants have been added.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/engine/engine.rb', line 171</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/engine/engine.rb#L171">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">171
172
173
174</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='reschedule identifier id'>reschedule</span>

  <span class='get_expression_pool identifier id'>get_expression_pool</span><span class='dot token'>.</span><span class='reschedule identifier id'>reschedule</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>stop</h3>
</div><div id="stop-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>stop</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
&#8212; Makes sure that hitting CTRL-C will actually kill the engine VM and
not open an IRB console.
</p>
<p>
def disable_irb_console
</p>
<pre class="code">
 <span class='$openwfe_irb gvar id'>$openwfe_irb</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
 <span class='trap identifier id'>trap</span> <span class='string val'>'INT'</span> <span class='do do kw'>do</span>
   <span class='exit identifier id'>exit</span> <span class='integer val'>0</span>
 <span class='end end kw'>end</span>
</pre>
<p>
end ++
</p>
<p>
Stopping the engine will stop all the services in the application context.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/engine/engine.rb', line 293</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/engine/engine.rb#L293">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='stop identifier id'>stop</span>

  <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;stop() stopping engine '#{@service_name}'&quot;</span> <span class='rbrace token'>}</span>

  <span class='@application_context ivar id'>@application_context</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='sname identifier id'>sname</span><span class='comma token'>,</span> <span class='service identifier id'>service</span><span class='bitor op'>|</span>

    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='sname identifier id'>sname</span> <span class='eq op'>==</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='service_name identifier id'>service_name</span>

    <span class='if if kw'>if</span> <span class='service identifier id'>service</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:stop</span><span class='rparen token'>)</span>

      <span class='service identifier id'>service</span><span class='dot token'>.</span><span class='stop identifier id'>stop</span>

      <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;stop() stopped service '#{sname}' (#{service.class})&quot;</span> <span class='rbrace token'>}</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='linfo identifier id'>linfo</span> <span class='lbrace token'>{</span> <span class='dstring node'>&quot;stop() stopped engine '#{@service_name}'&quot;</span> <span class='rbrace token'>}</span>

  <span class='nil nil kw'>nil</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>