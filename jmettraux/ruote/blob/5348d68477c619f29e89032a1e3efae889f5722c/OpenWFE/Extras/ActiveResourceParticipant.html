<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jmettraux's ruote - Class: OpenWFE::Extras::ActiveResourceParticipant - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jmettraux/commits/ruote/master" rel="alternate" title="Recent Commits to ruote:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jmettraux", "ruote", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jmettraux", "ruote", "5348d68477c619f29e89032a1e3efae889f5722c", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jmettraux/ruote/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jmettraux/ruote/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jmettraux/ruote/network">Network</a></li>            
            <li class=""><a href="http://github.com/jmettraux/ruote/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jmettraux/ruote">Wiki</a></li>
            <li class=""><a href="http://github.com/jmettraux/ruote/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jmettraux/ruote">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jmettraux">jmettraux</a> / <b><a href="http://github.com/jmettraux/ruote/tree">ruote</a></b>        
                <a id="namespaces_button" rel="jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class OpenWFE_Extras_ActiveResourceParticipant">
  <h1>Class: OpenWFE::Extras::ActiveResourceParticipant</h1>
  <div class="section mixins">
  <h2>Included Modules</h2>
  <p><a title="OpenWFE::LocalParticipant" href="../LocalParticipant.html">OpenWFE::LocalParticipant</a></p>
</div><div class="section docstring">
  <p>
Ruote participant which does a REST call. It&#8217;s using ActiveResource
to do the actual magic. You can call every class and instance method
ActiveResource::Base and its mixins provide. You can also process the
response of the REST request and save some of its data into the workitem
for example.
</p>
<p>
Before using this participant you <b>really</b> should make yourself
familiar with ActiveResource and its usage.
</p>
<h2>Using it</h2>
<p>
The participant should be registered in the engine in a way like this:
</p>
<pre class="code">
  <span class='engine identifier id'>engine</span><span class='dot token'>.</span><span class='register_participant identifier id'>register_participant</span><span class='lparen token'>(</span>
    <span class='string val'>'reminder'</span><span class='comma token'>,</span>
    <span class='ActiveResourceParticipant constant id'>ActiveResourceParticipant</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
      <span class='lbrace token'>{</span>
        <span class='symbol val'>:site</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://localhost:7000'</span><span class='comma token'>,</span>
        <span class='symbol val'>:resource_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'story'</span><span class='comma token'>,</span>
        <span class='symbol val'>:method</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'put'</span><span class='comma token'>,</span> <span class='comment val'># we will use ActiveResource::CustomMethods::InstanceMethods#put</span>
        <span class='symbol val'>:argument</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'send_reminder'</span><span class='comma token'>,</span> <span class='comment val'># put is happy with just one</span>
                                      <span class='comment val'># parameter: The action to be</span>
                                      <span class='comment val'># called. So we won't have to use a</span>
                                      <span class='comment val'># block to set the arguments of the</span>
                                      <span class='comment val'># ActiveResource method to call.</span>
      <span class='rbrace token'>}</span>
    <span class='rparen token'>)</span>
  <span class='rparen token'>)</span>
</pre>
<p>
Let&#8217;s try a more complex example:
</p>
<pre class="code">
  <span class='engine identifier id'>engine</span><span class='dot token'>.</span><span class='register_participant identifier id'>register_participant</span><span class='lparen token'>(</span>
    <span class='string val'>'complex_ares'</span><span class='comma token'>,</span>
    <span class='ActiveResourceParticipant constant id'>ActiveResourceParticipant</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
      <span class='lbrace token'>{</span>
        <span class='symbol val'>:site</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://localhost:7000'</span><span class='comma token'>,</span>
        <span class='symbol val'>:resource_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'story'</span><span class='comma token'>,</span>
        <span class='symbol val'>:method</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'find'</span><span class='comma token'>,</span> <span class='comment val'># yes, even ActiveResource::Base#find method</span>
                           <span class='comment val'># may be used...</span>
        <span class='symbol val'>:response_handling</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='proc identifier id'>proc</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='response identifier id'>response</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='bitor op'>|</span> <span class='comment val'># define response</span>
                                                           <span class='comment val'># handling block</span>
          <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='set_attribute identifier id'>set_attribute</span><span class='lparen token'>(</span><span class='string val'>'title'</span><span class='comma token'>,</span> <span class='response identifier id'>response</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'title'</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
                           <span class='comment val'># The type of the response object depends on</span>
                           <span class='comment val'># the method you use!</span>
        <span class='end end kw'>end</span>
      <span class='rbrace token'>}</span>
    <span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='workitem identifier id'>workitem</span><span class='bitor op'>|</span> <span class='comment val'># define arguments to use with the find method</span>
      <span class='comment val'># each argument is an entry in an array the block has to return</span>
      <span class='lbrack token'>[</span>
         <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='lbrack token'>[</span><span class='string val'>'story_id'</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='comment val'># the first argument</span>
         <span class='lbrace token'>{</span><span class='symbol val'>:prefix</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'foo'</span><span class='rbrace token'>}</span> <span class='comment val'># the second one is an hash</span>
      <span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
  <span class='rparen token'>)</span>
</pre>
<p>
You can now use the participant in your workflow definitions. An example
using XML:
</p>
<pre class="code">
    <span class='lt op'>&lt;</span><span class='concurrence identifier id'>concurrence</span> <span class='count identifier id'>count</span><span class='assign token'>=</span><span class='string val'>&quot;1&quot;</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='participant identifier id'>participant</span> <span class='ref identifier id'>ref</span><span class='assign token'>=</span><span class='string val'>&quot;qa&quot;</span> <span class='div op'>/</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='cron identifier id'>cron</span> <span class='every identifier id'>every</span><span class='assign token'>=</span><span class='string val'>&quot;1m&quot;</span><span class='gt op'>&gt;</span>
        <span class='lt op'>&lt;</span><span class='participant identifier id'>participant</span>
          <span class='ref identifier id'>ref</span><span class='assign token'>=</span><span class='string val'>&quot;reminder&quot;</span>
          <span class='site identifier id'>site</span><span class='assign token'>=</span><span class='string val'>&quot;http://localhost:7000&quot;</span>
          <span class='resource_name identifier id'>resource_name</span><span class='assign token'>=</span><span class='string val'>&quot;story&quot;</span>
          <span class='method identifier id'>method</span><span class='assign token'>=</span><span class='string val'>&quot;put&quot;</span>
          <span class='action identifier id'>action</span><span class='assign token'>=</span><span class='string val'>&quot;send_reminder&quot;</span>
          <span class='resource_id identifier id'>resource_id</span><span class='assign token'>=</span><span class='string val'>&quot;${field:story_id}&quot;</span> <span class='div op'>/</span><span class='gt op'>&gt;</span>
      <span class='lt op'>&lt;</span><span class='regexp val'>/cron&gt;
    &lt;/</span><span class='concurrence identifier id'>concurrence</span><span class='gt op'>&gt;</span>
</pre>
<p>
Here, the ActiveResourceParticipant is used to send a reminder.
</p>
<p>
*Note:* prefer configuration of the participant at registration time,
information like &#8216;method&#8217;, &#8216;site&#8217; and
&#8216;resource_name&#8217; may clutter the process definition.
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(options, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <h2>options hash</h2>
<p>
You have to set some default options by passing an options hash to the new
method. It should contain the following keys:
</p>
<table>
<tr><td valign="top"><tt>:site</tt>:</td><td>The URI (as string) of the site where your REST

</td></tr>
</table>
<pre class="code">
  <span class='interface identifier id'>interface</span> <span class='sits identifier id'>sits</span><span class='dot token'>.</span> <span class='See constant id'>See</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='site identifier id'>site</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; parameter in ActiveResource::Base.
</span></pre>
<table>
<tr><td valign="top"><tt>:resource_name</tt>:</td><td>The name of the resource you like to access.

</td></tr>
</table>
<pre class="code">
  <span class='See constant id'>See</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='element_name identifier id'>element_name</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt; parameter in ActiveResource::Base.
</span></pre>
<table>
<tr><td valign="top"><tt>:method</tt>:</td><td>The ActiveResource method to call. In most cases

</td></tr>
</table>
<pre class="code">
  <span class='should identifier id'>should</span> <span class='be identifier id'>be</span> <span class='string val'>&quot;get&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;put&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;post&quot;</span> <span class='or or kw'>or</span> <span class='string val'>&quot;delete&quot;</span><span class='dot token'>.</span>
</pre>
<table>
<tr><td valign="top"><tt>:argument</tt>:</td><td>The first parameter which should be used as

</td></tr>
</table>
<pre class="code">
  <span class='argument identifier id'>argument</span> <span class='to identifier id'>to</span> <span class='the identifier id'>the</span> <span class='ActiveResource constant id'>ActiveResource</span> <span class='method identifier id'>method</span> <span class='which identifier id'>which</span> <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='called identifier id'>called</span><span class='dot token'>.</span> <span class='This constant id'>This</span> <span class='value identifier id'>value</span>
  <span class='is identifier id'>is</span> <span class='ignored identifier id'>ignored</span> <span class='if if_mod kw'>if</span> <span class='a identifier id'>a</span> <span class='block identifier id'>block</span> <span class='is identifier id'>is</span> <span class='given identifier id'>given</span> <span class='lparen token'>(</span><span class='see identifier id'>see</span> <span class='below identifier id'>below</span><span class='rparen token'>)</span>
</pre>
<table>
<tr><td valign="top"><tt>:resource_id</tt>:</td><td>The ID of the resource on which the action

</td></tr>
</table>
<pre class="code">
  <span class='should identifier id'>should</span> <span class='be identifier id'>be</span> <span class='called identifier id'>called</span> <span class='on identifier id'>on</span> <span class='default identifier id'>default</span><span class='dot token'>.</span> <span class='If constant id'>If</span> <span class='negative identifier id'>negative</span><span class='comma token'>,</span> <span class='nil nil kw'>nil</span> <span class='or or kw'>or</span> <span class='false false kw'>false</span><span class='comma token'>,</span> <span class='the identifier id'>the</span> <span class='action identifier id'>action</span>
  <span class='will identifier id'>will</span> <span class='be identifier id'>be</span> <span class='called identifier id'>called</span> <span class='on identifier id'>on</span> <span class='the identifier id'>the</span> <span class='complete identifier id'>complete</span> <span class='set identifier id'>set</span> <span class='of identifier id'>of</span> <span class='resources identifier id'>resources</span> <span class='instead identifier id'>instead</span> <span class='of identifier id'>of</span> <span class='on identifier id'>on</span> <span class='a identifier id'>a</span> <span class='single identifier id'>single</span>
  <span class='resource identifier id'>resource</span> <span class='determined identifier id'>determined</span> <span class='by identifier id'>by</span> <span class='its identifier id'>its</span> <span class='ID constant id'>ID</span><span class='dot token'>.</span>
</pre>
<table>
<tr><td valign="top"><tt>:response_handling</tt>:</td><td>A proc object / block which gets called

</td></tr>
</table>
<pre class="code">
  <span class='after identifier id'>after</span> <span class='the identifier id'>the</span> <span class='request identifier id'>request</span> <span class='is identifier id'>is</span> <span class='done identifier id'>done</span><span class='dot token'>.</span> <span class='It constant id'>It</span> <span class='gets identifier id'>gets</span> <span class='called identifier id'>called</span> <span class='with identifier id'>with</span> <span class='to identifier id'>to</span> <span class='arguments identifier id'>arguments</span><span class='colon op'>:</span> <span class='The constant id'>The</span>
  <span class='response identifier id'>response</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='ActiveResource constant id'>ActiveResource</span> <span class='method identifier id'>method</span> <span class='called identifier id'>called</span> <span class='and and kw'>and</span> <span class='the identifier id'>the</span> <span class='workitem identifier id'>workitem</span><span class='dot token'>.</span>
</pre>
<p>
The new method also takes a block. It may be used to set the arguments of
the ActiveResource method to call. The block must return an array of
arguments. The array will be splitted and each entry will be used as
argument to the ActiveResource method called. See
OpenWFE::LocalParticipant#call_block for the arguments the block itself
takes.
</p>
<p>
All parameters except response_handling and the block set default values
&#8212; you can always override them in the process definition. Just use
the corresponding symbol name (without &quot;:&quot;) as attribute.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/extras/participants/active_resource_participants.rb', line 149</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/extras/participants/active_resource_participants.rb#L149">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">149
150
151
152
153
154
155
156
157
158</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span> <span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>

  <span class='@options ivar id'>@options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span>

  <span class='comment val'># some defaults</span>
  <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:site</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='string val'>'http://127.0.0.1:3000'</span>
  <span class='@options ivar id'>@options</span><span class='lbrack token'>[</span><span class='symbol val'>:method</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='symbol val'>:get</span>

  <span class='@block ivar id'>@block</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#consume-instance_method">#consume</span><span class='args'>(workitem)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
This method is called each time the participant receives a workitem.
</p>

        
      </td>
    </tr>
  
</table><div class="included">
  
  <div>
    <h2>Public Instance Methods Included from <a title="OpenWFE::LocalParticipant" href="../LocalParticipant.html">OpenWFE::LocalParticipant</a></h2>
    <p><span class='name'><a title="call_block" href="../LocalParticipant.html#call_block-instance_method">call_block</a></span>, <span class='name'><a title="get_flow_expression" href="../LocalParticipant.html#get_flow_expression-instance_method">get_flow_expression</a></span>, <span class='name'><a title="reply_to_engine" href="../LocalParticipant.html#reply_to_engine-instance_method">reply_to_engine</a></span></p>
  </div>
  
</div>
<div class="clear"></div>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>consume</h3>
</div><div id="consume-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>consume</span><span class='args'>(workitem)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
This method is called each time the participant receives a workitem. It
calls the requested ActiveResource method, calls the response handling code
if present and then immediatly replies to the engine.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/openwfe/extras/participants/active_resource_participants.rb', line 165</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jmettraux/ruote/blob/5348d68477c619f29e89032a1e3efae889f5722c/lib/openwfe/extras/participants/active_resource_participants.rb#L165">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='consume identifier id'>consume</span> <span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>

  <span class='comment val'># use block to determine the method's arguments if given</span>
  <span class='args identifier id'>args</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='@block ivar id'>@block</span>
    <span class='call_block identifier id'>call_block</span><span class='lparen token'>(</span><span class='@block ivar id'>@block</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
  <span class='elsif elsif kw'>elsif</span> <span class='a identifier id'>a</span> <span class='assign token'>=</span> <span class='param identifier id'>param</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='symbol val'>:arg</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='param identifier id'>param</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='symbol val'>:argument</span><span class='rparen token'>)</span>
    <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='a identifier id'>a</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='lbrack token'>[</span><span class='rbrack token'>]</span> <span class='comment val'># no arguments</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># create new subclass of ActiveResource::Base</span>
  <span class='active_resource_class identifier id'>active_resource_class</span> <span class='assign token'>=</span> <span class='Class constant id'>Class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='ActiveResource constant id'>ActiveResource</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='rparen token'>)</span>
  <span class='active_resource_class identifier id'>active_resource_class</span><span class='dot token'>.</span><span class='site identifier id'>site</span> <span class='assign token'>=</span> <span class='param identifier id'>param</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='symbol val'>:site</span><span class='rparen token'>)</span> <span class='comment val'># set site parameter</span>
  <span class='active_resource_class identifier id'>active_resource_class</span><span class='dot token'>.</span><span class='element_name identifier id'>element_name</span> <span class='assign token'>=</span> <span class='param identifier id'>param</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='symbol val'>:resource_name</span><span class='rparen token'>)</span> <span class='comment val'># set element name</span>

  <span class='comment val'># Do we work on a single or on a set of resources? If resource_id is nil</span>
  <span class='comment val'># or negative, it's a set of resources.</span>

  <span class='resource_id identifier id'>resource_id</span> <span class='assign token'>=</span> <span class='param identifier id'>param</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='symbol val'>:resource_id</span><span class='rparen token'>)</span>

  <span class='active_resource identifier id'>active_resource</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='notop op'>!</span><span class='resource_id identifier id'>resource_id</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='resource_id identifier id'>resource_id</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='lt op'>&lt;</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='comment val'># set of resources</span>
    <span class='active_resource_class identifier id'>active_resource_class</span>
  <span class='else else kw'>else</span>
    <span class='comment val'># specific resource</span>
    <span class='active_resource_class identifier id'>active_resource_class</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:id</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='resource_id identifier id'>resource_id</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='response identifier id'>response</span> <span class='assign token'>=</span> <span class='active_resource identifier id'>active_resource</span><span class='dot token'>.</span><span class='send identifier id'>send</span><span class='lparen token'>(</span><span class='param identifier id'>param</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='symbol val'>:method</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='args identifier id'>args</span><span class='rparen token'>)</span>

  <span class='comment val'># we got our response, but what to do with it?</span>
  <span class='if if kw'>if</span> <span class='lparen token'>(</span><span class='h identifier id'>h</span> <span class='assign token'>=</span> <span class='param identifier id'>param</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='comma token'>,</span> <span class='symbol val'>:response_handling</span><span class='rparen token'>)</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Proc constant id'>Proc</span><span class='rparen token'>)</span>
    <span class='h identifier id'>h</span><span class='dot token'>.</span><span class='call identifier id'>call</span><span class='lparen token'>(</span><span class='response identifier id'>response</span><span class='comma token'>,</span> <span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='comment val'># reply to the engine</span>
  <span class='reply_to_engine identifier id'>reply_to_engine</span><span class='lparen token'>(</span><span class='workitem identifier id'>workitem</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>