<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" href="../style.css" type="text/css" charset="utf-8" />
<link rel="stylesheet" href="../syntax_highlight.css" type="text/css" charset="utf-8" />

    <script src="../jquery.js" type="text/javascript" charset="utf-8"></script>
    <script src="../app.js" type="text/javascript" charset="utf-8"></script>
    <title>Class: Xapit::IndexBlueprint</title>
  </head>
  <body>
    <div id="content">
      <div class="section class Xapit_IndexBlueprint">
  <h1 class="title">Class: Xapit::IndexBlueprint</h1>
  <div class="section docstring">
  <p>
This is the object used in the block of the xapit method in
Xapit::Membership. It keeps track of the index settings for a given class.
It also provides some indexing functionality.
</p>

</div><div class="section attributes">
  <h1>Attributes</h1>

  
    <div class="instance">
      <h2>Instance Attributes</h2>
      <table>
      
        <tr>
          <th class="name">facets</td>
          <td class="readwrite">
            [<span id='facets-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>facets</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">field_attributes</td>
          <td class="readwrite">
            [<span id='field_attributes-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>field_attributes</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">sortable_attributes</td>
          <td class="readwrite">
            [<span id='sortable_attributes-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>sortable_attributes</tt>.
</p>

            
          </td>
        </tr>
      
        <tr>
          <th class="name">text_attributes</td>
          <td class="readwrite">
            [<span id='text_attributes-instance_method'>R</span>W] 
          </td>
          <td class="visibility">
            public
          </td>
          <td class="docstring">
            <p>
Returns the value of attribute <tt>text_attributes</tt>.
</p>

            
          </td>
        </tr>
      
      </table>
    </div>
  
</div><div class="section constants">
  
</div><div class="section constructor">
<h1>Constructor Summary</h1>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'>(member_class, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


19
20
21
22
23
24
25
26
27
28
29</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 19</span>

<span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span><span class='lparen token'>(</span><span class='member_class identifier id'>member_class</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='@member_class ivar id'>@member_class</span> <span class='assign token'>=</span> <span class='member_class identifier id'>member_class</span>
  <span class='@args ivar id'>@args</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span>
  <span class='@text_attributes ivar id'>@text_attributes</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@field_attributes ivar id'>@field_attributes</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@sortable_attributes ivar id'>@sortable_attributes</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@facets ivar id'>@facets</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='@@instances ivar id'>@@instances</span> <span class='opasgn op'>||=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='@@instances ivar id'>@@instances</span><span class='lbrack token'>[</span><span class='member_class identifier id'>member_class</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='self self kw'>self</span> <span class='comment val'># TODO make this thread safe</span>
  <span class='@indexer ivar id'>@indexer</span> <span class='assign token'>=</span> <span class='SimpleIndexer constant id'>SimpleIndexer</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='self self kw'>self</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
</div>  <div class="section visibilitygroup public">
    <h1>Public Visibility</h1>
      <div class="section methodsummary class public">
    <h1>Public Class Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#index_all-class_method' title='index_all'>index_all</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Indexes all classes known to have an index blueprint defined.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
  <div class="section methodsummary instance public">
    <h1>Public Instance Method Summary</h1>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#facet-instance_method' title='#facet'>#facet</a></span><span class='args'>(*args, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds a facet attribute.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#field-instance_method' title='#field'>#field</a></span><span class='args'>(*attributes)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds a field attribute.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#index_all-instance_method' title='#index_all'>#index_all</a></span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Indexes all records of this blueprint class.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#sortable-instance_method' title='#sortable'>#sortable</a></span><span class='args'>(*attributes)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds a sortable attribute for use with the :order option in a search call.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#sortable_position_for-instance_method' title='#sortable_position_for'>#sortable_position_for</a></span><span class='args'>(sortable_attribute)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href='#text-instance_method' title='#text'>#text</a></span><span class='args'>(*attributes, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Adds a text attribute.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails class public">
  <h1>Public Class Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>index_all</h3>
</div><div id="index_all-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>index_all</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Indexes all classes known to have an index blueprint defined.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


11
12
13
14
15
16
17</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 11</span>

<span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='index_all identifier id'>index_all</span>
  <span class='load_models identifier id'>load_models</span>
  <span class='@@instances ivar id'>@@instances</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='member_class identifier id'>member_class</span><span class='comma token'>,</span> <span class='blueprint identifier id'>blueprint</span><span class='bitor op'>|</span>
    <span class='yield yield kw'>yield</span><span class='lparen token'>(</span><span class='member_class identifier id'>member_class</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='block_given? fid id'>block_given?</span>
    <span class='blueprint identifier id'>blueprint</span><span class='dot token'>.</span><span class='index_all identifier id'>index_all</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div><div class="section methoddetails instance public">
  <h1>Public Instance Method Details</h1>
  
    <div class="method">
      <div class="method_header">
  <h3>facet</h3>
</div><div id="facet-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>facet</span><span class='args'>(*args, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds a facet attribute. See Xapit::FacetBlueprint and Xapit::Facet for
details.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


58
59
60</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 58</span>

<span class='def def kw'>def</span> <span class='facet identifier id'>facet</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='@facets ivar id'>@facets</span> <span class='lshft op'>&lt;&lt;</span> <span class='FacetBlueprint constant id'>FacetBlueprint</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@member_class ivar id'>@member_class</span><span class='comma token'>,</span> <span class='@facets ivar id'>@facets</span><span class='dot token'>.</span><span class='size identifier id'>size</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>field</h3>
</div><div id="field-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>field</span><span class='args'>(*attributes)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds a field attribute. Field terms are not split by word so it is not
designed for full text search. Instead you can filter through a field using
the :conditions hash in a search query.
</p>
<pre class="code">
  <span class='Article constant id'>Article</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span> <span class='symbol val'>:priority</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>5</span> <span class='rbrace token'>}</span><span class='rparen token'>)</span>
</pre>
<p>
Multiple field values are supported if the given attribute is an array.
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='priority identifier id'>priority</span>
    <span class='lbrack token'>[</span><span class='integer val'>3</span><span class='comma token'>,</span> <span class='integer val'>5</span><span class='rbrack token'>]</span> <span class='comment val'># will match priority search for 3 or 5</span>
  <span class='end end kw'>end</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


53
54
55</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 53</span>

<span class='def def kw'>def</span> <span class='field identifier id'>field</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attributes identifier id'>attributes</span><span class='rparen token'>)</span>
  <span class='@field_attributes ivar id'>@field_attributes</span> <span class='opasgn op'>+=</span> <span class='attributes identifier id'>attributes</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>index_all</h3>
</div><div id="index_all-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>index_all</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Indexes all records of this blueprint class. It does this using the
&quot;.find_each&quot; method on the member class. You will likely want to
call Xapit::Config.remove_database before this.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


69
70
71
72
73</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 69</span>

<span class='def def kw'>def</span> <span class='index_all identifier id'>index_all</span>
  <span class='@member_class ivar id'>@member_class</span><span class='dot token'>.</span><span class='find_each identifier id'>find_each</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='@args ivar id'>@args</span><span class='rparen token'>)</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='member identifier id'>member</span><span class='bitor op'>|</span>
    <span class='@indexer ivar id'>@indexer</span><span class='dot token'>.</span><span class='add_member identifier id'>add_member</span><span class='lparen token'>(</span><span class='member identifier id'>member</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sortable</h3>
</div><div id="sortable-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sortable</span><span class='args'>(*attributes)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds a sortable attribute for use with the :order option in a search call.
</p>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


63
64
65</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 63</span>

<span class='def def kw'>def</span> <span class='sortable identifier id'>sortable</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attributes identifier id'>attributes</span><span class='rparen token'>)</span>
  <span class='@sortable_attributes ivar id'>@sortable_attributes</span> <span class='opasgn op'>+=</span> <span class='attributes identifier id'>attributes</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>sortable_position_for</h3>
</div><div id="sortable_position_for-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>sortable_position_for</span><span class='args'>(sortable_attribute)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


75
76
77
78
79</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 75</span>

<span class='def def kw'>def</span> <span class='sortable_position_for identifier id'>sortable_position_for</span><span class='lparen token'>(</span><span class='sortable_attribute identifier id'>sortable_attribute</span><span class='rparen token'>)</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='sortable_attributes identifier id'>sortable_attributes</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:to_s</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='index identifier id'>index</span><span class='lparen token'>(</span><span class='sortable_attribute identifier id'>sortable_attribute</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;Unable to find indexed sortable attribute \&quot;#{sortable_attribute}\&quot; in #{@member_class} sortable attributes: #{sortable_attributes.inspect}&quot;</span> <span class='if if_mod kw'>if</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
  <span class='index identifier id'>index</span> <span class='plus op'>+</span> <span class='facets identifier id'>facets</span><span class='dot token'>.</span><span class='size identifier id'>size</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>text</h3>
</div><div id="text-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>text</span><span class='args'>(*attributes, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Adds a text attribute. Each word in the text will be indexed as a separate
term allowing full text searching. Text terms are what is searched by the
primary string in a search query.
</p>
<pre class="code">
  <span class='Article constant id'>Article</span><span class='dot token'>.</span><span class='search identifier id'>search</span><span class='lparen token'>(</span><span class='string val'>&quot;kite&quot;</span><span class='rparen token'>)</span>
</pre>

</div><div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="source_code">
    <table>
      <tr>
        <td>
          <pre class="lines">


36
37
38
39
40</pre>
        </td>
        <td>
          <pre class="code"><span class="info file"># File 'lib/xapit/index_blueprint.rb', line 36</span>

<span class='def def kw'>def</span> <span class='text identifier id'>text</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='attributes identifier id'>attributes</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='attribute identifier id'>attribute</span><span class='bitor op'>|</span>
    <span class='@text_attributes ivar id'>@text_attributes</span><span class='lbrack token'>[</span><span class='attribute identifier id'>attribute</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='block identifier id'>block</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre>
        </td>
      </tr>
    </table>
  </div>
</div>
</div>
    </div>
  
</div>
  </div>

</div>
    </div>
  </body>
</html>