<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>lardawge's rfm - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/lardawge/commits/rfm/master" rel="alternate" title="Recent Commits to rfm:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("lardawge", "rfm", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='lardawge/rfm/blob/ba9c35a0f85a26225041e79604a6269eedb2986b' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='lardawge/rfm/blob/ba9c35a0f85a26225041e79604a6269eedb2986b' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("lardawge", "rfm", "ba9c35a0f85a26225041e79604a6269eedb2986b", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/lardawge/rfm/tree/">Source</a></li>
            <li class=""><a href="http://github.com/lardawge/rfm/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/lardawge/rfm/network">Network</a></li>            
            <li class=""><a href="http://github.com/lardawge/rfm/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/lardawge/rfm">Wiki</a></li>
            <li class=""><a href="http://github.com/lardawge/rfm/graphs">Graphs</a></li>                    
            <li class="active"><a href="/lardawge/rfm">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/lardawge">lardawge</a> / <b><a href="http://github.com/lardawge/rfm/tree">rfm</a></b>        
                <a id="namespaces_button" rel="lardawge/rfm/blob/ba9c35a0f85a26225041e79604a6269eedb2986b" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="lardawge/rfm/blob/ba9c35a0f85a26225041e79604a6269eedb2986b" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>Rfm</h1>
<p>
Rfm was primarily designed by Six Fried Rice co-founder Geoff Coffey.
</p>
<p>
Other lead contributors:
</p>
<ul>
<li>Mufaddal Khumri helped architect Rfm in the most ruby-like way possible. He
also contributed the outstanding error handling code and a comprehensive
hierarchy of error classes.

</li>
<li>Atsushi Matsuo was an early Rfm tester, and provided outstanding feedback,
critical code fixes, and a lot of web exposure.

</li>
<li>Jesse Antunes helped ensure that Rfm is stable and functional.

</li>
</ul>
<p>
Rdoc location: http://rdoc.info/projects/lardawge/rfm
</p>
<h2>Installation</h2>
<p>
Run the following if you haven&#8217;t already:
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='sources identifier id'>sources</span> <span class='minus op'>-</span><span class='a identifier id'>a</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
</span></pre>
<p>
Followed by:
</p>
<pre class="code">
  <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='lardawge identifier id'>lardawge</span><span class='minus op'>-</span><span class='rfm identifier id'>rfm</span>
</pre>
<p>
Once the gem is installed, you can use rfm in your ruby scripts by
requiring it:
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'rubygems'</span>
  <span class='require identifier id'>require</span> <span class='string val'>'rfm'</span>
</pre>
<h2>Connecting</h2>
<p>
IMPORTANT:SSL and Certificate verification are on by default. Please see
Server#new in rdocs for explanation and setup. You connect with the
Rfm::Server object. This little buddy will be your window into FileMaker
data.
</p>
<pre class="code">
  <span class='require identifier id'>require</span> <span class='string val'>'rfm/rfm'</span>

  <span class='my_server identifier id'>my_server</span> <span class='assign token'>=</span> <span class='Rfm constant id'>Rfm</span><span class='colon2 op'>::</span><span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
    <span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'myservername'</span><span class='comma token'>,</span>
    <span class='symbol val'>:username</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'user'</span><span class='comma token'>,</span>
    <span class='symbol val'>:password</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'pw'</span><span class='comma token'>,</span>
                <span class='symbol val'>:ssl</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
  <span class='rparen token'>)</span>
</pre>
<p>
if your web publishing engine runs on a port other than 80, you can provide
the port number as well:
</p>
<pre class="code">
  <span class='my_server identifier id'>my_server</span> <span class='assign token'>=</span> <span class='Rfm constant id'>Rfm</span><span class='colon2 op'>::</span><span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
    <span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'myservername'</span><span class='comma token'>,</span>
    <span class='symbol val'>:username</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'user'</span><span class='comma token'>,</span>
    <span class='symbol val'>:password</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'pw'</span><span class='comma token'>,</span>
    <span class='symbol val'>:port</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>8080</span><span class='comma token'>,</span>
                <span class='symbol val'>:ssl</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
  <span class='rparen token'>)</span>
</pre>
<h2>Databases and Layouts</h2>
<p>
All access to data in FileMaker&#8217;s XML interface is done through
layouts, and layouts live in databases. The Rfm::Server object has a
collection of databases called &#8216;db&#8217;. So to get ahold of a
database called &quot;My Database&quot;, you can do this:
</p>
<pre class="code">
  <span class='my_db identifier id'>my_db</span> <span class='assign token'>=</span> <span class='my_server identifier id'>my_server</span><span class='dot token'>.</span><span class='db identifier id'>db</span><span class='lbrack token'>[</span><span class='string val'>&quot;My Database&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
As a convenience, you can do this too:
</p>
<pre class="code">
  <span class='my_db identifier id'>my_db</span> <span class='assign token'>=</span> <span class='my_server identifier id'>my_server</span><span class='lbrack token'>[</span><span class='string val'>&quot;My Database&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
Finally, if you want to introspect the server and find out what databases
are available, you can do this:
</p>
<pre class="code">
  <span class='all_dbs identifier id'>all_dbs</span> <span class='assign token'>=</span> <span class='my_server identifier id'>my_server</span><span class='dot token'>.</span><span class='db identifier id'>db</span><span class='dot token'>.</span><span class='all identifier id'>all</span>
</pre>
<p>
In any case, you get back Rfm::Database objects. A database object in turn
has a property called &quot;layout&quot;:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span> <span class='assign token'>=</span> <span class='my_db identifier id'>my_db</span><span class='dot token'>.</span><span class='layout identifier id'>layout</span><span class='lbrack token'>[</span><span class='string val'>&quot;My Layout&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
Again, for convenience:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span> <span class='assign token'>=</span> <span class='my_db identifier id'>my_db</span><span class='lbrack token'>[</span><span class='string val'>&quot;My Layout&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
And to get them all:
</p>
<pre class="code">
  <span class='all_layouts identifier id'>all_layouts</span> <span class='assign token'>=</span> <span class='my_db identifier id'>my_db</span><span class='dot token'>.</span><span class='layout identifier id'>layout</span><span class='dot token'>.</span><span class='all identifier id'>all</span>
</pre>
<p>
Bringing it all together, you can do this to go straight from a server to a
specific layout:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span> <span class='assign token'>=</span> <span class='my_server identifier id'>my_server</span><span class='lbrack token'>[</span><span class='string val'>&quot;My Database&quot;</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;My Layout&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
NOTE: for the ruby experts, Rfm::Server#db is an
Rfm::Factory::DatabaseFactory object, which is just a fancied up Hash. So
anything you can do with a hash, you can also do with my_server.db. The
same goes for my_db.layouts, which is an Rfm::Factory::LayoutFactory.
</p>
<h2>Working with Layouts</h2>
<p>
Once you have a layout object, you can start doing some real work. To get
every record from the layout:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='all identifier id'>all</span>   <span class='comment val'># be careful with this</span>
</pre>
<p>
To get a random record:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='any identifier id'>any</span>
</pre>
<p>
To find every record with &quot;Arizona&quot; in the &quot;State&quot;
field:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='string val'>&quot;State&quot;</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Arizona&quot;</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
</pre>
<p>
To add a new record with my personal info:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='lbrace token'>{</span>
    <span class='symbol val'>:first_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Geoff&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:last_name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Coffey&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:email</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;gwcoffey@gmail.com&quot;</span><span class='rbrace token'>}</span>
  <span class='rparen token'>)</span>
</pre>
<p>
Notice that in this case I used symbols instead of strings for the hash
keys. The API will accept either form, so if your field names don&#8217;t
have whitespace or punctuation, you might prefer the symbol notation.
</p>
<p>
To edit the record whos recid (filemaker internal record id) is 200:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='edit identifier id'>edit</span><span class='lparen token'>(</span><span class='integer val'>200</span><span class='comma token'>,</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='geq op'>&gt;=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='string val'>'Mamie'</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;)
</span></pre>
<p>
Note: See the &quot;Record Objects&quot; section below for more on editing
records.
</p>
<p>
To delete the record whose recid is 200:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='integer val'>200</span><span class='rparen token'>)</span>
</pre>
<p>
All of these methods return an Rfm::Result::ResultSet object (see below),
and every one of them takes an optional parameter (the very last one) with
additional options. For example, to find just a page full of records, you
can do this:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='symbol val'>:state</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;AZ&quot;</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='geq op'>&gt;=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='integer val'>10</span><span class='comma token'>,</span> <span class='symbol val'>:skip_records</span> <span class='assign token'>=</span><span class='bitand op'>&amp;</span><span class='gt identifier id'>gt</span><span class='semicolon token'>;</span> <span class='integer val'>100</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;)
</span></pre>
<p>
For a complete list of the available options, see the
&quot;expand_options&quot; method in the Rfm::Server object in the file
named rfm_command.rb.
</p>
<p>
Finally, if filemaker returns an error when executing any of these methods,
an error will be raised in your ruby script. There is one exception to
this, though. If a find results in no records being found (FileMaker error
# 401) I just ignore it and return you a ResultSet with zero records in it.
If you prefer an error in this case, add :raise_on_401 =&gt; true to the
options you pass the Rfm::Server when you create it.
</p>
<h2>ResultSet and Record Objects</h2>
<p>
Any method on the Layout object that returns data will return a ResultSet
object. Rfm::Result::ResultSet is a subclass of Array, so first and
foremost, you can use it like any other array:
</p>
<pre class="code">
  <span class='my_result identifier id'>my_result</span> <span class='assign token'>=</span> <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='any identifier id'>any</span>
  <span class='my_result identifier id'>my_result</span><span class='dot token'>.</span><span class='size identifier id'>size</span>  <span class='comment val'># returns '1'</span>
  <span class='my_result identifier id'>my_result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>    <span class='comment val'># returns the first record (an Rfm::Result::Record object)</span>
</pre>
<p>
The ResultSet object also tells you information about the fields and
portals in the result. ResultSet#fields and ResultSet#portals are both
standard ruby hashes, with strings for keys. The fields hash has
Rfm::Result::Field objects for values. The portals hash has another hash
for its values. This nested hash is the fields on the portal. This would
print out all the field names:
</p>
<pre class="code">
  <span class='my_result identifier id'>my_result</span><span class='dot token'>.</span><span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='field identifier id'>field</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
</pre>
<p>
This would print out the tables each portal on the layout is associated
with. Below each table name, and indented, it will print the names of all
the fields on each portal.
</p>
<pre class="code">
  <span class='my_result identifier id'>my_result</span><span class='dot token'>.</span><span class='portals identifier id'>portals</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='table identifier id'>table</span><span class='comma token'>,</span> <span class='fields identifier id'>fields</span><span class='bitor op'>|</span>
    <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;table: #{table}&quot;</span>
    <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='field identifier id'>field</span><span class='bitor op'>|</span> <span class='puts identifier id'>puts</span> <span class='dstring node'>&quot;\t#{name}&quot;</span><span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span>
</pre>
<p>
But most importantly, the ResultSet contains record objects.
Rfm::Result::Record is a subclass of Hash, so it can be used in many
standard ways. This code would print the value in the
&#8216;first_name&#8217; field in the first record of the ResultSet:
</p>
<pre class="code">
  <span class='my_record identifier id'>my_record</span> <span class='assign token'>=</span> <span class='my_result identifier id'>my_result</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>
  <span class='puts identifier id'>puts</span> <span class='my_record identifier id'>my_record</span><span class='lbrack token'>[</span><span class='string val'>&quot;first_name&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
As a convenience, if your field names are valid ruby method names (ie, they
don&#8217;t have spaces or odd punctuation in them), you can do this
instead:
</p>
<pre class="code">
  <span class='puts identifier id'>puts</span> <span class='my_record identifier id'>my_record</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span>
</pre>
<p>
Since ResultSets are arrays and Records are hashes, you can take advantage
of Ruby&#8217;s wonderful expressiveness. For example, to get a
comma-separated list of the full names of all the people in California, you
could do this:
</p>
<pre class="code">
  <span class='my_layout identifier id'>my_layout</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='lbrace token'>{</span><span class='symbol val'>:state</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'CA'</span><span class='rbrace token'>}</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='collect identifier id'>collect</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='bitand op'>&amp;</span><span class='quot identifier id'>quot</span><span class='semicolon token'>;</span><span class='comment val'>#{rec.first_name&lt;/tt&gt; #{rec.last_name}&quot;}.join(&quot;, &quot;)</span>
</pre>
<p>
Record objects can also be edited:
</p>
<pre class="code">
  <span class='my_record identifier id'>my_record</span><span class='dot token'>.</span><span class='first_name identifier id'>first_name</span> <span class='assign token'>=</span> <span class='string val'>'Isabel'</span>
</pre>
<p>
Once you have made a series of edits, you can save them back to the
database like this:
</p>
<pre class="code">
  <span class='my_record identifier id'>my_record</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
</pre>
<p>
The save operation causes the record to be reloaded from the database, so
any changes that have been made outside your script will also be picked up
after the save.
</p>
<p>
If you want to detect concurrent modification, you can do this instead:
</p>
<pre class="code">
  <span class='my_record identifier id'>my_record</span><span class='dot token'>.</span><span class='save_if_not_modified identifier id'>save_if_not_modified</span>
</pre>
<p>
This version will refuse to update the database and raise an error if the
record was modified after it was loaded but before it was saved.
</p>
<p>
Record objects also have portals. While the portals in a ResultSet tell you
about the tables and fields the portals show, the portals in a Record have
the actual data. For example, if an Order record has Line Item records, you
could do this:
</p>
<pre class="code">
  <span class='my_order identifier id'>my_order</span> <span class='assign token'>=</span> <span class='order_layout identifier id'>order_layout</span><span class='dot token'>.</span><span class='any identifier id'>any</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span>  <span class='comment val'># the [0] is important!</span>
  <span class='my_lines identifier id'>my_lines</span> <span class='assign token'>=</span> <span class='my_order identifier id'>my_order</span><span class='dot token'>.</span><span class='portals identifier id'>portals</span><span class='lbrack token'>[</span><span class='string val'>&quot;Line Items&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
At the end of the previous block of code, my_lines is an array of Record
objects. In this case, they are the records in the &quot;Line Items&quot;
portal for the particular order record. You can then operate on them as you
would any other record.
</p>
<p>
NOTE: Fields on a portal have the table name and the &quot;::&quot;
stripped off of their names if they belong to the table the portal is tied
to. In other words, if our &quot;Line Items&quot; portal includes a
quantity field and a price field, you would do this:
</p>
<pre class="code">
  <span class='my_lines identifier id'>my_lines</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;Quantity&quot;</span><span class='rbrack token'>]</span>
  <span class='my_lines identifier id'>my_lines</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;Price&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
You would NOT do this:
</p>
<pre class="code">
  <span class='my_lines identifier id'>my_lines</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;Line Items::Quantity&quot;</span><span class='rbrack token'>]</span>
  <span class='my_lines identifier id'>my_lines</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='string val'>&quot;Line Items::Quantity&quot;</span><span class='rbrack token'>]</span>
</pre>
<p>
My feeling is that the table name is redundant and cumbersome if it is the
same as the portal&#8217;s table. This is also up for debate.
</p>
<p>
Again, you can string things together with Ruby. This will calculate the
total dollar amount of the order:
</p>
<pre class="code">
  <span class='total identifier id'>total</span> <span class='assign token'>=</span> <span class='integer val'>0</span><span class='integer val'>.0</span>
  <span class='my_order identifier id'>my_order</span><span class='dot token'>.</span><span class='portals identifier id'>portals</span><span class='lbrack token'>[</span><span class='string val'>&quot;Line Items&quot;</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lt op'>&lt;</span><span class='tt identifier id'>tt</span><span class='gt op'>&gt;</span><span class='total identifier id'>total</span> <span class='opasgn op'>+=</span> <span class='line identifier id'>line</span><span class='dot token'>.</span><span class='quantity identifier id'>quantity</span> <span class='mult op'>*</span> <span class='line identifier id'>line</span><span class='dot token'>.</span><span class='price identifier id'>price</span><span class='lt op'>&lt;</span><span class='regexp val'>/tt&gt;
</span></pre>
<p>
I intend to add a &#8216;delete&#8217; method to the Record class as well,
but I haven&#8217;t done this yet. Finally, should you be able to create
new records using the Record class? I&#8217;m not sure&#8230;lots of points
to consider on this.
</p>
<h2>Data Types</h2>
<p>
FileMaker&#8217;s field types are coerced to Ruby types thusly:
</p>
<pre class="code">
  <span class='Text constant id'>Text</span> <span class='Field constant id'>Field</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='String constant id'>String</span> <span class='object identifier id'>object</span>
  <span class='Number constant id'>Number</span> <span class='Field constant id'>Field</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='BigDecimal constant id'>BigDecimal</span> <span class='object identifier id'>object</span>  <span class='comment val'># see below</span>
  <span class='Date constant id'>Date</span> <span class='Field constant id'>Field</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='Date constant id'>Date</span> <span class='object identifier id'>object</span>
  <span class='Time constant id'>Time</span> <span class='Field constant id'>Field</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='DateTime constant id'>DateTime</span> <span class='object identifier id'>object</span> <span class='comment val'># see below</span>
  <span class='TimeStamp constant id'>TimeStamp</span> <span class='Field constant id'>Field</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='DateTime constant id'>DateTime</span> <span class='object identifier id'>object</span>
  <span class='Container constant id'>Container</span> <span class='Field constant id'>Field</span> <span class='minus op'>-</span><span class='gt op'>&gt;</span> <span class='URI constant id'>URI</span> <span class='object identifier id'>object</span>
</pre>
<p>
FileMaker&#8217;s number field is insanely robust. The only data type in
ruby that can handle the same magnitude and precision of a FileMaker number
is Ruby&#8217;s BigDecimal. (This is an extension class, so you have to
require &#8216;bigdecimal&#8217; to use it yourself). Unfortuantely,
BigDecimal is not a &quot;normal&quot; ruby numeric class, so it might be
really annoying that your tiny filemaker numbers have to go this route.
This is a great topic for debate.
</p>
<p>
Also, Ruby doesn&#8217;t have a Time type that stores just a normal time
(with no date attached). The Time class in ruby is a lot like DateTime, or
a Timestamp in FileMaker. When I get a Time field from FileMaker, I turn it
into a DateTime object, and set its date to the oldest date Ruby supports.
You can still compare these in all the normal ways, so this should be fine,
but it will look weird if you, ie, to_s one and see an odd date attached to
your time.
</p>
<p>
Finally, container fields will come back as URI objects. You can:
</p>
<pre class="code">
  <span class='minus op'>-</span> <span class='use identifier id'>use</span> <span class='Net constant id'>Net</span><span class='colon2 op'>::</span><span class='HTTP constant id'>HTTP</span> <span class='to identifier id'>to</span> <span class='download identifier id'>download</span> <span class='the identifier id'>the</span> <span class='contents identifier id'>contents</span> <span class='of identifier id'>of</span> <span class='the identifier id'>the</span> <span class='container identifier id'>container</span> <span class='field identifier id'>field</span> <span class='using identifier id'>using</span> <span class='this identifier id'>this</span> <span class='URI constant id'>URI</span>
  <span class='minus op'>-</span> <span class='to_s identifier id'>to_s</span> <span class='the identifier id'>the</span> <span class='URI constant id'>URI</span> <span class='and and kw'>and</span> <span class='use identifier id'>use</span> <span class='it identifier id'>it</span> <span class='as identifier id'>as</span> <span class='the identifier id'>the</span> <span class='src identifier id'>src</span> <span class='attribute identifier id'>attribute</span> <span class='of identifier id'>of</span> <span class='an identifier id'>an</span> <span class='HTML constant id'>HTML</span> <span class='image identifier id'>image</span> <span class='tag identifier id'>tag</span>
  <span class='minus op'>-</span> <span class='etc identifier id'>etc</span><span class='dot3 op'>...</span>
</pre>
<p>
Specifically, the URI refers to the <em>contents</em> of the container
field. When accessed, the file, picture, or movie in the field will be
downloaded.
</p>
<h2>Troubleshooting</h2>
<p>
There are two cheesy methods to help track down problems. When you create a
server object, you can provide two additional optional parameters:
</p>
<p>
:log_actions When this is &#8216;true&#8217; your script will write every
URL it sends to the web publishing engine to standard out. For the rails
users, this means the action url will wind up in your WEBrick or Mongrel
log. If you can&#8217;t make sense of what you&#8217;re getting, you might
try copying the URL into your browser to see what is actually coming back
from FileMaker.
</p>
<p>
:log_responses When this is &#8216;true&#8217; your script will dump the
actual response it got from FileMaker to standard out (again, in rails,
check your logs).
</p>
<p>
So, for an annoying, but detailed load of output, make a connection like
this:
</p>
<pre class="code">
  <span class='my_server identifier id'>my_server</span> <span class='assign token'>=</span> <span class='Rfm constant id'>Rfm</span><span class='colon2 op'>::</span><span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>
    <span class='symbol val'>:host</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'myservername'</span><span class='comma token'>,</span>
    <span class='symbol val'>:username</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'user'</span><span class='comma token'>,</span>
    <span class='symbol val'>:password</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'pw'</span><span class='comma token'>,</span>
    <span class='symbol val'>:log_actions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
    <span class='symbol val'>:log_responses</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='rparen token'>)</span>
</pre>
<p>
These options will change in the future. They&#8217;re only there now as a
quick-easy way for me to track down problems. I&#8217;m open to suggestions
for what kind of login options will make sense in the final release.
</p>
<h2>Copyright</h2>
<p>
Copyright &#169; 2007 Six Fried Rice, LLC and Mufaddal Khumr. See LICENSE
for details.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>