<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jkraemer's acts_as_ferret - Module: ActsAsFerret - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jkraemer/commits/acts_as_ferret/master" rel="alternate" title="Recent Commits to acts_as_ferret:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jkraemer", "acts_as_ferret", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jkraemer", "acts_as_ferret", "2a9969a832fa6eb6dc34a962173edfa84e1e8783", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/network">Network</a></li>            
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jkraemer/acts_as_ferret">Wiki</a></li>
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jkraemer/acts_as_ferret">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jkraemer">jkraemer</a> / <b><a href="http://github.com/jkraemer/acts_as_ferret/tree">acts_as_ferret</a></b>        
                <a id="namespaces_button" rel="jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section module ActsAsFerret">
  <h1>Module: ActsAsFerret</h1>
  <div class="section constants">
  <div class="thisclass">
  <h2>Constants</h2>
  <dl>
    
      <dt id="DEFAULT_FIELD_OPTIONS-constant">DEFAULT_FIELD_OPTIONS</dt>
      <dd>{
  :store       =&gt; :no, 
  :highlight   =&gt; :yes, 
  :index       =&gt; :yes, 
  :term_vector =&gt; :with_positions_offsets,
  :boost       =&gt; 1.0
}</dd>
    
  </dl>
</div>

</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Class Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#append_features-class_method">append_features</span><span class='args'>(base)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#build_field_config-class_method">build_field_config</span><span class='args'>(fields)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#change_index_dir-class_method">change_index_dir</span><span class='args'>(name, new_dir)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#close_multi_indexes-class_method">close_multi_indexes</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#combine_conditions-class_method">combine_conditions</span><span class='args'>(conditions, additional_conditions = [])</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
combine our conditions with those given by user, if any.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#conditions_for_model-class_method">conditions_for_model</span><span class='args'>(model, conditions = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
check for per-model conditions and return these if provided.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#create_index_instance-class_method">create_index_instance</span><span class='args'>(definition)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
creates a new Index instance.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#define_index-class_method">define_index</span><span class='args'>(name, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
Globally declares an index.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ensure_directory-class_method">ensure_directory</span><span class='args'>(dir)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ferret_indexes-class_method">ferret_indexes</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#field_infos-class_method">field_infos</span><span class='args'>(index_definition)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
builds a FieldInfos instance for creation of an index.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#filter_include_list_for_model-class_method">filter_include_list_for_model</span><span class='args'>(model, include_options)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#find-class_method">find</span><span class='args'>(query, models_or_index_name, options = {}, ar_options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
models_or_index_name may be an index name as declared in config/aaf.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#find_ids-class_method">find_ids</span><span class='args'>(query, models_or_index_name, options = {}, &amp;block)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
find ids of records.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#find_index-class_method">find_index</span><span class='args'>(models_or_index_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns an index instance suitable for searching/updating the named index.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#find_last_index_version-class_method">find_last_index_version</span><span class='args'>(basedir)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
find the most recent version of an index.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_index-class_method">get_index</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns the index with the given name.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#get_index_for-class_method">get_index_for</span><span class='args'>(*classes)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns the index used by the given class.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#index_using_classes-class_method">index_using_classes</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#init_index_basedir-class_method">init_index_basedir</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
make sure the default index base dir exists.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#load_config-class_method">load_config</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#multi_index-class_method">multi_index</span><span class='args'>(indexes)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
returns a MultiIndex instance operating on a MultiReader.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#multi_indexes-class_method">multi_indexes</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#raise_drb_errors-3F-class_method">raise_drb_errors?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#rebuild_index-class_method">rebuild_index</span><span class='args'>(name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#register_class_with_index-class_method">register_class_with_index</span><span class='args'>(clazz, index_name, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
called internally by the acts_as_ferret method.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#remote-3F-class_method">remote?</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#retrieve_records-class_method">retrieve_records</span><span class='args'>(id_arrays, find_options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
retrieves search result records from a data structure like this: {
&#8216;Model1&#8217; =&gt; { &#8216;1&#8217; =&gt; [ rank, score ],
&#8216;2&#8217; =&gt; [ rank, score ] }.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#total_hits-class_method">total_hits</span><span class='args'>(query, models_or_index_name, options = {})</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
count hits for a query.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Class Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>append_features</h3>
</div><div id="append_features-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>append_features</span><span class='args'>(base)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 525</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L525">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">525
526
527
528</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='append_features identifier id'>append_features</span><span class='lparen token'>(</span><span class='base identifier id'>base</span><span class='rparen token'>)</span>
  <span class='super super kw'>super</span>
  <span class='base identifier id'>base</span><span class='dot token'>.</span><span class='extend identifier id'>extend</span><span class='lparen token'>(</span><span class='ClassMethods constant id'>ClassMethods</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>build_field_config</h3>
</div><div id="build_field_config-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>build_field_config</span><span class='args'>(fields)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 498</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L498">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">498
499
500
501
502
503
504
505
506
507
508</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='build_field_config identifier id'>build_field_config</span><span class='lparen token'>(</span><span class='fields identifier id'>fields</span><span class='rparen token'>)</span>
  <span class='field_config identifier id'>field_config</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span>
  <span class='case case kw'>case</span> <span class='fields identifier id'>fields</span>
  <span class='when when kw'>when</span> <span class='Array constant id'>Array</span>
    <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='bitor op'>|</span> <span class='field_config identifier id'>field_config</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='field_config_for identifier id'>field_config_for</span> <span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
  <span class='when when kw'>when</span> <span class='Hash constant id'>Hash</span>
    <span class='fields identifier id'>fields</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='bitor op'>|</span> <span class='field_config identifier id'>field_config</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='field_config_for identifier id'>field_config_for</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span> <span class='raise identifier id'>raise</span> <span class='InvalidArgumentError constant id'>InvalidArgumentError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;:fields option must be Hash or Array&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span> <span class='if if_mod kw'>if</span> <span class='fields identifier id'>fields</span>
  <span class='return return kw'>return</span> <span class='field_config identifier id'>field_config</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>change_index_dir</h3>
</div><div id="change_index_dir-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>change_index_dir</span><span class='args'>(name, new_dir)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 389</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L389">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">389
390
391</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='change_index_dir identifier id'>change_index_dir</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='new_dir identifier id'>new_dir</span><span class='rparen token'>)</span>
  <span class='get_index identifier id'>get_index</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='change_index_dir identifier id'>change_index_dir</span> <span class='new_dir identifier id'>new_dir</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>close_multi_indexes</h3>
</div><div id="close_multi_indexes-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>close_multi_indexes</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 554</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L554">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">554
555
556
557
558
559
560
561
562
563
564
565</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='close_multi_indexes identifier id'>close_multi_indexes</span>
  <span class='comment val'># close combined index readers, just in case</span>
  <span class='comment val'># this seems to fix a strange test failure that seems to relate to a</span>
  <span class='comment val'># multi_index looking at an old version of the content_base index.</span>
  <span class='multi_indexes identifier id'>multi_indexes</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='key identifier id'>key</span><span class='comma token'>,</span> <span class='index identifier id'>index</span><span class='bitor op'>|</span>
    <span class='comment val'># puts &quot;#{key} -- #{self.name}&quot;</span>
    <span class='comment val'># TODO only close those where necessary (watch inheritance, where</span>
    <span class='comment val'># self.name is base class of a class where key is made from)</span>
    <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='close identifier id'>close</span> <span class='comment val'>#if key =~ /#{self.name}/</span>
  <span class='end end kw'>end</span>
  <span class='multi_indexes identifier id'>multi_indexes</span><span class='dot token'>.</span><span class='clear identifier id'>clear</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>combine_conditions</h3>
</div><div id="combine_conditions-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>combine_conditions</span><span class='args'>(conditions, additional_conditions = [])</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
combine our conditions with those given by user, if any
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 487</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L487">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">487
488
489
490
491
492
493
494
495
496</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='combine_conditions identifier id'>combine_conditions</span><span class='lparen token'>(</span><span class='conditions identifier id'>conditions</span><span class='comma token'>,</span> <span class='additional_conditions identifier id'>additional_conditions</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
  <span class='returning identifier id'>returning</span> <span class='conditions identifier id'>conditions</span> <span class='do do kw'>do</span>
    <span class='if if kw'>if</span> <span class='additional_conditions identifier id'>additional_conditions</span> <span class='andop op'>&amp;&amp;</span> <span class='additional_conditions identifier id'>additional_conditions</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
      <span class='cust_opts identifier id'>cust_opts</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='Array constant id'>Array</span> <span class='eqq op'>===</span> <span class='additional_conditions identifier id'>additional_conditions</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='additional_conditions identifier id'>additional_conditions</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span> <span class='colon op'>:</span> <span class='lbrack token'>[</span> <span class='additional_conditions identifier id'>additional_conditions</span> <span class='rbrack token'>]</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;cust_opts: #{cust_opts.inspect}&quot;</span>
      <span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='first identifier id'>first</span> <span class='lshft op'>&lt;&lt;</span> <span class='string val'>&quot; and &quot;</span> <span class='lshft op'>&lt;&lt;</span> <span class='cust_opts identifier id'>cust_opts</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
      <span class='conditions identifier id'>conditions</span><span class='dot token'>.</span><span class='concat identifier id'>concat</span><span class='lparen token'>(</span><span class='cust_opts identifier id'>cust_opts</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>conditions_for_model</h3>
</div><div id="conditions_for_model-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>conditions_for_model</span><span class='args'>(model, conditions = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
check for per-model conditions and return these if provided
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 423</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L423">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">423
424
425
426
427
428
429</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='conditions_for_model identifier id'>conditions_for_model</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='comma token'>,</span> <span class='conditions identifier id'>conditions</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='if if kw'>if</span> <span class='Hash constant id'>Hash</span> <span class='eqq op'>===</span> <span class='conditions identifier id'>conditions</span>
    <span class='key identifier id'>key</span> <span class='assign token'>=</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='underscore identifier id'>underscore</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
    <span class='conditions identifier id'>conditions</span> <span class='assign token'>=</span> <span class='conditions identifier id'>conditions</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='conditions identifier id'>conditions</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>create_index_instance</h3>
</div><div id="create_index_instance-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>create_index_instance</span><span class='args'>(definition)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
creates a new Index instance.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 381</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L381">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">381
382
383</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='create_index_instance identifier id'>create_index_instance</span><span class='lparen token'>(</span><span class='definition identifier id'>definition</span><span class='rparen token'>)</span>
  <span class='lparen token'>(</span><span class='remote? fid id'>remote?</span> <span class='integer val'>? </span><span class='RemoteIndex constant id'>RemoteIndex</span> <span class='colon op'>:</span> <span class='LocalIndex constant id'>LocalIndex</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='definition identifier id'>definition</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>define_index</h3>
</div><div id="define_index-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>define_index</span><span class='args'>(name, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
Globally declares an index.
</p>
<p>
This method is also used to implicitly declare an index when you use the
acts_as_ferret call in your class. Returns the created index instance.
</p>
<h3>Options are:</h3>
<table>
<tr><td valign="top"><tt>models</tt>:</td><td>Hash of model classes and their per-class option hashes which should use
this index. Any models mentioned here will automatically use the index,
there is no need to explicitly call <tt>acts_as_ferret</tt> in the model
class definition.

</td></tr>
</table>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 159</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L159">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='define_index identifier id'>define_index</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
  <span class='pending_classes identifier id'>pending_classes</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
  <span class='if if kw'>if</span> <span class='ferret_indexes identifier id'>ferret_indexes</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='comment val'># seems models have been already loaded. remove that index for now,</span>
    <span class='comment val'># re-register any already loaded classes later on.</span>
    <span class='idx identifier id'>idx</span> <span class='assign token'>=</span> <span class='get_index identifier id'>get_index</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='pending_classes identifier id'>pending_classes</span> <span class='assign token'>=</span> <span class='idx identifier id'>idx</span><span class='dot token'>.</span><span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:registered_models</span><span class='rbrack token'>]</span>
    <span class='pending_classes_configs identifier id'>pending_classes_configs</span> <span class='assign token'>=</span> <span class='idx identifier id'>idx</span><span class='dot token'>.</span><span class='registered_models_config identifier id'>registered_models_config</span>
    <span class='idx identifier id'>idx</span><span class='dot token'>.</span><span class='close identifier id'>close</span>
    <span class='ferret_indexes identifier id'>ferret_indexes</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='index_definition identifier id'>index_definition</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:index_dir</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='dstring node'>&quot;#{ActsAsFerret::index_dir}/#{name}&quot;</span><span class='comma token'>,</span>
    <span class='symbol val'>:name</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='comma token'>,</span>
    <span class='symbol val'>:single_index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='comma token'>,</span>
    <span class='symbol val'>:reindex_batch_size</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1000</span><span class='comma token'>,</span>
    <span class='symbol val'>:ferret</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span>
    <span class='symbol val'>:ferret_fields</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span>             <span class='comment val'># list of indexed fields that will be filled later</span>
    <span class='symbol val'>:enabled</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>                 <span class='comment val'># used for class-wide disabling of Ferret</span>
    <span class='symbol val'>:mysql_fast_batches</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>      <span class='comment val'># turn off to disable the faster, id based batching mechanism for MySQL</span>
    <span class='symbol val'>:raise_drb_errors</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>        <span class='comment val'># handle DRb connection errors by default</span>
  <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span> <span class='options identifier id'>options</span> <span class='rparen token'>)</span>

  <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:registered_models</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  
  <span class='comment val'># build ferret configuration</span>
  <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:ferret</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span>
    <span class='symbol val'>:or_default</span>          <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span><span class='comma token'>,</span> 
    <span class='symbol val'>:handle_parse_errors</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span>
    <span class='symbol val'>:default_field</span>       <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='nil nil kw'>nil</span><span class='comma token'>,</span>              <span class='comment val'># will be set later on</span>
    <span class='comment val'>#:max_clauses =&gt; 512,</span>
    <span class='comment val'>#:analyzer =&gt; Ferret::Analysis::StandardAnalyzer.new,</span>
    <span class='comment val'># :wild_card_downcase =&gt; true</span>
  <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:ferret</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span> <span class='rparen token'>)</span>

  <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:user_default_field</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:ferret</span><span class='rbrack token'>]</span><span class='lbrack token'>[</span><span class='symbol val'>:default_field</span><span class='rbrack token'>]</span>

  <span class='unless unless kw'>unless</span> <span class='remote? fid id'>remote?</span>
    <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='ensure_directory identifier id'>ensure_directory</span> <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_dir</span><span class='rbrack token'>]</span> 
    <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_base_dir</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_dir</span><span class='rbrack token'>]</span>
    <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_dir</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='find_last_index_version identifier id'>find_last_index_version</span><span class='lparen token'>(</span><span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_dir</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
    <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;using index in #{index_definition[:index_dir]}&quot;</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># these properties are somewhat vital to the plugin and shouldn't</span>
  <span class='comment val'># be overwritten by the user:</span>
  <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:ferret</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='update identifier id'>update</span><span class='lparen token'>(</span>
    <span class='symbol val'>:key</span>               <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:key</span><span class='comma token'>,</span>
    <span class='symbol val'>:path</span>              <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_dir</span><span class='rbrack token'>]</span><span class='comma token'>,</span>
    <span class='symbol val'>:auto_flush</span>        <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='comment val'># slower but more secure in terms of locking problems TODO disable when running in drb mode?</span>
    <span class='symbol val'>:create_if_missing</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
  <span class='rparen token'>)</span>

  <span class='comment val'># field config</span>
  <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:ferret_fields</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='build_field_config identifier id'>build_field_config</span><span class='lparen token'>(</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:fields</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>
  <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:ferret_fields</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='update identifier id'>update</span> <span class='build_field_config identifier id'>build_field_config</span><span class='lparen token'>(</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:additional_fields</span><span class='rbrack token'>]</span> <span class='rparen token'>)</span>

  <span class='idx identifier id'>idx</span> <span class='assign token'>=</span> <span class='ferret_indexes identifier id'>ferret_indexes</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='create_index_instance identifier id'>create_index_instance</span><span class='lparen token'>(</span> <span class='index_definition identifier id'>index_definition</span> <span class='rparen token'>)</span>

  <span class='comment val'># re-register early loaded classes</span>
  <span class='if if kw'>if</span> <span class='pending_classes identifier id'>pending_classes</span>
    <span class='pending_classes identifier id'>pending_classes</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='clazz identifier id'>clazz</span><span class='bitor op'>|</span> <span class='idx identifier id'>idx</span><span class='dot token'>.</span><span class='register_class identifier id'>register_class</span> <span class='clazz identifier id'>clazz</span><span class='comma token'>,</span> <span class='lbrace token'>{</span> <span class='symbol val'>:force_re_registration</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='pending_classes_configs identifier id'>pending_classes_configs</span><span class='lbrack token'>[</span><span class='clazz identifier id'>clazz</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='models identifier id'>models</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:models</span><span class='rbrack token'>]</span>
    <span class='models identifier id'>models</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='clazz identifier id'>clazz</span><span class='comma token'>,</span> <span class='config identifier id'>config</span><span class='bitor op'>|</span>
      <span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='symbol val'>:include</span><span class='comma token'>,</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='WithoutAR constant id'>WithoutAR</span> <span class='unless unless_mod kw'>unless</span> <span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='symbol val'>:acts_as_ferret</span><span class='rparen token'>)</span>
      <span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='acts_as_ferret identifier id'>acts_as_ferret</span> <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>

  <span class='return return kw'>return</span> <span class='idx identifier id'>idx</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ensure_directory</h3>
</div><div id="ensure_directory-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ensure_directory</span><span class='args'>(dir)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 510</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L510">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">510
511
512</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='ensure_directory identifier id'>ensure_directory</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span>
  <span class='FileUtils constant id'>FileUtils</span><span class='dot token'>.</span><span class='mkdir_p identifier id'>mkdir_p</span> <span class='dir identifier id'>dir</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span> <span class='orop op'>||</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='symlink? fid id'>symlink?</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ferret_indexes</h3>
</div><div id="ferret_indexes-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ferret_indexes</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 104</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L104">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">104</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='ferret_indexes identifier id'>ferret_indexes</span><span class='semicolon token'>;</span> <span class='@@ferret_indexes ivar id'>@@ferret_indexes</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>field_infos</h3>
</div><div id="field_infos-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>field_infos</span><span class='args'>(index_definition)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
builds a FieldInfos instance for creation of an index
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 531</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L531">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='field_infos identifier id'>field_infos</span><span class='lparen token'>(</span><span class='index_definition identifier id'>index_definition</span><span class='rparen token'>)</span>
  <span class='comment val'># default attributes for fields</span>
  <span class='fi identifier id'>fi</span> <span class='assign token'>=</span> <span class='Ferret constant id'>Ferret</span><span class='colon2 op'>::</span><span class='Index constant id'>Index</span><span class='colon2 op'>::</span><span class='FieldInfos constant id'>FieldInfos</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:store</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:no</span><span class='comma token'>,</span> 
                                      <span class='symbol val'>:index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:yes</span><span class='comma token'>,</span> 
                                      <span class='symbol val'>:term_vector</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:no</span><span class='comma token'>,</span>
                                      <span class='symbol val'>:boost</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>1.0</span><span class='rparen token'>)</span>
  <span class='comment val'># unique key composed of classname and id</span>
  <span class='fi identifier id'>fi</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span><span class='lparen token'>(</span><span class='symbol val'>:key</span><span class='comma token'>,</span> <span class='symbol val'>:store</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:no</span><span class='comma token'>,</span> <span class='symbol val'>:index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:untokenized</span><span class='rparen token'>)</span>
  <span class='comment val'># primary key</span>
  <span class='fi identifier id'>fi</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span><span class='lparen token'>(</span><span class='symbol val'>:id</span><span class='comma token'>,</span> <span class='symbol val'>:store</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:yes</span><span class='comma token'>,</span> <span class='symbol val'>:index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:untokenized</span><span class='rparen token'>)</span> 
  <span class='comment val'># class_name</span>
  <span class='fi identifier id'>fi</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span><span class='lparen token'>(</span><span class='symbol val'>:class_name</span><span class='comma token'>,</span> <span class='symbol val'>:store</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:yes</span><span class='comma token'>,</span> <span class='symbol val'>:index</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:untokenized</span><span class='rparen token'>)</span>

  <span class='comment val'># other fields</span>
  <span class='index_definition identifier id'>index_definition</span><span class='lbrack token'>[</span><span class='symbol val'>:ferret_fields</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='each_pair identifier id'>each_pair</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='bitor op'>|</span>
    <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
    <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:via</span>
    <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:boost</span> <span class='if if_mod kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:boost</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Symbol constant id'>Symbol</span><span class='rparen token'>)</span> <span class='comment val'># dynamic boost</span>
    <span class='fi identifier id'>fi</span><span class='dot token'>.</span><span class='add_field identifier id'>add_field</span><span class='lparen token'>(</span><span class='field identifier id'>field</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='fi identifier id'>fi</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>filter_include_list_for_model</h3>
</div><div id="filter_include_list_for_model-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>filter_include_list_for_model</span><span class='args'>(model, include_options)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 348</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L348">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">348
349
350
351
352
353
354
355</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='filter_include_list_for_model identifier id'>filter_include_list_for_model</span><span class='lparen token'>(</span><span class='model identifier id'>model</span><span class='comma token'>,</span> <span class='include_options identifier id'>include_options</span><span class='rparen token'>)</span>
  <span class='filtered_include_options identifier id'>filtered_include_options</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='include_options identifier id'>include_options</span> <span class='assign token'>=</span> <span class='Array constant id'>Array</span><span class='lparen token'>(</span><span class='include_options identifier id'>include_options</span><span class='rparen token'>)</span>
  <span class='include_options identifier id'>include_options</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='include_option identifier id'>include_option</span><span class='bitor op'>|</span>
    <span class='filtered_include_options identifier id'>filtered_include_options</span> <span class='lshft op'>&lt;&lt;</span> <span class='include_option identifier id'>include_option</span> <span class='if if_mod kw'>if</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='reflections identifier id'>reflections</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='include_option identifier id'>include_option</span><span class='dot token'>.</span><span class='is_a? fid id'>is_a?</span><span class='lparen token'>(</span><span class='Hash constant id'>Hash</span><span class='rparen token'>)</span> <span class='question op'>?</span> <span class='include_option identifier id'>include_option</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='lbrack token'>[</span><span class='integer val'>0</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='colon op'>:</span> <span class='include_option identifier id'>include_option</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
  <span class='return return kw'>return</span> <span class='filtered_include_options identifier id'>filtered_include_options</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find</h3>
</div><div id="find-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find</span><span class='args'>(query, models_or_index_name, options = {}, ar_options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
models_or_index_name may be an index name as declared in config/aaf.rb, a
single class or an array of classes to limit search to these classes.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 301</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L301">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='models_or_index_name identifier id'>models_or_index_name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='ar_options identifier id'>ar_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='models identifier id'>models</span> <span class='assign token'>=</span> <span class='case case kw'>case</span> <span class='models_or_index_name identifier id'>models_or_index_name</span>
  <span class='when when kw'>when</span> <span class='Array constant id'>Array</span>
    <span class='models_or_index_name identifier id'>models_or_index_name</span>
  <span class='when when kw'>when</span> <span class='Class constant id'>Class</span>
    <span class='lbrack token'>[</span> <span class='models_or_index_name identifier id'>models_or_index_name</span> <span class='rbrack token'>]</span>
  <span class='else else kw'>else</span>
    <span class='nil nil kw'>nil</span>
  <span class='end end kw'>end</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='find_index identifier id'>find_index</span><span class='lparen token'>(</span><span class='models_or_index_name identifier id'>models_or_index_name</span><span class='rparen token'>)</span>
  <span class='multi identifier id'>multi</span> <span class='assign token'>=</span> <span class='lparen token'>(</span><span class='MultiIndexBase constant id'>MultiIndexBase</span> <span class='eqq op'>===</span> <span class='index identifier id'>index</span> <span class='or or kw'>or</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='shared? fid id'>shared?</span><span class='rparen token'>)</span>
  <span class='unless unless kw'>unless</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='ar_options identifier id'>ar_options</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:limit</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:offset</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='ar_options identifier id'>ar_options</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:offset</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span>
    <span class='comment val'># need pagination</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='dot token'>.</span><span class='to_i identifier id'>to_i</span> <span class='colon op'>:</span> <span class='integer val'>1</span>
    <span class='else else kw'>else</span>
      <span class='nil nil kw'>nil</span>
    <span class='end end kw'>end</span>
    <span class='limit identifier id'>limit</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span>
    <span class='offset identifier id'>offset</span> <span class='assign token'>=</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:offset</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='question op'>?</span> <span class='lparen token'>(</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span> <span class='minus op'>-</span> <span class='integer val'>1</span><span class='rparen token'>)</span> <span class='mult op'>*</span> <span class='limit identifier id'>limit</span> <span class='colon op'>:</span> <span class='integer val'>0</span><span class='rparen token'>)</span>
    <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='delete identifier id'>delete</span> <span class='symbol val'>:offset</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='symbol val'>:all</span>
    
    <span class='if if kw'>if</span> <span class='multi identifier id'>multi</span> <span class='or or kw'>or</span> <span class='lparen token'>(</span><span class='lparen token'>(</span><span class='ar_options identifier id'>ar_options</span><span class='lbrack token'>[</span><span class='symbol val'>:conditions</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='ar_options identifier id'>ar_options</span><span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:sort</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
      <span class='comment val'># do pagination as the last step after everything has been fetched</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:late_pagination</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span> <span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='limit identifier id'>limit</span><span class='comma token'>,</span> <span class='symbol val'>:offset</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='offset identifier id'>offset</span> <span class='rbrace token'>}</span>
    <span class='elsif elsif kw'>elsif</span> <span class='ar_options identifier id'>ar_options</span><span class='lbrack token'>[</span><span class='symbol val'>:conditions</span><span class='rbrack token'>]</span> <span class='or or kw'>or</span> <span class='ar_options identifier id'>ar_options</span><span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span>
      <span class='comment val'># late limiting in AR call</span>
      <span class='unless unless kw'>unless</span> <span class='limit identifier id'>limit</span> <span class='eq op'>==</span> <span class='symbol val'>:all</span>
        <span class='ar_options identifier id'>ar_options</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='limit identifier id'>limit</span>
        <span class='ar_options identifier id'>ar_options</span><span class='lbrack token'>[</span><span class='symbol val'>:offset</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='offset identifier id'>offset</span>
      <span class='end end kw'>end</span>
    <span class='else else kw'>else</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:limit</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='limit identifier id'>limit</span>
      <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:offset</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='offset identifier id'>offset</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;options: #{options.inspect}\nar_options: #{ar_options.inspect}&quot;</span>
  <span class='total_hits identifier id'>total_hits</span><span class='comma token'>,</span> <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='find_records identifier id'>find_records</span> <span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:models</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='models identifier id'>models</span><span class='rparen token'>)</span><span class='comma token'>,</span> <span class='ar_options identifier id'>ar_options</span>
  <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;Query: #{query}\ntotal hits: #{total_hits}, results delivered: #{result.size}&quot;</span>
  <span class='SearchResults constant id'>SearchResults</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='result identifier id'>result</span><span class='comma token'>,</span> <span class='total_hits identifier id'>total_hits</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:page</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:per_page</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_ids</h3>
</div><div id="find_ids-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_ids</span><span class='args'>(query, models_or_index_name, options = {}, &amp;block)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
find ids of records
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 280</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L280">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">280
281
282
283</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='find_ids identifier id'>find_ids</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='models_or_index_name identifier id'>models_or_index_name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='add_models_to_options_if_necessary identifier id'>add_models_to_options_if_necessary</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='models_or_index_name identifier id'>models_or_index_name</span>
  <span class='find_index identifier id'>find_index</span><span class='lparen token'>(</span><span class='models_or_index_name identifier id'>models_or_index_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='find_ids identifier id'>find_ids</span> <span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_index</h3>
</div><div id="find_index-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_index</span><span class='args'>(models_or_index_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns an index instance suitable for searching/updating the named index.
Will return a read only MultiIndex when multiple model classes are given
that do not share the same physical index.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 288</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L288">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">288
289
290
291
292
293
294
295
296
297</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='find_index identifier id'>find_index</span><span class='lparen token'>(</span><span class='models_or_index_name identifier id'>models_or_index_name</span><span class='rparen token'>)</span>
  <span class='case case kw'>case</span> <span class='models_or_index_name identifier id'>models_or_index_name</span>
  <span class='when when kw'>when</span> <span class='Symbol constant id'>Symbol</span>
    <span class='get_index identifier id'>get_index</span> <span class='models_or_index_name identifier id'>models_or_index_name</span>
  <span class='when when kw'>when</span> <span class='String constant id'>String</span>
    <span class='get_index identifier id'>get_index</span> <span class='models_or_index_name identifier id'>models_or_index_name</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
  <span class='else else kw'>else</span>
    <span class='get_index_for identifier id'>get_index_for</span> <span class='models_or_index_name identifier id'>models_or_index_name</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>find_last_index_version</h3>
</div><div id="find_last_index_version-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>find_last_index_version</span><span class='args'>(basedir)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
find the most recent version of an index
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 394</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L394">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">394
395
396
397
398
399
400
401
402
403
404
405
406
407</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='find_last_index_version identifier id'>find_last_index_version</span><span class='lparen token'>(</span><span class='basedir identifier id'>basedir</span><span class='rparen token'>)</span>
  <span class='comment val'># check for versioned index</span>
  <span class='versions identifier id'>versions</span> <span class='assign token'>=</span> <span class='Dir constant id'>Dir</span><span class='dot token'>.</span><span class='entries identifier id'>entries</span><span class='lparen token'>(</span><span class='basedir identifier id'>basedir</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='select identifier id'>select</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='f identifier id'>f</span><span class='bitor op'>|</span> 
    <span class='dir identifier id'>dir</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='basedir identifier id'>basedir</span><span class='comma token'>,</span> <span class='f identifier id'>f</span><span class='rparen token'>)</span>
    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='file? fid id'>file?</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='comma token'>,</span> <span class='string val'>'segments'</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='f identifier id'>f</span> <span class='match op'>=~</span> <span class='regexp val'>/^\d+(_\d+)?$/</span>
  <span class='end end kw'>end</span>
  <span class='if if kw'>if</span> <span class='versions identifier id'>versions</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
    <span class='comment val'># select latest version</span>
    <span class='versions identifier id'>versions</span><span class='dot token'>.</span><span class='sort! fid id'>sort!</span>
    <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='basedir identifier id'>basedir</span><span class='comma token'>,</span> <span class='versions identifier id'>versions</span><span class='dot token'>.</span><span class='last identifier id'>last</span>
  <span class='else else kw'>else</span>
    <span class='basedir identifier id'>basedir</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_index</h3>
</div><div id="get_index-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_index</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns the index with the given name.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 261</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L261">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">261
262
263
264
265
266
267
268
269
270
271</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='get_index identifier id'>get_index</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span>
  <span class='unless unless kw'>unless</span> <span class='ferret_indexes identifier id'>ferret_indexes</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='if if kw'>if</span> <span class='@aaf_config_loaded ivar id'>@aaf_config_loaded</span>
      <span class='raise identifier id'>raise</span> <span class='IndexNotDefined constant id'>IndexNotDefined</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
    <span class='else else kw'>else</span>
      <span class='load_config identifier id'>load_config</span> <span class='and and kw'>and</span> <span class='return return kw'>return</span> <span class='get_index identifier id'>get_index</span> <span class='name identifier id'>name</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='ferret_indexes identifier id'>ferret_indexes</span><span class='lbrack token'>[</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>get_index_for</h3>
</div><div id="get_index_for-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>get_index_for</span><span class='args'>(*classes)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns the index used by the given class.
</p>
<p>
If multiple classes are given, either the single index shared by these
classes, or a multi index (to be used for search only) across the indexes
of all models, is returned.
</p>

</div><div class="section tags">
  <h2>Meta Tags</h2>
  <div class="raise">
  <h3>Raises:</h3>
  <dl>
  
    <dt>
      
        <span class='type'>[<tt>ArgumentError</tt>]</span>
      
      
      
    </dt>
    <dd>
      <span class='desc'></span>
    </dd>
  
  </dl>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 362</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L362">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='get_index_for identifier id'>get_index_for</span><span class='lparen token'>(</span><span class='mult op'>*</span><span class='classes identifier id'>classes</span><span class='rparen token'>)</span>
  <span class='classes identifier id'>classes</span><span class='dot token'>.</span><span class='flatten! fid id'>flatten!</span>
  <span class='raise identifier id'>raise</span> <span class='ArgumentError constant id'>ArgumentError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='string val'>&quot;no class specified&quot;</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='classes identifier id'>classes</span><span class='dot token'>.</span><span class='any? fid id'>any?</span>
  <span class='classes identifier id'>classes</span><span class='dot token'>.</span><span class='map! fid id'>map!</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:constantize</span><span class='rparen token'>)</span> <span class='unless unless_mod kw'>unless</span> <span class='Class constant id'>Class</span> <span class='eqq op'>===</span> <span class='classes identifier id'>classes</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;index_for #{classes.inspect}&quot;</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='classes identifier id'>classes</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span>
    <span class='indexes identifier id'>indexes</span> <span class='assign token'>=</span> <span class='classes identifier id'>classes</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='c identifier id'>c</span><span class='bitor op'>|</span> <span class='get_index_for identifier id'>get_index_for</span> <span class='c identifier id'>c</span> <span class='rbrace token'>}</span><span class='dot token'>.</span><span class='uniq identifier id'>uniq</span>
    <span class='indexes identifier id'>indexes</span><span class='dot token'>.</span><span class='size identifier id'>size</span> <span class='gt op'>&gt;</span> <span class='integer val'>1</span> <span class='question op'>?</span> <span class='multi_index identifier id'>multi_index</span><span class='lparen token'>(</span><span class='indexes identifier id'>indexes</span><span class='rparen token'>)</span> <span class='colon op'>:</span> <span class='indexes identifier id'>indexes</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='else else kw'>else</span>
    <span class='clazz identifier id'>clazz</span> <span class='assign token'>=</span> <span class='classes identifier id'>classes</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='clazz identifier id'>clazz</span> <span class='assign token'>=</span> <span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='superclass identifier id'>superclass</span> <span class='while while_mod kw'>while</span> <span class='clazz identifier id'>clazz</span> <span class='andop op'>&amp;&amp;</span> <span class='notop op'>!</span><span class='@@index_using_classes ivar id'>@@index_using_classes</span><span class='dot token'>.</span><span class='has_key? fid id'>has_key?</span><span class='lparen token'>(</span><span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='get_index identifier id'>get_index</span> <span class='@@index_using_classes ivar id'>@@index_using_classes</span><span class='lbrack token'>[</span><span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span>
  <span class='end end kw'>end</span>
  <span class='raise identifier id'>raise</span> <span class='IndexNotDefined constant id'>IndexNotDefined</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;no index found for class: #{classes.map(&amp;:name).join(',')}&quot;</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
  <span class='return return kw'>return</span> <span class='index identifier id'>index</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>index_using_classes</h3>
</div><div id="index_using_classes-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>index_using_classes</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 108</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L108">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">108</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='index_using_classes identifier id'>index_using_classes</span><span class='semicolon token'>;</span> <span class='@@index_using_classes ivar id'>@@index_using_classes</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>init_index_basedir</h3>
</div><div id="init_index_basedir-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>init_index_basedir</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
make sure the default index base dir exists. by default, all indexes are
created under RAILS_ROOT/index/RAILS_ENV
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 517</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L517">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">517
518
519
520</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='init_index_basedir identifier id'>init_index_basedir</span>
  <span class='index_base identifier id'>index_base</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{RAILS_ROOT}/index&quot;</span>
  <span class='@@index_dir ivar id'>@@index_dir</span> <span class='assign token'>=</span> <span class='dstring node'>&quot;#{index_base}/#{RAILS_ENV}&quot;</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>load_config</h3>
</div><div id="load_config-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>load_config</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 251</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L251">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">251
252
253
254
255
256
257
258</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='load_config identifier id'>load_config</span>
  <span class='comment val'># using require_dependency to make the reloading in dev mode work.</span>
  <span class='require_dependency identifier id'>require_dependency</span> <span class='dstring node'>&quot;#{RAILS_ROOT}/config/aaf.rb&quot;</span>
  <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='string val'>&quot;loaded configuration file aaf.rb&quot;</span>
<span class='rescue rescue kw'>rescue</span> <span class='LoadError constant id'>LoadError</span>
<span class='ensure ensure kw'>ensure</span>
  <span class='@aaf_config_loaded ivar id'>@aaf_config_loaded</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>multi_index</h3>
</div><div id="multi_index-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>multi_index</span><span class='args'>(indexes)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
returns a MultiIndex instance operating on a MultiReader
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 410</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L410">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">410
411
412
413
414
415
416
417
418
419
420</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='multi_index identifier id'>multi_index</span><span class='lparen token'>(</span><span class='indexes identifier id'>indexes</span><span class='rparen token'>)</span>
  <span class='index_names identifier id'>index_names</span> <span class='assign token'>=</span> <span class='indexes identifier id'>indexes</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='index_names identifier id'>index_names</span> <span class='assign token'>=</span> <span class='index_names identifier id'>index_names</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lparen token'>(</span><span class='bitand op'>&amp;</span><span class='symbol val'>:to_s</span><span class='rparen token'>)</span> <span class='if if_mod kw'>if</span> <span class='Symbol constant id'>Symbol</span> <span class='eqq op'>===</span> <span class='index_names identifier id'>index_names</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
  <span class='if if kw'>if</span> <span class='String constant id'>String</span> <span class='eqq op'>===</span> <span class='index_names identifier id'>index_names</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
    <span class='indexes identifier id'>indexes</span> <span class='assign token'>=</span> <span class='index_names identifier id'>index_names</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='name identifier id'>name</span><span class='bitor op'>|</span> <span class='get_index identifier id'>get_index</span> <span class='name identifier id'>name</span> <span class='rbrace token'>}</span>
  <span class='else else kw'>else</span>
    <span class='index_names identifier id'>index_names</span> <span class='assign token'>=</span> <span class='index_names identifier id'>index_names</span><span class='dot token'>.</span><span class='map identifier id'>map</span><span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='i identifier id'>i</span><span class='bitor op'>|</span> <span class='i identifier id'>i</span><span class='dot token'>.</span><span class='index_name identifier id'>index_name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='rbrace token'>}</span>
  <span class='end end kw'>end</span>
  <span class='key identifier id'>key</span> <span class='assign token'>=</span> <span class='index_names identifier id'>index_names</span><span class='dot token'>.</span><span class='sort identifier id'>sort</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='string val'>&quot;,&quot;</span><span class='rparen token'>)</span>
  <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='multi_indexes identifier id'>multi_indexes</span><span class='lbrack token'>[</span><span class='key identifier id'>key</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='lparen token'>(</span><span class='remote? fid id'>remote?</span> <span class='integer val'>? </span><span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='RemoteMultiIndex constant id'>RemoteMultiIndex</span> <span class='colon op'>:</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='MultiIndex constant id'>MultiIndex</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='indexes identifier id'>indexes</span><span class='rparen token'>)</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>multi_indexes</h3>
</div><div id="multi_indexes-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>multi_indexes</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 99</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L99">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">99</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='multi_indexes identifier id'>multi_indexes</span><span class='semicolon token'>;</span> <span class='@@multi_indexes ivar id'>@@multi_indexes</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>raise_drb_errors?</h3>
</div><div id="raise_drb_errors-3F-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>raise_drb_errors?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 126</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L126">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">126</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='raise_drb_errors? fid id'>raise_drb_errors?</span><span class='semicolon token'>;</span> <span class='@@raise_drb_errors ivar id'>@@raise_drb_errors</span> <span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>rebuild_index</h3>
</div><div id="rebuild_index-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>rebuild_index</span><span class='args'>(name)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 385</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L385">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">385
386
387</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='rebuild_index identifier id'>rebuild_index</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
  <span class='get_index identifier id'>get_index</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='rebuild_index identifier id'>rebuild_index</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>register_class_with_index</h3>
</div><div id="register_class_with_index-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>register_class_with_index</span><span class='args'>(clazz, index_name, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
called internally by the acts_as_ferret method
</p>
<p>
returns the index
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 238</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L238">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">238
239
240
241
242
243
244
245
246
247
248
249</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='register_class_with_index identifier id'>register_class_with_index</span><span class='lparen token'>(</span><span class='clazz identifier id'>clazz</span><span class='comma token'>,</span> <span class='index_name identifier id'>index_name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='index_name identifier id'>index_name</span> <span class='assign token'>=</span> <span class='index_name identifier id'>index_name</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span>
  <span class='@@index_using_classes ivar id'>@@index_using_classes</span><span class='lbrack token'>[</span><span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='name identifier id'>name</span><span class='rbrack token'>]</span> <span class='assign token'>=</span> <span class='index_name identifier id'>index_name</span>
  <span class='unless unless kw'>unless</span> <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='ferret_indexes identifier id'>ferret_indexes</span><span class='lbrack token'>[</span><span class='index_name identifier id'>index_name</span><span class='rbrack token'>]</span>
    <span class='comment val'># index definition on the fly</span>
    <span class='comment val'># default to all attributes of this class</span>
    <span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:fields</span><span class='rbrack token'>]</span> <span class='opasgn op'>||=</span> <span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='attributes identifier id'>attributes</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span><span class='dot token'>.</span><span class='map identifier id'>map</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='k identifier id'>k</span><span class='bitor op'>|</span> <span class='k identifier id'>k</span><span class='dot token'>.</span><span class='to_sym identifier id'>to_sym</span> <span class='rbrace token'>}</span>
    <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='define_index identifier id'>define_index</span> <span class='index_name identifier id'>index_name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span>
  <span class='end end kw'>end</span>
  <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='register_class identifier id'>register_class</span><span class='lparen token'>(</span><span class='clazz identifier id'>clazz</span><span class='comma token'>,</span> <span class='options identifier id'>options</span><span class='rparen token'>)</span>
  <span class='return return kw'>return</span> <span class='index identifier id'>index</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>remote?</h3>
</div><div id="remote-3F-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>remote?</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 130</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L130">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">130
131
132
133
134
135
136
137
138
139
140
141
142
143
144</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='remote? fid id'>remote?</span>
  <span class='if if kw'>if</span> <span class='@@remote ivar id'>@@remote</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='if if kw'>if</span> <span class='ENV constant id'>ENV</span><span class='lbrack token'>[</span><span class='string val'>&quot;FERRET_USE_LOCAL_INDEX&quot;</span><span class='rbrack token'>]</span> <span class='orop op'>||</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='Remote constant id'>Remote</span><span class='colon2 op'>::</span><span class='Server constant id'>Server</span><span class='dot token'>.</span><span class='running identifier id'>running</span>
      <span class='@@remote ivar id'>@@remote</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
    <span class='else else kw'>else</span>
      <span class='@@remote ivar id'>@@remote</span> <span class='assign token'>=</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='Remote constant id'>Remote</span><span class='colon2 op'>::</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='dot token'>.</span><span class='uri identifier id'>uri</span> <span class='rescue rescue kw'>rescue</span> <span class='false false kw'>false</span>
    <span class='end end kw'>end</span>
    <span class='if if kw'>if</span> <span class='@@remote ivar id'>@@remote</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;Will use remote index server which should be available at #{@@remote}&quot;</span>
    <span class='else else kw'>else</span>
      <span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='string val'>&quot;Will use local index.&quot;</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
  <span class='@@remote ivar id'>@@remote</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>retrieve_records</h3>
</div><div id="retrieve_records-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>retrieve_records</span><span class='args'>(id_arrays, find_options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
retrieves search result records from a data structure like this: {
&#8216;Model1&#8217; =&gt; { &#8216;1&#8217; =&gt; [ rank, score ],
&#8216;2&#8217; =&gt; [ rank, score ] }
</p>
<p>
TODO: in case of STI AR will filter out hits from other classes for us, but
this will lead to less results retrieved --&gt; scoping of ferret
query to self.class is still needed. from the ferret ML (thanks Curtis
Hatter) &gt; I created a method in my base STI class so I can scope my
query. For scoping &gt; I used something like the following line: &gt; &gt;
query &lt;&lt; &quot; role:#{self.class.eql?(Contents) &#8217;*&#8217; :
self.class}&quot; &gt; &gt; Though you could make it more generic by simply
asking &gt; &quot;self.descends_from_active_record?&quot; which is how
rails decides if it should &gt; scope your &quot;find&quot; query for STI
models. You can check out &quot;base.rb&quot; in &gt; activerecord to see
that. but maybe better do the scoping in find_ids_with_ferret&#8230;
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 449</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L449">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='retrieve_records identifier id'>retrieve_records</span><span class='lparen token'>(</span><span class='id_arrays identifier id'>id_arrays</span><span class='comma token'>,</span> <span class='find_options identifier id'>find_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='result identifier id'>result</span> <span class='assign token'>=</span> <span class='lbrack token'>[</span><span class='rbrack token'>]</span>
  <span class='comment val'># get objects for each model</span>
  <span class='id_arrays identifier id'>id_arrays</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='model identifier id'>model</span><span class='comma token'>,</span> <span class='id_array identifier id'>id_array</span><span class='bitor op'>|</span>
    <span class='next next kw'>next</span> <span class='if if_mod kw'>if</span> <span class='id_array identifier id'>id_array</span><span class='dot token'>.</span><span class='empty? fid id'>empty?</span>
    <span class='model_class identifier id'>model_class</span> <span class='assign token'>=</span> <span class='model identifier id'>model</span><span class='dot token'>.</span><span class='constantize identifier id'>constantize</span>

    <span class='comment val'># merge conditions</span>
    <span class='conditions identifier id'>conditions</span> <span class='assign token'>=</span> <span class='conditions_for_model identifier id'>conditions_for_model</span> <span class='model_class identifier id'>model_class</span><span class='comma token'>,</span> <span class='find_options identifier id'>find_options</span><span class='lbrack token'>[</span><span class='symbol val'>:conditions</span><span class='rbrack token'>]</span>
    <span class='conditions identifier id'>conditions</span> <span class='assign token'>=</span> <span class='combine_conditions identifier id'>combine_conditions</span><span class='lparen token'>(</span><span class='lbrack token'>[</span> <span class='dstring node'>&quot;#{model_class.table_name}.#{model_class.primary_key} in (?)&quot;</span><span class='comma token'>,</span> 
                                      <span class='id_array identifier id'>id_array</span><span class='dot token'>.</span><span class='keys identifier id'>keys</span> <span class='rbrack token'>]</span><span class='comma token'>,</span> 
                                    <span class='conditions identifier id'>conditions</span><span class='rparen token'>)</span>

    <span class='comment val'># check for include association that might only exist on some models in case of multi_search</span>
    <span class='filtered_include_options identifier id'>filtered_include_options</span> <span class='assign token'>=</span> <span class='nil nil kw'>nil</span>
    <span class='if if kw'>if</span> <span class='include_options identifier id'>include_options</span> <span class='assign token'>=</span> <span class='find_options identifier id'>find_options</span><span class='lbrack token'>[</span><span class='symbol val'>:include</span><span class='rbrack token'>]</span>
      <span class='filtered_include_options identifier id'>filtered_include_options</span> <span class='assign token'>=</span> <span class='filter_include_list_for_model identifier id'>filter_include_list_for_model</span><span class='lparen token'>(</span><span class='model_class identifier id'>model_class</span><span class='comma token'>,</span> <span class='include_options identifier id'>include_options</span><span class='rparen token'>)</span>
    <span class='end end kw'>end</span>

    <span class='comment val'># fetch</span>
    <span class='tmp_result identifier id'>tmp_result</span> <span class='assign token'>=</span> <span class='model_class identifier id'>model_class</span><span class='dot token'>.</span><span class='find identifier id'>find</span><span class='lparen token'>(</span><span class='symbol val'>:all</span><span class='comma token'>,</span> <span class='find_options identifier id'>find_options</span><span class='dot token'>.</span><span class='merge identifier id'>merge</span><span class='lparen token'>(</span><span class='symbol val'>:conditions</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='conditions identifier id'>conditions</span><span class='comma token'>,</span> 
                                                           <span class='symbol val'>:include</span>    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='filtered_include_options identifier id'>filtered_include_options</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

    <span class='comment val'># set scores and rank</span>
    <span class='tmp_result identifier id'>tmp_result</span><span class='dot token'>.</span><span class='each identifier id'>each</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='record identifier id'>record</span><span class='bitor op'>|</span>
      <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='ferret_rank identifier id'>ferret_rank</span><span class='comma token'>,</span> <span class='record identifier id'>record</span><span class='dot token'>.</span><span class='ferret_score identifier id'>ferret_score</span> <span class='assign token'>=</span> <span class='id_array identifier id'>id_array</span><span class='lbrack token'>[</span><span class='record identifier id'>record</span><span class='dot token'>.</span><span class='id identifier id'>id</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rbrack token'>]</span>
    <span class='end end kw'>end</span>
    <span class='comment val'># merge with result array</span>
    <span class='result identifier id'>result</span> <span class='opasgn op'>+=</span> <span class='tmp_result identifier id'>tmp_result</span>
  <span class='end end kw'>end</span>
  
  <span class='comment val'># order results as they were found by ferret, unless an AR :order</span>
  <span class='comment val'># option was given</span>
  <span class='result identifier id'>result</span><span class='dot token'>.</span><span class='sort! fid id'>sort!</span> <span class='lbrace token'>{</span> <span class='bitor op'>|</span><span class='a identifier id'>a</span><span class='comma token'>,</span> <span class='b identifier id'>b</span><span class='bitor op'>|</span> <span class='a identifier id'>a</span><span class='dot token'>.</span><span class='ferret_rank identifier id'>ferret_rank</span> <span class='cmp op'>&lt;=&gt;</span> <span class='b identifier id'>b</span><span class='dot token'>.</span><span class='ferret_rank identifier id'>ferret_rank</span> <span class='rbrace token'>}</span> <span class='unless unless_mod kw'>unless</span> <span class='find_options identifier id'>find_options</span><span class='lbrack token'>[</span><span class='symbol val'>:order</span><span class='rbrack token'>]</span>
  <span class='return return kw'>return</span> <span class='result identifier id'>result</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>total_hits</h3>
</div><div id="total_hits-class_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>total_hits</span><span class='args'>(query, models_or_index_name, options = {})</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
count hits for a query
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/acts_as_ferret.rb', line 274</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/acts_as_ferret.rb#L274">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">274
275
276
277</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='total_hits identifier id'>total_hits</span><span class='lparen token'>(</span><span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='models_or_index_name identifier id'>models_or_index_name</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
  <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='add_models_to_options_if_necessary identifier id'>add_models_to_options_if_necessary</span> <span class='options identifier id'>options</span><span class='comma token'>,</span> <span class='models_or_index_name identifier id'>models_or_index_name</span>
  <span class='find_index identifier id'>find_index</span><span class='lparen token'>(</span><span class='models_or_index_name identifier id'>models_or_index_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='total_hits identifier id'>total_hits</span> <span class='query identifier id'>query</span><span class='comma token'>,</span> <span class='options identifier id'>options</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>