<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>jkraemer's acts_as_ferret - Class: ActsAsFerret::Remote::Server - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/jkraemer/commits/acts_as_ferret/master" rel="alternate" title="Recent Commits to acts_as_ferret:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="../../app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("jkraemer", "acts_as_ferret", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("jkraemer", "acts_as_ferret", "2a9969a832fa6eb6dc34a962173edfa84e1e8783", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="../../style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/tree/">Source</a></li>
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/network">Network</a></li>            
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/jkraemer/acts_as_ferret">Wiki</a></li>
            <li class=""><a href="http://github.com/jkraemer/acts_as_ferret/graphs">Graphs</a></li>                    
            <li class="active"><a href="/jkraemer/acts_as_ferret">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/jkraemer">jkraemer</a> / <b><a href="http://github.com/jkraemer/acts_as_ferret/tree">acts_as_ferret</a></b>        
                <a id="namespaces_button" rel="jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="wikistyle">
  <div class="section class ActsAsFerret_Remote_Server">
  <h1>Class: ActsAsFerret::Remote::Server</h1>
  <div class="section docstring">
  <p>
This class acts as a drb server listening for indexing and search requests
from models declared to &#8216;acts_as_ferret :remote =&gt; true&#8217;
</p>
<p>
Usage:
</p>
<ul>
<li>modify RAILS_ROOT/config/ferret_server.yml to suit your needs.

</li>
<li>environments for which no section in the config file exists will use the
index locally (good for unit tests/development mode)

</li>
<li>run script/ferret_server to start the server:

</li>
</ul>
<p>
script/ferret_server -e production start
</p>
<ul>
<li>to stop the server run

</li>
</ul>
<p>
script/ferret_server -e production stop
</p>

</div><div class="section constants">
  
</div><div class="section constructor">
<h2>Constructor</h2>
  <div id="initialize-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>initialize</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 69</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L69">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">69
70
71
72
73
74
75
76
77
78
79
80</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='initialize identifier id'>initialize</span>
  <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='allow_concurrency identifier id'>allow_concurrency</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='require identifier id'>require</span> <span class='string val'>'ar_mysql_auto_reconnect_patch'</span>
  <span class='@cfg ivar id'>@cfg</span> <span class='assign token'>=</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='Remote constant id'>Remote</span><span class='colon2 op'>::</span><span class='Config constant id'>Config</span><span class='dot token'>.</span><span class='new identifier id'>new</span>
  <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span> <span class='assign token'>=</span> <span class='@logger ivar id'>@logger</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='@cfg ivar id'>@cfg</span><span class='dot token'>.</span><span class='log_file identifier id'>log_file</span><span class='rparen token'>)</span>
  <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span><span class='dot token'>.</span><span class='logger identifier id'>logger</span><span class='dot token'>.</span><span class='level identifier id'>level</span> <span class='assign token'>=</span> <span class='Logger constant id'>Logger</span><span class='dot token'>.</span><span class='const_get identifier id'>const_get</span><span class='lparen token'>(</span><span class='@cfg ivar id'>@cfg</span><span class='dot token'>.</span><span class='log_level identifier id'>log_level</span><span class='dot token'>.</span><span class='upcase identifier id'>upcase</span><span class='rparen token'>)</span> <span class='rescue rescue kw'>rescue</span> <span class='Logger constant id'>Logger</span><span class='colon2 op'>::</span><span class='DEBUG constant id'>DEBUG</span>
  <span class='if if kw'>if</span> <span class='@cfg ivar id'>@cfg</span><span class='dot token'>.</span><span class='script identifier id'>script</span>
    <span class='path identifier id'>path</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='RAILS_ROOT constant id'>RAILS_ROOT</span><span class='comma token'>,</span> <span class='@cfg ivar id'>@cfg</span><span class='dot token'>.</span><span class='script identifier id'>script</span><span class='rparen token'>)</span> 
    <span class='load identifier id'>load</span> <span class='path identifier id'>path</span>
    <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='info identifier id'>info</span> <span class='dstring node'>&quot;loaded custom startup script from #{path}&quot;</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div><div class="section methodmissing">
  <h2>Dynamic Method Handling</h2>

  <p class="note">
    This class handles dynamic methods through the <tt>method_missing</tt> method
    
  </p>

  <div id="method_missing-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>method_missing</span><span class='args'>(name, *args)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
handles all incoming method calls, and sends them on to the correct local
index instance.
</p>
<p>
Calls are not queued, so this will block until the call returned.
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 112</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L112">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='method_missing identifier id'>method_missing</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span><span class='rparen token'>)</span>
  <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;\#method_missing(#{name.inspect}, #{args.inspect})&quot;</span>


  <span class='index_name identifier id'>index_name</span> <span class='assign token'>=</span> <span class='args identifier id'>args</span><span class='dot token'>.</span><span class='shift identifier id'>shift</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='if if kw'>if</span> <span class='name identifier id'>name</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span> <span class='match op'>=~</span> <span class='regexp val'>/^multi_(.+)/</span>
    <span class='name identifier id'>name</span> <span class='assign token'>=</span> <span class='$1 nth_ref id'>$1</span>
    <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='multi_index identifier id'>multi_index</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span>
  <span class='else else kw'>else</span>
    <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='get_index identifier id'>get_index</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>

  <span class='if if kw'>if</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='nil? fid id'>nil?</span>
    <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='error identifier id'>error</span> <span class='dstring node'>&quot;\#index with name #{index_name} not found in call to #{name} with args #{args.inspect}&quot;</span>
    <span class='raise identifier id'>raise</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='IndexNotDefined constant id'>IndexNotDefined</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>


  <span class='comment val'># TODO find another way to implement the reconnection logic (maybe in</span>
  <span class='comment val'># local_index or class_methods)</span>
  <span class='comment val'>#  reconnect_when_needed(clazz) do</span>
  
  <span class='comment val'># using respond_to? here so we not have to catch NoMethodError</span>
  <span class='comment val'># which would silently catch those from deep inside the indexing</span>
  <span class='comment val'># code, too...</span>

  <span class='if if kw'>if</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='respond_to? fid id'>respond_to?</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='rparen token'>)</span>
    <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='send identifier id'>send</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='mult op'>*</span><span class='args identifier id'>args</span>
  <span class='comment val'># TODO check where we need this:</span>
  <span class='comment val'>#elsif clazz.respond_to?(name)</span>
  <span class='comment val'>#      @logger.debug &quot;no luck, trying to call class method instead&quot;</span>
  <span class='comment val'>#      clazz.send name, *args</span>
  <span class='else else kw'>else</span>
    <span class='raise identifier id'>raise</span> <span class='NoMethodError constant id'>NoMethodError</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='dstring node'>&quot;method #{name} not supported by DRb server&quot;</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='rescue rescue kw'>rescue</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='error identifier id'>error</span> <span class='dstring node'>&quot;ferret server error #{$!}\n#{$!.backtrace.join &quot;\n&quot;}&quot;</span>
  <span class='raise identifier id'>raise</span> <span class='e identifier id'>e</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
</div>  <div class="section visibilitygroup">
      <div class="section methodsummary">
    <h2>Public Instance Method Summary</h2>
<table class="summary">
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#db_disconnect-21-instance_method">#db_disconnect!</span><span class='args'>(class_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
disconnects the db connection for the class specified by class_name used
only in unit tests to check the automatic reconnection feature.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#ensure_index_exists-instance_method">#ensure_index_exists</span><span class='args'>(index_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
make sure we have a versioned index in place, building one if necessary.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#rebuild_index-instance_method">#rebuild_index</span><span class='args'>(index_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
hides LocalIndex#rebuild_index to implement index versioning.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#register_class-instance_method">#register_class</span><span class='args'>(class_name)</span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run-instance_method">#run</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
run the server and block until it exits.
</p>

        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#run_drb_service-instance_method">#run_drb_service</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        
        
      </td>
    </tr>
  
    <tr>
      <th class="signature">
        <span class='name'><a href="#start-instance_method">#start</span><span class='args'></span>
        <span class='block'></span>
        
      </th>
      <td class="docstring">
        <p>
start the server as a daemon process.
</p>

        
      </td>
    </tr>
  
</table>
  </div>
<div class="section methoddetails">
  <h2>Public Instance Method Details</h2>
  
    <div class="method">
      <div class="method_header">
  <h3>db_disconnect!</h3>
</div><div id="db_disconnect-21-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>db_disconnect!</span><span class='args'>(class_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
disconnects the db connection for the class specified by class_name used
only in unit tests to check the automatic reconnection feature
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 171</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L171">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">171
172
173
174
175</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='db_disconnect! fid id'>db_disconnect!</span><span class='lparen token'>(</span><span class='class_name identifier id'>class_name</span><span class='rparen token'>)</span>
  <span class='with_class identifier id'>with_class</span> <span class='class_name identifier id'>class_name</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='clazz identifier id'>clazz</span><span class='bitor op'>|</span>
    <span class='clazz identifier id'>clazz</span><span class='dot token'>.</span><span class='connection identifier id'>connection</span><span class='dot token'>.</span><span class='disconnect! fid id'>disconnect!</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>ensure_index_exists</h3>
</div><div id="ensure_index_exists-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>ensure_index_exists</span><span class='args'>(index_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
make sure we have a versioned index in place, building one if necessary
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 160</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L160">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">160
161
162
163
164
165
166
167</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='ensure_index_exists identifier id'>ensure_index_exists</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span>
  <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;DRb server: ensure_index_exists for index #{index_name}&quot;</span>
  <span class='definition identifier id'>definition</span> <span class='assign token'>=</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='get_index identifier id'>get_index</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='index_definition identifier id'>index_definition</span>
  <span class='dir identifier id'>dir</span> <span class='assign token'>=</span> <span class='definition identifier id'>definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_dir</span><span class='rbrack token'>]</span>
  <span class='unless unless kw'>unless</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='directory? fid id'>directory?</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='file? fid id'>file?</span><span class='lparen token'>(</span><span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span><span class='lparen token'>(</span><span class='dir identifier id'>dir</span><span class='comma token'>,</span> <span class='string val'>'segments'</span><span class='rparen token'>)</span><span class='rparen token'>)</span> <span class='andop op'>&amp;&amp;</span> <span class='dir identifier id'>dir</span> <span class='match op'>=~</span> <span class='regexp val'>%r{/\d+(_\d+)?$}</span>
    <span class='rebuild_index identifier id'>rebuild_index</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span>
  <span class='end end kw'>end</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>rebuild_index</h3>
</div><div id="rebuild_index-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>rebuild_index</span><span class='args'>(index_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
hides LocalIndex#rebuild_index to implement index versioning
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 178</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L178">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='rebuild_index identifier id'>rebuild_index</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span>
  <span class='definition identifier id'>definition</span> <span class='assign token'>=</span> <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='get_index identifier id'>get_index</span><span class='lparen token'>(</span><span class='index_name identifier id'>index_name</span><span class='rparen token'>)</span><span class='dot token'>.</span><span class='index_definition identifier id'>index_definition</span><span class='dot token'>.</span><span class='dup identifier id'>dup</span>
  <span class='models identifier id'>models</span> <span class='assign token'>=</span> <span class='definition identifier id'>definition</span><span class='lbrack token'>[</span><span class='symbol val'>:registered_models</span><span class='rbrack token'>]</span>
  <span class='index identifier id'>index</span> <span class='assign token'>=</span> <span class='new_index_for identifier id'>new_index_for</span><span class='lparen token'>(</span><span class='definition identifier id'>definition</span><span class='rparen token'>)</span>
  <span class='comment val'># TODO fix reconnection stuff</span>
  <span class='comment val'>#  reconnect_when_needed(clazz) do</span>
  <span class='comment val'>#    @logger.debug &quot;DRb server: rebuild index for class(es) #{models.inspect} in #{index.options[:path]}&quot;</span>
  <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='index_models identifier id'>index_models</span> <span class='models identifier id'>models</span>
  <span class='comment val'>#  end</span>
  <span class='new_version identifier id'>new_version</span> <span class='assign token'>=</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='join identifier id'>join</span> <span class='definition identifier id'>definition</span><span class='lbrack token'>[</span><span class='symbol val'>:index_base_dir</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span><span class='dot token'>.</span><span class='utc identifier id'>utc</span><span class='dot token'>.</span><span class='strftime identifier id'>strftime</span><span class='lparen token'>(</span><span class='string val'>'%Y%m%d%H%M%S'</span><span class='rparen token'>)</span>
  <span class='comment val'># create a unique directory name (needed for unit tests where </span>
  <span class='comment val'># multiple rebuilds per second may occur)</span>
  <span class='if if kw'>if</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='new_version identifier id'>new_version</span><span class='rparen token'>)</span>
    <span class='i identifier id'>i</span> <span class='assign token'>=</span> <span class='integer val'>0</span>
    <span class='i identifier id'>i</span><span class='opasgn op'>+=</span><span class='integer val'>1</span> <span class='while while_mod kw'>while</span> <span class='File constant id'>File</span><span class='dot token'>.</span><span class='exists? fid id'>exists?</span><span class='lparen token'>(</span><span class='dstring node'>&quot;#{new_version}_#{i}&quot;</span><span class='rparen token'>)</span>
    <span class='new_version identifier id'>new_version</span> <span class='lshft op'>&lt;&lt;</span> <span class='dstring node'>&quot;_#{i}&quot;</span>
  <span class='end end kw'>end</span>
    
  <span class='File constant id'>File</span><span class='dot token'>.</span><span class='rename identifier id'>rename</span> <span class='index identifier id'>index</span><span class='dot token'>.</span><span class='options identifier id'>options</span><span class='lbrack token'>[</span><span class='symbol val'>:path</span><span class='rbrack token'>]</span><span class='comma token'>,</span> <span class='new_version identifier id'>new_version</span>
  <span class='ActsAsFerret constant id'>ActsAsFerret</span><span class='colon2 op'>::</span><span class='change_index_dir identifier id'>change_index_dir</span> <span class='index_name identifier id'>index_name</span><span class='comma token'>,</span> <span class='new_version identifier id'>new_version</span> 
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>register_class</h3>
</div><div id="register_class-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>register_class</span><span class='args'>(class_name)</span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 152</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L152">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">152
153
154
155
156
157</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='register_class identifier id'>register_class</span><span class='lparen token'>(</span><span class='class_name identifier id'>class_name</span><span class='rparen token'>)</span>
  <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;############ registerclass #{class_name}&quot;</span>
  <span class='class_name identifier id'>class_name</span><span class='dot token'>.</span><span class='constantize identifier id'>constantize</span>
  <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='debug identifier id'>debug</span> <span class='dstring node'>&quot;index for class #{class_name}: #{ActsAsFerret::ferret_indexes[class_name.underscore.to_sym]}&quot;</span>

<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run</h3>
</div><div id="run-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
run the server and block until it exits
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 91</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L91">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">91
92
93
94</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='run identifier id'>run</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;ferret_server not configured for #{RAILS_ENV}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='@cfg ivar id'>@cfg</span><span class='dot token'>.</span><span class='uri identifier id'>uri</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='run_drb_service identifier id'>run_drb_service</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>run_drb_service</h3>
</div><div id="run_drb_service-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>run_drb_service</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 96</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L96">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">96
97
98
99
100
101
102
103
104</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='run_drb_service identifier id'>run_drb_service</span>
  <span class='$stdout gvar id'>$stdout</span><span class='dot token'>.</span><span class='puts identifier id'>puts</span><span class='lparen token'>(</span><span class='string val'>&quot;starting ferret server...&quot;</span><span class='rparen token'>)</span>
  <span class='self self kw'>self</span><span class='dot token'>.</span><span class='class identifier id'>class</span><span class='dot token'>.</span><span class='running identifier id'>running</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
  <span class='DRb constant id'>DRb</span><span class='dot token'>.</span><span class='start_service identifier id'>start_service</span><span class='lparen token'>(</span><span class='@cfg ivar id'>@cfg</span><span class='dot token'>.</span><span class='uri identifier id'>uri</span><span class='comma token'>,</span> <span class='self self kw'>self</span><span class='rparen token'>)</span>
  <span class='DRb constant id'>DRb</span><span class='dot token'>.</span><span class='thread identifier id'>thread</span><span class='dot token'>.</span><span class='join identifier id'>join</span>
<span class='rescue rescue kw'>rescue</span> <span class='Exception constant id'>Exception</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='e identifier id'>e</span>
  <span class='@logger ivar id'>@logger</span><span class='dot token'>.</span><span class='error identifier id'>error</span><span class='lparen token'>(</span><span class='e identifier id'>e</span><span class='dot token'>.</span><span class='to_s identifier id'>to_s</span><span class='rparen token'>)</span>
  <span class='raise identifier id'>raise</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
    <div class="method">
      <div class="method_header">
  <h3>start</h3>
</div><div id="start-instance_method" class="section method">
  <div class="details_title">
  <div class='section methodsignature'>
  <tt class='def'>
    <span class='visibility'>public</span>
    <span class='return_types'></span>
    <span class='name'>start</span><span class='args'></span>
    <span class='block'></span>
  </tt>
</div>

</div><div class="section docstring">
  <p>
start the server as a daemon process
</p>

</div></div>
<div class="section source">
  <span>[<a class="source_link" href="#">View source</a>]</span>
  <div class="files" style="display:none">
    <div class="file">
      <div class="meta">
        <div class="info">
          <span>File 'lib/ferret_server.rb', line 84</span>
        </div>
        <div class="actions">      
          <a id="raw-url" href="http://github.com/jkraemer/acts_as_ferret/blob/2a9969a832fa6eb6dc34a962173edfa84e1e8783/lib/ferret_server.rb#L84">raw</a>      
        </div>
      </div>
            
      <div class="data syntax">    
        <table cellspacing="0" cellpadding="0">
          <tbody>
            <tr>
              <td>            
                <pre class="line_numbers">84
85
86
87</pre>
              </td>
              <td width="100%">                    
                <div class="highlight"><pre class="code"><span class='def def kw'>def</span> <span class='start identifier id'>start</span>
  <span class='raise identifier id'>raise</span> <span class='dstring node'>&quot;ferret_server not configured for #{RAILS_ENV}&quot;</span> <span class='unless unless_mod kw'>unless</span> <span class='lparen token'>(</span><span class='@cfg ivar id'>@cfg</span><span class='dot token'>.</span><span class='uri identifier id'>uri</span> <span class='rescue rescue kw'>rescue</span> <span class='nil nil kw'>nil</span><span class='rparen token'>)</span>
  <span class='platform_daemon identifier id'>platform_daemon</span> <span class='lbrace token'>{</span> <span class='run_drb_service identifier id'>run_drb_service</span> <span class='rbrace token'>}</span>
<span class='end end kw'>end</span>
</pre></div>          
              </td>
            </tr>
          </tbody>
        </table>    
      </div>
    </div>  
  </div>
</div>
<div>
</div>
    </div>
  
</div>
  </div>

</div>
</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>