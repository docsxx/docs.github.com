<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>nofxx's postgis_adapter - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/nofxx/commits/postgis_adapter/master" rel="alternate" title="Recent Commits to postgis_adapter:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("nofxx", "postgis_adapter", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='nofxx/postgis_adapter/blob/0db69808f9d4f6c0e3b91660d928d8192ed23a20' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='nofxx/postgis_adapter/blob/0db69808f9d4f6c0e3b91660d928d8192ed23a20' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("nofxx", "postgis_adapter", "0db69808f9d4f6c0e3b91660d928d8192ed23a20", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/nofxx/postgis_adapter/tree/">Source</a></li>
            <li class=""><a href="http://github.com/nofxx/postgis_adapter/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/nofxx/postgis_adapter/network">Network</a></li>            
            <li class=""><a href="http://github.com/nofxx/postgis_adapter/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/nofxx/postgis_adapter">Wiki</a></li>
            <li class=""><a href="http://github.com/nofxx/postgis_adapter/graphs">Graphs</a></li>                    
            <li class="active"><a href="/nofxx/postgis_adapter">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/nofxx">nofxx</a> / <b><a href="http://github.com/nofxx/postgis_adapter/tree">postgis_adapter</a></b>        
                <a id="namespaces_button" rel="nofxx/postgis_adapter/blob/0db69808f9d4f6c0e3b91660d928d8192ed23a20" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="nofxx/postgis_adapter/blob/0db69808f9d4f6c0e3b91660d928d8192ed23a20" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>PostgisAdapter</h1>
<p>
A plugin for ActiveRecord which manages the PostGIS geometric columns in a
transparent way (that is like the other base data type columns). It also
provides a way to manage these columns in migrations.
</p>
<p>
This fork adds handy methods to make geometrical calculations on postgis.
Based on http://georuby.rubyforge.org Spatial Adapter
</p>
<p>
Postgis Manual - http://postgis.refractions.net/documentation/manual-svn
</p>
<p>
*PostGIS and Rails 2+ only*.
</p>
<h2>Install</h2>
<p>
If you are using Spatial Adapter, *remove it first*.
</p>
<h3>Dependencies</h3>
<ul>
<li>georuby

</li>
<li>postgres 8.3<tt>

</li>
<li>postgis 1.3</tt>

</li>
</ul>
<h3>As gem:</h3>
<pre class="code">
    <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='postgis identifier id'>postgis</span><span class='minus op'>-</span><span class='adapter identifier id'>adapter</span>
</pre>
<p>
Rails:
</p>
<pre class="code">
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>&quot;postgis_adapter&quot;</span>
</pre>
<p>
Github version:
</p>
<pre class="code">
    <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='nofxx identifier id'>nofxx</span><span class='minus op'>-</span><span class='postgis_adapter identifier id'>postgis_adapter</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='source identifier id'>source</span> <span class='http identifier id'>http</span><span class='symbol val'>:/</span><span class='regexp val'>/gems.github.com
</span></pre>
<p>
Rails:
</p>
<pre class="code">
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>&quot;nofxx-postgis_adapter&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:lib</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;postgis_adapter&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:source</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;http://gems.github.com&quot;</span>
</pre>
<h3>As plugin:</h3>
<pre class="code">
    <span class='script identifier id'>script</span><span class='div op'>/</span><span class='plugin identifier id'>plugin</span> <span class='install identifier id'>install</span> <span class='git identifier id'>git</span><span class='symbol val'>:/</span><span class='regexp val'>/github.com/n</span><span class='ofxx identifier id'>ofxx</span><span class='div op'>/</span><span class='postgis_adapter identifier id'>postgis_adapter</span><span class='dot token'>.</span><span class='git identifier id'>git</span>
</pre>
<h2>How to Use</h2>
<p>
Geometric columns in your ActiveRecord models now appear just like any
other column of other basic data types. They can also be dumped in ruby
schema mode and loaded in migrations the same way as columns of basic
types.
</p>
<h3>Model</h3>
<pre class="code">
    <span class='class class kw'>class</span> <span class='TablePoint constant id'>TablePoint</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
    <span class='end end kw'>end</span>
</pre>
<p>
That was easy! As you see, there is no need to declare a column as
geometric. The plugin will get this information by itself.
</p>
<p>
Here is an example of PostGIS row creation and access, using the model and
the table defined above :
</p>
<pre class="code">
        <span class='pt identifier id'>pt</span> <span class='assign token'>=</span> <span class='TablePoint constant id'>TablePoint</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span><span class='symbol val'>:data</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;Hello!&quot;</span><span class='comma token'>,</span><span class='symbol val'>:geom</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Point constant id'>Point</span><span class='dot token'>.</span><span class='from_x_y identifier id'>from_x_y</span><span class='lparen token'>(</span><span class='integer val'>1</span><span class='comma token'>,</span><span class='integer val'>2</span><span class='rparen token'>)</span><span class='rparen token'>)</span>
        <span class='pt identifier id'>pt</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
        <span class='pt identifier id'>pt</span> <span class='assign token'>=</span> <span class='TablePoint constant id'>TablePoint</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
        <span class='puts identifier id'>puts</span> <span class='pt identifier id'>pt</span><span class='dot token'>.</span><span class='geom identifier id'>geom</span><span class='dot token'>.</span><span class='x identifier id'>x</span>
        <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1</span>
</pre>
<h2>PostGIS Functions</h2>
<p>
Here are this fork additions. To use it:
</p>
<pre class="code">
    <span class='class class kw'>class</span> <span class='Street constant id'>Street</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Base constant id'>Base</span>
      <span class='acts_as_geom identifier id'>acts_as_geom</span> <span class='symbol val'>:line</span>
    <span class='end end kw'>end</span>

    <span class='dot3 op'>...</span>

    <span class='@place ivar id'>@place</span>  <span class='assign token'>=</span>   <span class='Poi constant id'>Poi</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>    <span class='symbol val'>:data</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>   <span class='pow op'>**</span><span class='Point constant id'>Point</span><span class='pow op'>**</span>      <span class='rparen token'>)</span>
    <span class='@park ivar id'>@park</span>   <span class='assign token'>=</span>   <span class='Park constant id'>Park</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span>   <span class='symbol val'>:area</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span>  <span class='pow op'>**</span><span class='Polygon constant id'>Polygon</span><span class='pow op'>**</span>     <span class='rparen token'>)</span>
    <span class='@street ivar id'>@street</span> <span class='assign token'>=</span>   <span class='Street constant id'>Street</span><span class='dot token'>.</span><span class='new identifier id'>new</span><span class='lparen token'>(</span> <span class='symbol val'>:line</span>  <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='pow op'>**</span><span class='LineString constant id'>LineString</span><span class='pow op'>**</span>   <span class='rparen token'>)</span>
</pre>
<h2>Play!</h2>
<pre class="code">
    <span class='@place ivar id'>@place</span><span class='dot token'>.</span><span class='inside? fid id'>inside?</span><span class='lparen token'>(</span><span class='@park ivar id'>@park</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>

    <span class='@place ivar id'>@place</span><span class='dot token'>.</span><span class='in_bounds? fid id'>in_bounds?</span><span class='lparen token'>(</span><span class='@park ivar id'>@park</span><span class='comma token'>,</span> <span class='integer val'>0</span><span class='integer val'>.5</span><span class='rparen token'>)</span> <span class='comment val'># margin</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>

    <span class='@place ivar id'>@place</span><span class='dot token'>.</span><span class='outside? fid id'>outside?</span><span class='lparen token'>(</span><span class='@park ivar id'>@park</span><span class='rparen token'>)</span>

    <span class='@street ivar id'>@street</span><span class='dot token'>.</span><span class='crosses? fid id'>crosses?</span><span class='lparen token'>(</span><span class='@park ivar id'>@park</span><span class='rparen token'>)</span>

    <span class='@area ivar id'>@area</span><span class='dot token'>.</span><span class='contains? fid id'>contains?</span><span class='lparen token'>(</span><span class='@place ivar id'>@place</span><span class='rparen token'>)</span>
</pre>
<h3>Polygons:</h3>
<pre class="code">
    <span class='@park ivar id'>@park</span><span class='dot token'>.</span><span class='area identifier id'>area</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>1345</span>

    <span class='@park ivar id'>@park</span><span class='dot token'>.</span><span class='contains? fid id'>contains?</span><span class='lparen token'>(</span><span class='@point ivar id'>@point</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>

    <span class='@park ivar id'>@park</span><span class='dot token'>.</span><span class='overlaps? fid id'>overlaps?</span><span class='lparen token'>(</span><span class='@other_park ivar id'>@other_park</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>
</pre>
<p>
Supports transform (useful to transform SRID to UTM for area in Km^2)
</p>
<pre class="code">
    <span class='@park ivar id'>@park</span><span class='dot token'>.</span><span class='area identifier id'>area</span><span class='lparen token'>(</span><span class='SRID constant id'>SRID</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='Area constant id'>Area</span> <span class='with identifier id'>with</span> <span class='new identifier id'>new</span> <span class='SRID constant id'>SRID</span>
</pre>
<h3>Line Strings:</h3>
<pre class="code">
    <span class='@street_east ivar id'>@street_east</span><span class='dot token'>.</span><span class='intersects? fid id'>intersects?</span><span class='lparen token'>(</span><span class='@street_west ivar id'>@street_west</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>

    <span class='@street_central ivar id'>@street_central</span><span class='dot token'>.</span><span class='length identifier id'>length</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>4508.53636</span>

    <span class='@street_central ivar id'>@street_central</span><span class='dot token'>.</span><span class='length identifier id'>length</span><span class='lparen token'>(</span><span class='symbol val'>:miles</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>2.81798593</span>

    <span class='@street ivar id'>@street</span><span class='dot token'>.</span><span class='length_spheroid identifier id'>length_spheroid</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='float val'>4.40853636</span>
</pre>
<h3>Class Methods</h3>
<pre class="code">
    <span class='City constant id'>City</span><span class='dot token'>.</span><span class='close_to identifier id'>close_to</span><span class='lparen token'>(</span><span class='@point ivar id'>@point</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='Array constant id'>Array</span> <span class='of identifier id'>of</span> <span class='cities identifier id'>cities</span> <span class='in in kw'>in</span> <span class='order identifier id'>order</span> <span class='by identifier id'>by</span> <span class='distance identifier id'>distance</span><span class='dot3 op'>...</span>

    <span class='Street constant id'>Street</span><span class='dot token'>.</span><span class='close_to identifier id'>close_to</span><span class='lparen token'>(</span><span class='@point ivar id'>@point</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='Array constant id'>Array</span> <span class='streets identifier id'>streets</span> <span class='in in kw'>in</span> <span class='order identifier id'>order</span> <span class='by identifier id'>by</span> <span class='distance identifier id'>distance</span><span class='dot3 op'>...</span>

    <span class='Country constant id'>Country</span><span class='dot token'>.</span><span class='contain identifier id'>contain</span><span class='lparen token'>(</span><span class='@point ivar id'>@point</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='The constant id'>The</span> <span class='Conutry constant id'>Conutry</span> <span class='that identifier id'>that</span> <span class='contains identifier id'>contains</span> <span class='the identifier id'>the</span> <span class='point identifier id'>point</span>

    <span class='Areas constant id'>Areas</span><span class='dot token'>.</span><span class='contains identifier id'>contains</span><span class='lparen token'>(</span><span class='@point ivar id'>@point</span><span class='rparen token'>)</span>
    <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='lbrack token'>[</span><span class='Array constant id'>Array</span> <span class='of identifier id'>of</span> <span class='areas identifier id'>areas</span> <span class='contains identifier id'>contains</span> <span class='the identifier id'>the</span> <span class='point identifier id'>point</span><span class='dot3 op'>...</span>
</pre>
<h3>BBox Support</h3>
<pre class="code">
    <span class='@area ivar id'>@area</span><span class='dot token'>.</span><span class='strictly_left_of? fid id'>strictly_left_of?</span> <span class='@point ivar id'>@point</span>

    <span class='@area ivar id'>@area</span><span class='dot token'>.</span><span class='overlaps_or_above? fid id'>overlaps_or_above?</span> <span class='@street ivar id'>@street</span>

    <span class='dot3 op'>...</span>

    <span class='completely_contained_by? fid id'>completely_contained_by?</span>
    <span class='completely_contains? fid id'>completely_contains?</span>
    <span class='overlaps_or_above? fid id'>overlaps_or_above?</span>
    <span class='overlaps_or_below? fid id'>overlaps_or_below?</span>
    <span class='overlaps_or_left_of? fid id'>overlaps_or_left_of?</span>
    <span class='overlaps_or_right_of? fid id'>overlaps_or_right_of?</span>
    <span class='strictly_above? fid id'>strictly_above?</span>
    <span class='strictly_below? fid id'>strictly_below?</span>
    <span class='strictly_left_of? fid id'>strictly_left_of?</span>
    <span class='strictly_right_of? fid id'>strictly_right_of?</span>
    <span class='interacts_with? fid id'>interacts_with?</span>
    <span class='binary_equal? fid id'>binary_equal?</span>
    <span class='same_as? fid id'>same_as?</span>
</pre>
<p>
Or use a (almost) PostGIS like notation:
</p>
<pre class="code">
    <span class='@area ivar id'>@area</span><span class='dot token'>.</span><span class='bbox identifier id'>bbox</span> <span class='string val'>&quot;&lt;&lt;&quot;</span><span class='comma token'>,</span> <span class='@point ivar id'>@point</span>

    <span class='@area ivar id'>@area</span><span class='dot token'>.</span><span class='bbox identifier id'>bbox</span> <span class='string val'>&quot;|&gt;&gt;&quot;</span><span class='comma token'>,</span> <span class='@point ivar id'>@point</span>

    <span class='@area ivar id'>@area</span><span class='dot token'>.</span><span class='bbox identifier id'>bbox</span> <span class='string val'>&quot;@&quot;</span><span class='comma token'>,</span>  <span class='@park ivar id'>@park</span>
</pre>
<h3>Warning</h3>
<p>
*To be fixed:*
</p>
<p>
This only supports one geom column per model. Still looking for the best
way to implement a multi geom.
</p>
<p>
http://nofxx.lighthouseapp.com/projects/20712/tickets/3-multiple-geoms-in-model
</p>
<h3>Wiki</h3>
<p>
Check out the wiki pages (http://github.com/nofxx/postgis_adapter/wikis).
For all functions.
</p>
<h3>Find_by</h3>
<p>
find_by_*column* has been redefined when column is of a geometric type.
Instead of using the Rails default &#8217;=&#8217; operator, for which I
can&#8217;t see a definition for MySql spatial datatypes and which performs
a bounding box equality test in PostGIS, it uses a bounding box
intersection: &amp;&amp; in PostGIS and MBRIntersects in MySQL, which can
both make use of a spatial index if one is present to speed up the queries.
You could use this query, for example, if you need to display data from the
database: You would want only the geometries which are in the screen
rectangle and you could use a bounding box query for that. Since this is a
common case, it is the default. You have 2 ways to use the
find_by_*geom_column*: Either by passing a geometric object directly, or
passing an array with the 2 opposite corners of a bounding box (with 2 or 3
coordinates depending of the dimension of the data).
</p>
<pre class="code">
        <span class='Park constant id'>Park</span><span class='dot token'>.</span><span class='find_by_geom identifier id'>find_by_geom</span><span class='lparen token'>(</span><span class='LineString constant id'>LineString</span><span class='dot token'>.</span><span class='from_coordinates identifier id'>from_coordinates</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='float val'>1.4</span><span class='comma token'>,</span><span class='float val'>5.6</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='float val'>2.7</span><span class='comma token'>,</span><span class='float val'>8.9</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='float val'>1.6</span><span class='comma token'>,</span><span class='float val'>5.6</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rparen token'>)</span><span class='rparen token'>)</span>

  <span class='or or kw'>or</span>

        <span class='Park constant id'>Park</span><span class='dot token'>.</span><span class='find_by_geom identifier id'>find_by_geom</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='comma token'>,</span><span class='float val'>5.6</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='float val'>19.98</span><span class='comma token'>,</span><span class='float val'>5.9</span><span class='rbrack token'>]</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
</pre>
<p>
In PostGIS, since you can only use operations with geometries with the same
SRID, you can add a third element representing the SRID of the bounding box
to the array. It is by default set to -1:
</p>
<pre class="code">
        <span class='Park constant id'>Park</span><span class='dot token'>.</span><span class='find_by_geom identifier id'>find_by_geom</span><span class='lparen token'>(</span><span class='lbrack token'>[</span><span class='lbrack token'>[</span><span class='integer val'>3</span><span class='comma token'>,</span><span class='float val'>5.6</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='lbrack token'>[</span><span class='float val'>19.98</span><span class='comma token'>,</span><span class='float val'>5.9</span><span class='rbrack token'>]</span><span class='comma token'>,</span><span class='integer val'>123</span><span class='rbrack token'>]</span><span class='rparen token'>)</span>
</pre>
<h2>Database Tools</h2>
<h3>Migrations</h3>
<p>
Here is an example of code for the creation of a table with a geometric
column in PostGIS, along with the addition of a spatial index on the column
:
</p>
<pre class="code">
    <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Schema constant id'>Schema</span><span class='dot token'>.</span><span class='define identifier id'>define</span> <span class='do do kw'>do</span>
      <span class='create_table identifier id'>create_table</span> <span class='symbol val'>:places</span> <span class='do do kw'>do</span> <span class='bitor op'>|</span><span class='t identifier id'>t</span><span class='bitor op'>|</span>
        <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='string identifier id'>string</span>   <span class='symbol val'>:name</span>
        <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='point identifier id'>point</span>    <span class='symbol val'>:geom</span><span class='comma token'>,</span> <span class='symbol val'>:srid</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>4326</span><span class='comma token'>,</span> <span class='symbol val'>:with_z</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span><span class='comma token'>,</span> <span class='symbol val'>:null</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='false false kw'>false</span>

        <span class='t identifier id'>t</span><span class='dot token'>.</span><span class='timestamps identifier id'>timestamps</span>
      <span class='end end kw'>end</span>

      <span class='add_index identifier id'>add_index</span> <span class='symbol val'>:places</span><span class='comma token'>,</span> <span class='symbol val'>:geom</span><span class='comma token'>,</span> <span class='symbol val'>:spatial</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='true true kw'>true</span>
    <span class='end end kw'>end</span>
</pre>
<p>
Types:
</p>
<pre class="code">
    <span class='point identifier id'>point</span>
    <span class='polygon identifier id'>polygon</span>
    <span class='line_string identifier id'>line_string</span>
    <span class='multi_point identifier id'>multi_point</span>
    <span class='multi_polygon identifier id'>multi_polygon</span>
    <span class='multi_line_string identifier id'>multi_line_string</span>
    <span class='geometry identifier id'>geometry</span>
    <span class='geometry_collection identifier id'>geometry_collection</span>
</pre>
<h3>Fixtures</h3>
<p>
If you use fixtures for your unit tests, at some point, you will want to
input a geometry. You could transform your geometries to a form suitable
for YAML yourself everytime but the spatial adapter provides a method to do
it for you: <tt>to_yaml</tt>. It works for both MySQL and PostGIS (although
the string returned is different for each database). You would use it like
this, if the geometric column is a point:
</p>
<pre class="code">
    <span class='fixture identifier id'>fixture</span><span class='colon op'>:</span>
          <span class='id identifier id'>id</span><span class='colon op'>:</span> <span class='integer val'>1</span>
          <span class='data identifier id'>data</span><span class='colon op'>:</span> <span class='HELLO constant id'>HELLO</span>
          <span class='geom identifier id'>geom</span><span class='colon op'>:</span> <span class='lt op'>&lt;</span><span class='string val'>%= Point.from_x_y(123.5,321.9).to_yaml %&gt;
</span></pre>
<h3>Annotate</h3>
<p>
If you are using annotate_models, check out this fork which adds
geometrical annotations for PostgisAdapter and SpatialAdapter:
</p>
<p>
http://github.com/nofxx/annotate_models
</p>
<h2>Geometric data types</h2>
<p>
Ruby geometric datatypes are currently made available only through the
GeoRuby library (http://georuby.rubyforge.org): This is where the
*Point.from_x_y* in the example above comes from. It is a goal of a future
release of the Spatial Adapter to support additional geometric datatype
libraries, such as Ruby/GEOS, as long as they can support reading and
writing of EWKB.
</p>
<h3>Warning</h3>
<ul>
<li>Since ActiveRecord seems to keep only the string values directly

</li>
</ul>
<p>
returned from the database, it translates from these to the correct types
everytime an attribute is read, which is probably ok for simple types, but
might be less than efficient for geometries, since the EWKB string has to
be parsed everytime. Also it means you cannot modify the geometry object
returned from an attribute directly :
</p>
<pre class="code">
       <span class='place identifier id'>place</span> <span class='assign token'>=</span> <span class='Place constant id'>Place</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
       <span class='place identifier id'>place</span><span class='dot token'>.</span><span class='the_geom identifier id'>the_geom</span><span class='dot token'>.</span><span class='y identifier id'>y</span><span class='assign token'>=</span><span class='float val'>123456.7</span>
</pre>
<ul>
<li>Since the translation to a geometry is performed everytime the_geom

</li>
</ul>
<p>
is read, the change to y will not be saved! You would have to do something
like this :
</p>
<pre class="code">
       <span class='place identifier id'>place</span> <span class='assign token'>=</span> <span class='Place constant id'>Place</span><span class='dot token'>.</span><span class='first identifier id'>first</span>
       <span class='the_geom identifier id'>the_geom</span> <span class='assign token'>=</span> <span class='place identifier id'>place</span><span class='dot token'>.</span><span class='the_geom identifier id'>the_geom</span>
       <span class='the_geom identifier id'>the_geom</span><span class='dot token'>.</span><span class='y identifier id'>y</span><span class='assign token'>=</span><span class='float val'>123456.7</span>
       <span class='place identifier id'>place</span><span class='dot token'>.</span><span class='the_geom identifier id'>the_geom</span> <span class='assign token'>=</span> <span class='the_geom identifier id'>the_geom</span>
</pre>
<h2>License</h2>
<p>
Spatial Adapter for Rails is released under the MIT license. Postgis
Adapter is released under the MIT license.
</p>
<h2>Support</h2>
<p>
Tested using rails 2.2.2/2.3.0 / postgresql 8.3.5 / postgis 1.3.3 / linux /
osx
</p>
<p>
Any questions, enhancement proposals, bug notifications or corrections:
</p>
<h3>PostgisAdapter</h3>
<p>
Project Tracker
http://nofxx.lighthouseapp.com/projects/20712-postgis_adapter
</p>
<h3>SpatialAdapter</h3>
<p>
http://georuby.rubyforge.org guilhem.vellut+georuby@gmail.com.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> Â©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>