<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>pelle's oauth-plugin - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/pelle/commits/oauth-plugin/master" rel="alternate" title="Recent Commits to oauth-plugin:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("pelle", "oauth-plugin", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='pelle/oauth-plugin/blob/f6326703750bf32d128c3c591906b6b0285517cd' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='pelle/oauth-plugin/blob/f6326703750bf32d128c3c591906b6b0285517cd' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("pelle", "oauth-plugin", "f6326703750bf32d128c3c591906b6b0285517cd", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/pelle/oauth-plugin/tree/">Source</a></li>
            <li class=""><a href="http://github.com/pelle/oauth-plugin/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/pelle/oauth-plugin/network">Network</a></li>            
            <li class=""><a href="http://github.com/pelle/oauth-plugin/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/pelle/oauth-plugin">Wiki</a></li>
            <li class=""><a href="http://github.com/pelle/oauth-plugin/graphs">Graphs</a></li>                    
            <li class="active"><a href="/pelle/oauth-plugin">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/pelle">pelle</a> / <b><a href="http://github.com/pelle/oauth-plugin/tree">oauth-plugin</a></b>        
                <a id="namespaces_button" rel="pelle/oauth-plugin/blob/f6326703750bf32d128c3c591906b6b0285517cd" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="pelle/oauth-plugin/blob/f6326703750bf32d128c3c591906b6b0285517cd" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>OAuth Plugin</h1>
<p>
This is a plugin for implementing OAuth Providers and Consumers in Rails
applications.
</p>
<p>
We support the revised OAuth 1.0a specs at:
</p>
<p>
http://oauth.net/core/1.0a
</p>
<p>
and the OAuth site at:
</p>
<p>
http://oauth.net
</p>
<p>
For more about the changes made to OAuth1.0a please see Seth&#8217;s
Idiot&#8217;s Guide to OAuth 1.0a.
</p>
<p>
http://mojodna.net/2009/05/20/an-idiots-guide-to-oauth-10a.html
</p>
<h2>Requirements</h2>
<p>
You need to install the oauth gem (0.3.5) which is the core OAuth ruby
library. It will NOT work on any previous version of the gem.
</p>
<pre class="code">
  <span class='sudo identifier id'>sudo</span> <span class='gem identifier id'>gem</span> <span class='install identifier id'>install</span> <span class='oauth identifier id'>oauth</span>
</pre>
<p>
The Generator currently creates code (in particular views) that only work
in Rails 2.
</p>
<p>
It should not be difficult to manually modify the code to work on Rails
1.2.x
</p>
<p>
I think the only real issue is that the views have .html.erb extensions. So
these could theoretically just be renamed to .rhtml.
</p>
<p>
Please let me know if this works and I will see if I can make the generator
conditionally create .rhtml for pre 2.0 versions of RAILS.
</p>
<h2>OAuth Provider generator</h2>
<p>
While it isn&#8217;t very flexible at the moment there is an oauth_provider
generator which you can use like this:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='oauth_provider identifier id'>oauth_provider</span>
</pre>
<p>
This generates OAuth and OAuth client controllers as well as the required
models.
</p>
<p>
It requires an authentication framework such as acts_as_authenticated,
restful_authentication or restful_open_id_authentication. It also requires
Rails 2.0.
</p>
<h3>Generator Options</h3>
<p>
By default the generator generates RSpec and ERB templates. The generator
can instead create Test::Unit and/or HAML templates. To do this use the
following options:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='oauth_provider identifier id'>oauth_provider</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='test identifier id'>test</span><span class='minus op'>-</span><span class='unit identifier id'>unit</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='haml identifier id'>haml</span>
</pre>
<p>
These can of course be used individually as well.
</p>
<h3>User Model</h3>
<p>
Add the following lines to your user model:
</p>
<pre class="code">
  <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:client_applications</span>
  <span class='has_many identifier id'>has_many</span> <span class='symbol val'>:tokens</span><span class='comma token'>,</span> <span class='symbol val'>:class_name=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;OauthToken&quot;</span><span class='comma token'>,</span><span class='symbol val'>:order=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;authorized_at desc&quot;</span><span class='comma token'>,</span><span class='symbol val'>:include=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:client_application</span><span class='rbrack token'>]</span>
</pre>
<h3>Migrate database</h3>
<p>
The database is defined in:
</p>
<pre class="code">
  <span class='db identifier id'>db</span><span class='div op'>/</span><span class='migrate identifier id'>migrate</span><span class='div op'>/</span><span class='XXX_create_oauth_tables constant id'>XXX_create_oauth_tables</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
Run them as any other normal migration in rails with:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='db identifier id'>db</span><span class='symbol val'>:migrate</span>
</pre>
<h2>Upgrading from OAuth 1.0 to OAuth 1.0a</h2>
<p>
As the flow has changed slightly and there are a couple of database changes
it isn&#8217;t as simple as just updating the plugin. Please follow these
steps closely:
</p>
<h3>Add a migration</h3>
<p>
You need to add a migration:
</p>
<pre class="code">
  <span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='migration identifier id'>migration</span> <span class='upgrade_oauth identifier id'>upgrade_oauth</span>
</pre>
<p>
Make it look like this:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='UpgradeOauth constant id'>UpgradeOauth</span> <span class='lt op'>&lt;</span> <span class='ActiveRecord constant id'>ActiveRecord</span><span class='colon2 op'>::</span><span class='Migration constant id'>Migration</span>
    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='up identifier id'>up</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:oauth_tokens</span><span class='comma token'>,</span><span class='symbol val'>:callback_url</span><span class='comma token'>,</span><span class='symbol val'>:string</span>
      <span class='add_column identifier id'>add_column</span> <span class='symbol val'>:oauth_tokens</span><span class='comma token'>,</span><span class='symbol val'>:verifier</span><span class='comma token'>,</span><span class='symbol val'>:string</span><span class='comma token'>,</span><span class='symbol val'>:limit</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='integer val'>20</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='self self kw'>self</span><span class='dot token'>.</span><span class='down identifier id'>down</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:oauth_tokens</span><span class='comma token'>,</span><span class='symbol val'>:callback_url</span>
      <span class='remove_column identifier id'>remove_column</span> <span class='symbol val'>:oauth_tokens</span><span class='comma token'>,</span><span class='symbol val'>:verifier</span>
    <span class='end end kw'>end</span>
  <span class='end end kw'>end</span>
</pre>
<h3>Change code</h3>
<p>
There are changes to the following files:
</p>
<pre class="code">
  <span class='app identifier id'>app</span><span class='div op'>/</span><span class='models identifier id'>models</span><span class='div op'>/</span><span class='client_application identifier id'>client_application</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
  <span class='app identifier id'>app</span><span class='div op'>/</span><span class='models identifier id'>models</span><span class='div op'>/</span><span class='request_token identifier id'>request_token</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
  <span class='app identifier id'>app</span><span class='div op'>/</span><span class='controllers identifier id'>controllers</span><span class='div op'>/</span><span class='oauth_controller identifier id'>oauth_controller</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<h3>Changes in client_application.rb</h3>
<p>
Add the following towards the top of the model class
</p>
<pre class="code">
  <span class='attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:token_callback_url</span>
</pre>
<p>
Then change the create_request_token method to the following:
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='create_request_token identifier id'>create_request_token</span>
    <span class='RequestToken constant id'>RequestToken</span><span class='dot token'>.</span><span class='create identifier id'>create</span> <span class='symbol val'>:client_application</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span><span class='self self kw'>self</span><span class='comma token'>,</span><span class='symbol val'>:callback_url=</span><span class='gt op'>&gt;</span><span class='token_callback_url identifier id'>token_callback_url</span>
  <span class='end end kw'>end</span>
</pre>
<h3>Changes in request_token.rb</h3>
<p>
The RequestToken contains the bulk of the changes so it&#8217;s easiest to
list it in it&#8217;s entirety. Mainly we need to add support for the
oauth_verifier parameter and also tell the client that we support OAuth
1.0a.
</p>
<p>
Make sure it looks like this:
</p>
<pre class="code">
  <span class='class class kw'>class</span> <span class='RequestToken constant id'>RequestToken</span> <span class='lt op'>&lt;</span> <span class='OauthToken constant id'>OauthToken</span>

    <span class='attr_accessor identifier id'>attr_accessor</span> <span class='symbol val'>:provided_oauth_verifier</span>

    <span class='def def kw'>def</span> <span class='authorize! fid id'>authorize!</span><span class='lparen token'>(</span><span class='user identifier id'>user</span><span class='rparen token'>)</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='if if_mod kw'>if</span> <span class='authorized? fid id'>authorized?</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='user identifier id'>user</span> <span class='assign token'>=</span> <span class='user identifier id'>user</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='authorized_at identifier id'>authorized_at</span> <span class='assign token'>=</span> <span class='Time constant id'>Time</span><span class='dot token'>.</span><span class='now identifier id'>now</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='verifier identifier id'>verifier</span><span class='assign token'>=</span><span class='OAuth constant id'>OAuth</span><span class='colon2 op'>::</span><span class='Helper constant id'>Helper</span><span class='dot token'>.</span><span class='generate_key identifier id'>generate_key</span><span class='lparen token'>(</span><span class='integer val'>16</span><span class='rparen token'>)</span>
      <span class='self self kw'>self</span><span class='dot token'>.</span><span class='save identifier id'>save</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='exchange! fid id'>exchange!</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='authorized? fid id'>authorized?</span>
      <span class='return return kw'>return</span> <span class='false false kw'>false</span> <span class='unless unless_mod kw'>unless</span> <span class='verifier identifier id'>verifier</span><span class='eq op'>==</span><span class='provided_oauth_verifier identifier id'>provided_oauth_verifier</span>

      <span class='RequestToken constant id'>RequestToken</span><span class='dot token'>.</span><span class='transaction identifier id'>transaction</span> <span class='do do kw'>do</span>
        <span class='access_token identifier id'>access_token</span> <span class='assign token'>=</span> <span class='AccessToken constant id'>AccessToken</span><span class='dot token'>.</span><span class='create identifier id'>create</span><span class='lparen token'>(</span><span class='symbol val'>:user</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='user identifier id'>user</span><span class='comma token'>,</span> <span class='symbol val'>:client_application</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='client_application identifier id'>client_application</span><span class='rparen token'>)</span>
        <span class='invalidate! fid id'>invalidate!</span>
        <span class='access_token identifier id'>access_token</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>

    <span class='def def kw'>def</span> <span class='to_query identifier id'>to_query</span>
      <span class='dstring node'>&quot;#{super}&amp;oauth_callback_confirmed=true&quot;</span>
    <span class='end end kw'>end</span>

  <span class='end end kw'>end</span>
</pre>
<h3>Changes in oauth_controller</h3>
<p>
All you need to do here is the change the authorize action to use the
request_token callback url and add the oauth_verifier to the callback url.
</p>
<pre class="code">
  <span class='def def kw'>def</span> <span class='authorize identifier id'>authorize</span>
      <span class='@token ivar id'>@token</span> <span class='assign token'>=</span> <span class='RequestToken constant id'>RequestToken</span><span class='dot token'>.</span><span class='find_by_token identifier id'>find_by_token</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:oauth_token</span><span class='rbrack token'>]</span>
      <span class='unless unless kw'>unless</span> <span class='@token ivar id'>@token</span><span class='dot token'>.</span><span class='invalidated? fid id'>invalidated?</span>
        <span class='if if kw'>if</span> <span class='request identifier id'>request</span><span class='dot token'>.</span><span class='post? fid id'>post?</span>
          <span class='if if kw'>if</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:authorize</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>'1'</span>
            <span class='@token ivar id'>@token</span><span class='dot token'>.</span><span class='authorize! fid id'>authorize!</span><span class='lparen token'>(</span><span class='current_user identifier id'>current_user</span><span class='rparen token'>)</span>
            <span class='redirect_url identifier id'>redirect_url</span> <span class='assign token'>=</span> <span class='@token ivar id'>@token</span><span class='dot token'>.</span><span class='callback_url identifier id'>callback_url</span> <span class='orop op'>||</span> <span class='@token ivar id'>@token</span><span class='dot token'>.</span><span class='client_application identifier id'>client_application</span><span class='dot token'>.</span><span class='callback_url identifier id'>callback_url</span>
            <span class='if if kw'>if</span> <span class='redirect_url identifier id'>redirect_url</span>
              <span class='redirect_to identifier id'>redirect_to</span> <span class='dstring node'>&quot;#{redirect_url}?oauth_token=#{@token.token}&amp;oauth_verifier=#{@token.verifier}&quot;</span>
            <span class='else else kw'>else</span>
              <span class='render identifier id'>render</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;authorize_success&quot;</span>
            <span class='end end kw'>end</span>
          <span class='elsif elsif kw'>elsif</span> <span class='params identifier id'>params</span><span class='lbrack token'>[</span><span class='symbol val'>:authorize</span><span class='rbrack token'>]</span> <span class='eq op'>==</span> <span class='string val'>&quot;0&quot;</span>
            <span class='@token ivar id'>@token</span><span class='dot token'>.</span><span class='invalidate! fid id'>invalidate!</span>
            <span class='render identifier id'>render</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;authorize_failure&quot;</span>
          <span class='end end kw'>end</span>
        <span class='end end kw'>end</span>
      <span class='else else kw'>else</span>
        <span class='render identifier id'>render</span> <span class='symbol val'>:action</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>&quot;authorize_failure&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
</pre>
<p>
The rest of the changes are in the plugin and will be automatically be
included.
</p>
<p>
<b>Note</b> OAuth 1.0a removes support for callback url&#8217;s passed to
the authorize page, clients must either define a callback url in their
client application or pass one on the token request page.
</p>
<h2>Protecting your actions</h2>
<p>
I recommend that you think about what your users would want to provide
access to and limit oauth for those only. For example in a CRUD controller
you may think about if you want to let consumer applications do the create,
update or delete actions. For your application this might make sense, but
for others maybe not.
</p>
<p>
If you want to give oauth access to everything a registered user can do,
just replace the filter you have in your controllers with:
</p>
<pre class="code">
  <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:login_or_oauth_required</span>
</pre>
<p>
If you want to restrict consumers to the index and show methods of your
controller do the following:
</p>
<pre class="code">
  <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:login_required</span><span class='comma token'>,</span><span class='symbol val'>:except=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:show</span><span class='comma token'>,</span><span class='symbol val'>:index</span><span class='rbrack token'>]</span>
  <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:login_or_oauth_required</span><span class='comma token'>,</span><span class='symbol val'>:only=</span><span class='gt op'>&gt;</span><span class='lbrack token'>[</span><span class='symbol val'>:show</span><span class='comma token'>,</span><span class='symbol val'>:index</span><span class='rbrack token'>]</span>
</pre>
<p>
If you have an action you only want used via oauth:
</p>
<pre class="code">
  <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:oauth_required</span>
</pre>
<p>
All of these places the tokens user in current_user as you would expect. It
also exposes the following methods:
</p>
<ul>
<li>current_token - for accessing the token used to authorize the current
request

</li>
<li>current_client_application - for accessing information about which consumer
is currently accessing your request

</li>
</ul>
<p>
You could add application specific information to the OauthToken and
ClientApplication model for such things as object level access control,
billing, expiry etc. Be creative and you can create some really cool
applications here.
</p>
<h2>OAuth Consumer generator</h2>
<p>
The oauth_consumer generator creates a controller to manage the
authentication flow between your application and any number of external
OAuth secured applications that you wish to connect to.
</p>
<p>
To run it simply run:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='oauth_consumer identifier id'>oauth_consumer</span>
</pre>
<p>
This generates the OauthConsumerController as well as the ConsumerToken
model.
</p>
<h3>Generator Options</h3>
<p>
By default the generator generates ERB templates. The generator can instead
create HAML templates. To do this use the following options:
</p>
<pre class="code">
  <span class='dot token'>.</span><span class='div op'>/</span><span class='script identifier id'>script</span><span class='div op'>/</span><span class='generate identifier id'>generate</span> <span class='oauth_consumer identifier id'>oauth_consumer</span> <span class='minus op'>-</span><span class='minus op'>-</span><span class='haml identifier id'>haml</span>
</pre>
<h3>Configuration</h3>
<p>
All configuration of applications is done in
</p>
<pre class="code">
  <span class='config identifier id'>config</span><span class='div op'>/</span><span class='initializers identifier id'>initializers</span><span class='div op'>/</span><span class='oauth_consumers identifier id'>oauth_consumers</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
Add entries to OAUTH_CREDENTIALS for all OAuth Applications you wish to
connect to. Get this information by registering your application at the
particular applications developer page.
</p>
<pre class="code">
  <span class='OAUTH_CREDENTIALS constant id'>OAUTH_CREDENTIALS</span><span class='assign token'>=</span><span class='lbrace token'>{</span>
    <span class='symbol val'>:twitter=</span><span class='gt op'>&gt;</span><span class='lbrace token'>{</span>
      <span class='symbol val'>:key=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;key&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:secret=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;secret&quot;</span>
    <span class='rbrace token'>}</span><span class='comma token'>,</span>
    <span class='symbol val'>:agree2=</span><span class='gt op'>&gt;</span><span class='lbrace token'>{</span>
      <span class='symbol val'>:key=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;key&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:secret=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;secret&quot;</span>
    <span class='rbrace token'>}</span><span class='comma token'>,</span>
    <span class='symbol val'>:hour_feed=</span><span class='gt op'>&gt;</span><span class='lbrace token'>{</span>
      <span class='symbol val'>:key=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:secret=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:options=</span><span class='lbrace token'>{</span>
        <span class='symbol val'>:site=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;http://hourfeed.com&quot;</span>
      <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span><span class='comma token'>,</span>
    <span class='symbol val'>:nu_bux=</span><span class='gt op'>&gt;</span><span class='lbrace token'>{</span>
      <span class='symbol val'>:key=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:secret=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;&quot;</span><span class='comma token'>,</span>
      <span class='symbol val'>:super_class=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;OpenTransactToken&quot;</span><span class='comma token'>,</span>  <span class='comment val'># if a OAuth service follows a particular standard</span>
                                          <span class='comment val'># with a token implementation you can set the superclass</span>
                                          <span class='comment val'># to use</span>
      <span class='symbol val'>:options=</span><span class='gt op'>&gt;</span><span class='lbrace token'>{</span>
        <span class='symbol val'>:site=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;http://nubux.heroku.com&quot;</span>
      <span class='rbrace token'>}</span>
    <span class='rbrace token'>}</span>
  <span class='rbrace token'>}</span>
</pre>
<p>
You can add any of the options that the OAuth::Consumer.new accepts to the
options hash: http://oauth.rubyforge.org/rdoc/classes/OAuth/Consumer.html
</p>
<p>
:key, :secret are required as well as :options[:site] etc. for non custom
ConsumerToken services.
</p>
<h3>ConsumerToken models</h3>
<p>
For each site setup in the OAUTH_CREDENTIALS hash the plugin goes through
and loads or creates a new model class that subclasses ConsumerToken.
</p>
<p>
eg. If you connect to Yahoo&#8217;s FireEagle you would add the :fire_eagle
entry to OAUTH_CREDENTIALS and a new FireEagleToken model class will be
created on the fly.
</p>
<p>
This allows you to add a has_one association in your user model:
</p>
<pre class="code">
  <span class='has_one identifier id'>has_one</span>  <span class='symbol val'>:fire_eagle</span><span class='comma token'>,</span><span class='symbol val'>:class_name=</span><span class='gt op'>&gt;</span><span class='string val'>&quot;FireEagleToken&quot;</span><span class='comma token'>,</span> <span class='symbol val'>:dependent=</span><span class='gt op'>&gt;</span><span class='symbol val'>:destroy</span>
</pre>
<p>
And you could do:
</p>
<pre class="code">
  <span class='@location ivar id'>@location</span><span class='assign token'>=</span><span class='@user ivar id'>@user</span><span class='dot token'>.</span><span class='fire_eagle identifier id'>fire_eagle</span><span class='dot token'>.</span><span class='client identifier id'>client</span><span class='dot token'>.</span><span class='get identifier id'>get</span> <span class='string val'>&quot;/api/0.1/user.json&quot;</span>
</pre>
<p>
The client method gives you a OAuth::AccessToken which you can use to
perform rest operations on the client site - see
http://oauth.rubyforge.org/rdoc/classes/OAuth/AccessToken.html
</p>
<h3>Custom ConsumerToken models</h3>
<p>
Before creating the FireEagleToken model the plugin checks if a class
already exists by that name or if we provide an api wrapper for it. This
allows you to create a better token model that uses an existing ruby gem.
</p>
<p>
Currently we provide the following untested tokens:
</p>
<ul>
<li>Twitter (Will work when the twitter gem is updated to support OAuth 0.3.5)

</li>
<li>Agree2

</li>
</ul>
<p>
These can be found in lib/oauth/models/consulers/services. Contributions
will be warmly accepted for your favorite OAuth service.
</p>
<h3>The OauthConsumerController</h3>
<p>
To connect a user to an external service link or redirect them to:
</p>
<pre class="code">
  <span class='regexp val'>/oauth_consumers/</span><span class='lbrack token'>[</span><span class='SERVICE_NAME constant id'>SERVICE_NAME</span><span class='rbrack token'>]</span>
</pre>
<p>
Where SERVICE_NAME is the name you set in the OAUTH_CREDENTIALS hash. This
will request the request token and redirect the user to the services
authorization screen. When the user accepts the get redirected back to:
</p>
<pre class="code">
  <span class='regexp val'>/oauth_consumers/</span><span class='lbrack token'>[</span><span class='SERVICE_NAME constant id'>SERVICE_NAME</span><span class='rbrack token'>]</span><span class='div op'>/</span><span class='callback identifier id'>callback</span>
</pre>
<p>
You can specify this url to the service you&#8217;re calling when you
register, but it will automatically be sent along anyway.
</p>
<h3>Migrate database</h3>
<p>
The database is defined in:
</p>
<pre class="code">
  <span class='db identifier id'>db</span><span class='div op'>/</span><span class='migrate identifier id'>migrate</span><span class='div op'>/</span><span class='XXX_create_oauth_consumer_tokens constant id'>XXX_create_oauth_consumer_tokens</span><span class='dot token'>.</span><span class='rb identifier id'>rb</span>
</pre>
<p>
Run them as any other normal migration in rails with:
</p>
<pre class="code">
  <span class='rake identifier id'>rake</span> <span class='db identifier id'>db</span><span class='symbol val'>:migrate</span>
</pre>
<h2>More</h2>
<p>
The Google Code project is http://code.google.com/p/oauth-plugin/
</p>
<p>
The Mailing List for all things OAuth in Ruby is:
</p>
<p>
http://groups.google.com/group/oauth-ruby
</p>
<p>
The Mailing list for everything else OAuth is:
</p>
<p>
http://groups.google.com/group/oauth
</p>
<p>
The OAuth Ruby Gem home page is http://oauth.rubyforge.org
</p>
<p>
Please help documentation, patches and testing.
</p>
<p>
Copyright &#169; 2007-2009 Pelle Braendgaard, released under the MIT
license
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>