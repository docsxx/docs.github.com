<!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <title>rubaidh's google_analytics - GitHub Documentation</title>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
<meta name="description" content="">

<link rel="search" type="application/opensearchdescription+xml" href="http://github.com/opensearch.xml" title="GitHub">
<link rel="fluid-icon" href="http://github.com/fluidicon.png" title="GitHub">
<link href="http://assets0.github.com/stylesheets/bundle.css" media="screen" rel="stylesheet" type="text/css">
<link href="http://github.com/feeds/rubaidh/commits/google_analytics/master" rel="alternate" title="Recent Commits to google_analytics:master" type="application/atom+xml">

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
<script type="text/javascript" src="http://assets3.github.com/javascripts/bundle.js"></script>              
<script src="app.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript" src="http://docs.github.com/javascripts/md5.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/repos.js"></script>
<script type="text/javascript" src="http://docs.github.com/javascripts/commits.js"></script>
<script type="text/javascript">
  $(document).ready(function(){
    if (typeof skipHeaders != 'undefined') return;
    
    GitHubRepo.init("rubaidh", "google_analytics", function(){ 
      GitHubRepo.links = " <a id='namespaces_button' rel='rubaidh/google_analytics/blob/57a33b4dddef067b1247459cbd559458a02f2e4b' href='#'><img class='button' src='http://docs.github.com/namespaces_button.png' alt='Modules and Classes'/></a> ";
      GitHubRepo.links += " <a id='methods_button' rel='rubaidh/google_analytics/blob/57a33b4dddef067b1247459cbd559458a02f2e4b' href='#'><img class='button' src='http://docs.github.com/methods_button.png' alt='Methods'/></a> ";
      $("#repo").html(GitHubRepo.content());
      $('#namespaces_button').click(function(){
        var url="/"+$(this).attr('rel')+"/namespaces/";
        $.gitbox(url);
        return false;
      });    
      $('#methods_button').click(function(){
        var url="/"+$(this).attr('rel')+"/methods/";
        $.gitbox(url);
        return false;
      });        
    });
    GitHubCommit.init("rubaidh", "google_analytics", "57a33b4dddef067b1247459cbd559458a02f2e4b", function(){ 
      $("#commit").html(GitHubCommit.content());
    });
  });
</script>

    <link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
  </head>
  <body>    
    
    
        <div id="main" style="padding-bottom:8em;">
      <div id="header">
        <div class="site">
          <div class="logo">
            <a href="http://github.com/"><img src="http://github.com/images/modules/header/logov3.png" alt="github"></a>
          </div>          
          <div class="topsearch">
            <form action="http://github.com/search" id="top_search_form" method="get">
              <input class="search" name="q" type="search"> <input value="Search" type="submit">
            </form>
            <div class="links">
              <a href="http://github.com/repositories">Browse</a> | <a href="http://github.com/guides">Guides</a> | <a href="http://github.com/search">Advanced</a>
            </div>
          </div>
          <div class="actions">
            <a href="http://github.com">Home</a>
            <a href="http://github.com/plans"><b><u>Pricing and Signup</u></b></a>
            <a href="http://docs.github.com/">Documentation</a>
            <a href="https://github.com/login">Login</a>
          </div>                  
        </div>
      </div>    
                                                  
      <div id="repo_menu">
        <div class="site">
          <ul>          
            <li class=""><a href="http://github.com/rubaidh/google_analytics/tree/">Source</a></li>
            <li class=""><a href="http://github.com/rubaidh/google_analytics/commits/">Commits</a></li>            
            <li class=""><a href="http://github.com/rubaidh/google_analytics/network">Network</a></li>            
            <li class=""><a href="http://github.com/rubaidh/google_analytics/issues">Issues</a></li>
            <li class=""><a href="http://wiki.github.com/rubaidh/google_analytics">Wiki</a></li>
            <li class=""><a href="http://github.com/rubaidh/google_analytics/graphs">Graphs</a></li>                    
            <li class="active"><a href="/rubaidh/google_analytics">Documentation</a></li>
          </ul>
        </div>
      </div>

      <div id="repo_sub_menu">
        <div class="site">
          <div class="joiner"></div>      
        </div>
      </div>

      <div class="site">  
        <div id="repos">
          <div id="repo" class="repo public">
            <div class="title">
              <div class="path">
                <a href="http://github.com/rubaidh">rubaidh</a> / <b><a href="http://github.com/rubaidh/google_analytics/tree">google_analytics</a></b>        
                <a id="namespaces_button" rel="rubaidh/google_analytics/blob/57a33b4dddef067b1247459cbd559458a02f2e4b" href="#"><img class="button" src="http://docs.github.com/namespaces_button.png" alt="Modules and Classes"/></a>
                <a id="methods_button" rel="rubaidh/google_analytics/blob/57a33b4dddef067b1247459cbd559458a02f2e4b" href="#"><img class="button" src="http://docs.github.com/methods_button.png" alt="Methods"/></a>
              </div>
            </div>            
          </div>
          <div id="commit">
          </div> 
          <br/>                                       
          <div id="content">
            <div class="section docstring readme wikistyle">
  <h1>GoogleAnalytics</h1>
<p>
This plugin enables Google Analytics support in your application. By
default it will output the analytics code for every single page
automatically, if it is configured correctly. This is done by adding:
</p>
<pre class="code">
    <span class='Rubaidh constant id'>Rubaidh</span><span class='colon2 op'>::</span><span class='GoogleAnalytics constant id'>GoogleAnalytics</span><span class='dot token'>.</span><span class='tracker_id identifier id'>tracker_id</span> <span class='assign token'>=</span> <span class='string val'>'UA-12345-67'</span>
</pre>
<p>
to your <tt>config/environment.rb</tt>, inserting your own tracker id. This
can be discovered by looking at the value assigned to <tt>_uacct</tt> in
the Javascript code.
</p>
<p>
If you want to disable the code insertion for particular pages, add the
following to controllers that don&#8217;t want it:
</p>
<pre class="code">
    <span class='skip_after_filter identifier id'>skip_after_filter</span> <span class='symbol val'>:add_google_analytics_code</span>
</pre>
<p>
If you are running rails 2.1 or above add install this by adding:
</p>
<pre class="code">
    <span class='config identifier id'>config</span><span class='dot token'>.</span><span class='gem identifier id'>gem</span> <span class='string val'>'rubaidh-google_analytics'</span><span class='comma token'>,</span> <span class='symbol val'>:lib</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'rubaidh/google_analytics'</span><span class='comma token'>,</span> <span class='symbol val'>:source</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='string val'>'http://gems.github.com'</span>
</pre>
<p>
and run:
</p>
<pre class="code">
    <span class='rake identifier id'>rake</span> <span class='gems identifier id'>gems</span><span class='symbol val'>:install</span>
</pre>
<p>
Simple. :-)
</p>
<h2>Note</h2>
<p>
This version of the plugin uses the new Google Analytics code (ga.js) by
default. To use the legacy tracking code add the following line to your
<tt>config/environment.rb</tt>:
</p>
<pre class="code">
    <span class='Rubaidh constant id'>Rubaidh</span><span class='colon2 op'>::</span><span class='GoogleAnalytics constant id'>GoogleAnalytics</span><span class='dot token'>.</span><span class='legacy_mode identifier id'>legacy_mode</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
</pre>
<h2>Tracking outbound Links</h2>
<p>
Google Analytics only tracks intra-site links by default. To create an
outbound link that is tracked use the link_to_tracked helper:
</p>
<pre class="code">
    <span class='link_to_tracked identifier id'>link_to_tracked</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='track_path identifier id'>track_path</span> <span class='assign token'>=</span> <span class='string val'>&quot;/&quot;</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='html_options identifier id'>html_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='rparen token'>)</span>
</pre>
<p>
You can use the track_path parameter to group your outbound links into
logical folders inside of Google Analytics.
</p>
<p>
The other forms of link_to are also supported:
</p>
<pre class="code">
    <span class='link_to_tracked_if identifier id'>link_to_tracked_if</span><span class='lparen token'>(</span><span class='condition identifier id'>condition</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='track_path identifier id'>track_path</span> <span class='assign token'>=</span> <span class='string val'>&quot;/&quot;</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='html_options identifier id'>html_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='link_to_tracked_unless identifier id'>link_to_tracked_unless</span><span class='lparen token'>(</span><span class='condition identifier id'>condition</span><span class='comma token'>,</span> <span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='track_path identifier id'>track_path</span> <span class='assign token'>=</span> <span class='string val'>&quot;/&quot;</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='html_options identifier id'>html_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
    <span class='link_to_tracked_unless_current identifier id'>link_to_tracked_unless_current</span><span class='lparen token'>(</span><span class='name identifier id'>name</span><span class='comma token'>,</span> <span class='track_path identifier id'>track_path</span> <span class='assign token'>=</span> <span class='string val'>&quot;/&quot;</span><span class='comma token'>,</span> <span class='options identifier id'>options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='html_options identifier id'>html_options</span> <span class='assign token'>=</span> <span class='lbrace token'>{</span><span class='rbrace token'>}</span><span class='comma token'>,</span> <span class='bitand op'>&amp;</span><span class='block identifier id'>block</span><span class='rparen token'>)</span>
</pre>
<p>
To track outbound links, you should set
</p>
<pre class="code">
    <span class='Rubaidh constant id'>Rubaidh</span><span class='colon2 op'>::</span><span class='GoogleAnalytics constant id'>GoogleAnalytics</span><span class='dot token'>.</span><span class='defer_load identifier id'>defer_load</span> <span class='assign token'>=</span> <span class='false false kw'>false</span>
</pre>
<p>
This will move the tracking javascript to the top of your page. (see
http://www.google.com/support/googleanalytics/bin/answer.py?answer=55527&amp;topic=11006)
</p>
<p>
Tracked links respect the legacy_mode flag.
</p>
<p>
Note: Link-tracking works by inserting onclick() code in the HTML. Because
of this, it will overwrite any onclick that you insert in the html_options
hash.
</p>
<h2>Using local copies of the Analytics Javascript files</h2>
<p>
Under certain circumstances you might find it valuable to serve a copy of
the Analytics JavaScript directly from your server to your visitors, and
not directly from Google. If your visitors are geograhically very far from
Google, or if they have low quality international bandwidth, the loading
time for the Analytics JS might kill the user experience and force you to
remove the valuable tracking code from your site.
</p>
<p>
This plugin now supports local copies of the legacy and new Analytics
JavaScript files, updated via a rake task and served courtesy of the Rails
AssetTagHelper methods. So even if you use asset hosts, the JS will be
served from the correct source and under the correct protocol (HTTP/HTTPS).
</p>
<p>
To enable cached copies and the following to your initialization code:
</p>
<pre class="code">
    <span class='Rubaidh constant id'>Rubaidh</span><span class='colon2 op'>::</span><span class='GoogleAnalytics constant id'>GoogleAnalytics</span><span class='dot token'>.</span><span class='local_javascript identifier id'>local_javascript</span> <span class='assign token'>=</span> <span class='true true kw'>true</span>
</pre>
<p>
Use the following rake task to update the local copy of the JavaScript
file:
</p>
<pre class="code">
    <span class='rake identifier id'>rake</span> <span class='google_analytics identifier id'>google_analytics</span><span class='symbol val'>:updates</span>
</pre>
<p>
To keep the file updated you can add the following to your Capistrano
configuration:
</p>
<pre class="code">
    <span class='after identifier id'>after</span> <span class='string val'>&quot;deploy:symlink&quot;</span><span class='comma token'>,</span> <span class='string val'>&quot;deploy:google_analytics&quot;</span>

    <span class='namespace identifier id'>namespace</span> <span class='symbol val'>:deploy</span> <span class='do do kw'>do</span>
      <span class='desc identifier id'>desc</span> <span class='string val'>&quot;Update local Google Analytics files&quot;</span>
      <span class='task identifier id'>task</span> <span class='symbol val'>:google_analytics</span><span class='comma token'>,</span> <span class='symbol val'>:role</span> <span class='assign token'>=</span><span class='gt op'>&gt;</span> <span class='symbol val'>:web</span> <span class='do do kw'>do</span>
        <span class='run identifier id'>run</span> <span class='dstring node'>&quot;cd #{current_path} &amp;&amp; rake google_analytics:update RAILS_ENV=#{ENV['RAILS_ENV']}&quot;</span>
      <span class='end end kw'>end</span>
    <span class='end end kw'>end</span>
</pre>
<p>
The above Capistrano recipe will almost certainly need some adjustments
based on how you run your deployments, but you should get the idea.
</p>
<h2>Overriding application-default values</h2>
<p>
If you&#8217;re using one Rails application to serve pages across multiple
domains, you may wish to override the domain and tracker ID values on a
controller-by-controller or view-by-view basis. You can do this by setting
the override_domain_name and override_tracker_id properties. These
properties are automatically reset after each use, so the values you set
for domain_name and tracker_id (usually in an initializer) will apply to
all other requests.
</p>
<pre class="code">
    <span class='before_filter identifier id'>before_filter</span> <span class='symbol val'>:local_analytics</span>

    <span class='def def kw'>def</span> <span class='local_analytics identifier id'>local_analytics</span>
      <span class='Rubaidh constant id'>Rubaidh</span><span class='colon2 op'>::</span><span class='GoogleAnalytics constant id'>GoogleAnalytics</span><span class='dot token'>.</span><span class='override_domain_name identifier id'>override_domain_name</span>  <span class='assign token'>=</span> <span class='string val'>'foo.com'</span>
      <span class='Rubaidh constant id'>Rubaidh</span><span class='colon2 op'>::</span><span class='GoogleAnalytics constant id'>GoogleAnalytics</span><span class='dot token'>.</span><span class='override_tracker_id identifier id'>override_tracker_id</span>  <span class='assign token'>=</span> <span class='string val'>'UA-123456-7'</span>
    <span class='end end kw'>end</span>
</pre>
<p>
See the documentation for the GoogleAnalytics class for other configuration
options.
</p>
<p>
Note: You will need to have the mocha gem installed to run the tests for
this plugin.
</p>
<p>
Copyright &#169; 2006-2008 Rubaidh Ltd, released under the MIT license.
</p>

</div>
          </div>
        </div>
      </div>                    
    </div>

    <div id="footer">
      <div class="site">
        <div class="info">
          <div class="links">
            <a href="http://github.com/blog/148-github-shirts-now-available">Shirts</a> |
            <a href="http://github.com/blog">Blog</a> |
            <a href="http://support.github.com/">Support</a> |
            <a href="http://github.com/training">Training</a> |
            <a href="http://github.com/contact">Contact</a> |
            <a href="http://groups.google.com/group/github/">Google Group</a> |
            <a href="http://develop.github.com/">API</a> |
            <a href="http://twitter.com/github">Status</a>
          </div>
          <div class="company">
            <span id="_rrt" title="0.64509s from xc88-s00039">GitHub</span>
            is <a href="http://logicalawesome.com/">Logical Awesome</a> ©2009 | <a href="http://github.com/site/terms">Terms of Service</a> | <a href="http://github.com/site/privacy">Privacy Policy</a>
          </div>
        </div>
        <div class="sponsor">
          <a href="http://engineyard.com/"><img src="http://github.com/images/modules/footer/engine_yard_logo.png" alt="Engine Yard"></a>
          <div>
            Hosting provided by our<br> partners at Engine Yard
          </div>
        </div>
      </div>
    </div>
    
    <div id="coming_soon" style="display: none;">
      This feature is coming soon.  Sit tight!
    </div>

    <div id="facebox" style="display: none;">       
      <div class="popup">         
        <table>           
          <tbody>             
            <tr>               
              <td class="tl"></td>
              <td class="b"></td>
              <td class="tr"></td>             
            </tr>             
          <tr>               
            <td class="b"></td>               
            <td class="body">                 
              <div class="content"></div>                 
              <div class="footer">                   
                <a href="#" class="close"><img src="http://github.com/facebox/closelabel.gif" title="close" class="close_image"></a>                 
              </div>               
            </td>               
            <td class="b"></td>             
          </tr>             
          <tr>               
            <td class="bl"></td>
            <td class="b"></td>
            <td class="br"></td>             
          </tr>           
        </tbody>         
      </table>       
    </div>     


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
    var pageTracker = _gat._getTracker("UA-8689483-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>

  </body>
</html>